{
  "article_text": [
    "we next outline the tree and network construction methods .      consider the pedagogic simulation in figure [ pedagogicsample ] , where we have a region of interest ( such as an influenza segment , for example ) that has undergone mutational and selective processes encapsulated by the evolution tree in figure [ pedagogicsample]a .",
    "this tree contains five mutations @xmath0 that lie on various branches of the tree .",
    "these combine into the six clones that are the leaves of the tree . for example , the second leaf is labeled @xmath1 , indicating a clone with haplotype consisting of mutations @xmath2 but not @xmath3 . note that the path from the root of the tree to this leaf crosses the two branches corresponding to mutations @xmath4 and @xmath5 .",
    "the number @xmath6 at the leaf indicates that this clone makes up @xmath7 of the viral population , and is termed the _",
    "prevalence_.    note that these prevalences form a _ conserved flow network _ through the tree @xcite .",
    "for example , the prevalence of mutation @xmath4 is @xmath8 , which accounts for the two haplotypes @xmath9 and @xmath1 , with prevalences @xmath10 and @xmath7 , respectively . in general , we find that the prevalence flowing into a node of the tree must equal the sum of the exiting prevalences .",
    "this represents conservation of the viral sub - populations .",
    "the total prevalence across all the leaves is therefore @xmath11 .",
    "in reality we are not privy to this information and perform a sequencing experiment to investigate the structure .",
    "this takes the form of molecular sequencing , where we detect the five mutations , which each have a different _ depth _ of sequencing , as portrayed in figure [ pedagogicsample]b .",
    "we will later see with real influenza data in that percentage depth can be reasonably interpreted as prevalence .",
    "furthermore , we can look at the mutations arising on individual sequencing reads and group them into clusters . for our example ,",
    "this groups the mutations into two clusters , giving the haplotype tables in figure [ pedagogicsample]c .",
    "we first construct an evolution tree for each of these tables .",
    "our approach is based upon two sources of information ; one utilizes mutation sequencing depth with a pigeon hole principle , the other utilizes linkage information from haplotype tables .",
    "now we have mutation @xmath5 present in @xmath12 of viruses and mutation @xmath4 present in @xmath8 of viruses .",
    "if these mutations are not both simultaneously present in a sub population of viruses , then the mutations are exclusive .",
    "this implies the two populations of size @xmath12 and @xmath8 do not overlap .",
    "however , the total population of viruses containing either of these viruses would then be greater than @xmath13 .",
    "this is not possible , and the only explanation is that a subpopulation of viruses contain both mutations ; the pigeon hole principle .",
    "the only tree - like evolutionary structure possible is that @xmath4 is a descendant of @xmath5 , as indicated by the rooted , directed tree in figure [ pedagogicsample]di .",
    "note that we have not utilized any haplotype information to infer this , just the mutation prevalence of the two mutations and a pigeon hole principle .",
    "mutation @xmath14 has a prevalence that is too low to repeat a prevalence based argument .",
    "however , we have a second source of information ; the paired read data that can link together mutations into the haplotypes in figure [ pedagogicsample]ci .",
    "this table is based on three mutations , which group into @xmath15 possible haplotypes .",
    "however , a tree structure with three mutations will only contain four leaves @xcite and we see that four of the halpotypes ( emboldened ) have notably larger counts of reads and are likely to be genuine .",
    "the four haplotypes with a notably lower read counts are likely to be the result of sequencing error at the mutant base positions , or template switching from a cycle of rtpcr , and are ignored .",
    "the presence of genuine haplotypes @xmath16 and @xmath17 , lead us to conclude that @xmath14 is descendant from @xmath5 but not @xmath4 , resulting in the tree of figure [ pedagogicsample]di .    from the mutation prevalences @xmath8 , @xmath12 and @xmath18 of @xmath4 , @xmath5 and @xmath14 , we can also use the conserved network flow to measure the haplotypes prevalence .",
    "for example , the leaf descending from @xmath19 , but not @xmath20 or @xmath21 ( clone @xmath17 of figure [ pedagogicsample]di ) must represent the remaining @xmath22 of the population .",
    "this provides us with two sources of information ( sequencing depth and linkage information ) we can utilize to reconstruct the clone haplotypes , prevalence , and evolution .",
    "however , not all mutations can be connected by sequencing reads .",
    "they may be either separated by a distance beyond the library insert size , or may lie on distinct ( unlinked ) segments .",
    "our approach is then as follows .",
    "we first construct a tree for each cluster of linked mutations .",
    "this will be a subtree of the full evolutionary structure .",
    "we then construct a supertree from this set of subtrees .",
    "now both of the trees in figure [ pedagogicsample]d must be subtrees of a full evolutionary tree for the collective mutation set so we need to construct a supertree of these two trees .",
    "we can do this recursively as follows .",
    "we take the mutations and place them in decreasing order according to their prevalence , as given in figure [ pedagogicsample]e .",
    "we then attach branches corresponding to these mutations to the supertree in turn , checking firstly network flow conservation , and secondly that the haplotype information in the subtrees is preserved .",
    "the steps for this example can be seen in figure [ pedagogicsample]f .",
    "we start with a single incoming edge with prevalence @xmath11 ; the entire viral population .",
    "we next place an edge corresponding to @xmath5 , the mutation with maximum prevalence of @xmath12 .",
    "the next mutation in the tree either descends from the root or this new node .",
    "any descendants of @xmath5 must have a prevalence less than this @xmath12 .",
    "any other branches must descend from the top node but can only account for up to @xmath7 of the remaining population .",
    "these two values are the _ capacities _ indicated in square brackets .",
    "the next value we place is @xmath4 with prevalence @xmath8 .",
    "this is beyond the capacity @xmath7 of the top node , so @xmath4 is descendant to @xmath5 , accounting for @xmath8 of the @xmath12 , leaving @xmath23 .",
    "we thus have a three node tree with capacities @xmath7 , @xmath23 and @xmath8 . the third ordered mutation @xmath24 has prevalence @xmath10 , which can only be placed at the bottom node with maximum capacity . out",
    "next mutation @xmath14 has a prevalence @xmath18 that is less than any of the four capacities available , and no useful information on the supertree structure is obtained .",
    "this branch is the first to use haplotype information .",
    "we know from the first subtree that the corresponding branch is a descendant of @xmath5 and not @xmath4 .",
    "the only node we can use ( in red ) has capacity @xmath23 and we place the branch . for the final branch corresponding to mutation @xmath25 ,",
    "the prevalence @xmath18 is less than four available capacities .",
    "the second subtree tells us that @xmath25 is not a descendant of @xmath24 .",
    "this only rules out one of the four choices , and any of the three ( red ) nodes will result in a tree consistent with the data .",
    "the top node selected results in a tree equivalent to that in figure [ pedagogicsample]a . to see this tree equivalence , the internal nodes in the last tree of figure [ pedagogicsample]f have additional leaves attached ( dotted lines ) to obtain figure [ pedagogicsample]a .",
    "we thus find that a single dataset can result in several trees that are consistent with the data .",
    "however , having a time series of samples means a tree consistent with all days of data is required , which will substantially reduces the solution space .",
    "note that the prevalences of the clones at the leaves of the tree results from this recursive process .",
    "we thus find that supertree construction is relatively straightforward with the aid of prevalence .",
    "however , trees do not always fit the data .",
    "this can be due to recombination occurring within segments , or re - assortment occurring between segments . in the next section we construct recombination networks to cater for this , although we will see that they can not be constructed as efficiently as trees .       and",
    "@xmath26 undergo within segment recombination into @xmath27 , with a crossover site between @xmath4 and @xmath14 .",
    "( ciii ) clones @xmath28 and @xmath29 undergo between segment recombination ( reassortment ) into @xmath30 .",
    "( d ) recombination networks arising from the haplotype tables in ( b ) .",
    "( e ) the prevalence of the four mutations across five days .",
    "( f ) phylogenetic network associated with ( a ) . (",
    "g ) point and range prevalence estimates .",
    "( hi ) a network consistent with the two networks of ( d ) .",
    "( hii ) incompatible prevalence conditions associated with ( hi).,width=461 ]    in figure [ networkfigure]a we see another simulated evolution based upon the two segments in figure [ networkfigure]ci that accumulate four mutations , @xmath31 , @xmath32 , @xmath33 and @xmath34 .",
    "first we have mutations @xmath31 and @xmath33 .",
    "then we have the first of two recombination events , @xmath35 , where we have recombination within the first segment as described in figure [ networkfigure]cii .",
    "we then have mutations @xmath32 and @xmath34 , followed by the second recombination event @xmath36 in figure [ networkfigure]ciii , a re - assortment between the two segments .",
    "this results in the seven clones given at the leaves of figure [ networkfigure]a .",
    "the prevalences of the four mutations across five time points are given in figure [ networkfigure]e .",
    "note that we no longer have the conservation of prevalence observed in trees .",
    "for example , mutations @xmath31 and @xmath33 are on distinct branches extending from the root , yet their total prevalence is in excess of @xmath11 ( on day 5 for example ) .",
    "this is due to recombination @xmath35 resulting in the presence of a clone containing both mutations .",
    "the use of the prevalence to reconstruct this structure from observable data thus requires more care .",
    "now we see in figure [ networkfigure]ci that the four mutations cluster into two groups of mutations each bridged by a set of paired reads , resulting in two tables of read counts in figure [ networkfigure]bi , ii .",
    "we would like to reconstruct the evolution in figure [ networkfigure]a from these data .",
    "firstly , we need to decide which of the haplotypes in figure [ networkfigure]b are real . the haplotypes with consistently low entries are classified as artifact ( in opaque ) .",
    "we next use a standard approach ( such as a canonical splits network @xcite ) to construct sub - networks from the real haplotypes in each of these tables , such as those given in figure [ networkfigure]dii .",
    "we then build super - networks ensuring that all sub - networks are contained as a sub - graph .",
    "there does not appear to be an efficient way of doing this ( such as ordering by prevalence which works so well with trees ) so a brute force approach is taken , where we construct all possible networks that contain four mutations and the haplotypes observed in figure [ networkfigure]bi , ii .",
    "this results in many candidate super - networks .",
    "we now find that the prevalence information can be used to reject many cases .",
    "for example , the super - network in figure [ networkfigure]hi contains both sub - networks of figure [ networkfigure]di , ii as subgraphs .",
    "note that the root node , representing the entire @xmath11 of the population , has daughter branches containing mutations @xmath34 , @xmath31 and @xmath33 .",
    "however , from the prevalences on day 5 we see that @xmath34 has prevalence @xmath37 and @xmath31 and @xmath33 ( which recombine ) have a collective prevalence ( from clones @xmath38 , @xmath39 , @xmath40 , and @xmath41 in figure [ networkfigure]bi ) of @xmath42 .",
    "this is in excess of the possible @xmath11 available and the network is rejected .",
    "application of filtering by prevalence ( see methods section for full details ) rejects all networks with one recombination event , so we try all networks with two recombination events , resulting in just seven possible recombination networks .",
    "these all contain the same set of clones , all of which correspond to the single phylogenetic network in figure [ networkfigure]f .",
    "although only one recombination event is present across the subnetworks , all super - networks with one recombination event were filtered out and two recombination events were required .",
    "lastly we require estimates of the prevalences of each of the seven clones .",
    "we would like to match these to the prevalences in the tables of figure [ networkfigure]b .",
    "this is a linear programming problem , the full details of which are given in the methods section .",
    "the resulting estimates are given in figure [ networkfigure]g where we see that some clones have point estimates , whereas others have ranges .",
    "for example , we see that clone @xmath26 has a point estimate for each day .",
    "this is because it is the only clone of the super - network that corresponds to clone @xmath38 of figure [ networkfigure]bi and their prevalences can be matched .",
    "conversely , we see ranges for the prevalences of clones @xmath29 and @xmath30 . this is because both clones correspond to clone @xmath41 of figure [ networkfigure]bi and prevalence estimates for each clone can not be uniquely specified",
    ".    full details of this approach can be found in the methods section . in the next section",
    "we describe the results obtained when applying these methods to a time series of influenza samples .",
    "the data used in this study were generated from a chain of horse infections with influenza a h3n8 virus ( murcia , unpublished ) .",
    "an inoculum was used to infect two horses labeled 2761 and 6652 .",
    "these two animals then infected horses labeled 6292 and 9476 . this latter pair then infected 1420 and 6273 .",
    "the chain continued and daily samples were collected from the horses resulting in 50 samples in total .",
    "for the present study we used 16 samples ; the inoculum and hosts 2761 ( days 2 to 6 ) , 6652 ( days 2 , 3 and 5 ) , 6292 ( days 3 to 6 ) and 1420 ( days 3 , 5 and 6 ) .    influenza a virus is a member of the family orthomyxoviridae which contains eight segmented , negative - stranded genomic rnas commonly referred to as segments and numbered by their lengths from the longest 2341 to the shortest 890 bps @xcite , as summarized in figure [ flusegments]a .",
    "daily samples were collected from each host and paired end sequenced was performed with hi - seq and mi - seq machines .",
    "the samples sequences were aligned with bowtie2 @xcite with default parameters .",
    "we obtain for each sample a sam file containing mapping information of all the different reads in the sample .",
    "any mapped read whose average phred - quality per base was less than @xmath43 were discarded .    in order to identify mutations from real data",
    "we need a reference sequence to compare the read sequences to .",
    "consistent differences between the two can then be classified as a mutation .",
    "we constructed a majority consensus sequence from the inoculum sample .",
    "this consensus sequence was then used as a starting reference for the chain of infected animals .",
    "an amplification procedure was used to produce viral dna .",
    "this involves pcr , which will result in different levels of amplification and mutations .",
    "this in turn is likely to introduce significant differences between the sequencing depth and prevalence . to combat this ,",
    "all identical paired end reads ( with equal beginning and endpoints ) were grouped , classified as a single pcr product , deriving from a single molecule and only counted once .",
    "the depth of sequencing with these adjusted counts then provided an improved measurement of the prevalence of viral subpopulations .",
    "we compared an identical sample that was sequenced separately , the results of which can be seen across two samples in figures[flusegments]b , c i , ii .",
    "both the position and prevalence of mutations were reproducible to good accuracy suggesting proportional sequencing depth is a good surrogate for prevalence .",
    "we then applied the methods to sets of high prevalence mutations in each of the eight segments individually , and also to a set of three mutations from distinct segments .",
    "the main observations are below .      for segments 1 , 3 , 5 , 6 , 7 and 8 we obtained tree like evolutions for the segments . in all cases the mutations involved lay on distinct branches and were indicative of mutations arising in independent clones .",
    "segment 6 can be seen in figure [ miseqhiseq]a , where we see five mutations on six branches .",
    "we also see from the stacked bar chart in figure [ miseqhiseq]b that many of the mutations arose during different periods in the infection chain .",
    "however , the evolution structure of mutations within segments did not always appear to be tree like , with segment 2 containing one putative recombination event and seven mutations , and segment 4 containing three putative recombination events and six mutations .",
    "this latter case arose because we found three pairs of mutations in putative recombination . using nucleotide positions as labels , these were ( 431 , 674 ) , ( 431 , 709 ) and ( 709 , 1401 ) .",
    "that is , we found significant counts of all four combinations of mutations , labeled @xmath44 , @xmath45 , @xmath46 and @xmath47 , lying on paired reads .",
    "examples of typical counts for three ( out of sixteen ) samples are given in the top table in figure [ templateswitching]b ( see supplementary information for full details ) .",
    "if the evolution is tree - like , reads from one of the types @xmath45 , @xmath46 or @xmath47 should only arise as an artifact .",
    "note that we have high read counts of all four categories , which is indicative of recombination .",
    "however , various studies have shown that there is very little evidence of genuine recombination that occurs within segments of influenza @xcite , @xcite , @xcite , and these kind of observations can arise from template switching across different copies of segments during the rtpcr sequencing cycle @xcite .",
    "we developed an analytic approach to consider this possibility in more detail .",
    "now if the true underlying structure is tree - like , it suggests that one of @xmath47 , @xmath45 or @xmath46 arises purely from template switching ( the wild type @xmath44 is assumed to always occur ) .",
    "this gives us the three models ( labeled i - iii in figure [ templateswitching]a , b ) to consider .",
    "we let @xmath48 , @xmath49 and @xmath50 be the population proportions of the three real genotypes .",
    "we let @xmath51 be the probability that a cycle of rtpcr causes template switching .",
    "we then treat template switching as a continuous time three state random process .",
    "this allows us to derive probabilities that genotypes @xmath44 , @xmath45 , @xmath46 and @xmath47 arise on paired end reads , as given in figure [ templateswitching]a ( see methods for derivations ) .",
    "the counts of the four classes of read then follow a corresponding multinomial distribution .",
    "maximum likelihood was used to estimate parameters , obtain log - likelihood scores , and a chi - squared measure of fit was obtained for each of the three models .    for the pair ( 431 , 674 ) we found that the best log - likelihood , on all sixteen sampled days , was model @xmath52 ( figure [ templateswitching]i ) , where reads of type @xmath47 are artifacts arising from template switching alone .",
    "the parameters obtained provided an almost perfect fit ; the expected counts were almost equal to the observed counts and the goodness of fit significance values were close to @xmath52 .",
    "the other two models had substantially lower likelihoods and significantly bad fits .",
    "this tells us that if the underlying structure is a tree , it involves the three genotypes @xmath44 , @xmath45 and @xmath46 and mutations 431 and 674 lie on distinct branches .    for the pair ( 431 , 709 ) we found that the best log - likelihood , over the sixteen sampled days , was model 3 ( figure [ templateswitching]iii ) , where reads of type @xmath46 are artifacts .",
    "the parameters obtained provided an almost perfect fit on most days with goodness of fit significance values close to @xmath52 .",
    "a couple of days had relatively poor fits , but were not significant when multiple testing across all sixteen days was considered .",
    "the model with @xmath47 as an artifact had very similar likelihoods , but the data exhibited significantly poor fits on multiple days .",
    "the model with @xmath45 as an artifact performed very badly .",
    "this tells us that if the underlying structure is a tree , it involves the three genotypes @xmath44 , @xmath45 and @xmath47 and mutation 431 is a descendant of 709 .    for the pair ( 709 , 1401 ) we found that the best log - likelihood , on all sixteen sampled days , was the model 2 ( figure [ templateswitching]ii ) , where reads of type @xmath45 are artifacts .",
    "the parameters obtained provided an almost perfect fit on all days with goodness of fit significance values close to @xmath52 . the other two models performed very badly .",
    "this tells us that if the underlying structure is a tree , it involves the three genotypes @xmath44 , @xmath46 and @xmath47 and mutation 1401 is a descendant of 709 .",
    "thus the three cases where data are indicative of recombination can be explained purely by template switching during rtpcr .",
    "this is reinforced somewhat by the fact that the same model emerged across all sampled days for each mutation pair .",
    "however , this does not definitively rule out recombination , which could also exhibit these consistent patterns across sampled days , and so care is needed when interpreting data .",
    "furthermore , the rates of template switching required to explain the data without recombination were not always consistent . for example , in the sample from host 2761 day 4 , the estimated template switching between mutations ( 431,674 ) was @xmath53 ( @xmath54 c.i @xmath55 - @xmath56 ) . between mutations ( 431,709 )",
    "it was @xmath57 ( @xmath54 c.i @xmath58 - @xmath59 ) , giving reasonable agreement . between mutations ( 709 , 1401 ) it was somewhat higher , at @xmath60 ( @xmath54 c.i @xmath61 - @xmath62 ) , although this may be expected due to the greater distance between the mutations .",
    "however , in sample 1420 day 3 , the template switching rate for the pair ( 431,674 ) , at @xmath63 ( @xmath54 c.i @xmath64 - @xmath65 ) , was notably higher than both the mutation pair ( 431,709 ) , at @xmath66 ( @xmath54 c.i @xmath67 - @xmath68 ) , and mutation pair ( 709,1401 ) , at @xmath69 ( @xmath54 c.i @xmath70 - @xmath71 ) .",
    "although differences between samples ( and so library preparations ) may be expected , differences such as this in the same library are harder to explain without implicating genuine recombination .",
    "we thus have two explanations of the data ; genuine recombination or template switching artifacts .",
    "we consider both cases and then draw comparisons .",
    "firstly we consider segment 4 assuming recombination has taken place .",
    "the results can be seen in figure [ miseqhiseq2 ] .",
    "the prevalences of six mutations of interest are given in figure [ miseqhiseq2]a .",
    "reasonable linkage information was available across the segment , including the two haplotype tables in figure [ miseqhiseq2]c .",
    "the first is linkage information between mutations 709 and 1401 , where all four combinations of mutation occur to reasonable depth , implying recombination between the mutations .",
    "the second is between mutations 1387 and 1401 , where we see only three haplotypes occur to significant depth , suggesting a tree like evolutionary structure between the two mutations .",
    "the full set of tables is in supplementary information .",
    "although the sequencing depth in the first table is lower , due to the rarer occurrence of sufficiently large insert sizes , the information gleaned is just as crucial .",
    "the most parsimonious evolution found involved three recombination events , resulting in the single cloneset contained in the phylogenetic network given in figure [ miseqhiseq2]d . there were @xmath72 possible recombination networks that fit this phylogenetic network , one example of which is given in figure [ miseqhiseq2]e .",
    "the relatively complete linkage information resulted in point estimates for the clone prevalences ( rather than ranges ) , as given in figure [ miseqhiseq2]b .",
    "if we now assume that the recombination like events are template switching during rtpcr , then from above , we observed that mutations 431 and 674 are on distinct branches , mutation 431 is a descendant of 709 , and 1401 is also a descendant of 709 .",
    "this resolves all three reticulation events in the network of figure [ miseqhiseq2]e and we end up with the tree given in figure [ miseqhiseq2]f .",
    "however , this structure still has two minor conflicts .",
    "firstly , the tree like structure suggests that mutation 431 should have a lower prevalence than 1401 , and on most days it does .",
    "however , the sample from host 2761 day 4 has prevalences @xmath73 and @xmath74 for mutations 431 and 1401 , respectively .",
    "similarly , the samples from host 1420 day 3 are @xmath75 and @xmath76 , respectively .",
    "secondly , the four mutations 674 , 709 , 1013 and 1401 all descend from the root on separate branches and should have a total prevalence that is less than @xmath11 and on fifteen of sixteen samples this is true",
    ". however , on sample 6292 day 3 the prevalences are @xmath77 , @xmath78 , @xmath79 and @xmath80 , which combine to @xmath81 .",
    "although the conflicts are relatively small , these differences are larger than would be expected from poisson sampling of such deep data . however , this is the most plausible tree structure we found .",
    "re - assortments occur when progeny segments from distinct viral parents are partnered into the same viral particle , resulting in a recombinant evolutionary network .",
    "now re - assortment is a form of recombination .",
    "this is usually possible to detect in diploid species such as human because linkage information is available across a region of interest , such as a chromosome , and recombination can be inferred .",
    "furthermore human samples have distinct sequencing samples for each member of the species . inferring re - assortment across distinct viral samples",
    "is more difficult because firstly we do not have linkage information across distinct segments , and secondly , we have mixed populations within each sample .        however , we show that re - assortment can still be detected within mixed population viral samples with the aid of information provided by prevalence",
    ". consider figure [ reassortment ] .",
    "we have three mutations in segments @xmath82 , @xmath83 and @xmath84 , along with their mutation nucleotide positions 2037 , 201 and 709 , respectively .",
    "we refer to the mutations as @xmath85 , @xmath86 and @xmath87 accordingly .",
    "we see in figure [ reassortment]d that @xmath85 and @xmath86 have prevalences that alternate in magnitude across the 16 days sampled .",
    "if we assume a tree like structure , these two mutations can not lie on a single branch , because one prevalence would have to be consistently lower than the other ; they must therefore lie on distinct branches .",
    "now mutation @xmath87 can ; i ) be on a distinct third branch , ii ) be a descendant of @xmath85 , iii ) be a descendant of @xmath86 , iv ) be an ancestor of @xmath85 , v ) be an ancestor of @xmath86 , or vi ) be an ancestor of both .",
    "we can rule out all of these choices as follows .",
    "firstly we note that @xmath87 has a prevalence that is consistently larger than that of @xmath85 or @xmath86 , so can not be a descendant of either mutation , ruling out ii ) and iii ) .",
    "we see from sample 6292 day 3 that @xmath85 and @xmath86 have a total prevalence greater than @xmath87 , meaning @xmath87 can not be an ancestor of both mutations , ruling out vi ) . in this sample ,",
    "the total prevalence of all three mutations is in excess of @xmath11 , ruling out i ) . now",
    "if @xmath87 and @xmath85 lie on distinct branches , we see from 2761 day 4 that their combined prevalence is in excess of @xmath11 , ruling out v ) .",
    "finally , if @xmath87 and @xmath86 lie on distinct branches , we see from 6292 day 4 that their combined prevalence is in excess of @xmath11 , ruling out iv ) .",
    "no tree structure is possible and we conclude the presence of re - assortment as the most likely explanation .    in fact ,",
    "application of the full method reveals that two re - assortment events are required to explain the data .",
    "this results in 51 possible recombination networks , one such example is given in figure [ reassortment]b .",
    "these correspond to the four clonesets given in figure [ reassortment]c , arising from two possible phylogentic networks .",
    "the four clonesets have prevalences that could not be uniquely resolved ; their possible ranges are shown in figure [ reassortment]d .",
    "although we can not uniquely identify the network or the prevalences , all solutions involved two re - assortments , one involving mutations @xmath87 and @xmath85 , the other involving @xmath87 and @xmath86 .",
    "this observation was only possible because of inferences made with the prevalence .",
    "we have introduced a methodology to analyze time series viral sequencing data .",
    "this has three aims ; to identify the presence of clones in mixed viral populations , to quantify the relative population sizes of the clones , and to describe underlying evolutionary structures , including reticulated evolution .",
    "we have demonstrated the applicability of these methods with paired end sequencing from a chain of infections of the h3n8 influenza virus . although we could identify underlying evolutionary structures , some properties of the viruses and the resulting data make interpretation difficult . in particular ,",
    "template switching during the rtpcr cycle of sequencing an rna virus is known to occur , and can result in paired reads that imply the presence of recombination .",
    "although any underlying tree like evolutions can still be detected , these artifacts confound the signal of any genuine recombination that may be taking place , making it harder to identify .",
    "the prevalence of mutations , measured as sequencing depth proportion , offers an alternative source of information that can help resolve these conflicts in theory , although more work is needed to evaluate how robust this metric is in practice .",
    "for example , although tree like evolutions were identified in six of the segments , in the two remaining segments the approach found reticulated networks , with three distinct reticulated nodes in the hemagglutinin segments network .",
    "although each of these nodes were consistent with template switching artifacts , the resultant tree structure could not quite be fitted to the mutation prevalences .",
    "although this conflict implies the original network is correct and recombination has taken place , within segment recombination in influenza is rare @xcite , @xcite , @xcite and other explanations may be required . in particular , we note in figure [ flusegments]b that there are slight differences between the prevalences obtained from independent mi - seq and hi - seq runs . although some of this will be due to poisson variation of depth , there could be some biases in pcr over certain mutations , for example .",
    "the application of prevalence thus needs to be used with caution , and further studies are needed to fine tune this type of approach .",
    "when the approach was applied to mutations in distinct segments , two re - assortment events were inferred .",
    "the differences in mutation prevalences were more marked in this case suggesting the inference is more robust and re - assortment more likely to have taken place .",
    "this is also biologically more plausible , with events such as this accounting for the emergence of new strains .",
    "we note that although re - assortment may have genuinely taken place , only one of the original clones ( containing just mutation 709 on segment 4 ) survived the infection chain and a longitudinal study would not have picked up such transient clonal activity .",
    "these methods utilized paired end sequencing data and showed that even when paired reads do not extend the full length of segments , or bridge distinct segments , we can still make useful inferences on the underlying evolutionary structures .",
    "the two main sources of information are the linkage offered by two or more mutations lying on the same paired reads , and the prevalence information .",
    "it is by utilizing the variability of the prevalence in a time series dataset that we can narrow down the predictions to a useful degree ; application of this method to individuals days will likely result in too many predictions to be useful .",
    "furthermore , this has greatest application to mutations of higher prevalence ; this places more restrictions on possible evolutions consistent with the data .",
    "subsequently , this kind of variability is most likely to manifest itself under conditions of differing selectional forces .",
    "a stable population is less likely to contain mutations moving to fixation under selective forces .",
    "lower prevalence mutations will result , meaning less predictive power .",
    "simulations also suggest that although clone - sets may be uniquely identified , prediction of the underlying reticulation network is difficult , with many networks explaining the same dataset .    as we lower the minimum prevalence of analyzed mutations , their number will increase",
    ". the number of networks will likely explode and raise significant challenges .",
    "furthermore , single strand rna viruses such as influenza mutate quickly , suggesting a preponderance of low prevalence mutations likely exist .",
    "this is further exacerbated by the fact that sequencing uses rt - pcr , introducing point mutations and template switching artifacts that create noise in the data .",
    "these processes are likely responsible for the grass - like distribution of low prevalence mutations visible in figure [ flusegments]b , c .",
    "thus as we consider lower prevalence mutations we are likely to get a rapidly growing evolution structure of increasingly complex topology .",
    "the methods we have introduced , however , can provide useful information at the upper - portions of these structures .",
    "the software viralnet is available at www.uea.ac.uk/computing/software .",
    "the raw data is available from the ncbi ( project accession number srp044631 ) .",
    "more detailed outputs from the algorithm are available in supplementary information .",
    "we now consider tree and network construction methods , a template switching model , and validation of the methods .      the construction of phylogenetic trees is a well established area @xcite .",
    "trees are frequently constructed from tables of haplotypes of different species .",
    "however , we have two properties that change the situation .",
    "firstly , if we have a set of @xmath51 mutations linked by reads , we can have up to @xmath88 distinct haplotypes .",
    "however , a consistent set of splits from such a table should only have up to @xmath89 distinct haplotypes , in a split - compatible configuration @xcite . to construct a phylogenetic tree we thus need to classify the genotypes as real or artifact .",
    "secondly , we have prevalence information , in the form of a conserved network flow through the tree .",
    "this can help us to both decide which haplotypes to believe and to construct a corresponding tree .    to describe the algorithm we first introduce some notation .",
    "now , the evolutionary structure is represented by two types of rooted directed tree ; one where each edge represents a mutation , such as in figure [ pedagogicsample]f , and one where all leaves represent clones in the population , such as in figures [ pedagogicsample]a , d .",
    "the first is a subtree of the latter .",
    "the latter has a conserved flow network .",
    "these will be termed the _ compact prevalence tree _ and _ complete prevalence tree _ respectively .",
    "now to each edge @xmath90 in the compact prevalence tree , we assign _ prevalence _ @xmath91 .",
    "this represents the proportion of population containing the mutation represented by the edge @xmath90 .",
    "the single directed edge @xmath92 pointing toward a vertex @xmath93 ( away from the root ) represents a viral population of prevalence @xmath94 , all containing the mutation corresponding to edge @xmath92 , along with its predecessor mutations .",
    "the set of daughter edges @xmath95 leading away from node @xmath93 represent populations containing subsequent mutations , each with prevalence @xmath96 .",
    "the remaining population from @xmath94 contains just the original mutation set , having a prevalence described by the _ capacity _ @xmath97 .",
    "the conservation of prevalence satisfied by each vertex @xmath98 is then represented by the condition :        this describes the mutation based trees such as that in figure [ pedagogicsample]f . to obtain a complete tree containing all the clones , we need to extend an edge from each internal node to represent the associated clone ( these are the dashed lines in figure [ pedagogicsample]a ) .",
    "the prevalence of the additional edges are equal to the capacities of the parental nodes .",
    "we saw in figure [ pedagogicsample]b that mutations can be clustered together , and evolution trees constructed for each cluster .",
    "we refer to these as _ subtrees_. we then look for a tree that contains all such subtrees as a subset of edges .",
    "we refer to these as _",
    "* step 1 * _ subtree construction _ now , for @xmath51 mutations we have @xmath88 possible haplotypes , with corresponding counts @xmath100 , and a tree with @xmath89 haplotypes to fit .",
    "this implies that @xmath101 of those counts are artifacts .",
    "for example , in figure [ cayley]d we see the simulated counts for @xmath102 haplotypes on @xmath83 mutations .",
    "now cayley s formula states that there are @xmath103 different labeled trees that can be constructed on n vertices @xcite .",
    "these are easily constructed with the aid of prfer sequences @xcite , which are any integer sequence @xmath104 $ ] such that @xmath105 .",
    "the first few examples are given in figure [ cayley]a .    to construct a tree",
    "we start with @xmath106 $ ] and the vector @xmath107 $ ] . at each step",
    "we take the lowest entry of @xmath108 not in @xmath109 , and the lowest entry of @xmath109 , and join the two corresponding nodes together with an edge .",
    "for example in figure [ cayley]b we start with @xmath110 $ ] , where the root node @xmath111 is treated as the minimum value , along with prfer sequence @xmath112 $ ] .",
    "the smallest element of @xmath108 not in @xmath109 is @xmath52 .",
    "the corresponding node is then joined to the node for the smallest element @xmath111 of @xmath109 , such as exemplified in figure [ cayley]biii .",
    "these two elements are removed from @xmath109 and @xmath108 and the process repeated until we are left with two elements in @xmath108 .",
    "our example leaves us with the two elements @xmath82 and @xmath83 , the corresponding nodes of which are then joined by an edge .",
    "the edges are then directed away from the root , resulting in the prevalence clonal tree in figure [ cayley]cii .",
    "the corresponding complete prevalence tree is in figure [ cayley]ciii .    ,",
    "@xmath83 and @xmath84 vertices .",
    "( bi ) vertex list * v * for example ( * ) .",
    "( bii ) prfer sequence * p*. ( biii ) tree construction .",
    "( ci ) the graph directed away from the root .",
    "( ii ) the equivalent compact clonal tree . ( iii ) the corresponding complete clonal tree . ( d ) alignment of trees * and @xmath113 to haplotype tables.,width=415 ]",
    "once we have all the possible subtrees constructed , we use maximum likelihood to select the most plausible tree .",
    "consider , for example , the penultimate column of figure [ cayley]d , which correspond to the four haplotypes for the tree @xmath114 in figure [ cayley]a - c .",
    "note that the haplotype @xmath115 with a count 550 is an artifact for this tree .",
    "if each mutation artifact arises with probability @xmath116 , then an artifact read of type @xmath115 contains two mutant bases and occurs with probability @xmath117 .",
    "we can then construct log - likelihoods ( summed across time points ) for the artifact counts arising from clones that do not belong to the putative tree being tested .",
    "we then assume poisson distributed counts and construct the following likelihood function for a given putative clonal tree @xmath118 :      here @xmath120 indexes the time point , @xmath121 and @xmath122 are the total depth and the error rate , respectively .",
    "the values @xmath123 represents the number of mutants in haplotype @xmath124 .",
    "the tree with maximum likelihood is selected .",
    "* step 2 * _ supertree construction _ we next build supertrees of the evolution from the subtrees .",
    "as we saw in the example in figure [ pedagogicsample]f , this involves ranking the subtree branches by prevalence , and adding mutations sequentially as in the example in figure [ pedagogicsample]f , checking pairwise ancestry relationships between mutations ( from the subtrees ) , along with the capacity of prevalence available at each node ( by checking equation ( 1 ) for every time point ) .",
    "we would like to use data such as figure [ networkfigure]b to reconstruct the evolutionary structure .",
    "the splits method @xcite is used to construct phylogenetic networks such as figure [ networkfigure]g . there are many recombination networks that correspond to any given phylogenetic network . a standard method to identify recombination networks is to look for an optimal path of trees across the recombination sites @xcite .",
    "these methods generally have the full mutation profile of a set of species of interest to compare .",
    "our problem is exacerbated by missing data and the full haplotypes of distinct species ( clones in our case ) are not available .",
    "however , we have prevalence information which can help identify structures consistent with the data .    we construct recombination networks in five steps ; haplotype classification , super - network construction , super - network filtering , prevalence maximum likelihood estimation , and prevalence range estimation .",
    "we describe these steps in detail .",
    "* step 1 * _ haplotype classification_. in order to distinguish the real and artifact haplotypes in any table such as figure [ miseqhiseq2]c we do the following . for any count @xmath125 associated with haplotype @xmath124 and time point @xmath120",
    ", we calculate the probability it arises as an error using the poisson distribution .",
    "this gives a term of the form @xmath126 , where @xmath121 is the total read depth from that time point , @xmath123 is the number of mutations distinct from the wild type , and @xmath116 is a user selected error rate per base per read .",
    "we then take the combined log - likelihood @xmath127 across all time points .",
    "all log - likelihoods below a threshold @xmath128 are classified as artifact .",
    "the values @xmath129 and @xmath130 were used in implementation .",
    "* step 2 * _ super - network construction_. this is a brute force approach where we construct all possible recombination networks using @xmath131 reticulated nodes in turn .",
    "any networks that do not contain the real haplotypes of the individual haplotype tables of step 1 are rejected .",
    "the value of @xmath132 selected is the smallest value with any valid networks after steps 3 and 4 are implemented .",
    "* step 3 * _ filtering_. we need to utilize the prevalence to identify and remove invalid networks .",
    "each leaf @xmath50 of the recombination graph represents a single clone of the mixed population .",
    "we let @xmath133 denote the prevalences of that clone .",
    "we then have the conditions :      now we have the estimated prevalence @xmath135 of each mutation @xmath136 from the proportional sequencing depth at the mutations position .",
    "if we let @xmath137 denote the set of clones from the super - network that contain mutation @xmath138 , we have conditions of the form :      we solve the linear programming problem defined by equations [ simplex ] and [ filter ] with the simplex method .",
    "if no solution exists on any day @xmath120 the network is rejected .",
    "if a solution is found , it is the input to the ( more precise ) calculation in step 4 .",
    "this step generally reduces the number of networks to manageable levels .",
    "* step 4 * _ prevalence point estimation _ in reality @xmath135 is an estimate and we have more information than just the depth of mutations . for each cluster of mutations",
    "we have the count @xmath125 for each real genotype @xmath124 ( artifacts are ignored ) and time points @xmath120 in the corresponding table .",
    "conditioning on the total count @xmath121 of real genotypes results in a binomial log - likelihood of the following form :      here the sum is over the set @xmath141 of clones that contain haplotype @xmath124 .",
    "we then sum this over all tables and time points and maximize for estimates of the clone prevalences @xmath142 .",
    "we use gradient descent to maximize , projecting each step onto the simplex in equation [ simplex ] .",
    "projecting onto the simplex is relatively straightforward , the updated prevalence vector * @xmath143 * just becomes @xmath144 , where negative components are set to zero .",
    "* step 5 * _ range estimation_. step 4 does not always result in a unique estimate , because there may be ranges of values @xmath142 on the simplex of equation [ simplex ] that yield identical terms @xmath145 .",
    "then if @xmath146 are the estimates from the gradient descent , we use the simplex method to maximize @xmath147 subject to equation [ simplex ] and conditions of the form :      valid clonesets with the maximum likelihood are then selected .",
    "this can be applied to any putative network to either conclude that the network is not feasible , or produce a range of possible prevalences associated with the network .      we model template switching during rtpcr as follows .",
    "suppose we have two mutations of interest and four possible genotypes , labeled @xmath44 , @xmath45 , @xmath46 and @xmath47 .",
    "we have corresponding read depth counts @xmath149 , @xmath150 , @xmath151 and @xmath152 .",
    "now , if tree like evolution exists , one of @xmath45 , @xmath46 or @xmath47 is an artifact arising from template switching during rtpcr ( the wild type c00 is assumed to always occur ) .",
    "we demonstrate the case where @xmath45 is an artifact ( model 2 in figure [ templateswitching]aii ) .",
    "the derivation for the other two models is similar .",
    "then we assume that the real clones @xmath44 , @xmath46 and @xmath47 have prevalences of @xmath48 , @xmath49 and @xmath50 , respectively , so that @xmath153 .",
    "we model rtpcr as a time continuous three state process , where template switching occurs at a rate @xmath154 , jumping to any of the three templates @xmath44 , @xmath46 or @xmath47 with probabilities @xmath48 , @xmath49 and @xmath50 , respectively .",
    "we also refer to the states as @xmath48 , @xmath49 and @xmath50 .",
    "we let @xmath155 , @xmath156 and @xmath157 be the probabilities of occupying a copy of the corresponding templates at position @xmath120 . then conditioning @xmath155 over a time interval",
    "@xmath158 results in the following expression ( see @xcite for typical derivations ) :              probabilities for all types @xmath44 , @xmath45 , @xmath46 and @xmath47 can now be defined , which we demonstrate for @xmath46 .",
    "derivations for the other terms can be obtained in a similar manner . from figure",
    "[ templateswitching]aii we see that to obtain a read of the form @xmath46 , we can start in either state @xmath49 or @xmath50 and end in either state @xmath48 or @xmath49 .",
    "this gives us four terms to add :        the counts @xmath149 , @xmath150 , @xmath151 and @xmath152 then follow a multinomial distribution , from which log - likelihoods can be derived . a chi - squared goodness of fit can then be obtained .",
    "we note that in many cases , solutions for the four terms @xmath165 , @xmath166 , @xmath167 and @xmath168 in terms of @xmath48 , @xmath49 , @xmath50 and @xmath51 can be obtained , resulting in a perfect fit .",
    "when this is not possible , one or more of the three models can be rejected if the fit is sufficiently bad .    note",
    "that none of these three models necessarily explain the data . in the last column of figure [ templateswitching]d , for example",
    ", we have four artificial counts @xmath169 , @xmath170 , @xmath170 and @xmath170 corresponding to genotypes @xmath44 , @xmath45 , @xmath46 and @xmath47 .",
    "all three models are a bad fit suggesting recombination is present .",
    "however , this relies on small counts for @xmath44 , which were not observed in the real data that was examined .",
    "note that template switching has no effect on the prevalence of individual mutations .",
    "for example , considering figure [ miseqhiseq]ciii , if we add @xmath166 and @xmath168 , we get @xmath171 , which is precisely the prevalence of mutation @xmath32 .",
    "the validation of the method is based upon simulated data .",
    "this will give some idea of the reconstruction capabilities of the methods and allow benchmarking with other existing approaches . in particular , we compared our tree construction algorithm to the benchmark software shorah using the same simulation approaches as zagordi et al @xcite and astrovskaya et al .",
    "@xcite .    to measure the performance of the mixed population estimation",
    ", we computed the _ precision _ , the _ recall _ , and the _ accuracy _ of prevalence estimation for the methods of interest .",
    "the recall ( or sensitivity ) gives the ratio @xmath172 of correctly reconstructed haplotypes to the total number of true haplotypes , where we have true positives ( @xmath173 ) , false negatives ( @xmath174 ) and false positives ( @xmath175 ) .",
    "the precision gives their ratio to the total number of generated haplotypes , @xmath176 .",
    "the accuracy measures the ability of the method to recover the true mixture of haplotypes , and was defined as measuring the mean absolute error of the prevalence estimate . where a range estimate is obtained for the prevalence",
    ", we calculate the shortest distance from the true value to the range .",
    "comparison with shorah was done on simulated deep sequencing data from a 1.5 kb - long region of hiv-1 .",
    "simulated reads have been generated by metasim@xcite , a meta - genomic simulator which generates collections of reads reproducing the error model of some given technologies such as sanger and 454 roche .",
    "it takes as input a set of genome sequences and an abundancy profile and generates a collection of reads sampling the inputted genomic population .    for up to @xmath177 haplotypes and @xmath83 reticulations we performed 100 runs as follows .",
    "we randomly constructed a network by attaching each new branch to a random selected node .",
    "reticulations were also randomized .",
    "the prevalences of the resulting clones ( at the leaves ) were randomly selected from a dirichlet distribution .",
    "this is repeated for 10 time points of data .",
    "we used metasim to generate a collection of 5,000 reads having an average length of 500bp and replicating the error process of roche 454 sequencing .",
    "the methods were then applied to the resulting data .    shorah output can display mismatches or gaps in the outputted genomes , with increasing frequency at the segment edges .",
    "we applied a modification on shorah output by trimming the edge and we then corrected one or two mismatches or gaps on all the genomes before addressing the comparison .",
    "figures [ validation]a - c provide the comparison for recall , precision and error indicators .",
    "we found slight improvements for recall , especially for tree like evolution . the precision and error also had improved results .",
    "we acknowledge that the simulations were based upon evolutionary structures that the models are designed to fit so such improvement might be expected .",
    "furthermore , shorah likely have better performance on low prevalence clones .",
    "however , these simulations demonstrate that reasonable results can be obtained from the techniques we have introduced ."
  ],
  "abstract_text": [
    "<S> rna virus populations will undergo processes of mutation and selection resulting in a mixed population of viral particles . </S>",
    "<S> high throughput sequencing of a viral population subsequently contains a mixed signal of the underlying clones . </S>",
    "<S> we would like to identify the underlying evolutionary structures . </S>",
    "<S> we utilize two sources of information to attempt this ; within segment linkage information , and mutation prevalence . </S>",
    "<S> we demonstrate that clone haplotypes , their prevalence , and maximum parsimony reticulate evolutionary structures can be identified , although the solutions may not be unique , even for complete sets of information . </S>",
    "<S> this is applied to a chain of influenza infection , where we infer evolutionary structures , including reassortment , and demonstrate some of the difficulties of interpretation that arise from deep sequencing due to artifacts such as template switching during pcr amplification .        </S>",
    "<S> [ [ section ] ]    rna viruses have evolutionary dynamics characterized by high turnover rates , large population sizes and very high mutation rates @xcite , @xcite , resulting in a genetically diverse mixed viral population @xcite , @xcite . </S>",
    "<S> subpopulations in these mixtures containing specific sets of mutations are referred to as clones and their corresponding mutation sets as haplotypes . </S>",
    "<S> unveiling the diversity , evolution and clonal composition of a viral population will be key to understanding factors such as infectiousness , virulence and drug resistance @xcite .    </S>",
    "<S> high throughput sequencing technologies have resulted in the generation of rapid , cost - effective , large sequencing datasets @xcite . when applied to viruses , </S>",
    "<S> the set of reads obtained from a deep sequencing experiment represents a sample of the viral population which can be used to infer the underlying structure of that population at an unprecedented level of detail @xcite .    in this study </S>",
    "<S> , we aim to identify the haplotypes of clones and quantify their prevalence within a viral population . </S>",
    "<S> the method also constructs evolutionary histories of the process consistent with the data . reconstructing the structure of a mixed viral population from sequencing data </S>",
    "<S> is a challenging problem @xcite . </S>",
    "<S> only a few works address the issue of viral mixed population haplotype reconstruction which infer both the genomes of sub - populations and their prevalence . </S>",
    "<S> reviews of the methods and approaches dealing with these issues can be found in @xcite , @xcite , @xcite , @xcite and @xcite .    </S>",
    "<S> these works frequently make use of read graphs , which consist of a graph representation of pairs of mutations linked into haplotypes @xcite . </S>",
    "<S> haplotypes then correspond to paths through these graphs , although not every path will necessarily be realized as a genuine haplotype , which can lead to over - calling haplotypes . </S>",
    "<S> different formalizations of this problem has led to different optimization problems in the literature @xcite , including minimum - cost flows @xcite , minimum sets of paths @xcite , @xcite , probabilistic and statistical methods @xcite , network flow problems @xcite , minimum path cover problems @xcite , maximizing bandwidth @xcite , graph coloring problems @xcite or k - mean clustering approaches @xcite . </S>",
    "<S> after the haplotypes are constructed , in many cases an expectation - maximisation ( em ) algorithm is used to estimate their prevalence in the sampled population . some other works @xcite , @xcite use a probabilistic approach instead of a graph - based method .    in this work </S>",
    "<S> we take an integrative approach to address both the genetic diversity and the evolutionary trajectory of the viral population . </S>",
    "<S> the method presented is not read graph based and constructs evolutionary trees and recombination networks weighted by clone prevalences . </S>",
    "<S> this reduces the size of the solution set of haplotypes . </S>",
    "<S> the method does not rely exclusively on reads physically linking mutations so is applicable to longer segments . </S>",
    "<S> the method will also be shown to have particular utility with time series data and is highlighted on a chain of infections by influenza ( h3n8 ) .    </S>",
    "<S> the question of the influenza genome diversity has been addressed in the literature largely between strains or samples from different hosts , considering one single dominant genome for each host @xcite . within - host evolution </S>",
    "<S> is a source of genetic diversity the understanding of which may lead to the development of models that link different evolutionary scales @xcite . </S>",
    "<S> kuroda et al . </S>",
    "<S> @xcite addressed the question of evolution within a single host of influenza extracted on a patient who died of an a / h1n1/2009 infection , but with a focus on ha segment using a de - novo approach . </S>",
    "<S> our approach provides a method to further understand within host evolution of such viruses .    </S>",
    "<S> the next section highlights the approach with an overview of the tree and network construction methods with simulated data , followed by an application of the method to a daily sequence of real influenza data . </S>",
    "<S> the methods section describes the construction of the trees and networks in more detail . </S>"
  ]
}