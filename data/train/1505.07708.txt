{
  "article_text": [
    "radiative transfer , the process that describes radiation propagating through and interacting with matter , is a general problem that is encountered in all areas of astronomy ( and far beyond ) . due to its high dimensionality and nonlocal and nonlinear behaviour ,",
    "it is generally considered as one of the most challenging problems in numerical astrophysics .",
    "recent years have seen an impressive advancement of three - dimensional ( 3d ) radiative transfer studies , thanks to the increase in computational power , the availability of a wealth of new observational constraints and the development of new algorithms . among the different approaches available to solve the radiative transfer problem ,",
    "the monte carlo method is generally the most popular one .",
    "the first monte carlo radiative transfer codes were developed more than four decades ago , and since then the method has steadily increased its market share in all fields where 3d radiative transfer is important .",
    "many powerful monte carlo codes are available in various fields of computational astrophysics , including dust radiative transfer , ly@xmath0 line transfer , ionising radiation transport @xcite , neutron transport @xcite and neutrino radiation transport @xcite",
    ". these and many other papers and monographs discuss at length the main algorithms behind monte carlo radiative transfer and the various proposed improvements and acceleration techniques .    a very different aspect of monte carlo radiative transfer codes that has received very little attention in the literature , is the setup of a suite of components that describe the distribution of the sources and sinks in the radiative transfer code ( i.e. , the objects that add radiation to or remove radiation from the radiation field ) .",
    "this is an aspect outside the real core of monte carlo radiative transfer problem .",
    "virtually all of the available codes require the user to hard - code the model makeup for each distinct problem ( although the results of hydrodynamical simulations can generally be processed out of the box , given the appropriate import module ) .",
    "we argue , however , that it is very useful for a radiative transfer code to provide a suite of input models , or _",
    "geometries _ , as built - in components .",
    "such toy models can provide a low - threshold introduction to new users .",
    "they also have a crucial role in a more scientific way : toy input models are used to benchmark different codes , to investigate the effects of dust attenuation on the apparent structural parameters of galaxies , or to investigate the physical impact of e.g.  clumpiness or spiral arms .",
    "finally , they are essential for so - called inverse radiative transfer , i.e.  when a parameterised radiative transfer model is fitted to observational data .    in order to be useful for these goals",
    ", the suite of input models should be diverse enough and contain models with different degrees of complexity , ranging from the metaphorical spherical cows to more realistic toy models that consider , for example , spheroidal and triaxial geometries , including bars , spiral arms and clumpy distributions .",
    "setting up such a suite is more complex than it might appear at first sight .",
    "while each model is in principle completely determined by the 3d density distribution @xmath1 , the setup requires more than just an implementation for this density function .",
    "a crucial aspect of monte carlo radiative transfer codes is the emission of a multitude of simulated photon packets from random locations sampled from the source density distribution .",
    "so each model in the suite should contain a routine that generates random numbers according to @xmath1 .",
    "moreover , this random position generation needs to be very efficient , since the random positions are sampled extremely often . in this aspect ,",
    "monte carlo radiative transfer simulations differ from other codes where random positions need to be sampled from arbitrary density distributions , e.g.  to generate the initial conditions for n - body or hydrodynamical simulations .",
    "the efficient generation of random positions from complex 3d density distribution is not a trivial task .",
    "another aspect that needs consideration is the organisation of such a suite of input models .",
    "one could provide a parameterised model that can cover every possible option , but this would quickly lead to an explosion of options that is hard to overview and maintain , and would inevitably contain substantial code duplication .    in this paper , we describe how these issues are dealt with in the publicly available 3d monte carlo dust radiative transfer code skirt .",
    "while we summarise the relevant information for the discussion here , an in - depth description of the architecture and overall design of the skirt code can be found in .",
    "it should also be noted that the presented design issues , while discussed in the context of skirt and thus dust radiative transfer , are fully applicable to other monte carlo transport problems .",
    "this paper is laid out as follows . in section  [ techniques.sec ]",
    "we review the general techniques to generate random vectors from multivariate distributions that are available in the specialised numerical analysis literature , but less so in the astrophysics community . in section  [ geometrysetup.sec ] we present the general setup of the suite of models for the skirt code . in section  [ buildingblocks.sec ]",
    "we describe the various building blocks currently present in the skirt code , and in section  [ decorators.sec ] we present a number of decorators that can be used to combine and add complexity to simple building blocks .",
    "some decorators are analysed in more detail , focusing on the methods used to efficiently generate random positions . in section  [ discussion.sec ]",
    "we discuss the advantages of the decorator - style design of our suite of components , and we critically investigate an alternative option in which random positions are generated using a generic routine rather than customised generators .",
    "we show that , while such an approach is simpler to implement and might hence seem an attractive alternative , it can not compete with our approach , in terms of accuracy and efficiency .",
    "section  [ conclusions.sec ] sums up .",
    "the generation of random numbers from univariate distributions is a well - known topic in numerical analysis .",
    "a number of standard methods are widely used and clearly described in standard textbooks ( e.g. , * ? ? ?",
    "additional techniques that are less known in the ( astro)physics community include the acceptance - complement method @xcite and the forsythe - von neumann method @xcite .",
    "for an extensive overview of random number generation from univariate distribution , see @xcite .",
    "unfortunately , the generation of random vectors from multivariate distributions is much more complex .",
    "the only multivariate distributions from which random vectors can be generated directly are those where the density can be written as a product of independent univariate density distributions . in general , however , more advanced techniques are necessary .",
    "the inversion method , also known as inversion sampling , is the most popular method for univariate generation problems .",
    "the basis of this method is the following : if @xmath2 is distributed according to a density @xmath3 , then the variable @xmath4 defined as the solution of the equation @xmath5 is distributed according to the density @xmath6 if we now want to generate a number from a given density @xmath7 , we can take a uniform distribution @xmath8 and set @xmath9 where @xmath10 is the cumulative distribution corresponding to the density @xmath7 . the inversion method can hence be used to generate random variates with an arbitrary density , provided that the inverse function @xmath11 to the cumulative distribution @xmath12 is explicitly known .",
    "classical examples include the exponential distribution , the cauchy distribution , the rayleigh distribution and the logistic distribution .",
    "formula ( [ transfmethod1d ] ) can directly be expanded to multiple dimensions : if @xmath13 is distributed according to the joint probability distribution @xmath14 , then the vector @xmath15 defined as the solution of the vector equation @xmath16 is distributed according to the joint distribution @xmath17 where @xmath18 is the jacobian determinant .",
    "probably the most famous application of this formula is the box - muller method to generate random normally distributed deviates @xcite .",
    "another interesting special application is the case of a linear transformation . in this case",
    ", the transformation @xmath19 can be written as a matrix multiplication @xmath20 , and the distribution of @xmath15 is @xmath21 with @xmath22 the absolute value of the determinant of @xmath23 .",
    "this kind of transformation is particularly useful for the generation of random vectors with a given dependence structure , as measured by the covariance matrix @xcite .    in general , however , it is not straightforward to use this identity ( [ transfmethodmd ] ) to construct a method that can be used to generate random positions from an arbitrary multidimensional distribution .",
    "apart from the inversion method , the rejection method , also known as the acceptance - rejection method , is the most popular method to sample nonuniform random numbers from univariate distributions @xcite .",
    "the basic idea behind the method is that , if one wants to sample a random number from a function @xmath7 , one can sample uniformly from the 2d region under the graph @xmath7 .",
    "more concretely , assume that @xmath24 , where @xmath25 is another distribution from which random numbers are easily generated , and @xmath26 is the so - called rejection constant ( it obviously satisfies the condition @xmath27 ) .",
    "one then generates a uniform deviate @xmath28 and a random number @xmath4 from the reference distribution @xmath25 , and calculates the quantity @xmath29 .",
    "this procedure is repeated until @xmath30 , in which case @xmath4 is the desired random number .",
    "one of the advantages of the rejection method is that it does not require that the cumulative distribution function be analytically known , let alone be invertible . however , its effectiveness depends on how accurate @xmath31 is approximated from above by @xmath32 .",
    "less accurate approximation leads to a greater chance of rejection ; on average @xmath26 iterations of the loop are required before one successful random number is generated . moreover",
    ", the reference distribution should be such that random numbers can be easily generated from it and that the computation of @xmath33 is simple . for a range of standard distributions , such as the gamma distribution and the poisson distribution ,",
    "efficient reference functions can be constructed .",
    "the rejection method is by no means limited to univariate distributions , and can immediately be applied to multivariate generation problems .",
    "however , the rejection rate typically increases rapidly when going from one to more dimensions , which decreases the efficiency of the method .",
    "moreover , the design of a suitable reference distribution becomes much more complicated .",
    "the composition method or probability mixing method is another important technique in both univariate and multivariate random number generation @xcite . rather than a method on itself to generate non - uniform random numbers , it is a principle to facilitate and speed up other random number generating methods . the simple idea behind composition is to decompose the distribution @xmath34 as a weighted sum , @xmath35 with all @xmath36 normalised densities , and the weights @xmath37 a probability vector ( i.e. , all @xmath38 and @xmath39 ) . to generate a random @xmath15 from the distribution @xmath34",
    ", we first generate a random integer number @xmath40 from the discrete probability vector @xmath37 , and subsequently generate a random @xmath15 from the density @xmath41 .",
    "a prerequisite for this method to work is that , obviously , the decomposition can be done efficiently , and that the complexity of the problem is reduced by the decomposition .",
    "finally , a powerful technique that applies only to multivariate random number generation is the so - called conditional distribution method @xcite .",
    "it is based on the bayesian identity @xmath42 which expresses that a joint distribution of two variables can be calculated as the product of the marginal distribution of the former variable and the conditional distribution of the latter .",
    "expanding it to multiple dimensions , @xmath43 the beauty of this technique is that it reduces the multidimensional generation problem to a sequence of independent univariate generation problems .",
    "the main drawback is that it can only be used when much detailed information is known about the distribution @xmath34 . in particular , it is by far not always the case that marginal and conditional distributions are easily calculated in closed form .",
    "the standard textbook example of this technique is the multivariate cauchy distribution .",
    "skirt is a multi - purpose 3d monte carlo dust radiative transfer code that is mainly used to simulate dusty galaxies and active galactic nuclei .",
    "the code was designed as a highly modular software , with a particular consideration for the development of a flexible and easy user interface and the use of proven software design principles as described by .",
    "the skirt code offers a wealth of configurable features that are ready to use without any programming .",
    "in particular , the skirt code is equipped with a suite of input model components , the so - called classes , that can be used to represent distributions of either sources or sinks .",
    "essentially , the suite consists of a number of classes that all inherit from an abstract class , for which the c++ class interface looks like    .... class geometry {    public :      geometry ( ) ;      virtual ~geometry ( ) ;      virtual double density(position x ) const = 0 ;      virtual position generateposition ( ) const = 0 ; } ....    both the and functions are pure virtual functions , which means that each model in the suite should provide a routine that implements the ( normalised ) density @xmath1 , and a routine that generates random positions according to this density . for example , the interface of a concrete class that contains only a single parameter @xmath44 would look as follows    .... class concretegeometry : public geometry {    public :      concretegeometry(double p ) { _ p = p }      double density(position x ) const ;      position generateposition ( ) const ;    private :      double _ p ; } ....    for the design of this suite of input models , a naive option would be to provide a set of parameterised models that contain free parameters to control every possible option .",
    "a typical standard component of such a suite would be a very generalised plummer model , with free parameters setting the location of the centre , the orientation with respect to the coordinate system , the scales , the flattening describing potential triaxiality , possible degrees of clumpiness , etc .",
    "this approach has a number of strong disadvantages .",
    "clearly , it would quickly lead to an explosion of different options that is hard to overview .",
    "it would inevitably lead to substantial code duplication ( nearly all the code would need to copied if we would consider a hernquist profile instead of a plummer profile ) and code that is virtually impossible to maintain ( the code for all models would need to be updated if a new feature is added or altered ) . also concerning efficiency",
    ", such a design would not be optimal .",
    "indeed , a random position generating routine for such a generalised plummer model is hard to construct and is certainly much less efficient than the simple routine that is possible for a plain spherical plummer model ( using the inversion method ) .    to overcome these problems",
    ", we adopted a completely different approach that is much simpler but still provides the flexibility and functionality needed to set up complex models .",
    "this is achieved using a combination of simple base models on the one hand , and so - called decorator geometries on the other hand .",
    "decorator geometries are not real models on their own , but they apply modifications upon other models in interesting ways , following the _ decorator _ design pattern . in object - oriented programming ,",
    "a decorator attaches additional responsibilities to an object dynamically and provides a flexible and powerful alternative to subclassing for extending functionality @xcite .    in our present context",
    ", a decorator geometry is a special kind of geometrical model ( i.e. , it is also a c++ class in the general suite ) that takes one or more other components and adds a layer of complexity upon them .",
    "simple examples of decorators that can easily be implemented are the relocation of the centre of a given component , or the rotation of a given model with respect to the coordinate system .",
    "more complex decorators deform a spherical model to a triaxial one , or add a spiral perturbation to an axially symmetric model .",
    "the advantage of the decorator approach is clear : each decorator needs to be implemented only once , and can then be applied to any possible model .    in the following two sections we describe the building blocks in the skirt suite , and a number of decorator geometries that can alter these building blocks to more complex structures .",
    "the skirt suite contains a limited number of elementary input models , which can be used either as elementary toy models , or as building blocks for more complex geometries . for each of them",
    ", the density can be expressed as a simple analytical function , and the generation of random positions reduces to three independent univariate generation problems .",
    "apart from these analytical components , skirt also offers the possibility to set up components in which the geometry of sources and/or sinks is defined by means of particles or on a grid .",
    "in particular , skirt can import a snapshot from a ( magneto)hydrodynamical simulation .",
    "one obvious goal would be to post - process a hydrodynamical simulation in order to calculate the observable multi - wavelength properties of the simulated objects ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) . in this case",
    ", it would be sufficient to just read in the geometry of the snapshot as it is , and start the radiative transfer simulation .",
    "more generally , however , it would be useful if these numerical components would be at a similar level as the analytical components .",
    "this would open up the possibility to decorate them and combine them with other analytical and/or numerical components to more complex models .",
    "a first group consists of spherically symmetric models . in spherical symmetry",
    ", the generation of a random position from the 3d density @xmath45 simplifies to the generation of a random azimuth from a uniform distribution , a random polar angle from a sine distribution , and a random radius from the univariate density @xmath46 .",
    "the skirt suite includes the most popular models used to represent shells , star clusters , early - type galaxies , or galaxy bulges , such as a power - law shell model @xcite , the plummer model @xcite , the @xmath47-model @xcite , the srsic model , and the einasto model . within this family of models , many other famous profiles",
    "are contained , including the hernquist model @xcite , the jaffe model @xcite and the @xmath48-model @xcite .",
    "a second group of elementary input models consists of axisymmetric models in which the density is a separable function .",
    "the standard example with a density distribution separable in cylindrical coordinates is the double - exponential disc that is the de facto standard to represent disk galaxies in radiative transfer studies .",
    "how random positions can be drawn from this distribution is discussed in appendix  a of @xcite .",
    "an example of an axisymmetric model where the density is separable in spherical coordinates is the torus model that is often used to represent the dusty tori around stars or active galactic nuclei @xcite .",
    "the first group of numerical components in skirt are defined as a set of smoothed particles .",
    "this is mainly useful when we want to use the output of a smoothed particle hydrodynamics simulation . in spite of claims that the technique suffers from fundamental problems",
    "@xcite , it is still the most popular hydrodynamics technique , especially for cosmological simulations of galaxy formation ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "the output of an sph snapshot consists of a set of `` particles '' ( or rather anchor points in a co - moving grid ) , each characterised by a large suite of physical quantities .",
    "as far as skirt is concerned , most of these physical quantities are irrelevant .",
    "an component in skirt is essentially defined by a list of @xmath49 smoothed particles and the assumed smoothing kernel @xmath50 , with each smoothed particle characterised by a position @xmath51 , a fractional mass @xmath52 and a smoothing length @xmath53 . the total density at an arbitrary position @xmath15 is then given by @xmath54 in practice , the kernels used in sph simulations almost always have a finite support , and in this case only a relatively small number of terms in the sum have a non - zero contribution .",
    "the class in skirt employs smoothing kernel implementations optimised for each specific task .",
    "the geometry s density at a given location is calculated according to equation ( [ rho - sph ] ) using a finite - support cubic spline kernel , so that the operation can be limited to particles that potentially overlap the location of interest . to facilitate this process",
    ", the setup phase of the simulation places a rough grid over the spatial domain and constructs a list of overlapping particles for each grid cell . as described in section 3.3 of ,",
    "a further optimisation is provided to calculate the mass within a given box ( a cuboid lined up with the coordinate axes ) , as an alternative to sampling the density in various locations across the volume of the box . in this case",
    ", the calculation uses the analytical properties of a scaled and clipped gaussian kernel , designed to approximate the cubic spline kernel , to directly determine the mass in the box .",
    "this optimisation accelerates the density calculation for typical cartesian grids by an order of magnitude .    on the other hand ,",
    "the generation of random positions sampled from the geometry s density distribution is rather straightforward , thanks to the composition method .",
    "the first step is the choice of a random smoothed particle , based on a discrete distribution where each particle is weighted by its relative mass contribution .",
    "the second step is generating a random position according to the distribution of the chosen particle . the current implementation samples a random number from a gaussian smoothing kernel with infinite support using the inversion method .    in the future",
    "we may provide a suite of smoothing kernels , allowing the user to select the kernel that best fits the sph snapshot being imported .",
    "the methods used for calculating the density and generating a random radius would obviously depend on the actual shape of the kernel .",
    "in addition to what is described above , skirt has facilities to associate a spectral energy distribution with each sph star particle based on properties such as age and metallicity , or to associate a dust mass with each sph gas particle based on properties such as temperature and metallicity . in the former case",
    ", the geometry will weigh the particles by luminosity , for each wavelength separately , and in the latter case , the geometry will weigh the particles by dust mass .",
    "a detailed description of these features is beyond the scope of this paper .",
    "apart from smoothed particle hydrodynamics , the main other technique that is used to perform hydrodynamics simulations is eulerian mesh - based hydrodynamics @xcite .",
    "a fundamental ingredient of this technique is the use of grids with adaptive mesh refinement .",
    "eulerian amr simulations are used in virtually all fields of astrophysics , and monte carlo codes have been adapted to work directly on these hierarchical grids .",
    "the in skirt reads in snapshots defined by density fields discretised on hierarchical cartesian grids and converts them to the format of the other components in the skirt suite . calculating the density at an arbitrary position comes down to identifying the cell that contains this position and returning the density associated with that cell . as hierarchical grids have the structure of a tree , isolating the correct cell is a straightforward and computationally cheap operation . generating random positions from such",
    "a component is similar to the case of the smoothed particles , and is based on the composition method .",
    "we first generate a random cell from a discrete distribution where each cell is weighted by its relative mass . secondly",
    ", we determine a random position within the chosen cell ; as the cells in a hierarchical cartesian grids are cuboids , this is a trivial task .",
    "recently , a new lagrangian technique that solves the hydrodynamics equations on a moving , unstructured voronoi grid is gaining popularity . it is claimed to avoid some of the difficulties of smoothed particle hydrodynamics on the one hand and eulerian grid - based hydrodynamics on the other hand .",
    "this technique has been used for many years in the computational fluid dynamics community @xcite , and a number of novel codes based on this principle have recently been developed in the astrophysics community @xcite . moving mesh hydrodynamics",
    "is mainly applied to simulations of galaxy formation and evolution ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "skirt contains a class that converts a snapshot from a voronoi hydrodynamical simulation ( or any other density field defined on a voronoi grid ) to a regular skirt component . due to the nature of a voronoi grid ,",
    "the only necessary input is the list of all the generating sites and the associated densities ; it is hence not necessary to store all the vertices and sides of each of the cells .",
    "based on the generating sites , skirt constructs the corresponding unique voronoi grid using the public voro++ library @xcite .",
    "the density routine essentially works in the same way as for the case of the hierarchical grids : it comes down to identifying the cell that contains the given position and returning the density associated to this cell . in the case of a voronoi grid",
    ", however , the cell identification is not as simple as in a hierarchical tree structure of cartesian grid cells . due to the nature of voronoi grids , this is essentially a nearest neighbour search . rather than looping over all possible sites , skirt implements an approach using cuboidal blocks , as explained in detail in .",
    "this task could be optimised even further using more advanced techniques based on space partitioning structures such as @xmath40-d trees or r - trees @xcite .",
    "also the generation of random positions works essentially in the same way as for hierarchical grids .",
    "the first step is identical : we generate a random cell from a discrete distribution where each cell is weighted by its relative mass contribution .",
    "the second step , generating a random position from within the chosen cell , is significantly more complex than in the case of a cuboidal cell . to the best of our knowledge ,",
    "there are no dedicated techniques to generate a random point from a voronoi cell .",
    "there are two possible options .",
    "the first option is to partition the cell into a set of tetrahedra , subsequently select a random tetrahedron from a discrete distribution where every tetrahedron is weighted by its relative volume , and finally generate a random position from the selected tetrahedron .",
    "specific algorithms are available for both the tetrahedrisation of convex polyhedra @xcite and the generation of random positions from a tetrahedron @xcite .    the second option , which is more simple and which we have adopted in skirt , is to use the rejection technique . as the reference distribution",
    "we use a uniform density in a cuboidal volume , defined as the 3d bounding box of the cell . as voronoi cells",
    "are convex polyhedra , this bounding box is directly obtained when the vortices of the cell are known ( these are calculated using the voronoi grid setup ) .",
    "extensive testing has shown that , depending on the distribution of the generating voronoi sites , the average ratio of the volume of the bounding box of a voronoi cell over the actual cell volume is about 3 to 4 .",
    "this ratio immediately represents the average rejection rate for the random position generation .",
    ".an overview of the geometry decorators currently implemented in skirt , referencing the section in which they are presented .",
    "geometry decorators can be applied to basic geometry building blocks , and can be chained and combined to create complex structures . [ cols= \" < , < ,",
    "< \" , ]     in this section we describe a number of decorator geometries that can be applied on the building blocks described in the previous section in order to convert them to more complex structures ; see table  [ decorators.tab ] for an overview .",
    "the implementation of the density of a decorator geometry is usually not a major problem ; the main challenge is to implement the routine that generates random positions from a decorator geometry , so this is what we focus on .",
    "the decorator in skirt applies an arbitrary offset @xmath55 to any density distribution .",
    "if the original density is @xmath56 , the new density is simply @xmath57 .",
    "generating random positions is equally simple : we generate a random @xmath13 from the original density distribution and return @xmath58 .",
    "the c++ implementation of the class in skirt looks like :    .... class offsetgeometrydecorator : public geometry {    public :      offsetgeometrydecorator(geometry * g , position a )         { _ g = g ; _ a = a ; }      double density(position x ) const         { return _ g->density(x - a ) ; }      position generateposition ( ) const         { return _ g->generateposition()+a ; }    private :      geometry * _ g ;      position _ a ; } ....      similarly , the decorator rotates any density distribution .",
    "if the rotation is characterised by the orthonormal matrix @xmath23 , the new density is @xmath59 . to generate a random position from this new density ,",
    "we generate a random @xmath13 from the original density and rotate it over the inverse rotation matrix , i.e. @xmath60 .",
    "a third simple decorator , the , carves out a cavity from another density @xmath56 . in formula form",
    ", we have @xmath61 with @xmath62 the fraction of the mass of the original density located in the cavity .",
    "this decorator is useful to represent density distributions of dust close to a star or active galactic nucleus , where the dust has been cleared due to sublimation . to generate random positions from this new density distribution",
    ", we just generate a random position from the original density distribution and reject is when it is located in the cavity .",
    "this is , in fact , an almost trivial application of the rejection technique , where the original density assumes the role of the reference function , and the rejection constant is @xmath63 .",
    "the combines two density distributions into a single distribution according to @xmath64 with @xmath65 the original distributions and @xmath66 their respective weights in the composite distribution . generating random positions for this new density distribution is a trivial application of the composition method .      as a first more complex decorator",
    ", we consider the case of a triaxial decorator geometry , which converts a spherically symmetric density distribution into one that is stratified on concentric and confocal ellipsoids .",
    "more concretely , assume that we have a spherically symmetric density distribution @xmath67 , we then consider its triaxial counterpart @xmath68 such triaxial models are discussed and used extensively to describe the stellar distribution of elliptical galaxies and galactic nuclei and the shape of galactic haloes ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "oblate and prolate spheroidal distributions are just a special case of these triaxial models in which @xmath69 .",
    "it is clear that the density ( [ tri : density ] ) can not be written as a product of independent univariate density distributions .",
    "we can use the conditional distribution method . in order to develop a general recipe for generating random positions ,",
    "we start by rewriting the probability distribution according to  ( [ tri : density ] ) in spherical coordinates , @xmath70 according to formula  ( [ cdm ] ) , we now rewrite this expression as @xmath71 after some calculation , one finds for the marginal distribution for @xmath72 the simple expression @xmath73 note that this marginal distribution is independent of the specific shape of the density profile and only depends on the flattening parameter @xmath44 ( and for @xmath69 , it reduces to a simple uniform distribution , as expected for a spheroidal distribution ) . generating a random azimuth from this density can be done using the standard inversion method ; the corresponding cumulative distribution is @xmath74 and is readily inverted .",
    "once this random @xmath72 has been determined , we can generate a random polar angle @xmath75 from the conditional distribution @xmath76 where we have set @xmath77 .",
    "also this distribution is independent of the specific shape of the density profile and only depends on the flattening parameters @xmath44 and @xmath78 ( and the already randomly determined azimuth ) .",
    "again , generating a random polar angle from this distribution can be done using the standard inversion method : the corresponding cumulative distribution is @xmath79 and is again readily inverted .",
    "finally , we consider the conditional distribution for @xmath80 , @xmath81 if we apply a linear transformation from @xmath80 to @xmath82 the corresponding density for @xmath83 is simply @xmath84 which is nothing but the distribution for a random radius from the original density @xmath56 .",
    "the last step in the generation of a random position is to generate a random position @xmath13 from the original spherical density distribution @xmath56 , and transform the radius @xmath85 of this position to a new radius @xmath80 using the linear transformation  ( [ mr ] ) , in which we use the previously determined values for @xmath75 and @xmath72 .",
    "while this method based on conditional probabilities has a certain beauty , there is , actually , a simpler and more efficient method that is based on the inversion method . indeed , consider the simple transformation @xmath86 or in matrix format @xmath87 according to the law of linear transformations ( [ transfmethodlin ] ) , if @xmath13 is distributed according to the spherical density @xmath56 , @xmath15 will be distributed exactly according to the triaxial density  ( [ tri : density ] ) . an easy way to generate random positions from a triaxial counterpart of a spherical symmetric density is thus simply generating a random position @xmath13 from the spherical density distribution , from which the desired position can easily be calculated as @xmath60 .      as a second complex decorator ,",
    "we consider a logarithmic spiral arm perturbation that can be applied to any axisymmetric density distribution ,    [ spiral ] @xmath88\\ ] ] where @xmath89 are the usual cylindrical coordinates , and the function @xmath90 is defined as @xmath91 \\label{perturbation}\\ ] ]    the factor @xmath92 is a normalisation constant that guarantees that the density is normalised , and is given by @xmath93 this general spiral arm perturbation is a generalisation of the models used by and @xcite , and allows for an arbitrary number of arms @xmath94 , pitch angle @xmath44 , spiral perturbation weight @xmath95 , and arm - interarm size ratio ( controlled by the parameter @xmath49 ) .",
    "for @xmath96 the density reduces to a more simple perturbation with equal arm - interarm size ratio , @xmath97 \\right\\}\\ ] ] for the general 3d density distribution ( [ spiral ] ) , we can again use the conditional distribution method , and write @xmath98 since the spiral perturbation is such that it averages out along every single circle around the @xmath99-axis , i.e. , @xmath100 we trivially find @xmath101 this is exactly the 2d probability density distribution that corresponds to the density of the axisymmetric density distribution .",
    "we hence simply generate a random position @xmath15 from our original density distribution and save the radius @xmath102 and the height @xmath99 . in order to generate a random azimuth @xmath72",
    ", we consider the conditional distribution @xmath103 , for which we find directly @xmath104 this univariate density is independent of the shape of the original axisymmetric density profile ; it only depends on the parameters of the spiral perturbation and randomly determined radius @xmath102 . for the general expression  ( [ perturbation ] ) , the standard inversion technique is not easily applicable ; the cumulative distribution corresponding to the density  ( [ spiral : pdf ] ) can be calculated analytically , but the resulting expression can not be inverted analytically .",
    "one could resort to a numerical inversion , but a better approach is to use the rejection technique .",
    "we can use a simple uniform density as the reference distribution , @xmath105 .",
    "the rejection constant @xmath26 should ideally be chosen as the smallest value for which @xmath106 for all values of @xmath72 .",
    "since the maximum value of the perturbation function @xmath90 is @xmath92 , we find @xmath107 actually , as an alternative to the conditional probability technique , we could also simply have used the rejection technique from the beginning .",
    "the 3d density @xmath1 satisfies the condition @xmath108 , so if we simply use the original density @xmath109 as our reference distribution , we have essentially the same algorithm with the same rejection constant . the difference between this 3d rejection technique and the previous version , where we used the rejection technique only for the conditional distribution for the azimuth ,",
    "is a matter of efficiency . in the former version",
    "only one random position needs to be generated from the original density , and it the rejection is only to determine the azimuth . in the latter version ,",
    "an entirely new position is generated for every rejection , which is less efficient .",
    "as a last example , we consider the class that turns any density distribution @xmath56 into a clumpy analogue , i.e. , a density distribution in which a fraction of the mass is distributed `` smoothly '' as in the original density distribution , and the remaining fraction is locked up into compact clumps . the density of this distribution can be written as @xmath110 where @xmath111 is the fraction of the mass in clumps , @xmath49 is the number of clumps , and the positions @xmath112 are the central positions of the @xmath49 clumps , determined randomly according to the original density function @xmath113 .",
    "the function @xmath50 is the smoothing function that sets the distribution of matter within every single clump , with @xmath114 a characteristic length scale .",
    "this can in principle be any spherical 3d distribution ; in practice we use either a uniform density sphere or one of the compact support kernels that are used in smoothed particle hydrodynamics simulations .",
    "it is straightforward to generate random positions from this distribution .",
    "it is a direct application of the composition method , and the case is very similar to smoothed particle building blocks discussed in section  [ sph.sec ] .",
    "as indicated in section  [ geometrysetup.sec ] , a major advantage of the decorator - style approach is that each decorator needs to be implemented only once , and can then be applied to different models .",
    "this avoids the need to implement complex geometries with many different possible features and heavy code duplication . that alone is already an argument strong enough to justify its use .",
    "another strong advantage is the flexibility offered by this approach .",
    "the decorators discussed in section  [ decorators.sec ] transform an input model into a more complex model .",
    "such a decorated model is often still relatively simple : it typically adds one layer of complexity onto the model that is being decorated ( think of a rotated exponential disc or a triaxial srsic model ) . if we want to generate toy models that can be used as idealised representations of , for example , a spiral galaxy , various layers of complexity have to be added .",
    "the decorator - style approach is ideal for this purpose : decorators can be applied also to models that have already been decorated . in other words , decorators can easily be chained or nested .",
    "the left - hand panel of figure  [ chaineddecorators.fig ] shows a projected image of a relatively complex toy model , constructed using the suite in skirt .",
    "the model consists of a bulge component and a clumpy spiral disc .",
    "each of these two components have a very simple spherical @xmath47-model as their starting point , on which a chain of decorators was applied .",
    "the former was first decorated into a triaxial model , the latter was turned into an axisymmetric disc by applying a very strong flattening , then a spiral perturbation was added , and a fraction of its mass was turned into clumps .    in decoration chains the successive decorators do not necessarily need to be different .",
    "it is also possible to chain the same decorator several times , i.e.  to apply them recursively .",
    "a powerful example of this nesting is a repeated application of the .",
    "the right - hand panel of figure  [ chaineddecorators.fig ] shows an application of this principle on a simple triaxial plummer model . in this case , we have applied four nested applications of the decorator , in which the number of clumps increases in each level , whereas the smoothing length decreases .",
    "this algorithm results in a fractal density distribution that is self - similar over an order of magnitude in scale @xcite .",
    "the possibility to chain decorators , including a repeated application of the same decorator , facilitates the construction of very complex models out of simple building blocks .",
    "analytical components can easily be combined with numerical components based on smoothed particles or grids , and decorators can be applied regardless of the underlying component type .",
    "it is , for example , possible to add a smooth triaxial bulge to an irregular disc structure defined using sph particles , or to carve out a cavity from a complex hydrodynamics system and locate a small nuclear structure there to simulate the effects of an agn on the large - scale structure of a galaxy .",
    "one could argue that the setup that we have chosen is unnecessarily complex .",
    "an alternative approach would be a design where we only provide the density for each component in the suite , and where the generation of random positions is executed by a generic routine rather than a geometry - specific routine for each component .",
    "such a suite could still use the decorator design pattern , but would be simpler to implement .",
    "the main challenge is the design of a generic routine that can generate random positions corresponding to an arbitrary 3d density function .",
    "this is in principle possible : there are a few multivariate black - box random number generation libraries available , including foam @xcite and ranlip @xcite , based on the so - called composition - rejection method , a combination of the composition and rejection methods . in a first phase , the exploration phase , the domain of a distribution is partitioned into different cells . in the generation phase , the rejection technique is used on each cell , where typically a constant density function is used as the reference distribution .",
    "the advantages of this approach are that , in principle , it can be applied for all distributions and in any dimension , and that only the density of each component is required .",
    "the main disadvantage is the complexity and the overhead , both in memory and run - time , that are linked to the exploration phase .    in order to test",
    "whether or not our design choice of providing a customised random position generator for each concrete class ( and for each decorator , in particular ) is justified , we have set up a comparison between our routines and a generic black - box routine .",
    "we have implemented a new decorator class , , that replaces the model - specific random position generator by a generic routine based on the foam library .",
    "foam is a self - adapting cellular code that uses iterative binary splitting , using either simplexes or hyper - rectangles , to subdivide the configuration space .",
    "we set up a simple suite of test models , for which we generate random positions using both the model - specific generator and the generic foam generator .",
    "our suite consists of a sequence of models with an increasing level of complexity .",
    "it essentially follows the different steps in building the model shown in the left panel of figure  [ chaineddecorators.fig ] .",
    "the following models are considered    1 .   a spherical @xmath115 model , 2 .   model # 1 flattened to an axisymmetric disc , 3",
    ".   model # 2 with spiral perturbation , 4 .   model # 3 with a fraction turned into clumps , 5 .",
    "model # 4 with a triaxial @xmath115 bulge added .    for each model",
    ", we generate @xmath116 random positions ( we do not use any photon propagation or detection as would be used in monte carlo radiative transfer simulation in order to isolate the random position generation process ) .",
    "the timings were done using a single core and with averages over multiple test runs .",
    "one crucial aspect for the foam - based generator is the choice of the foam parameters , in particular of the number of cells in the grid",
    ". a larger number of cells implies a higher computational cost of the exploration phase on the one hand , but a better approximation of the density and smaller rejection rates .",
    "the ideal choice of this parameter is impossible to determine in a general way .",
    "we consider 5 different values for the number of cells in the foam for every model , ranging from 25,000 to 400,000 .",
    "the results are illustrated in fig .",
    "[ timings.fig ] , where , for each model , we give the total run time and the contributions for the setup of the foam and the actual time spent on generating the random positions .    a first major conclusion that can be drawn from these results is the efficiency of the customised random position generation routines . from a simple spherical model , to a complex model composed of two components that both have been decorated multiple times , the computational cost increases only by a factor two . moving from a spherical to a triaxial model does not affect the efficiency of the generation of random positions at all ( not a surprise , as it just implies two simple multiplications , as shown in section  [ triaxial.sec ] ) .",
    "the biggest jump in timing occurs when spiral structure is added to the model ( i.e. , from model # 2 to # 3 ) , because the random position generation is based on the rejection method , which has more overhead compared to the inversion and composition methods .",
    "the addition of clumping ( from model # 3 to # 4 ) hardly implies an increase in computation time .",
    "note that the addition of a bulge even decreases the computation time . in model # 5 half of the positions",
    "are generated according to the density of the relatively simple triaxial bulge , whereas in model # 4 they all are generated according to the more complex clumpy spiral structure .",
    "a second major conclusion is that the generic foam - based random position generator is significantly less efficient than the customised generator . for the most simple models ( # 1 and # 2 ) ,",
    "the difference in speed is a factor 38 , depending on the number of cells used .",
    "the increase in total run time for the foam - based models with increasing number of cells is mainly due to the time necessary to set up the foam .",
    "the time necessary to generate the random positions also increases , but not as strongly .        for the more complex models ,",
    "the efficiency of the foam - based generator decreases even more .",
    "the biggest jump in timing now occurs when we add clumping to the model , because the calculation of the density for the clumpy models is computationally very demanding ( each density evaluation requires a sum over a large number of clumps ) . for models # 4 and 5 , the foam - based generators are at least an order of magnitude slower than the customised routines .",
    "interestingly , the run time of these simulations does not increase with the number of cells . for simulations with few cells ,",
    "the setup phase is relatively quick , but the generation phase is very inefficient .",
    "the reason is that the cells are relatively large with a strong variation in density values , and hence the rejection rates are uncomfortably large .",
    "if the number of cells in the grid increases , the setup time naturally increases , but the actual position generation becomes more efficient because the average rejection rates are smaller .",
    "moreover , the inefficiency of the foam - based generator is not the only problem , but also accuracy is an issue , in particular for complex models with multiple local maxima and strong gradients , such as models # 4 and # 5 .",
    "if the number of cells is limited and the cells hence rather large , both the total mass and the local maximum within a cell are very hard to guess ( they are determined by random sampling the cell ) . as a result ,",
    "both the relative weights of the different cells and the rejection constants within the individual cells are poorly determined .",
    "this will lead to an artificial smoothing and wrong results .",
    "figure  [ genericversusfoam.fig ] shows a sequence of images corresponding to model # 4 , created using the customised random position generator ( top left ) and using the foam - based one with different values for the number of cells ( remaining panels ) .",
    "the customised generator generates an image that reveals all the details that are expected , including the sharp density gradients and the contrast between arm and interarm regions .",
    "the only limitation in the image is the finite resolution due to the pixel size and the unavoidable poisson noise .",
    "the foam images on the other hand show a clear signature of degradation that gradually decreases when the number of cells grows .",
    "for the grids with 25,000 and 50,000 cells , and even for the one with 100,000 cells , the effects of the grid are clearly visible , and the individual clumps and the spiral structure are insufficiently resolved . for the grid with 400,000 cells , the individual clumps are well resolved , but the sharpness of the spiral arms is still under - resolved , especially in the central regions .    since both the accuracy and the efficiency of the generic foam - based random position generator can not compete with the customised versions , we conclude that it is worth investing in the latter , and that our design choice is justified .",
    "we have described the design of a suite of components that can be used to model the distribution of sources and sinks in the monte carlo radiative transfer code skirt .",
    "our main conclusions are the following :    * the availability of a well - designed suite of input models , with enough variety and different degrees of complexity , in a publicly available monte carlo code has a strong added value .",
    "such models can serve as toy models to test new physical ingredients , or as parameterised models for inverse radiative transfer fitting .",
    "they also provide a low - threshold introduction to new users , since models with differing degrees of complexity can be run without any coding at all . *",
    "each model is in principle completely determined by the 3d density distribution @xmath1 . in order to be used in monte carlo radiative transfer , however , each model should contain a routine that generates random numbers according to this @xmath1 .",
    "finding the most suitable algorithm to implement this is the most challenging aspect of the design of a suite of input models . *",
    "the design of the skirt suite is based on a combination of basic building blocks and the extensive use of decorators .",
    "the building blocks can either be simple analytical components , or they can be numerical components defined as a set of smoothed particles or on a hierarchical or unstructured voronoi grid .",
    "the decorators combine and alter these building blocks to more complex structures . *",
    "the different multivariate random number generation techniques that exist in the specialised numerical analysis literature can be used to efficiently implement complex decorators , for example those that add triaxiality , spiral structure or clumpiness to other models .",
    "decorators can be chained without problems and essentially without limitation .",
    "different layers of complexity can hence be added one by one .",
    "the result is that very complex models can easily be constructed out of simple building blocks , without any coding at all .",
    "* from the software design point of view , decorators have many advantages , including code transparency , the avoidance of code duplication , and an increase in code maintainability .",
    "this is a clear example that adhering to proven software design principles pays off , even for small and mid - sized projects . *",
    "finally , we demonstrate that our design using customised random position generators is superior to a simpler suite design based on a generic black - box random position generator . using a suite of test simulations with increasing complexity",
    "we demonstrate that our customised random number generators are more accurate and more efficient .",
    "this work fits in the charm framework ( contemporary physical challenges in heliospheric and astrophysical models ) , a phase vii interuniversity attraction pole ( iap ) program organised by belspo , the belgian federal science policy office .",
    "the authors thank ilse de looze and sbastien viaene for their careful reading of a draft version of this paper , and all skirt users for their feedback , which has led to many improvements and additions to the code .        , o. , moore , b. , stadel , j. , potter , d. , miniati , f. , read , j. , mayer , l. , gawryszczak , a. , kravtsov , a. , nordlund ,  . , pearce , f. , quilis , v. , rudd , d. , springel , v. , stone , j. , tasker , e. , teyssier , r. , wadsley , j. , walder , r. , 2007 .",
    "fundamental differences between sph and grid methods . mon . not .",
    "r. astron .",
    "380 , 963978 .    ,",
    "m. , davies , j.  i. , dejonghe , h. , sabatini , s. , roberts , s. , evans , r. , linder , s.  m. , smith , r.  m. , de blok , w.  j.  g. , 2003 .",
    "radiative transfer in disc galaxies - iii .",
    "the observed kinematics of dusty disc galaxies . mon . not .",
    "r. astron .",
    "343 , 10811094 .",
    ", m. , fritz , j. , gadotti , d.  a. , smith , d.  j.  b. , dunne , l. , da cunha , e. , amblard , a. , auld , r. , bendo , g.  j. , bonfield , d. , burgarella , d. , buttiglione , s. , cava , a. , clements , d. , cooray , a. , dariush , a. , de zotti , g. , dye , s. , eales , s. , frayer , d. , gonzalez - nuevo , j. , herranz , d. , ibar , e. , ivison , r. , lagache , g. , leeuw , l. , lopez - caniego , m. , jarvis , m. , maddox , s. , negrello , m. , michaowski , m. , pascale , e. , pohlen , m. , rigby , e. , rodighiero , g. , samui , s. , serjeant , s. , temi , p. , thompson , m. , van der werf , p. , verma , a. , vlahakis , c. , 2010 .",
    "herschel - atlas : the dust energy balance in the edge - on spiral galaxy ugc 4754 .",
    "astroph .",
    "518 , l39 .      ,",
    "m. , verstappen , j. , de looze , i. , fritz , j. , saftly , w. , vidal prez , e. , stalevski , m. , valcke , s. , 2011 .",
    "efficient three - dimensional nlte dust radiative transfer with skirt .",
    "j. suppl .",
    "196 , 22 .                              ,",
    "g. , baes , m. , camps , p. , fritz , j. , de looze , i. , hughes , t.  m. , viaene , s. , gentile , g. , 2014 . the distribution of interstellar dust in califa edge - on galaxies via oligochromatic radiative transfer fitting . mon . not",
    "r. astron .",
    "441 , 869885 .        , i. , fritz , j. , baes , m. , bendo , g.  j. , cortese , l. , boquien , m. , boselli , a. , camps , p. , cooray , a. , cormier , d. , davies , j.  i. , de geyter , g. , hughes , t.  m. , jones , a.  p. , karczewski , o.   . ,",
    "lebouteiller , v. , lu , n. , madden , s.  c. , rmy - ruyer , a. , spinoglio , l. , smith , m.  w.  l. , viaene , s. , wilson , c.  d. , 2014 .",
    "high - resolution , 3d radiative transfer modeling .",
    "i. the grand - design spiral galaxy m51 .",
    "astroph .",
    "571 , a69 .",
    "desbrun , m. , gascuel , m .-",
    "smoothed particles : a new paradigm for animating highly deformable bodies . in : proceedings of the eurographics workshop on computer animation and simulation 96 .",
    ". 6176 .                      , b. , olson , k. , ricker , p. , timmes , f.  x. , zingale , m. , lamb , d.  q. , macneice , p. , rosner , r. , truran , j.  w. , tufo , h. , 2000 .",
    "flash : an adaptive mesh hydrodynamics code for modeling astrophysical thermonuclear flashes .",
    "j. suppl .",
    "131 , 273334 .        , g.  l. , danese , l. , 1994 .",
    "thick tori around active galactic nuclei - a comparison of model predictions with observations of the infrared continuum and silicate features .",
    "mon . not .",
    "r. astron . soc .  268 , 235252 .                                                      ,",
    "c. , popescu , c.  c. , tuffs , r.  j. , 2006 . modelling the spectral energy distribution of galaxies .",
    "iv . correcting apparent disk scalelengths and central surface brightnesses for the effect of dust at optical and near - infrared wavelengths .",
    "astroph .",
    "456 , 941952 .",
    "mller , m. , charypar , d. , gross , m. , 2003 .",
    "particle - based fluid simulation for interactive applications . in : proceedings of the 2003 acm siggraph / eurographics symposium on computer animation .",
    ". 154159 .      , i. , wolf , s. , steinacker , j. , dullemond , c.  p. , henning , t. , niccolini , g. , woitke , p. , lopez , b. , 2004 .",
    "the 2d continuum radiative transfer problem .",
    "benchmark results for disk configurations .",
    "astroph .",
    "417 , 793805 .        ,",
    "c. , harries , t.  j. , min , m. , watson , a.  m. , dullemond , c.  p. , woitke , p. , mnard , f. , durn - rojas , m.  c. , 2009 .",
    "benchmark problems for continuum radiative transfer .",
    "high optical depths , anisotropic scattering , and polarisation .",
    "astroph .",
    "498 , 967980 .                      ,",
    "m. , wada , k. , prieto , m.  a. , burkert , a. , tristram , k.  r.  w. , 2014 .",
    "time - resolved infrared emission from radiation - driven central obscuring structures in active galactic nuclei .",
    "mon . not .",
    "r. astron .",
    "445 , 38783891 .    ,",
    "j. , crain , r.  a. , bower , r.  g. , furlong , m. , schaller , m. , theuns , t. , dalla vecchia , c. , frenk , c.  s. , mccarthy , i.  g. , helly , j.  c. , jenkins , a. , rosas - guevara , y.  m. , white , s.  d.  m. , baes , m. , booth , c.  m. , camps , p. , navarro , j.  f. , qu , y. , rahmati , a. , sawala , t. , thomas , p.  a. , trayford , j. , 2015 .",
    "the eagle project : simulating the evolution and assembly of galaxies and their environments .",
    "mon . not .",
    "r. astron .",
    "soc .  446 , 521554 .                , m. , fritz , j. , baes , m. , nakos , t. , popovi , l.  v c. , 2012 .",
    "3d radiative transfer modelling of the dusty tori around active galactic nuclei as a clumpy two - phase medium .",
    "mon . not .",
    "r. astron .",
    "420 , 27562772 .        , j.  m. , norman , m.  l. , 1992 .",
    "zeus-2d : a radiation magnetohydrodynamics code for astrophysical flows in two space dimensions .",
    "i - the hydrodynamic algorithms and tests . astrophys . j. suppl .",
    "80 , 753790 .      ,",
    "i. , asensio ramos , a. , rubio - martn , j.  a. , graham , a.  w. , aguerri , j.  a.  l. , cepa , j. , gutirrez , c.  m. , 2002 .",
    "triaxial stellar systems following the r@xmath119 luminosity law : an analytical mass - density expression , gravitational torques and the bulge / disc interplay .",
    "mon . not .",
    "r. astron . soc .",
    "333 , 510516 .    ,",
    "r.  c.  e. , van de ven , g. , verolme , e.  k. , cappellari , m. , de zeeuw , p.  t. , 2008 .",
    "triaxial orbit based galaxy models with an application to the ( apparent ) decoupled core galaxy ngc 4365 .",
    "mon . not .",
    "r. astron .",
    "385 , 647666 .      , m. , genel , s. , springel , v. , torrey , p. , sijacki , d. , xu , d. , snyder , g. , nelson , d. , hernquist , l. , 2014 .",
    "introducing the illustris project : simulating the coevolution of dark and visible matter in the universe .",
    "mon . not .",
    "r. astron .",
    "444 , 15181547 ."
  ],
  "abstract_text": [
    "<S> the monte carlo method is the most popular technique to perform radiative transfer simulations in a general 3d geometry . </S>",
    "<S> the algorithms behind and acceleration techniques for monte carlo radiative transfer are discussed extensively in the literature , and many different monte carlo codes are publicly available . on the contrary </S>",
    "<S> , the design of a suite of components that can be used for the distribution of sources and sinks in radiative transfer codes has received very little attention . </S>",
    "<S> the availability of such models , with different degrees of complexity , has many benefits . </S>",
    "<S> for example , they can serve as toy models to test new physical ingredients , or as parameterised models for inverse radiative transfer fitting . for 3d monte carlo codes </S>",
    "<S> , this requires algorithms to efficiently generate random positions from 3d density distributions .    </S>",
    "<S> we describe the design of a flexible suite of components for the monte carlo radiative transfer code skirt . </S>",
    "<S> the design is based on a combination of basic building blocks ( which can be either analytical toy models or numerical models defined on grids or a set of particles ) and the extensive use of decorators that combine and alter these building blocks to more complex structures . for a number of decorators , </S>",
    "<S> e.g.  those that add spiral structure or clumpiness , we provide a detailed description of the algorithms that can be used to generate random positions . </S>",
    "<S> advantages of this decorator - based design include code transparency , the avoidance of code duplication , and an increase in code maintainability . </S>",
    "<S> moreover , since decorators can be chained without problems , very complex models can easily be constructed out of simple building blocks . </S>",
    "<S> finally , based on a number of test simulations , we demonstrate that our design using customised random position generators is superior to a simpler design based on a generic black - box random position generator </S>",
    "<S> .    radiative transfer  methods : numerical  designing software  design patterns </S>"
  ]
}