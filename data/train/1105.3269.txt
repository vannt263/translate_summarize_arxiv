{
  "article_text": [
    "radiative transfer ( rt ) of photons has fundamental importance for formation of astronomical objects , such as galaxies , stars , and blackholes .",
    "unfortunately , the nature of rt , in which we have to solve the time evolution of the six - dimensional phase - space information of photons ( three spatial dimensions , two angular dimensions , and one frequency dimension ; or equivalently three spatial and three momentum dimensions ) , makes it difficult to solve rt accurately and to couple it with hydrodynamics . to date , various rt schemes has been proposed @xcite , some of which are coupled with hydrodynamics @xcite . a wide range of approximation",
    "have been used to deal with multi - dimensional nature of the transfer equation and they have their own pros and cons .",
    "when radiation sources are embedded in media on meshes , rt calculations can be categorised into two types ; one premises that the source functions are assigned on meshes and the other does that radiation sources are treated as point sources independent of meshes . in the former type , the rt equations are integrated along long or short characteristics between meshes .",
    "the latter is advantageous when the number of the point sources , @xmath4 , is smaller than that of the boundary meshes , @xmath6 , where @xmath3 is the total number of the meshes .",
    "the latter type of the rt schemes is often called ` ray - tracing ' that we deal with in this paper .",
    "the most accurate and straight - forward rt scheme is the long characteristics method in which all source meshes are connected to all other relevant meshes @xcite .",
    "this method is however very expensive computationally .",
    "the computational costs scales with @xmath7 in general and with @xmath8 for the transfer from point sources .",
    "the short characteristics method @xcite reduces the computational cost by integrating the equation of rt only along lines that connect nearby cells .",
    "it scales with @xmath9 and with @xmath10 for the transfer from point sources .",
    "its known disadvantage is the inability to track collimated radiation fields and hence the inability to cast sharp shadows owing to the numerical diffusion .",
    "the methods whose computational cost is similar to that of the short characteristics method with small loss of accuracy compared to the long characteristics method have also been developed ( @xcite and ` authentic rt ' by nakamoto et al . in @xcite ) .",
    "adaptive ray tracing @xcite has been widely used for rt around point sources @xcite .",
    "mote carlo transport @xcite is also straight forward .",
    "the advantage of this approach is that comparatively few approximations to the rt equations need to be made .",
    "the resulting radiation field however inevitably becomes noisy ( see * ? ? ?",
    "* ) due to its stochastic nature unless a huge number of photon packets are transported .",
    "this method is computationally very expensive in the optically thick regime .    the methods , which consider the moments of the rt equations and consist in choosing a closure relation to solve them , can lead to substantial simplifications that can drastically speed up the calculations because its computational cost scales with @xmath11 .",
    "the most common of these methods is the flux - limited diffusion , which solves the evolution of the first moment and uses a closure relation valid in the diffusion limit , which is an isotropic radiative pressure tensor .",
    "the equation is modified with an ad - hoc function ( the flux limiter ) in order to ensure that the radiative flux is valid in the free - streaming limit .",
    "this method is very useful in diffusive regions and have been used to study accretion discs @xcite and star formation @xcite .",
    "another method of closing the system is the variable eddington tensor formalism .",
    "it gives better results than the flux - limited diffusion but are much more complex and costly because it requires the local resolution of the transfer equation at each timestep .",
    "the methods which employ the optically thin variable eddington tensor approximation @xcite have been used to study cosmic reionization @xcite .",
    "a locally evaluated eddington tensor , called the m@xmath12 model , has also been used to close the system @xcite and has applied to study cosmic reionization @xcite .",
    "the accuracy of the moments methods is problem - dependent and is hard to judge in general situation . @xcite",
    "have developed a method that employs a direct discretisation of the rt equation in boltzmann form with finite angular resolution on moving meshes .",
    "this method is advantageous in solving problems in which time - dependent solution of the rt equation is important .",
    "the timestep however has to be very short because photons propagate at the speed of light unless a reduced speed of light approximation is employed .",
    "in many astrophysical problems , for example cosmic reionization and galaxy formation , we have to deal with numerous radiation sources .",
    "@xcite introduced source merging procedure in order to avoid computationally expensive scaling with the number of sources and implemented it on smoothed particle hydrodynamics ( sph ) .",
    "@xcite utilised the oct - tree algorithm @xcite in order to accelerate the rt around point sources and they coupled the rt with sph . in their method , distant sources from a target gas particle are grouped and regarded as a single point source when the angular size of the group of the sources is smaller than a critical value . consequently , the effective number of radiation sources is largely reduced to @xmath13 when there are @xmath4 sources .",
    "the methods we explore in this paper are parallel to this approach except that we implement this grouping algorithm to grid - based codes . in one of our methods ,",
    "we introduce supermeshes ; a supermesh consists of @xmath14 meshes and it is characterised by the mean density of each chemical species of the meshes within the supermesh .",
    "solving the rt on supermeshes whose angular size is similar to that of the group of the sources in question results in further reduction of computational time in principle .",
    "another approach we take is the point source approximation , in which a group of sources sufficiently distant from a target mesh is treated as a point source .",
    "the latter can be regarded as a grid - based version of start @xcite .    unlike gravitational interactions",
    "to which the tree - algorithm has been widely applied , rt is affected by the medium between a source and a target .",
    "it is therefore very important to test these tree - based approaches in cases where an extended group of sources works as a powerful source in inhomogeneous medium and affects ( e.g. ionizes ) distant meshes . in this paper , we extensively investigate such cases in order to clarify advantages and disadvantages of the methods using tree - based algorithm .    this paper is organised as follows . in section 2",
    ", we describe the algorithm in detail . in section 3 ,",
    "we present several test problems and compare our methods to each other .",
    "we summarise and discuss the results in section 4 .",
    "in this section , we describe our ray - tracing algorithm that we use to solve the steady rt equation for a given frequency , @xmath15 : @xmath16 where @xmath17 , @xmath18 , and @xmath19 are the specific intensity , the optical depth , and the source function , respectively .",
    "this equation is adequate for problems in which the absorption and emission coefficients change on timescales much longer than the light crossing time",
    ". this will always be the case in the volumes we will simulate by using our methods .",
    "( [ eq : rt ] ) has a formal solution : @xmath20 where @xmath21 is the specific intensity at @xmath22 and @xmath23 is the optical depth at a position along the ray . throughout this paper",
    "we employ so - called on - the - spot approximation @xcite in which recombination photons are assumed to be absorbed where they were emitted . using the on - the - spot approximation ,",
    "the formal solution given by equation ( [ eq : formal ] ) is reduced to @xmath24 to solve this equation numerically , one needs to calculate optical depth between each pair of a source and a target mesh .",
    "the computational cost is hence proportional to the number of sources . in the next subsection",
    ", we will describe the method to decrease the effective number of radiation sources by using the oct - tree structure .      as in @xcite",
    ", we construct the oct - tree structure for the distribution of radiation sources .",
    "a cubic computational domain is hierarchically subdivided into 8 cubic cells until each cell contains only one radiation source or the size of a cell becomes sufficiently small compared to that of the computational domain .",
    "we call these sub - volumes ` tree nodes ' .",
    "when the side length of the cubic computational domain is @xmath25 , the width of a level @xmath26 tree node is given by @xmath27 .",
    "each tree node records the centre of the luminosity of the radiation sources contained in the node , @xmath28 and the total luminosity , @xmath29 where @xmath30 and @xmath31 indicate the position vector and the luminosity of a radiation source , respectively , and subscript @xmath32 runs over all sources within the tree node .",
    "once we have constructed the tree structure , we loop over all meshes . rt from all the radiation sources to each target mesh is performed by a simple recursive calculation as done in @xmath33-body calculation .",
    "we start at the root node ( level 0 tree node ) , which covers entire computational domain .",
    "let @xmath34 be the width of the node currently being processed and @xmath35 the distance between the closest edges of the tree node and the target mesh .",
    "if the angular size of the node is smaller than a fixed value of accuracy parameter , i.e. @xmath36 then we perform the rt calculation between the group of sources in the current node and the target mesh and move on to the next node .",
    "otherwise , we examine the child nodes ( subnodes ) recursively",
    ". the effective number of sources is thus proportional to @xmath13 . in the following subsections",
    "we will explain how we perform the rt calculation between a group of sources and a target mesh .",
    "two - dimensional meshes . in this case , the maximum level , @xmath37 , is 3 and the meshes themselves can be used as the highest level supermeshes . a level @xmath26 supermesh contains @xmath38 meshes . for three - dimensional meshes ,",
    "a level @xmath26 supermesh consists of @xmath39 meshes .",
    ", width=302 ]    we first introduce the supermesh approximation . in fig .",
    "[ fig : supermesh ] , we show a schematic illustration of the supermesh structure .",
    "if a three - dimensional computational domain is discretised by @xmath40 meshes , a level @xmath26 supermesh consists of @xmath41 meshes .",
    "we can calculate the mean density of each chemical species for every supermesh by using the meshes contained in it .",
    "the meshes can be used as the highest level supermeshes .",
    "the supermesh structure is resembling to an adaptive mesh refinement ( amr ) structure and thus this method is well - suited to couple with the hydrodynamics by amr codes .",
    "let us consider the case in which plane - parallel radiation with the specific intensity @xmath42 enters a supermesh that consists of @xmath43 meshes .",
    "what we want to know is the mean intensity of the ray emerging from the other side of the supermesh , @xmath44 ( see fig .",
    "[ fig : supermeshapprox ] ) .     entering to a supermesh that consists of @xmath43 meshes .",
    "the @xmath45-th mesh has the @xmath46 number density , @xmath47 .",
    ", width=302 ]    for simplicity , we here only consider the absorption by @xmath46 atoms and drop the frequency dependence .",
    "the side length of each mesh is @xmath48 and the @xmath46 number density of the @xmath45-th mesh in the supermesh is @xmath47 .",
    "the mean intensity of the emerging radiation is given by @xmath49 ,     \\label{eq : exact}\\ ] ] where @xmath50 is the @xmath46 cross - section and @xmath51 is the @xmath46 column density of the @xmath52-th line , i.e. @xmath53 . in our supermesh approximation ,",
    "we use the mean @xmath46 number density , @xmath54 , to estimate the mean intensity of the emerging radiation @xmath44 .",
    "doing this introduces some error as we will show below . in order to understand the accuracy and the nature of the supermesh approximation",
    ", we compare the mean intensity of the emerging radiation by the supermesh approximation to that calculated by using the meshes .",
    "we first consider the taylor series expansion of the mean intensity of the emerging radiation when we solve the rt on the supermesh : @xmath55 ,     \\label{eq : mean}\\end{aligned}\\ ] ] where @xmath56 is the mean @xmath46 column density given by @xmath57 on the other hand , the taylor series expansion of eqn .",
    "( [ eq : exact ] ) is @xmath58 \\nonumber   \\\\      & = & \\frac{i_0}{n_y } \\left[n_y - \\sigma_{\\rm hi } \\sum^{n_y}_j { \\cal n}_j       + \\frac{\\sigma_{\\rm hi}^2}{2 } \\sum^{n_y}_j { \\cal n}_j^2   + \\cdots \\right ]   \\nonumber \\\\      & = & i_0 \\left[1 - \\sigma_{\\rm hi } \\langle { \\cal",
    "n } \\rangle       + \\frac{\\sigma_{\\rm hi}^2}{2 } \\langle { \\cal n}^2 \\rangle + \\cdots \\right ] .",
    "\\label{eq : tayler}\\end{aligned}\\ ] ] the difference between @xmath44 and @xmath59 is the second order in @xmath60 . from eqn .",
    "( [ eq : exact ] ) and ( [ eq : mean ] ) , the leading error in @xmath59 is @xmath61 since the variance of the column density , @xmath62 , could be very large in the inhomogeneous medium , we substantially overestimate the optical depth if we use eqn .",
    "( [ eq : mean ] ) .",
    "we can therefore in principle improve the approximation by estimating the variance of the column density . according to the central limit theorem",
    ", the variance of the column density for large @xmath63 can be expressed by using the variance of the density , if the density , @xmath47 , is a sequence of independent and identically distributed random variables : @xmath64 .",
    "\\label{eq : centrallimit}\\ ] ] using this relation , the mean intensity of the emerging radiation can be approximated as : @xmath65 .",
    "\\label{eq : smapprox}\\end{aligned}\\ ] ] the effective column density for a ray segment that intersects the supermesh is hence @xmath66}{\\sigma_{\\rm hi } } ,   \\label{eq : effectivecolumn}\\ ] ] where @xmath67 is the length of a ray segment .",
    "we however do not employ this approximation because eqn .",
    "( [ eq : centrallimit ] ) is only valid for large @xmath63 and @xmath63 always becomes small near the target mesh .",
    "we thus only use the mean density in our supermesh approximation which is described by eqn .",
    "( [ eq : mean ] ) .",
    "we will investigate the accuracy of this approximation in section  [ sec : tests ] .",
    "now we have to determine on which supermeshes we perform the rt calculation .",
    "we chose to use the lowest level supermeshes whose angular size , @xmath68 , is equal to or smaller than the angular size of a group of the sources , @xmath0 , since we assume plane - parallel radiation to construct the approximation .",
    "we define the luminosity - weighted rms projected radius as the effective projected size of the group of the sources ) .",
    "] , i.e. if the target mesh is located along the @xmath69-direction from the centre of the luminosity , the projected size of the group is defined as @xmath70 where @xmath71 and @xmath72 are , respectively , the @xmath73 and @xmath74 components of the position vector of the luminosity centre and the subscript @xmath32 runs over all sources in the tree node in question . practically , we calculate the following tensor for each tree node : @xmath75 where the subscripts @xmath76 and @xmath52 , respectively , indicate @xmath76-th and @xmath52-th components of the position vector , i.e. @xmath76 and @xmath52 are either @xmath73 , @xmath74 , or @xmath69 ; and the subscript @xmath32 has the same meaning as in eqn .  (",
    "[ eq : rms ] ) . by using @xmath77 and @xmath78 components of the tensor @xmath79 which is the tensor @xmath80 in the rotated frame so that the target mesh is placed along the @xmath69-direction from the luminosity centre",
    ", we can estimate the angular size of the group of the source in the tree node as @xmath81 where @xmath35 is the distance between the luminosity centre and the closest edge of the target mesh . in fig .",
    "[ fig : supermeshrt ] , we illustrate the procedure of the rt calculation using the supermeshes .    .",
    "the supermeshes used are indicated by purple colour and their sizes are represented by the orange squares .",
    ", width=302 ]    the computational cost by this method is expected to scale with @xmath82 .      here",
    "we introduce another way of accelerating the rt calculation by using the oct - tree structure of the distribution of radiation sources . as in @xcite , we treat a group of sources in a tree node which satisfies the condition described by eqn .",
    "( [ eq : opening ] ) as a bright point source .",
    "since we ignore the size of the source group , we solve the rt not on the supermeshes but on the meshes . consequently , the computational cost scales with @xmath83 .",
    "although this is slightly more expensive computationally than the supermesh approximation in which the cost is proportional to @xmath2 , this method may faster than the supermesh approximation for small @xmath3 because we do not have to calculate @xmath84 and @xmath85 in the point source approximation , where @xmath86 is the number of the sph particles , by utilising the optical depths for sph particles in the order of distance from the radiation source ( see @xcite and @xcite for more details ) . this scaling is better than our point source approximation . ] . since the surface area of a strmgren sphere is proportional to @xmath87 where @xmath88 is photoionization rate ( see section  [ stroemgren ] ) , treating a source group as a point source underestimates the surface area of ionized regions",
    ". we will explore this effect in our tests .    [ cols=\"^,^,^,^,^,^,^,^,^,^\",options=\"header \" , ]      +    \\(1 ) @xcite ; ( 2 ) @xcite ; ( 3 ) @xcite ; ( 4 ) @xcite ; ( 5 ) @xcite ; ( 6 ) @xcite ; ( 7 ) @xcite ; ( 8) @xcite      we solve the non - equilibrium chemistry for e , @xmath46 , @xmath89 , @xmath90 , @xmath91 , and @xmath92 implicitly . note that since we employ the on - the - spot approximation , we use ` case b ' recombination coefficients to calculate recombination rates of @xmath89 , @xmath91 , and @xmath92 throughout this paper .    using the optical depth obtained by the methods described in section  [ sec : smart ] or [ sec :",
    "start ] , the photoionization rates of @xmath46 , @xmath90 , and @xmath91 in each mesh are given by @xmath93 where @xmath94 denotes the radiative contribution from a radiation source ( or a group of radiation sources ) , @xmath95 , and @xmath96 , @xmath90 , and @xmath91 . the contribution from a point - like radiation source , @xmath95 ,",
    "is represented by @xmath97 ,   \\label{eq : photoionization}\\ ] ] where @xmath98 is the threshold frequency for the @xmath76-th species , @xmath99 is the cross - section of the @xmath76-th species , and @xmath100 , @xmath101 , and @xmath102 are respectively the distance between the luminosity centre and the target mesh , the intrinsic luminosity of the radiation source ( or the group of the sources ) , and the column density of @xmath76-th species .",
    "the sum in the exponent runs over all three chemical species .",
    "when all sources have the same spectral shape , i.e. @xmath103 , we generate a look - up table for each species as a function of column densities : @xmath104 .",
    "\\label{eq : tables}\\ ] ] in our case , a look - up table for each chemical species becomes three - dimensional table .",
    "we have confirmed that 20 logarithmic bins for each column density is sufficient . by using the look - up tables ,",
    "the rt calculation is reduced to evaluating the column densities .",
    "following @xcite , we update the densities of each chemical species implicitly by using a backward difference formula ( bdf ) .",
    "the equations to evolve the density of each species can be generally written as @xmath105 where @xmath106 , @xmath107 is the atomic mass number of the @xmath76-th species , and @xmath108 is the proton mass .",
    "this time @xmath76 is either e , @xmath46 , @xmath89 , @xmath90 , @xmath91 or @xmath92 .",
    "the first term of the right - hand side , @xmath109 , is the collective source term responsible for the creation of the @xmath76-th species .",
    "the second term involving @xmath110 represents the destruction mechanisms for the @xmath76-th species and are thus proportional to @xmath111 .",
    "since the timescales for the ionization and recombination differ by many orders of magnitude depending on chemical species , eqn .",
    "( [ eq : chemistry ] ) is a stiff set of differential equations . in numerically solving a stiff set of equations ,",
    "implicit schemes are required unless an unreasonably small timestep is employed . as in @xcite",
    "we adopt a bdf .",
    "discretisation of eqn .",
    "( [ eq : chemistry ] ) yields @xmath112 where all source terms are evaluated at the advanced timestep .",
    "however , not all source terms can be evaluated at the advanced timestep due to the intrinsic nonlinearity of eqn .",
    "( [ eq : chemistry ] ) .",
    "we hence sequentially update densities of all species in the order of increasing ionization states rather than updating them simultaneously ; we evaluate the source terms contributed by the ionization from and recombination to the lower states at the advanced timesteps .",
    "this method has been found to be very efficient and accurate ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "further improvements in accuracy and stability can be made by subcycling the rate solver over a single timestep with which the rt is solved .",
    "the subcycle timestep , which we call the ` chemical timestep ' , is determined so that the maximum fractional change in the electron density is limited to 10% per timestep : @xmath113      similarly to the photoionization , photo - heating rate for each mesh due to the photoionization of the @xmath76-th species is given by @xmath114 where @xmath115 indicates the contribution from a radiation source ( or a group of sources ) , @xmath95 , and @xmath116 , @xmath90 , and @xmath91 .",
    "the total photo - heating rate is defined by @xmath117 . the contribution from a point - like source , @xmath95 ,",
    "is written as @xmath118 .",
    "\\label{eq : photoheat}\\ ] ] as for the photoionization , we generate a look - up table for each species when all sources have the identical spectral shape .",
    "we solve the energy equation for each mesh implicitly as @xmath119 where @xmath120 and @xmath121 are respectively the specific internal energy and temperature of the gas and @xmath122 is the cooling function .",
    "although this implicit integration is always stable , we need to subcycle the energy solver with @xmath123 because both @xmath109 and @xmath110 in eqn .",
    "( [ eq : bdf ] ) are functions of the temperature .",
    "we thus perform the rate solver and the energy solver alternately .",
    "the chemical timestep @xmath123 is recalculated before every subcycle .",
    "we try to use the chemical reaction and cooling rates as up - to - date as possible .",
    "the sources of these rates are summarised in table [ table : rates ] .",
    "note that there are notable differences in the recombination cooling rates between literatures ( see * ? ? ?",
    "since the optical depth @xmath124 at @xmath125 depends on densities of all species at @xmath125 , we have to solve the static rt equation ( eqn .",
    "( [ eq : formal2 ] ) ) , the chemical reactions ( eqn .  ( [ eq : bdf ] ) ) , and the energy equation ( eqn .  ( [ eq : heatcool ] ) ) iteratively .",
    "we iterate these steps until the relative difference in the electron number density becomes sufficiently small : @xmath126 , where superscripts indicate the number of iterations and we set @xmath127 to @xmath128 throughout this paper .",
    "the timestep @xmath129 , with which we solve the rt equation to obtain @xmath130 and @xmath131 , could be much larger than the chemical timestep @xmath123 , with which we subcycle the rate and energy solvers .",
    "we however choose to employ a timestep that is defined by the timescale of the chemical reactions : @xmath132 where the second term in the right - hand side prevent the timestep from becoming too short when the medium is almost neutral .",
    "our choice for @xmath133 and @xmath134 are 0.2 and 0.002 , respectively .",
    "we follow the evolution of the system with the minimum of the timestep defined by eqn .",
    "( [ eq : timestep_i ] ) , i.e. @xmath135 the timestep @xmath129 is therefore only about twice as long as the shortest chemical timestep , @xmath136 . with this timestep , we find the solutions typically within 3 to 6 iteration steps .",
    "while we can of course use a longer timestep , a longer timestep requires more iterations and the total number of steps becomes similar or even larger than the case we employ the timestep defined by eqn .",
    "( [ eq : timestep ] ) . with a longer timestep",
    ", the solutions sometimes never converge .",
    "this timestep is in general much shorter than the timestep defined by the courant timestep criterion and therefore we have to subcycle the hydrodynamical timestep with this timestep when we couple the rt with the hydrodynamics .",
    "when optically thick meshes exist , the solutions converge very slowly .",
    "we thus use smoothed photoionization rates , @xmath137 , and heating rates , @xmath138 , instead of @xmath139 and @xmath140 .",
    "the smoothed rates for the @xmath76-th mesh is calculated by using adjacent 26 meshes , i.e. 27 meshes in total , with a gaussian kernel of the smoothing length @xmath48 .",
    "doing this drastically reduces the number of iterations required to find the solutions .",
    "this smoothing may introduce the smearing of the i - fronts especially when the spacial resolution is poor .",
    "while we do not find such an effect in our test simulations as we will show later , this can be avoided by applying the smoothing only to optically thick meshes as done by @xcite .",
    "in this section , we describe the tests we perform . in order to evaluate the accuracy of our tree - based rt algorithms , problems should involve many sources",
    ". therefore some of the tests presented are neither simplest nor cleanest .",
    "all test problems are solved in three dimensions , with @xmath141 meshes unless otherwise stated .",
    "fraction , cut through at the mid plane of the simulation box at @xmath142.,width=302 ]    the first test is the classical problem of a @xmath89 region expansion in a static , homogeneous , and isothermal gas , which consists of only hydrogen , around a single ionizing source .",
    "this problem has a known analytic solution and is therefore the most widely used test .",
    "note however that since there is only a single radiation source , our rt schemes described in sections  [ sec : smart ] and [ sec : start ] have no difference and both methods become the long characteristics method .",
    "the aim of this test is hence to test our chemical reaction solver and time stepping procedure .",
    "we adopt a monochromatic radiation source that steadily emits @xmath143 photons per second , whose frequency is the lyman limit frequency ( @xmath144  ev ) .",
    "the density of the initially neutral gas is @xmath145 . assuming the ionization equilibrium , the strmgren radius is given by @xmath146 where @xmath147 is the case b recombination coefficient .",
    "if we assume that the ionization front ( i - front ) is infinitely thin , the evolution of the i - front radius is analytically given by @xmath148^{1/3 } ,     \\label{eq : irad}\\ ] ] where @xmath149 is the recombination time .    the analytical solution for the profile of the neutral and ionized fractions ( @xmath150 and @xmath151 ) can also be calculated ( e.g. * ? ? ?",
    "* ) from the equation of the ionization balance at radius @xmath152 : @xmath153 where @xmath154 the profile of the neutral fraction is thus given by @xmath155 to derive this profile , we ignore the collisional ionization , which is included in our simulations .",
    "the initial physical parameters of this test are the same as those of test 1 in cosmological radiative transfer comparison project @xcite , where the hydrogen number density , @xmath145 , is @xmath156 , the temperature of the isothermal gas is @xmath157  k , and ionization rate , @xmath143 , is @xmath158 photons  s@xmath159 . given these parameters and the recombination rate we use , @xmath160 , the recombination time and the stremgren radius are @xmath161 and @xmath162 , respectively .",
    "we employ identical numerical parameters to those in @xcite : the side length of the simulation box is 6.6  kpc , initial ionization fraction is set to @xmath163 , and a radiation source is placed at the corner of the box , @xmath164 .",
    "we compare our simulation results to the analytical solution given by eqn .",
    "( [ eq : analytic ] ) which represents the solution at @xmath165 .    in fig .",
    "[ fig : strmap ] , we show the neutral fraction in the @xmath166 plane at @xmath142 , at which point the i - front is close to to the maximum radius , i.e. the strmgren radius .",
    "the @xmath89 region is nicely spherical , though this is not surprising because , with a single source , our method is identical to the long characteristics method .",
    ", 250 , 500 , and 1000 myr , respectively .",
    "the solid line indicates the analytical solution at @xmath165 given by eqn .",
    "( [ eq : analytic ] ) .",
    "the minimum ionized fraction in the numerical results is set by the collisional ionization which is not included in the analytical solution . , width=302 ]    in fig .",
    "[ fig : strprofile ] , we show the profiles of ionized and neutral fractions at @xmath167 , 250 , 500 , and 1000 myr .",
    "the results asymptotically approach to the analytical solution at @xmath165 .",
    "there is a minimum neutral fraction in the simulation results , which is set by the collisional ionization that is not included in the analytical solution .",
    ", 100 , and 500  myr , respectively .",
    "the results from a high - resolution spherically symmetric one - dimensional simulation are shown by the dotted lines , which almost perfectly overlap with those by the three - dimensional simulation .",
    "the radius is in units of the strmgren radius for the uniform isothermal gas with @xmath168 and @xmath169  k. _ lower panel _ : spherically averaged temperature profiles .",
    "the meaning of the lines is the same as in the upper panel .",
    ", width=302 ]    test 2 solves essentially the same problem as test 1 , but the ionizing source is assumed to have a @xmath170 k blackbody spectrum and we allow the gas temperature to vary owing to heating and cooling processes .",
    "the initial gas temperature and ionized fraction are set to @xmath171  k and @xmath163 , respectively .    in fig .",
    "[ fig : strprofilebb ] , we show the neutral and ionized fraction profiles ( upper panel ) and the temperature profiles ( lower panel ) at @xmath172 , 100 , and 500 myr .",
    "we also show the results from a high - resolution spherically symmetric one - dimensional simulation by the dotted line .",
    "for the one - dimensional simulation , we use 1024 meshes for a sphere of radius of @xmath173 and we do not employ the smoothed ionization and heating rates whereas smoothed rates are employed in the tree - dimensional simulation .",
    "the results by the three - dimensional simulation are almost indistinguishable from those obtained by the one - dimensional one .",
    "the use of the smoothed rates to accelerate the convergence has thus no evident side - effects such as smearing of the i - front .     for this test",
    ", our results are most resembling to those obtained by rsph for test  2 in cosmological radiative transfer comparison project @xcite .",
    "the agreement with rsph is natural because both methods are essentially the long characteristics method .",
    "small differences are probably caused by different adopted rates .",
    "fraction and temperature , cut through at the mid plane of the simulation box at @xmath174 , 100 , and 500 myr from left to right .",
    "the side length of the simulation box is 132 kpc in which we randomly distribute 1000 radiation sources and 1000 optically thick meshes .",
    "upper two rows show results by the supermesh approximation with @xmath175 and lower two rows by the point source approximation with @xmath175 .",
    ", width=302 ]      in order to test the validity of the rt solver based - on the source grouping , we have to solve problems that involve multiple sources .",
    "moreover , the error in the supermesh approximation becomes large when the inhomogeneity of the medium is large ( see eqn .",
    "( [ eq : error ] ) ) . in this test ,",
    "we therefore solve the rt from multiple sources in the clumpy medium .",
    "the side length of the simulation box is 132  kpc .",
    "we randomly select 1000 optically thick meshes whose hydrogen number density is @xmath176 and optical depth at the lyman limit frequency is @xmath177 for the mesh size . the hydrogen number density of other meshes is set to @xmath178 .",
    "we also randomly distribute 1000 radiation sources in the simulation box .",
    "each source has a @xmath170  k blackbody spectrum and steadily emits @xmath179 ionizing photons per second .",
    "the initial gas temperature and ionization fraction are set to @xmath171  k and @xmath163 , respectively .    .",
    "_ upper panels _ : the volume fractions of the neutral fraction at @xmath180  myr .",
    "the results by the supermesh approximation are presented in the left panel .",
    "the solid ( black ) , dotted ( red ) , and dashed ( blue ) lines indicate the results with @xmath181 , @xmath182 , and @xmath183 , respectively .",
    "the relative difference to the long characteristics method ( @xmath184 ) , @xmath185 , is also shown .",
    "the right panel shows the results obtained by the point source approximation .",
    "_ lower panels _ : the volume fractions of the gas temperature at @xmath180  myr .",
    "the meaning of the lines are the same as in the upper panels .",
    ", width=302 ]    .",
    "this figure compares temperature obtained by the supermesh approximation with @xmath186 to that by the long characteristics method ( @xmath184 ) .",
    "the relative difference in temperature is defined as @xmath187 .",
    ", width=302 ]    in fig .",
    "[ fig : multiplesources ] , we show the neutral fraction and temperature maps at the mid plane of the simulation box at @xmath174 , 100 , and 500  myr . we show the results by the supermesh approximation and by the point source approximation with @xmath175 .",
    "the results by two methods are virtually identical to each other including the shape of shadows by the optically thick meshes .    in order to investigate the dependence on the accuracy parameter @xmath1",
    ", we compare the simulations with @xmath186 , 0.5 , and 0 . in fig .",
    "[ fig : multiple_hist ] , we show the volume fractions of the neutral fraction and the volume fractions of the gas temperature respectively in the upper panels and lower panels .",
    "we also show difference in the volume fractions relative to those obtained by the long characteristics method ( @xmath184 ) .",
    "for example , the relative difference in the volume fraction of the neutral fraction by the supermesh approximation with @xmath188 is defined as @xmath189 the volume fractions of the neutral fraction with @xmath186 and @xmath182 agree quite well with those by the long characteristics method ( @xmath184 ) .",
    "the relative differences are typically less than 1  % even with @xmath186 . for a given value of the accuracy parameter",
    ", the point source approximation shows slightly better agreement with the long characteristics method .",
    "on the other hand , agreement in the volume fraction of the gas temperature is not as excellent as that for the neutral fraction . in particular , both the supermesh and point source approximation predict much more low temperature gas around @xmath190  k. this is because treating a source group as a point source underestimates the surface are of the ionized regions as we stated in section  [ sec : start ] and the low temperature gas is primarily heated by high energy photons that permeate beyond the surfaces of highly ionized regions . except for this disagreement for the low temperature gas ( @xmath191  k ) , typical difference is less than 10  % .     to study how serious the deviation from the long characteristics method at low temperature",
    ", we compare the temperature map obtained by the supermesh approximation ( @xmath186 ) , which shows the worst agreement with the long characteristics method , and that by the long characteristics method in fig .",
    "[ fig : temp_comp ] .",
    "we find that the temperature difference is largest for the low temperature gas with @xmath192 ( see also fig .  [",
    "fig : multiplesources ] ) .",
    "the difference in temperature is however very small , only 10  % at most .",
    "we therefore conclude that the results with @xmath186 are almost converged to the result obtained by the long characteristics method .",
    "this test proves that both tree - based methods produce equally good results even with a large value of the accuracy parameter , @xmath186 , in the situation where a local @xmath89 region is driven primarily by one or a few sources .",
    "this situation is resembling to the early stage of cosmic reionization . only at very late stage of the reionization",
    ", the @xmath89 regions overlap each other and multiple sources become visible each other ; at this stage , the reionization has largely completed already .",
    "we thus expect that our tree - based methods , in particular the supermesh approximation , are well suited to this type of problems .",
    "unlike test 3 , here we explore the problem in which groups of sources act like bright extended sources and they ionize distant meshes .",
    "this would be one of the toughest problems for the methods accelerated by source grouping .",
    "the side length of the simulation box is the same as in test 3 , i.e. @xmath193  kpc . in order to construct clustered distribution of radiation sources ,",
    "we put a sphere of radius @xmath194 , whose centre is randomly placed in the simulation box .",
    "we uniformly distribute 1000 radiation sources in the sphere .",
    "we then put a new sphere whose radius is 20% smaller than the previous one and again we distribute 1000 sources in the sphere .",
    "we continue this procedure until we put 10 spheres , each of which contains 1000 sources .",
    "consequently , there are @xmath157 radiation sources in the simulation box .",
    "each source has a @xmath170  k blackbody spectrum and emits @xmath179 ionizing photons per second .",
    "we also randomly select @xmath157 optically thick meshes whose hydrogen number density is @xmath176 .",
    "the hydrogen number density of the remaining meshes is set to @xmath178 .",
    "the initial gas temperature and ionization fraction are set to @xmath171  k and @xmath163 , respectively .    in fig .",
    "[ fig : multiple_clustered ] , we show the neutral fraction maps , cut through at the mid plane of the simulation box .",
    "the size and shape of the ionized regions by the supermesh approximation strongly depend on the value of the accuracy parameter ; the larger the value is , the smaller the size of the ionized regions is .",
    "this is due to the very nature of the supermesh approximation , which significantly overestimates the optical depth when a size of supermesh is large and the variance of the @xmath46 density is large ( see eqn .",
    "( [ eq : error ] ) and ( [ eq : centrallimit ] ) ) . on the other hand ,",
    "the results by the point source approximation are relatively insensitive to the value of the accuracy parameter .",
    "the size of the ionized regions is almost same between @xmath186 and 0 while small difference is seen in the shapes .    in fig .",
    "[ fig : clustered_hist ] , we show the volume fractions of the neutral fraction and gas temperature at @xmath195  myr varying the value of the accuracy parameter , @xmath1 , from 1 to 0 .",
    "we also show the relative difference to the long characteristics method ( @xmath184 ) .",
    "the volume fraction of the neutral fraction confirms the dependence of the supermesh approximation on the value of the accuracy parameter , i.e. the larger the value of @xmath1 is , the smaller the ionized fraction is .",
    "this dependence is more evident in the volume fraction of the gas temperature .",
    "there is more low temperature gas in the simulation with a larger value of the accuracy parameter .",
    "importantly , the results by the supermesh approximation with @xmath196 still significantly deviate from those by the long characteristics methods , and therefore we can not trust the result even with @xmath196 .    on the other hand , the result by the point source approximation with @xmath186 shows an excellent agreement with that with the long characteristics method , in spite of the fact that this approximation ignores the spatial extent of source groups .",
    "this result proves that the point source approximation is very efficient and accurate for this type of problems .",
    "the relative difference to the long characteristics method indicates that both approximations overestimates the volume fraction of the almost fully - ionized gas ( @xmath197 ) .",
    "this ionized fraction corresponds to the central regions of each source spheres .",
    "the volume of these regions are however very small and the neutral fraction is very low anyway ; this overestimation of the ionization fraction at the central regions of the source spheres does not affect the evolution of the whole simulation box .",
    "in fact , by the point source approximation , the relative difference to the long characteristics method in the volume fraction of the neutral fraction is typically 1  % and @xmath198  % at most except for the highly ionized gas with @xmath199 .     even by the point source approximation ,",
    "the relative difference in the volume fraction of the gas temperature to the long characteristics method is rather large for the low temperature gas .",
    "the gas temperature however agrees very well with that by the long characteristics method just as we showed for test  3 . except for the low temperature gas ,",
    "the typical difference is @xmath198  % .",
    "interestingly , decreasing the value of the accuracy parameter in the point source approximation from 1 to 0.2 does not improve the agreement with the long characteristics method very much in spite of the fact that the simulations with a smaller value of the accuracy parameter is much more computationally expensive as we will show in the next subsection .",
    "since the point source approximation with @xmath186 seems to be sufficiently accurate , we expect that this approximation with @xmath175 would be a safe choice for most types of problems .    .",
    "results at @xmath195  myr are presented .",
    "the results are displayed in the same manner as fig .",
    "[ fig : multiple_hist ] . the volume fractions for the simulation with @xmath186 , 0.5 , 0.2 , and 0",
    "are indicated by the solid ( black ) , dotted ( red ) , dot - dashed ( green ) , and dashed ( blue ) lines , respectively .",
    ", width=302 ]      we here investigate how the computation time scales with the number of meshes and that of the sources .",
    "for this purpose , we measure the wall - clock time taken for one step of the rt calculation .",
    "the computation time for solving chemistry etc . is not included .",
    "we use 8 cores of 2.13 ghz xeon e5506 processors for these simulations .    in order to study the scaling with the number of the meshes , we randomly place 1000 radiation sources in the simulation box .",
    "each source and the simulation box is the same as used in test 1 except that there are 1000 sources and we vary the number of the meshes .",
    "we show the result in the upper panel of fig .",
    "[ fig : timing ] .",
    "we find that the supermesh approximation is slightly faster than the point source approximation for a given set of @xmath3 and @xmath1 .",
    "the computation time by the point source approximation is a slightly steeper function of the number of the meshes than that by the supermesh approximation .",
    "the computation time by the point source approximation scales with @xmath200 as expected .",
    "the scaling of the computation time by the supermesh approximation is somewhere between @xmath201 and @xmath202 .",
    "since the rt is solved on the supermeshes whose angular size is similar to the angular size of the source group , @xmath0 , which can be much smaller than @xmath1 , the computation time becomes steeper function of @xmath3 than the expected scaling , @xmath201 . in the lower panel of fig .",
    "[ fig : timing ] , we plot the computation time as a function of the number of the sources .",
    "the number of the meshes is fixed to @xmath141 .",
    "the computation time scales with @xmath13 for @xmath203 in all cases .",
    "this result proves that the tree - based source grouping is quite efficient to deal with a large number of radiation sources . for a given set of @xmath4 and @xmath1 ,",
    "a simulation by the supermesh approximation is always faster than that by the point source approximation .",
    "it should be however noted that even with the same value of the accuracy parameter , simulations by the point source approximation are sometimes much more accurate than those by the supermesh approximation as we showed by test 4 .    .",
    "the number of radiation sources , @xmath4 is fixed to 1000 .",
    "the solid ( red ) and dashed ( green ) lines show the results by the supermesh approximation with @xmath204 and 0.5 , respectively . the dot - dashed ( blue ) and dotted ( light blue ) lines indicate the point source approximation with @xmath186 and 0.5 , respectively .",
    "the thin dot - dot - dot - dashed lines show the scaling with @xmath200 and @xmath205 . _",
    "lower panel _ : same as the upper panel but the number of the source , @xmath4 , is varied .",
    "the number of meshes , @xmath3 is fixed to @xmath141 .",
    "the thin dot - dot - dot - dashed line indicates the scaling with @xmath13 .",
    ", width=302 ]",
    "we have presented a code to solve radiative transfer around point sources within a three - dimensional cartesian grid , argot , which accelerates the rt calculation by utilising the oct - tree structure in order to reduce the effective number of radiation sources .",
    "we have explored two methods : one is the supermesh approximation and the other is the point source approximation . in both methods , sources in a tree node whose angular size is smaller than the accuracy parameter @xmath1 are treated as a single bright source . as a result , computation time only scales with @xmath13 .",
    "the main difference between these two method is that while the former takes the spatial extent of a source group into account , the latter ignores the size of the source group and treat it as a point source . in the supermesh approximation",
    ", the rt is solved using supermeshes whose angular size is similar to the angular size of the source group in question . doing this results in the further acceleration of the rt calculation .",
    "one might thus see that the supermesh approximation is superior to the point source approximation .",
    "we have however shown that the point source approximation is always equally or more accurate than the supermesh approximation for a given value of the accuracy parameter .",
    "this is because rt in a inhomogeneous medium on a supermesh inevitably overestimates the optical depth .",
    "this approximation can be in principle improved by including higher order moments , such as variance , although we do not take such an approach .",
    "this method hence only applicable to the problems in which a local @xmath89 region is driven primarily by one or a few sources such as test 3 in this paper .",
    "when one applies the supermesh method to the simulation of cosmic reionization , it could be combined with the ` local clumping factor ' approach proposed by @xcite , although exploring such a method is beyond the scope of this paper .",
    "the point source approximation , which can be regarded as a mesh version of start @xcite , produces sufficiently accurate results with @xmath186 for all test simulations presented in this paper .",
    "this approximation requires slightly more computational cost than the supermesh approximation and it scales with @xmath206 .",
    "the performance can be improved if we choose the angular resolution so that at least one ray from a radiation source ( or a group of sources ) crosses all target meshes instead of solving rt to all target meshes .",
    "doing this reduces the total number of rays from @xmath207 to @xmath208 .",
    "such an algorithm has been applied for rt from point sources @xcite and can be extended to our tree - based algorithm .",
    "the expected scaling is @xmath209 , which is even faster than the supermesh approximation and the same scaling by start .",
    "for parallel implementation , if the entire meshes and sources can fit into memory of one computer node , parallelisation via angle decomposition is preferable to volume decomposition .",
    "we implement the angle decomposition by using both mpi and openmp .",
    "if a simulation size becomes too large to fit into the memory of one computer node , we have to employ the volume decomposition .",
    "the volume decomposition for rt around point sources was introduce by @xcite and the algorithm can be applied to our methods .",
    "we leave the volume decomposition to future work .",
    "the method presented in this paper can be easily combined with any grid - based hydrodynamic code , even with codes based on amr @xcite and will be useful for various astrophysical problems in which a large number of radiation sources are required such as cosmic reionization and galaxy formation .",
    "we will apply our code for these issues in a forth coming paper .",
    "we would like to thank kenji hasegawa and hideki yajima for stimulating discussion .",
    "we are also grateful to the anonymous referee for helpful comments .",
    "the simulations were performed with first and t2k tsukuba at centre for computational sciences in university of tsukub and with the cray xt4 at cfca of naoj .",
    "this work was supported in part by the _",
    "first _ project based on grants - in - aid for specially promoted research by mext ( 16002003 ) , grant - in - aid for scientific research ( s ) by jsps ( 20224002 ) . to acknowledges financial support by grant - in - aid for young scientists ( start - up : 21840015 ) ."
  ],
  "abstract_text": [
    "<S> we present two types of numerical prescriptions that accelerate the radiative transfer calculation around point sources within a three - dimensional cartesian grid by using the oct - tree structure for the distribution of radiation sources . in one prescription , </S>",
    "<S> distant radiation sources are grouped as a bright extended source when the group s angular size , @xmath0 , is smaller than a critical value , @xmath1 , and radiative transfer is solved on supermeshes whose angular size is similar to that of the group of sources . </S>",
    "<S> the supermesh structure is constructed by coarse - graining the mesh structure . with this method , </S>",
    "<S> the computational time scales with @xmath2 where @xmath3 and @xmath4 are the number of meshes and that of radiation sources , respectively . </S>",
    "<S> while this method is very efficient , it inevitably overestimates the optical depth when a group of sources acts as an extended powerful radiation source and affects distant meshes . in the other prescription , </S>",
    "<S> a distant group of sources is treated as a bright point source ignoring the spatial extent of the group and the radiative transfer is solved on the meshes rather than the supermeshes . </S>",
    "<S> this prescription is simply a grid - based version of start by hasegawa & umemura and yields better results in general with slightly more computational cost ( @xmath5 ) than the supermesh prescription . </S>",
    "<S> our methods can easily be implemented to any grid - based hydrodynamic codes and are well - suited to adaptive mesh refinement methods .    </S>",
    "<S> [ firstpage ]    methods : numerical  radiative transfer . </S>"
  ]
}