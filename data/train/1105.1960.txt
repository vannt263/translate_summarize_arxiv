{
  "article_text": [
    "the sloan digital sky survey ( sdss ; @xcite ) is the largest existing survey of the sky to date ; the sdss - iii program has now released data release 8 ( dr8 ; @xcite ) .",
    "this release provides reliable , well - calibrated catalogs down to @xmath1 over 14,500 square degrees of sky in five bands ( @xmath2 , @xmath3 , @xmath4 , @xmath5 and @xmath6 ) . in so doing ,",
    "it has provided images of a large fraction of the known bright galaxies on the sky  the messier and ngc objects , as well as lower surface brightness nearby galaxies .",
    "however , no reliable catalog of the properties of these galaxies yet exists , primarily because no standard background subtraction procedure has been implemented that properly treats the largest , brightest galaxies in the sky .",
    "the purpose of this paper is to provide just such a background procedure , which has now been run over the entire sdss imaging dataset , and which is being released as part of dr8 .",
    "background subtraction of astronomical images is probably a formally impossible task .",
    "the ideal treatment of the data gathered by a detector would be to explain ( at reasonable @xmath7 ) the counts in each pixel , using a physical model of the sky brightness and its gradients , the telescopic optics and scattered light properties , the astronomical and other sources of light , and the sensitivity , noise and other properties of the detector .",
    "however , this task is impractical ( and likely intractable as well ) , given the detail needed in such a model , the time variability of conditions and instruments , and the probable necessity of treating all the data simultaneously .",
    "for this reason , most practical applications of background subtraction tend to focus on simple approximations that are tractable as well as close to correct for the problems of interest .    for the sdss ,",
    "the standard photometric pipeline , named photo , takes just such a practical and accurate approach ( @xcite ) . in the catalog released in data",
    "release 7 ( dr7 ; @xcite ) , photo calculates the median - smoothed background on a scale of @xmath8 arcsec and subtracts that from the image before object detection and measurement . in the catalog release in dr8 , a more sophisticated approach is used , which first models the brightest galaxies in each field so that they do not contaminate the sky estimate as much ( see @xcite for a more complete description ) .    for faint point source photometry",
    "the above approach is highly accurate ( at least , as long as confusion is not a problem ) . in almost all cases ,",
    "any diffuse light is subtracted away ( whatever its source ) while the point source itself is left untouched . for these sources ,",
    "it is not necessary to fully model the background  just to separate point sources from any diffuse sources .",
    "the resulting fluxes of stars are generally repeatable at well below the percent level ; that is , as well as can be expected given the vagaries of determining the overall calibration of the data set ( @xcite ) .",
    "however , for galaxies the approach that photo uses is more troublesome . whereas it is appropriate for galaxies of small enough angular extent , for larger galaxies it can be inappropriate .",
    "typically , this method of sky subtraction causes an underestimate in their flux , size , and concentration ( @xcite ) .",
    "this problem becomes particularly evident for the nearby brightest cluster galaxies ( @xcite ) .",
    "while the dr8 algorithms represent a modest improvement in the sky subtraction , the bulk of the problem remains .    in  [ sec : model ] below",
    "we present a different method for sky subtraction that is more accurate for large galaxies ( while retaining most of the accuracy for point sources ) .",
    "our method begins with the estimate of the sky background from a processed sdss imaging run .",
    "it builds masks around all bright detected sources , and any known sources close to but outside the edge of the imaging run .",
    "then it fits a smooth spline to the unmasked data , applying appropriate constraints to regularize the problem in the presence of the heavy masking .    in  [ sec : mosaic ] we describe how we take sky subtracted sdss fields and mosaic them into single image , for the purposes of analyzing large galaxies .    in  [ sec : endtoend ] , we test the resulting photometry of these images in three ways .",
    "first , we compare aperture photometry of point sources to the standard sdss aperture photometry , to quantify how much degradation our mosaicking procedure and sky subtraction have introduced .",
    "second , we insert fake bright galaxies into the raw data and reanalyze the data completely .",
    "we then compare our background subtracted mosaicked images to the original fake data to evaluate the fidelity of our procedure .",
    "we also evaluate the performance of two versions of the standard sdss pipelines ( the ones used in sdss dr7 and dr8 ) .",
    "third , we compare to the only other publicly available mosaicking and background subtraction facility for sdss that we are aware of , the montage tool distributed by irsa ( @xcite ) ; for bright galaxies we find excellent agreement",
    ".    in  [ sec : summary ] , we summarize .",
    "the results described here are available on a field - by - field basis in the sdss dr8 data set",
    ". tools for returning mosaics are also available .",
    "finally , a previous version of the results , for dr7 , is also still available .",
    "the sdss has taken @xmath9 ccd imaging of @xmath10 of the sky @xcite .",
    "automated software performs all of the data processing : astrometry @xcite ; source identification , deblending and photometry @xcite ; photometricity determination @xcite ; and calibration @xcite .    as @xcite",
    "describe , the sdss focal plane has 30 imaging ccds evenly spaced ( with gaps ) across it , six for each of the five filters ( @xmath2 , @xmath3 , @xmath4 , @xmath5 and @xmath6 ) . each exposure is taken in drift scan mode , such that a point in the sky passes through each ccd sequentially with a gap of 71.72 seconds on average .",
    "this procedure produces six long rectangular images of the sky , called `` camcols . '' in the standard sdss pipeline , each camcol is further broken into multiple `` fields , '' each with a width of 1361 pixels in the scan direction .",
    "the native pixel scale on the ccds is approximately 0.396 arcsec .",
    "when we refer to pixels in this paper it is this native scale we will mean .",
    "when we discuss these images , we will refer to the position in the scan direction as the `` pixel row '' or @xmath11 , and the position perpendicular to the scan direction as the `` pixel column '' or @xmath12 .",
    "figure [ fig : rawrun ] shows this geometry for part of run number 1336 in the @xmath4-band , showing each camcol and the gaps in between each one .",
    "it shows an area about 2.3 deg wide representing about 25 minutes of exposure time .",
    "this image is the standard sdss pipeline s estimate of the background light used for photometry , binned in 8@xmath138 pixels  that is , detected objects have been removed from this image . in detail , it is equal to the actual counts in areas where there were no detected objects , and is equal to the background estimate plus appropriate noise in areas where there were detected objects .",
    "this determination is made before any calibration except for the flat - field correction , which is only a function of pixel column because the observations are drift scans .",
    "the units are raw counts ; because of the varying gains among the ccds two of camcols mostly saturate in this particular image stretch",
    ".    inspection of figure [ fig : rawrun ] reveals that residual light from bright objects is easily visible in the background light image .",
    "this residual light is due to the sdss s background light estimation method , which consists of a median - smoothed image on a scale of 100@xmath13100 arcsec . under this procedure ,",
    "large objects have a substantial amount of their light removed during background subtraction  therefore , the background shows the presence of bright stars .",
    "we will proceed by fitting a much smoother function to this sdss sky estimate in order to model the obvious variation with the background with time but not oversubtract the brightest objects .",
    "the initial step in our background subtraction is to mask the data appropriately",
    ". we can not allow the subtraction to be strongly affected by the presence of bright stars or galaxies , if we want to accurately measure the fluxes of those objects .",
    "we begin by defining an initial mask around known bright objects .",
    "first , we identify any objects detected in the sdss catalog with magnitude @xmath14 in the given filter .",
    "we create a mask of size 32@xmath1332 native sdss pixels around the faintest such objects , growing with decreasing magnitude to 1600@xmath131600 pixels at @xmath15 ( and constant with magnitude for brighter objects ) .",
    "this procedure masks successfully finds and masks bright stars inside the imaging run .",
    "however , galaxies within the imaging run are frequently shredded into fragments by the sdss deblender , and it is more complex to determine what area to mask based on the sdss catalog alone .",
    "therefore , we also identify any galaxies from the third reference catalog ( rc3 ; @xcite ) that land within the imaging run and build masks around those objects that are 1000@xmath131000 pixels .",
    "this procedure masks a number of bright galaxies that are large enough to affect our background subtraction but that our first step above would not catch .",
    "finally , the sdss filters suffer from internal reflection at their edges , causing stars just outside the frame to scatter light onto the ccd , creating large - scale features that we do not want included in our background subtraction model .",
    "( a more detailed model would explicitly subtract these features , that we do not attempt here ) .",
    "we mask these reflections by identifying any stars from the tycho-2 catalog that lie just outside the frame and masking a rectangular region 1500@xmath13900 pixels centered on the star .",
    "we use a rectangular region because the reflection has a larger extent in the pixel column direction than in the row direction .",
    "occasionally sdss fields contain objects sufficiently bright that the sdss pipeline fails to reduce them at all .",
    "we mask the entirety of those fields .",
    "figure [ fig : mask ] shows this initial mask for the run shown in figure [ fig : rawrun ] .",
    "white areas are those to be used in our background model fit while black areas are those to be ignored .",
    "the mask is intentionally very conservative  we want to minimize the flux that is incorrectly assigned to the sky background .",
    "as described in the next section , we also apply further masking to the run during our iterative fit .      in order to fit the data , we first further bin it from 8@xmath138 to 8@xmath13680 pixels",
    " that is , we heavily bin it in the pixel row direction ( i.e. parallel to the scan direction ) .",
    "we keep the resolution in the pixel column direction because the sky ends up tracking some residual flat - fielding errors .",
    "when rebinning , we account for the mask , and track the weight of each 8@xmath13680 binned pixel as the number of non - masked 8@xmath138 pixels it contains .",
    "the spline model that we fit to the final binned data is as follows : @xmath16 where @xmath12 and @xmath11 are the pixel column and row positions .",
    "@xmath17 is an overall scaling factor for each camcol .",
    "@xmath18 is a second - order b - spline for each camcol , with break - points spaced approximately once per sdss field ( 1361 pixels ) .",
    "thus , it expresses the overall variation of the sky over time during the scan .",
    "@xmath19 is a second - order b - spline in two dimensions , with break - points spaced once every 8 pixels in the @xmath12 direction and spaced once every 40 fields in the @xmath11 direction .",
    "thus , it allows for a rapid variation with column ( which accounts for flat - fielding errors ) but allows that pattern to vary slowly over time .",
    "this function is trilinear in the parameters ( linear in @xmath20 and in the b - spline parameters of @xmath21 and @xmath22 ) ; thus an iterative fit is required .",
    "our approach here amounts to an approximation to @xmath7 minimization of the data with respect to the model .",
    "first , we determine @xmath17 by taking a median across each camcol .",
    "second , we divide each camcol by @xmath20 and perform @xmath7 minimization to fit @xmath22 alone .",
    "we quadratically couple the spline parameters strongly in the row direction to keep the fit smooth .",
    "in addition , we allow a small quadratic coupling between the camcols in order to interpolate more smoothly over masked data .",
    "these quadratic couplings retain the linearity of the @xmath7 fit .",
    "third , we divide the data by @xmath20 and @xmath22 , and finally perform a second @xmath7 minimization , this time for @xmath21 .",
    "again , we allow coupling between the spline parameters . in this case , we allow weak coupling between the parameters in the row direction but very strong coupling in the column direction , to keep @xmath21 as smooth as it can be . in the @xmath7 minimizations for @xmath22 and @xmath21",
    ", we use the mask weights , but no inverse variance weighting .",
    "we have a special condition for ccds that have two amplifiers rather than one .",
    "for these ccds , half the pixels are read out by one device and half by another ; therefore , we do not couple the pixels across the divide , and indeed we observe that the gains of the amplifiers do drift at the fraction of the percent - level over the course of each run .    finally , given the resulting model @xmath23 , we estimate an rms dispersion @xmath24 around the fit , and then mask all regions that are greater than 2@xmath24 from the fit ( in addition to the initial mask described in  [ sec : mask ] ) .",
    "we then iterate the fit four more times .",
    "an example final fit is shown in figure [ fig : model ] .",
    "this model is non - parametric and not physical  consequently , for diffuse sources many arcminutes in size , our method will by design oversubtract the light .",
    "however ,  [ sec : simplegal ] below shows that it is sufficiently good to allow accurate measurements of most nearby galaxies .",
    "figure [ fig : resid ] shows the residuals of the data after subtracting the model sky .",
    "there are remaining discrepancies visible , which in the next subsection we will show to be at a level that is fainter than 26 mag arcsec@xmath25 .",
    "we have performed a simple residual test by considering random unmasked patches that are 13@xmath1313 native sdss pixels in size .",
    "we place these patches in locations that the sdss photometric pipeline has identified as `` sky '' objects  areas with no detected flux in the pixels .",
    "figure [ fig : skyqa ] shows the distribution of the mean fluxes per square arcsec in such patches across all sdss runs .",
    "the performance in most areas is excellent , with a standard deviation representing residuals fainter than @xmath26 mag arcsec@xmath25 in the @xmath4-band .",
    "there are a handful of outliers , which we find nearly always to be associated with very extended emission from the interstellar medium or an extremely bright star . while in regions of very extended emission",
    ", we can not guarantee that our sky estimate is correct , we do expect that they will appear as bright outliers in this residual plot .",
    "a smaller contribution to the dispersion in this plot is variable emission in the night sky lines ; this variability mainly affects the @xmath4 , @xmath5 , and @xmath6 bands . on some nights",
    ", these variations can cause @xmath27 fluctuations in the broad - band sky level on time scales of 5 to 10 minutes .",
    "usually our sky subtraction methods remove this variation well , but in regions which also have very bright objects , occasionally there are residuals at the few percent level . in large - scale images , these may show up as red , low surface brightness streaks .",
    "these residual tests are adequate insofar as they test the performance of our fitting procedure and help to identify runs with highly variable backgrounds ( astronomical or instrumental ) .",
    "however , they do not provide a direct estimate of the effects of sky subtraction errors on the resulting galaxy photometry  that is , they do not test whether we might be oversubtracting light near large sources .",
    "we test that effect more thoroughly in ",
    "[ sec : simplegal ] .",
    "the sdss dr8 data release distributes all of the flat - fielded , sky subtracted , calibrated fields in each band based on this procedure .",
    "this data consists of approximately 940,000 fields , each 2048@xmath131489 pixels in size , available for download on an individual field basis ( or requesting cutouts ) from the sdss - iii science archive server .",
    "the data format is fits .",
    "each file s primary hdu contains a floating - point image , calibrated in units of nanomaggies per pixel .",
    "the images have had defects such as bad columns and cosmic rays identified and interpolated over by the photo pipeline .",
    "the images are compressed by zeroing out all but the 10 most significant binary digits in the floating point numbers , and subsequently using bzip2 to losslessly compress the result . for the sky subtracted images ,",
    "the 10th binary digit is considerably smaller than the noise in any image , meaning that although overall this compression is slightly lossy , it has no significant effect on the results  even if these images are combined in a stack ( @xcite ) .",
    "subsequent hdus in each image yield the sky subtraction and calibration image , so that the sky can be added back in and the image put back into counts if desired .",
    "full details of the format and location of the files can be found in the sdss - iii data model .",
    "the science archive server also provides mosaicking tools .",
    "they work slightly differently than the procedure described in  [ sec : mosaic ] . instead of using the raw data , they begin with the corrected frames described here and mosaic the fields together using the swarp package .",
    "however , they yield equivalent results .",
    "the primary aim of our sky subtraction is to improve measurements of large objects on the sky .",
    "many such objects overlap the edges of sdss fields ( and some are bigger than or comparable to the size of a single field ) .",
    "thus , to recover their photometry we must mosaic together multiple fields after the background subtraction . here",
    "we describe our procedure . for historical reasons , for these mosaics",
    "we have not begun with the calibrated frames described in  [ sec : fields ] but with the raw data .    for each mosaic",
    "we specify a desired world coordinate system header ( wcs ; @xcite ) .",
    "we identify all sdss fields that overlap the desired area and pick the minimal set that fully cover that area .",
    "then we prepare each field for mosaicking . starting with the raw sdss data ,",
    "we apply the flat field determined by the ubercalibration procedure ( @xcite ) .",
    "next we identify cosmic rays using a procedure similar to that used by the sdss pipeline ( @xcite ) .",
    "we interpolate over saturated pixels and cosmic rays using simple linear interpolation in the @xmath12 direction .",
    "we then subtract our estimate the sky , determined by evaluating the function described by equation [ skyspline ] at each image pixel . in the sky estimate",
    ", we account for any difference in the flat field as originally used by the sdss photometric pipeline , and as determined by ubercalibration .",
    "finally , we apply the photometric calibration to each field ( @xcite ) .",
    "to resample each image we evaluate the position of each desired pixel within each original field .",
    "then we interpolate the original field s image to the desired set of locations , using the well - known cubic approximation to the sinc function ( @xcite ) .",
    "this resampling method is known to work well for nyquist - sampled images , a condition sdss virtually always satisfies . in practice , we use the built - in idl utilities polywarp and poly_2d to perform this resampling .",
    "we evaluate the weighted average of the flux from all the input images at each output pixel .",
    "the weights are unity throughout most of each input image , but are apodized smoothly to zero at the edges .",
    "thus , the transition between regions which overlap two fields are relatively smooth .",
    "any output pixels that have no overlapping input images are set to zero .",
    "figure [ fig : examples ] shows several example mosaics created with this procedure .",
    "we have obviously chosen these partly for dramatic effect , but also to demonstrate the robustness of the masking to the presence of large , bright objects of various sorts : globular clusters , galaxy clusters , and large galaxies .",
    "each of these mosaics is built from two up to six fields depending on its size ( which ranges from 12 to 24 arcmin on a side ) .",
    "although our procedures allow us to evaluate any arbitrary mosaic , for ease of distribution we have created a set of 1@xmath131 deg mosaics across the entire observed northern galactic cap , or almost 8000 deg@xmath28 .",
    "we have created a web interface that allows users to easily extract sections of these dr7 mosaics ( see footnote in  [ sec : intro ] for url ) .",
    "this interface can be used either interactively or non - interactively .",
    "the interactive method allows the user to browse a google sky viewer and select the region of interest .",
    "the non - interactive method is explained in its documentation . in either case , the tool returns fits format images in each desired bandpass , with correct wcs headers , sky subtracted and calibrated .",
    "the units of the images are nanomaggies per pixel .",
    "note that we have not yet produced any such mosaics of the area imaged in sdss - iii s new imaging in the south galactic cap .",
    "however , as described in ",
    "[ sec : fields ] the standard dr8 data release tools do provide mosaicking tools .",
    "the only other publicly available mosaicking and background subtraction facility for sdss that we are aware of is the results of the montage package distributed by irsa @xcite .",
    "we will describe the quantitative differences between their results and ours in  [ sec : galmontage ] . here",
    "we discuss methodological differences .",
    "the first major difference is in their method for background subtraction .",
    "while in our case we rely on a smooth fit to regions with no objects , montage fits a smooth additive term within each run to minimize the differences between it and other overlapping images .",
    "this procedure can be far superior to ours in regions with many overlapping images .",
    "in much of the sdss area the only overlapping images are at the north and south edges of each field , and how the montage algorithm behaves in that regime is a quantitative question .",
    "we compare our results to theirs for large galaxies in  [ sec : simplegal ] below .",
    "the second major difference is in their method for `` resampling '' of images . they do not perform a normal resampling but",
    "instead use a generalized version of the `` drizzle '' algorithm .",
    "this algorithm computes the fraction of each original pixel that overlaps each output pixel , and distributes the original pixel s flux accordingly .",
    "relative to properly resampling a nyquist - sampled image , such methods do a poor job at maintaining the original psf ( or even at producing an image with a well - defined psf ) .",
    "they are also clearly irreversible operations even in the noiseless case , demonstrating that information is lost and the image is consequently degraded .",
    "we compare our results to the montage results for point sources in  [ sec : psfs ] below , and believe that montage s are less good at the bright end in those tests due to their drizzling procedure .",
    "however , it is unlikely that these issues affect our main interest here , which is large galaxies on the sky .",
    "the residual tests of  [ sec : residuals ] are acceptable as far as they go , but are of little use in evaluating the quality of the photometry of objects in the masked regions . in order to do that",
    ", we need to compare to ground truth ( possible to some extent for point sources ; see  [ sec : psfs ] ) or simulate the analysis of objects similar to those we are interested in ( necessary for galaxies ; see  [ sec : simplegal ] and  [ sec : deblendgal ] ) .",
    "the standard sdss analysis excels for point sources .",
    "in fact , because that analysis avoids interpolation , regridding or stacking of the data we expect that its performance will be superior than anything that our background subtracted mosaics could produce .",
    "therefore , as a quality assurance tool to demonstrate how photometric our images are , we compare aperture photometry of point sources in our mosaics to that reported by the standard sdss pipeline . the goal here is to verify that the overall scale of the mosaicked images is correct and that the signal - to - noise has not been degraded .",
    "we randomly choose twenty 1 degree square mosaics .",
    "because in this section we are interested in point source photometry , we perform a local sky subtraction on the same scales as sdss uses ( 100 arcsec median smoothed ) .",
    "we of course will not do the same in the analysis of large galaxies . from the overlapping sdss catalog ,",
    "we choose unsaturated stars with no neighbors within 15 arcsec .",
    "for each we measure a circular aperture flux within a 7.3 arcsec radius ( the standard aperture used by the ubercalibration pipline ) .",
    "then , we compare this flux to that reported within the same aperture by the standard sdss pipeline .",
    "figure [ fig : sdss_qa_magdiff ] shows ( as a function of magnitude ) the flux ratios between the 7.3 arcsec aperture flux measured from a random set of twenty of our mosaic images and that reported by the sdss catalog for each sdss band .",
    "the overall scale of the magnitudes is close to correct , with less than a 1% difference between our results and sdss at bright magnitudes .",
    "figure [ fig : sdss_qa_scaled ] shows the distribution of flux differences , scaled to the expected error distribution .",
    "the lines are the 16% , 50% and 84% quantiles .",
    "this distribution is close to the normal distribution , an indication that our mosaicking procedure does not degrade the image very badly .",
    "of course it does degrade it to some degree , an effect particularly noticeable at the faintest magnitudes , where the median difference becomes almost 0.5@xmath24 and the distribution is significantly wider then the normal distribution .",
    "we perform the same pair of tests on twenty montage mosaics of the same regions ; results are shown in figures [ fig : montage_qa_magdiff ] and [ fig : montage_qa_scaled ] .",
    "the flux ratios reveal a scale difference between the montage images and the sdss catalog of 35% .",
    "we have not investigated their procedure thoroughly enough to diagnose the cause of this error . in any case , as an overall flux error this problem is relatively minor for our purposes here .",
    "figure [ fig : montage_qa_scaled ] shows the distribution of flux differences between the sdss catalog photometry , and our aperture photometry of the montage mosaics .",
    "we have first accounted for the scale error before considering the flux differences .",
    "having done so , the error distribution clusters around zero . at faint magnitudes",
    "the distribution is similar to ours . at bright magnitudes",
    "it is considerably broader , which we suspect is due to the degradation of the image caused by the drizzling procedure . as we show below",
    ", these errors appear to be less important when considering larger , brighter objects .",
    "in addition , the additional error is extremely small , at the 1% level .      in the previous section",
    ", we considered the effects of our procedures on point source photometry to verify that our images did reasonably well relative to the `` ground truth '' established by the sdss standard photometry .",
    "we do not trust the sdss standard results in the case of galaxy photometry ,  in fact , it is our goal to improve that photometry substantially .",
    "therefore , we must use a different tactic to test our results .    to do so , we insert fake galaxies into the raw data , using the same tools developed by @xcite and used by several other investigators since ( @xcite ) .",
    "we distribute fake galaxy images onto a random set of locations on the sky covered by sdss fields . for each observation of an object in an sdss field in each band , we convert the fake stamps to sdss raw data units , convolve with the estimated seeing from the sdss photometric pipeline , and add poisson noise using the estimates of the gain .",
    "we add the resulting image to the real sdss raw data , including the tiny effects of nonlinearity in the response and the less tiny flat - field variation as a function of column on the chip .",
    "we then run the sdss photometric pipeline photo as well as our sky subtraction procedure .",
    "around each fake galaxy that we insert , we create a mosaic using the tools described above .",
    "the fake galaxy sample is based on the low redshift sample from the new york university value - added galaxy catalog ( @xcite ) , as updated for sdss data release 6 ( see , for example , @xcite ) .",
    "this sample consists of essentially all galaxies with @xmath29 and @xmath30 . for each galaxy , we take its flux , half - light radius , srsic  index , axis ratio , and @xmath9 colors from the sdss data .",
    "we then reassign each galaxy a redshift in the range @xmath31 ( constrained to be smaller than the actual redshift ) , and adjust its size and flux accordingly .",
    "this procedure yields a realistic distribution of sizes , fluxes , profile shapes and colors , with an emphasis on the large , nearby galaxies of most interest here .",
    "there are several different definitions of magnitude in the sdss catalogs . here",
    "we will compare with the most robust , the so - called `` cmodel '' fluxes , defined in terms of the best fit combination of the de vaucouleurs and exponential models as follows : @xmath32 figure [ fig : fakedist ] shows the distribution as a function of measured cmodel magnitude and half - light size ( from the best - fit model in each case ) .",
    "the greyscale and contours are from the sdss dr8 catalog ; the points are the fake data ( with parameters as measured by photo v5_6 ) .",
    "the fake galaxies follow the real distribution well , though they define a roughly size limited sample with @xmath33 arcsec .",
    "even with background subtracted images , galaxy photometry can be a complex process , involving deblending the target galaxy from other sources and a choice of algorithms for estimating the total flux and other properties . to test our procedure ,",
    "we want first to be able to isolate the effects of the background subtraction and ask whether it is substantially affecting the results .    to test",
    "how well our sky subtraction is doing , we ask directly how much flux it removes from the aperture surrounding the object .",
    "in particular , we use an aperture with a radius of @xmath34 , containing 95% of the light of the galaxy .",
    "we use the fake , sky subtracted field and calculate the flux in each band in that aperture .",
    "we then use the real , galaxy - free , sky subtracted field and calculate the flux in the same aperture .",
    "of course , in the fake data the sky subtraction will inevitably subtract off a slightly different ( usually larger ) amount of light than does the sky subtraction in the real data , because of the presence of the large , fake object .",
    "the fake aperture flux minus the real aperture flux is equal to the fake galaxy flux that remains in the image after sky subtraction  the measured fake galaxy flux @xmath35 , to be compared with the original input fake galaxy flux @xmath36 .    in figure",
    "[ fig : sky_offsets_ronly ] , the squares in the bottom panel are @xmath37 , the residual of the measured fake galaxy flux with respect to the original in the @xmath4-band as a function of the true galaxy half - light radius @xmath38 .",
    "there is no systematic offset of any signficance up to @xmath39 arcsec , which indicates a rather large galaxy .",
    "for example , only a couple of dozen galaxies in the dr8 area are that large .",
    "the largest galaxies get to @xmath40@xmath41 @xmath42 kpc in size , and such galaxies would have @xmath43 arcsec at a distance of 2040 @xmath42 mpc .",
    "thus , we can expect only the largest galaxies on the sky  for example , certain messier objects  to have any substantial flux subtracted by this procedure .",
    "figure [ fig : sky_offsets_ugiz ] shows the color residuals with respect to size , in @xmath44 , @xmath45 , @xmath46 , and @xmath47 ( measured color minus true color ) .",
    "again , the residuals scatter about zero .",
    "the test performed here will typically underestimate the errors of any actual photometric measurement on the fake galaxies , and defines the `` best possible '' result given our sky subtraction procedure .",
    "these results confirm that our procedure works very well for the photometry of bright galaxies .      to test more realistic scenarios , figures [ fig : sky_offsets_ronly ] and [ fig : sky_offsets_ugiz ]",
    "also show results from an automated analysis of these mosaics , performed without knowledge of the true image or of the original image without the fake galaxy .",
    "we will compare these results to the standard sdss catalog analysis .",
    "we have tested two versions of photo : the one used in the dr7 catalog ( v5_4 ) and the one used in the dr8 catalog ( v5_6 ) .",
    "the v5_6 version was designed to perform sky subtraction better than v5_4 . as found by @xcite , in practice v5_6 is a minor improvement , but the differences between the two pipelines are small .    in these figures , the circles are the sdss photo v5_6 measurements of the fake galaxies , using the cmodel magnitude .",
    "the top panel of figure [ fig : sky_offsets_ronly ] shows the error in the galaxy half - light radius in the @xmath4-band . there is a large underestimation of the fluxes and radii",
    " it becomes signficant at @xmath48 arcsec .",
    "the thick solid line running through the points is a running median estimate of the residual ( inside a window of @xmath49 dex ) .",
    "the thin solid line is a quadratic approximation to the running median of the form : @xmath50 ^ 2\\ ] ] table [ table : sky_offsets ] lists the parameters of this fit as well as the standard deviation @xmath51 around the median for both versions of photo .",
    "the errors in color shown in figure [ fig : sky_offsets_ugiz ] are much smaller , though there are detectable trends in @xmath2 and @xmath6 .",
    "table [ table : sky_offsets ] also lists the fits to the color residuals .",
    "we also investigated these residuals as a function of galaxy area ( that is , @xmath52 , where @xmath53 is the axis ratio ) , as advocated by @xcite .",
    "there was little substantial reduction in the scatter in these residuals , and qualitatively the results were very similar .",
    "we emphasize that for the primary sdss spectroscopic sample at @xmath54 the issue is not nearly as dire as it appears in this plot  only the largest such galaxies have @xmath5520 arcsec , for which the effects are still relatively small .    for comparison ,",
    "we have performed deblending and photometry on our sky subtracted images .",
    "our algorithms are similar to those used in photo , but are tuned to work for large galaxies at the expense of small galaxies .",
    "essentially , we detect pixels 5@xmath24 above background and connect those pixels into `` parent '' objects . we find peaks within each parent and remove those that are consistent with the image point - spread function .",
    "we then smooth the remaining image using a gaussian with @xmath56 pixels and redetect peaks : this step will retain large galaxies without breaking them up into many children , but essentially ignore small ones .",
    "then we define a symmetric template around each galaxy peak and extract the flux in each pixel associated with each peak in the same manner that photo does . to make the procedure more robust ,",
    "we detect galaxies and define templates only in the @xmath4-band , and then use those same templates for all bands .",
    "finally , we fit a two - dimensional srsic  profile to the deblended galaxy image to estimate its half - light radius and flux in each band .",
    "the triangles in figures [ fig : sky_offsets_ronly ] and [ fig : sky_offsets_ugiz ] show the results of this procedure .",
    "again , the lines show the running median and the quadratic fit to it ( with parameters listed in table [ table : sky_offsets ] in the row marked `` global '' ) .",
    "this analysis performs substantially better than photo : the size errors exist but are much smaller , while the flux errors are about 0.1 mag independent of size .",
    "in addition , the scatter @xmath51 is about a factor of two smaller , which probably results from a smaller dependence of the errors on the srsic  index and axis ratio of the galaxies .",
    "@xcite found similar results to what we find here , but for elliptical galaxies .",
    "for comparison to their results , figure [ fig : sky_offsets_vs_r50meas ] shows the magnitude errors of photo v5_6 in the @xmath4-band , as a function of the measured @xmath38 ( not the true value ) .",
    "again , the lines show the running median and the fit .",
    "the dotted line shows the parametrization of the error given by @xcite . at small sizes it is in good agreement with our results , but at large sizes it exceeds our corrections . almost certainly this is because our result averages over all galaxy profiles .",
    "the solid points in figure [ fig : sky_offsets_vs_r50meas ] indicate fake galaxies with srsic  index @xmath57 , which follow much better the results of @xcite .",
    "@xcite also explored these issues , but for a broader distribution of galaxy types .",
    "they published a fitting function based on the sdss catalog axis ratios , 90% light radii , and magnitudes ( their equation 1 ) .",
    "they predict the flux `` lost '' in the standard reductions @xmath58 ( in nanomaggies ) . in this context , both @xmath35 and @xmath36 are standard sdss petrosian fluxes ( @xcite ) .",
    "@xcite suggest the simple form : @xmath59 where @xmath60 , @xmath61 and @xmath53 are the petrosian quantities reported by the sdss catalog .",
    "we have refit the parameters of this model to our simulated data .",
    "table [ table : west ] lists the values of the parameters of this fit , for both versions of photo studied here , and evaluating the flux lost in both the petrosian and cmodel estimates .",
    "we demonstrate the quality of fit for this formula in figure [ fig : sky_offsets_vs_west ] , showing the actual flux lost relative to the predicted value .",
    "the open circles show results for the dr7 version of the photometry ( photo v5_4 ) whereas the filled circles show results for the dr8 version of the photometry ( photo v5_6 ) .",
    "the predictions perform excellently on dr7 data .",
    "however , for dr8 data there is greater scatter .",
    "we find a correlation between the scatter and @xmath60 that the simple function above fails to explain ; in particular , the outliers below the relation are typically galaxies with @xmath62 .",
    "these differences are likely due to the dr8 photometry being slightly better in the large size , high flux regime ( @xcite ) .    the coefficients for equation [ eq : west ] derived by @xcite are not directly comparable to those in table [ table : west ] .",
    "their comparison only measured the flux lost due to sky subtraction alone , and did not include the effects of photo s deblending .",
    "our comparison is to the photo catalog itself and therefore includes the effects of deblending .",
    "it turns out that in the sdss pipeline results , a substantial function of the lost flux is due to effects of poor deblending .",
    "therefore , the coefficients found here would be most applicable to an actual sdss photometric catalog sample",
    ".    however , we do not necessarily recommend using these formulae for robust determinations of fluxes for bright and/or large galaxies  reanalyzing properly background subtracted images is clearly a better route .",
    "however , they are excellent ways to determine when such effects are important in the sdss catalog .      as another test , we have also taken a sample of nearby bright galaxies and compared large - aperture photometry between our images and images from montage .",
    "we randomly select 200 galaxies brighter than @xmath63 to perform this test .",
    "we compare aperture photometry within a radius of @xmath64 for each galaxy .",
    "in general , the fluxes and colors are in good agreement .",
    "the median ratio of the flux estimated from the montage images to our flux estimate to is about 96% , as for the point source estimates above ( and likely for the same reason ) .",
    "the standard deviations around this mean for the @xmath65 bands are @xmath66 , indicating very good agreement between the methods .",
    "in this paper , we have presented a method to estimate the sky background in sdss images , suitable the purposes of measuring large , bright galaxies .",
    "while this model has no physical motivation , it appears to have the right balance of freedom and physical constraints to adequately describe most of the sdss imaging .",
    "we have tested the measurements of point sources in the sky subtracted images , to ensure that they are not signficantly degraded with respect to the original sdss data .",
    "in addition , we have inserted fake galaxies into the data and reran the sky subtraction to evaluate how well our procedure works for bright galaxies .",
    "we find substantial improvement with respect to the standard pipelines .",
    "whereas for the standard sdss photo pipeline the sky subtraction becomes important at the 20% level at @xmath48 arcsec or so , we do not see comparable errors in our results even up to @xmath39 arcsec .",
    "we have compared our results to a similar service provided by irsa , the montage package .",
    "essentially , our results are similar to theirs for large objects , though we identify a slight error in their overall fluxes . for bright stars",
    "their interpolation method appears to introduce some very slight errors .",
    "the authors acknowledge funding support from nasa grants 06-galex06 - 0030 , nnx09ac85",
    "g and nnx09ac95 g , and _",
    "grant g05-ar-50443 , as well as a google research award .",
    "this research has made use of nasa s astrophysics data system and of the nasa / ipac extragalactic database ( ned ) which is operated by the jet propulsion laboratory , california institute of technology , under contract with the national aeronautics and space administration .",
    "funding for sdss - iii has been provided by the alfred p. sloan foundation , the participating institutions , the national science foundation , and the u.s .",
    "department of energy .",
    "the sdss - iii web site is http://www.sdss3.org/.    sdss - iii is managed by the astrophysical research consortium for the participating institutions of the sdss - iii collaboration including the university of arizona , the brazilian participation group , brookhaven national laboratory , university of cambridge , university of florida , the french participation group , the german participation group , the instituto de astrofisica de canarias , the michigan state / notre dame / jina participation group , johns hopkins university , lawrence berkeley national laboratory , max planck institute for astrophysics , new mexico state university , new york university , the ohio state university , university of portsmouth , princeton university , university of tokyo , the university of utah , vanderbilt university , university of virginia , university of washington , and yale university .",
    "this research made use of montage , funded by the national aeronautics and space administration s earth science technology office , computation technologies project , under cooperative agreement number ncc5 - 626 between nasa and the california institute of technology .",
    "montage is maintained by the nasa / ipac infrared science archive .",
    ", k.  n. , adelman - mccarthy , j.  k. , ageros , m.  a. , allam , s.  s. , allende prieto , c. , an , d. , anderson , k.  s.  j. , anderson , s.  f. , annis , j. , bahcall , n.  a. , & et  al .",
    "2009 , the seventh data release of the sloan digital sky survey        , g.  b. , deelman , e. , good , j.  c. , jacob , j.  c. , katz , d.  s. , kesselman , c. , laity , a.  c. , prince , t.  a. , singh , g. , & su , m .- h .",
    "2004 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol . 5493 , society of photo - optical instrumentation engineers ( spie ) conference series , ed .",
    "p.  j. quinn & a.  bridger , 221232    , g.  b. , good , j.  c. , curkendall , d.  w. , jacob , j.  c. , katz , d.  s. , prince , t.  a. , & williams , r. 2003 , in astronomical society of the pacific conference series , vol .",
    "295 , astronomical data analysis software and systems xii , ed .",
    "h.  e. payne , r.  i. jedrzejewski , & r.  n. hook , 343346                            , r. , gunn , j.  e. , ivezi ,  . ,",
    "knapp , g.  r. , & kent , s. 2001 , in astronomical society of the pacific conference series , vol .",
    "238 , astronomical data analysis software and systems x , ed .",
    "f.  r. harnden , jr .",
    ", f.  a. primini , & h.  e. payne , 269278                              llllll @xmath38 & ` v5_4 ` & @xmath67 & @xmath68 & @xmath69 & @xmath70 & ` v5_6 ` & @xmath71 & @xmath72 & @xmath73 & @xmath74 & global & @xmath75 & @xmath76 & @xmath77 & @xmath78@xmath60 & ` v5_4 ` & @xmath79 & @xmath80 & @xmath81 & @xmath82 & ` v5_6 ` & @xmath83 & @xmath84 & @xmath85 & @xmath86 & global & @xmath87 & @xmath88 & @xmath89 & @xmath90@xmath91 & ` v5_4 ` & @xmath92 & @xmath93 & @xmath94 & @xmath95 & ` v5_6 ` & @xmath96 & @xmath97 & @xmath98 & @xmath99 & global & @xmath100 & @xmath101 & @xmath89 & @xmath102@xmath103 & ` v5_4 ` & @xmath96 & @xmath104 & @xmath105 & @xmath106 & ` v5_6 ` & @xmath107 & @xmath108 & @xmath109 & @xmath110 & global & @xmath111 & @xmath112 & @xmath113 & @xmath114@xmath115 & ` v5_4 ` & @xmath116 & @xmath117 & @xmath118 & @xmath119 & ` v5_6 ` & @xmath120 & @xmath75 & @xmath121 & @xmath122 & global & @xmath123 & @xmath112 & @xmath124 & @xmath125@xmath126 & ` v5_4 ` & @xmath127 & @xmath128 & @xmath129 & @xmath130 & ` v5_6 ` & @xmath131 & @xmath132 & @xmath133 & @xmath134 & global & @xmath135 & @xmath89 & @xmath111 & @xmath136@xmath60 ( vs @xmath38 meas . ) & ` v5_4 ` & @xmath137 & @xmath138 & @xmath139 & @xmath140 & ` v5_6 ` & @xmath141 & @xmath142 & @xmath143 & @xmath144 & global & @xmath145 & @xmath118 & @xmath146 & @xmath147    lllllll petrosian & v5_4 & 6.359 & -6.609 & 3.129 & 0.767 & 0.291 & v5_6 & 4.643 & -4.487 & 2.320 & 0.614 & 0.540 cmodel & v5_4 & 11.784 & -10.470 & 2.453 & 0.538 & 0.357 & v5_6 & 9.510 & -8.239 & 1.995 & 0.362 & 0.509"
  ],
  "abstract_text": [
    "<S> we describe a procedure for background subtracting sloan digital sky survey ( sdss ) imaging that improves the resulting detection and photometry of large galaxies on the sky . within each sdss drift scan run , </S>",
    "<S> we mask out detected sources and then fit a smooth function to the variation of the sky background . </S>",
    "<S> this procedure has been applied to all sdss - iii data release 8 images , and the results are available as part of that data set . </S>",
    "<S> we have tested the effect of our background subtraction on the photometry of large galaxies by inserting fake galaxies into the raw pixels , reanalyzing the data , and measuring them after background subtraction . </S>",
    "<S> our technique results in no size - dependent bias in galaxy fluxes up to half - light radii @xmath0 arcsec ; in contrast , for galaxies of that size the standard sdss photometric catalog underestimates fluxes by about 1.5 mag . </S>",
    "<S> our results represent a substantial improvement over the standard sdss catalog results and should form the basis of any analysis of nearby galaxies using the sdss imaging data . </S>"
  ]
}