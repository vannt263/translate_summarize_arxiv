{
  "article_text": [
    "stochastic simulations of chemical reaction networks have become increasingly popular recently , largely due to the observation that stochastic noise plays a critical role in biological function .",
    "@xcite the issue is relevant in other scientific fields as well , such as microelectronics processing , where statistical variations in dopant profiles can profoundly affect the performance of nanoscale semiconductor devices .",
    "@xcite gillespie s stochastic simulation algorithm ( ssa ) ,  @xcite in particular , has found widespread use in computational biology . the method is a kinetic monte carlo approach that produces time - evolution trajectories correctly accounting for the inherent stochasticity associated with molecular interactions .",
    "detailed accuracy is achieved by explicitly simulating every reaction occurrence within a system .",
    "the method is computationally expensive as a result , however , and practical application is limited to only very small systems .    motivated by this fact",
    ", considerable effort has been undertaken recently to develop accelerated simulation methods capable of correctly accounting for stochastic noise but at significantly reduced computational cost .",
    "broadly speaking , these endeavors can be divided into three categories : ( i ) algorithmic advances to increase the efficiency of exact - stochastic methods ,  @xcite ( ii )  leaping \" techniques in which efficiency is enhanced by ignoring the exact moments at which reaction events occur ,  @xcite and ( iii )  partitioned \" methods in which sets of reactions are divided into various classifications , such as  fast \" and  slow , \" and treated either by applying appropriate numerical techniques to each subset (  methodology coupling \" or  hybrid \" )  @xcite or by reducing the model to incorporate the _ effects _ of the fast reactions into the dynamics of the slow (  model reduction \" ) .",
    "@xcite    in this article , we present a new simulation method for modeling chemical reaction dynamics that integrates exact - stochastic , leaping and methodology coupling methods into a single multiscale algorithmic framework .",
    "the fundamental theory underlying gillespie s @xmath0-leap approach  @xcite is used to formulate a theoretically justifiable partitioning scheme .",
    "the partitioning is based on the number of reaction firings expected within a calculated time interval and partitioning and time step determination are thus inextricably linked .",
    "based on the value of the time step each reaction is then  classified \" at one of various levels of description .",
    "species populations are updated for coarsely classified reactions using the leaping formulas introduced by gillespie ,  @xcite while rare events are treated via the methods of gibson and bruck s exact - stochastic next reaction method .",
    "@xcite overall , the technique efficiently simulates systems containing widely disparate species populations using rigorously derived classification criteria and requiring minimal user intervention .",
    "we begin in sec .",
    "[ sec : bkgrd ] by reviewing the theoretical foundations of exact - stochastic simulation and @xmath0-leaping .",
    "this provides a basis for discussing partitioned leaping in sec .",
    "[ sec : pla ] as well as various options for its practical implementation . in sec .",
    "[ sec : examples ] we present two illustrative examples demonstrating the utility of the method : one inspired by biology and a clustering example relevant to materials and atmospheric sciences . finally , in sec .",
    "[ sec : discuss ] we summarize the attributes of the method , discuss possible modifications , and draw conclusions regarding its place among the many alternative techniques that have been proposed .",
    "as is customary , we consider a well - mixed system of @xmath1 molecular species @xmath2 interacting via @xmath3 reaction channels @xmath4 in a volume @xmath5 at constant temperature .",
    "the state of the system is described by the vector @xmath6(@xmath7 ) , where @xmath8 represents the population of species @xmath9 at time @xmath7 .",
    "each reaction channel @xmath10 has associated with it a propensity function @xmath11 and a state - change ( or stoichiometric ) vector @xmath12 .",
    "@xcite the propensity @xmath11 is defined such that @xmath13 gives the probability that reaction @xmath10 will fire once during the infinitesimal time interval @xmath14 . in other words",
    ", @xmath11 is the stochastic analog to the deterministic _",
    "reaction rate_. as such , @xmath11 can be written as the product of a stochastic rate constant @xmath15 ( which is related to the deterministic rate constant via a simple scaling by the system volume )  @xcite and a combinatorial factor @xmath16 , which represents the number of distinct ways in which a realization of @xmath10 can occur . in general",
    ", @xmath16 is a simple function of the reactant species populations for @xmath10 .",
    "@xcite      given the definitions above , gillespie has developed a simulation methodology for modeling chemical reaction dynamics that  exactly \" accounts for the stochastic nature of the process .",
    "@xcite the stochastic simulation algorithm , or ssa , is exact in the sense that it produces _ possible _ time - evolution trajectories that are consistent with the underlying _ chemical master equation _ governing the physical process .",
    "@xcite    the ssa operates by generating , at each simulation step , random samples of reaction times ( @xmath0 ) and types ( @xmath17 ) and advancing the system forward in time accordingly . two alternative , yet equivalent , strategies exist for doing so .",
    "the first , dubbed the _ direct method _ ( dm ) , generates @xmath0 according to  @xcite @xmath18 while @xmath17 is the integer satisfying the relationship @xmath19 where @xmath20 and @xmath21 and @xmath22 are unit - uniform random numbers between 0 and 1 .",
    "the second approach considers each reaction in the system on an _ individual _ basis and asks the question ,  when will reaction @xmath10 next fire _ assuming _ that no other reactions fire first ? \"",
    "values of such  tentative \" next - reaction times , @xmath23 ,  @xcite are then generated for each reaction .",
    "@xmath0 is set equal to the smallest of these and @xmath17 to the corresponding reaction since this is the only one for which the assumption that no other reactions fire first actually holds .",
    "this approach was originally developed by gillespie  @xcite and dubbed the _ first reaction method _",
    "tentative next - reaction times are calculated via @xmath24 where @xmath25 is a unit - uniform random number .",
    "this approach has recently been modified by gibson and bruck .",
    "@xcite the next reaction method ( nrm ) is more computationally efficient in that a rigorous transformation formula is employed that significantly reduces the number of random number generations required during the course of a simulation .",
    "once a reaction has fired , a new value of @xmath23 is generated _ for that reaction only _ using eq .",
    "( [ eq : tau - first ] ) . for all other reactions @xmath26",
    "is used , where the unprimed and primed quantities signify new and old values , respectively .",
    "@xcite    it should be noted that a recent timing analysis  @xcite has shown that , while the nrm is certainly more efficient than the frm , an optimized version of the dm actually performs best in most situations . for our purposes , however , this fact is not important",
    ". the _ ideas _ underlying the frm are what we will use in the development of our new simulation approach , and the increased efficiency offered by the nrm will be utilized in its implementation .      despite the improved efficiency offered by the nrm  @xcite and the optimized version of the dm ,  @xcite",
    "the ssa remains limited as to the system size amenable to treatment due to its ",
    "one reaction at a time \" nature . as a result ,",
    "gillespie has recently attempted to move beyond the  exact \" approach by introducing approximations regarding the number of times a reaction can be expected to fire within a given time interval .",
    "his approach , known as @xmath0-leaping , begins by defining the quantity @xmath27 as the number of times reaction channel @xmath10 fires during the time interval @xmath28 .",
    "@xcite in general , @xmath27 is a complex random variable dependant upon the propensity @xmath11 and the manner in which it changes during @xmath28 . obtaining a rigorous expression for the probability function governing @xmath27",
    "is thus tantamount to solving the usually intractable chemical master equation .",
    "gillespie recognized , however , that if a time period exists over which the propensity @xmath11 remains _ essentially _ constant then one can approximate @xmath27 as a _ poisson random variable _ ,  @xcite @xmath29 there always exists a value of @xmath0 over which this assumption holds ; in the extreme case it is the interval between successive reactions . in many cases ,",
    "however , the interval is likely to span numerous reaction events , especially when the reactant populations are  large . \"",
    "@xcite gillespie then noted that if the mean value of @xmath30 , i.e. , @xmath31 , is ",
    "large , \" then one can approximate the poisson random variable as a _ normal _",
    "random variable ,  @xcite @xmath32 where the second equality follows from the linear combination theorem for normal random variables .",
    "@xcite equation  ( [ eq : k - norm ] ) is essentially a chemical langevin equation and amounts to a  continuous - stochastic \" representation of the reaction dynamics .",
    "finally , gillespie showed that if the ratio of the  deterministic \" term in ( [ eq : k - norm ] ) , @xmath31 , to the  noise \" term , @xmath33 , is  large ,",
    "\" then the noise term can be neglected , leaving  @xcite @xmath34 or a  continuous - deterministic \" representation .",
    "the expressions in eqs .",
    "( [ eq : k - poisson])([eq : k - determ ] ) represent a theoretical  bridge \" connecting the discrete - stochastic representation of reaction dynamics and the more familiar continuous - deterministic description . with reactions classified at one of these levels of description ,",
    "these formulae are used in @xmath0-leaping to determine the number of times each reaction fires within a given time interval .",
    "one is thus able to  leap \" forward in the temporal evolution of a system multiple reaction firings at a time .",
    "implementing these ideas algorithmically requires a practical method for determining the time interval over which the poisson approximation ( [ eq : k - poisson ] ) can be expected to hold .",
    "@xmath0-selection has been the subject of extensive research  @xcite and has undergone numerous refinements recently .",
    "the basic idea is to impose a constraint on the magnitude of the change of an individual reaction propensity , @xmath35 where @xmath36 is an appropriate scaling factor . in applying this constraint ,",
    "one seeks to identify the time interval @xmath37 over which the propensity @xmath11 for reaction @xmath10 will remain essentially constant within a factor of @xmath38 _ assuming _ that the propensities for all other reactions also remain essentially constant .",
    "one then , in essence , calculates a value of @xmath37 for each reaction in the system and sets @xmath0 equal to the smallest of these .",
    "we will discuss @xmath0-selection further in sec .",
    "[ subsec : pla - timestep ] . for",
    "now , however , note that there is an interesting analogy between the procedure used in @xmath0-leaping and that in the frm ( and nrm by extension ) . in both cases ,",
    "a time interval is calculated for a specific reaction channel with assumptions made regarding all other reaction channels .",
    "the time step is then set equal to the smallest of the set as it is the only one for which the assumptions actually hold .",
    "this suggests that the two methods might be seamlessly merged in some way , and forms the basis of our new simulation approach .    with the time step @xmath0 calculated ,",
    "one then proceeds to determine the number of times each reaction fires in @xmath0 using eqs .",
    "( [ eq : k - poisson])([eq : k - determ ] ) . strictly speaking",
    ", the @xmath0-leap method uses only eq .",
    "( [ eq : k - poisson ] ) . if the propensities of _ all _ reactions are such that @xmath39 , however , then eq .  ( [ eq : k - norm ] ) is employed . in ref .",
    "this is termed the _",
    "langevin method_. furthermore , if all @xmath40 then eq .  ( [ eq : k - determ ] )",
    "is employed , which is equivalent to the explicit euler method for solving ordinary differential equations .",
    "@xcite finally , a _ proviso _ is added  @xcite whereby the ssa is used if @xmath41 , since @xmath42 is the expected time to the next reaction firing in the system .",
    "@xcite    additional modifications to @xmath0-leaping have been introduced recently .",
    "primarily , strategies have been developed to prevent the possible occurrence of negative species populations .",
    "this possibility arises from the fact that poisson and normal random variables are positively unbounded and , while unlikely , could produce physically unrealizable numbers of reaction firings that result in the consumption of more reactant entities than are present in the system .",
    "tian and burrage  @xcite and chatterjee  _ et al . _",
    "@xcite avoid this problem by using binomial random numbers rather than poisson .",
    "cao  _ et al . _",
    "@xcite identify  critical \" reactions deemed in danger of exhausting their available reactant populations and treat them using a dm ssa approach .",
    "the interested reader is referred to ref .   for further details regarding the current state of @xmath0-leaping methodologies .",
    "the primary change that we make to @xmath0-leaping involves classifying reactions _ individually _ once the time step @xmath0 has been determined .",
    "the expressions ( [ eq : k - poisson])([eq : k - determ ] ) are derived for individual reactions and there is nothing precluding their use in this manner .",
    "thus , sets of reactions can essentially be partitioned into  fast , \"  medium , \" and  slow \" classifications based on the quantities @xmath43 .",
    "we can apply gillespie s _ proviso _",
    "@xcite to each individual reaction as well , essentially classifying a reaction as  very slow \" if @xmath44 . a tentative next - reaction time for such a reaction",
    "can then be generated from eqs .",
    "( [ eq : tau - first ] ) or ( [ eq : tau - next ] ) and @xmath10 deemed to fire if @xmath45 .",
    "this procedure amounts to a theoretically justifiable partitioning scheme in which reactions are classified into four different categories based on their propensity values , the calculated time step @xmath0 , and the criteria identified by gillespie  @xcite for transitioning between the descriptions ( [ eq : k - poisson])([eq : k - determ ] ) .",
    "the classifications are made as follows :    * if @xmath46 @xmath47 _ exact stochastic _",
    "( very slow ) * if @xmath48 but @xmath49 @xmath47 _ poisson _ ( slow ) * if @xmath50 but @xmath51 @xmath47 _ langevin _ ( medium ) * if @xmath52 @xmath47 _ deterministic _ ( fast )    [ list : classify ]    these classifications constitute the basis of the partitioned leaping approach . at each simulation step , a time step @xmath0 is calculated and each reaction classified in the manner outlined above .",
    "the numbers of reaction firings are then determined , based on these classifications , using eqs .",
    "( [ eq : tau - first])([eq : k - determ ] ) and the system evolved accordingly .",
    "various technical issues must be considered , however , in order to correctly implement this approach .",
    "the first involves the inclusion of the  exact stochastic \" ( es ) classification and the random nature of @xmath23 .",
    "specifically , if @xmath53 , and the clock is subsequently advanced by @xmath0 , then the possibility of @xmath10 firing again within the interval @xmath54 is precluded . to overcome this complication we employ an iterative procedure for determining @xmath0 and classifying reactions .",
    "once the reaction classifications are made @xmath23 values are calculated for all es reactions .",
    "some of these may be smaller than @xmath0 , and @xmath0 is thus adjusted to the smallest of these .",
    "decreasing @xmath0 will result in decreased values of @xmath43 and each reaction must thus be reclassified .",
    "some reclassified reactions may become es which previously were not and @xmath23 values must thus be calculated for all of these reactions .",
    "again , these may be smaller than @xmath0 and the procedure is thus repeated until no further adjustments are necessary .",
    "@xcite    situations may also arise in which all values of @xmath23 are larger than @xmath0 . in this case , we leave @xmath0 unchanged _ unless _ all reactions in the system are classified as es .",
    "this is because when all reactions are es it is always safe to allow @xmath0 to increase to the time at which the next reaction will fire in the system .",
    "when more coarsely classified reactions are present , however , this is not always so . in situations where the coarse reactions are independent of the es reactions it _ is _ safe to increase @xmath0 . automatically and efficiently differentiating between this situation and that in which it is not acceptable to increase @xmath0 is not trivial , however , especially when considering large , complex reaction networks .",
    "another issue to consider concerns the proper use of eq .",
    "( [ eq : tau - next ] ) in our algorithm .",
    "the expression in ( [ eq : tau - next ] ) is a transformation formula in which a new value of @xmath23 is calculated using the new value of @xmath11 , the old value of @xmath11 , the old value of @xmath23 , and the old time step . under normal circumstances , the  old \" values are those from the previous simulation step . as discussed in note 14 of ref .",
    ", however , this is not always the case . specifically , when a reaction becomes inactive , @xmath55 and @xmath56 . upon reactivation",
    ", these values clearly can not be used in eq .",
    "( [ eq : tau - next ] ) .",
    "thus , the values of @xmath11 , @xmath23 and @xmath0 are used from the last simulation step at which @xmath10 was active .",
    "values of @xmath57 are stored for all reactions that did not fire at the current step and used in eq .",
    "( [ eq : tau - next ] ) at the next step at which the corresponding reactions are active .",
    "usually this is the subsequent step , but sometimes it is not .    in our approach , we must account for the fact that reactions classified as es can change their classification in the subsequent step and then return to an es classification at a later step .",
    "although the reaction does not become inactive in this case , the same procedure of  carrying over \" the values of @xmath11 , @xmath23 and @xmath0 is used .",
    "we simply extend the procedure described above , therefore , and use the stored values of @xmath58 at the next step at which the corresponding reactions are active _ and _ are classified as es .",
    "we also consider the problem of negative populations .",
    "we avoid this problem by simply tracking the state of the system and reversing the population updates if any populations are found to be negative after all reaction firings have been accounted for . the value of @xmath0 is then reduced ( which is always acceptable ) and all reactions reclassified .",
    "we reduce @xmath0 by 50% , but any amount should suffice .",
    "a reduction in @xmath0 will result in smaller numbers of reaction firings and , hopefully , alleviation of all negative populations . if not",
    ", then the procedure is repeated until no further adjustments are necessary .",
    "@xcite    this approach is equivalent to the simple  try again \" procedure discussed and implemented in ref .   as a second layer of protection against the occurrence of negative populations",
    "this is used in conjunction with the primary strategy of identifying critical reactions .",
    "note , however , that the critical reaction strategy essentially amounts to a partitioning of reactions into es and  poisson \" classifications with the intent of avoiding negative populations by maintaining a fine - level description of reactions with small reactant populations .",
    "our method already accomplishes this via inclusion of the es classification and thus avoids the need to introduce additional calculations or parameters ( see sec .",
    "[ sec : discuss ] for a further discussion ) .    finally , in determining the set of reaction firings , use of eqs .",
    "( [ eq : k - norm ] ) and ( [ eq : k - determ ] ) for  langevin \" and  deterministic \" reactions , respectively , will result in values that are real numbers rather than integers . since it is difficult to determine at what point a continuous population description is acceptable in lieu of an integer description , we choose to round these values before updating the species populations . in ref .",
    "it was argued that use of eq .",
    "( [ eq : k - norm ] ) as opposed to ( [ eq : k - poisson ] ) is an improvement computationally since generation of normal random numbers is faster than poisson random numbers .",
    "some of this improvement is clearly negated , therefore , by including a subsequent rounding operation , although we have yet to quantitatively investigate the extent of this effect . while the same argument holds for  deterministic \" reactions , the elimination of the random number generation operation should more than compensate for the added rounding procedure .    with these issues accounted for ,",
    "the partitioned leaping algorithm ( pla ) is presented as follows :    1 .",
    "initialize ( species populations , rate constants , define @xmath59 , @xmath60 , @xmath38 , etc . ) .",
    "2 .   determine the _ initial _ value of @xmath0 ( see sec .",
    "[ subsec : pla - timestep ] ) .",
    "3 .   classify all reactions ( not already classified as es ) using the criteria presented above .",
    "4 .   for all ( newly classified ) es reactions , calculate tentative next - reaction times , @xmath23 , using eqs .",
    "( [ eq : tau - first ] ) and ( [ eq : tau - next ] ) . 5 .",
    "if @xmath61 _ and _ all reactions are es , set @xmath62 .",
    "if @xmath63 , set @xmath64 and return to step 3 . 7 .",
    "determine the set of reaction firings @xmath65 using the appropriate formulas  @xcite and update the species populations .",
    "if any @xmath66 , reverse all population updates , set @xmath67 and return to step 3 . if not , advance the clock by @xmath0 and return to step 2 if stopping criterion not met .",
    "it is important to recognize the minimal user intervention required to implement this approach .",
    "once the reaction network is defined and the associated rate parameters set , one need only define three model-_independent _ parameters quantifying the concepts @xmath59 ( for es classification ) , @xmath60 ( for coarse classifications ) and @xmath68 ( defining @xmath38 ) .",
    "the algorithm then automatically and dynamically partitions the reactions into various subsets , correctly accounting for stochastic noise and  leaping \" over unimportant reaction events .      in practice , there are two alternate approaches for carrying out step  2 of the pla .",
    "the first is a reaction - based approach in which values of @xmath37 are calculated for each reaction in the system using the constraint expression in ( [ eq : constraint ] ) directly .",
    "@xcite @xmath0 is then set equal to @xmath69 .",
    "older versions did this with @xmath70 in ( [ eq : constraint ] ) ,  @xcite but the current approach uses @xmath71 .",
    "@xcite in this approach , @xmath37 is given by  @xcite @xmath72    here , @xmath73 represents the _ minimum _ possible change in the propensity @xmath11 .",
    "this quantity is used to overcome problems associated with small reactant populations . in ref .",
    ", @xmath74 , the stochastic rate constant for @xmath10 . for first - order reactions",
    "this definition is exact . for higher - order reactions",
    ", however , this is a lower bound : if the propensity changes at all it will do so by an amount @xmath75 .",
    "@xcite thus , this approach is simple but may also be restrictive .",
    "we propose an alternative : an _ approximate _ but less restrictive value of @xmath73 is the smallest _ non - zero _ value of @xmath76 , where @xmath77 indexes all reactant species involved in @xmath10 .",
    "if all values of @xmath76 are zero , however , then @xmath78 .    the second approach for determining @xmath0",
    "constrains the relative changes in the _ species populations _ in such a way that ( [ eq : constraint ] ) is satisfied for all reactions .",
    "@xcite @xmath0 is then set equal to @xmath79 , where  @xcite @xmath80 the parameter @xmath81 depends on the highest - order reaction that species @xmath9 is involved in and can be determined by simple inspection during initialization .",
    "@xcite the expressions in ( [ eq : teeleap ] ) require fewer computational operations than those in ( [ eq : tauleap ] ) and each @xmath82 calculation should thus be significantly faster than each @xmath37 .    in ref .",
    ", expressions for @xmath81 are presented for all reaction types up to third order . for reactions involving more",
    "than one entity of a certain species , such as @xmath83 , @xmath81 is a function of @xmath84 .",
    "these expressions have clear upper and lower bounds , however .",
    "thus , in order to simplify the calculations we use the more restrictive , but computationally simpler , upper bounds .",
    "we determine @xmath81 as follows :    [ cols=\">,<\",options=\"header \" , ]     note that the last item will result in @xmath85 , which will never be @xmath79 .",
    "with the presentation of our simulation approach now complete , we will demonstrate in this section the utility of the method , in terms of efficiency and accuracy , via two illustrative examples .",
    "we will begin by considering a simple model of clustering that illustrates the algorithm s ability to treat systems in which species populations vary over many orders of magnitude .",
    "a biologically inspired model system will then be considered that illustrates how the stochastic process of gene expression can be accurately and efficiently simulated in conjunction with reactions involving large reactant populations ( e.g. , metabolic processes ) .",
    "clustering processes are inherently multiscale since large numbers of small clusters generally coexist within a system with small numbers of large clusters . as such , clustering provides an ideal way to demonstrate the ability of the pla to treat systems in which species populations vary over many orders of magnitude .",
    "we have considered a simple clustering model comprised of the following nine reactions : @xmath86{$r_1:\\,\\,$ \\hfill $ 2s_1 $ }        & \\rightarrow & s_2 \\label{ex : cluster } \\\\      \\makebox[\\fill]{$r_2:\\,\\,$ \\hfill $ s_1 + s_2 $ }   & \\rightarrow & s_3 \\nonumber \\\\      \\makebox[\\fill]{$r_3:\\,\\,$ \\hfill $ s_1 + s_3 $ }   & \\rightarrow & s_4 \\nonumber \\\\",
    "\\vdots & & \\nonumber \\\\",
    "\\makebox[\\fill]{$r_9:\\,\\,$ \\hfill $ s_1 + s_9 $ }   & \\rightarrow & s_{10 } \\nonumber\\end{aligned}\\ ] ] for the sake of simplicity we have neglected dissociation reactions and assume that monomers ( @xmath87 ) are the only mobile species in the system . furthermore , in order to confine the multiscale effects to variations in the species populations alone , we have chosen deterministic rate constants such that their stochastic counterparts are equivalent for all reactions .",
    "for @xmath88 we choose @xmath89  m@xmath90  s@xmath90 , and for all other reactions @xmath91  m@xmath90  s@xmath90 .",
    "we set the initial monomer concentration to @xmath92  m and consider various system volumes @xmath5 ranging from @xmath93 to @xmath94  l. this corresponds to initial monomer populations @xmath95 to @xmath96 and stochastic rate constants @xmath97 to @xmath98  s@xmath90 .",
    "all simulations were run until consumption of all monomers was complete .    in fig .",
    "[ fig : clust - steps - cpu ] , we compare average numbers of simulation steps and cpu times required for pla and ssa simulations of ( [ ex : cluster ] ) at all system sizes considered . in general , the cpu times follow the same trends as the simulation steps and the reaction - based calculations ( pla - rb ) require more steps , and more cpu time , than the species - based ( pla - sb ) .",
    "we also see that for the smallest system size the ssa and pla give identical results , meaning that all reactions were classified as es at all steps of the pla simulations . as the system size increases , however ,",
    "increased amounts of leaping are observed .",
    "the effect is modest for system sizes of @xmath99 and @xmath100  l , but increases dramatically beyond that .",
    "moreover , the number of steps actually _ decreases _ for pla simulations of systems larger than @xmath101  l. the effects of leaping thus overtake the system size effects for these large systems .",
    "pla and ssa simulation runs of the simple clustering model ( [ ex : cluster ] ) [ pla - rb-1% means reaction - based @xmath0-selection with @xmath102 , etc . ] .",
    "reaction classifications were made in the pla runs using @xmath103 and @xmath104 .",
    "all simulations were performed on a 1.80  ghz athlon processor .",
    "[ fig : clust - steps - cpu ] ]    in fig .",
    "[ fig : clust - classif-1e9 ] , we show the classifications achieved for each reaction in ( [ ex : cluster ] ) at each simulation step of a single pla - rb-3% simulation at a system size of @xmath94  l. these results show leaping in action and illustrate the inherent multiscale nature of the reaction network .",
    "reactions involving the smallest clusters ( i.e. , @xmath88@xmath105 ) experience extensive amounts of leaping for much of the simulation , with classifications varying rapidly between es ,  poisson , \"  langevin \" and , at times ,  deterministic .",
    "\" conversely , reactions involving larger clusters experience much less leaping . reactions",
    "@xmath106@xmath107 , for example , experience only small amounts of leaping up into the  langevin \" regime .    )",
    "at @xmath108  l [ i.e. , @xmath109 .",
    "classifications are : ( 1 ) exact stochastic , ( 2 ) poisson , ( 3 ) langevin , ( 4 ) deterministic .",
    "results are for a single pla - rb-3% simulation using @xmath103 and @xmath104 .",
    "[ fig : clust - classif-1e9 ] ]    as for accuracy , smoothed frequency histograms ( see appendix ) were generated from @xmath110 simulation runs of the ssa and the pla for various cluster sizes ( the populations of which vary by as many as four orders of magnitude ) at various system sizes .",
    "modified versions of the histogram distance @xmath111 and the self distance @xmath112 , introduced by cao and petzold ,  @xcite were then used to make quantitative comparisons . in all cases ,",
    "the calculated histogram distances were smaller than the ssa self distances , indicating excellent accuracy ( see the appendix for further details ) .",
    "the origins and consequences of stochasticity in biological systems has been a subject of intense interest recently .",
    "@xcite in cellular systems , the primary source of  intrinsic \" stochastic noise is gene expression , where the small numbers of regulatory molecules involved in the process result in proteins being produced in  bursts \" rather than continuously .",
    "@xcite other cellular processes , such as metabolism , often involve large numbers of molecules and it has been shown that stochastic fluctuations in gene expression can quantitatively affect these dynamics .",
    "@xcite a fully stochastic treatment of biological systems involving both gene expression and metabolism is infeasible ,  @xcite however , and thus provides motivation for developing multiscale simulation methods capable of treating systems involving both large- and small - number dynamics .",
    "we have applied the pla to a simple biologically inspired model system that involves both gene expression and protein - protein interactions .",
    "the network that we have considered is as follows : @xmath86{$r_1:\\,\\,$ \\hfill $ g$ }            & \\rightarrow & g^\\ast       \\label{ex : geneexpr } \\\\",
    "\\makebox[\\fill]{$r_2:\\,\\,$ \\hfill $ g^\\ast$ }       & \\rightarrow & g + np       \\nonumber \\\\",
    "\\makebox[\\fill]{$r_3:\\,\\,$ \\hfill $ p + q$ }        & \\rightarrow & \\{p\\!:\\!q\\ } \\nonumber \\\\",
    "\\makebox[\\fill]{$r_4:\\,\\,$ \\hfill $ \\{p\\!:\\!q\\}$ } & \\rightarrow & r + q        \\nonumber \\\\",
    "\\makebox[\\fill]{$r_5:\\,\\,$ \\hfill $ r$ }            & \\rightarrow & \\ast         \\nonumber\\end{aligned}\\ ] ] the first two reactions constitute the gene expression part of the network , where the single gene @xmath113 spontaneously converts into an active conformation @xmath114 that then produces proteins @xmath115 in bursts of @xmath116 .",
    "the third and fourth reactions constitute the protein - protein enzymatic part of the network where @xmath115 interacts with @xmath117 to form an enzyme - substrate complex @xmath118 that then produces @xmath119 and regenerates @xmath117 .",
    "the final reaction models the degradation of @xmath119 .",
    "rate constants for the five reactions in ( [ ex : geneexpr ] ) were set equal to 750  s@xmath90 , 750  s@xmath90 , @xmath120  m@xmath90  s@xmath90 , 100  s@xmath90 , and 50  s@xmath90 , respectively .",
    "the initial enzyme concentration @xmath121_\\mathrm{o}$ ] was set equal to @xmath122  m , @xmath116 to @xmath123 ,  @xcite and investigations were carried out for various system sizes ranging from @xmath93 to @xmath124  l. this corresponds to initial enzyme populations @xmath125 ranging from @xmath126 to @xmath127 . in all cases ,",
    "the system began with a single entity of @xmath113 and null populations of @xmath114 , @xmath118 and @xmath119 .",
    "all simulations were run until @xmath128  s.    in fig .",
    "[ fig : geneexpr - conc_tau-1e6 ] , we show typical results for pla - rb-3% simulations of ( [ ex : geneexpr ] ) . the time course plot in fig .",
    "[ fig : geneexpr - conc_tau-1e6](a ) , generated for a system size of @xmath129  l , illustrates the stochastic nature of the gene expression dynamics , apparent in the noisy time evolution of the gene product @xmath115 .",
    "conversely , the large - number dynamics result in much smoother trajectories for @xmath117 , @xmath118 and @xmath119 . the time step plot in fig .",
    "[ fig : geneexpr - conc_tau-1e6](b ) , taken from the same simulation as in [ fig : geneexpr - conc_tau-1e6](a ) , illustrates the algorithm s ability to dynamically adjust as the system evolves .",
    "the first 3000 simulation steps correspond to @xmath130  s of simulated time , while a time of @xmath131  s is reached around step 6400 .",
    "the entire simulation takes @xmath132 steps to complete .",
    "thus , simulating the first 1% of the evolved time required @xmath133 of all simulation steps and the first 10% @xmath134 of all steps .    in fig .",
    "[ fig : geneexpr - conc_tau-1e6](c ) , we see how the classifications coarsen with increasing system size .",
    "for @xmath135  l the classifications for @xmath136 never reach beyond  poisson . \"",
    "for @xmath137  l the classifications coarsen approximately midway through the simulation , and for @xmath138  l  deterministic \" status is achieved quickly and maintained almost exclusively throughout .",
    "similar results are obtained for reactions @xmath105 and @xmath139 ( data not shown ) while @xmath88 and @xmath140 are classified as es at all steps of the simulation .    , @xmath104 ) of the simple gene expression model ( [ ex : geneexpr ] ) : ( a ) a typical time course at @xmath141  l , ( b ) value of the time step at each simulation step for the same run as in ( a ) , ( c ) classifications vs.  simulation step for reaction @xmath136 at various system sizes .",
    "[ fig : geneexpr - conc_tau-1e6 ] ]    in fig .",
    "[ fig : geneexpr - steps - cpu ] , we compare the average numbers of simulation steps and the cpu times required for pla and ssa simulations of ( [ ex : geneexpr ] ) .",
    "again we see that the cpu times generally follow the same trends as the simulation steps but , contrary to what is observed in sec .",
    "[ subsec : cluster ] , the sb calculations require more steps , and longer cpu times , than the rb .",
    "the efficiencies of the two @xmath0-selection procedures thus appear to be system - dependent .",
    "this is an interesting result and an area of possible future investigation .",
    "we also see in fig .",
    "[ fig : geneexpr - steps - cpu ] that the general trend for the simulation steps is an initial increase with system size , followed by a drop , another increase and then another drop with an eventual leveling off ( the only departure from this is for the pla - rb-3% where the number of steps initially decreases with system size ) .",
    "the initial behavior is the same as that seen for the simple clustering model ( see fig .",
    "[ fig : clust - steps - cpu ] ) and can easily be explained in terms of a competition between system size and leaping effects .",
    "the second increase is unique to this example , however , and arises from an increasing fraction of simulations requiring large numbers of steps . at @xmath142  l , for example , 95% of all pla - rb-1% simulations require between 38078 and 437061 steps to complete . at @xmath143",
    "l , the range is 38081 and 142687 .",
    "the stochastic nature of the gene expression dynamics thus results in a wide variety of possible time - evolution trajectories for systems of size @xmath129 to @xmath94  l , some of which require many more simulation steps to complete than others .",
    "the ability of the pla to handle systems in this  medium \" size range is a particular strength of the method .",
    "pla and ssa simulation runs of the simple gene expression model ( [ ex : geneexpr ] ) .",
    "reaction classifications were made in the pla runs using @xmath103 and @xmath104 .",
    "all simulations were performed on a 1.80  ghz athlon processor .",
    "[ fig : geneexpr - steps - cpu ] ]    finally , in terms of accuracy , we generated smoothed frequency histograms for each species in ( [ ex : geneexpr ] ) at various system sizes and again observed excellent agreement between the pla and ssa .",
    "in all cases , the calculated histogram distances were smaller than the ssa self distances .",
    "in this article , we have presented a new multiscale simulation approach , termed the  partitioned leaping algorithm , \" for modeling stochasticity in chemical reaction networks .",
    "clearly , this method is closely related to @xmath0-leaping .",
    "@xcite the key difference is that reactions are classified individually in the pla , which leads to various advantages over @xmath0-leaping : the pla overcomes the problem of negative populations more simply , the ssa is incorporated into the algorithmic framework in a more seamless and natural way and reactions are treated at four levels of description rather than two .    the negative populations problem is avoided in the pla primarily through the structure of the algorithm .",
    "this can be seen most easily by considering the rb @xmath0-selection procedure ( [ eq : tauleap ] ) , though the arguments hold for the sb approach as well .",
    "if a reaction has a small reactant population , such that the reaction would be deemed  critical \" in @xmath0-leaping ,  @xcite then its @xmath37 value will be @xmath144 , the expected time of its next firing .",
    "this is because , for very small reactant populations , a single firing will change @xmath11 by a fractional amount @xmath145 , which will be automatically recognized in the @xmath0-selection process . as a result",
    ", the reaction will be classified as es ( since @xmath0 is always @xmath146 ) and thus prevented from firing more than once , assuring that its reactant populations do not fall below zero . since this outcome arises as a natural consequence of the design of the pla ,",
    "there is no need for additional calculations or parameters , such as those associated with the critical reaction search in @xmath0-leaping .",
    "@xcite    another difference between the methods is that in @xmath0-leaping the @xmath0-selection formulas ( [ eq : tauleap ] ) and ( [ eq : teeleap ] ) are applied only to non - critical reactions .",
    "@xcite in the pla , these formulas are applied to all reactions .",
    "this is merely a superficial difference , however .",
    "although critical reactions are treated separately from non - critical reactions in @xmath0-leaping , they still contribute to @xmath0-selection , just in a different way . in @xmath0-leaping ,  candidate \" time steps are calculated for the critical and non - critical reaction subsets and @xmath0 set equal to the smaller of the two .",
    "@xcite the critical reaction time step is calculated using eq .",
    "( [ eq : direct - tau ] ) with @xmath147 replaced by @xmath148 , the sum of the critical reaction propensities . obviously , this will give a time interval on the order of @xmath149 . in the pla",
    ", these same reactions will be treated using eqs .",
    "( [ eq : tauleap ] ) or ( [ eq : teeleap ] ) . as just discussed , in the pla - rb scenario the result will be @xmath37 values on the order of @xmath150 .",
    "@xmath0 is set equal to @xmath69 , so the overall result is essentially the same : the  critical \" reactions contribute to the @xmath0-selection process a time interval on the order of @xmath149 .",
    "the randomness associated with these reactions is then added in in step  4 of the pla using the methods of the nrm  @xcite [ eqs .",
    "( [ eq : tau - first ] ) and ( [ eq : tau - next ] ) ] , which is the obvious choice given the structure of the algorithm .",
    "the ability of the pla to treat reactions at the continuous - stochastic and deterministic scales , rather than just the discrete - stochastic , is an important attribute of the method as well ; the pla could be seen as unifying , into one overarching approach , three different types of simulation methods : exact - stochastic ,  @xcite @xmath0-leaping ,  @xcite and methodology coupling , or hybrid , techniques .",
    "@xcite hybrid methods operate by partitioning reactions into  fast \" and  slow \" subsets and using , e.g. , deterministic reaction rate equations or stochastic differential equations , to describe the fast reactions and the ssa ( or modified versions thereof ) for the slow .",
    "the primary shortcoming of these approaches is the lack of a sound theoretical basis for the partitioning scheme ,  @xcite which calls into question the extent of their utility .",
    "the partitioning procedure described in sec .",
    "[ subsec : pla - algo ] overcomes this problem ; partitioning is accomplished via gillespie s rigorously derived criteria for transitioning between the descriptions ( [ eq : k - poisson])([eq : k - determ ] ) .",
    "@xcite of course , as currently formulated ,  langevin \" and  deterministic \" reactions are treated in a manner equivalent to the explicit euler method for solving stochastic and ordinary differential equations , respectively , which may not be satisfactory in all cases .    recognizing this , petzold and co - workers have developed various",
    " implicit \" @xmath0-leaping methods  @xcite that take into account the values of the propensities at both the beginning _ and _ end of the time step @xmath0 . by doing so , these methods are able to take larger time steps than explicit methods  @xcite that only consider the propensity at the beginning of the step ( the algorithm presented here is explicit ) .",
    "this comes at a cost , however : implicit methods dampen fluctuations in the species populations and , hence , underestimate the amplitude of the noise .",
    "@xcite nevertheless , the ability of these methods to maintain stability in situations where explicit methods fail has been demonstrated .",
    "incorporating these ideas into the pla is an interesting possibility , and an area of possible future investigation .    from a _",
    "practical _ point of view , it is unclear to what extent the efficiency of the pla is actually improved by including the  langevin \" and  deterministic \" classifications . as mentioned above ,",
    "the reason for including these is to presumably improve computational efficiency via faster generation of normal random numbers  @xcite or by eliminating random number generation altogether .",
    "their inclusion adds complexity to the method , however . to",
    "what extent this attenuates the gains in efficiency remains to be seen , and is something we plan on investigating further in the future .",
    "note , however , that a useful feature of the pla is its ability , via manipulation of the classification parameters , to force a simulation at a particular level of description ( e.g. , if @xmath151 , then all reactions will be classified as es at all steps of a simulation  see sec .",
    "[ subsec : pla - algo ] ) . with the coarse classifications",
    "included , one could use this feature ( with rounding turned off ) to perform , e.g. , deterministic simulations of a system for direct comparisons to results from the pla .    finally , we must also acknowledge the primary shortcoming of the pla , namely , in handling systems with widely disparate rate constants . consider a system that contains a single entity , such as a gene , experiencing rapid on / off or binding / unbinding behavior . because there exists only one entity these reactions",
    "will be flagged as es , and because of the large rate constants their @xmath37 values ( in the pla - rb ) will be small .",
    "the result will be small time steps and a  bogging down \" of the pla .",
    "note that this is a problem in @xmath0-leaping as well .",
    "the only way to overcome this problem is to  reduce \" the model so that the effects of the fast reactions are accounted for in some approximate way . this is a common approach ; examples include quasi - steady - state or michaelis - menten reductions .",
    "recently , more advanced model reduction schemes have been proposed that can be applied to generalized reaction networks  @xcite and , in some cases , dynamically .",
    "@xcite since these methods are specifically designed to overcome problems associated with widely disparate rate constants they could form an effective complement to leaping techniques that tackle the problem of widely disparate species populations .",
    "future techniques combining automatic and dynamic model reduction with partitioned leaping could open the door to computational investigations far beyond the reach of current approaches .",
    "f.  a.  escobedo , h. lee , a.  a.  quong , a.  j.  golumbfskie and c.  f.  melius are thanked for useful discussions regarding this work .",
    "we acknowledge financial support from the semiconductor research corporation graduate fellowship program .",
    "for a set of @xmath1 data points @xmath152 , the total number falling within a discrete interval @xmath153 can be formally written as @xmath154 , where @xmath155 is the dirac delta function and the integral equals unity if @xmath156 lies within @xmath153 and zero otherwise .",
    "a  histogram density \" can then be obtained by dividing this quantity by @xmath157 and taking the limit as @xmath158 , @xmath159 the  hat \" in @xmath160 signifies that this quantity is a statistical _ estimator _ of the true histogram density @xmath161    a  smoothed \" histogram can then be obtained by approximating the delta function in ( [ eq : h - hat ] ) by a finite width gaussian @xmath162 , where @xmath163 is a normalization constant and @xmath164 is the ( user - defined ) variance . substituting into ( [ eq",
    ": h - hat ] ) , noting that to first order @xmath165 , and normalizing , gives @xmath166 all smoothed histograms generated in this work were obtained using this expression .",
    "examples are shown in fig .",
    "[ fig : dd - x2 ] , obtained from 10000 pla and ssa simulations of the  decaying - dimerizing \" reaction set using the same rate parameters and initial conditions as in ref .  .     at @xmath167 obtained from @xmath110 simulation runs of the  decaying - dimerizing \" reaction set  @xcite using the ssa and the pla - rb with various values of @xmath38 .",
    "reaction classifications were made in the pla runs using @xmath103 and @xmath104 .",
    "all histograms were generated using eq .",
    "( [ eq : h - hat - approx ] ) with @xmath168 .",
    "[ fig : dd - x2 ] ]    in order to quantitatively compare results obtained via different simulation methods ( i.e. , pla , ssa , etc . )",
    "we use the  histogram distance \" discussed by cao and petzold .",
    "@xcite the quantity @xmath169 is defined as @xmath170 and the histogram distance @xmath111 is then @xmath171 the factor of 1/2 assures that @xmath111 lies within [ 0,1 ) , with 0 constituting a perfect fit and 1 a complete mismatch .",
    "it is important to note that @xmath111 is defined in ( [ eq : d ] ) in terms of the _ true _ histogram densities @xmath172 and @xmath173 . in practice",
    ", we only have their estimators and can thus only calculate an estimated value of @xmath111 . as a result , a certain amount of statistical uncertainty is associated with the comparison of histograms . in order to quantify this uncertainty cao and petzold  @xcite introduce the  self distance , \" @xmath174 , which essentially measures the distance between the estimator @xmath160 and the true density @xmath175 .",
    "expressions for the upper bounds on the mean and variance of @xmath174 are presented in ref .   in terms of the number of bin intervals",
    "however , since we are using eq .",
    "( [ eq : h - hat - approx ] ) rather than a counting procedure to generate @xmath160 we must derive alternate expressions .",
    "we begin by defining @xmath177 following cao and petzold ,  @xcite we then note that the number of points falling within the interval @xmath153 is a binomial random variable @xmath178 , where @xmath179 is the success probability .",
    "@xmath160 can then be written as @xmath180 since the mean e@xmath181 = np_x$ ] and the variance var@xmath181 = np_xq_x$ ] ( @xmath182 ) , the mean and variance of @xmath160 are @xmath183 and @xmath184 , respectively . with @xmath185 and @xmath186 ,",
    "the mean and variance of @xmath187 are then @xmath188 & = & 0 , \\\\      \\mathrm{var}[\\delta h_x^\\mathrm{self } ] & = &      [ h(x)dx][1-h(x)dx]/ndx^2 \\approx \\hat{h}(x)/ndx , \\nonumber%\\end{aligned}\\ ] ] where the last line utilizes the histogram density estimator @xmath160 .    for large @xmath1",
    ", @xmath187 can be approximated as a normal random variable with mean zero and variance @xmath189 .",
    "this means that @xmath190 is approximately standard normal and @xmath191 is approximately chi distributed with one degree of freedom .",
    "since the mean and variance of a chi random variable with one degree of freedom are @xmath192 and @xmath193 , respectively , this gives @xmath194 & \\approx &      \\sqrt{\\frac{2}{n\\pi } \\frac{\\hat{h}(x)}{dx } } , \\\\",
    "\\mathrm{var}[|\\delta h_x^\\mathrm{self}| ] & \\approx &      \\left(\\frac{\\pi-2}{n\\pi}\\right ) \\frac{\\hat{h}(x)}{dx}.      \\nonumber%      \\label{eq : abs - delta - hx}\\end{aligned}\\ ] ] finally , using the identities  @xcite @xmath195 & = & \\int_x      \\mathrm{e}[f(x)]dx , \\nonumber \\\\      \\textstyle%      \\mathrm{var}\\left[\\int_x f(x)dx\\right ] & \\leq & \\left ( \\int_x      \\sqrt{\\mathrm{var}[f(x)]}dx\\right)^2 , \\nonumber\\end{aligned}\\ ] ] we get @xmath196 & \\approx & \\frac{1}{2 }      \\sqrt{\\frac{2}{n\\pi } } \\int_x \\sqrt{\\hat{h}(x)dx } ,   \\\\",
    "\\mathrm{var}[d^\\mathrm{self } ] & \\lesssim & \\frac{1}{4 }      \\left(\\frac{\\pi-2}{n\\pi}\\right ) \\left ( \\int_x \\sqrt {      \\hat{h}(x)dx } \\right)^2 .",
    "\\nonumber\\end{aligned}\\ ] ]    in practice , we calculate @xmath197 $ ] , the self distance for a _ reference _ histogram generally obtained using the ssa .",
    "this value then tells us that any histogram with a distance @xmath198 $ ] _ can not _ be statistically differentiated from the reference histogram . in fig .",
    "[ fig : dd - x2 ] , we see that only the pla - rb-1% histogram achieves this level of accuracy . the expression for @xmath199 $ ] is included here for completeness ."
  ],
  "abstract_text": [
    "<S> we present a novel multiscale simulation approach for modeling stochasticity in chemical reaction networks . </S>",
    "<S> the approach seamlessly integrates exact - stochastic and  leaping \" methodologies into a single _ partitioned leaping _ algorithmic framework . </S>",
    "<S> the technique correctly accounts for stochastic noise at significantly reduced computational cost , requires the definition of only three model - independent parameters and is particularly well - suited for simulating systems containing widely disparate species populations . </S>",
    "<S> we present the theoretical foundations of partitioned leaping , discuss various options for its practical implementation and demonstrate the utility of the method via illustrative examples . </S>"
  ]
}