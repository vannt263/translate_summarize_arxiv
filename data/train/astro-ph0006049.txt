{
  "article_text": [
    "frequently , the atmospheres of late type dwarfs are considered to meet the conditions in which the approximation of local thermodynamic equilibrium ( lte ) can be applied . in lte the population densities of atoms or molecules can be described by the te ( thermodynamic equilibrium ) boltzmann  saha distribution , leading to very simple calculations .",
    "lte requires that the collisional rates are large enough to fully compensate for the deviations of the radiative rates from their planckian thermodynamic equilibrium values .",
    "any spectrum that is not a planckian radiation field will drive a system into non ",
    "lte unless the collisional rates are strong enough to prevent this . in the extremely cool atmospheres of m",
    "dwarfs , l  dwarfs  or t  dwarfs , however , there are two important effects which can lead to deviations from lte .",
    "the first is that the extremely low electron densities and consequently low collisional rates might not be sufficient to restore lte .",
    "collisions with other particles might be much less effective because of their much smaller relative velocities and their smaller cross sections .",
    "investigations for stars like the sun showed that electron collisions with co molecules are negligible compared to all other excitation and de - excitation processes ( e.g. * ? ? ?",
    "* ) . for cooler stars ,",
    "the electron collisions are even less important for all molecules , not only co. @xcite also investigated the effects of collisions with h , h@xmath0 and he on the co molecule and found them to be important under certain circumstances .",
    "the very detailed study by @xcite collected the various existing collisional cross sections of co with h , h@xmath0 and he .",
    "they found co to be in lte in solar like and cooler stars due to the very high quasi resonant cross section with h.    other molecules might be less affected by atomic collisions . in general , values for collisional cross sections are only known very roughly through the formulae of @xcite , @xcite or @xcite . without good data on collisional excitation cross sections",
    "we can not be certain that they will dominate the population distribution in molecules .",
    "in addition , with decreasing effective temperature , the maximum of the energy distribution stays at roughly 11.2   @xcite since the strongest opacity sources , tio in the optical and h@xmath0o in the infrared , leave only a small window between 11.2  with relatively little absorption .",
    "this means that not only the shape of the spectra are far from spectra of black bodies for @xmath1 , but also that the maximum deviates strongly from the maximum of a black body and the radiative transitions `` see '' a much hotter local radiative temperature compared to the kinetic temperature .",
    "this circumstance is particularly important for cool stars which have broad molecular absorption bands compared to narrow atomic lines for hotter stars .",
    "of course , for both cool and hot stars , the radiation field produces non - boltzmann populations if it is diluted due to optically thin layers , regardless of its shape .    with these different temperatures",
    "the radiative rates and the collisional rates will try to populate the levels differently .",
    "non  lte effects for atomic species such as ti have already been investigated by @xcite .",
    "that means that the general conditions for non  lte effects ( sufficiently low collisional rates and a sufficiently non  planckian radiation field ) are met in m  dwarf atmospheres .",
    "since molecules are the dominating opacity sources in cool objects , deviations from lte can have a significant impact on the atmospheric structure and the spectra .",
    "these reasons lead us to develop a method to treat molecules in detailed non  lte .",
    "we want to emphasize that it is quite well possible that certain molecules will be in lte under certain atmospheric conditions ( as discussed above for co when dominated by collisions with atoms and other molecules ) .",
    "however , the aim of this paper is to demonstrate how it is possible to calculate non  lte effects in molecules in an accurate fashion and to lay the foundations for calculating molecules that are not in lte in cool atmospheres ( e.g. molecules that are insensitive to collisions or molecules that form their spectra in a part of the atmosphere that can not sustain the conditions for lte ) .",
    "molecules have many more levels as well as many more lines compared to atoms .",
    "several thousand levels and several hundreds of thousand lines are _ minimal _ numbers for very simple molecules .",
    "complicated molecules ( such as h@xmath0o ) will have orders of magnitudes more levels and lines .",
    "the latest line data available for h@xmath0o  @xcite and tio @xcite contain 330 and 140 million lines based on about 50 and 20 million levels respectively . since the system of rate equations ( equation ( [ rateeq ] ) , below ) is a system with a rank of at least the number of involved levels , it is obvious that a straight forward treatment of molecular non  lte will exceed the limits of even the largest modern parallel super - computers .",
    "the huge number of lines and levels in molecular systems is merely a technical difference compared to atomic systems .",
    "there is , however , also an important physical difference .",
    "atomic processes only include excitation and ionization processes ( and their inverse processes ) .",
    "in addition , molecular processes include dissociation and formation of the molecule through different possible channels .",
    "that means that a realistic model has to include not only the molecule itself but also take into account the constituting atoms and the equation of state has to be aware of a possible source or sink of atoms .",
    "the logical extension is `` non local chemical equilibrium ( nlce ) '' . as a first step , we address in this paper only internal non  lte and",
    "do not account for dissociation .",
    "neglecting nlce is a good approximation for very stable molecules which are not easily dissociated since the kinetic and radiative energies in m  dwarf or cooler atmospheres are too small to do so .",
    "so far only very little work has been done on general molecular non ",
    "lte mainly because of the difficulties mentioned above .",
    "usually , only very few levels close to the ground state are considered .",
    "co , however , has experienced a number of investigations .",
    "the limiting factor for co is the uncertainty in the quality of the very high collisional rates .",
    "a recent and important example is the work by ayres and wiedemann @xcite who calculated co in non  lte in order to try to explain the presence of strong co bands in the solar infrared spectrum , which can not be explained by the high kinetic energies of the gas in the solar atmosphere .",
    "they only used 10 vibrational levels ( which produce the optically thick lines ) and the rotational levels were simplified in a fashion similar to what will be presented here , i.e. they assumed some lte behavior between certain levels .",
    "another example is the work by kutepov et al .",
    "@xcite , who calculate the solar radiation in the earth s atmosphere through molecular bands including co. they consider only three vibrational levels and started with so called vibrational lte ( which is also conceptually very similar to the work presented here ) but relaxed this assumption in their latest work .    in the next section we provide the necessary background for this work .",
    "we review the atmosphere code used and the physics involved . in section ( [ molnlte_super ] )",
    "we present the superlevel method on which this paper is based on . in section ( [ co_nlte ] )",
    "we apply our method to carbon monoxide .",
    "we use co as an example and demonstrate the numerical implementation .",
    "we conclude our paper in section ( [ concs ] ) .",
    "this work is based on the general stellar atmosphere code phoenixdescribed in @xcite .",
    "[ back_nlte ]    the solution of the wavelength dependent radiative transfer equation is performed by operator splitting as described in @xcite where the mean intensity @xmath2 is iteratively calculated via @xmath3 where @xmath4 is the source function , @xmath5 the lambda operator expressing the formal solution and @xmath6 a suitably chosen approximate lambda operator .",
    "one major feature is that phoenix  calculates each wavelength point separately , i.e. phoenix  steps through the wavelength grid and solves the radiative transfer equation at each wavelength point by only using data important for that wavelength point .",
    "this dramatically reduces the memory requirements for the code .",
    "only the quantities that need to be integrated over wavelength are kept in memory .",
    "another important feature to be mentioned here is the use of line lists which contain several hundred million spectral lines .",
    "phoenix  has been especially optimized to handle this task by using dynamical opacity sampling ( dos ) ( see also * ? ? ?",
    "* ; * ? ? ?",
    ". dos dynamically discards the negligible lines for a particular atmosphere configuration and does not require precomputed tables . with this feature phoenix",
    "can calculate spectra with high resolution and a large number of spectral lines efficiently .",
    "the superlevel method presented below will take great advantage of dos as it will improve the accuracy and reduce the necessary approximations .    in order to calculate the population densities of individual levels in molecules ( or atoms ) without the assumption of thermodynamic equilibrium ,",
    "we need to solve the rate equations which balance all population and de - population processes for every level .",
    "the radiative absorption rates for individual levels due to absorption of photons are described by the einstein @xmath7 coefficient always stands for a lower level , @xmath8 always stands for an upper level and @xmath9 or @xmath10 are used where a distinction between upper and lower level is not possible or not necessary . ] and the profile averaged mean intensity @xmath11 or by the cross section @xmath12 and the mean intensity @xmath2  : @xmath13 the emission rates are the sum of induced emission and spontaneous emission . however , to simplify the rate equations we shall follow @xcite and use a radiative emission rate coefficient @xmath14 between individual levels @xmath15 such that we can write the emission rate as @xmath16    with these radiative rate coefficients and with the collisional rate coefficients @xmath17 the rate equation for one particular level @xmath9 can be written as @xmath18 the system of all rate equations is closed by the conservation equation for the particles and the charge conservation equation . for a multi level system ,",
    "equation ( [ rateeq ] ) is a non - linear system of equations with respect to the population densities since the radiative rate coefficients themselves depend on the population densities via the mean intensities .",
    "it is also non - linear with respect to the electron density via the collisional rate coefficients and the charge conservation equation . in the case of molecules that can dissociate and form through various channels",
    "the situation will get more complicated since system ( [ rateeq ] ) will include not only the molecule in question but also all atoms and all possible molecules which have to be calculated simultaneously .",
    "furthermore , the condition of particle conservation has to be exchanged for the condition of nuclei conservation .",
    "we use the same formalism as @xcite and solve equation ( [ rateeq ] ) with rate operators and operator splitting techniques .",
    "then the rates can be written by means of a rate operator @xmath19 $ ] and a population density operator @xmath20 $ ]  : @xmath21[n_i]\\ ] ] the radiative rates are functions of the mean intensity @xmath2 which is usually expressed by the lambda operator and the source function @xmath22 .",
    "therefore , the rate operator is also a function of the lambda operator .",
    "however , since the source function is non - linear with respect to the population densities , the lambda operator is substituted by the @xmath23 operator introduced by @xcite @xmath24.\\ ] ] this will eliminate the full source function and introduce the emissivity @xmath25 instead , which can be expressed by the operator @xmath26 $ ] by @xmath27[n]=\\sum_{l < u}\\eta_{lu}(\\lambda)+\\tilde{\\eta}(\\lambda)\\ ] ] where @xmath28 is the background emissivity .    with these definitions , the absorption rates in eq .",
    "( [ abscoeff ] ) can be expressed as @xmath29[n ] = { \\frac{4\\pi}{hc}}\\left [ \\int_0^{\\infty } \\alpha_{lu}^{\\rm abs } \\psi(\\lambda ) e(\\lambda ) \\lambda { \\rm d}\\lambda \\right ] [ n]\\ ] ] and the emission rate from eq .",
    "( [ emcoeff ] ) becomes @xmath30[n]={\\frac{4\\pi}{hc}}\\int_0^{\\infty } \\alpha_{ul}^{\\rm em }",
    "\\left(\\frac{2hc^2}{\\lambda^5}+\\psi(\\lambda ) [ e(\\lambda ) ] [ n ] \\right ) { \\rm e}^{-hc / \\lambda kt } \\lambda { \\rm d}\\lambda\\ ] ]    in order to solve the system of rate equations with an operator splitting iteration scheme , the rate operators are split in analogy to the approximate lambda operator ( [ lambda_def ] )  : @xmath31[n_{\\rm new}]+([r_{ij}]-[r_{ij}^*])[n_{\\rm old } ] = [ r_{ij}^*][n_{\\rm new}]+[\\delta r_{ij}][n_{\\rm old}].\\ ] ] the rate equations ( [ rateeq ] ) can then be written in the form @xmath32[n_{\\rm new } ]              + \\sum_{u > i } n_{u,{\\rm new } } { \\frac{n_{i}^*}{n_{u}^ * } } [ r_{ui}^*][n_{\\rm new } ] \\nonumber \\\\        & + &    \\sum_{l < i } n_{l,{\\rm new } }                 ( [ \\delta r_{li}][n_{\\rm old } ] + c_{li } )              + \\sum_{u > i } n_{u,{\\rm new } } { \\frac{n_{i}^*}{n_{u}^ * } } ( [ \\delta r_{ui}][n_{\\rm old } ] + c_{iu } ) \\nonumber \\\\        & = &    n_{i,{\\rm new } } \\big ( \\sum_{u > i }           [ r_{iu}^*][n_{\\rm new } ]               + \\sum_{l",
    "< i }                  { \\frac{n_{l}^*}{n_{i}^ * } } [ r_{il}^*][n_{\\rm new } ]   \\big ) \\nonumber \\\\        & + &    n_{i,{\\rm new } } \\big ( \\sum_{u > i }           ( [ \\delta r_{iu}][n_{\\rm old } ] + c_{iu } )              + \\sum_{l < i }                  { \\frac{n_{l}^*}{n_{i}^ * } } ( [ \\delta r_{il}][n_{\\rm old } ] + c_{li } ) \\big).\\end{aligned}\\ ] ] this equation can be solved iteratively and represents an operator splitting iteration analogous to solving the radiative transfer equation .    in phoenix , equation ( [ rateeq_op ] )",
    "is solved after having solved the radiative transfer equation for all wavelength points . during the wavelength loop all the rates and operators",
    "are integrated using the newly calculated mean intensity .",
    "convergence of the occupation numbers is obtained by iterating this calculation with updated occupation numbers ( and a possible temperature correction applied ) until overall convergence .",
    "for complex molecules , the dimension of eq .",
    "( [ rateeq_op ] ) becomes very large ( see sec .  1 ) . however , the memory requirements for a computer program that has to solve eq .",
    "( [ rateeq_op ] ) with a direct approach will scale with the number of levels squared .",
    "therefore , depending on the molecular system and the available computer resources the problem of solving the rate equations becomes untreatable and needs to be simplified .",
    "one possibility to simplify non  lte problems is to treat the system `` partially '' in lte .",
    "this was done , e.g. , by kutepov et al .",
    "and ayres and wiedemann as mentioned above .",
    "they assumed lte population within one vibrational state .",
    "a much more general approach was presented by @xcite who faced the problem of complex atoms and ions with a lot of levels ( e.g. , etc . ) .",
    "he also grouped several levels into one common level and assumed lte within such a group .",
    "however , the exact grouping was relaxed to `` some similarity '' of all levels within one group . also , he derived methods how to calculate the opacity by such levels by means of opacity distribution functions .",
    "this idea was also the basis of the work by @xcite and by @xcite .    with the rapid development of large computers",
    "it is no longer necessary to use superlevels for atomic systems . @xcite and @xcite , e.g. ,",
    "calculate large atomic systems directly in non  lte . for molecules , however , the number of levels is orders of magnitudes larger and approximations are still necessary .",
    "furthermore , these approximations are much better for molecules than they are for atoms .",
    "the typical energy differences between individual molecular levels are much smaller than the energy differences between atomic levels .",
    "this provides very good internal coupling and thermalization within one superlevel .",
    "we will only adopt the basic idea of superlevels , that is , we group many individual levels into one superlevel and assume lte populations within one superlevel .",
    "the populations of the superlevels will then be calculated via the rate equations .",
    "however , the absorption coefficients and the transition rates between the superlevels will not be approximated .",
    "we will account for all individual lines by dynamically sampling the opacity and the transition rates .",
    "this distinguishes our approach from the original approaches mentioned above .",
    "there , it had been necessary to develop opacity distribution functions for the transitions between the superlevels .",
    "this is not needed here . as explained above , phoenix",
    "uses dos and , therefore , a dynamical opacity sampling of transitions between superlevels is already done by design .",
    "the only purpose of the superlevel formalism is to keep the system of rate equations small .    a superlevel ) with the addition , that capital letters like @xmath33 , @xmath34 or @xmath35 are used for superlevels , and that lower case letters like @xmath9 , @xmath8 or @xmath36 are used for actual levels .",
    "] @xmath33 is constructed out of a number of actual levels @xmath9 and its population number density is defined by @xmath37 for the population densities of the actual levels within one superlevel lte is assumed and the boltzmann equation can be used for a level @xmath38  : @xmath39 where @xmath40 is the _ finite _ partition sum over the superlevel considered .",
    "( [ lteratio ] ) can be used for both the lte and the non  lte quantities . with this",
    "we define the departure coefficients as in @xcite and @xcite as @xmath41 where the @xmath42 are the occupation numbers calculated via the saha boltzmann equation and the actual non  lte population density of the continuum",
    ". also , in lte equation ( [ lteratio ] ) holds true for _ any _ level @xmath43 . summing equation ( [ lteratio ] ) over all levels @xmath44 we get the ratio @xmath45 of two superlevels to  : @xmath46 which is the analogous relation to the boltzmann relation @xmath47 for normal levels and is in fact only a more general form of equation ( [ lteratio ] ) .",
    "equation ( [ sulteratio ] ) can be written as @xmath48 summing over all superlevels and adding all remaining levels not included in any superlevel yields @xmath49 this leads to the definition of the non  lte partition function which can be written for superlevels @xmath50 where @xmath51 is the sum over all levels not included in any superlevel . by using the definition of @xmath52 and @xmath53 this",
    "can be expanded to the usual non ",
    "lte partition function @xmath54 with these relations it is possible to obtain lte and non ",
    "lte occupation numbers from the departure coefficients .",
    "if we had used the definition of departure coefficients introduced by @xcite the lte occupation numbers could be obtained simply by solving the saha ",
    "boltzmann equations for the complete molecule .",
    "however , we use the definition by @xcite and , therefore , it is necessary to use the partition function ( [ nlte_q_def ] ) .    generally , the partition function is an infinite sum as seen in equation ( [ nlte_part_func ] ) which mathematically does not converge . physically , this sum is `` cut off '' at some level which can never be populated due to the presence of other neighboring particles ( see e.g. * ? ? ?",
    "if the number of levels for which data are available is large enough , it is sufficient to set @xmath55 and circumvent the problem of deciding how to cut off the infinite lte partition function .",
    "the emission rate between two superlevels is the sum of all emissions @xmath56 between all relevant actual levels . inserting @xmath57 and expressing @xmath14 by the cross section @xmath58 of individual lines ( equation ( [ abscoeff ] ) ) yields : @xmath59 and when using equations ( [ lteratio ] ) and ( [ sulteratio ] ) @xmath60 where @xmath61 now , the rate coefficient ( [ suemrate ] ) has the same form and properties ( see equation ( [ suemcoeff ] ) ) as the rate coefficient ( [ emcoeff ] ) for `` normal '' levels .",
    "similarly , the absorption rate between two superlevels is the sum over all relevant absorptions @xmath62 and becomes @xmath63 where @xmath64 again , the definition of @xmath65 has the same form as the equivalent expressions ( [ abscoeff ] ) for actual levels .",
    "note that equations ( [ alphaemdef ] ) and ( [ alphaabsdef ] ) only differ in the choice of @xmath66 or @xmath67 and that in the case of complete redistribution @xmath68 and @xmath69 are identical also for superlevels .",
    "that means that a computer program needs to keep track of only _",
    "one _ quantity which is less memory or time consuming than keeping track of the sum over the absorption cross sections _ and _ the sum over the emission cross sections ( note that the cross sections need to be known for every depth point of an atmosphere and for every transition ) .    with the two radiative rates ( [ suemrate ] ) and ( [ suabsrate ] ) it is possible to calculate all the radiative rates needed to solve the rate equation ( [ rateeq ] ) .",
    "the rates have to be obtained via wavelength integration during the wavelength loop ( as described in section ( [ back_phoenix ] ) ) and depend on all actual transitions between two _ different _ superlevels .",
    "since all _ actual _ transitions have to be calculated this does not seem to simplify the original problem of dealing with millions of lines .",
    "however , phoenix  is already designed to calculate as many transitions as desired very efficiently , as explained in section ( [ back_phoenix ] ) by means of dos .",
    "therefore , it is straight forward to calculate the radiative rates `` as exactly as desired '' .",
    "the computer program simply has to assign each actual transition to the super transition it belongs to .",
    "note also , that the purpose of the superlevels in this approach is to reduce the number of levels in the rate equations not the number of lines calculated .",
    "this keeps the accuracy of the rate coefficients and of the absorption coefficients as high as possible . only the population densities will be approximated .",
    "it also keeps the resulting spectrum as accurate as possible .",
    "the rate equations are solved by operator splitting techniques as described in section ( [ back_nlte ] ) .",
    "note that the operator technique only relies on the @xmath23 operator and the @xmath70 operator .",
    "the @xmath23 operator is derived from the @xmath5 operator and the @xmath70 operator is derived from the emissivity .",
    "the @xmath5 operator obviously does not depend on the superlevel formalism .",
    "the @xmath70 operator depends on the opacity , but as already explained , the treatment of the opacity is not changed by the superlevel formalism .      as mentioned above",
    ", the only purpose of the superlevels is to keep the system of the rate equations small .",
    "there is no need to keep the number of transitions small . therefore , every absorption or emission coefficient is calculated between actual levels . as explained above , phoenix",
    "uses lists of spectral lines as input data .",
    "the @xmath71 values ( and other data ) for the systems treated with superlevels can be ( and are ) included in the same input data .",
    "therefore , the cross sections @xmath72 are available for every individual transition at every wavelength point selected by dos as explained above .",
    "care has to be taken when entering the number density into the absorption coefficient : equation ( [ lteratio ] ) has to be applied to obtain the number density of a particular actual level out of the number density of the superlevels .",
    "that means that , as explained for the radiative rates , our computer code calculates `` exact '' cross sections @xmath73 for superlevel transitions with complicated `` superline profiles '' and does not require opacity distribution functions for the supertransitions .",
    "the advantage regarding the absorption and emission coefficients and the spectrum synthesis is that we can calculate a very accurate spectrum at any desired resolution within our superlevel formalism .",
    "the collisional excitation rate from one superlevel to another superlevel is the sum of all excitation rates between the relevant actual levels and becomes @xmath74    similarly , the rates for collisional de - excitation between two superlevels are : @xmath75    with the definitions ( [ sucollabs ] ) and ( [ sucollem ] ) and the relation ( [ sulteratio ] ) , it follows immediately that @xmath76 which is the equivalent to the boltzmann relation for the collisional rate coefficients for actual levels .    with equations ( [ sucollabs ] ) , ( [ sucollem ] ) and ( [ sucollratio ] )",
    "it is now possible to calculate the collisional rates @xmath77 needed for the rate equation ( [ rateeq ] ) from known collisional cross sections and coefficients @xmath78 .",
    "ionization and recombination processes can be included very similarly . for photoionization @xmath79 where @xmath80 and for radiative recombination    @xmath81    where @xmath82 for the collisional ionization @xmath83 and for the collisional recombination @xmath84    however , usually the most important continuum processes of molecules are dissociation and molecular recombination .",
    "including these processes requires accounting for all particles that are involved in a molecular production and destruction chain , i.e. all constituent atoms and all possible molecules that can be constructed out of these atoms via all possible chemical pathways .",
    "such a nlce ( non local chemical equilibrium ) treatment is beyond the scope of this work since it requires a formalism beyond the superlevel formalism .",
    "important molecules with low dissociation energies like tio could be affected by nlce .",
    "however , it can be neglected for molecules that have dissociation energies less than those that occur in m  dwarf atmospheres , e.g. for co.",
    "we test our method on carbon monoxide ( co ) .",
    "this diatomic molecule has data available that are detailed enough and of good quality ( see e.g. * ? ? ?",
    "also , it does not have very many lines and levels ; and the lines have very distinct bands in the infrared ( most prominently at 2.3  and at 4.36  ) .",
    "co not only has reliable data , but is also important in other astronomical fields like the earth s atmosphere and the solar atmosphere .",
    "other molecules like tio or h@xmath0o have either data which are not detailed enough , i.e. the level data can not be extracted , or the data are most likely incomplete and not very accurate @xcite . furthermore , co is a relatively small system . with only a few thousand levels ( about a factor of 1000 less than tio or h@xmath0o )",
    "it is only slightly larger than the largest atomic system currently calculated in non  lte .",
    "therefore , we will compare the superlevel calculations with a direct non ",
    "lte calculation .",
    "thus , we can quantify the accuracy of the superlevel treatment by direct comparison to an `` exact '' calculation .",
    "the necessary level data , i.e. the excitation energies , and the quantum numbers as well as the necessary line data , i.e. the transition wavelengths , the transition strengths and the involved levels , were extracted from the line list by goorvitch et al . @xcite .",
    "the line list is detailed enough to uniquely assign the upper level to each transition .    for simplicity ,",
    "only @xmath85 was considered .",
    "it contains 3623 levels and 19203 transitions for the electronic ground state .",
    "the first excited electronic state has a very high energy and all transitions to this state are in the uv .",
    "therefore , these transitions are not included in the available line list as these states and transitions are unimportant in m  dwarfs .      for collisions with electrons the formula given in @xcite has been used for simplicity .",
    "this is a very rough approximation but electron densities are very low in m  dwarfs  and as already noted by @xcite or @xcite , e.g. , electron collisions with co are negligible even for higher electron temperatures than in m  dwarfs .    for collisions with atomic and molecular hydrogen and with helium we used the cross sections collected by @xcite and expressed in terms of @xmath86 where @xmath87 and @xmath88 .",
    "the subscript @xmath89 stands for the collisional partner . @xmath90 and @xmath91 are also taken from @xcite .",
    "explicitly , @xmath90 is 3 , 64 and 87 for h , h@xmath0 and he , respectively , and @xmath91 is 18.1 , 19.1 and 19.1 for h , h@xmath0 and he , respectively .",
    "these are values originating from the results of @xcite for h and h@xmath0 and the results of @xcite for he .",
    "co has a dissociation energy of 11.09  ev and an ionization energy of 14.01  ev .",
    "these energies are much too high to be achieved in m  dwarf atmospheres ( 10 ev correspond to 77200  k or 1240   ) . also , no data for detailed cross sections for ionization or dissociation are available .",
    "therefore , the molecule is treated in `` quasi  internal non ",
    "lte '' , i.e. , our calculations can only determine the population densities of the energy levels of co , not the number density of co. that means we neglect nlce and the dissociation and ionization transitions are accounted for , but only with negligible transition rates and dissociation processes are not accounted for in the atomic equation of state",
    ". this will be improved in future work .",
    "energy level diagrams of carbon monoxide are shown in figs .",
    "( [ co_quant_grot ] ) and ( [ co_head_grot ] ) .",
    "the energy levels have been grouped into vibrational quantum numbers and the transitions have been omitted for clarity . when dividing the levels into superlevels we have to assure that the coupling within one superlevel is very strong .",
    "then we can be certain that the requirements for the superlevel approximation are met and that we can assume that we have a thermal population within one superlevel .",
    "the following possible divisions into superlevels have been considered :      an obvious splitting into superlevels is the grouping by constant vibrational quantum number , assuming strong coupling between the rotational states for one vibrational quantum number .",
    "this assumption is very good since the purely rotational transitions have very long lifetimes .",
    "the einstein a values for purely rotational transitions are of the order year@xmath92 .",
    "therefore , collisions will occur much more often and rotational thermalization can be assumed .",
    "we will call this model `` model a '' .",
    "it corresponds to vibrational lte as used by @xcite . in fig .",
    "( [ co_quant_grot ] ) , the vertical lines mark the boundaries for model  a.    however , this grouping results in a large overlap in energy between all superlevels and a wide range of energies affects one superlevel .",
    "this may make the thermalization assumption invalid .",
    "the second superlevel model selects superlevels only by their energy .",
    "the energy boundaries are defined by the rotational ground states for each vibrational state .",
    "the original authors of the superlevel idea @xcite also used the energy as a selection criteria for their atomic systems . at face value",
    ", the pure energy criteria does not seem to meet the requirements for the superlevel treatment to be valid .",
    "there is , a priori , no strong coupling for levels with similar energies . for atoms ,",
    "this criterion has been a matter of pure feasibility . in our case , however , each superlevel defined by the energies of the actual levels will still be dominated by the levels with one ( the highest ) vibrational quantum number . as explained above",
    ", it is a good approximation to assume strong coupling for constant vibrational quantum number .",
    "if all the other levels included in such a superlevel that do not have the same vibrational quantum number are not important for balancing the rate equations , they do not have to couple strongly to the dominating levels .",
    "this model we will call `` model b '' . such a superlevel definition can be seen in fig .",
    "( [ co_head_grot ] ) indicated by the horizontal lines which are the superlevel energy boundaries .    the vibrational level with the highest quantum number and the other levels with corresponding energies would produce a huge and wide spread superlevel .",
    "this superlevel was divided in such a way that the resulting superlevels contain roughly the same number of levels per superlevel as does the average superlevel .",
    "the third superlevel model combines both criteria from model  a and model  b. that means we select all levels by their vibrational quantum number and by their energy . that way we have the advantages of both methods .",
    "the internal coupling can be assured by purely rotational transitions which only can occur via collisions ( as explained for model  a ) and , in addition , there is no energetical overlap between the superlevels .",
    "furthermore , this model represents a step between models  a or b and a direct solution without superlevels .",
    "this model has only a factor of ten less superlevels than actual levels .",
    "our model contains 350 superlevels for this method compared to 24 and 27 for model  a and model  b , respectively .",
    "we call this model `` model c ''",
    ". it can be visualized by plotting fig .",
    "( [ co_head_grot ] ) over fig .",
    "( [ co_quant_grot ] ) .",
    "the resulting rectangles represent the superlevel boundaries .",
    "the last model we consider is direct non  lte using all available levels and lines .",
    "the 3623 levels and 19203 lines of the co model are within the limits of a modern workstation .",
    "this model we call `` model z '' .",
    "note , that the superlevel formalism reduces to `` regular '' non  lte when the sums are carried out over only one term .",
    "therefore , regular non  lte can easily be treated within our superlevel formalism .",
    "we will use the results from this model to evaluate our superlevel formalism .",
    "the non  lte implementation for molecules is implemented in a manner very similarly to the already existing non  lte implementation for atomic species as explained in section ( [ back_nlte ] ) .",
    "the necessary level data for all actual individual levels are obtained from the input line list .",
    "the absorption coefficients for individual co lines are calculated with the non ",
    "lte occupation numbers via equation ( [ lteratio ] ) . for every wavelength point",
    "the cross sections between superlevels are obtained as explained in section ( [ superradrates ] ) and are integrated over the spectrum .    in order to select a certain superlevel model",
    "we need only change the input files .",
    "the computer code is independent of assumptions about the model molecule .",
    "this makes it very easy to change between the various models .",
    "the rate equations are solved as described in section ( [ back_nlte ] ) using the operator splitting technique .",
    "convergence of the departure coefficients @xmath93 is obtained simultaneously with the iteration of the temperature structure .",
    "the convergence properties of the rate operator method depends strongly on the accuracy of the rates .",
    "the accuracy of the rates is determined by the accuracy of the integration of the radiative rates .",
    "this has been achieved by a carefully selected wavelength grid and by correcting the first order error via normalization of the line profiles used for the radiative rates .",
    "the wavelength grid on which the spectrum is calculated has to include all transitions between all superlevels . for the accuracy of the rates it does not have to include the transitions that occur within one superlevel .",
    "the wavelength grid has been optimized to sample the molecular line profiles with as few wavelength points as necessary .",
    "otherwise , the number of necessary wavelength points would be at least a multiple of the number of individual lines . for molecules with millions of lines that would increase the number of wavelength points to be calculated ( which increases the cpu time linearly ) to an unnecessarily large number .      in order to test the stability of the code ,",
    "several tests have been performed .",
    "all these tests take advantage of the fact that lte has to be restored in limiting cases .",
    "lte is restored when the atmosphere is dominated by collisions or if the radiation field is described by the planck function .",
    "lte becomes exact when there are only collisional rates and the radiative rates are all zero ( @xmath94 , @xmath95 ) or when the source function is exactly the planck function ( @xmath96 ) .",
    "both conditions can easily be applied artificially in the computer code . for the second test condition to be very clean and accurate , the collisional rates are set to zero ( i.e. @xmath96 , @xmath97 ) .",
    "all tests have been performed with a model for @xmath98=2700 , @xmath99=5.0 and solar metallicity .",
    "the choice of superlevels was `` model b '' ( i.e. rotational ground states as energy boundaries ) .",
    "the choice of the superlevel model does not affect this test because a change of the superlevel model is only a change of input data , not a change of the computer code .",
    "the first test case was a lte model .",
    "the departure coefficients @xmath93 remained 1.0 to an accuracy of about @xmath100 for several iterations for both test conditions .",
    "the second test case was a lte model , but the departure coefficients were artificially changed under the restriction of particle conservation .",
    "that means some fraction ( 1050 state were put into another excited state .",
    "this yields @xmath93 s of 0.5 or 0.9 for the de - populated state and @xmath93 s of up to ten or more for the over - populated state .",
    "the lte situation was restored within only one iteration with an accuracy of about @xmath100 for both test conditions as well .",
    "the collisional rates couple all levels with each other .",
    "the energy differences ( and therefore , the rates ) between two levels can vary by several orders of magnitudes when comparing arbitrary pairs of levels . that has important numerical complications for model  a. in model  a",
    ", the individual transitions that make up one particular supertransition do have largely varying energy differences and rates . since a collisional rate between two superlevels is the sum of the many individual rates we had to assure that the numerically correct sum got evaluated .",
    "otherwise , the collisional rates did not obey the boltzmann relation ( [ sucollratio ] ) anymore and the lte tests described above would fail .",
    "this is a disadvantage of model  a. all other models do not have this problem since the energy differences of the transitions that make up the supertransition are of the same order of magnitude .",
    "in particular , model  c can be regarded as model  a which has been modified in order to decrease the energy differences which then results in numerical stability . for future molecules we will have to assure numerical stable summation if possible or otherwise use a different superlevel model .      in the following we present results of a test molecule strongly affected by",
    "non  lte effects .",
    "we used the co molecule without accounting for collisions with h , h@xmath0 and he .",
    "this is a very unrealistic model .",
    "however , it will be in non  lte in cool atmospheres .",
    "therefore , we used it to test our method in the non  lte case .    the models in this section are fully converged and have @xmath98=2700  k , @xmath99=5.0 and solar metallicity .",
    "the departure coefficients for a converged model can be found in fig .",
    "( [ bi_quant_tcor ] ) for model  a , in fig .",
    "( [ bi_head_tcor ] ) for model  b , in fig .",
    "( [ bi_square_tcor ] ) for model  c and in fig .",
    "( [ bi_real_tcor ] ) for model  z. as can be seen , the @xmath93 structures are very similar for all models .",
    "the onset of non  lte effects start in about the same depth of about @xmath101 for all superlevel models .",
    "generally , it is not expected that the @xmath93 distribution is the same for all superlevel models since the superlevel models differ .",
    "however , models  a and b are expected to be dominated by the same levels . the similarity of figs .",
    "( [ bi_quant_tcor ] ) and ( [ bi_head_tcor ] ) can very well be explained when we assume that models  a and b are dominated by the same actual levels .",
    "this is also supported by the results from model  c which can be seen in fig .",
    "( [ bi_square_tcor ] ) .",
    "the bright lines in fig .",
    "( [ bi_square_tcor ] ) correspond to the superlevels that have the lowest energies for a given vibrational quantum number , i.e. contain the dominating levels for models  a and b. as one can see , the bright @xmath93 structure in fig .",
    "( [ bi_square_tcor ] ) is very similar to figs .",
    "( [ bi_quant_tcor ] ) and ( [ bi_head_tcor ] ) .",
    "the strongest argument , however , comes from our direct non  lte calculation . as can be seen in fig .",
    "( [ bi_real_tcor ] ) , the levels with the lowest rotational quantum numbers have a very similar @xmath93 structure as shown in figs .",
    "( [ bi_quant_tcor ] ) and ( [ bi_head_tcor ] ) .",
    "that means that , indeed , the superlevels are dominated by the levels with the lowest rotational quantum numbers ( or equivalently the lowest energies ) for a given vibrational quantum number and all our superlevel models produce consistent @xmath93 structures .",
    "detailed high resolution spectra have been calculated in the spectral regions where co is most prominent , i.e. between 2 and 2.4  and between 4.3 and 6  .",
    "the @xmath102 band between 2 and 2.4  did not show any significant changes , whereas the @xmath103 band between 4.3 and 6  did .",
    "a high resolution spectrum of a region in the @xmath103 is shown in fig .",
    "( [ hires_head ] ) for an lte model and non  lte models with the various superlevel models discussed here .",
    "as can be seen , all the non  lte models , including the direct non  lte calculation , produce deeper lines and are all identical within the accuracy of the calculations and the plots .",
    "( [ hires_head ] ) is only an example of that band .",
    "we note that all co lines are deeper for our non  lte calculations and , therefore , the whole @xmath103 band is deeper .",
    "it is important that the spectra are the same for every superlevel model that is chosen under the correct physical assumptions . if we want to use the superlevel approximation we have to make sure that the physical results are independent of the approximation .",
    "but most importantly , the direct non  lte and our superlevel models produce the same result for the spectrum .",
    "the presence of non  lte effects in the @xmath103 band also means that this band forms in regions where deviations from lte are present , i.e. outward of @xmath104 .",
    "the @xmath102 band on the other hand has to form in regions deeper than @xmath104 .",
    "this explains that no non  lte effects are visible in the spectral region between 2 and 2.4  .",
    "all models presented here have @xmath98=2700  k , @xmath99=5.0 and solar metallicity .",
    "this roughly describes a typical m  8 dwarf .",
    "the very low effective temperature has been deliberately chosen since non  lte effects are expected to be largest for low temperatures .",
    "the models have been calculated using the superlevel models described above and are fully converged with regard to the departure coefficients and to the temperature structure .",
    "the departure coefficients for a realistic co calculation are shown in figs .",
    "( [ newcoll_bi_quant_tcor ] ) ( [ newcoll_bi_head_tcor ] ) ( [ newcoll_bi_square_tcor ] ) and ( [ newcoll_bi_real_tcor ] ) for models  a , b , c and z , respectively .",
    "the plots show that co stays in lte when accounting for collisions with h , he and h@xmath0 .",
    "the levels that deviate significantly from lte correspond to the levels with very high excitation energies and have negligible effects .",
    "it is very important to note , that we can confirm the previous calculations that found lte for co not only for approximative calculations but even if we do a direct non  lte calculation .",
    "we also compared the collisional rate coefficients due to collisions with electrons , h , he and h@xmath0 with the radiative rate coefficients .",
    "as a typical example we show the de - excitation rate coefficients @xmath105 for model  b in figure ( [ rates ] ) .",
    "these are the de - excitations between the superlevels defined by the vibrational quantum numbers 7 and 5 and the respective energy bands .",
    "as can be seen the rate coefficients due to electronic collisions are the smallest collisional rate coefficients .",
    "the radiative rate coefficients are generally smaller than the collisional rate coefficients , which is pushing the system in lte .",
    "we also compared the density independent parts of the rate coefficients @xmath106 for the different collision partners .",
    "as can be seen , the electronic @xmath106 s are the strongest , followed by h. however , the dominating factor for the resulting rate coefficients are the respective densities . the two largest rate coefficients are the one for h because of its large cross section and h@xmath0 because of its large number density .",
    "the cross sections for collisions of h , he and h@xmath0 with co are known to be uncertain @xcite . however , our results indicate that the rate coefficients for h , he and h@xmath0 would have to be several orders of magnitudes smaller to see non  lte effects for co. this is in good agreement with all the previous studies .",
    "we have developed a method to treat molecules in non  lte .",
    "this method uses the superlevel formalism which reduces the number of levels for a model molecule by a factor of hundred or more and thereby reducing the rank of the system of rate equations . the important difference with respect to other implementations of superlevels",
    " like in the work of @xcite , @xcite or @xcite  is the treatment of line opacities .",
    "the original accuracy of opacity treatment implemented in the atmosphere code phoenix  is still preserved by taking advantage of the direct opacity sampling ( dos ) .",
    "this treats the line opacity as exactly as possible and allows us to also use this also for the radiative line rates .",
    "we used co as an example and showed how it is possible to create superlevel models that approximate the direct calculations very well .",
    "the most important result we can draw from co is the fact that we successfully divided the co molecule into a superlevel model molecule .",
    "the results we obtained are independent of the choice of the superlevel model and are identical to the results a direct non  lte calculation of co which is the largest non  lte calculation of a single species ever .",
    "therefore , we demonstrated that our superlevel method is a powerful and accurate method to calculate molecular non  lte problems .",
    "for physical reasons model  a has to be recommended as long as the numerical stability is guaranteed .      in future work",
    "we will apply our method to the most important , but much more complicated molecules tio and h@xmath0o .",
    "the results from co suggest that it does not matter much which superlevel we choose as long as it is physically reasonable and numerically stable .",
    "therefore , it might be tempting to use model  a for tio and h@xmath0o since model  a is the most physical and gives correct results .",
    "however , we will investigate several superlevel models also for tio and h@xmath0o which will be similar to model  b and c or variations thereof .",
    "thus we can assure the physical correctness , the numerical stability and the necessary decrease of the system of rate equations .    for molecules",
    "other than co it will be important to also include good cross sections for continuum processes .",
    "continuum processes for co could be ignored , since co is the most stable molecule . however , when calculating molecules like tio or h@xmath0o it will be important to allow for ionization and recombination , and , most importantly , for dissociation and molecule generation . in many cases dissociation",
    "will dominate over ionization .",
    "this will couple the atomic equation of state and the molecular equation of state by sources and sinks of atoms and ions and production chains for molecules have to be calculated simultaneously .",
    "therefore , the logical consequence is to develop a formalism for non local chemical equilibrium ( nlce ) .",
    "nlce will be important for molecules with low dissociation energies like tio .",
    "non  lte effects on lines have already been presented in @xcite , therefore , it will be necessary to treat tio , and possibly simultaneously in non  lte .",
    "whereas pure ionization can be done within the framework of the superlevel formalism , the inclusion of nlce will require further technical developments .",
    "nlce will not affect the rate equations by increasing the number of levels but by coupling to other species .",
    "when developing a nlce formalism , it will be based on the superlevel formalism . the superlevel formalism for molecules as presented in this work for very stable molecules like co.    finally , since it is now possible to calculate co with a lot of levels in non ",
    "lte , these methods can now be applied to fields other than m  dwarf atmospheres .",
    "one application will be to address the problem of the strong co bands in the solar spectrum as already mentioned .",
    "this work was supported in part by nasa atp grant nag 5 - 8425 and ltsa grant nag 5 - 3619 , as well as nasa / jpl grant 961582 and by nsf grant ast-9720704 to the university of georgia .",
    "this work was supported in part by the ple scientifique de modlisation numrique at ens - lyon .",
    "some of the calculations presented in this paper were performed on the ibm sp and the sgi origin 2000 of the uga ucns and on the ibm sp of the san diego supercomputer center ( sdsc ) , with support from the national science foundation , and on the cray t3e of the nersc with support from the doe .",
    "acknowledges furthermore support from dfg grant 1053/8 - 1 .",
    "acknowledges support from nsf grant ast 973140 and nasa grant nag 5 - 3505 .",
    "we want to thank the referee , t. ayres , for his very helpful comments .",
    "a.s . wants to thank j. krautter , s. starrfield and i. appenzeller who made this work possible and supported it .",
    "we also thank f. allard for her work on phoenix ."
  ],
  "abstract_text": [
    "<S> we present a technique to treat systems with very many levels , like molecules , in non  lte . </S>",
    "<S> this method is based on a superlevel formalism coupled with rate operator splitting . </S>",
    "<S> superlevels consist of many individual levels that are assumed to be in lte relative to each other . </S>",
    "<S> the usage of superlevels reduces the dimensionality of the rate equations dramatically and , thereby , makes the problem computationally more easily treatable . </S>",
    "<S> our superlevel formalism retains maximum accuracy by using direct opacity sampling ( dos ) when calculating the radiative transitions and the opacities . </S>",
    "<S> we developed this method in order to treat molecules in cool dwarf model calculations in non  lte . </S>",
    "<S> cool dwarfs have low electron densities and a radiation field that is far from a black body radiation field , both properties may invalidate the conditions for the common lte approximation . therefore , the most important opacity sources , the molecules , need to be treated in non  lte . as a case study we applied our method to carbon monoxide . </S>",
    "<S> we find that our method gives accurate results since the conditions for the superlevel method are very well met for molecules . </S>",
    "<S> due to very high collisional cross sections with hydrogen , and the high densities of h@xmath0 the population of co itself shows no significant deviation from lte . </S>"
  ]
}