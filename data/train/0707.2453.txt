{
  "article_text": [
    "in an imaging - air - cherenkov - telescope ( iact ) experiment like magic @xcite the energy @xmath1 of the cosmic ray particle ( @xmath0-ray ) is not exactly known .",
    "it has to be estimated , the energy resolution being in the order of 20 to 40% . as a consequence ,",
    "the experimentally measured energy spectrum is biased .",
    "the procedure to correct for the effects due to the finite energy resolution is called unfolding .    while in high - energy - physics experiments unfolding is a widely used technique , this is not the case in present day s iact experiments",
    ". this paper deals with the unfolding procedure , which is applied as a standard tool in the magic experiment .",
    "the different unfolding methods are explained in detail .",
    "emphasis is put on the discussion of questions and problems related to the application of the unfolding to real data .",
    "it is not the aim of the paper to give a complete derivation of all formulas . for this the reader",
    "is referred to the publications @xcite to @xcite .",
    "an excellent review of unfolding methods is given in @xcite .",
    "the present paper makes use of many ideas discussed in that paper .",
    "although here only differential energy spectra are considered , the procedures are equally well applicable to distributions of other quantities , including distributions in more than one dimension @xcite .",
    "the layout of the paper is as follows . in section [ section : unfoldingaim ]",
    "the notation is defined and the motivation for the unfolding procedure is given .",
    "the different unfolding methods , which means the different ways of regularization , are presented in section [ section : regularization ] .",
    "the so - called forward unfolding , which represents an implicit unfolding under the assumption of a certain parametrization of the unfolding result @xmath2 , is explained in section [ section : forwardunfolding ] . in section [ section : usefulquantities ] two quantities are introduced , which are useful for an optimal choice of the regularization strength .",
    "the criteria for this choice are collected in section [ section : bestweight ] .",
    "section [ section : comments ] discusses various technical aspects which are important in the application of the unfolding procedure to real data .",
    "two particular technical procedures , which ensure an unbiased and robust unfolding , are presented in sections [ section : aeffandm ] and [ section : combine ] .",
    "some unfolding results , obtained by applying the unfolding procedure to data taken in the magic experiment , are discussed in section [ section : application ] . finally the pros and contras of the method of correction factors , which is an alternative way of correcting data for effects due to the finite experimental resolution , are listed in section [ section : correctionfactors ] .",
    "a summary is given in section [ section : summary ] .",
    "in this section the notations are defined and the motivation for the unfolding procedure is explained .",
    "the true and measured ( estimated ) values of the energy of the cosmic ray particle are denoted by @xmath3 and @xmath4 respectively .",
    "the data are assumed to be binned in histograms , and certain binnings are chosen independently for the distributions in @xmath3 and @xmath4 .",
    "furthermore , the following definitions are introduced : +    [ cols=\"^ , < , < \" , ]      + with @xmath5    in the following it is assumed that the rank @xmath6 of @xmath7 is equal to ( and not less than ) the minimum of @xmath8 and @xmath9 , where @xmath8 and @xmath9 are the number of bins in @xmath4 and @xmath3 respectively , which are used in the unfolding .",
    "this can always be achieved by a proper choice of the binnings in @xmath3 and @xmath4 .",
    "the migration matrix contains the most likely fraction of events moving from a bin @xmath10 in @xmath3 into a bin @xmath11 of @xmath4 , due to the finite experimental energy resolution : @xmath12    the migration matrix @xmath13 is obtained from monte carlo ( mc ) simulations , in which the development of the air shower ( induced by the cosmic ray particle in the atmosphere ) , the emission of cherenkov light in the air shower , the geometrical , optical and electronic properties of the telescope and the experimental procedures in the data analysis ( shower reconstruction , @xmath0/hadron separation , energy estimation , selections , cuts ) are simulated @xcite .",
    "@xmath13 is computed from a 2-dimensional plot of the number of reconstructed mc events in the @xmath4-@xmath3 plane , which was produced under the same conditions ( selections , cuts ) as the experimental distribution @xmath14 .",
    "it is the aim of the unfolding procedure to determine the true distribution @xmath2 , given @xmath14 and @xmath13 .",
    "+ it should be noted that @xmath13 only describes the migration of events .",
    "it does not describe losses of events , which will occur due to the finite acceptance of the detector , due to the trigger conditions and due to additional selections and cuts . in an iact experiment these losses",
    "are also determined by monte carlo simulations , and the corresponding correction factor is the effective collection area @xmath15 .",
    "@xmath15 has to be computed again under the same conditions as the experimental distribution @xmath14 .",
    "apart from minor effects ( see section [ section : aeffandm ] ) , this correction can be performed quite independently of the unfolding .",
    "+ the unfolding can be understood as a reshuffling of events from the bins of @xmath4 into the bins of @xmath3 . in this procedure",
    "the numerical values of the bin edges , both for @xmath3 and @xmath4 , are completely irrelevant . @xmath3 and",
    "@xmath4 may be even two different physical quantities , with completely different ranges of values and different units , like @xmath3 = ( the true energy of the cosmic ray particle ) and @xmath4 = ( the total number of cherenkov photons measured for the shower ) @xcite .",
    "of course , unfolding makes only sense if @xmath3 and @xmath4 are sufficiently strongly correlated , otherwise the distribution of @xmath3 can not be inferred from a distribution of @xmath4 .",
    "this is in contrast to the method of correction factors ( see section [ section : correctionfactors ] ) , where @xmath4 has to be a good estimate of @xmath3 in any case .    because the binnings in @xmath3 and @xmath4 can be chosen independently and to a certain degree arbitrarily ( see section [ section : comments ] ) , the migration matrix @xmath13 is in general not square . for this reason eq .",
    "( [ eq : yms ] ) can in general not be inverted to obtain @xmath2 as @xmath16 .",
    "+ as the unfolding is equivalent to a reshuffling of events from the bins of the measured distribution into the bins of the true distribution the unfolding is not restricted to 1-dimensional distributions but can in the same way be applied to multi - dimensional distributions .",
    "the information necessary for the unfolding procedure is completely contained in the corresponding migration matrix , which in the case of multi - dimensional distributions describes the migration of events from the bins of the true multi - dimensional distribution into the bins of the measured multi - dimensional distribution .",
    "the dimensions of the measured and true distributions may also be different .",
    "an example for an unfolding in 2 dimensions is given in @xcite .",
    "very generally , the solution @xmath2 of the system of linear equations ( [ eq : yms ] ) can be obtained by minimizing the least - squares expression    @xmath18    where the @xmath9 components of @xmath2 are the free parameters .",
    "minimizing @xmath19 will yield solutions for @xmath2 which , after folding with @xmath13 , are best compatible with the measurement @xmath14 .",
    "two cases have to be distinguished :    * * the underconstrained case @xmath20 . * + because @xmath21 the @xmath22 matrix @xmath7 can be inverted and a particular solution @xmath23 can be written as @xmath24 if @xmath25 , the solutions @xmath26 form a space of @xmath27 dimensions with @xmath28 . for @xmath29 eq.([eq : s0 ] ) reduces to @xmath30 and @xmath31 is the only solution . in both cases",
    "@xmath32 , implying @xmath33 .",
    "the solutions are independent of the covariance matrix @xmath34 . moreover , because of ( [ eq : normalizem ] ) the total number of events is not changed : @xmath35 * * the overconstrained case @xmath36 . * + minimizing @xmath19 by varying @xmath2 yields @xmath37 where @xmath38 is the @xmath39 matrix @xmath40 the solution @xmath41 now depends on @xmath34 .",
    "the minimum value of @xmath19 becomes @xmath42 expression ( [ eq : slsq ] ) is also valid for @xmath43 , in which case it reduces to @xmath44 .",
    "it can be shown that the direct solutions ( [ eq : s0 ] ) and ( [ eq : slsq ] ) may lead to large errors of @xmath45 , reflected in large absolute values of the elements of the error matrix @xmath46 of @xmath2 .",
    "this behaviour can be traced back to small eigenvalues of the matrix @xmath7 and @xmath38 respectively @xcite .",
    "in order to reduce the large errors of @xmath2 , a procedure called regularization is applied . by the regularization additional constraints",
    "are imposed on @xmath2 , by which some information in the measurements @xmath47 is discarded .",
    "regularization can be viewed as a smearing of the unfolded distribution with some finite resolution , which reduces the correlations between the @xmath48 of adjacent bins at the expense that @xmath48 is no longer an unbiased estimate of the true distribution @xcite .",
    "+ the bias increases with increasing regularization strength .",
    "nevertheless , it turns out that with properly tuned regularization ( see section [ section : bestweight ] ) solutions can be obtained which are much closer to the true distribution than the direct solutions ( [ eq : s0 ] ) or ( [ eq : slsq ] ) .",
    "+ it is evident that regularization is particularly important in the underconstrained case .",
    "however , also in the overconstrained case regularization makes sense : even if the system of equations ( [ eq : yms ] ) is formally overconstrained ( @xmath49 ) , it may be effectively underconstrained .",
    "this happens for example if some of the measurements @xmath47 have much larger errors than the other @xmath47 .",
    "+ in the following , three different ways of regularization are described @xcite .      in some unfolding methods regularization",
    "is performed by adding a regularization term @xmath51 in the expression for @xmath19 ( eq.[eq : chi20 ] ) @xmath52 @xmath53 , also called regularization parameter , is a weight which allows to steer the regularization strength : large values of @xmath53 correspond to weak regularization , small values to strong regularization .",
    "+    * * tikhonov s method * + [ section : tikhonov ] in tikhonov s method @xcite the regularization term is defined as @xmath54 for the second derivative @xmath55 of @xmath2 in bin @xmath10 different approximations may be used .",
    "the expression used in the magic software @xcite is @xmath56 this is actually an approximation for the bin - to - bin variation of @xmath57 . in @xcite @xmath55",
    "is calculated from a spline representation of @xmath2 .",
    "+ for a given value of @xmath53 and after specifying @xmath51 , expression ( [ eq : chi2reg ] ) can be minimized numerically by varying the components of @xmath2 .",
    "the minimization also provides the error matrix @xmath46 of @xmath2 .",
    "the regularization matrix @xmath58 , defined in ( [ eq13a ] ) , can be calculated numerically by performing minimizations with modified values of @xmath47 . + * * schmelling s method * + [ section : schmelling ] in this method , which is discussed in great detail in @xcite , the regularization term is set equal to the `` cross entropy '' @xmath59 @xmath60 is the normalized distribution @xmath2 @xmath61 and @xmath62 is a normalized prior distribution , which describes a prior knowledge about @xmath2 .",
    "the cross entropy @xmath51 quantifies by how much @xmath63 deviates from @xmath62 .",
    "finding @xmath2 by minimizing the cross entropy @xmath51 simultaneously with the least squares expression @xmath19 is called the method of `` reduced cross entropy '' .",
    "+ with @xmath51 from ( [ eq : regschmelling ] ) , expression ( [ eq : chi2reg ] ) can now be minimized to obtain the unfolded distribution @xmath2 .",
    "note that all components of @xmath2 and of the prior distribution are required to be @xmath64 , because otherwise @xmath51 in ( [ eq : regschmelling ] ) can not be defined .",
    "the expressions for the error matrix @xmath46 of @xmath2 and for the regularization matrix @xmath58 are given in @xcite .",
    "in the magic software , the condition @xmath65 is used as an additional constraint , when minimizing @xmath66 . by this one degree of freedom is gained .      in some unfolding methods regularization",
    "is performed by suppresing small eigenvalues @xmath67 of @xmath7 by a factor @xmath68 @xcite . by the suppression factor",
    "@xmath68 the matrix @xmath7 and its inverse are modified . in terms of the eigenvectors @xmath69 of @xmath7 they read @xmath70 where the sums extend over all eigenvalues @xmath67 which are different from zero .",
    "like @xmath7 and @xmath71 , @xmath72 and @xmath73 are @xmath22 matrices . without suppression , @xmath74 , @xmath73 is equal to @xmath71 in the underconstrained case @xmath20 . in the overconstrained case ,",
    "@xmath75 , @xmath71 is undefined but @xmath73 can be calculated .    a similar factor",
    "@xmath76 can be defined to suppress small eigenvalues @xmath77 of @xmath38 ( eq . [ eq : h ] ) .",
    "there is considerable freedom as to the choice of the values or expressions for @xmath68 and @xmath76 .",
    "one may introduce a parameter @xmath11 such that in the limit @xmath78 the suppression factors @xmath79 and @xmath80 tend to 1 .",
    "@xmath11 has a similar meaning as the weight @xmath53 in eq.([eq : chi2reg ] ) : it determines the regularization strength and for @xmath78 the solutions tend to the direct solutions ( [ eq : s0 ] ) and ( [ eq : slsq ] ) respectively .",
    "+ the expressions for the error matrix @xmath46 of @xmath2 and for the regularization matrix @xmath58 are given in @xcite .",
    "another way of unfolding is to calculate a solution @xmath2 iteratively @xcite .",
    "the regularization is done by stopping the iteration at some point . in this case",
    "the number of iterations @xmath11 plays a similar role as the weight @xmath53 in ( [ eq : chi2reg ] ) . in the limit of an infinite number of iterations , which is equivalent to a very large weight @xmath53",
    ", the solution tends to the direct solution ( [ eq : s0 ] ) or ( [ eq : slsq ] ) respectively .",
    "+    * @xmath81 + a simple iteration scheme @xcite for solving @xmath82 with @xmath83 is + @xmath84 + where @xmath11 is the iteration number and @xmath85 is a relaxation parameter .",
    "the latter should be chosen in the range @xmath86 , where @xmath87 is the largest eigenvalue of @xmath7 .",
    "eq.([eq : c ] ) leads to @xmath88 where @xmath89 is the starting value of @xmath90 .",
    "the unfolded distribution is obtained as @xmath91 .",
    "+ in terms of the suppression factor @xmath92 this regularization can be expressed as @xcite @xmath93 \\label{eq23}\\end{aligned}\\ ] ] if @xmath89 is set to zero , and @xmath94 \\label{eq24}\\end{aligned}\\ ] ] if @xmath89 is chosen to be equal to @xmath14 .",
    "the solutions @xmath95 tends to the direct solution @xmath96 ( eq .",
    "( [ eq : s0 ] ) ) .",
    "+ this procedure can also be applied in the overconstrained case , @xmath75 . in this case @xmath71",
    "is undefined and it has to be replaced by @xmath73 ( eq.[eq : gtilde ] ) .",
    "the solutions @xmath95 tend to @xmath97 , with @xmath74 . + * @xmath98 + in a similar way one may define suppression factors @xmath99 for the eigenvalues of the matrix @xmath38 . in this case",
    "the solution @xmath2 tends to the solution @xmath41 ( eq . ( [ eq : slsq ] ) ) .    in the last 2 methods , spectral window method and regularization by iteration ,",
    "@xmath19 does nt appear explicitly .",
    "however , its value can be calculated and it is taken into account when determining the optimum regularization strength ( see section [ section : bestweight ] ) .",
    "once the the unfolded distribution @xmath100 is determined , by any of the methods described in this section , the differential energy spectrum @xmath101 of @xmath0-rays is calculated using eq .",
    "( [ eq : phik ] ) .",
    "@xmath101 has the meaning of the average differential @xmath0-ray flux in the @xmath102-th bin of @xmath3 ( eq.([eq : phie ] ) ) .",
    "an implicit unfolding can be done by representing @xmath2 as a parametric function @xmath103 with parameters @xmath104 and minimizing @xmath19 in ( [ eq : chi20 ] ) @xmath105 with respect to the parameters @xmath106 .",
    "the number of measurements is equal to @xmath8 , the number of unknowns @xmath107 .",
    "thus , the problem is overconstrained if @xmath108 , independent of the value of @xmath9 .",
    "one degree of freedom is gained if the total number of events is required to stay constant : @xmath109 .    in many cases",
    "the minimization of @xmath19 can be performed analytically , by solving @xmath110 , similarly to the procedure described in section [ subsection : directsolution ] .",
    "the parametrization of @xmath2 can be written in the form @xmath111 with @xmath112 here @xmath113 is the assumed parametrization of the differential energy spectrum of @xmath0-rays , @xmath114 is the effective observation time , @xmath115 denotes the @xmath102-th bin in @xmath3 or its width , @xmath116 is the effectice collection area , and @xmath117 is the reduction factor due to an additional cut ( for example in @xmath4 , see section [ section : additionalcuts ] ) .",
    "a further correction @xmath118 can be introduced , if @xmath113 is supposed to represent the differential energy spectrum of @xmath0-rays before absorption , either at the @xmath0-source or by interaction with the extragalactic photon background .",
    "@xmath119 can be determined from mc simulations , whereas @xmath120 can be calculated in models about the extragalactic photon background @xcite .",
    "parametrizing @xmath2 as an analytic function of @xmath3 , with some free parameters @xmath106 , can be understood as a kind of regularization , because it forces the solution @xmath2 and its derivatives to be continuous , leading to a suppression of the noise component of @xmath2 .",
    "the forward unfolding does not provide an unfolded distribution @xmath2 .",
    "it provides those parameter values @xmath106 for an assumed parametrization of @xmath121 , which minimize @xmath19 in ( [ eq6a ] ) . of course , @xmath2",
    "can then be calculated from @xmath121 via ( [ eq : phik ] ) .    under the assumption of a certain parametrization of @xmath121 ,",
    "the forward unfolding is a very robust method of determining the best parameter values @xmath106 .",
    "moreover , since there is no regularization strength to be adjusted , the uncertainty as to its choice does not exist .",
    "therefore forward unfolding represents a powerful and useful check of the unfolding results obtained by any of the methods described in section [ section : regularization ] . in those methods the parametrization is only introduced after the actual unfolding of the measurements @xmath14 .",
    "in this section two quantities are explained which are useful for judging the quality of the unfolding result : the error matrix ( covariance matrix ) @xmath46 of the unfolded distribution @xmath2 and the regularization matrix @xmath58 .      in all unfolding methods",
    "the covariance matrix @xmath46 of @xmath2 can be determined .",
    "the trace of @xmath46 , @xmath122 , measures the noise component of @xmath2 , as @xmath123 measures the noise component of @xmath14 .    in the methods where the solution @xmath2 is given as @xmath124 , like in schmelling s method or in the spectral window method , the covariance matrix @xmath46 of @xmath2 is obtained by @xmath125 . + in those methods where the solution is determined by a numerical minimization of @xmath66 , like in tikhonov s method , @xmath46 is obtained from the shape of @xmath66 in the region around the minimum .      a quantity which describes how the estimates @xmath126 of @xmath127 couple to the measurements @xmath47 is given by the @xmath22 matrix @xmath128 also called regularization matrix @xcite .",
    "the trace of @xmath58 can be interpreted as the effective number of measurements used in the unfolding procedure .",
    "the number of effectively rejected measurements is then equal to @xmath129 .",
    "+ the maximum value of @xmath130 , which is equal to the rank @xmath6 of @xmath7 , is reached with the direct solutions ( [ eq : s0 ] ) and ( [ eq : slsq ] ) , corresponding to the cases @xmath20 and @xmath75 respectively : for the direct solution @xmath31 the number of rejected measurements @xmath131 is equal to @xmath132 , which means that no information is discarded .",
    "the measurements @xmath14 are completely reproduced by the unfolding : @xmath133 . for the least squares solution @xmath41 the number of effectively rejected measurements is @xmath134 , which means that some information is discarded .",
    "the measurements @xmath14 are not exactly reproduced by the unfolding : @xmath135 .",
    "the fact that the system is overconstrained has a similar effect as regularization . in both cases , with increasing regularization strength @xmath130 is reduced and @xmath131 is increased .",
    "for a given unfolding method the result @xmath2 depends on the regularization strength , which is given by the weight @xmath53 ( or by the number of iterations @xmath11 respectively ) . in the literature various criteria for choosing the `` best '' weight",
    "are proposed @xcite .",
    "unfortunately , none of them provides a choice which is optimal for all cases .",
    "reasons for this are : the optimum regularization strength in general depends on the shape of the unknown distribution @xmath2 .",
    "it also depends on the binnings in @xmath3 and @xmath4 and on the prior distribution ( if applicable ) .",
    "+ the effect of the regularization is illustrated in fig .",
    "[ fig : iterbertero ] , where different quantities are plotted as a function of the iteration number @xmath11 . in this example an experimental energy distribution of @xmath0-rays from the crab nebula @xcite , i.e. the number of excess events in bins of the estimated energy @xmath4 , was unfolded .",
    "the unfolding was performed for 30 different @xmath11 in the range @xmath136 to @xmath137 , using the method of bertero ( eq.([eq24 ] ) ) .",
    "more results from the analysis of these data are given in section [ section : application ] .    with decreasing @xmath11 , i.e with increasing regularization strength , one observes an increase of @xmath19 ( eq . [ eq : chi20 ] ) and a decrease in the quantities @xmath138 , @xmath130 , @xmath139 ( eq . [ eq : regtikhonov ] ) and @xmath140 ( eq . [ eq : regschmelling ] ) .",
    "very similar behavior is found for the other unfolding methods , discussed in section [ section : regularization ] .",
    "obviously , an acceptable unfolding result should satisfy the following conditions :    * the @xmath66-probability , calculated from the value of @xmath19 and the number of degrees of freedom in the unfolding procedure , should be acceptable , say @xmath141 .",
    "otherwise the unfolding result is incompatible with the measured distribution @xmath14 . +",
    "* the noise term @xmath122 of the unfolded distribution @xmath2 should be comparable to the noise term @xmath123 of the measurements .",
    "the main aim of regularization is a suppression of the large noise term of @xmath2 , which one often obtains if no regularization is applied . a large noise term @xmath122 , as well as large correlation terms of @xmath46 ,",
    "indicate a too fine binning in @xmath3 , leading to small eigenvalues of @xmath7 or @xmath38 ( see section [ sect : optimalbinnings ] ) . +",
    "* @xmath130 should not be much lower than its maximum possible value , which is equal to the rank @xmath6 of the matrix @xmath7 .",
    "otherwise the solution is too strongly dominated and biased by the regularization .    for determining the `` best '' regularization strength a compromise has to be found between the above requirements .",
    "it has turned out that the criterion @xmath142 in general leads to solutions which satisfy the above conditions reasonably well , provided the problem is not strongly overconstrained . in the latter case , where the unfolding result is better constrained , a solution with @xmath143 is more apropriate . in magic the standard criterion for determining the optimal regularization strength is @xmath142 .",
    "the full circles in fig . [ fig : iterbertero ] indicate this choice .",
    "however , any other regularization strength can be chosen by hand , if this is suggested by the behaviour of the quantities @xmath144 or @xmath145 .",
    "unfolding with regularization is a procedure which allows freedom in the choice of the regularization method and in the choice of the regularization strength .",
    "the above criteria for an acceptable solution strongly restrict this freedom .",
    "nevertheless a certain degree of arbitrariness remains as to which unfolding result should be considered representative and final . in magic",
    "a selected unfolding result is considered representative if all other unfolding methods yield results , which are also acceptable and statistically consistent with the selected result .",
    "in addition , it is required that also the forward unfolding ( section [ section : forwardunfolding ] ) , using a reasonable parametrization of @xmath121 , gives a consistent result .",
    "an uncertainty due to the unfolding is determined from the spread of the @xmath45 , obtained from the different unfolding methods .",
    "in the actual application of the unfolding procedure to real data some technical details have to be considered , and they are discussed in this section .",
    "the binning of the experimental distribution @xmath14 is often dictated by the available statistics and by the experimental errors .",
    "the binning should not be chosen too fine in order to assure significant measurements in all bins . in the case of an iact experiment ,",
    "a sufficiently large sample is required to determine the number of signal ( excess ) events with sufficient accuracy .",
    "the binning should not be chosen too wide either , because the binning in @xmath14 limits the reconstruction of the fine structure of the unfolded distribution @xmath2 .",
    "another criterion for the binnings is the behavior of gram s matrix @xmath7 .",
    "a too fine binning for @xmath2 leads to strong correlations between neighboring columns of the migration matrix @xmath13 , implying small eigenvalues of @xmath7 , which lead to a large noise component of @xmath2 . given a certain choice of the binning in @xmath4 and thus of @xmath8 , the bin size in @xmath3 or @xmath9",
    "should be set such , that the system of linear equations ( [ eq : yms ] ) is not underconstrained .",
    "this usually leads to wider bins in @xmath3 than in @xmath4 . in magic",
    "a typical value of @xmath146 is 1.4 ( see section [ section : application ] ) . + it should also be noted that the unfolding procedure does nt require equidistant bins , neither in @xmath4 nor in @xmath3 .",
    "if @xmath147 specifies the range of bins of the measured distribution @xmath14 which are to be considered in the unfolding procedure , also the range in @xmath3 to be considered in the unfolding has to be chosen properly : one has to make sure that all bins @xmath10 of @xmath3 are present , for which the column @xmath10 of the migration matrix @xmath148 contributes to the selected bins of @xmath14 , i.e. for which at least one of the elements @xmath149 is different from zero .",
    "there is an exception to this rule , if for some reason certain bins @xmath10 of @xmath3 are not expected to contribute to the selected bins in @xmath4 .",
    "this is for example the case if one of the factors @xmath150 in ( [ eq : phik ] ) is so small that @xmath100 can be neglected .",
    "as explained in section [ section : notation ] , the distribution @xmath14 and the migration matrix @xmath13 have to be produced under identical conditions ( selections , cuts ) .",
    "if an additional cut is imposed when generating @xmath14 , also @xmath13 has to be recalculated before doing the unfolding .",
    "if this additional cut is a cut in @xmath4 one may proceed in the following way :    * renormalize the columns @xmath10 of @xmath13 to the selected range in @xmath4 ( see eq.([eq : normalizem ] ) ) .",
    "* perform the unfolding of @xmath14 in the usual way . *",
    "apply a correction @xmath151 to the unfolded distribution @xmath45 , where @xmath151 is the renormalization factor for column @xmath10 of @xmath13 .      in the cases where the unfolding procedure involves numerical minimizations , like the ones discussed in section [ subsection : regularizationterm ] ,",
    "the minimization may not converge .",
    "this problem can be often solved by choosing different starting values .",
    "another reason for non - convergence is discussed in section [ section : cannotbedetermined ] . in magic",
    "the standard choice of the starting distribution for @xmath2 , and also of the prior distribution @xmath62 in schmelling s method , is a distribution which is close to the measured distribution @xmath14 .      according to eq .",
    "( [ eq : yms ] ) those @xmath45 for which the column @xmath148 @xmath152 is a null vector have no influence on @xmath14 and can therefore not be determined in the unfolding .",
    "these components should not be varied in the minimization because they would unnecessarily complicate the minimization process and may lead to non - convergence .      for",
    "the unfolding the migration matrix @xmath148 is the crucial quantity .",
    "obviously , if it does nt describe the real migration of events correctly , the unfolding result will be wrong .",
    "this means that at fixed @xmath10 , i.e. at fixed @xmath3 , the mc simulation has to describe the migration in @xmath1 correctly . this will be the case if at fixed @xmath3 the shower simulation is realistic and if the detector response is simulated correctly .",
    "on the other hand , the distribution of @xmath3 in the mc need not agree with the real distribution of @xmath1 : due to the normalization of @xmath13 ( eq . ( [ eq : normalizem ] ) )",
    "the bin - to - bin - variation of the number of mc events in @xmath3 has no influence on @xmath148 at all .",
    "this is one of the great advantages of unfolding methods like those presented in section [ section : regularization ] as compared to methods based on correction factors ( see section [ section : correctionfactors ] ) .",
    "however , there is a residual dependence of @xmath148 due to the finite binning in @xmath3 : depending on the shape of the @xmath3 distribution within an @xmath3 bin in the mc simulation , the calculated @xmath148 may be more representative for the lower , middle or upper part of the @xmath3 bin .",
    "if the @xmath3 distribution in the real data is different from that in the mc simulation the calculated @xmath148 may not be exactly the right ones .",
    "this residual dependence of @xmath13 on the shape of the @xmath3 distribution in the mc can be nearly completely removed by an iteration procedure in which the @xmath13 for the next iteration step is determined from a mc sample , in which the @xmath3 distribution has been corrected using the unfolding result of the last iteration step ( see section [ section : aeffandm ] ) .",
    "in an iact experiment it is important that the effective collection area @xmath153 , which enters in the flux calculation , is computed taking into account a realistic shape of the differential flux @xmath121 and the actual distribution of effective observation times @xmath155 in the zenith angle @xmath154 .",
    "this is also important for the migration matrix @xmath13 , which enters in the unfolding , because of the residual dependence on the flux spectrum , as discussed in section [ section : mcdependence ] .",
    "recalculating @xmath153 and @xmath13 with the proper @xmath3 and @xmath154 spectra is the more important the bigger the @xmath156 interval and the stronger the variations of @xmath13 and @xmath153 within this bin are .",
    "often , for statistics reasons , large bin sizes in @xmath4 and @xmath154 , and thus also in @xmath3 , have to be chosen .    in the following it is assumed that the effective collection area @xmath153 and the migration matrix @xmath13 are known functions of @xmath3 and @xmath154 .",
    "this can be achieved by determining them from a sample of mc @xmath0-ray events in very fine bins of @xmath3 and @xmath154 .",
    "the aim is to calculate an average @xmath157 of the effective collection area and an average @xmath158 of the migration matrix , which are representative for a finite bin @xmath156 in @xmath3 and @xmath154 .",
    "the number of observed events in a @xmath156 bin is given by @xmath159 here @xmath160 is the differential @xmath0-ray flux to be measured , @xmath161 is the distribution of observation times in the experimental data and @xmath162 is the known dependence of the effective collection area on @xmath3 and @xmath154 .    with the definitions @xmath163 equation ( [ eq41 ] )",
    "can be rewritten as @xmath164 this is the usual formula for converting numbers of events @xmath2 into differential fluxes @xmath165 . because of the definitions ( [ eq42a ] ) and ( [ eq44x ] ) the differential flux @xmath166 in an @xmath3 bin , as determined in the unfolding , is the average differential flux in this bin .",
    "therefore , when quoting or plotting a result for @xmath166 the bin edges in @xmath3 should also be given or shown .",
    "the number of reconstructed mc events in a bin @xmath11 of @xmath4 can be written as @xmath167    @xmath168 is the element of the normalized migration matrix for the @xmath11-th bin in @xmath4 , at an energy @xmath3 .",
    "the index @xmath10 of @xmath148 is replaced by the variable @xmath3 .",
    "the dependence of @xmath168 on @xmath3 and @xmath154 is assumed to be known from mc simulations .",
    "the average migration matrix @xmath169 for the selected @xmath170 bin , to be used in the unfolding , is then obtained by @xmath171    the averages @xmath169 and @xmath157 are calculated according to ( [ eq60 ] ) and ( [ eq44x ] ) respectively , using an approximation @xmath172 of the function @xmath160 .",
    "the measured distribution @xmath14 is unfolded using @xmath169 , yielding the unfolded distribution @xmath2 . a new approximation @xmath173 is then determined from @xmath2 according to eq .",
    "( [ eq47 ] ) .",
    "the procedure is iterated until @xmath160 has converged . in practice parametric functions",
    "are used as approximations of @xmath160 , and in general the convergence is found to be very fast .",
    "one often has the situation that there exist several measured distributions @xmath174 of the same quantity . if the @xmath174 were obtained under different conditions also the migration matrices @xmath175 and the effective collection areas @xmath176 will be different for the different measurements .    in an iact experiment",
    "the different conditions may be    * different modes of observation ( on / off mode , wobble mode , observation in the presence of moon light , ... ) .",
    "* different ranges of the zenith angle .",
    "* different detector conditions .",
    "* etc .    in order to determine a final unfolded distribution @xmath2 one may proceed in different ways :    * * individual unfolding * : + unfold each @xmath174 using @xmath175 to obtain @xmath177 , and combine the @xmath177 to obtain the final solution @xmath2 . +",
    "* * global unfolding * : + combine the @xmath174 and @xmath175 to obtain a global @xmath14 and @xmath13 , do an unfolding of @xmath14 using @xmath13 , which will give the final solution @xmath2 .",
    "there is one important argument in favour of the second option : each of the @xmath174 , or some of them , may have large statistical errors , making the unfolding of the individual @xmath174 unstable .",
    "one common unfolding of the global @xmath14 using the global @xmath13 will be more robust , in general .    in the case of an iact experiment ,",
    "the following relations hold for each measurement @xmath178 : @xmath179 @xmath10 denotes the @xmath10-th bin in @xmath3 , @xmath180 is its width , @xmath181 is the average flux and @xmath182 is the effective collection area in this bin , and @xmath46 is the effective observation time . since @xmath165 and @xmath183 are the same for all @xmath178 the relations for the combined data read : @xmath184 inserting @xmath185 and @xmath186 in ( [ eq32 ] ) and using ( [ eq31 ] ) one obtains @xmath187 the relations ( [ eq32a ] ) and ( [ eq33 ] ) give the prescription how to combine the individual @xmath175 to obtain the global @xmath13 , and how to combine the individual @xmath188 to obtain the global @xmath182 . the measured distribution @xmath14 is unfolded using @xmath13 , and the unfolded distribution @xmath2 is converted into a flux @xmath165 according to ( [ eq32 ] ) . as can be seen from ( [ eq32a ] ) and ( [ eq33 ] ) the @xmath182 are weighted averages of the @xmath188 with weights @xmath189 , and the @xmath148 are weighted averages of the @xmath190 with weights @xmath191 .",
    "the weights can be interpreted as fractions because they add up to 1 .",
    "they are correlated and their covariance matrix has to be taken into account when calculating the errors of @xmath182 and @xmath148 .    the equations ( [ eq32a ] ) and ( [ eq33 ] ) also show that @xmath182 and @xmath148 can be obtained without knowning which spectra @xmath121 and @xmath155 were used to compute the @xmath192 and @xmath193 .",
    "in this section an experimental energy distribution of @xmath0-rays from the crab nebula is unfolded , which was obtained in an analysis of data taken with the magic telescope @xcite .",
    "the migration matrix @xmath13 , as determined from a sample of @xmath0-mc events , is plotted in fig .",
    "[ fig : crabdata]a ) as a function of @xmath4 and @xmath3 .",
    "the size of the boxes is proportional to the value of @xmath148 , where @xmath11 and @xmath10 are the bin numbers in @xmath4 and @xmath3 respectively .",
    "the experimental distribution @xmath14 of the number of @xmath0-excess events as a function of @xmath4 is displayed in fig .",
    "[ fig : crabdata]b ) .",
    "both distributions are after all cuts and selections , except a cut in @xmath4 .    the vertical and horizonthal lines in figs .",
    "[ fig : crabdata]a ) and c ) indicate the ranges in @xmath4 or @xmath3 , which were selected for the unfolding .",
    "the range in @xmath4 is given by those @xmath4 bins for which a significant number of excess events could be determined .",
    "the range in @xmath3 comprises all those @xmath3 bins which are expected to contribute to the selected range in @xmath4 .",
    "[ fig : crabdata]a ) suggests that these are all 15 @xmath3 bins .",
    "however , according to the plot of the effective collection area @xmath194 in fig . [",
    "fig : crabdata]c ) the contribution from @xmath195 gev is expected to be negligible .",
    "the same holds for @xmath196 tev , due to the strongly decreasing @xmath0-ray flux with increasing energy .",
    "this is confirmed by a forward unfolding of @xmath14 in which a differential @xmath0-ray flux of the form @xmath197 , with @xmath198 , was assumed .",
    "this leads to a number of @xmath4 and @xmath3 bins of @xmath199 and @xmath200 respectively , which are used in the unfolding procedure .",
    "the size of the @xmath201 bins was deliberately chosen wider than the @xmath202 bins by a factor of 1.4 , in order to better constrain the unfolding .",
    "the rank of gram s matrix @xmath7 is equal to @xmath203 , as can be seen from fig .",
    "[ fig : crabdata]d ) , which shows the size of the eigenvalues @xmath67 of @xmath7 as a function of @xmath204 .",
    "two to three of these eigenvalues are much smaller than the maximum eigenvalue , and they are the reason for the large values of @xmath138 at large iteration number ( low regularization strength ) in fig .",
    "[ fig : iterbertero]b ) .",
    "the optimum regularization strength and thus the final solution @xmath2 was determined using the criterion @xmath205 .",
    "the estimates @xmath206 ( open circles ) of @xmath47 are compared with @xmath47 ( histogram ) in fig .",
    "[ fig : crabdata]b ) .",
    "these data enter in the calculation of @xmath19 ( eq . [ eq : chi20 ] ) .",
    "the number of degrees of freedom in the unfolding procedure is @xmath207 , because the number of measurements is @xmath8 , the number of unknowns is @xmath9 , and the relation @xmath208 ( eq . [ eq : addconstraint ] ) is used as additional constraint . as can be seen from figs .",
    "[ fig : iterbertero]d ) and e ) the values of @xmath139 and @xmath140 are much lower at the selected regularization strength than without regularization .",
    "this means that the solution @xmath2 is smoothed by the regularization .",
    "the black symbols in fig . [",
    "fig : crabresults]a ) represent the final solution @xmath2 .",
    "the solution before correctiong for the cut in @xmath4 is drawn with grey symbols .",
    "+ the final differential @xmath0-ray flux @xmath165 , as computed from @xmath2 according to eq.([eq : phik ] ) , is drawn in fig .",
    "[ fig : crabresults]b ) .",
    "the solid line represents the result of a fit of the expression @xmath209 , with @xmath198 , to the data points .",
    "the number of degrees of freedom for this fit is @xmath210 , because the number of data points is @xmath200 and the number of free parameters is 3 ( @xmath211 , @xmath212 and @xmath213 ) .",
    "the @xmath66 is 8 for 7 degrees of freedom .",
    "setting @xmath214 in the fit yields a @xmath66 of 24 for 8 degrees of freedom .",
    "this fit is clearly disfavoured as compared to the fit in which the slope @xmath215 is energy dependent . in these fits the full correlation matrix @xmath46 of @xmath2 has been taken into account .",
    "the result of the latter fit for @xmath121 was used to recalculate the averages @xmath169 ( [ eq60 ] ) and @xmath157 ( [ eq44x ] ) for the individual @xmath3 bins . the unfolding was repeated using the recalculated @xmath169 and @xmath157 , yielding new results for @xmath2 , @xmath165 and the fit parameters .",
    "after 1 iteration this procedure converged .",
    "very similar results were obtained with the other unfolding methods .",
    "the spread of the @xmath45 , obtained with the different unfolding methods , can be seen in fig .",
    "[ fig : crabresults]c ) . this spread can be regarded as an estimate of the a systematic error due to the unfolding .",
    "a widely used method of correcting experimental distributions is the application of correction factors : using monte carlo data , both the true distribution @xmath216 and the reconstructed distribution @xmath217 of some quantity are produced under certain conditions ( selections , cuts ) .",
    "correction factors are determined according to @xmath218 an experimental distribution @xmath219 , obtained under the same conditions as @xmath220 , is then corrected by @xmath221 to obtain the corrected distribution @xmath100 .",
    "the following properties of this procedure can be stated @xcite :    * @xmath222 is undefined if @xmath223 . *",
    "if @xmath224 also @xmath225 and @xmath226 , which means that @xmath219 is ignored .",
    "* @xmath222 depends on the shape of the mc distribution @xmath227 ; the corrected distribution @xmath100 is always biased towards @xmath227 . *",
    "if @xmath228 also @xmath100 is zero . * the standard linear error propagation often yields too small errors of @xmath100 .",
    "the correction factors are only right if @xmath227 is identical to the true @xmath100 distribution .",
    "if this is not the case one may iterate @xmath227 , setting @xmath227 equal to the last corrected experimental distribution @xmath100 . however",
    ", this often leads to instabilities .",
    "the reason for the instabilities appears to be similar to that causing a large noise component of the direct solution ( [ eq : s0 ] ) .",
    "in contrast to the unfolding methods presented in section [ section : regularization ] , there is very little freedom in choosing the binnings for @xmath2 and @xmath14 . by definition ,",
    "the range of values and the binnings for the true and reconstructed quantity are identical .",
    "advantages of the method of correction factors are that it is simple and stable .",
    "the drawbacks have been listed above , the severest one being the strong dependence of the correction factors on the assumptions made in the mc about @xmath2 .",
    "in this paper the procedures to unfold experimental energy distributions of @xmath0-rays , as applied in the magic experiment , are described .",
    "it is explained , how the uncertainties , which are inherent in any unfolding process , can be handled successfully .",
    "possible problems in the unfolding are discussed and suggestions are given which can help to avoid them .",
    "various techniques are presented , which allow to reconstruct the energy spectrum in a rather unbiased way .",
    "all algorithms are impleneted in the magic software , which is based on the @xmath229 language and root @xcite .",
    "their application to real data has shown to provide robust and reliable results .",
    "the methods and procedures are applied in most of the magic analyses .",
    "we thank michael schmelling for fruitful discussions and critical comments .    10 baixeras , c. et  al . , 2004 ,",
    "instrum . meth . , a518 , 188 .",
    "r.  gold , anl-6984 ( 1964 ) g.i .",
    "marchuk , `` methods of numerical mathematics '' , springer , berlin ( 1975 ) a.n .",
    "tikhonov and v.ja .",
    "arsenin , methods of solution of ill - posed problems - m ( nauka , 1979 ) s.w .",
    "provencher , computer physics communications 27 ( 1982 ) 213 and 229 v.  blobel , `` unfolding methods in high - energy physics experiments '' , desy 84 - 118 ( 1984 )",
    ". v.  blobel , 1984 cern school of computing , ajguablava , spain , cern 85 - 09 ( 1984 ) p.88 .",
    "belogorlov et al . , `` interpretation of the solution to the inverse problem for the positive function and the reconstruction of neutron spectra '' , nim a 235 ( 1985 ) 146 . s.f .",
    "giljazov , `` methods of solution of linear ill - posed problems '' , msu , moscow ( 1987 ) v.p .",
    "zhigunov et al . , `` on estimating distributions with the maximum entropy principle '' , nim a 273 ( 1988 ) 362 m.  bertero , infn / tc-88/2 ( 1988 )",
    ". m.  bertero , advances in electronics and electron physics , vol.75 ( 1989 ) .",
    "anykeyev et al . , nim a 303 ( 1991 ) 350 .",
    "m.  schmelling , `` the method of reduced cross - entropy . a general approach to unfold probability distributions '' , nim a 340 ( 1994 ) 400",
    ". v.  blobel , `` the run manual '' , opal technical note tn361 ( 1996 ) a.  hcker and v.  kartvelishvili , nim a 372 ( 1996 ) 469 .",
    "m.  schmelling , `` numerische methoden der datenanalyse '' , mpi - k heidelberg ( 1998 ) v.  blobel , `` an unfolding method for high energy physics '' , ippp workshop on advanced statistics techniques in particle physics , durham ( 2002 ) w.  wittek,``correlations between parameters of extended air showers and their proper use in analyses '' , 26th int .",
    "cosmic ray conference , salt lake city , utah , usa ( 1999 ) majumdar , p. et  al .",
    "( magic collab . ) , 2005 , proc . of the 29th icrc , pune , india , 5 - 203 , astro - ph/0508274 .",
    "mizobuchi , s. et  al .",
    "( magic collab . ) , proc .",
    "29th icrc , pune , india , 5 - 323 , astro - ph/0508274 .",
    "bretz , t. and wagner , r. ( magic collab . ) , 2003 , proceedings of the 28@xmath230 icrc , tsukuba , japan , 2947 .",
    "kneiske et al . , a&a 413 ( 2004 ) 807 j.  albert et al . , submitted for publication in apj ( 2007 ) , arxiv:0705.3244 .",
    "r.  brun , f.  rademakers , http://root.cern.ch/."
  ],
  "abstract_text": [
    "<S> the paper describes the different methods , used in the magic experiment , to unfold experimental energy distributions of cosmic ray particles ( @xmath0-rays ) . </S>",
    "<S> questions and problems related to the unfolding are discussed . </S>",
    "<S> various procedures are proposed which can help to make the unfolding robust and reliable . </S>",
    "<S> the different methods and procedures are implemented in the magic software and are used in most of the analyses .    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    ,    , </S>"
  ]
}