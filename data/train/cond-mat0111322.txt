{
  "article_text": [
    "density functional theory ( dft ) combined with the pseudopotential method has been established as an important theoretical tool for studying a wide range of problems in condensed matter physics @xcite .",
    "however , the computational cost of performing a total - energy calculation on a system scales asymptotically as the cube of the system size .",
    "consequently , plane - wave pseudopotential dft can only be used to study systems of up to about one hundred atoms on a single workstation and up to a few hundred atoms on parallel supercomputers . as a result",
    "there has been considerable recent effort in the development of methods whose computational cost scales linearly with system size @xcite .",
    "a common feature of many of the linear - scaling strategies is the expansion of the single - particle density matrix in terms of a set of localised functions .",
    "we refer to these functions as ` support functions ' @xcite .",
    "a support function is required to be non - zero only within a spherical region , which we refer to as a ` support region ' , centred on an atomic position .",
    "here we consider a representation of the support functions in terms of a regular real space grid , which constitutes our basis set .",
    "if the set of support functions is @xmath0 , the single - particle density matrix is expressed as @xmath1 where @xmath2 is the matrix representation of the density matrix in terms of the duals of the support functions . in general",
    "the support function set is not orthonormal .",
    "real space methods have the advantage that they provide a clear spatial partitioning of all quantities encountered in a density functional calculation , a property that is ideal for code parallelisation . as a result",
    ", this approach has gained popularity in recent years and a number of such density functional calculations have been reported by different authors @xcite .",
    "these approaches use finite difference ( fd ) methods @xcite for the calculation of the kinetic energy . in terms of the support functions the kinetic energy is @xmath3=\\sum_{\\alpha , \\beta } t_{\\alpha \\beta } k^{\\beta \\alpha } \\ , \\label{matrix_kinetic}\\ ] ] where @xmath4 denotes kinetic energy matrix elements between support functions , given in hartree atomic units by @xmath5 the evaluation of the kinetic energy matrix elements requires the action of the laplacian operator on the support functions . here",
    "we will show that in the case of localised support functions , fast fourier transform ( fft ) methods can be adapted for the application of the laplacian , providing an algorithm with essentially the same computational cost as fd but with higher accuracy and also ready applicability to any grid symmetry .    in the following two sections we present the fd method and our new fft - based method and",
    "compare them both in theory and in practice .",
    "for functions represented as values on a regular grid , integrals like the one of equation ( [ tab ] ) can be calculated , or rather approximated to increasing accuracy , by a sum over grid points , as long as the value of the integrand is known at every grid point : @xmath6 where @xmath7 is the laplacian operator in the discrete representation , @xmath8 is the volume per grid point , and the sum formally goes over all the grid points in the simulation cell .",
    "the most straightforward approach to the evaluation of the laplacian operator applied to a function at every grid point is to approximate the second derivative by finite differences of increasing order of accuracy @xcite .",
    "for example , the @xmath9 part of the laplacian on a grid of orthorhombic symmetry is @xmath10 where @xmath11 is the grid spacing in the @xmath12-direction , @xmath13 is the order of accuracy and is an even integer , and the weights @xmath14 are even with respect to @xmath15 , i.e. @xmath16 .",
    "this equation is exact when @xmath17 is a polynomial of degree less than or equal to @xmath13 .",
    "the leading contribution to the error is of order @xmath18 .",
    "the full laplacian operator for a single grid point in three dimensions consists of a sum of @xmath19 terms .    in principle , for well behaved functions",
    ", the second order form of equation ( [ laplacian_fd ] ) should converge to the exact laplacian as @xmath20 . therefore to increase the accuracy of a calculation one would need to proceed to smaller grid spacings .",
    "however , in most cases of interest , this is computationally undesirable and instead , formulae of increasing order are used to improve the accuracy at an affordable cost @xcite .",
    "chelikowsky et al .",
    "@xcite , in their finite difference pseudopotential method , have tested the finite difference expression for up to @xmath21 on calculations of a variety of diatomic molecules and have suggested @xmath22 as the most appropriate for their purpose , as the higher orders did not provide any significant improvement .",
    "alternative discretisations of the laplacian operator are possible , such as the mehrstellen discretisation of briggs et al .",
    "this is a fourth order discretisation that includes off - diagonal terms , but only nearest neighbours to the point of interest .",
    "it is more costly to compute than the standard fourth order formula of equation ( [ laplacian_fd ] ) and it is still not clear whether its fourth order is sufficient . one may also use fd methods on a grid with variable spatial resolution , such as that of modine et al .",
    "@xcite which is denser near the ionic positions . such a scheme , however , has the added overhead of a transformation of the laplacian from cartesian to curvilinear coordinates . in this paper",
    "we use only the fd scheme of equation ( [ laplacian_fd ] ) .",
    "the fd approach has desirable properties , both in terms of computational scaling and parallelisation .",
    "the laplacian in the fd representation is a near - local operator , becoming more delocalised with increasing order .",
    "therefore , the cost of applying it to @xmath23 grid points is strictly linear ( compared to @xmath24 for fourier transform methods ) .",
    "also , as a result of its near - locality , ideal load balancing can be achieved in parallel implementations by partitioning the real space grid into subregions of equal size and distributing them amongst processing elements ( pes ) while requiring little communication for applying the laplacian at the bordering points of the subregions .",
    "if @xmath25 represents the size of the system , then the number of support functions will be proportional to @xmath25 and so will the total number of grid points in the simulation cell , resulting in a total computational cost proportional to @xmath26 for the application of the laplacian on all support functions .",
    "more favourable scaling can be achieved by predicting the region in space whithin which the values of a particular function will be of significant magnitude and operating only on this region @xcite",
    ". linear - scaling can be achieved by strictly restricting from the outset the support functions to spherical regions centred on atoms @xcite . in this case , the cost is @xmath27 with @xmath28 being the cost of applying the laplacian on the points of a spherical region , which is constant with system size .",
    "fd methods nevertheless have disadvantages that do not appear in the plane - wave formalism .",
    "firstly , there is no _ a priori _ way of knowing whether a particular order of fd approximation will be sufficient to represent a particular support function accurately .",
    "in addition , while plane - wave methods can handle different symmetry groups trivially through the reciprocal lattice vectors of the simulation cell , real space implementations need to consider every symmetry separately and require considerable modifications to the code and higher computational cost .",
    "briggs et al .",
    "@xcite have demonstrated this difficulty by performing calculations with hexagonal grids while most common applications of real space methods in the literature are limited to grids of cubic or orthorhombic symmetry @xcite .",
    "the computational cost for the calculation of the laplacian of a single support function with the fd method scales as @xmath29 where @xmath30 is the number of grid points within the support region , and @xmath31 is the number of grid points along the support region diameter and is proportional to @xmath32 .",
    "this estimate of cost includes all the nonzero values of the laplacian , which in general occur not only at the grid points inside the support region but also at points outside , up to a distance of @xmath33 points from the region s boundary .",
    "it is important to include the contribution to the laplacian from outside the support region in the sum of equation ( [ real_sum ] ) in order to obtain the best possible accuracy for a given order @xmath13 and also to ensure the hermiticity of the discretised representation of the laplacian , @xmath7 , and hence of the kinetic energy matrix elements @xmath4 .",
    "we now present an accurate , linear - scaling method for calculating the kinetic energy matrix elements @xmath34 of equation ( [ tab ] ) .",
    "we use a mixed space fourier transform approach that is applicable to any bravais lattice symmetry .",
    "fourier transformation is a natural method to adopt for this task since in a total - energy calculation one computes other terms , such as the electron density and the hartree energy , using reciprocal space techniques .",
    "this implicitly defines the basis set that we use to be plane - waves and for consistency we should calculate the kinetic energy using the same basis set , i.e.  using fourier transform methods .",
    "thus we calculate the @xmath35 term in reciprocal space , where the laplacian operator is easy to apply , then transform the result back to real space and obtain the matrix elements @xmath34 by summation over grid points ( [ real_sum ] ) .",
    "one way to achieve this would be to perform a discrete fft on each support function @xmath17 , using the periodicity of the entire simulation cell .",
    "however , unlike the fd algorithm , the fft is not a local operation and the cost of applying the laplacian to all the support functions in this way would be proportional to @xmath36 , which clearly does not scale linearly with system size .",
    "it is possible to overcome this undesirable scaling without compromising accuracy by performing the fft over a restricted region of the simulation cell , which we call the ` fft box ' ( figure [ fft_box ] ) . before defining the fft box , there are two points that should be noted .",
    "firstly , the operator @xmath7 must be hermitian .",
    "this will ensure that the kinetic energy matrix elements , @xmath4 are hermitian , and hence the eigenvalues real .",
    "secondly , when calculating two matrix elements such as @xmath4 and @xmath37 , we require the quantity @xmath38 in both cases . to be consistent , our method for calculating the matrix elements must be such that @xmath38 is the same in both cases , i.e.  we require @xmath38 to have a unique and consistent representation throughout the calculation .",
    "it is important that both these conditions are satisfied when it comes to optimisation of the support functions during a total - energy calculation , and we shall return to this point later .    in order to fulfil the above requirements , it can be seen that for a given calculation the fft box must be universal in shape and dimensions . as a result",
    ", it must be large enough to enclose any pair of overlapping support functions within the simulation cell . to define a suitable fft box , we first consider a box with the same unit lattice vectors as the simulation cell , but of dimensions such that it exactly circumscribes the largest support region present in the simulation cell .",
    "we then define a box that is commensurate with this , but with sides that are twice as long ( and hence a volume eight times as large ) .",
    "this we define to be the fft box .",
    "it is clear that this fft box is large enough to enclose any pair of support functions exhibiting any degree of overlap .",
    "[ 0.45 ]    to calculate a particular matrix element @xmath34 for two overlapping support functions @xmath39 and @xmath40 , we imagine them as being enclosed within the fft box defined above and we treat this region of real space as a miniature simulation cell .",
    "we fourier transform @xmath40 using the periodicity of the fft box and apply the laplacian at each reciprocal lattice point using standard plane - wave techniques @xcite .",
    "it is then a simple matter of using one more fft to back - transform @xmath41 to real space and subsequently calculate @xmath34 by summation over the grid points of the fft box , according to equation ( [ real_sum ] ) .",
    "the result obtained by this process is equivalent to performing a fourier transform of @xmath40 over the whole simulation cell , applying the laplacian and then interpolating to a coarse , but still regular , reciprocal space grid with only @xmath42 points , @xmath42 being the number of grid points in the fft box , before back - transforming to real space .",
    "this coarse sampling in reciprocal space has a negligible influence on the result because each support function is strictly localised in real space and therefore smooth in reciprocal space .",
    "it is worth noting the implicit approximation that we make in calculating the kinetic energy in the way prescribed above . in general",
    ", @xmath41 is nonzero outside the support region of @xmath40 itself , and it is essential to take this into account in the calculations . by construction , we neglect contributions to the kinetic energy from support functions whose support regions do not overlap as we expect them to be negligibly small .",
    "this approximation may be controlled via a single parameter , the fft box size , with respect to which the calculation may be converged if necessary .",
    "the same approximation is of course present in the fd method as well .",
    "we expect certain advantages to the fft box algorithm over fd based methods .",
    "firstly , the fft box method should be more accurate than any fd scheme since it takes into account information from every single point of the support function and not only locally . however ,",
    "it is still perfectly local as far as parallelisation is concerned since we only deal with the points within a single fft box each time , and this constitutes a very small region of the simulation cell .",
    "the parallelisation strategy in this case would still consist of partitioning the real space grid of the simulation cell into subregions of equal size and distributing them amongst pes . then",
    ", ffts local to each pe are performed on fft boxes enclosing pairs of overlapping support regions belonging completely to the simulation cell subregion of the given pe . for pairs of overlapping support regions containing grid points common to the subregion of more than one pe",
    ", the pair would have to be attributed to one pe and copied as a whole to it for the local fft to proceed .",
    "this would involve some communication overhead , as in the fd case for pairs of overlapping support functions with points in more than one subregion .",
    "another important advantage of the fft box method is that it is applicable , without any modification , to regular grids of any bravais lattice symmetry .",
    "this is not true of fd methods .",
    "the number of grid points in a cubic fft box is @xmath42 ( which is related to @xmath30 by @xmath43 ) .",
    "therefore the computational cost of applying the fft method to a single support function in such an fft box is @xmath44 , and thus for all support functions the cost is proportional to @xmath45 , where @xmath42 is independent of @xmath25 .",
    "in other words the cost scales linearly with the number of atoms in the system .",
    "we have performed tests of the fd and fft box methods for calculating the kinetic energy of localised functions . choosing a particular type of support function @xmath17 with spherical symmetry , placing one at @xmath46 and another at @xmath47 , we rewrite the integral of equation ( [ tab ] ) as @xmath48 for our first test we calculate the following quantity as a function of the distance @xmath49 between the centres @xmath46 and @xmath47 @xmath50 where @xmath51 is the exact value of the integral in the continuous representation of the support functions and @xmath52 is its approximation on the real space grid , either by fd or the fft box method .",
    "we chose @xmath53 to be a 2s valence pseudo - orbital for a carbon atom , generated using an atomic norm - conserving carbon pseudopotential @xcite within the local density approximation .",
    "the pseudo - orbital is confined in a spherical region of radius @xmath54 , and vanishes exactly at the region boundary @xcite .",
    "it is initially generated as a linear combination of spherical bessel functions , which are the energy eigenfunctions of a free electron inside a spherical box .",
    "our functions are limited up to an energy of 800 ev , resulting in a combination of fourteen bessel functions .",
    "the formula for calculating kinetic energy integrals between bessel functions is known @xcite and we used it to obtain @xmath51 for our valence pseudo - orbital .",
    "we then calculated @xmath55 with a grid spacing of @xmath56 ( corresponding to a plane - wave cut - off of 839 ev ) in an orthorhombic simulation cell , as we are restricted to do so by the fd method . with these parameters @xmath42 is @xmath57 , and hence it is trivial to perform the fft of one support function on a single node .",
    "@xmath55 is plotted for the fft box method and for various orders of the fd method in the top graph of figure [ errors ] .",
    "it can be seen that low order fd methods are inaccurate as compared to the fft box method , and only when order 28 fd is used does the accuracy approach that of the fft box method .",
    "the scheme , the highest order that has been used in practice for calculations @xcite , gives an error of @xmath58 at @xmath59 as compared to @xmath60 for the fft box method .",
    "the feature that occurs in the top graph of figure [ errors ] , between @xmath61 and @xmath62 , is an artefact of the behaviour of our pseudo - orbitals at the support region boundaries where they vanish exactly , but with a finite first derivative .",
    "this causes an enhanced error in all the methods when the edge of one support function falls on the centre of another .",
    "the error in the fft box method is small , yet non - zero , and we attribute this to the inherent discretisation error associated with representing functions that are not bandwidth limited on a discrete real space grid . convergence to the exact result is observed as the grid spacing is reduced , as expected .    as our next comparison of the fft box and fd methods we used the same pseudo - orbitals as before , but considered the quantity @xmath63 as the measure of the error , where @xmath64 is the result obtained by fourier transforming the support functions using the periodicity of the entire simulation cell .",
    "one may think of @xmath64 as being the result that would be obtained from a plane - wave code : the support functions may be considered as generalised wannier functions . calculating the kinetic energy integrals by performing a discrete fourier transform on the support functions over the entire simulation cell ( an @xmath65 process for all support functions ) is equivalent to summing the contributions to the kinetic energy from all of the plane - waves up to the cut - off energy determined by the grid spacing .",
    "thus our fft box method can be viewed as equivalent to a plane - wave method that uses a contracted basis set ( i.e.  a coarse sampling in reciprocal space ) .",
    "in some ways @xmath66 is a better measure of the relative accuracy of the fd and fft box methods as our goal is to converge to the ` exact ' result as would be obtained using a plane - wave basis set over the entire simulation cell .",
    "@xmath66 is plotted in the bottom graph of figure [ errors ] .",
    "@xmath64 was computed using a cell that contained 256 grid points in each dimension .",
    "increasing the cell size further had no effect on @xmath64 up to the eleventh decimal place ( @xmath67 ) .",
    "the plots show that the fft box method performs significantly better than all orders of fd that were tested .",
    "for example at @xmath59 the error for is @xmath68 as compared to @xmath69 for the fft box method . the fact that the fft box error is so small shows that coarse sampling in reciprocal space",
    "has little effect on accuracy , as one would expect for functions localised in real space .",
    "our implementation can produce similar fft box results to the above in regular grids of arbitrary symmetry ( non - orthogonal lattice vectors ) as long as we include roughly the same number of grid points in the support region sphere . as we described earlier the application of the fd method to grids without orthorhombic symmetry is not straightforward .",
    "furthermore , in our implementation the kinetic energy matrix elements @xmath34 for both the fft box method and the fd method ( of any order ) are hermitian to machine precision .",
    "this is a direct consequence of @xmath7 , our representation of the laplacian operator @xmath70 on the grid , being hermitian .",
    "as mentioned earlier , this is an important point .",
    "the matrix elements @xmath4 may always be made hermitian by construction without @xmath7 itself being an hermitian operator .",
    "this would ensure real eigenvalues , as is required .",
    "however , when it comes to optimisation of the support functions during a total - energy calculation , we require the derivative of the kinetic energy with respect to the support function values @xcite : @xmath71 where the @xmath72 are grid points belonging to the support region of @xmath73 .",
    "these relations both hold only if @xmath7 is an hermitian operator , and support function optimisation can only be performed in a consistent manner if there is one unique representation of @xmath38 for each support function @xmath40 .",
    "it is also worth noting that the evaluation of these derivatives is the reason why we prefer to perform the sum of equation ( [ real_sum ] ) for the fft box method in real space , rather than in its equivalent form in reciprocal space .",
    "applying the fft box method in reciprocal space would be no more costly as far as integral evaluation is concerned but we would require an extra fft per support function for the subsequent evaluation of equation ( [ gradient ] ) .    for all the methods we describe in this paper we observe variation in the values of the kinetic energy integrals when we translate the system of the two support functions with respect to the real space grid .",
    "this is to be expected as the discrete representation of the support functions changes with the position of the support region with respect to the grid .",
    "such variations may have undesirable consequences when it comes to calculating the forces on the atoms .",
    "in fft terminology , they result from irregular aliasing of the high frequency components of our support functions as they are translated in real space .",
    "ideally , in order to avoid this effect , the reciprocal representation of the support functions should contain frequency components only up to the maximum frequency that corresponds to our grid spacing , in other words it should be strictly localised in reciprocal space .",
    "unfortunately this constraint is not simultaneously compatible with strict real space localisation .",
    "it should be possible however to achieve a compromise , thus controlling the translation error by making it smaller than some threshold .",
    "such a compromise should involve an increase in the support region radii of our functions by a small factor .",
    "this situation is similar to the calculation of the integrals of the nonlocal projectors of pseudopotentials in real space with the method of king - smith et al .",
    "@xcite which requires an increase of the core radii by a factor of 1.5 to 2 .",
    "for example , if we consider two carbon valence pseudo - orbitals of support radius @xmath74 and with @xmath75 and translate them both in a certain lattice vector direction over a full grid spacing , the maximum variation in the value of the integral with the fft box method is @xmath76 hartree . if we then do the same with carbon pseudo - orbitals generated with precisely the same parameters but instead with a support radius of @xmath77 , the maximum variation with respect to translation is reduced to @xmath78 hartree .",
    "in conclusion , we have presented a new and easy to implement method for calculating kinetic energy matrix elements of localised functions represented on a regular real space grid .",
    "this fft box method is based on a mixed real space  reciprocal space approach .",
    "we use well established fft algorithms to calculate the action of the laplacian operator on localised support functions , whilst maintaining linear - scaling with system size and near locality of the operation .",
    "this makes our fft box method suitable for implementation in the order - n code that we are developing .",
    "we have performed tests of the fft box method and various orders of fd . comparing to the exact integrals of the continuous representation , we have demonstrated that our approach is more accurate than low order fd approximations and only when fd is used does the accuracy become comparable to that of the fft box method .",
    "we have also highlighted the connection between the fft box method and plane - wave methods and shown that our approach is up to three orders of magnitude more accurate than fd when compared to the ` exact ' result within the plane - wave basis set of the entire simulation cell . furthermore , our approach for calculating the kinetic energy is consistent with the way in which other quantities in a total - energy calculation , such as the electron density and the hartree energy , are computed as these are also calculated using reciprocal space techniques .",
    "finally , we also note that our fft box method is more versatile than fd as it is applicable to real space grids based on any lattice symmetry whereas fd schemes are usually only applied to orthorhombic grids .",
    "s. would like to thank the epsrc ( grant number gr / m75525 ) for postdoctoral research funding .",
    "a. a. m. would like to thank the epsrc for a ph.d .",
    "p. d. h. would like to thank magdalene college , cambridge for a reseach fellowship . c. j. p. would like to thank the epsrc ( grant number gr / n18567 ) for a ropa ."
  ],
  "abstract_text": [
    "<S> we present a method for calculating the kinetic energy of localised functions represented on a regular real space grid . </S>",
    "<S> this method uses fast fourier transforms applied to restricted regions commensurate with the simulation cell and is applicable to grids of any symmetry . in the limit of large systems </S>",
    "<S> it scales linearly with system size . </S>",
    "<S> comparison with the finite difference approach shows that our method offers significant improvements in accuracy without loss of efficiency .     </S>",
    "<S> * published as computer physics communications ( 2001 ) 315 - 322 * </S>"
  ]
}