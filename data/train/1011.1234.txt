{
  "article_text": [
    "the problem of storage optimisation is driven by the necessity of the storage owners to optimise their expenses and maximise a potential profit which can be gained by operating the storage .",
    "there are plenty of real world storage examples : gas storage , oil storage , hydro power plant , coal stock , etc . by following some clever strategy  buying the underlying commodity cheep , storing it , and selling as the prices go up ",
    "the storage owner can make a profit .",
    "thus , there is a need for the exercise strategy optimisation  such an exercise rule , which allows to maximise the profit and minimise the risks .",
    "one of the most popular ways of the numerical storage optimisation is the `` dynamic programming '' algorithm .",
    "it allows to treat both ",
    "intrinsic ( when the prices are supposed to be frozen ) as well as stochastic ( when the prices are supposed to follow some stochastic process ) problems . usually the numerical solution provides the answers to the two most important questions : what is the optimal exercise decision now given the current state ( prices and volume level of the storage ) , and what is the expected profit , provided we follow the optimal exercise strategy .",
    "the next level of sophistication is to provide the hedge strategy  a portfolio of derivatives ( futures , options or any other financial instruments ) which would minimise the financial risks .",
    "of course , financial risk is only a feature of the stochastic problem , as the solution of the intrinsic problem is deterministic .    in this paper we to develop an analytical approach to the storage optimisation problem . in the sec .",
    "[ sec : deterministic_problem ] we consider an intrinsic problem which deals with predefined deterministic price curve .",
    "section  [ sec : other_constraint_types ] considers different special cases of constraints .",
    "[ sec : stochastic_problem ] is devoted to the stochastic problem , where we make use of perturbation theory to solve the stochastic problem , and derive an estimate of the stochastic time value .",
    "in the sections  [ sec : example_calculation_storage ] and  [ sec : swing_option ] we make an example calculation of the time value of a simple storage and swing options and compare the results with numerical evaluation .",
    "we discuss the results in sec  [ sec : discussion ] .",
    "the storage problem can be formulated as follows .",
    "the storage option holder is given a right to store some amount of underlying ( let it be for simplicity gas ) in a ( virtual ) storage facility .",
    "at every time moment the option holder may `` do nothing '' , inject or release the gas from the storage .",
    "every time the gas is injected into the storage it must be bought on the market .",
    "likewise every time the gas is released from the storage , it is sold on the market . since the market price of gas changes with time",
    ", this may lead to a non - trivial cash - flow .",
    "the injection and release process must satisfy some operational constraints ( for instance maximum injection / release rates , storage capacity , etc . ) , specified as boundary conditions .",
    "every exercise profile ( trajectory in the time - volume space ) yields a different profit . in this sense",
    "the profit becomes a functional on the exercise trajectory .",
    "the aim of the storage option holder is to maximise the profit by choosing an optimal injection / release strategy .",
    "the problem can thus be formulated in terms of variational analysis  an optimal trajectory is the one delivering maximum of the profit functional .",
    "if the market prices are known in advance and never change , such a problem is deterministic .",
    "the possible profit is bound from above and from below , and thus there exists a trajectory such that no other trajectory yields higher profit .",
    "the maximal profit of the static problem is called `` intrinsic value '' . in the current section",
    "we investigate the deterministic problem by means of variational analysis .",
    "let the storage time span be @xmath0 $ ] .",
    "let @xmath1 be the market price of gas by the time @xmath2 .",
    "the curve @xmath1 is called the forward price curve , since it is observed on the market prior the time @xmath3 and contains the information about the prices of gas with delivery in the future . by the definition of the static problem the forward curve never changes , and",
    "hence it does not depend on the observation time .",
    "let @xmath4 be the amount of gas in the storage by the time @xmath2 .",
    "the curve @xmath4 defines the exercise trajectory .",
    "the initial and terminal conditions are @xmath5    the cash flow ( per unit time ) resulting from trading the gas according to the exercise strategy @xmath4 is given by @xmath6 an additional cash flow results from taking into account the injection / release costs ( operating costs ) .",
    "let us designate @xmath7 the operating costs per unit time .",
    "the terminal profit is given by the cumulative cash flow .",
    "we thus introduce the target functional @xmath8 = -\\int_0^{t_e } \\big [ \\dot q(t)\\,f(t ) + \\gamma(\\dot q(t ) ) \\big]\\,dt\\,.\\end{aligned}\\ ] ] the value of this functional on the trajectory @xmath4 gives the storage value conditional on that trajectory .",
    "we have used here subscript @xmath9 to indicate the unmodified action integral . in the next section",
    "we will introduce a modified action integral @xmath10 $ ] , which includes additional terms intended to enforce the operational constraints . running ahead",
    "we notice that on any trajectory @xmath4 allowed by constraints the values of the modified and unmodified functionals coincide .    using `` physical '' terminology we introduce the ( unmodified ) lagrangian @xmath11 corresponding to the target functional @xmath12 as @xmath13",
    "as mentioned above , the target functional is bound from above and from below , and hence there must exist such trajectories on which the functional achieves its maximum and minimum on which the target functional is defined and could reach maximum should be rather broad . in particular it must include all continuous locally integrable functions .",
    "other functions under the functional integral are allowed to be discontinuous .",
    "we will also use the concept of convergence of functions , which we will always understand as a weak convergence , i.e. @xmath14 if @xmath15\\to s[\\psi]$ ] . ] .",
    "we make use of variational analysis to search the extremal trajectory , i.e. the trajectory on which the first variation of the target functional vanishes .",
    "once the extremal trajectory is found , one has to make sure that it delivers the maximum of the functional .",
    "it could be done by evaluating the second variation and checking its sign .",
    "the operational constraints may differ for different storage option types .",
    "below we consider some typical constraints , which can be classified as _",
    "local property implies that a constraint at time @xmath2 can be expressed in terms of state variables and their derivatives @xmath16 at time @xmath2 .",
    "we consider the following two operational constraints :    1 .",
    "the volume @xmath4 is allowed to be within the interval @xmath17\\ , ,      \\end{aligned}\\ ] ] where the boundaries @xmath18 are time dependent .",
    "the injection / release rate @xmath19 is bounded to @xmath20\\ , .",
    "\\end{aligned}\\ ] ] generally the maximal injection / release rates may depend on the time and volume : @xmath21 .",
    "below we only consider the constant injection / release rates .",
    "the special case of volume dependent rates will be considered in the sec .",
    "[ sec : volume_dependend_rates ] .",
    "one of the most common examples of _ nonlocal _ constraints is the so called _ cycle _ constraint .",
    "it can be formulated as follows .",
    "one introduces an _ intake _ cycle variable as @xmath22 which has a meaning of total injected volume by the time @xmath23 .",
    "the cycle constraint requires that the terminal value @xmath24 does not exceed certain threshold @xmath25 similarly one introduces a _ release _ cycle constraint .",
    "most of the scope of this paper is not dealing with non - local constraints .",
    "however we will return to the cycle constraint below in the section  [ sec : cycle_constraint ] .",
    "to restrict @xmath4 from going beyond the range @xmath26 $ ] , we can introduce a parametrised penalty function @xmath27 $ ] and add it to the unmodified lagrangian  ( [ eq : unperturbed_lagrangian ] ) @xmath28    the penalty function is any smooth function , which is in the limit @xmath29 approaches zero within the interval @xmath30 and positive infinity otherwise . a particular example of this function could be @xmath31^{2n_\\phi}\\ , , \\qquad \\text{with } \\quad      a = \\frac{2}{q_{max}-q_{min}}\\,,\\quad      b = \\frac{q_{max } + q_{min}}{2}\\,.\\ ] ]    a similar penalty function @xmath32 $ ] can be introduced to restrict  @xmath19 from going beyond the interval @xmath33 $ ] . in the limit @xmath34 it approaches zero within @xmath35 and plus infinity otherwise .",
    "the modified lagrangian becomes @xmath36\\,.\\end{aligned}\\ ] ] it corresponds to the following modified action integral : @xmath37\\,dt\\,.\\end{aligned}\\ ] ]      as we know from the variational analysis , the extremal trajectory of the integral @xmath38 satisfies the euler - lagrange equation @xmath39    thus , for the modified lagrangian we obtain the following equation @xmath40\\,,\\end{aligned}\\ ] ] which needs to be solved in the limit @xmath41 .",
    "there are two types of solution of the latter equation .",
    "one is obtained on the interval where the trajectory remains strictly within the boundaries @xmath42 the second solution type is , when the trajectory lies on the boundary @xmath43 the general solution consists of pieces of the solutions of the types one and two .",
    "let us consider each of these types separately .",
    "first we consider the solution in the interval , where the trajectory does not touch the boundary . in the limit",
    "@xmath44 the l.h.s . of eq .",
    "( [ eq : el ] ) vanishes .",
    "we thus have @xmath45 where @xmath46 is _ constant _ for the whole period of time , where the solution does not touch the boundary .",
    "let us consider one particular example of the operating cost function .",
    "it is rather typical for a gas storage facility that the operating cost is proportional to the amount of the gas released or injected into the storage .",
    "again we parametrise it with @xmath47 so that for finite @xmath47 the function @xmath48 is smooth , and in the limit @xmath49 it is piecewise linear @xmath50 where @xmath51 and @xmath52 .    the solution of eq .",
    "( [ eq : within_boundaries ] ) is now straightforward to find graphically ( see fig .",
    "[ fig:1 ] ) . in case",
    "@xmath53 we obtain : @xmath54 we see that the value @xmath46 can be interpreted as a trigger price . if the price @xmath1 is within the interval @xmath55 $ ] , the extremal trajectory is constant : @xmath56 .",
    "if the price is below this interval , the volume @xmath4 is increasing at maximal rate : @xmath57",
    ". if the price is above the interval , the volume is decreasing at maximum rate : @xmath58 .",
    "we consider only a boundary @xmath59 and @xmath60 , that moves slower than the limit rate , i.e. @xmath61 and @xmath62 .",
    "if the boundary moves faster , then no trajectory can lie on it .    on the boundary the function @xmath63 vanishes , and",
    "the function @xmath64 takes a finite value ( positive if @xmath65 or negative if @xmath66 ) .",
    "( [ eq : el ] ) on the boundary becomes @xmath67\\,;\\end{aligned}\\ ] ]    there is another view on the solution on the boundary .",
    "we may consider our problem as a general variational problem with spacial boundary condition .",
    "a path lying on the boundary can not be varied and hence be a part of extremal . but a solution , that maximises the functional , can consist of parts lying on the boundary and _ extremals _  pieces of trajectory satisfying the extremal condition ( i.e. , vanishing first variation ) .",
    "an important statement can be made about the connection point between extremal and the boundary . from the variational analysis",
    "it is known that an extremal touches the boundary smoothly .",
    "the extremal solution of our variational problem for large but finite @xmath68 is a smooth function and must satisfy the condition of smooth connection between extremal and boundary .",
    "let us consider a simplified problem ( a generalisation is straightforward ) , where we suppose a constant boundary condition , and zero operating cost : @xmath69 in this case the extremal trajectory should touch the boundary at zero slope : @xmath70 where @xmath71 is the connection time . from eq .",
    "( [ eq : solution ] ) in the limit @xmath72 and @xmath73 we conclude that @xmath74 taking the operating cost again into consideration leads to the following cases :    1 .",
    "the trajectory touches the lower boundary from the left : @xmath75 2 .",
    "the trajectory touches the upper boundary from the left : @xmath76 3 .",
    "the trajectory touches the lower boundary from the right : @xmath77 4 .",
    "the trajectory touches the upper boundary from the right : @xmath78    these conditions must be satisfied for the time interval @xmath79 .",
    "the extremal trajectory on the times @xmath3 and @xmath80 does not have to satisfy these conditions .    the conditions ( [ eq : bc1]-[eq : bc4 ] ) can be derived from a rule of thumb : if at the moment @xmath71 of boundary touch the boundary was virtually not there , the trajectory had to switch the mode anyway ( like from `` full release '' to `` do nothing '' in case  ( [ eq : bc1 ] ) , et.c . ) .",
    "the requirement to the price curve derivative follows from the simple observation : when the trajectory approaches the boundary , the forward curve should enter the dead zone , and when the trajectory leaves the boundary , the forward curve should exit the dead zone .    in the limit @xmath81",
    "the solution may be non smooth any more .",
    "in particular the connection point @xmath82 will be a point of the slope discontinuity .",
    "it is worth emphasising that the constant @xmath46 may be different for different extremal pieces of trajectory separated by the boundary touch .",
    "( [ eq : solution ] ) together with boundary conditions ( [ eq : bc1]-[eq : bc4 ] ) and condition on the start and end volume @xmath83 provides an implicit solution for the problem .",
    "we summarise some properties of the solution :    1 .   the optimal exercise strategy is always bang - bang .",
    "if expressed in `` industrial '' language , the compressor either stands or works with a full power .",
    "2 .   for each piece of trajectory , separated from others with a boundary touch",
    ", there is a trigger price @xmath46 and a `` dead zone '' @xmath55 $ ] .",
    "the volume in the storage is increasing at maximum rate if the price is below the zone , decreasing at maximum rate if the price is above the zone , and is constant if the price is in the zone .",
    "the width of the zone is defined by the operating costs .",
    "3 .   if the trajectory touches the boundary in the time interval @xmath79 , it must satisfy one of the boundary conditions  ( [ eq : bc1]-[eq : bc4 ] ) .",
    "generally a trajectory satisfying all the previous conditions is not unique .",
    "any solution must obey all these conditions , but not any function obeying all conditions is a solution .",
    "the solution found in the previous section maximises the modified target functional @xmath10 $ ] .",
    "let @xmath84 be the obtained solution .",
    "now the optimal path @xmath84 can be substituted to the unmodified functional @xmath85 $ ] to give the value of option .",
    "a natural question is whether the trajectory @xmath84 , which is optimal for modified functional , is still optimal for the unmodified one .",
    "the optimal trajectory @xmath86 belongs to the broad class of all locally integrable functions @xmath87 .",
    "let us introduce a class of trajectories @xmath88 satisfying all the constraints . by definition penalty functions vanish on @xmath89 : @xmath90 obviously the values of modified and unmodified functionals coincide on @xmath89 : @xmath91 = s_0[q]\\,,\\quad \\forall q\\in\\mathcal{k}\\,.\\ ] ]    next we show that the optimal trajectory @xmath86 belongs to the class @xmath89 and hence satisfies the constraints . indeed , generally on some parts of the maximal trajectory @xmath92 and @xmath93 .",
    "according to eqs.([eq : within_boundaries ] ) and ( [ eq : on_the_boundary ] ) they take finite values",
    ". one can show ( we leave it without proof ) that in the limit @xmath94 everywhere where @xmath95 ( or @xmath96 ) take finite value , the function @xmath97 ( or @xmath98 ) vanishes .",
    "we conclude that on the extremal trajectory @xmath99 and hence @xmath100 .",
    "form this it follows that the values of modified and unmodified target functionals coincide on the maximal trajectory : @xmath101 = s_0[\\bar q]\\,.\\ ] ]    last step is to prove that the trajectory @xmath86 delivers the maximum of the unmodified functional .",
    "it is obvious from the following consideration . the trajectory @xmath86 maximises the modified functional on the space @xmath87 and hence it will also maximise this functional on the smaller space  @xmath88 . since the values of both functionals coincide on  @xmath89 , the trajectory @xmath86 will also maximise the unmodified functional @xmath12 on the space of all trajectories satisfying constraints .",
    "from this point we drop the subscript `` 0 '' for the action integral , unless we want to emphasise the difference between modified and unmodified target functions .",
    "we also drop the `` bar '' for the optimal trajectory @xmath84 everywhere where it does not lead to ambiguity .",
    "some storage contracts may include a `` carry cost '' , which is the cost of keeping the commodity in the storage .",
    "for instance an oil storage is subject to a heating cost ( a fuel oil in a storage has to be kept warm at approximately @xmath102 ) .",
    "the carry cost is specified as a time - dependent price @xmath103 per unit time per unit volume .",
    "thus , the target function becomes @xmath104\\,dt\\end{aligned}\\ ] ] substituting the new lagrangian into the lagrange - euler equation we obtain between boundaries : @xmath105 where @xmath106 thus , the solution of the problem with the carry cost is absolutely the same as that without but the only difference : the trigger price is not a constant , rather a function of time satisfying eq .",
    "( [ eq : trigger_price_carry_cost ] ) .      sometimes the storage problem can be defined with a free terminal condition .",
    "for instance , one is allowed to leave an arbitrary amount of underlying in the storage , and for the remaining volume one gets a additional pay - off equivalent to selling that volume at some effective price @xmath107 , usually referred to as a _",
    "final unit price_. we define the target functional @xmath108 as @xmath109 = -\\int_0^{t_e } [ \\dot q(t)\\,f(t ) + \\gamma(\\dot q)]\\,dt + q_{end}\\,f_e\\,.\\end{aligned}\\ ] ] the optimisation problem is now to find an optimal exercise trajectory @xmath110 , satisfying operational constraints , that would maximise the target functions  ( [ eq:2.18 ] ) .",
    "it is easy to see that any extremal trajectory of  ( [ eq:2.18 ] ) is also extremal of  ( [ eq : unperturbed_action ] ) . indeed , if the trajectory  @xmath84 is extremal of  ( [ eq:2.18 ] ) , the variation of the target functional vanishes on any small variation @xmath111 .",
    "since there is no terminal boundary condition , the variation @xmath111 may not vanish at the end point .",
    "but if the target function does not change on the whole class of allowed trajectories @xmath112 , it also does not change on the sub - class of trajectories @xmath113 with fixed terminal value ( @xmath114 ) .",
    "we conclude that to find a maximising trajectory for the functional  ( [ eq:2.18 ] ) , we need first to find a solution for the functional  ( [ eq : unperturbed_action ] ) with fixed terminal conditions .",
    "then , considering this solution as a function of terminal state  @xmath115 , we need to find a maximum of  ( [ eq:2.18 ] ) as a plain function of  @xmath115 .    as will be shown in the sec .",
    "[ sec:3 ] , if the target functional  ( [ eq : unperturbed_action ] ) is considered as a function of the terminal state  @xmath115 , then its derivative with respect to @xmath115 is @xmath116 thus , the target functional  ( [ eq:2.18 ] ) , considered as a function of @xmath115 , has a derivative @xmath117 where @xmath46 is the trigger price of the last part of trajectory .",
    "we conclude that the condition for a target functional with free terminal state to have maximum is @xmath118    in practice the storage option with free terminal state has two possibilities .",
    "one possibility is that the terminal state lies on the boundary @xmath119 or @xmath120 . in this case",
    "the problem has a solution with fixed end .",
    "another possibility is that the trajectory ends between boundaries @xmath121 . in this case",
    "the condition  ( [ eq:4.22 ] ) must be fulfilled .",
    "if the storage option has no final unit price ( price for the remaining volume ) , it is most likely to terminate with the lowest possible volume . indeed , as we already know , the derivative of the storage option value with respect to the terminal state equals @xmath122 . if we neglect the operating costs , the trigger price can not be smaller than the smallest gas price .",
    "hence , if the gas price is positive , then the derivative of the option value with respect to the terminal level is negative , and thus the optimal trajectory must terminate at the lowest possible level . consequently the storage option can be considered as a problem with fixed terminal state ( although it may not be fixed according to the contract ) .",
    "an opposite example is a swing option .",
    "a typical swing option is a contract between a gas supplier and a trading company .",
    "the trader buys gas at some predefined price from the supplier and sells it on the market at the current market price .",
    "the spread between the market and supplier price becomes the effective gas price for the trader .",
    "the swing option allows the trader to take the gas from the supplier according to some flexible scheme ( i.e. to decide , when to take and how much within certain constraints ) .",
    "thus , the swing option can be formulated in terms of a storage option .",
    "however unlike the storage option , the effective price ( the spread ) in the case of swing option can be both positive and negative .",
    "depending on the actual prices and on the contract constraints , it may happen that the terminal state does not lie on either lower or upper boundaries . in this case",
    "we deal with the problem with the free terminal condition . for this problem",
    "the trigger level equals zero @xmath123 since there is no equivalent for the final unit price in the swing contract .",
    "the cycle constraint  ( [ eq : cycle_constrain ] ) is formulated as a maximum allowed injected volume during the operation period @xmath124 $ ] .",
    "instead of considering it in the form of inequality we can proceed as follows .",
    "we find a solution in two steps . on the first step we solve the problem without the cycle constraint and calculate the cycle variable on the optimal trajectory .",
    "if the cycle variable is below the threshold @xmath125 , the obtained solution satisfies the cycle constraint .",
    "however if the solution violates the cycle constraint , we can reformulate the problem , imposing the `` biting '' cycle constraint @xmath126 this condition allows to formulate our problem in terms of conditional variational extremum .",
    "it is solved by means of lagrange multiplier .",
    "namely we introduce a modified lagrangian @xmath127\\,,\\end{aligned}\\ ] ] where @xmath128 is an independent variable ( lagrange multiplier ) .",
    "the solution of the latter problem will contain the undefined coefficient @xmath128 , which has to be found from the additional equation  ( [ eq : cycle_constrain_eq ] ) .    within the boundaries",
    "the lagrange - euler equation for the constrained lagrangian becomes ( compare to eq .",
    "( [ eq : within_boundaries ] ) ) @xmath129 solving this equation we find that the solution is similar to that without cycle constraint , but has the `` dead zone '' by @xmath128 wider .",
    "thus , the cycle constraint is equivalent to some additional operating costs .",
    "one can find a fictive additional release and/or injection costs ( same for the whole trajectory ) , such that if added to the storage without cycle constraint , the resulting trajectory would be extremal for the lagrangian with imposed cycle constraint .",
    "it plays no role if the additional cost is for injection , release or both , since it is only the width of the dead zone which matters .",
    "the only exception from this rule is if the optimal trajectory does not inject or release enough volume .",
    "for instance if the trajectory never releases gas , the additional release cost will not effect the trajectory and will not help to respect the intake cycle constraint . practically one should add injection costs to fulfil the intake cycle constraint , and release costs to fulfil the release cycle constraint .",
    "generally the solution between boundary touches contains two free parameters  trigger price @xmath46 and cycle lagrange multiplier @xmath128 .",
    "they can be equivalently expressed by upper and lower bounds of the dead zone .",
    "these parameters have to be found in such a way that the obtained solution satisfies boundary touch conditions  ( [ eq : bc1]-[eq : bc4 ] ) , initial and terminal conditions  ( [ eq : init_term_cond ] ) and the cycle constraint  ( [ eq : cycle_constrain_eq ] ) .",
    "if the maximal injection / release rates are volume dependent , the penalty function @xmath98 becomes an explicit function of volume : @xmath130 . in this case",
    "the euler - lagrange equation within the boundaries becomes @xmath131\\,.\\end{aligned}\\ ] ] the l.h.s .",
    "of this equation is an integrable implicit function of time . designating @xmath132 we obtain the same solution as in the case of volume independent rates with the difference that @xmath46 is not constant any longer , rather a function of time .",
    "we conclude that the optimal exercise strategy still preserves the `` bang - bang '' property . however is does not posses the constant trigger level .",
    "the function @xmath133 can be reverse engineered from the optimal trajectory @xmath4 , provided the latter is been found .",
    "let @xmath4 be the optimal trajectory .",
    "on this trajectory the derivative @xmath134 takes a finite value , which can be found from the equation @xmath135 we can also find the relation between the derivatives @xmath136 and @xmath134 . indeed ,",
    "if the trajectory @xmath4 lies for instance on the maximum injection rate boundary @xmath137 , then the relation between @xmath138 and @xmath139 is simply @xmath140 .",
    "it s easy to show that the gradient @xmath141 must be orthogonal to the vector @xmath142 .",
    "hence @xmath143 we thus obtain the differential equation @xmath144 here @xmath145 must be used for `` injection '' and @xmath146 for `` release '' parts of the trajectory .",
    "this equation allows to find the function @xmath133 provided the optimal trajectory @xmath4 is already known .",
    "the optimal path @xmath4 and the target functional @xmath10 $ ] are calculated for fixed terminal point @xmath147 .",
    "if this point is slightly shifted in either direction  time or volume  the optimal path becomes different , and the target function as well . in this sense",
    "the target function can be viewed as a function of terminal point @xmath148 . in this section",
    "we are interested in the properties of this function .    from the standard variational analysis",
    "we have : @xmath149 we apply these equations to the perturbed action @xmath10 $ ] . making use of eq .",
    "( [ eq : zero ] ) we will find the derivatives of the unperturbed action @xmath150 $ ] .",
    "using the definition ( [ eq : perturbed_lagrangian ] ) of the perturbed lagrangian we find @xmath151\\,.\\ ] ] the spacial derivative makes sense only within the boundaries . making use of eq .",
    "( [ eq : within_boundaries ] ) and replacing @xmath152 with @xmath12 we finally find @xmath153 where @xmath46 is the trigger level of the last part of the trajectory .",
    "if @xmath46 is positive , one can draw a conclusion , that the smaller the terminal state @xmath154 , the bigger is the target functional @xmath155 .",
    "derivative with respect to the initial condition @xmath156 is given by inverting the sign : @xmath157 where @xmath46 is the trigger level of the initial part of the trajectory .    from this",
    "an important consequence follows , which we already mentioned in the section  [ sec : free_vs_fixed_terminal_condition ] . if there is no final unit price and if the prices @xmath1 are strictly positive , so is the trigger price  @xmath46 . as a result",
    "the option value has a negative derivative with respect to the terminal level .",
    "hence the optimal trajectory will always take at the end the smallest possible value allowed by constraints . by other words , we know that the right end of the optimal trajectory will lie on the lower boundary .",
    "thus , even if the contract allows the storage to end with some remaining volume inside ( free terminal condition ) , the optimisation problem still can be considered as the one with fixed terminal condition .",
    "this is not any longer the case in presence a positive final unit price is given or if the prices @xmath1 can be negative . with the final unit price @xmath107 the option value derivative",
    "is given by eq .",
    "( [ eq:4.21 ] ) and can be positive , negative or zero . also extremely high injection / release costs may lead to vanishing trigger price and the option value derivative .      from definition",
    "we find @xmath158 -          \\phi(q ) - \\psi(\\dot q ) - \\gamma(\\dot q ) = \\nonumber \\\\      & = \\dot q\\big[\\psi'(\\dot q ) + \\gamma'(\\dot q)\\big ] - \\gamma(\\dot q)\\,.\\end{aligned}\\ ] ] * within the boundaries * we make use of eq .",
    "( [ eq : within_boundaries ] ) . replacing @xmath152 with",
    "@xmath12 one obtains @xmath159 - \\gamma(\\dot q)\\,,\\end{aligned}\\ ] ] where @xmath160 is the solution ( [ eq : solution ] ) obtained for fixed terminal condition .",
    "in particular one can see that @xmath161 ( provided @xmath53 ) .",
    "* on the boundary * in the special case @xmath162 one obtains @xmath163 and @xmath164 it is worth noting that the derivatives with respect to terminal ( initial ) boundary conditions is universal : it is independent on whether the optimal trajectory touches the boundary or not . to calculate the derivatives ,",
    "one just needs to know the solution @xmath4 and the trigger price @xmath46 at the end ( beginning ) of the trajectory .",
    "this also remains valid with imposed cycle constraint .",
    "the following section is devoted to the stochastic optimisation problem . as a starting point of the stochastic approach",
    "we take the solution of the corresponding intrinsic problem , which is supposed to be known . under some very generic assumptions about the price process",
    "we derive a stochastic differential equation which governs the evolution of the storage value in the rolling intrinsic approximation .",
    "this allows us to find the expectation value of the terminal option value , and hence to estimate the time value of the storage option .    in real world",
    "the prices are not static , rather evolve with time in a stochastic way .",
    "every time we observe a new forward curve on the market , we can solve a new intrinsic problem , obtaining a new solution .",
    "the forward price @xmath165 , as well as the optimal intrinsic strategy @xmath166 and trigger price @xmath46 become not only functions of `` delivery '' ( or `` maturity '' ) time @xmath23 , but also functions of the `` current '' ( or `` observation '' ) time  @xmath2 : @xmath167 by other words , @xmath168 is the forward price with delivery time @xmath23 observed on the market at time  @xmath2 . @xmath133 and @xmath169 are trigger price and optimal intrinsic strategy , calculated at time @xmath2 according to current observed forward price curve @xmath168 . throughout the following section we designate @xmath170 the optimal intrinsic exercise strategy on the observation time @xmath2 .    by definition of the stochastic problem , the initial forward curve @xmath171 is known . for any future observation time @xmath172",
    "there is no deterministic forward curve .",
    "the evolution of the forward curve is supposed to satisfy some stochastic differential equation .",
    "it means that any possible curve @xmath168 can be assigned a certain probability amplitude , and the solution of the problem has to be formulated in the probabilistic language .",
    "[ [ assumptions ] ] assumptions : + + + + + + + + + + + +    to make further analysis we make some simplifying assumptions .",
    "* first we neglect the injection / release costs by setting @xmath173 .",
    "* we also neglect the `` surface effects ''  the possible influence of the boundary touch on the optimal trajectory and on the storage option value . under the specified assumptions for every observation time @xmath2",
    "there exists a single trigger price @xmath133 for the whole trajectory , and the optimal intrinsic strategy can be presented in the form @xmath174 where @xmath175 , @xmath176 is the heaviside function and @xmath133 is the intrinsic trigger price at time @xmath2 .",
    "we also introduce the following notation : @xmath177 here @xmath178 is the dirac delta function .",
    "the derivative is taken with respect to the argument of the @xmath179-function .",
    "notice the dimensionality : @xmath180\\ , ; \\qquad      r^{(1 ) } = \\left[\\frac{q}{t\\,\\$}\\right]\\ , ; \\qquad      r^{(2 ) } = \\left[\\frac{q}{t\\,\\$^2}\\right]\\,.\\end{aligned}\\ ] ] + by neglecting the `` surface effects '' we restrict our consideration to the so called non - flexible storages .",
    "the storage flexibility can be characterised by a number of times @xmath181 the storage can be filled and emptied completely during the storage life time ( maximum number of cycles ) . the storage is usually called non - flexible if @xmath182 . for @xmath183",
    "the storage is referred to as flexible .",
    "obviously , the surface effects have much bigger impact on the flexible storages .",
    "* as an additional assumption we believe that the prices @xmath168 are always strictly positive .",
    "this allows us to consider the optimisation problem as a problem with fixed initial and terminal conditions ( see sec .",
    "[ sec : spacial_derivative ] ) .",
    "this condition is applicable for the storage option and is not for the swing option .",
    "the swing option will be considered separately in the section  [ sec : swing_option ] .      for the intrinsic problem",
    "one could determine an optimal exercise strategy @xmath184 which has a meaning of amount ( per unit time ) of underlying which has to be injected / released from the storage and bought / sold on the market at the time  @xmath23 .",
    "it makes no difference if this amount is sold on the spot ( i.e. exactly on the time  @xmath23 ) or on the forward market prior the delivery time @xmath23 , since the price of the underlying does not change .",
    "this is not the case in the stochastic reality . since the price for the delivery on time @xmath23 changes with the observation time @xmath2 , it is essential to specify when exactly the underlying is traded .",
    "we thus distinguish between spot trades and forward trades .",
    "a spot trade is associated with immediate delivery , and the corresponding price is referred to as `` spot price '' @xmath185 .",
    "a forward trade has a delivery in the future , and generally can be any kind of financial products , including forward contracts or options .",
    "the forward trades usually have a purpose of financial hedging , so we will refer to them as _",
    "hedge trades_. for simplicity we only consider linear hedge products , i.e. forward contracts .",
    "thus for the stochastic problem at every time @xmath2 we can introduce a trade profile @xmath186 , which has the following meaning :    * the up - front value @xmath187 is the exercise trade .",
    "the amount of underlying @xmath188 has to be injected in the storage within the time @xmath189 , and the corresponding amount has to be purchased on the market .",
    "the purchased amount is a net amount purchased on the forward and spot markets for the delivery on @xmath190 .",
    "we will refer to the exercise trade @xmath187 as _",
    "prompt exercise_. * the volume @xmath186 for @xmath191 is a hedge position .",
    "the value @xmath192 has a meaning of the total volume purchased on the forward market ( i.e. aggregated volume of all forward trades performed during the time period @xmath193 $ ] ) for the delivery period @xmath194 $ ] .    for the stochastic optimisation problem there exists no optimal exercise trajectory , which could be computed prior or during the contract time .",
    "hence it is not possible do define a target functional in the form of integral  ( [ eq : unperturbed_action ] ) .",
    "instead we have to formulate the aim of the stochastic optimisation problem as finding an optimal trading strategy @xmath186 , such that the expectation value of the total profit is maximised .",
    "the trading profile can be used for exercise and hedge trades on the future market , giving rise to the cash flow at the observation time .",
    "thus we agree that if the volume @xmath195 is purchased on the observation time @xmath2 with delivery on @xmath23 , then the corresponding cash - flow @xmath196 is associated with the observation time @xmath2 . ] .",
    "since the hedge profile is different for every time moment  @xmath2 , one has to update the hedge position continuously by buying and selling a proper amount of the underlying on the future and spot markets .",
    "let @xmath186 be the hedge position taken by the time  @xmath2 .",
    "this also includes the exercise volume @xmath188 , which has to be delivered during the time  @xmath189 .",
    "after the infinitesimal time increment @xmath189 we observe the new prices on the market , and find a new optimal hedge strategy @xmath197 .",
    "the volume @xmath198 has to be purchased on the market in order to update the hedge position .",
    "this volume includes the spot trade @xmath199 and hedge trades @xmath200 for @xmath191 . of the whole hedge profile @xmath186 the only initial value @xmath201 is associated with the `` physical '' delivery of the underlying , and the rest is covered by the forward contracts .",
    "our aim now is to find for every observation time @xmath2 an optimal hedge profile @xmath186 conditional on the market state @xmath168 and current initial condition @xmath4 . in order to give a precise mathematical definition of the stochastic optimisation problem we need to define the stochastic profit function .",
    "let @xmath202 be the initial hedge profile , calculated on the basis of the initial conditions @xmath171 and @xmath203 .",
    "the integral @xmath204 gives the total cost of setting up the initial hedge profile .",
    "let @xmath186 be the hedge profile at time @xmath2 .",
    "we introduce the profit function @xmath205 , which is defined as a cumulative cash flow from all hedge trades .",
    "the profit function satisfies the following equations : @xmath206 where @xmath207 and @xmath208 are the increments of the optimal hedge strategy and forward curve within a time - interval  @xmath189 .",
    "the stochastic optimisation problem can now be formulated as finding at every time @xmath2 an optimal hedge profile @xmath186 such that the expectation value of the terminal profit @xmath209 is maximised .",
    "the defined profit function does not represent the total portfolio value , since it only reflects the cash - flow and does not take into account the value of the storage option itself .",
    "however this is the only part of the portfolio , which can be influenced by our trading strategy , and hence optimisation of the profit function is equivalent to the optimisation of the profit and loss .",
    "note that the hedge profile @xmath186 for @xmath191 does not need to satisfy the storage constraints , since it is not associated with the physical delivery .",
    "the only physical part of the hedge profile is the prompt exercise trade @xmath187 which has to obey the storage constraints .",
    "notice that the integral ( [ eq:4.2 ] ) coincides with the target functional  ( [ eq : unperturbed_action ] ) ( we have neglected the operating costs ) . as an example of a ( non - optimal ) trading strategy we can do the following .",
    "let the initial hedge profile coincides with the initial intrinsic strategy @xmath210 in this case the initial value of the profit function coincides with the intrinsic value @xmath211 .",
    "if we decided not to change the hedge profile with the time @xmath212 then the profit function would remain constant , giving rise to the terminal profit equal to the initial intrinsic value .",
    "thus the stochastic profit is at least as big as the intrinsic value .",
    "in reality for every time @xmath2 one can almost always find a new hedge profile @xmath186 such that the profit function increment @xmath213 is positive .",
    "the increase of the terminal profit function in comparison with the intrinsic value is referred to as _ time value_.    running ahead it is also interesting to notice that only the prompt exercise decision @xmath187 is relevant for the expectation value of the profit .",
    "the rest of the hedge profile @xmath186 for @xmath191 only effects the distribution of the terminal profit as a stochastic value .",
    "if our model of the stochastic price process was exact , and if we neglected the market frictions , then it would be theoretically possible to find such a hedge profile , which would make the distribution of the terminal profit function arbitrarily narrow .",
    "the optimal intrinsic solution at time @xmath2 is a function @xmath214 , which maximises the deterministic functional @xmath215 given the initial condition @xmath4 and the market state @xmath168 at the time @xmath2 , and subject to the storage constraints .",
    "if at every time moment @xmath2 the hedge strategy @xmath186 coincides with the current optimal intrinsic exercise @xmath216 then the strategy is called _ rolling intrinsic_.    in the sec .",
    "[ sec:4.6.4 ] we show that under very general assumptions the rolling intrinsic is very good approximation of the optimal stochastic exercise strategy .",
    "based on this fact and taking into account that the hedge strategy does not effect the expected value of the profit function , one can conclude that if we follow the rolling intrinsic strategy , the expected value of the terminal profit must be equal the true option value .",
    "this also allows one to calculate the time value as an average cumulative cash flow from all hedge and exercise trades . in app .",
    "[ ap : a2 ] we give a systematic proof of this fact .",
    "let @xmath168 for each time @xmath23 be a zero mean stochastic process governed by the stochastic differential equation in ito representation @xmath217 where @xmath218 is a martingale process with respect to the variable @xmath2 parametrised by the variable  @xmath23 .",
    "in general for each future time @xmath23 the martingale processes @xmath218 are different processes , which might or might not be correlated .",
    "the correlation between processes @xmath219 is given by @xmath220 where the function @xmath221 is supposed to be a decaying function of @xmath222 , @xmath223 , and @xmath224 . in the stochastic calculus",
    "the product @xmath225 can be considered as deterministic and requires no averaging .",
    "let us designate @xmath226 notice that @xmath227 is a stochastic variable , since it depends explicitly on the stochastic prices @xmath165 .",
    "we define the price process _ correlation function _ as @xmath228 where @xmath229 is an averaging over the stochastic prices  @xmath165 .    as a particular example we consider the following process @xmath230 where @xmath231 is a standard brownian motion . the price process has the following correlation function @xmath232 note that the case @xmath233 corresponds to the standard one - factor forward curve model . in this case",
    "the whole curve is driven by a single wiener process @xmath231 .    to find the correlation",
    "@xmath234 we need to integrate the price process  ( [ eq : generic_price_process ] ) . for one - factor model",
    "we obtain @xmath235\\ , ; \\quad \\tau_1 = t_1-t\\,;\\quad \\tau_2 = t_2-t\\ , .",
    "\\nonumber\\end{aligned}\\ ] ] note also that after a relaxation time @xmath236 the normalised correlation function @xmath237 becomes stationary , i.e. depending only on the time differences @xmath238 and @xmath239 .",
    "it can be easily shown that for small volatility @xmath240 the function @xmath241 , and thus for one - factor model we get @xmath242      we apply a variational analysis technique to find the increments of the hedge position @xmath243 in the rolling intrinsic approximation , and to derive a stochastic differential equation for the storage option value evolution based on eqs .",
    "( [ eq:5.5 ] ) and  ( [ eq:5.6 ] ) .    when finding the functional derivatives , it is important to distinguish between the two following cases .",
    "let @xmath244 $ ] be a functional defined on the functions @xmath245 and @xmath246 . if they are considered as independent variables , the corresponding functional derivatives @xmath247 are analogous to the partial derivatives of an ordinary function of two variables .    on the other hand , if the variables @xmath248 and @xmath249 are dependent , then the variation @xmath250 is analogous to a total derivative of an ordinary function .",
    "let us consider a functional @xmath251 defined on the variables @xmath252 .",
    "if we consider a time evolution of the forward curve @xmath168 , then all three increments @xmath253 and @xmath254 become dependent .",
    "the relation between these increments follows from the requirement that the terminal level must be preserved : @xmath255 the equation @xmath256 for every time @xmath2 defines a surface in the space of @xmath168 and @xmath133 , which restricts the possible simultaneous variations of the trigger price and forward curve .",
    "we say that the equation @xmath256 defines a _",
    "constraint surface_. if we find a variation @xmath257 which takes into account the relation between @xmath258 , @xmath259 and @xmath260 , we refer to this variation as a _ variation on the constraint surface_.    since the time - dependent increment of the forward curve @xmath208 is driven by a wiener - type stochastic equation of motion , we will treat this increment in a stochastic sense .",
    "in the framework of the stochastic calculus the square increment @xmath261 can not be neglected if compared with the first order variation , since @xmath262 hence the time - dependent variational derivatives must contain the second order terms alongside with the first order terms .    the details of derivation can be found in the appendix  [ ap : contraint_surface ] .",
    "after some algebra we finally obtain @xmath263 where we have used the notation @xmath264 in particular with this notation we can write @xmath265 ^ 2 =        \\iint r^{(1)}(u)\\,r^{(1)}(v)\\ , \\delta f(u ) \\ , \\delta f(v ) \\,du\\,dv =        \\iint r^{(1)}_u\\,r^{(1)}_v\\,l_{uv}\\,.\\end{aligned}\\ ] ] eq .",
    "( [ eq : dc_2_order ] ) defines the constraint surface .",
    "it relates the increments @xmath253 and @xmath254 . note that according to the forward curve evolution model @xmath266 .",
    "the first order variation of the trigger price on the constraint surface is then given by @xmath267      in the deterministic formulation of the storage problem , for each predefined forward curve @xmath168 we can find an optimal exercise trajectory @xmath268 .",
    "the value of the target function @xmath152 on the optimal trajectory at time @xmath3 is called `` intrinsic value '' .",
    "if the prices are stochastic , there exist no optimal exercise trajectory , and the solution of the stochastic problem can only provide an optimal prompt exercise @xmath269 at every time @xmath2 .    in this section",
    "we show that the optimal stochastic exercise is bang - bang , and that for every time moment @xmath2 there exist a stochastic trigger price @xmath270 .",
    "we also show that the intrinsic trigger price is a good approximation for the stochastic one , and derive the conditions for this approximation .",
    "let @xmath168 be the forward curve observed on the time @xmath2 .",
    "we define a _ spot price _ process @xmath271 as @xmath272 since the forward price curve evolves with time , the spot price @xmath273 generally does not follow the original forward curve ( @xmath274 almost everywhere ) .",
    "the spot process @xmath271 is uniquely defined by the forward price process , and thus to each possible spot price curve @xmath271 one can assign an amplitude or , in case of discrete price and time space , a probability @xmath275 .",
    "let us consider now a set of all possible spot price curves @xmath276 each having corresponding probability @xmath277 .",
    "considering the spot price curve @xmath276 as a deterministic function , we can solve a static optimisation problem for the target functional @xmath278 thus , for every spot price curve @xmath276 we can find a corresponding trigger price @xmath279 , exercise strategy @xmath280 and intrinsic value @xmath281 . on each spot price path",
    "the trigger price is different , and the exercise strategy @xmath280 is optimal only for that path .",
    "now we are looking for an optimal prompt exercise decision @xmath282 for the stochastic problem .",
    "since we can only make one exercise decision at a time , this exercise decision will not be optimal for some spot price paths .",
    "if on the @xmath283th spot price path the optimal exercise is @xmath284 , the suboptimal exercise decision will lead to a loss of value on that path .",
    "we need to make such a choice of @xmath285 that would minimise the losses on each path , for which the decision is not optimal .    during the time interval",
    "@xmath189 the volume increment in the storage is given by @xmath286 .",
    "thus , on the @xmath283th spot price path the volume in the storage is by @xmath287 bigger than it had to be , if the exercise was optimal for that path .",
    "it leads to the change of the value on the @xmath283th path by @xmath288 indeed , the change of the value has two reasons ",
    "additional expenses @xmath289 of buying an additional volume , and increased value @xmath290 due to change in the actual storage volume .",
    "the price of additional volume is @xmath291 the change of the value due to change of initial volume follows from the formula @xmath292 ( see sec .",
    "[ sec:3 ] ) : @xmath293 combining the latter two equations we obtain eq .",
    "( [ eq:4.13 ] ) .",
    "now we average @xmath294 over all paths : @xmath295 where @xmath277 is the probability of the @xmath283th path .",
    "the optimal exercise decision @xmath282 should maximise the expected change of option value @xmath296 .",
    "deriving @xmath296 with respect to @xmath282 we obtain @xmath297 where @xmath298 is the trigger price averaged over all possible spot price processes .",
    "if the spot price @xmath299 is bigger than the average trigger price @xmath300 , then the derivative is negative , and the optimal stochastic exercise is the smallest possible allowed by constraints . similarly if @xmath299 is smaller than the average trigger price , then the optimal exercise is the biggest possible allowed by constraints .",
    "thus , the optimal prompt stochastic exercise is @xmath301 we see that the optimal stochastic exercise is bang - bang , and that the expected value of the intrinsic trigger price @xmath302 can be interpreted as the stochastic trigger price @xmath303 : @xmath304    next we can show that under some assumptions the stochastic trigger price in the leading order of taylor expansion equals the intrinsic trigger price .",
    "indeed , let us designate @xmath305 that spot price path which coincides with the initial forward curve at time @xmath306 : @xmath307 the trigger price @xmath308 is then the intrinsic trigger price , calculated at time @xmath3 on the basis of the forward curve @xmath309 .",
    "all other paths @xmath276 are different , and we designate @xmath310 this difference is zero at the beginning of time period : @xmath311 since all paths of the spot price process start in the same point @xmath312 . at the end of the period",
    "the difference @xmath313 may be arbitrary large , but the majority of paths stay within the range @xmath314 if @xmath315 remains small , then the difference in the trigger level @xmath316 can be calculated by means of the first order taylor expansion  ( [ eq : dc_1_order ] ) : @xmath317 since the forward price process is a martingale , we conclude that @xmath318 , and hence in the first order @xmath319 .",
    "consequently @xmath320 which means that the stochastic trigger price equals the intrinsic trigger price .",
    "since any time moment @xmath2 during the exercise period can be considered as a starting point , the following statement holds : for any time @xmath2 the optimal stochastic exercise is bang - bang , and the stochastic trigger price @xmath270 is approximately equal to the intrinsic trigger price @xmath321 , calculated at time @xmath2 on the basis of the deterministic forward curve @xmath168 .",
    "note that to derive the relation ( [ eq : stochastic_trigger_price_1 ] ) we did not use any approximation , and hence this relation is exact . for derivation of relation  ( [ eq : stochastic_trigger_price ] ) we used the only assumption of small variation @xmath322 for a 1-factor mean reversion price process the relative spot price variation can be easily estimated : @xmath323 - 1 } \\,.\\ ] ] in particular , for @xmath324 the condition for the intrinsic exercise approximation becomes @xmath325 and for @xmath326 we get the condition @xmath327      in this section we find a variation of the intrinsic target function on the constraint surface .",
    "we take into account the dependency between variations of the forward curve and the intrinsic trigger price , as in eq .",
    "( [ eq : dc_2_order ] ) .    below",
    "we omit the argument @xmath2 and use the notation @xmath328 .",
    "we write the intrinsic target function in the form @xmath329 next we use the expansion @xmath330 the variational derivatives can be found easily : @xmath331 @xmath332 where @xmath333 , @xmath334 .    combining all variation terms",
    "we finally obtain : @xmath335 we can easily interpret the first term appearing in the latter expression .",
    "the variation @xmath336 reflects the change of the value of the current hedge volume of underlying due to the changed forward prices , provided the hedge volume equals the optimal intrinsic exercise @xmath184 .",
    "next non - vanishing term is of the second order : @xmath337 due to the delta - function under the integral this term is reduced to a sum over trigger times @xmath338 .",
    "this term appears due to the change of the perturbed trajectory @xmath339 .",
    "it can be shown ( see sec .",
    "( [ sec : delta_r ] ) ) that the perturbed trajectory almost everywhere coincides with the unperturbed one @xmath184 except a few points , where the transition between injection and release takes place .",
    "these points are the trigger times .",
    "change of the strategy on an infinitely small period of time around every trigger time leads to the second order correction of the target function .",
    "it is worth noticing that the second order correction is always non - negative .",
    "this reflects the fact that the rolling intrinsic strategy leads to a non - negative drift of the storage value ( see below ) .",
    "the term @xmath340 takes into account the cross - correlations between the forward price returns for different maturities .      in the financial calculus",
    "the derivatives of the target function with respect to the different parameters deserve a special attention .",
    "the most relevant of them for the portfolio management are usually designated by greek letters , and traditionally called all together `` greeks '' .",
    "one of the most important derivatives is the derivative of the option value @xmath195 with respect to the underlying price @xmath165 : @xmath341 it is termed `` delta '' and can be used for constructing a delta - neutral portfolio ",
    "such a portfolio , which value does not change under infinitesimal changes of the price .",
    "the second derivative of the option value with respect to the spot price is termed `` gamma '' : @xmath342 the gamma is a measure of the curvature of the target function with respect to the underlying price .",
    "it is also responsible for the time value of the option .    combining first and second derivatives , the variation of the option value",
    "can be represented up to the second order as @xmath343    comparing the latter equation with eq .",
    "( [ eq : deltas ] ) we conclude that the first order term in the expansion represents the option `` delta '' ( within the intrinsic strategy approximation ) : @xmath344 and the second order term represents the storage option `` gamma '' : @xmath345      here we find a variation of the optimal intrinsic trajectory @xmath184 on the constraint surface .",
    "we remind that the optimal intrinsic trajectory can be represented as @xmath346 where we have omitted the observation time @xmath2 .",
    "expanding to the second order in @xmath165 and @xmath46 we obtain : @xmath347 evaluating the partial derivatives and making use of eq .",
    "( [ eq : dc_2_order ] ) we finally get @xmath348    we see that @xmath349 has singularities at the trigger times @xmath350 .",
    "we need to give an interpretation to this fact , since the trajectory correction @xmath349 in this form violates the maximum injection / release constraints .",
    "we can show that the singular trajectory variation can be interpreted as a shift of trigger times @xmath351 by some value @xmath352 .",
    "we can give an interpretation to the obtained singularity of @xmath353 , if we consider it under an integral @xmath354 , where @xmath355 is an arbitrary function of time .",
    "approximately the @xmath356function can be replaced by a step function with support @xmath258 and height @xmath357 .",
    "the duration @xmath352 should be found to fit the integral value .",
    "let us consider @xmath353 in a form @xmath358 let @xmath359 be a trigger time",
    ". then the integral around this time gives : @xmath360 as stated above , the variation @xmath349 around the trigger time @xmath359 can be approximately replaced with a step function @xmath361 with support @xmath352 and height @xmath357 .",
    "the width @xmath352 can be estimated from simple consideration : @xmath362 we thus find for the absolute value of time shift : @xmath363 since the time @xmath71 just splits the regions of @xmath364 and @xmath365 , the previous consideration has a meaning , that the singularity of @xmath353 can be interpreted as shifting of the trigger time @xmath359 by the value  @xmath352 to the right or left . if @xmath366 , then the trigger time is always shifted in the direction of injection . if @xmath367 , then the trigger time is always shifted in the direction of release .",
    "we can represent the time shift , which takes the sign into account : @xmath368    an important property of @xmath353 is that the integral @xmath369 must vanish .",
    "indeed , from eq .",
    "( [ eq : constraint ] ) we conclude that @xmath370 integrating eq .",
    "( [ eq : delta_r ] ) and taking into account the definitions @xmath371 + and @xmath372 we find @xmath373 this proves the consistency of the expansion formula ( [ eq : delta_r ] ) .      as a `` delta '' of a vanilla option",
    "we understand a derivative of the option value with respect to the price of the underlying .",
    "this derivative has a dimension of volume and has an obvious meaning : this is an amount of the underlying , whose value changes ( up to the first order ) to the same extent under the small variation of the price , as the option value itself .    the delta can be used for the delta - hedging . if the holder of the option takes a forward ( hedge ) position , which equals the delta in its amount , but has an opposite sign , then the combination of both  option and hedge position  has vanishing derivative with respect to the price .",
    "this means that for a very small variation of the price , i.e. for a very short period of time , the value of the portfolio remains constant ( up to the first order ) . in this case",
    "we say that the portfolio is delta - neutral .",
    "since the delta itself depends on the price , the position , which was delta - neutral at some time point , will not be so after a short period of time . to remain delta - neutral , one has to recalculate the delta and update the hedge position continuously . in an ideal situation , if the update of the hedge position can be done continuously , and if the market friction can be neglected , the value of the portfolio @xmath374 ( which includes the option value , the value of the hedge volume and cumulative cash flows ) remains constant .",
    "the similar logic applies to the storage option .",
    "we can identify such a volume of underlying , which we can use as a hedge position .",
    "but unlike the vanilla option the storage option has an array of maturity times , which can be thought of as an array of different hedge products , each having a different forward price @xmath375 . for every delivery time @xmath376 we can calculate a derivative @xmath377 with respect to the forward price on that particular maturity .",
    "the delta in this case becomes an array : @xmath378 which is a discrete analogue of a functional derivative @xmath379 .    at the beginning of the storage contract",
    "the portfolio consists only of the storage option .",
    "the initial portfolio value ( sometimes referred to as `` profit and loss '' - p&l ) equals the estimated option value .",
    "as the storage starts operating , the owner of the storage sells and buys the underlying and changes the hedge position .",
    "the p&l changes according to the actual cash - flows , option value and the value of the hedge position . at the end of the storage contract",
    "the terminal p&l consists only of the cumulative cash - flow , since no open hedge position is left after the end of the storage period .",
    "if the hedge position is optimal at any time , then the p&l remains constant , and the terminal p&l equals the initial one , i.e. the storage owner earns exactly the amount predicted by the stochastic storage model .    if the storage delta can not be calculated exactly , then the p&l becomes volatile , fluctuating around some expected value .",
    "depending on the `` quality '' of the hedge position , the deviation of the terminal p&l from the expected value may become smaller or bigger .",
    "below we show that the expected value of the terminal p&l depends exceptionally on the prompt exercise trades ( i.e. on the value of the delta at the current time @xmath190 ) , whereas the width of the distribution of the terminal p&l depends on the `` quality '' of the hedge position .",
    "whatever the hedge strategy is used , the correct average time value is obtained only if at every time moment the prompt exercise @xmath19 is optimal .    in the next section we consider the rolling intrinsic exercise strategy as one of the possible hedge strategies .",
    "the rolling intrinsic strategy has a number of remarkable properties .",
    "one important feature of the rolling intrinsic is that it provides an ( almost everywhere ) optimal exercise decisions , and hence guarantees that the expectation value of the p&l equals the true option value .",
    "rolling intrinsic also allows to estimate the option time value by calculating the cumulative cash flows from the hedge and exercise trades .",
    "the deterministic consideration of the storage problem  the intrinsic value  gives a good first order estimate of the storage value .",
    "the intrinsic value can be computed for example by a dynamic programming algorithm , and has a remarkable property of the trigger price : the optimal intrinsic exercise strategy is bang - bang , each bang triggered by crossing the trigger level by the forward price curve .",
    "the stochastic reality makes the true value of the storage option different , adding to it a time value .",
    "it appears due to additional profit opportunities on the price fluctuations . as discussed in the sec .",
    "[ sec:4.6.4 ] , under some assumptions a good approximation for the `` stochastic '' trigger price is the intrinsic one .",
    "it means that an optimal prompt exercise decision at any time moment @xmath2 can be made by means of trigger level @xmath270 for which the intrinsic level @xmath321 is a good approximation .    in sec .",
    "( [ sec : stoch_opt_problem ] ) we have introduced the profit function @xmath380 , which has a meaning of the cumulative cash flow from all hedge and exercise trades , and formulated the stochastic optimisation problem in terms of probabilistic maximisation of the terminal profit .",
    "we repeat the same argumentation here in more details in application to the rolling intrinsic strategy .",
    "let @xmath168 be the forward price observed in the market at time @xmath2 .",
    "let also @xmath381 be the intrinsic optimal exercise trajectory calculated on the forward price curve @xmath168 .",
    "the volume of future trading @xmath382 can be interpreted as the intrinsic hedge volume .",
    "prior the exercise period the whole volume @xmath382 can be traded forward , providing the owner of the storage option the guaranteed profit @xmath383 which equals the intrinsic value .",
    "although strictly speaking the cash - flow from the forward contracts takes place at maturity times , we simplify the picture by assigning all the future cash - flows to the time moment the forward ( hedge ) position is taken .",
    "thus , we can say that the intrinsic value is locked at the very first time moment .    during the exercise period the breathing prices cause the change of optimal intrinsic strategy .",
    "if at time @xmath2 the price curve is @xmath168 , then at time @xmath384 it becomes different @xmath385 leading to variation of optimal intrinsic strategy @xmath386 the volume @xmath387 can be traded continuously ( dynamic hedge ) , leading to continuous change of the profit function : @xmath388 corresponding to time period @xmath189 ( again we assign the cash - flows from all future trades to the current time moment @xmath2 ) .",
    "the described strategy is called `` rolling intrinsic '' .",
    "it assumes that at every time moment the option holder takes the hedge position equal to the current optimal intrinsic strategy .",
    "since the trajectory @xmath389 is optimal for the price curve @xmath390 , the following inequality must hold ( we omit the limits of integration and observation time @xmath2 ) @xmath391 from which follows @xmath392 consequently the dynamic hedge in the rolling intrinsic strategy can only increase the value of the profit function . in other words ,",
    "the time value of the storage option is positive ( non - negative ) .",
    "interestingly , the inequality ( [ eq : pnl_inequality ] ) is only valid for rolling intrinsic strategy .    in the appendix",
    "[ ap : a2 ] we show how the time value of the storage option can be calculated from the cumulative cash flows of a rolling intrinsic hedge and exercise trades . in the following sections we apply this technique to estimate the time value of the storage option .      in this section",
    "we show that the hedge position is not relevant for the expected value of the storage option .",
    "the only prompt exercise trade , i.e. the spot trade , is crucial for the expected value of the terminal p&l .",
    "the hedge position only effects the distribution of the terminal profit .",
    "let us consider some delivery time @xmath393 $ ] .",
    "let also at some observation time @xmath394 the optimal hedge position be @xmath395 we do not specify here how to calculate the optimal hedge position @xmath396 .",
    "we only believe that it could be calculated in some way .",
    "suppose that the real hedge position , which is taken at time @xmath2 @xmath397 is not necessarily equal the optimal one : @xmath398 almost everywhere .",
    "on the other hand , we demand that at the beginning the hedge position is zero , and as the time approach the maturity , the hedge position has to be equal the optimal one : @xmath399 the volume of the underlying associated with the hedge position for the delivery period @xmath400 $ ] is @xmath401 since the initial hedge position is everywhere zero , there is no initial cash - flow , associated with the hedge position .",
    "the hedge position changes with the time @xmath2 .",
    "the increment of the hedge position @xmath402 leads to the cash - flow @xmath403 where @xmath168 is the forward price for the delivery on @xmath23 , observed on @xmath2 .",
    "the total cash - flow per delivery period @xmath352 becomes @xmath404    now we apply integration by parts , which in ito calculus has to be slightly modified .",
    "indeed , let @xmath405 where @xmath406 and @xmath407 are correlated stochastic processes .",
    "we use the ito formula to obtain @xmath408 integrating from 1 to 2 we obtain the modified `` integration by parts '' formula : @xmath409 applying this formula to eq .",
    "( [ eq : expected_cashflow ] ) we obtain @xmath410 averaging the obtained expression over the price increments @xmath411 , and noticing that @xmath412 the expected cash - flow becomes @xmath413 thus , the expected cash - flow is independent on the hedge strategy @xmath186 for @xmath394 , and only depends on the prompt exercise trade @xmath414 .",
    "from this an important consequence follows : the rolling intrinsic strategy is a good approximation of the exact optimal strategy . indeed , as has been shown in sec .",
    "[ sec:4.6.4 ] the intrinsic prompt exercise is a very good approximation of the stochastic one , and hence , rolling intrinsic leads to a very good expected value of the terminal storage profit .    on the other hand",
    ", the intrinsic hedge profile may be not close to the optimal hedge profile , and thus it may lead to rather poor efficiency of hedge in terms of stabilising the profit function .",
    "we can estimate the `` quality '' of the intrinsic hedge strategy by calculating the standard deviation of the terminal value of the profit function .      for the rolling intrinsic strategy",
    "the increment of the target function is given by eq .",
    "( [ eq : delta_s ] ) . averaging the increment @xmath415 and its square with respect to the price increment @xmath416",
    "we obtain : @xmath417 where @xmath418 is the averaging over the stochastic increment @xmath411 .    both @xmath419 and @xmath420",
    "are proportional to @xmath258 . designating @xmath421",
    "we can assign to @xmath205 an effective stochastic process @xmath422 notice that the average @xmath423 as well as @xmath424 and @xmath425 are stochastic values , since they depend ( implicitly or explicitly ) on the stochastic price @xmath426 .",
    "the drift @xmath424 and volatility @xmath425 averaged over the forward price will allow us to find the distribution parameters of the terminal profit  @xmath209 .",
    "indeed , the expectation value and the variance of the time value @xmath427 are given by ( see app .  [",
    "ap : a2 ] ) @xmath428 where we have designated @xmath429    substituting @xmath349 into eq .",
    "( [ eq:4.55 ] ) and performing integration we obtain @xmath430 where the integration is performed from @xmath2 to @xmath431 .",
    "this result could also be obtained from eq .",
    "( [ eq : deltas ] ) , since ( see app .  [",
    "ap : a2 ] ) @xmath432    next we observe that @xmath433 as well as @xmath434 are singular functions , and the integrals of the type @xmath435 and @xmath436 are reduced to a summation over the set of trigger times @xmath437 . making use of the identities ( [ eq : a4 ] ) and ( [ eq : a5 ] )",
    "we obtain : @xmath438 where @xmath439 this value is stochastic for @xmath172 . using the results of app .",
    "[ app : averaged_integral ] and using the notation @xmath440 we finally obtain the average of @xmath424 with respect to the forward curve @xmath165 : @xmath441    using the results from the app .",
    "[ app : averaged_integral ] the latter summation formula can under some assumptions be replaced with the integration , which would allow an easier analytic approximation .",
    "we apply now the expansion formula to a simple toy example of a storage contract with one factor price process ( with @xmath442 ) .",
    "the correlation function for this price process is given by @xmath443 as initial price condition we consider a periodic function @xmath444 where @xmath431 is the exercise period , @xmath445 is the number of trigger times and @xmath446 is the distance between the nearest trigger times .",
    "let also @xmath447 be the initial trigger level .",
    "we obtain : @xmath448    next we substitute @xmath449 into eq .",
    "( [ eq : av_mu_storage ] ) to obtain @xmath450\\,.\\end{aligned}\\ ] ] performing integration we get : @xmath451\\,.\\end{aligned}\\ ] ]    for the option time value we finally obtain @xmath452 where we have introduced a function @xmath453 here @xmath454 is the euler s constant and @xmath455 is incomplete gamma function @xmath456      the function @xmath458 is bell - shaped with @xmath459 asymptotics on the left wing as @xmath460 and @xmath461 asymptotics on the right wing as @xmath462 ( see fig .",
    "[ fig:2 ] ) .",
    "the function reaches it s maximum approximately at @xmath463 and reaches there the value @xmath464 thus , if we consider the time value @xmath465 as a function of the parameter @xmath457 ( the time @xmath431 is kept constant ) , then it reaches its maximum at @xmath466 and the maximum time value is @xmath467    the function @xmath458 in the whole range can approximately be represented in the form @xmath468 where @xmath469 could roughly be considered as constant .",
    "more precisely , @xmath470 to better fit the left wing of @xmath471 and @xmath472 to better fit the right wing . around maximum",
    "the best fit is achieved with @xmath473 . in the whole range we can take @xmath474 .",
    "this approximation results from the replacement @xmath475 in eq .",
    "( [ eq : mu_final ] ) .      for small @xmath477",
    "the function @xmath458 has an asymptotics @xmath478 thus , for small @xmath457 satisfying the inequality @xmath479 the asymptotic time value becomes @xmath480 we conclude that the storage option time value for @xmath481 is proportional to @xmath482 . in particular , the time value vanishes for @xmath483 .      for this asymptotics",
    "we obtain @xmath485 thus , for big @xmath457 satisfying the inequality @xmath486 the asymptotic time value becomes @xmath487      the comparison of the analytical formula for the time value with numerical simulation can be seen in the fig .",
    "[ fig:3 ] .    for this graph",
    "we have created a toy storage contract with deliberately reduced influence of the surface effects . to a large extent",
    "the difference can be explained by the time discretisation effect .",
    "the analytical formula is obtained in the continuous time approximation , whereas in the real life the time is discrete ( for instance , gas delivery is usually nominated once a day , and hence the smallest time step is one day ) .",
    "the discrete time system has less trading opportunities than the continuous time system , and hence its exercise is `` suboptimal '' from the continuous time perspective . for this reason the discrete time system has slightly smaller time value than the continuous one .",
    "other sources of error are surface effects ( boundary influence ) , higher order corrections of the exercise strategy and some approximations used to simplify the analytic expression .      in the previous sections we have considered the storage option problem with fixed terminal condition .",
    "this condition has a significant impact on the option value .",
    "indeed , this is simply an additional constraint which restricts the possible strategies and hence can only decrease the option value .",
    "although in most of the storage contracts there is no restriction on the possible terminal level , the problem still can be considered as having the fixed terminal state constraint .",
    "the reason for that is simple .",
    "the derivative of the storage value with respect to the terminal state is given by eq .",
    "( [ eq : spacial_derivative ] ) @xmath488 where @xmath46 is the trigger price of the last part of the trajectory .",
    "if the prices @xmath426 are strictly positive , the trigger price can only be positive as well , since the forward curve should cross the trigger level at some point .",
    "thus , it is always profitable to have at the end as little gas in the storage as possible within the constraints boundaries .",
    "it means that the optimal trajectory has to terminate at the lower boundary , and hence the problem can be considered as having the fixed terminal state . if we variate the forward curve @xmath489 , this will lead to variation of the optimal strategy .",
    "however , the new strategy preserves the terminal level .",
    "there are examples of the contracts for which this logic is not applicable .",
    "for instance , if the remaining gas can be sold at the fixed price @xmath107 , then the derivative of the storage value with respect to the terminal state is given by eq .",
    "( [ eq:4.21 ] ) @xmath490 from which the condition ( [ eq:4.22 ] ) @xmath491 follows .",
    "the vanishing derivative implies that the trajectory may terminate anywhere between the upper and lower boundaries .",
    "the variation of the forward curve would lead to an `` arbitrary '' variation of the optimal trajectory which does not preserve the terminal state .",
    "another more common example is a swing option .",
    "usually a swing option is a gas supply contract .",
    "the option holder is given a right to purchase gas from a producer at some `` contract '' price .",
    "he would then sell the gas on the market at the `` market '' price .",
    "thus , the effective price for the option holder is the spread between the `` contract '' and the `` market '' price .",
    "this spread can be positive or negative .",
    "a typical swing contract obliges the option holder to take some amount of gas within the contract period , however the option holder has some flexibility : the total taken amount can be anything within the constraints  minimal and maximal total taken volumes .",
    "the option holder also has some flexibility during the contract time to take bigger or smaller amount of gas on particular days , making maximum of the opportunities to earn on the spread .",
    "the swing contract can be easily formulated in terms of a storage , and hence possesses all features of a storage option .",
    "however the matter of fact that the spread between contract and market prices can be negative , makes the swing option having slightly different peculiarities .",
    "the difference between the swing and storage option is rather relative .",
    "one can find examples of swing options having all the features of a storage option . if the swing option is deep in the money ( i.e. the market prices are much higher than the contract prices ) , then the option holder is most likely to take the maximal allowed amount of gas , making the optimal trajectory to terminate at the lower boundary .",
    "similarly , if the option is deeply out of the money , the optimal trajectory is very likely to terminate on the upper boundary .",
    "however if the swing option is at the money , it is quite probable that the total taken amount of gas will be between maximum and minimum . in this case",
    "the swing option problem becomes a problem with free terminal state .",
    "this section is devoted to the problem with the free terminal condition .",
    "we will show that this problem has a different time value and derive the time value in a similar way it has been done for the problem with fixed terminal state .",
    "the problem with free terminal state has an important feature . as it was shown in the sec .",
    "( [ sec : free_vs_fixed_terminal_condition ] ) , the derivative of the option value with respect to the terminal volume must vanish .",
    "this leads to the condition on the trigger price @xmath492 .",
    "since there is no final unit price in the swing contract we conclude that for the problem with free terminal condition @xmath493 from which obviously the condition @xmath494 follows .",
    "these conditions will simplify the derivation of the option value evolution equation .",
    "in particular , the variation of the target function becomes ( compare with eq .",
    "( [ eq : deltas ] ) ) @xmath495 the second term gives a non - vanishing part of the average option value increment .",
    "if we compare this formula with eq .",
    "( [ eq : deltas ] ) we see that @xmath294 of the problem with fixed terminal state contains an additional negative term .",
    "hence the averaged growth rate of the option value of the problem with free terminal state is higher than that of the problem with fixed terminal state , as expected .",
    "the evolution equation for the option time value becomes @xmath496 with @xmath497    repeating the calculation in the previous sections we finally obtain @xmath498      let the evolution of the spread be described by a normal brownian one - factor price process @xmath499 note that a natural choice for the price process describing the evolution of gas forward curves is a geometric brownian motion , whereas for the spreads evolution a plane brownian motion is a more suitable choice . unlike the volatility @xmath500 of the geometric brownian motion ,",
    "the normal volatility @xmath501 includes additional dimension of price .",
    "the correlation function of the price process  ( [ eq : brownian_motion ] ) becomes @xmath502 let the initial forward curve be given by @xmath503 repeating the calculation similar to that in the previous section we obtain the swing option time value @xmath504 this formula resembles the formula of the time value of a storage option  ( [ eq : storage_time_value ] ) , where the volatility @xmath501 replaces the product @xmath505 .",
    "the asymptotics of the swing option time value for the big mean reversion parameter coincides with that for the storage option : @xmath506 however in the limit of small mean reversion the swing option time value reveals different properties : @xmath507 for @xmath483 the time value reaches its maximum @xmath508 and on the entire range the time value is a decreasing function of @xmath457 ( see fig .",
    "[ fig:4 ] ) .    this result can be easily interpreted .",
    "the main driver of the storage option time value is the change of exercise strategy .",
    "since any change of the exercise strategy must preserve the terminal volume level , the storage option becomes a zero sum game : any decision to inject more at some time moment must be compensated by the decision to release more at some other time moment . hence the storage option is in some sense similar to a set of time spread options .",
    "the only way the time spread option can increase its value is an asynchronous movement of different parts of the forward curve . in the limit @xmath481 the forward curve moves in a parallel way ( in log scale ) , and hence does not lead to any change of the exercise strategy , i.e. to the increase of the time value .    on the contrary ,",
    "the swing option is similar to a strip of european call options . indeed , since there is no terminal level preservation condition , any change of the strategy at one ( delivery ) time has no impact on the rest of the trajectory . if for instance we hedge the exercise trajectory at the very first observation time moment @xmath3 , then the change of the exercise decision for any time @xmath23 would make a profit .",
    "the pay - off of the exercised volume on the time @xmath2 will have a structure of the european vanilla option .",
    "the effective square volatility of the option with exercise time @xmath23 is given by @xmath509 it s easy to see that the biggest effective volatility @xmath510 is achieved for the flat volatility term structure  @xmath483 , thus leading to the highest possible time value of the swing option .",
    "this has a strong impact on the way the price process for the forward curve evolution should be calibrated .",
    "let us consider a price process in the form @xmath511 where @xmath512 and @xmath513 are ( possibly correlated ) standard brownian processes .",
    "let also @xmath514 and @xmath515 be exponential functions , describing the short term and long term volatilities @xmath516 here the mean reversion parameter @xmath517 is relatively big ( compared to @xmath518 ) , i.e. the term @xmath514 describes the short term volatility .",
    "the second term @xmath515 describes the long term volatility , which means @xmath519 .",
    "the correlation function decouples into three terms @xmath520 since the option time value ( both storage and swing ) is a linear functional on the correlation function , the time value also splits into three components , which can be estimated independently .    for evaluation of the storage option",
    ", the second and third terms will give no contribution , since they correspond to the long term volatility ( @xmath481 ) .",
    "consequently for the storage option the second term in the r.h.s . of the price process can be neglected .",
    "this is not the case for the swing option . since both ",
    "long term and short term volatilities contribute to the option time value , we can not neglect the long term volatility in the price process .",
    "in sec .  [ sec : deterministic_problem ] we considered a deterministic storage problem and have fount its solution in an implicit form . the solution provided by eq .",
    "( [ eq : solution ] ) contains a free parameter ",
    "trigger price , which can be found from boundary conditions .",
    "the obtained solution reveals the key features of the intrinsic optimal exercise strategy .    *",
    "the optimal exercise is bang - bang .",
    "there is a `` dead zone '' around the trigger price .",
    "the optimal strategy is to inject at maximum rate if the price is below the zone , release at maximum rate if the price is above the dead zone and do nothing if the price is within the dead zone .",
    "* the width of the dead zone is defined by the operating costs . *",
    "the trigger price is constant for every piece of the trajectory where it does not sticks to the boundary .",
    "different pieces of trajectory separated by the boundary touch may have different trigger level .",
    "if the trajectory touches the boundary in the interval @xmath79 , the conditions  ( [ eq : bc1]-[eq : bc4 ] ) must be satisfied .",
    "we also considered an impact of different constraints on the solution .",
    "in particular we found that    * the cycle constraint is equivalent to additional injection / release costs . *",
    "the carry cost preserves the bang - bang property , but makes the trigger price growing with the time at the rate of the carry cost . * the volume dependent injection / release costs lead to a time - dependent trigger level , but preserve the bang - bang property . *",
    "fir the price of the underlying is strictly positive , and there is no final unit price , then the storage problem ( both intrinsic and stochastic ) can be considered with fixed terminal condition . if there is a positive final unit price , or if the prices of the underlying can be negative , then the optimisation problem becomes a problem with free terminal condition .",
    "this problem has an additional condition on the trigger level  ( [ eq:4.22 ] ) for storage or  ( [ eq:4.23 ] ) for swing option .    in sec .",
    "[ sec : stochastic_problem ] we developed a perturbation analysis to find the solution of the stochastic problem in rolling intrinsic approximation .    first important result obtained in this section finds the relation between the intrinsic and stochastic solutions .",
    "in particular we show that the stochastic optimal exercise has exactly the same bang - bang feature with a trigger level and a dead zone .",
    "the stochastic trigger level is given by the averaged intrinsic trigger price ( eq .  ( [ eq : stochastic_trigger_price_1 ] ) ) , where the average is taken over all realisations of the spot price process . under the condition  ( [ eq : condition_for_rolling intrinsic ] )",
    "the average trigger price equals approximately the current intrinsic trigger price ( conditional on the current initial condition and forward curve ) .",
    "this condition defines the range of applicability of the rolling intrinsic approximation .",
    "next we show that the hedge position has no impact on the expected option value .",
    "the only relevant part of the hedge strategy is the instant ( prompt ) exercise at the current time .",
    "this justifies the assumption that the intrinsic exercise profile as a good approximation of the optimal stochastic hedge profile , and generally , the rolling intrinsic strategy is a reasonable approximation for the optimal stochastic strategy .    by applying a variational analysis to the intrinsic solution",
    "we obtain the option greeks  delta and gamma .",
    "this allows us to find the option time value .",
    "making use of the option gamma we derive a stochastic differential equation governing the evolution of the option value . the drift term ( eq .  ( [ eq : av_mu_storage ] ) for storage and eq .",
    "( [ eq : av_mu_swing ] ) for swing option ) can be integrated yielding the option time value .",
    "we apply the obtained time value formula for a toy examples of the storage and swing contracts with a simple 1-factor price process . the storage option time value ( eq .",
    "( [ eq : storage_time_value ] ) ) is a bell - shaped function of @xmath457 , approaching zero for @xmath481 and @xmath521 , and reaching its maximum at @xmath522 .",
    "the swing time value appears to be a decreasing function of @xmath457 for the entire range , reaching the maximum for @xmath483 and approaching zero for @xmath521 .",
    "the option time value appears to be a linear functional on the prices correlation function .",
    "from this fact we conclude that if the correlation function can be decoupled into independent components , the option time value can also be decoupled .",
    "this allows us to investigate effect of different components of the price process on the time value independently .",
    "the difference in the limiting case @xmath481 between swing and storage option time value has an important consequence .",
    "this limiting case corresponds to the `` long term '' volatility due to the flat shape of the correlation function in this limit .",
    "if we consider a price process , whose correlation function could be decoupled into short and long terms , the impact of the long term component can be investigated independently .",
    "we conclude that the long term volatility has a significant impact on the swing option time value , but has no impact on the storage option time value .",
    "this fact can also be used in the price process calibration procedure .",
    "last important comment concerns the applicability of the obtained results . throughout the derivation process we used a number of simplifying approximations .",
    "in particular , the rolling intrinsic approximation is valid for sufficiently small volatility . for the derivation of the option time value",
    "we also have neglected the surface effects ( possible influence of the storage being completely full or empty ) , the bid - offer and operating costs , and used rather simple time - independent option constraints . for the derivation of analytic formulas of the time value we also implicitly used an assumption about sufficient smoothness of the forward curve , which justified the use of taylor expansion .",
    "another significant approximation was made for the definition of the swing option , where we have allowed the option holder to take any possible amount of the underlying limited only by the maximum release rate .",
    "all these approximations restrict the applicability of the obtained results .",
    "however all the qualitative results remain valid for much bigger range of parameters . and",
    "the main results can still be used for understanding the option value driving mechanisms and for building an intuition about the influence of different factors on the option value .",
    "suppose that we are considering a real storage and we are interested in the applicability of the option value formula .",
    "for instance , we find that the intrinsic strategy spends a significant time on the boundary .",
    "this means that we ca nt neglect the surface effects , and the option value formula is not applicable directly .",
    "however , as the experiments show , all the major qualitative results still remain valid , and the option value formula could be corrected by some multiplier , which is weekly dependent on the storage parameters . thus evaluating the storage for one set of parameters , we can easily predict how the value would change for a different set of parameters .",
    "another example of the restricted usability of the option value formula is the swing contract .",
    "a real swing contract usually has two global constraints  maximum and minimum volume which can be taken during the contract period .",
    "these constraints were not taken into account in the swing value formula , which allowed us to use the free terminal condition approximation . however , if the option is `` at the money '' , the probability is very high that the total taken volume will be between the maximum and minimum , and thus satisfy the requirement of the free terminal condition .",
    "hence the swing formula remains a good approximation for the at - the - money option .",
    "the swing options which are either deep in- or out - of - the - money , are very likely to finish on either lower or upper boundary of the total taken volume .",
    "such an option satisfies the condition with fixed terminal level , and hence a storage formula can be used to estimate the time value of such an option .",
    "an intermediate case , when the swing option is only slightly in- or out - of - the - money , neither storage nor swing formula become directly applicable .",
    "however , one can see that these two formulas allow a continuous transition , since they only differ by one term , which is not present in the swing formula .",
    "thus the ultimate formula could be easily adjusted for the particular swing option .",
    "* appendix *",
    "to find the equation of the constraint surface we vary the equation [ eq : constraint ] . since @xmath168 follows a wiener type stochastic process , so does the @xmath133 .",
    "hence we find the variation of the @xmath523 up to the second order in @xmath208 and @xmath524 : @xmath525 on the optimal intrinsic trajectory @xmath526 , and the first term in the r.h.s . vanishes .",
    "we introduce the notation : @xmath527 where @xmath528 is the dirac delta - function , and @xmath529  its derivative . making use of eq .",
    "( [ eq : solution_for_dot_q ] ) and the notation above , we find @xmath530 we thus obtain a quadratic equation on @xmath524 : @xmath531 here for simplicity we omitted arguments of the functions : @xmath532 , @xmath533 , @xmath534 , @xmath535 and @xmath536 .",
    "we search the solution in form of a series . as a zeroth order solution",
    "we take @xmath537 the first order solution becomes @xmath538 substituting @xmath539 into the r.h.s . of eq .",
    "( [ eq : quadratic_eq_for_dc ] ) , and leaving only 1st and 2nd order terms we finally obtain @xmath540 where we have used the notation @xmath541",
    "in this section we show how the option time value can be obtained from the dynamics of the portfolio components in the rolling intrinsic strategy .",
    "we start with summarising some basic facts from the option pricing theory .",
    "let @xmath165 be a price of some underlying with delivery at time @xmath23 , and let @xmath542 be a price of an option expiring on @xmath23 . let the price be following a geometric brownian motion ( for simplicity we disregard the interest rate ) , which in ito representation reads : @xmath543 using ito rule we can find a differential of the option price : @xmath544 according to the non - arbitrage condition average of this expression must vanish : @xmath545 noticing that @xmath546 we obtain @xmath547 or substituting @xmath548 explicitly @xmath549 this equation ( up to the interest rate terms ) is known as black - scholes equation . for us",
    "it is essential that the operator @xmath550 applied to any martingale process vanishes : @xmath551 designating the operator of the full differential as @xmath552 we find @xmath553 next we derive the expression for the differential of the option delta @xmath554 . to do that",
    ", we notice first that the operators @xmath555 and @xmath556 do not commute . using the obvious commutation rule @xmath557 =       d\\ , \\frac{{\\partial}}{{\\partial}f } - \\frac{{\\partial}}{{\\partial}f}\\,d = - dt \\ , \\sigma^2\\,f\\,\\frac{{\\partial}^2 } { { \\partial}f^2}\\ ] ] we find @xmath558      let us consider a standard situation when an owner of an option hedges it with a combination of linear products .",
    "the full portfolio consists of three components : an option expiring on @xmath23 , a hedge sub - portfolio , consisting of linear products , and a cash account .",
    "let @xmath559 be the value of the full portfolio at the observation time @xmath2 .",
    "then we have @xmath560 where @xmath561 is the option value , @xmath562 is the value of the hedge portfolio , and @xmath205 is the balance of the cash account .",
    "the dynamics of the option value @xmath563 is given by eq .",
    "( [ eq : df ] ) @xmath564    next we find the dynamic equation for other portfolio components .",
    "let us consider a hedge approach , when the hedge portfolio consists of some amount of underlying @xmath565 , i.e. hedge portfolio contains only linear products .",
    "the value of the hedge portfolio equals the current price of the hedge volume : @xmath566 in a classical scheme we may think of the option @xmath563 as a vanilla option on some kind of shares . in this case the hedge consists of some amount of shares which is purchased prior the expiry date .",
    "the same logic can be applied to a commodity market .",
    "for instance @xmath563 could imply an option to purchase some amount of gas . in this case hedge",
    "consists of forward contracts with delivery on the option expiry date .",
    "although strictly speaking , the cash - flow associated with the delivery on the forward contract can take place on a later stage , we assign the cash - flow to the current ( observation ) time @xmath2 , and hence the value of the hedge portfolio reflects the total price of underlying , and not only of the forward contracts .    the hedge portfolio is a product of two stochastic variables .",
    "using eq .",
    "( [ eq : itochainrule ] ) from the main text , we find @xmath567 the latter equation can be formulated as _ retarded action principle_. this principle follows from a physical meaning of the dynamic hedge : the change of the hedge volume takes place after the change of the price is observed , and the additional hedge volume @xmath568 has to be purchased at the new price @xmath569 .",
    "notice however that the retarded action principle does not require any special differentiation rule .",
    "the dynamics of the cash - flow component is easy to find .",
    "the cash - flow appears due to the change of the hedge volume : @xmath570    the increment of the portfolio value is given by @xmath571    first we notice that if we use the delta - hedge , i.e. if the hedge volume equals the option delta with the opposite sign @xmath572 then , as expected , the variance of the portfolio equals zero : @xmath573 next important observation can be made about the relation between hedge portfolio and cash - flow .",
    "averaging the increments @xmath574 and @xmath575 with respect to the stochastic price increment  @xmath411 we obtain : @xmath576 where @xmath577 is the averaging over the price increment .",
    "let us consider the case when the hedge volume equals the exact ( negative ) option delta @xmath578 using eq .",
    "( [ eq : d2f ] ) we get for the hedge increment : @xmath579 note that on average the hedge portfolio value and the cash account do not change : @xmath580      here we show how the time value of a vanilla option can be calculated from the intrinsic target function .",
    "let @xmath581 be the intrinsic option delta , i.e. the delta calculated at the option maturity time @xmath582 similarly we define the intrinsic gamma @xmath583 the intrinsic target function @xmath584 is defined such that at every time moment it is equal to the intrinsic option value @xmath585 the variation of the target function is given by @xmath586 note that the increment @xmath208 is independent , and hence @xmath587    integrating @xmath588 over the time and averaging over the realisations of the stochastic price process , we get @xmath589 next we observe that @xmath590 is the intrinsic option value at time @xmath3 , and the expectation @xmath591 is nothing else but the option value at time @xmath3 , and thus the latter integral equals the option time value @xmath592 : @xmath593      a storage option can be considered as a sequence of simple trades of buying and selling some amount of underlying .",
    "the logic of the derivation of a vanilla option time value can be applied to the storage option , if we consider it as a strip of ( correlated ) vanilla options with a pay - off @xmath594 , where @xmath595 is the volume purchased at time @xmath23 for the delivery period @xmath596 at the spot price @xmath426 .    for every delivery time @xmath23",
    "there is a forward price @xmath168 which is as a function of the observation time @xmath2 .",
    "suppose we have an optimisation model , which calculates an intrinsic exercise profile @xmath597 based on the current forward curve @xmath168 .",
    "then @xmath598 is the volume of underlying ( per delivery period @xmath596 ) to be traded on time @xmath23 .",
    "the value @xmath599 can be interpreted as a _ target function density _ for the trade on the delivery time @xmath23 . the same function after expiry is constant @xmath600 now the storage option target function can be expressed simply as an integral of the target function density over the delivery time @xmath601 the first integral in this expression represents the value of the closed trades , whereas the second integral represents the future profit calculated with the current forward curve and exercise profile . at the last time moment @xmath80 the second integral vanishes , and the target function equals the cumulative cash flow from the closed trades .",
    "note that the cumulative cash flow only depends on the exercise volumes @xmath602 , and not on the hedge volumes @xmath598 for @xmath394 .",
    "now we apply the logic of the section  [ app : timevaluefromtargetfunction ] in order to calculate the storage option time value .",
    "obviously the target function calculated at the time @xmath3 yields the intrinsic storage option value @xmath603 the expectation value of the terminal target function value gives the true option value @xmath604 ( this statement relies on the fact that the intrinsic exercise is an optimal prompt exercise , which has been justified in the sec .  [ sec:4.6.4 ] ) , and hence , the time value can be obtained as @xmath605 where @xmath606 is a full differential of the target function .",
    "some comment should be made regarding the calculation of the target function differential .",
    "first we split the target function into two parts : @xmath607 where @xmath608 represents the `` closed '' trades , and @xmath609 represents the open trades , i.e. the remaining `` future '' option value .",
    "the definition of the target function in the main text coincides with the second `` open '' component of the target function defined above .",
    "however we can show that the open target function can also be used for the derivation of the time value .",
    "the variation of the target function should be done with respect to the forward curve @xmath165 and time  @xmath2 .",
    "the target function @xmath152 is an explicit function of the forward curve and of the time , and the dependence on the time is due to the limits of the integrals .",
    "it is easy to see that the time variance of the closed component equals in absolute value the time variance of the open component but has an opposite sign : @xmath610 thus the target function can be considered as an explicit function of the forward curve only .",
    "the full differential includes only the differentiation with respect to the forward price : @xmath611 the closed part of the target function is constant with respect to the forward curve variation ( the variation of the forward curve impacts only the future values of the curve @xmath168 for @xmath191 ) , and hence @xmath612 where we designated @xmath613 the variation which should be calculated for constant time @xmath2 .",
    "thus @xmath614    it is interesting to note that for the storage option the hedge value coincides with the ( negative ) open target function : @xmath615 and hence @xmath616 where @xmath380 is the cumulative cash flow from the hedge trades .",
    "note that this relation would not be valid for a vanilla option , since in general case the target function can not be expressed as @xmath617 .",
    "there is another way to see how the time value can be obtained from the cumulative cash flow . by definition the cash flow ( resulting from the hedge trades ) with delivery on @xmath23 per delivery interval @xmath596 is given by @xmath618 @xmath619 the value @xmath620 has a meaning of the cash flow density over the delivery time .",
    "the total cash flow increment at time @xmath2 is related to @xmath621 as @xmath622 from which the total cash flow follows as @xmath623 both @xmath620 and @xmath380 should be considered as functions of time @xmath2 with @xmath23 been a parameter .",
    "integrating @xmath624 from 0 to @xmath23 and noticing that @xmath625 , we get the cumulative cash flow per delivery period @xmath626 $ ] : @xmath627 now we use the integration by parts , which in our case can be represented as @xmath628 for the averaged cumulative cash flow we obtain @xmath629 the total average cash flow is given by integrating @xmath630 over the delivery time : @xmath631 noticing that @xmath632 equals the option intrinsic value , and @xmath633 equals the true option value , we conclude that @xmath634",
    "in this section we consider an averaging of the integrals of the type @xmath635 where @xmath636 is the forward curve  a stochastic function of observation and delivery times , and @xmath97 is an arbitrary function of @xmath23 and @xmath165",
    ". we will be interested in the average of the integral over the stochastic prices @xmath637 .    due to the delta - function under the integral",
    "we can write @xmath638    introducing the set of trigger times @xmath639 we can calculate the integral @xmath640 for every observation time : @xmath641 this integral is a stochastic variable . indeed , the process @xmath168 is stochastic , and hence , the set of trigger times as well as the derivatives @xmath642 are stochastic .",
    "the average over the stochastic function @xmath165 is given by @xmath643 here we have assumed that @xmath46 is constant .",
    "the average of the delta function can be easily found using fourier transformation : @xmath644 making use of the cumulant expansion and keeping only the two first cumulants ( which , strictly speaking , is only exact for gaussian variables ) we find the average of the exponential : @xmath645 where we used @xmath646 substituting the averaged exponential into eq .",
    "( [ eq : delta_fourier ] ) and performing integration we obtain @xmath647    for the averaged integral we get : @xmath648 note that both @xmath649 and @xmath500 are functions of @xmath2 and @xmath23 : @xmath650 the exponent under the integral reaches its maximum at the trigger times @xmath651 , when @xmath652 . expanding the forward curve around this value",
    "@xmath653 we notice that for each trigger time averaged delta function becomes a gaussian bell ( as a function of time @xmath23 ) of the width @xmath654 , which can be found from an approximate relation @xmath655      suppose that the trigger times are distributed rather uniformly on the time axis .",
    "then we may speak about characteristic time distance between the trigger times .",
    "let @xmath446 be the average trigger time step @xmath656 we say that function @xmath657 is slow if it changes insignificantly within the average trigger time step : @xmath658 let us also suppose that the time derivative @xmath642 can be considered as constant plus maybe a small random correction : @xmath659 in this case we can replace the summation in eq .",
    "( [ eq : summation3 ] ) with the integral : @xmath660 where we have assumed that the derivatives @xmath661 can be considered as constant .",
    "the same approximation can be used for the averaged integral ( [ eq : averaged_delta_integral_2 ] ) . the biggest contribution to the integral",
    "is made by the intervals of the width @xmath662 around the trigger times @xmath663    if the volatility of the forward price process is not too big , so that @xmath664 then the function @xmath97 is slow with respect to the width of the gaussian bell around the trigger times in the integral  ( [ eq : averaged_delta_integral_2 ] ) @xmath665 in this case the function @xmath97 can be roughly considered as constant on every integration interval @xmath666 .",
    "we thus obtain @xmath667 the volatility @xmath500 as a slow function of the delivery time and can be considered as constant under the integral .",
    "substituting in the first order around the trigger price @xmath668 we can estimate the integral over one trigger time as @xmath669 , and the averaged integral becomes @xmath670 this means that even for the averaged integral under the specified assumptions the same summation formula can be used as for the stochastic integral  ( [ eq : summation3 ] ) .",
    "if we demand that the function @xmath657 is a slow function of time not only with respect to the characteristic time @xmath654 but also with respect to the time interval @xmath446 @xmath671 and if @xmath672 can be considered as constant , then we can roughly estimate @xmath673 this approximation is used in the example calculation of the storage option time value .",
    "for the arbitrary sufficiently smooth functions @xmath561 and @xmath674 the following identities are easy to prove : @xmath675 dt    =              - \\sum \\ , \\frac{1}{|\\dot \\varphi(t_i)|}\\ , \\frac{d}{dt }                  \\left [ \\frac{f(t)}{\\dot \\varphi(t ) } \\right]_{t = t_i } \\ , ;   \\\\      & \\int_{-\\infty}^{\\infty } \\delta''(\\varphi(t))\\,f(t)\\,dt =              \\sum \\ , \\frac{1}{|\\dot \\varphi(t_i)|}\\,\\frac{d}{dt}\\ , \\frac{1}{\\dot \\varphi(t_i ) } \\,\\frac{d}{dt }                  \\left [ \\frac{f(t)}{\\dot \\varphi(t ) } \\right]_{t = t_i } \\,;\\end{aligned}\\ ] ] where the sum is over all points @xmath676 .",
    "making use the definitions from the main text ( we omit the index @xmath2 where it is unambiguous ) @xmath679 it is easy to prove the following identities : @xmath680 where @xmath681 is an arbitrary sufficiently smooth function ."
  ],
  "abstract_text": [
    "<S> the mathematical problem of the static storage optimisation is formulated and solved by means of a variational analysis . </S>",
    "<S> the solution obtained in implicit form is shedding light on the most important features of the optimal exercise strategy . </S>",
    "<S> we show how the solution depends on different constraint types including carry cost and cycling constraint . </S>",
    "<S> we investigate the relation between intrinsic and stochastic solutions . </S>",
    "<S> in particular we give another proof that the stochastic problem has a `` bang - bang '' optimal exercise strategy . </S>",
    "<S> we also show why the optimal stochastic exercise decision is always close to the intrinsic one .    </S>",
    "<S> in the second half we develop a perturbation analysis to solve the stochastic optimisation problem . </S>",
    "<S> the obtained approximate solution allows us to estimate the time value of the storage option . </S>",
    "<S> in particular we find an answer to rather academic question of asymptotic time value for the mean reversion parameter approaching zero or infinity . </S>",
    "<S> we also investigate the differences between swing and storage problems . </S>",
    "<S> the analytical results are compared with numerical valuations and found to be in a good agreement .    </S>",
    "<S> dmitry lesnik + </S>"
  ]
}