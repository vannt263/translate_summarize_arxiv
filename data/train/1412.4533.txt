{
  "article_text": [
    "principal component analysis ( pca ) is a well - known technique initially designed to reduce the dimensionality of a typically huge data set while keeping most of its variance @xcite .",
    "pca is intimately related to the singular value decomposition ( svd ) since the principal components of a data set , whose arithmetic mean is zero , will be equal to the eigenvectors of the covariance matrix sorted by their corresponding eigenvalue ; or equivalently by the variance they account for .",
    "the principal coefficients are the linear coefficients allowing us to reconstruct the initial data set based on the principal components .",
    "further details about pca will be given in section [ sec : pca ] of this paper .",
    "interested readers are also invited to read @xcite for an accessible tutorial on this technique or @xcite for a deeper analysis .",
    "pca has many applications in a wide variety of astronomical domains from the classification of the sloan digital sky survey ( sdss ) quasar spectra and their redshift determination @xcite to the study of the point spread function variation in lensing surveys @xcite .",
    "the method described hereafter was originally developed in the framework of the _ gaia _ astrophysical parameters inference system @xcite where it is used to provide learning data sets of spectrophotometric data based on sdss quasar catalog spectra @xcite .",
    "the latter cover the observed wavelength range 400010 000 and are extrapolated by our algorithm to the wavelength range 300011 000 covered by _",
    "gaia_. even if developed for an astronomical purpose , it can be used in any problems requiring pca decomposition of weighted data .",
    "the case of missing data being simply the limiting case of weights equal to zero .",
    "classical pca is a mature tool whose performance in dimensionality reduction and pattern recognition has been assessed for a long time .",
    "nevertheless , its main limitation comes from the fact that it is not adapted to the case of samples having weighted and/or missing data .",
    "the inherent consequence is that the classical pca implementations made no difference between variance coming from a genuine underlying signal and variance coming from measurement noise .",
    "most of the previous works cope with these limitations mainly by focusing on bypasses to the problem of noisy and/or missing data ; or deal explicitly with particular cases .",
    "these encompass , for example , the interpolation of missing data @xcite or cases where the weight matrix can be factorized into per - observation and per - variable weight matrices @xcite . @xcite in sections 13.6 and 14.2 makes the point about these proposed solutions .    at the present time , some methods are still able to deal with weight matrices having the same size as the corresponding data set @xcite .",
    "nevertheless , none of these are able to provide the orthogonal principal components ordered by the data set variance it accounts for .",
    "rather , they provide an unsorted set of not - necessary orthogonal vectors whose linear combination is optimized to describe the underlying variance but whose goal is not compatible with the explanation of the variance given a minimal number of vectors .",
    "based on the idea of @xcite , @xcite and @xcite have recently proposed methods based upon the expectation - maximization ( em ) algorithm @xcite in order for the pca to include weights associated with each variable within each observation .",
    "the objective of these methods is globally similar to the one of this paper .",
    "differences mainly come from the fact that @xcite aim at finding an orthogonal decomposition of the original matrix such that the whole data set variance is the best accounted for .",
    "instead , our implementation focuses on finding the orthogonal vectors that are the best at individually describing the data set variance at the expense of a lower explained global variance .",
    "this trade - off comes from the fact that in a weighted case , the solution to the problem of finding the set of @xmath0 components explaining most of the variance of a data set is not guaranteed to contain the eigenvectors that are the best at individually describing this variance .",
    "the implementation of @xcite takes benefits of the flexibility of the em algorithm in order to interpolate between these two solutions .    in section [ sec : notation ] , we explain the notation used in this paper .",
    "we summarize the properties of the classical pca in section [ sec : pca ] .",
    "we see in details two current alternative implementations of weighted pcas in section [ sec : wempca ] . in section [ sec : wpca_new ] , we describe our new algorithm while in section [ sec : comparison ] , we see its application on simulated data and real cases and compare it against other algorithms . finally , some properties and extensions are discussed in section [ sec : discussion ] and we conclude in section [ sec : conclusion ] .",
    "this paper uses the following notations : vectors are in bold italic , @xmath1 ; @xmath2 being the element @xmath3 of the vector @xmath1 .",
    "matrices are in uppercase boldface or are explicitly stated ; i.e. @xmath4 from which the @xmath3th row will be denoted @xmath5 and the @xmath6th column by @xmath7 , element at row @xmath3 , column @xmath6 will then be @xmath8 . amongst matrix operators , @xmath9 denotes the element - wise product ( hadamard product ) of @xmath10 and @xmath11 and @xmath12 denotes the euclidian matrix norm of @xmath10 .",
    "consider a problem where we have @xmath13 observations each containing @xmath14 variables , from which we want to retrieve @xmath15 principal components .",
    "for reference , here are the often used matrices along with their corresponding sizes : @xmath4 the data set matrix ( @xmath16 ) from which we have subtracted the mean observation @xmath17 ( @xmath18 ) ; @xmath19 the weight of each variable within each observation ( @xmath16 ) ; @xmath20 the orthogonal matrix of principal components ( @xmath21 ) ; @xmath22 being the @xmath3th principal component ; @xmath23 the principal coefficient matrix ( @xmath24 ) ; @xmath25 the symmetric matrix of variance  covariance ( @xmath26 ) associated with @xmath4 .",
    "finally , @xmath27 means that @xmath28 is the nearest matrix from @xmath29 in a  potentially weighted ",
    "least - squares sense .",
    "mathematically , this is equivalent to have @xmath28 and @xmath29 such that @xmath30 is minimized .",
    "regarding classical pca and assuming  without any loss of generality  that we would like to retrieve as many principal components as the number of variables ( ie .",
    "@xmath31 ) , then the goal of the pca will be to find a decomposition @xmath32 such that @xmath33 is diagonal and for which @xmath34 note that based on equation ( [ eq : pca_d_pvp ] ) and according to the spectral theorem , @xmath20 will be orthogonal .",
    "intuitively , the matrix @xmath20 can be seen as a change of basis allowing us to maximize the variance within @xmath35 and thus minimizing the off - diagonal elements corresponding to the covariance .",
    "differently stated , each @xmath22 defines a privileged direction along which the data set variance is the best explained .",
    "the fact that @xmath35 is ordered implies that for @xmath36 , the principal component @xmath22 accounts for more  or equal  variance than @xmath37 . for the sake of clarity , a comprehensive pca example is given in fig .",
    "[ fig : pca_example ] .    a common solution to such a classical pca is based on the svd of @xmath4 : @xmath38 where @xmath39 , @xmath40 are orthogonals , @xmath41 is diagonal and for which @xmath42 . by setting @xmath43 and @xmath44",
    ", we find that equation ( [ eq : pca_d_pvp ] ) becomes @xmath45 that fulfils the conditions of equations ( [ eq : pca_d_pvp ] ) and ( [ eq : pca_d_ordered ] ) .",
    "note that in equation ( [ eq : pca_d_pvp ] ) the exact variance  covariance matrix should be normalized by @xmath13 but since we are solely interested in the diagonalization of @xmath25 , we drop it .     can be seen as an orthogonal coordinate transformation from @xmath46 to @xmath47 such that the data set variance is maximized along the vector @xmath48 and @xmath49 .",
    "note that , for a didactical purpose , we chose @xmath20 to be a rotation matrix but practically it can be any orthogonal matrix . ]",
    "as already mentioned in section [ sec : intro ] , the current methods efficiently dealing with the problem of weighting pca @xcite aim at best explaining the whole data set variance according to a given number of principal components , which is equivalent to minimize @xmath50_{ij } \\right)^2,\\ ] ] where the weighted mean observation we subtracted ( cf . section [ sec : notation ] ) is given by @xmath51 we notice that equation ( [ eq : wpca_x_pc ] ) has latent variables such that it has to rely on an iterative procedure to be solved .",
    "the em algorithm is a statistical tool specifically designed to optimize a likelihood function for models having latent  or unknown / hidden  variables @xcite .",
    "this iterative procedure is composed of two steps .    1 .   e - step : find the expectation value of the latent variables given the parameters of the current model .",
    "m - step : find the parameters of the model such that the likelihood function is optimized .",
    "based on the latter , @xcite has developed a fast and straightforward classical pca algorithm for which the conditions in equations ( [ eq : pca_x_pc ] ) , ( [ eq : pca_d_pvp ] ) and ( [ eq : pca_d_ordered ] ) are all fulfilled . regarding weighted pca and more specifically the @xmath52 described by equation ( [ eq : wpca_x_pc ] ) , we will have the following weighted expected maximization pca ( wempca ) algorithm :    @xmath53 random orthogonal matrix    while @xmath20 and @xmath23 have not converged    _",
    "( e - step ) _",
    "find @xmath23 that minimizes @xmath52 given @xmath20 .    _",
    "( m - step ) _",
    "find @xmath20 that minimizes @xmath52 given @xmath23 .",
    "note that the convergence criterion is still relative .",
    "it can be based on the @xmath52  or the change in the principal components @xmath54  falling under a given threshold , the fact that the algorithm has reached a given number of iterations or whatever criterion we consider as relevant .",
    "@xcite designed a general approach to the modelling and dimensionality reduction of the sdss spectra called ` heteroskedastic matrix factorization ' .",
    "more specifically , it attempts to minimize @xmath55 ^ 2,\\ ] ] subject to @xmath56 we recognize the first part of equation ( [ eq : tslamantza_chi2 ] ) as being equation ( [ eq : wpca_x_pc ] ) while the second part is a smoothing regularization term whose scalar @xmath57 defines the strength .",
    "non - negativity constraints reflect a particular need to have a meaningful physical interpretation of the resulting spectra .    regarding the fact that we would like to model the widest variety of data sets , we will drop the non - negativity constraints that otherwise would have restricted our search space . concerning the smoothing regularization factor",
    ", we have to note that it will be highly problem - dependent and that it can be tricky to optimize , this will result in a potential unfair comparison with other methods",
    ". we will then consider the case @xmath58 .",
    "moreover , as we will see in section [ sec : discussion_smoothing ] , our method can deal with principal components smoothing as well , consequently ignoring it will not constitute a major drawback to our implementation .    the resulting function to optimize",
    "will then be reduced to the sole equation ( [ eq : wpca_x_pc ] ) . nevertheless , and before going further",
    ", we have to note that minimizing equation ( [ eq : wpca_x_pc ] ) will provide us a lower - rank matrix approximation of @xmath4 but it is not a sufficient condition for the resulting matrices @xmath20 and @xmath23 to be considered as a pca decomposition . according to @xcite , the solution to this problem can be solved in two steps .",
    "first consider a lower - rank matrix decomposition of @xmath4 , similar to the one produced by the solution of equation ( [ eq : wpca_x_pc ] ) , @xmath59 where for clarity , the sizes of these matrices are @xmath60 and @xmath61 .",
    "now suppose an orthogonal basis @xmath62 of @xmath28 ; such an orthogonal basis always exists for full - rank matrices and can be retrieved through a straightforward gram ",
    "schmidt process for example .",
    "the associated coefficients matrix @xmath63 is then directly retrieved by @xmath64    secondly , in a way similar to equation ( [ eq : pca_cc_d ] ) , we will take the classical pca decomposition of @xmath63 , @xmath65 such that @xmath66 is diagonal .",
    "the resulting principal coefficient matrix will then be given by @xmath67 that will be orthogonal and that will provide us with the final decomposition @xmath68    the above - mentioned steps have thus to be performed after the em algorithm minimizing equation ( [ eq : wpca_x_pc ] ) in order for @xmath20 to be orthogonal and for the covariance matrix @xmath69 to be diagonal . sections [ sec : wempca_tsalmantza_estep ] and [ sec : wempca_tsalmantza_mstep ] will now focus on details of the em algorithm .",
    "as stated at the beginning of this section , the expectation step regarding wempca will be given by the retrieval of the coefficient matrix @xmath23 that minimizes equation ( [ eq : wpca_x_pc ] )  or equivalently that optimizes equation ( [ eq : wempca_x_pc ] )  while considering the principal component matrix @xmath20 being held fixed . since each observation",
    " column of @xmath4  is a linear combination of the principal components , finding the solution of equation ( [ eq : wempca_x_pc ] ) is equivalent to solving @xmath70 whose solutions are given by the ` normal equations ' : ) . ]",
    "@xmath71 with @xmath72 .      similarly to the e - step ,",
    "solution to the m - step  that is the retrieval of @xmath20 that optimizes equation ( [ eq : wempca_x_pc ] ) given @xmath23  can be decomposed by noting that within each observation , a given variable is the linear combination of the corresponding principal components variables .",
    "that is , @xmath73 whose solutions are @xmath74 with @xmath75 .",
    "as we have seen in section [ sec : tsalmantza ] , the implementation of @xcite focuses on the solution of equation ( [ eq : wpca_x_pc ] ) while the pca decomposition can be seen as a supplemental step that is external to the em algorithm .",
    "moreover , a single iteration of the algorithm requires the solution of @xmath76 systems of linear equations , each of size ( @xmath77 ) , at each iteration of the em algorithm .",
    "this becomes quickly unmanageable regarding huge data sets .",
    "@xcite takes the pragmatic approach that the sole solution of equation ( [ eq : wpca_x_pc ] ) can lead to good insights about the principal components if the latter were fitted individually .",
    "this hypothesis is reasonable since this will allow each individual principal component to maximize the variance it accounts for .",
    "the resulting implementation will be similar to the one of @xcite apart from the optimization function of the m - step .",
    "indeed , in order for the principal components to be fitted separately , we have to consider the cross - product decomposition of equation ( [ eq : wempca_x_pc ] ) , that is @xmath78 from which each @xmath37 has to be individually fitted .",
    "suppose that we already retrieved the @xmath79 first principal components .",
    "let us also assume that the data projection along these @xmath79 principal components was already subtracted from the data set , that is @xmath80    then the retrieval of @xmath37 based on equation ( [ eq : wempca_bailey_mstep ] ) can be decomposed in a way similar to equation ( [ eq : wempca_tsalmantza_mstep_objective ] ) as @xmath81 whose solution is straightly given by @xmath82 with @xmath75 .",
    "equation ( [ eq : wempca_bailey_proj_removal ] ) theoretically ensures that the last - retrieved component , @xmath37 will be orthogonal to any previous one .",
    "nevertheless , due to machine round - off errors , this has to be manually checked .",
    "finally , we have to note that solving equation ( [ eq : wempca_bailey_mstep ] ) will not minimize the global @xmath52  as defined by equation ( [ eq : wpca_x_pc ] )  such that the algorithm has to rely on a last e - step at the end of the main em algorithm .",
    "though both mentioned algorithms @xcite correctly find lower - rank orthogonal decompositions that are suitable to explain the whole data set variance at best , none of them assures us that the retrieved principal components will be those that maximize the individual variance described by each of them .",
    "these principal components are then efficient at reconstructing the initial data set but are not the best at individually describing the underlying data structure .",
    "the basic idea of this new algorithm is to focus on the maximization of the weighted variance explained by each principal component through the diagonalization of the associated weighted covariance matrix .",
    "the resulting principal components will then be those that are the most significant  under the assumption that the definition of the used weighted variance is relevant  in identifying pattern within the data set even if their linear combination is not necessarily the best at explaining the total data set variance as described by equation ( [ eq : wpca_x_pc ] ) .    in the following",
    ", we will consider that the weighted variance of a given discrete variable @xmath1 having weights @xmath83 is given by @xmath84 where @xmath85 and with the convention that @xmath86 .",
    "the latter can be straightforwardly extended to the definition of the weighted covariance between two discrete variables , @xmath1 and @xmath87 , for which the weights are given by @xmath88 and @xmath89 respectively , that is @xmath90    based on these definitions , we can write the weighted covariance matrix of a data set @xmath4 with associated weights @xmath19 as @xmath91    we know , from the spectral theorem , that there exists an orthogonal matrix @xmath20 such that @xmath25 is diagonalized , and consequently that equation ( [ eq : pca_d_pvp ] ) is fulfilled ( as well as equation [ eq : pca_d_ordered ] if @xmath20 is ordered accordingly ) .",
    "this matrix @xmath20 will then constitute the principal components of our implementation .",
    "and classical principal components @xmath92 in presence of underweighted observations corresponding to the brighter points .",
    "@xmath93 and @xmath94 correspond to the variances respectively explained by @xmath48 and @xmath49 . ]",
    "[ fig : wpca_diff ] shows a two - dimensional example of classical principal components @xmath92 that are unable to individually describe the underlying data variance . in this example , we have supposed  for didactical purpose  that the observations corresponding to the bright points have far lower weights associated with the @xmath95 variable .",
    "weighted principal components , @xmath20 , diagonalizing @xmath25 as described by equation ( [ eq : covar_mat_new ] ) are given along with the variance it explains ( that is the diagonal elements of @xmath96 ) .",
    "note that such principal components maximize the variance explained by each variable as described by equation ( [ eq : var_new ] ) and consequently set to zero the associated covariance as described by equation ( [ eq : covar_new ] ) .",
    "the goal of the algorithm is then to retrieve the dominant eigenvector @xmath97 from the covariance matrix @xmath25 along with its associated eigenvalue @xmath98 , that is the dominant eigenpair @xmath99 .",
    "@xmath97 will then be the principal component explaining most of the data set variance , @xmath98 .",
    "that is equivalent to find @xmath97 in @xmath100 such that @xmath98 is maximized is also solution of equation ( [ eq : eigenvector ] ) but for the sake of clarity , we will only consider the case of positive eigenvalues ]",
    ".    equation ( [ eq : eigenvector ] ) , corresponding to the eigenvector definition , is a well - studied problem for which many methods already exist .",
    "the reference in the domain is @xcite where the interested reader may find a rather exhaustive list of such methods as well as proofs of the algorithms described hereafter .",
    "unsurprisingly , in the context or our implementation , we choose the fastest and simplest algorithm called the power iteration method .",
    "the idea behind this algorithm is to recognize that given a diagonalizable square matrix @xmath28 and a vector @xmath101 having a nonzero component in the direction of @xmath97 , the iterative relation @xmath102 will converge to a vector that is proportional to the dominant eigenvector @xmath97 as @xmath103 .",
    "note that in practice , each vector @xmath104 is normalized to unity in order to avoid numerical round - off errors inherent to the computer representation of large numbers .",
    "the final eigenvector will then be given by @xmath105 and the associated eigenvalue by the rayleigh quotient : @xmath106 convergence and assumptions made about this algorithm will be discussed in section [ sec : discussion_convergence ] .",
    "further principal components can be retrieved by considering application of the above - mentioned algorithm to @xmath107 that is the matrix obtained by subtracting the data variance along the found principal components .",
    "as we will see in section [ sec : discussion_convergence ] , the power iteration method may have a slow convergence rate under some particular conditions .",
    "consequently it may be that some vectors did not effectively converge to an eigenvector that would have diagonalized the covariance matrix .",
    "nevertheless , @xcite proposed an algorithm  called rayleigh quotient iteration  designed to tackle this kind of problem . even if the proof of this algorithm is beyond the scope of this paper , we still mention two basic facts to enable the reader to have a minimal understanding of how it works",
    "first , as we have seen in equation ( [ eq : rayleigh_quotient ] ) , the rayleigh quotient of a matrix with one of its eigenvector is equal to its associated eigenvalue . secondly , given a matrix @xmath28 with eigenvalues @xmath108",
    ", we find that the eigenvalues of the matrix @xmath109 will be @xmath110 .",
    "based upon these facts , we will have that the sequence @xmath111 where each @xmath104 is normalized to the unit length , will converge cubically to the eigenpair @xmath99 that is the nearest  regarding the absolute value of their rayleigh quotient  from a starting point @xmath112 as @xmath103 .",
    "note that equation ( [ eq : rayleigh_iter_power ] ) is a power iteration towards the eigenvector for which @xmath113 is minimized .",
    "finally , the principal coefficients are retrieved by solving @xmath114 whose ` normal equation ' solution is given by equation ( [ eq : wempca_e_step ] ) .",
    "real - world data often have sparse and unevenly distributed weights such that it may happen for some variables to have their corresponding variances to be based only on a small number of observations .",
    "such situations may become problematic since these few variables will have a strong impact on the resulting first principal components in a way that is irrespective to their total weight .",
    "such ` overweighted ' variables can be damped by using a regularization factor within the expression of the weighted covariance , @xmath115 , as defined by equation ( [ eq : covar_new ] ) .",
    "the resulting regularized weighted covariance will take the form @xmath116^{\\xi } { \\sigma_{{\\bmath{x}},{\\bmath{y}}}^2},\\ ] ] where the regularization parameter @xmath117 allows us to control the damping strength .",
    "the typical value of the regularization parameter , @xmath117 , goes from zero , where we get back to the classical behaviour of the algorithm , to two for a strong damping of these rare variables .",
    "conversely one might want to highlight such underrepresented variables by setting the regularization parameter to a negative value .",
    "the performance of the method described in this paper was assessed regarding the two previously described algorithms , namely the one of @xcite and the one of @xcite .",
    "the choice of these algorithms comes from the fact that they are fairly competitive and have goals that are comparable to those of the new algorithm .",
    "all methods were tested on both simulated data as well as on real observational ones .",
    "simulated data consist in random linear combinations of 10 orthogonal basis functions .",
    "these bases are produced by taking 10 shifted sine functions having periods between @xmath118 and @xmath119 and by applying a gram ",
    "schmidt orthogonalization process to the latter .",
    "resulting observations are then sampled over 100 evenly spaced points in the interval @xmath120 $ ] .",
    "to each variable , @xmath95 , within each observation , @xmath1 , we also add a gaussian noise having a standard deviation given by @xmath121 where @xmath122 is a user - provided parameter corresponding to the desired noise amplitude , @xmath123 is an observation - specific noise ponderation uniformly drawn from @xmath124 $ ] and @xmath125 is a uniform random variable corresponding to the noise dispersion within observations and taking values in the range @xmath124 $ ] . the weight associated with the variable @xmath95",
    "will then be set to @xmath126 .",
    "finally , we discard @xmath127 contiguous and randomly positioned variables from each observation .",
    "the latter will be used to assess performances of the various algorithms on data extrapolation while having their weights equal to zero during the pca retrieval phase .",
    "examples of such simulated data are illustrated in fig .",
    "[ fig : comparison_example ] .     and @xmath127 .",
    "]    in order to perform the comparison with other algorithms , we built a given number of data sets , @xmath128 , each containing 1000 observations .",
    "each of these sets was duplicated and altered through the realization of various values of the simulation parameters @xmath122 and @xmath127 .",
    "we then retrieved , for each of the mentioned algorithms , the five first principal components out of the resulting altered data sets and computed estimators based on the following @xmath52 definition : @xmath129_{ij}^2}{\\sum_{ij } { \\bmath{\\mathsf{w}}}_{ij}^ 2}}.\\ ] ] the following estimators were computed : @xmath130 , the chi - square of the data set for which weights associated with the discarded variables are set to zero and @xmath131 where only rejected variables are considered and for which weights associated with the unrejected variables are set to zero .",
    "let us note that @xmath130 will typically account for the quality of the fit while @xmath131 will account for the quality of the extrapolation .",
    "if these estimators are to be computed based on the number of data set , @xmath128 , we use a @xmath132-clipped mean over all the @xmath130 and @xmath131 associated with each data set , namely @xmath133 and @xmath134 .    for completeness",
    ", only data sets having @xmath135 will be discussed here .",
    "this decision comes from the fact that efficiently estimating the principal components of such sparse data sets while having ` only ' 1000 observations is a really tricky task strongly depending on the design of these data sets .",
    "furthermore , as we will see in section [ sec : scaling_performance ] , the bailey and tsalmantza algorithms are big time consumers such that dealing with bigger data sets quickly becomes unmanageable .",
    "since all the studied algorithms are based on iterative procedures , we have to take into account the convergence criterion for each of them .",
    "to this aim , we performed a preliminary study whose goal is to determine the minimal number of iterations needed by each algorithm in order to reach convergence .",
    "this was assessed by running 100 times each algorithm on data sets similar to those previously described and by setting the initial eigenvectors estimates to random values within each run . in order to make sure we can model unseen and potentially more complex data sets , the number of iterations was set to twice the found number of iterations needed to converge , giving respectively @xmath136 , @xmath136 and @xmath137 iterations for bailey , tsalmantza and our algorithm ( without refinement ) .     for increasing noise without missing data ( top ) .",
    "subtraction of bailey and tsalmantza @xmath130 from our algorithm @xmath130 ( middle ) . averaged @xmath130 with moderate noise and an increasing number of missing data ( bottom ) . ]    regarding the quality of the fit , @xmath130 , differences between the various algorithms are fairly low even if  as expected  our algorithm is proven to have somewhat larger @xmath130 with a higher dispersion over all the data sets .",
    "[ fig : comparison_chi2_fit ] shows the behaviour of the mean @xmath130 regarding two common cases , namely the case of increasing noise and no missing data and the case of moderate noise ( @xmath138 ) with increasing number of missing data . each point on these graphs is averaged over @xmath139 data sets .",
    "practically , one can not distinguish the various algorithms if all data are present since differences are in @xmath140 .",
    "in presence of missing data , differences start to be noticeable but still reasonable with differences in @xmath141 . for a didactical purpose ,",
    "let us note that if only the first component  out of the five retrieved  was considered then our algorithm would have had a better or equal @xmath130 than bailey and tsalmantza implementations over all the values of the simulation parameters @xmath122 and @xmath127 .",
    "maps of averaged @xmath131 regarding @xmath122 and @xmath127 simulation parameters . ]     for moderate noise with an increasing number of missing data . ]    regarding now the quality of the extrapolation , differences are more noticeable .",
    "[ fig : comparison_chi2_test_map ] illustrates these discrepancies according to the averaged @xmath131 over @xmath142 data sets having reasonable @xmath130 in each of the @xmath122 and @xmath127 simulation parameters . at first glance ,",
    "our new algorithm shows a globally better @xmath134 while suffering less from missing data : the latter being dominated by noise within the data . the tsalmantza s algorithm shows good performances but has a stronger dependence on missing data , reaching a maximum @xmath143 while bailey s algorithm shows strong numerical instabilities for @xmath144 that makes it unable to converge and makes it reach a maximum @xmath145 for @xmath146 and @xmath147 .",
    "[ fig : comparison_chi2_test ] illustrates in more detail the behaviour of @xmath134 averaged over @xmath139 data sets in the common case of moderate noise ( @xmath138 ) with an increasing number of missing data . for clarity , the plot of bailey having @xmath144 has been removed from the graph .",
    "finally , let us note that data sets having @xmath148 and @xmath149 can be solved using a classical pca algorithm .",
    "consequently , both the variance explained by each individual component and the total variance can be simultaneously optimized . we will thus find  in this particular case  that all algorithms will provide us with identical results as it was already suggested in fig .",
    "[ fig : comparison_chi2_fit ] .",
    "similarly , if we choose to retrieve a single component , even with noisy and/or missing data , the algorithms of bailey and tsalmantza will maximize the variance explained by this component , the latter will thus match the first component that would have been retrieved by our algorithm .",
    "comparisons against a concrete case were performed using the sdss dr10q quasar catalog from @xcite . out of the 166 583 qso spectra present in the initial data release ,",
    "18 533 were rejected either due to spectra bad quality , strong uncertainties in redshift determination , presence of bal or insufficient number of high - s / n points .",
    "the remaining spectra were set to the rest frame ; the continuum was then subtracted and the spectra were normalized such as to have a zero mean and a variance of 1 .",
    "finally , visual inspection showed that in some cases the continuum was badly fitted such that the variance within these spectra can mainly be attributed to this error ; these regions were removed using a _ k_-sigma clipping algorithm for each variable among all observations .",
    "there remain 148 050 spectra having observed wavelengths between 4000 and 10 000 and for which the variance within each spectrum is thought to be mainly caused by genuine signals . in the following tests , the 10 first components will be retrieved from each algorithm .",
    "we also suppose , as previously , that @xmath150 .",
    "the number of iterations associated with each algorithm was assessed by using a subset of the above - described data set ( 1000 @xmath151 2000 , @xmath152 ) and by running 10 times the various algorithms on it with random initial principal components .",
    "convergence was assessed by minimizing the variance amongst the final principal components within these 10 runs .",
    "the fact that only a subset of the above - described data set was used can be explained by the large amount of time needed by each algorithm to run as well as by the fact that  as we will see  tsalmantza and bailey algorithms often fail to converge in presence of a large amount of missing data .",
    "the results show that the number of iterations chosen in section [ sec : comparison_simulated ] also match the complexity of this problem .",
    "the initial test to be performed is similar to tests performed in section [ sec : comparison_simulated ] in the sense that pca were retrieved for all algorithms using the region 50009000 in observed wavelength while regions 40005000 and 900010 000 are rejected and kept to assess the quality of the extrapolation .",
    "[ fig : comparison_sdss_spec ] shows an example of such a spectrum along with the fits by the various algorithms .",
    "the resulting sdss dr10q data set @xmath130 and @xmath131 , as defined by equation ( [ eq : data set_chisq ] ) , are given in table [ tbl : sdss_data set_chi2 ] .    .sdss",
    "dr10q data set fit and extrapolation chi - squares followed by per - observation median chi - squares of extrapolation and associated ratio of outliers . [ cols=\"<,^,^,^\",options=\"header \" , ]     .",
    "right - hand part represents the number of qsos ( @xmath153 ) having @xmath154 .",
    "]    we see that @xmath130 is quite stable for all the algorithms while being a bit higher for our algorithm as expected . now watching at the extreme differences of @xmath131 for the various algorithms and given the fact that we know it to be an estimator that is quite sensitive to outliers , we found relevant to see how these discrepancies are distributed among the observations . to this aim , we computed a @xmath131 per - observation whose distribution is summarized in fig . [",
    "fig : comparison_sdss_detail ] .    given the significant number of observations used in this test , we can already draw some general trends .",
    "beside the fact that the other algorithms have a better @xmath130 , they often fail to satisfactorily extrapolate the spectra .",
    "indeed , for the bailey algorithm , @xmath155 of observations have @xmath154 with a peak up to @xmath156 ( median=@xmath157 ) ; the tsalmantza algorithm has respectively @xmath158 of observations having @xmath154 and a peak up to @xmath159 ( median=@xmath160 ) while our new algorithm has only @xmath161 of ` outliers ' with a maximal peak of @xmath162 ( median=@xmath163 ) .",
    "if the observations are individually compared , our algorithm has a lower @xmath131 in @xmath164 of the time regarding bailey algorithm and @xmath165 of the time regarding tsalmantza algorithm while in other cases differences remain quite moderate with a median @xmath166 . for completeness",
    ", we have to note that these huge discrepancies can be mainly attributed to the large amount of missing data ( @xmath167 ) within the resulting rest - frame dr10q data set .",
    "another quality one would often desire is the ability to have the most general and representative set of principal components able to model unseen observations . in this optic",
    ", two tests were performed .",
    "first , we split the initial dr10q data set into two subsamples each of 74 025 spectra spanning from 4000 to 10 000 ( hereafter ls1 and ls2 ) . from each of these subsamples , we extract @xmath1688600 spectra for which the rest - frame region from 1000 to 2000 is entirely covered  and consequently ` without ' missing data  and @xmath16862 000 spectra for which the mentioned region is only partially covered  and thus ` with ' missing data .",
    "note that according to the selected observed wavelengths and the previous definitions , spectra without missing data will correspond to those having @xmath152 and spectra with missing data to those having @xmath169 .",
    "the consistency and convergence of each algorithm were then tested by retrieving 10 principal components out of ls1 and ls2 data sets taken with and without missing data . prior to discussing the results",
    ", we have to mention that the components may be swapped from data sets with missing data to the corresponding ones without missing data .",
    "this is easily explained by the fact that some patterns may be highlighted due to the uneven coverage of the wavelength range while being damped in the total variance if a full coverage is considered",
    "[ fig : comparison_ls1_ls2 ] illustrates the results of this test regarding the first component of the data set without missing data and associated component with missing data .",
    "we see that in absence of missing data , all algorithms are consistent and succeed in converging towards the dominant eigenvector while in the case of missing data only our algorithm shows both a good consistency and a good convergence .",
    "more precisely , regarding our algorithm , the mean differences per - point between ls1 and ls2 are in @xmath140 for both subsets with and without missing data .",
    "differences noticed between subsets , that is mainly the general larger equivalent width and the stronger n@xmath170@xmath981240 emission line of the subset with missing data , are consistent with the underlying data set and make it able to model the larger variety of spectra coming from the larger redshift range .",
    "let us mention , that no significant inconsistencies have been noticed up to the sixth component for ls1 and ls2 on both subsets for our algorithm .",
    "concerning the bailey s algorithm , we see , as already suggested in section [ sec : comparison_simulated ] , that it fails to converge if a large amount of data is missing .",
    "tsalmantza s implementation shows a better convergence but fails to correctly reproduce some emission lines ( o@xmath170@xmath981033 , n@xmath170@xmath981240 , c@xmath170@xmath981549 and c@xmath170@xmath981908 ) as well as the region @xmath1711200 in subsets with missing data . similarly to bailey s algorithm , analysis show that these are due to a convergence problem occurring on sparse data sets and arising from numerical instabilities .",
    "in the second test performed , 10 principal components were retrieved from a set of 98 700 spectra spanning from 4000 to 10 000 ( hereafter ls3 ) .",
    "we tested the fact that the principal components are the best at individually describing the underlying data variance by fitting the remaining 49 350 spectra ( hereafter vs ) using a subset of five components retrieved from ls3 .",
    "that is , if the variance explained by each individual component is maximized then the fit of a smaller number of components to a similar data set should be minimal . in this case , if we consider computing @xmath52 of vs data set as defined by equation ( [ eq : data set_chisq ] ) for each of the algorithms , we have respectively @xmath172 for the bailey algorithm , @xmath173 for the tsalmantza algorithm and @xmath174 for our algorithm , thus supporting our last quality criterion .",
    "note again that if all components were considered , bailey and tsalmantza algorithms would have had a better resulting @xmath52 .",
    "at first glance it is surprising that the power iteration algorithm works at all , but in practice , it is easily demonstrated . consider a diagonalizable square matrix @xmath28 of size ( @xmath175 ) having eigenvectors @xmath176 and associated eigenvalues @xmath108 where @xmath177 . since the eigenvectors are orthogonal between each other , we can write the starting vector of the power iteration algorithm as @xmath178 then we will have that the vector at iteration @xmath179 given by @xmath180.\\end{aligned}\\ ] ] we see that @xmath181 will converge to @xmath182 as @xmath103 under the following conditions : @xmath183 , i.e. the starting vector has a nonzero component in the direction of the dominant eigenvector and @xmath184 , i.e. the data set has only one dominant eigenvalue .",
    "also note that , in this case , the rate of convergence to the dominant eigenvector will be principally given by @xmath185 and that in the case of @xmath186 , the uniqueness of the solution is not guaranteed as it depends on the starting vector @xmath187 .",
    "refinement seen in section [ sec : wpca_new_refinement ] obeys to the same conditions .",
    "additionally , the dominant eigenvalue of @xmath188 will tend to @xmath189 as @xmath190 , where @xmath28 is the covariance matrix , @xmath191 the current ` eigenvalue ' ( i.e. the rayleigh quotient of @xmath28 and @xmath192 , the current ` eigenvector ' ) and @xmath98 a real eigenvalue of @xmath28 .",
    "this may thus lead to numerical instabilities that can strongly deteriorate the vector used in the next step of the rayleigh quotient iteration .",
    "that being said , failures against convergence can be easily checked .",
    "for example , a satisfactory solution should have @xmath193 ; and if not , the power iteration algorithm can be resumed with another starting vector @xmath187 . under the condition that we have @xmath186 , we will have an infinite number of eigenvectors that are equally good at describing the data set variance , thus choosing one over another is irrelevant . concretely , during the @xmath168100 000 tests performed in the context of this paper , no such problems arose .",
    "checks performed on eigenvectors from section [ sec : comparison_simulated ] and [ sec : comparison_observation ] show that the latter are orthogonal to a machine precision of @xmath194 and that the weighted covariance matrix ( as described by equation [ eq : covar_mat_new ] ) is diagonalized with the same precision .",
    "nevertheless , people wanting extreme reproducibility and/or secure convergence may still use the svd in order to extract all eigenvectors from equation ( [ eq : covar_mat_new ] ) at the expense of a lower flexibility ( see sections [ sec : discussion_apriori ] and [ sec : discussion_smoothing ] ) .",
    "in some situations , one may already have an approximation of the wanted principal components corresponding to a given data set .",
    "typical examples include principal components update according to new observations added to the data set or in a real case we encountered , the use of sdss dr9q eigenvectors to the dr10q data set .",
    "these will constitute a priori eigenvectors that it would be regrettable not to use .",
    "the design of our algorithm allows us to easily take benefits of these a priori vectors . instead of using a random vector , @xmath101 , in equation ( [ eq : power_iteration ] ) one can straightforwardly substitute the known vectors to the random starting vector",
    "usually used .",
    "doing so will typically decrease the number of iterations needed to converge towards the new vectors . beware that vectors may be swapped between a priori eigenvectors and effective data set eigenvectors  as encountered in section [ sec : comparison_observation ]  and consequently iterations needed to converge will be the same as if we had used a random starting vector . in this case",
    ", one can perform no power iteration and use only the refinement seen in section [ sec : wpca_new_refinement ] in order to converge to the nearest eigenvector .",
    "it sometimes happens for some variables within eigenvectors to exhibit some sharp features that we know to be artefacts .",
    "these occur mainly in cases where we have noise that is comparable in amplitude to the data variance , data regions covered only by a few numbers of observations or data sets containing corrupted observations . again",
    "the flexibility of our algorithm allows us to efficiently deal with these drawbacks .",
    "suppose that we retrieved such a ` noisy ' eigenpair @xmath99 from a given data set whose covariance matrix is given by @xmath28 , then , before removing the variance in the direction of the found component through equation ( [ eq : rayleigh_subtract ] ) , one can filter @xmath97 thanks to any existing smoothing function .",
    "assuming that the resulting vector , @xmath195 , is near @xmath97 regarding the norm of their difference , we can suppose that the variance accounted for by @xmath195 ( i.e. its ` eigenvalue ' ) is similar to the one of @xmath97 and then subtract it along the direction of @xmath195 by    @xmath196    note that the kind of smoothing function to use is highly data - dependent and no rule of thumb exists .",
    "nevertheless , a quite general and commonly used filter producing efficient results in the field of qsos can be found in @xcite . finally , let us note that , when applying a filter , the orthogonality of the components has to be manually checked and that they will obviously not diagonalize the covariance matrix anymore .",
    "pca is often used in cases where we have a lot of observations and a reasonable number of variables , typically we have @xmath197 . we know , for example , the classical algorithm to require @xmath198 basic operations in order to solve for the eigenvectors of the covariance matrix and @xmath199 operations to build this matrix . in the following",
    ", we will compute the algorithmic complexity of the various explored algorithms in a similar way .",
    "the tsalmantza algorithm requires for each iteration ( hereafter @xmath200 ) the solution of linear systems of equations for each of the e and m - step , respectively , in each observation and in each variable .",
    "we will then have that its algorithmic complexity is given by @xmath201 .",
    "the bailey algorithm will be identical except for the m - step that will be in @xmath202 and can thus be discarded , giving @xmath203 .",
    "finally , our algorithm mainly requires the building of the covariance matrix , @xmath200 matrix multiplications , potentially @xmath204 matrix inversions in order to refine the eigenvectors and a final single e - step similar to the one for the previous algorithm ( discarded here ) , thus giving @xmath205 .",
    "we see that in case @xmath197 , our algorithm is much faster than the other ones as the computing time is mainly spent in the covariance matrix building . as an illustration , if we take data similar to those described in section [ sec : comparison_simulated ] with @xmath206 10 000 , pca retrieval takes @xmath207s for the bailey and tsalmantza algorithms ( with @xmath208 ) and @xmath209s for the new one ( with @xmath21010 000 ) on a 2.4ghz cpu .",
    "we presented a new method for computing principal components based on data sets having noisy and/or missing data .",
    "the underlying ideas are intuitive and lead to a fast and flexible algorithm that is a generalization of the classical pca algorithm .",
    "unlike existing methods , based on lower - rank matrix approximations , the resulting principal components are not those that aim to explain at best the whole variance of a given data set but rather those that are the most suitable in identifying the most significant patterns out of the data set while explaining most of its variance .",
    "the main benefits of the current implementation are a better behaviour in presence of missing data as well as faster run times on data set having a large amount of observations .",
    "privileged problems encompass data set extrapolation , patterns analysis and principal component usage over similar data sets .",
    "we assessed the algorithm performance on simulated data as well as on qso spectra to which many applications are already foreseen in the field of the _ gaia _ mission .",
    "the author acknowledges support from the esa prodex programme ` gaia - dpac qsos ' and from the belgian federal science policy office .",
    "funding for sdss - iii has been provided by the alfred p. sloan foundation , the participating institutions , the national science foundation and the u.s .",
    "department of energy office of science .",
    "the sdss - iii web site is http://www.sdss3.org/.    sdss - iii is managed by the astrophysical research consortium for the participating institutions of the sdss - iii collaboration including the university of arizona , the brazilian participation group , brookhaven national laboratory , carnegie mellon university , university of florida , the french participation group , the german participation group , harvard university , the instituto de astrofisica de canarias , the michigan state / notre dame / jina participation group , johns hopkins university , lawrence berkeley national laboratory , max planck institute for astrophysics , max planck institute for extraterrestrial physics , new mexico state university , new york university , ohio state university , pennsylvania state university , university of portsmouth , princeton university , the spanish participation group , university of tokyo , university of utah , vanderbilt university , university of virginia , university of washington and yale university .",
    "bailer - jones c.a.l .",
    "et al . , 2013 ,",
    "a&a , 559 , a74 bailey s. , 2012 , pasp , 124 , 1015 beale e. m. l. , little r. j. a. , 1975 , j. r. stat .",
    "b , 37 , 129 dempster a. p. , laird , n. m. , rubin d. b. , 1977 , j. r. statist .",
    "b , 39 , 1 gabriel k.r . ,",
    "zamir s. , 1979 , technometrics , 21 , 489 golub g.h . , van loan c.f . , 1996 , matrix computations , 3rd edn .",
    "the johns hopkins univ . press ,",
    "london greenacre m.j . , 1984 ,",
    "theory and applications of correspondence analysis . academic press , london hotelling h. , 1933 , j. educ .",
    "psychol . , 24 , 417 jarvis m. , jain b. , 2004 , preprint(astro - ph/0412234 ) jolliffe i.t . , 2002 , principal component analysis , 2nd edn .",
    "springer , new york pris i. et al .",
    ", 2014 , a&a , 563 , a54 parlett b.n . , 1974 , math .",
    "comput . , 28 , 679 pearson k. , 1901 , phil . mag . , 2",
    ", 559 press w.h . , tuekolsky s.a .",
    ", vetterling w.t . ,",
    "flannery b.p . , 2002 , numerical recipes in c++ : the art of scientific computing , 2nd edn .",
    "cambridge univ .",
    "press , new york roweis s. , 1997 , cns technical report cns - tr-97 - 02 , em algorithm for pca and spca .",
    "available at : http://cs.nyu.edu/~roweis/papers/empca.pdf savitzky a. , golay m.j.e .",
    ", 1964 , anal .",
    ", 36 , 1627 schlens j. , 2009 , a tutorial on principal component analysis .",
    "available at : http://www.snl.salk.edu/~shlens/pca.pdf srebro n. , jaakkola t. , 2003 , proc .",
    "20th icml , weighted low rank approximation , aaai press , menlo park , p. 720",
    "tipping m.e . ,",
    "bishop c.m . , 1999 ,",
    "j. r. stat .",
    "b , 21 , 611 tsalmantza p. , hogg d.w .",
    ", 2012 , apj , 753 , 122 wentzell p.d . ,",
    "andrews d.t . ,",
    "hamilton d.c . , faber k. , kowalski b.r . , 1997 , j. chemometr . , 11 , 339 yip c.w .",
    "et al . , 2004 ,",
    "aj , 128 , 2603",
    ".... %    function designed to find the weighted pca of a % given data set such that the resulting principal % components diagonalize the associated weighted   % covariance matrix and that the associated principal % coefficients are the linear coefficients of these % principal components that best match the data set % in a least - squares sense .",
    "% % input : %    x        : data set matrix from which the weighted %              mean was already subtracted .",
    "rows %              correspond to variables , columns to %              observations .",
    "%    w        : weight matrix ( same size as x ) .",
    "%    ncomp    : number of principal components to %              retrieve .",
    "%    niter    : number of iterations ( allows   %              convergence to the dominant principal %              component ) %    nrefine : number of refinments ( allows refinement %              of the dominant principal component ) %    xi       : regularization factor controlling the %              influence of rare variables % output : %    p        : principal components arranged in columns %    c        : principal coefficients such that x = p*c %              in a least - squares sense % author : %    ludovic delchambre %    extragalactic astrophysics and space observations , %    institute of astrophysics and geophysics , %    university of liege , belgium function [ p , c ] = wpca(x , w , ncomp , niter , nrefine , xi )    nvar = size(x,1 ) ; nobs = size(x,2 ) ;    p = zeros(nvar , ncomp);c = zeros(ncomp , nobs ) ;    ws = sum(w,2 ) ;    covar = ( ( ws * ws').^xi).*((x.*w)*(x.*w)')./(w*w ' ) ;    covar(isnan(covar ) ) = 0 ;    for i=1:ncomp      u = ones(nvar,1 ) / nvar ;      for j=1:niter        u = covar*u ;        d = sqrt(u'*u ) ;        u = u / d ;      end      d = u'*covar*u ;      for j=1:nrefine        u = inv(covar - d * eye(nvar ) ) * u ;        u = u / sqrt(u'*u ) ;        d = u'*covar*u ;      end      covar = covar - u*d*u ' ;      p(:,i ) = u ;    end    for i=1:nobs      w = diag(w(:,i)).^2 ;      c(:,i ) = inv(p'*w*p ) * ( p'*w*x(:,i ) ) ;    end end ...."
  ],
  "abstract_text": [
    "<S> we present a new straightforward principal component analysis ( pca ) method based on the diagonalization of the weighted variance  covariance matrix through two spectral decomposition methods : power iteration and rayleigh quotient iteration . </S>",
    "<S> this method allows one to retrieve a given number of orthogonal principal components amongst the most meaningful ones for the case of problems with weighted and/or missing data . </S>",
    "<S> principal coefficients are then retrieved by fitting principal components to the data while providing the final decomposition . </S>",
    "<S> tests performed on real and simulated cases show that our method is optimal in the identification of the most significant patterns within data sets . </S>",
    "<S> we illustrate the usefulness of this method by assessing its quality on the extrapolation of sloan digital sky survey quasar spectra from measured wavelengths to shorter and longer wavelengths . </S>",
    "<S> our new algorithm also benefits from a fast and flexible implementation .    </S>",
    "<S> [ firstpage ]    methods : data analysis  quasars : general . </S>"
  ]
}