{
  "article_text": [
    "in recent years , the use of ontologies to access instance data has become increasingly popular @xcite .",
    "the general idea is that an ontology provides domain knowledge and an enriched vocabulary for querying , thus serving as an interface between the query and the data , and enabling the derivation of additional facts . in this emerging area , called ontology - mediated querying",
    ", it is a central research goal to identify ontology languages for which query evaluation scales to large amounts of instance data . since the size of the data typically dominates the size of the ontology and the size of the query by orders of magnitude , the central measure for such scalability is _",
    "data complexity_the complexity of query evaluation where only the data is considered to be an input , but both the query and the ontology are fixed .    in description logic ( dl )",
    ", ontologies take the form of a tbox , data is stored in an abox , and the most important classes of queries are conjunctive queries  ( cqs ) and variations thereof , such as positive existential queries ( peqs ) .",
    "a  fundamental observation regarding this setup is that , for expressive dls such as and , the complexity of query evaluation is conp - complete and thus intractable @xcite .",
    "the classical approach to avoid this problem is to replace and with less expressive dls that are ` horn ' in the sense that they can be embedded into the horn fragment of first - order ( fo ) logic .",
    "horn dls typicall admit query evaluation in , examples include a variety of logics from the @xmath4 @xcite and dl - lite families @xcite as well as horn-@xmath5 , a large fragment of with ptime query evaluation  @xcite .",
    "it may thus seem that the data complexity of query evaluation in the presence of dl ontologies is understood rather well .",
    "however , all results discussed above are on the _ level of logics _ , i.e. , traditional results about data complexity concern a class of tboxes that is defined in a syntactic way in terms of expressibility in a certain dl language , but no attempt is made to identify more structure _ inside _ these classes .",
    "such a more fine - grained study , however , seems very natural both from a theoretical and from a practical perspective ; in particular , it is well - known that ontologies which emerge in practice tend to use ` expensive ' language constructs that can result in conp - hardness of data complexity , but they typically do so in an extremely restricted and intuitively ` harmless ' way .",
    "this distinction between hard and harmless cases can not be analyzed on the level of logics .",
    "the aim of this paper is to initiate a more fine - grained study of data complexity that is _ non - uniform _ in the sense that it does not treat all tboxes formulated in the same dl in a uniform way .",
    "when taking a non - uniform perspective , there is an important choice regarding the level of granularity .",
    "first , one can analyze the complexity on the _ level of tboxes _ , quantifying over the actual query . then",
    ", query evaluation for a tbox is in if every query ( from the class under consideration ) can be evaluated in w.r.t .  and it is conp - hard if there is at least one query that is conp - hard to evaluate w.r.t .  . and second , one might take an even more fine - grained approach where the query is not quantified away and the aim is to classify the complexity _ on the level of ontology - mediated queries ( omqs ) _ , that is , combinations of a tbox and an actual query . from a practical perspective , both setups make sense ; when the actual queries are fixed at the design time of the application , one would probably prefer to work on the level of omqs whereas the level of tboxes seems more appropriate when the queries can be freely formulated at application running time . a non - uniform analysis on the level of omqs has been carried out in @xcite . in this paper , we concentrate on the level of tboxes .",
    "the ultimate goal of our approach is as follows :    _ for a fixed dl @xmath6 and query language , classify all tboxes @xmath7 in @xmath6 according to the complexity of evaluating queries from w.r.t .",
    "_    we consider the basic expressive dl , its extensions with inverse roles and with functional roles , and their union . as query languages ,",
    "we cover cqs , acyclic cqs , and peqs ( which have the same expressive power as unions of conjunctive queries , ucqs , which are thus implicitly also covered ) .",
    "it turns out that , even for @xmath1 , fully achieving the above goal is far beyond the scope of a single research paper .",
    "in fact , we show that for any of the mentioned query languages , a full classification of the complexity of - and -tboxes is essentially equivalent to a full classification of the complexity of non - uniform constraint satisfaction problems with finite templates ( csps ) .",
    "the latter is a major research programme ongoing for many years that combines complexity theory , graph theory , logic , and algebra @xcite .    in the current paper",
    ", we mainly concentrate on understanding the boundary between ptime and conp - hardness of query evaluation w.r.t .",
    "dl tboxes , mostly neglecting other relevant classes such as ac@xmath8 , logspace , and nlogspace .",
    "our main results are as follows ( they always apply to all query languages mentioned above ) .",
    "there is a ptime / conp - dichotomy for query evaluation w.r.t .",
    "@xmath0-tboxes of depth one , i.e. , tboxes in which existential and universal restrictions are not nested ; moreover , ptime query evaluation coincides with rewritability into monadic datalog ( with inequalities , to capture functional roles ) .",
    "the proof rests on interesting model - theoretic characterizations of polynomial time cq - evaluation which are discussed below .",
    "note that this is a relevant case since most tboxes from practical applications have depth one .",
    "in particular , all tboxes formulated in dl - lite and its extensions proposed in  @xcite have depth one , and the same is true for more than 80 percent of the 429 tboxes in the bioportal ontology repository .",
    "there is a ptime / conp - dichotomy for cq - evaluation w.r.t .",
    "@xmath1-tboxes if and only if feder and vardi s dichotomy conjecture for csps is true ; the same holds for @xmath2-tboxes .",
    "the proof establishes a close link between query evaluation in @xmath1 and csp .",
    "while dichotomy questions are mainly of theoretical interest , linking these two worlds is potentially very relevant also for more applied dl research .",
    "there is no ptime / conp - dichotomy for query evaluation w.r.t .  @xmath3-tboxes ( unless ptime @xmath9 np ) .",
    "this is proved by showing that , for every problem in conp , there is an @xmath3-tbox for which cq - evaluation has the same complexity ( up to polynomial time reductions ) ; it then remains to apply ladner s theorem , which guarantees the existence of np - intermediate problems .",
    "consequently , we can not expect an exhaustive classification of the complexity of query evaluation w.r.t .",
    "@xmath3-tboxes .    to prove these results ,",
    "we introduce two new notions that are of independent interest and general utility .",
    "the first one is _",
    "materializability _ of a tbox , which means that evaluating a query over an abox w.r.t .  can be reduced to query evaluation in a single model of and ( a _ materialization _ ) .",
    "note that such models play a crucial role in the context of horn dls , where they are often called canonical models or universal models . in contrast to the horn dl case , however , we only require the _ existence _ of such a model without making any assumptions about its form or construction .",
    "if an @xmath0-tbox @xmath7 is not materializable , then cq - evaluation w.r.t .",
    "@xmath7 is conp - hard .",
    "we also investigate the nature of materializations .",
    "it turns out that if a tbox is materializable for one of the considered query languages , then it is materializable also for all others .",
    "the concrete materializations , however , need not agree . to obtain these results , we characterize cq - materializations in terms of homomorphisms and eliq - materializations in terms of simulations ( an eliq is an @xmath10-instance query , thus the dl version of an acyclic cq , with a single answer variable ) .    perhaps in contrary to the intuitions that arise from the experience with horn dls , materializability of a tbox",
    "is _ not _ a sufficient condition for query evaluation w.r.t .  to be in ( unless = ) since the existing materialization might be hard to compute .",
    "this leads us to study the notion of _ unraveling tolerance _ of a tbox  , meaning that answers to acyclic cqs over an abox w.r.t .",
    "@xmath7 are preserved under unraveling the abox . in csp",
    ", unraveling tolerance corresponds to the existence of tree obstructions , a notion that characterizes the well - known arc consistency condition and rewritability into monadic datalog  @xcite .",
    "it can be shown that every tbox formulated in horn-@xmath0 ( the intersection of @xmath0 and horn-@xmath5 ) is unraveling tolerant and that there are unraveling tolerant tboxes which are not equivalent to any horn-@xmath0-tbox .",
    "thus , the following result yields a rather general ( and uniform ! ) ptime upper bound for cq - evaluation .",
    "if an @xmath0-tbox @xmath7 is unraveling tolerant , then query evaluation w.r.t .",
    "@xmath7 is in ptime .",
    "although the above result is rather general , unraveling tolerance of a tbox is _ not _ a necessary condition for cq - evaluation w.r.t .  to be in ptime ( unless = )",
    ". however , for @xmath0-tboxes _ of depth one _ , being materializable and being unraveling tolerant turns out to be equivalent . for such tboxes",
    ", we thus obtain that cq - evalutation w.r.t .",
    "@xmath7 is in ptime iff @xmath7 is materializable iff @xmath7 is unraveling tolerant while , otherwise , cq - evaluation w.r.t .",
    "@xmath7 is conp - hard .",
    "this establishes the first main result above .",
    "our framework also allows to formally capture some intuitions and beliefs commonly held in the context of cq - answering in dls .",
    "for example , we show that for every @xmath0-tbox , cq - evaluation is in ptime iff peq - evaluation is in ptime iff eliq - evaluation is in ptime , and the same is true for rewritability into monadic datalog and for conp - hardness .",
    "in fact , the use of multiple query languages and in particular of @xmath10-instance queries does not only yield additional results , but is at the heart of our proof strategies . another interesting observation in this spirit",
    "is that an @xmath0-tbox is materializable iff it is convex , a condition that is also called the disjunction property and plays a central role in attaining complexity for standard reasoning in horn dls such as , dl - lite , and horn- ; see for example @xcite for more details .",
    "this paper is an extended and revised version of the conference publication @xcite .",
    "an early reference on data complexity in dls is @xcite , showing conp - hardness of elqs in the fragment @xmath11 of ( an elq is an eliq in which all edges are directed away from the answer variable ) .",
    "a conp upper bound for eliqs in the much more expressive dl was obtained in @xcite and generalized to cqs in @xcite .",
    "horn - was first defined in @xcite , where also a upper bound for eliqs is established ; the generalization to cqs can be found in @xcite .",
    "see also @xcite and references therein for the data complexity in dls and @xcite for related work on the guarded fragment and on existential rules .    to the best of our knowledge ,",
    "the conference version of this paper was first to initiate the study of data complexity in ontology - mediated querying at the level of individual tboxes and the first to observe a link between this area and csp .",
    "there is , however , a certain technical similarity to the link between view - based query processing for regular path queries ( rpqs ) and csp found in @xcite . in this case , the recognition problem for perfect rewritings for rpqs can be polynomially reduced to non - uniform csp and vice versa . on the level of omqs",
    ", the data complexity of ontology - mediated querying with dls has been studied in @xcite ; also here , a connection to csp plays a central role . in @xcite , the non - uniform data complexity of ontology - mediated query answering",
    "is studied in the case where the tbox is formulated in an inexpressive dl of the dl - lite or family and where individual predicates in the data can be given a closed - world reading , which also gives rise to conp - hardness of query evaluation ; while @xcite is considering the level of tboxes , @xcite treats the level of omqs , establishing a connection to surjective csps .",
    "the work on csp dichotomies started with schaefer s ptime/ np - dichotomy theorem , stating that every csp defined by a two element template is in ptime or np - hard @xcite .",
    "schaefer s theorem was followed by dichotomy results for csps with ( undirected ) graph templates @xcite and several other special cases , leading to the widely known feder - vardi conjecture which postulates a ptime / np - dichotomy for all csps , independently of the size of the template @xcite .",
    "an influential approach to studying the complexity of csps is via universal algebra @xcite , and it has resulted in a confirmation of the feder vardi conjecture for ternary csps @xcite .",
    "interesting results have also been obtained for other complexity classes such as ac@xmath12 @xcite .",
    "for a recent summary of the state of the art we refer to  @xcite .",
    "we introduce the relevant description logics and query languages , define the fundamental notions studied in this paper , and illustrate them with suitable examples .",
    "we shall be concerned with the dl @xmath1 and its extensions @xmath2 ,",
    "@xmath3 , and @xmath0 .",
    "let , , and denote countably infinite sets of _",
    "concept names _ , _ role names _ , and _",
    "individual names _ , respectively . _",
    "@xmath1 concepts _ are constructed according to the rule @xmath13 where @xmath14 ranges over @xmath15 and @xmath16 ranges over @xmath17 .",
    "_ concepts _ admit , in addition , _ inverse roles _ from the set @xmath18 , which can be used in place of role names .",
    "thus , @xmath19 is an example of an concept . to avoid heavy notation",
    ", we set @xmath20 if @xmath21 for a role name  @xmath22 ; in particular , we thus have @xmath23 .    in dls , ontologies are formalized as tboxes .",
    "@xmath1-tbox _ is a finite set of _ concept inclusions ( cis ) _",
    "@xmath24 , where @xmath25 are @xmath1 concepts , and @xmath2 tboxes are defined analogously .",
    "an _ @xmath3-tbox ( resp .",
    "@xmath0-tbox ) _ is an @xmath1-tbox ( resp .",
    "@xmath2-tbox ) that additionally admits functionality assertions @xmath26 , where @xmath27 ( resp .",
    "@xmath28 ) , declaring that @xmath16 is interpreted as a partial function .",
    "note that there is no such thing as an concept or an concept , as the extension with functional roles does not change the concept language .",
    "abox @xmath29 _ is a non - empty finite set of assertions of the form @xmath30 and @xmath31 with @xmath32 , @xmath27 , and @xmath33 . in some cases",
    ", we drop the finiteness condition on aboxes and then explicitly speak about _",
    "infinite aboxes_. we use @xmath34 to denote the set of individual names used in the abox  and sometimes write @xmath35 instead of @xmath36 .    the semantics of dls is given by _",
    "@xmath37 , where @xmath38 is a non - empty set and @xmath39 maps each concept name @xmath40 to a subset @xmath41 of @xmath38 and each role name @xmath42 to a binary relation @xmath43 on @xmath38 .",
    "the extension @xmath44 of @xmath45 under the interpretation @xmath46 is defined as the converse relation @xmath47 of @xmath48 and the extension @xmath49 of concepts under the interpretation is defined inductively as follows : @xmath50 an interpretation @xmath46 _ satisfies _ a ci @xmath51 if @xmath52 , an assertion @xmath30 if @xmath53 , an assertion @xmath31 if @xmath54 , and a functionality assertion @xmath26 if @xmath48 is a partial function .",
    "note that we make the _ standard name assumption _ , that is , individual names are not interpreted as domain elements ( like first - order constants ) , but as themselves .",
    "this assumption is common both in dls and in database theory .",
    "the results in this paper do not depend on it .",
    "an interpretation is a _ model _ of a tbox if it satisfies all cis in @xmath7 and @xmath46 is a _ model _ of an abox @xmath29 if it satisfies all assertions in .",
    "we call an abox _ consistent w.r.t .",
    "a tbox _ if and have a joint model .",
    "we consider several query languages .",
    "a _ positive existential query ( peq ) _",
    "@xmath55 is a first - order formula with free variables @xmath56 constructed from atoms @xmath57 and @xmath58 using conjunction , disjunction , and existential quantification where @xmath59 , @xmath60 , and @xmath61 are individual variables .",
    "the variables in @xmath62 are the _ answer variables _ of @xmath55 .",
    "a peq without answer variables is _",
    "boolean_. an _ assignment @xmath63 for @xmath55 in an interpretation @xmath46 _ is a mapping from the variables that occur in @xmath55 to @xmath64 .",
    "a tuple @xmath65 in @xmath66 is an _ answer to @xmath55 in @xmath46 _ if there exists an assigment @xmath63 for @xmath55 in @xmath46 such that @xmath67 ( in the standard first - order sense ) and @xmath68 for @xmath69 . in this case",
    ", we write @xmath70 .",
    "a tuple @xmath71 , an abox , is a _ certain answer to @xmath55 in w.r.t . _",
    "a tbox , in symbols @xmath72 , if @xmath73 for all models of and . computing certain answers to a query in the sense just defined",
    "is that main querying problem that we are interested in .",
    "although this paper focusses on the theoretical aspects of query answering , we given a concrete example that illustrates the usefulness of query answering with dl ontologies .",
    "let @xmath74      \\amc & = & \\ { \\mn{student}(\\mn{john } ) , \\",
    "\\mn{supervisedby}(\\mn{john},\\mn{mark } ) , \\",
    "\\mn{professor}(\\mn{mark } ) \\ } \\\\[1 mm ]      q(x , y ) & = & \\exists z \\ , \\mn{student}(x ) \\wedge \\mn{supervisedby}(x , y ) \\wedge      \\mn{academic}(y ) \\wedge \\mn{gives}(y , z ) \\wedge \\mn{course}(z )    \\end{array}\\ ] ] thus the query asks to return all pairs that consist of a student @xmath75 and an academic @xmath76 such that @xmath75 is supervised by @xmath76 and @xmath76 gives a course .",
    "although this information is not directly present in the abox , because of the tbox it is easy to see that @xmath77 is a certain answer .    apart from peqs , we also study several fragments thereof . a _ conjunctive query ( cq ) _ is a peq without disjunction .",
    "we generally assume that a cq @xmath55 takes the form @xmath78 , where @xmath79 is a conjunction of atoms of the form @xmath57 and @xmath58 .",
    "it is easy to see that every peq @xmath55 is equivalent to a disjunction @xmath80 , where each @xmath81 is a cq ( such a disjunction is often called a _ union of conjunctive queries , or ucq _ ) . to introduce relevant fragments of cqs , we recall two further dls that we use here for querying purposes .",
    "_ @xmath4 concepts _ are constructed from @xmath15 and @xmath17 according to the syntax rule @xmath82 and _ @xmath10 concepts _ additionally admit inverse roles . if @xmath83 is an @xmath10 concept and @xmath75 a variable , then @xmath84 is called an _ @xmath10 query ( eliq ) _ ; if @xmath83 is an @xmath4 concept , then @xmath84 is called an _ query ( elq)_. note that every eliq can be regarded as an acyclic cq with one answer variable , and indeed this is an equivalent definition of eliqs ; in the case of elqs , it is additionally the case that all edges are directed away from the answer variable .",
    "for example , the eliq @xmath85 is equivalent to the acyclic cq @xmath86 in what follows , we will not distinguish between an eliq and its translation into an acyclic cq with one answer variable and freely apply notions introduced for peqs also to eliqs and elqs .",
    "we also sometimes slightly abuse notation and use peq to denote the set of all positive existential queries , and likewise for cq , eliq , and elq .    [ ex1 ]     \\(1 ) let @xmath87 and @xmath88 .",
    "then we have for any abox @xmath29 , @xmath89 iff @xmath90 or there are @xmath91 .",
    "\\(2 ) let @xmath92 and @xmath93 .",
    "for any abox @xmath29 , @xmath94 iff there is an @xmath16-path in @xmath29 from @xmath95 to some @xmath96 with @xmath97 ; that is , there are @xmath98 , @xmath99 , with @xmath100 , @xmath101 , and @xmath97 .",
    "\\(3 ) consider an undirected graph @xmath102 represented as an abox @xmath29 with assertions @xmath103 iff there is an edge between @xmath95 and @xmath96 .",
    "let @xmath104 be concept names .",
    "then @xmath102 is @xmath105-colorable iff @xmath106 , where @xmath107          &     & \\ { a_{i } \\sqcap \\exists r.a_{i } \\sqsubseteq m \\mid 1\\leq i\\leq k\\}\\ , \\cup\\\\[0.5 mm ]          &      & \\{\\top \\sqsubseteq \\midsqcup_{1\\leq i \\leq k}a_{i}\\}.   \\end{array}\\ ] ]    we now introduce the main complexity notions investigated in this paper .",
    "ontology - mediated query ( omq ) _ is a a pair @xmath108 with a tbox @xmath7 and @xmath55 a query .",
    "the _ query evaluation problem for @xmath108 _ is to decide , given an abox @xmath29 and @xmath109 in @xmath34 , whether @xmath72 .",
    "instead of actually computing certain answers , we concentrate on the query evaluation problem , which is the decision problem version of query answering . in this paper , we are typically interested in joint complexity bounds for _ all _ omqs based on a given tbox and query language .",
    "[ def : main ] let @xmath7 be an @xmath0-tbox and let @xmath110 . then    * _ -evaluation w.r.t .",
    "@xmath7 is in ptime _ if for every @xmath111 ,",
    "the query evaluation problem for @xmath108 is in . *",
    "_ -evaluation w.r.t .",
    "@xmath7 is conp - hard _ if there exists @xmath111 such that the query evaluation problem for @xmath108 is conp - hard .",
    "[ ex3 ]     \\(1 ) peq - evaluation w.r.t .",
    "the tboxes @xmath112 and @xmath113 from example  [ ex1 ] is in ptime .",
    "this follows from the fact that these tboxes are @xmath4 tboxes ( tboxes using only @xmath4 concepts ) and it is well known that peq - evaluation w.r.t .",
    "@xmath4-tboxes is in ptime @xcite .",
    "( 2 ) consider the tboxes @xmath114 from example  [ ex1 ] that express @xmath105-colorability .",
    "for @xmath115 , cq - evaluation w.r.t .",
    "@xmath114 is conp - hard since @xmath105-colorability is np - hard .",
    "however , in contrast to the tractability of @xmath116-colorability , cq - evaluation w.r.t .",
    "@xmath117 is still conp - hard .",
    "this follows from theorem  [ thm : nomatlower ] below and , intuitively , is the case because @xmath117 ` entails a disjunction ' : for @xmath118 , we have @xmath119 , but neither @xmath120 nor @xmath121",
    ".    in addition to the classification of tboxes according to whether query evaluation is in ptime or conp - hard , we are also interested in whether omqs based on the tbox are rewritable into more classical database querying languages , in particular into datalog .    a _ datalog rule _",
    "@xmath122 has the form @xmath123 where @xmath124 , @xmath125 is a relation symbol , and @xmath126 are relation symbols , that is , concept names and role names .",
    "we refer to @xmath127 as the _ head _ of @xmath122 and @xmath128 as its _ body_. every variable in the head of @xmath122 is required to occur also in its body .",
    "a _ datalog program _",
    "@xmath129 is a finite set of datalog rules with a selected _ goal relation _ @xmath130 that does not occur in rule bodies .",
    "relation symbols that occur in the head of at least one rule are called _ intensional relation symbols ( idbs ) _ , the remaining symbols are called _ extensional relation symbols ( edbs)_. note that , by definition , @xmath130 is an idb .",
    "the _ arity _ of the program is the arity of the relation .",
    "programs of arity zero are called _",
    "boolean_.    for an abox @xmath29 , a datalog program @xmath129 , and @xmath109 from @xmath34 of the same length as the arity of @xmath130 , we write @xmath131 if @xmath129 returns @xmath109 as an answer on @xmath29 , defined in the usual way @xcite .",
    "a datalog program @xmath129 is a _ datalog - rewriting _ of an omq @xmath108 if for all aboxes @xmath29 and @xmath109 from @xmath34 , @xmath72 iff @xmath132 . in this case",
    "the omq @xmath108 is called _ datalog - rewritable_. when working with dls such as @xmath0 that include functional roles , it is more natural to admit the use of inequalities in the bodies of datalog rules instead of working with ` pure ' programs",
    ". we refer to such extended programs as datalog@xmath133 programs and accordingly speak of datalog@xmath133-rewritability .",
    "[ exa : newlabel ]     \\(1 ) the omq @xmath134 from example  [ ex1 ] expressing a form of reachability is rewritable into the datalog program @xmath135",
    "\\(2 ) the omq @xmath136 from example  [ ex1 ] is datalog - rewritable iff @xmath137 since non-2-colorability can be expressed by a datalog program but for @xmath115 , non-@xmath105-colorability can not be expressed by a datalog program ( in fact , not even by a datalog@xmath138 program ) @xcite .",
    "\\(3 ) the omq @xmath139 is rewritable into the datalog@xmath133 program @xmath140 but is not rewritable into pure datalog .",
    "[ def : main2 ] let @xmath7 be an @xmath0-tbox and let @xmath141 .",
    "then @xmath7 is _",
    "datalog@xmath133-rewritable for @xmath142 _ if @xmath108 is datalog@xmath133-rewritable for every @xmath111 .",
    "it is folklore that every -tbox is datalog - rewritable for elq , eliq , cq , and for peq .",
    "thus , this applies in particular to the tboxes @xmath113 and @xmath112 from example  [ ex1 ] .",
    "a concrete construction of datalog - rewritings for eliqs can be found in the proof of theorem  [ thm : unravupperlem : hornalclem : hornalc ] below .",
    "in contrast , the tbox @xmath143 from example  [ ex1 ] is not datalog@xmath138-rewritable for elq when @xmath144 since the omq @xmath136 is not datalog@xmath138-rewritable , by example  [ exa : newlabel ] ( 2 ) .",
    "it is well - known that datalog@xmath133-programs can be evaluated in @xcite , and thus datalog@xmath133-rewritability for of a tbox implies that @xmath142-evaluation w.r.t .",
    "we shall see later that the converse direction does not hold .",
    "we will often be concerned with homomorphisms between aboxes and between interpretations , defined next .",
    "let and be aboxes .",
    "a function @xmath145 is a _ homomorphism from to  _ if it satisfies the following conditions :    1 .",
    "@xmath146 implies @xmath147 and 2 .",
    "@xmath148 implies @xmath149 .",
    "we say that _ @xmath150 preserves _",
    "@xmath151 if @xmath152 for all @xmath153 .",
    "homomorphisms from an interpretation to an interpretation are defined analogously as functions @xmath154 .",
    "note that these two notions are in fact identical since , up to presentation , aboxes and finite interpretations are the same thing . in what follows we will not always distinguish between the two presentations .",
    "we introduce materializability as a central notion for analyzing the complexity and rewritability of tboxes .",
    "a materialization of a tbox @xmath7 and abox @xmath29 for a class of queries @xmath142 is a model of @xmath7 and @xmath29 that gives the same answers to queries in @xmath142 as @xmath7 and @xmath29 do .",
    "it is not difficult to see that a materialization for eliqs is not necessarily a materialization for cqs and that a materialization for elqs is not necessarily a materialization for eliqs .",
    "we shall call a tbox @xmath7 materializable for a query language @xmath142 if for every abox @xmath29 that is consistent w.r.t .",
    "@xmath7 , there is at least one materialization of @xmath7 and for @xmath142 .",
    "interestingly , we show that materializability of -tboxes does _ not _ depend on whether one considers eliqs , cqs , or peqs .",
    "this result allows us to simply talk about materializable tboxes , independently of the query language considered .",
    "the fundamental result linking materializability of a tbox to the complexity of query evaluation is that query evaluation is conp - hard w.r.t .",
    "non - materializable -tboxes . as a first application",
    ", we show that ptime query evaluation and datalog@xmath138-rewritability of -tboxes also do not depend on the query language , and the same is true for conp - hardness of query evaluation . as a side line",
    ", we also consider the case of where , additionally , materializability for eliqs coincides with materializability for elqs .",
    "[ cond0 ] let @xmath7 be an @xmath0-tbox and @xmath155",
    ". then    1 .   a model @xmath46 of and an abox is a _ @xmath142-materialization of @xmath7 and",
    "_  @xmath29 if for all queries @xmath156 and @xmath157 , we have @xmath158 iff ; 2 .   @xmath7 is _",
    "@xmath142-materializable _ if for every abox @xmath29 that is consistent w.r.t .",
    "@xmath7 , there exists a @xmath142-materialization of @xmath7 and  @xmath29 .",
    "in point  ( 1 ) of definition  [ cond0 ] , it is important that the materialization @xmath46 of @xmath7 and @xmath29 is a model of @xmath7 and @xmath29 .",
    "in fact , for every abox @xmath29 that is consistent w.r.t .",
    "@xmath7 , we find an interpretation @xmath46 such that for every cq @xmath55 and @xmath159 , @xmath70 iff @xmath72 ; take , for example , the direct product of all ( up to isomorphisms ) countable models of @xmath7 and @xmath29 .",
    "note that is , in general , not a model of  .",
    "note that a -materialization can be viewed as a more abstract version of the _ canonical _ or _ minimal _ or _",
    "universal _ model as often used in the context of ` horn dls ' such as and dl - lite @xcite and more expressive ontology languages based on tuple - generating dependencies ( tgds ) @xcite as well as in data exchange  @xcite . in fact , the elq - materialization in the next example is exactly the ` compact canonical model ' from  @xcite .",
    "[ ex5 ]     \\(1 ) let @xmath160 be as in example  [ ex1 ] and let @xmath29 be an abox .",
    "let @xmath46 be the interpretation obtained from @xmath29 by adding to @xmath161 all @xmath162 such that there exists an @xmath16-path from @xmath95 to some @xmath96 with @xmath97 .",
    "then @xmath46 is a peq - materialization of @xmath7 and @xmath29 and so @xmath7 is peq - materializable .",
    "\\(2 ) let @xmath163 be as in example  [ ex1 ] and let @xmath29 be an abox with at least one assertion of the form @xmath30 . to obtain an elq - materialization @xmath46 of and ,",
    "start with as an interpretation , add a fresh domain element @xmath164 to @xmath38 and to @xmath161 , and extend @xmath165 with @xmath166 and @xmath167 for all @xmath146 .",
    "thus @xmath112 is elq - materializable .",
    "trivially , every peq - materialization is a cq - materialization , every cq - materialization is an eliq - materialization and every eliq - materialization is an elq - materialization .",
    "conversely , it follows directly from the fact that each peq is equivalent to a disjunction of cqs that every cq - materialization is also a peq - materialization .",
    "in contrast , the following example demonstrates that elq - materializations are different from eliq - materializations .",
    "a similar argument separates eliq - materializations from cq - materializations .",
    "[ ex5b ] let @xmath112 be as in example  [ ex5 ] , @xmath168    q(x)&= & ( b_{1}\\sqcap \\exists r.\\exists r^{-}.b_{2})(x ) , \\end{array}\\ ] ] then the elq - materialization @xmath169 from example  [ ex5 ] is not a -materialization for any @xmath142 from the set of query languages @xmath170 .",
    "for example , we have @xmath171 , but @xmath172 .",
    "an eliq / cq / peq - materialization of @xmath7 and @xmath29 is obtained by unfolding @xmath173 ( see below ) : instead of using only one additional individual @xmath164 as a witness for @xmath174 , we attach to both @xmath95 and @xmath96 an infinite @xmath16-path of elements that satisfy @xmath14 .",
    "note that every cq / peq - materialization of @xmath112 and @xmath29 must be infinite .",
    "we will sometimes restrict our attention to materializations @xmath46 that are countable and _ generated _ , i.e , every @xmath175 is reachable from some @xmath176 in the undirected graph @xmath177 the following lemma shows that we can make that assumption without loss of generality .",
    "[ lem : count ] let @xmath7 be an @xmath0-tbox , @xmath29 an abox , and @xmath155 .",
    "if @xmath46 is a @xmath142-materialization of @xmath7 and @xmath29 , then there exists a subinterpretation @xmath178 of @xmath46 that is a countable and generated @xmath142-materialization of @xmath7 and @xmath29 .",
    "let @xmath46 be a @xmath142-materialization of @xmath7 and @xmath29 . to construct @xmath178",
    "we apply a standard selective filtration procedure to @xmath46 .",
    "more precisely , we identify a sequence @xmath179 and then define @xmath178 to be the restriction of @xmath46 to @xmath180 .",
    "let be the set of all concepts of the form @xmath181 that occur in @xmath7 and of all concepts @xmath182 such that @xmath183 occurs in .",
    "assume @xmath184 has already been defined .",
    "then define @xmath185 as the union of @xmath184 and , for every @xmath186 and concept @xmath187 with @xmath188 , an arbitrary @xmath189 with @xmath190 and @xmath191 ( unless such a @xmath192 exists already in @xmath184 ) .",
    "it is easy to see that @xmath178 is a countable and generated @xmath142-materialization of @xmath7 and @xmath29 .      we characterize materializations using simulations and homomorphisms",
    "this sheds light on the nature of materializations and establishes a close connection between materializations and initial models as studied in model theory , algebraic specification , and logic programming  @xcite .",
    "a _ simulation from an interpretation @xmath193 to an interpretation @xmath194 _ is a relation @xmath195 such that    1 .   for all",
    "@xmath59 : if @xmath196 and @xmath197 , then @xmath198 ; 2 .   for all @xmath60 : if @xmath197 and @xmath199 , then there exists @xmath200 such that @xmath201 and @xmath202 ; 3 .   for all @xmath203 : @xmath204 and @xmath205 .",
    "note that , by condition  ( 3 ) , domain elements that are individual names need to be respected by simulations while other domain elements need not . in database parlance , the latter are thus treated as _ labeled nulls _ , that is , while their existence is important , their identity is not .",
    "we call a simulation @xmath125 an _ i - simulation _ if condition  ( 2 ) is satisfied also for inverse roles . note that @xmath125 is a homomorphism preserving @xmath206 if @xmath125 is a function with domain @xmath64 .",
    "we remind the reader of the following characterizations of elqs using simulations , eliqs using i - simulations , and cqs using homomorphisms ( see e.g.  @xcite ) .",
    "an interpretation @xmath46 has _ finite outdegree _",
    "if the undirected graph @xmath207 has finite outdegree .",
    "[ lem : simelq ] let @xmath46 and @xmath178 be interpretations such that @xmath208 is finite , @xmath46 is countable and generated , and @xmath178 has finite outdegree",
    ". then the following conditions are equivalent ( where none of the assumed conditions on @xmath46 and @xmath178 is required for ( 2 ) @xmath209 ( 1 ) ) .    1 .   for all eliqs @xmath84 and @xmath210 :",
    "if @xmath211 , then @xmath212 ; 2 .   there is an i - simulation from @xmath46 and @xmath178 .",
    "the same equivalence holds when eliqs and i - simulations are replaced by elqs and simulations , respectively .",
    "moreover , the following conditions are equivalent ( where none of the assumed conditions on @xmath46 and @xmath178 is required for ( 3 ) @xmath209 ( 1 ) )",
    ".    1 .   for all peqs @xmath55 and @xmath213 : if @xmath70 , then @xmath214 ; 2 .",
    "for all cqs @xmath55 and @xmath213 : if @xmath70 , then @xmath214 ; 3 .",
    "there is a homomorphism from @xmath46 to @xmath178 preserving @xmath208 .",
    "we prove the equivalence of ( 3)-(5 ) .",
    "the equivalence of ( 1 ) and ( 2 ) is similar ( both for eliqs and elqs ) but simpler and left to the reader .",
    "the implication ( 3 ) @xmath209 ( 4 ) is trivial . for the proof of ( 4 ) @xmath209 ( 5 ) , assume that @xmath46 is countable and generated and let @xmath178 have finite outdegree .",
    "we first assume that only a finite set @xmath215 of concept and role names have a non - empty interpretation in @xmath46 and then generalize the result to arbitrary @xmath46 .",
    "assume that ( 4 ) holds .",
    "first observe that for every finite subset @xmath216 of @xmath64 there is a homomorphism @xmath217 preserving @xmath218 from the subinterpretation @xmath219 of @xmath46 induced by @xmath216 into @xmath178 : associate with every @xmath220 an individual variable @xmath221 and regard @xmath219 as the cq @xmath222 defined by setting @xmath223 where @xmath62 comprises the individual variables in @xmath224 and @xmath225 comprises the individual variables @xmath221 with @xmath226 ( @xmath227 is a cq by our assumption that only finitely many concept and role names have non - empty interpretation ) .",
    "for the assignment @xmath228 , we have @xmath229 .",
    "thus @xmath230 and so , by ( 2 ) , @xmath231 .",
    "consequently , there exists an assignment @xmath232 for @xmath233 in @xmath178 which coincides with @xmath63 on @xmath234 such that @xmath235 .",
    "let @xmath236 for @xmath220 .",
    "then @xmath217 is a homomorphism from @xmath219 to @xmath178 preserving @xmath218 , as required .",
    "we now lift the homomorphisms @xmath217 to a homomorphism @xmath150 from @xmath46 to @xmath178 preserving @xmath208 .",
    "since @xmath46 is countable and generated , there exists a sequence @xmath237 of finite subsets of @xmath64 such that @xmath238 , @xmath239 , and for all @xmath240 there exists a path in @xmath241 from some @xmath242 to @xmath243 .    by the observation above",
    ", we find homomorphisms @xmath244 from @xmath245 to @xmath178 preserving @xmath246 , for @xmath247 .",
    "let @xmath248 be an enumeration of @xmath64 .",
    "we define the required homomorphism @xmath150 as the limit of a sequence @xmath249 , where each @xmath250 has domain @xmath251 and where we ensure for each @xmath252 and all @xmath253 that there are infinitely many @xmath254 with @xmath255 .",
    "observe that since @xmath178 has finite outdegree and since for all @xmath240 , there exists a path in @xmath241 from some @xmath242 to @xmath243 , for each @xmath175 there exist only finitely many distinct values in @xmath256 . by the pigeonhole principle , there thus exist infinitely many @xmath254 with the same value @xmath257 .",
    "for @xmath258 we take such a value for @xmath259 .",
    "assume @xmath250 has been defined and assume that the set @xmath260 is infinite .",
    "again by the pigeonhole principle , we find a value @xmath261 such that @xmath262 for infinitely many @xmath263 .",
    "we set @xmath264 .",
    "the function @xmath265 is a homomorphism from @xmath46 to @xmath178 preserving @xmath208 , as required .    to lift this result to arbitrary interpretations @xmath46 ,",
    "it is sufficient to prove that the homomorphisms @xmath217 still exist .",
    "this can be shown using again the pigeonhole principle .",
    "let @xmath266 be finite .",
    "we may assume that for each @xmath220 , there exists a path in @xmath216 from some @xmath267 , to @xmath243 .",
    "we have shown that for each finite set @xmath215 of concept and role names , there exists a homomorphism @xmath268 from the @xmath215-reduct @xmath269 of @xmath270 to @xmath178 ( @xmath269 interprets only the symbols in @xmath215 as non - empty ) . since @xmath178 has finite outdegree ,",
    "infinitely many @xmath268 coincide . a straightforward modification of the pigeonhole argument above",
    "can now be used to construct the required homomorphism @xmath217 .    for the proof of ( 5 ) @xmath209 ( 3 ) , assume @xmath271 and let @xmath150 be a homomorphism from @xmath46 to @xmath178 preserving @xmath208 .",
    "let @xmath63 be an assignment for @xmath55 in @xmath46 witnessing @xmath70 .",
    "then the composition @xmath272 is an assignment for @xmath55 in @xmath178 witnessing @xmath273 .    for the next steps , we need some observations regarding the unfolding of interpretations into forest - shaped interpretations .",
    "let us first make precise what we mean by unfolding .",
    "i - unfolding _ of an interpretation is an interpretation defined as follows .",
    "the domain @xmath274 of @xmath178 consists of all words @xmath275 with @xmath276 , each @xmath277 from @xmath64 and each @xmath278 a ( possibly inverse ) role such that    * @xmath279 iff @xmath280 ; * @xmath281 for @xmath282 ; * if @xmath283 , then @xmath284 for @xmath285 .    for @xmath286 , we set @xmath287 .",
    "now set @xmath288",
    "r^{\\jmc } & = & ( r^\\imc \\cap ( \\ni \\times \\ni ) ) \\,\\cup\\\\[1 mm ]    & & \\ { ( \\sigma,\\sigma rd ) \\mid \\sigma,\\sigma rd \\in \\delta^{\\jmc } \\ } \\ , \\cup % \\\\[1 mm ]     % & &   \\{(\\sigma r^{- } d,\\sigma)\\mid \\sigma,\\sigma r^{- } d \\in   \\delta^{\\jmc}\\ }     & \\text { for all } r\\in \\nr .",
    "\\end{array}\\ ] ] we say that an interpretation @xmath46 is _ i - unfolded _ if it is isomorphic to its own i - unfolding .",
    "clearly , every i - unfolding of an interpretation is i - unfolded .    for @xmath3-tboxes",
    ", it is not required to unfold along inverse roles .",
    "this is reflected in the _ unfolding _ of an interpretation , where in contrast to the i - unfolding we use as the domain the set of all words @xmath275 with @xmath289 , each @xmath277 from @xmath64 , and each @xmath278 a _ role name _ such that conditions  ( a ) and ( b ) above are satisfied .",
    "the interpretation of concept and role names remains the same .",
    "we call an interpretation @xmath46 _ unfolded _ if it is isomorphic to its own unfolding .",
    "the following lemma summarizes the main properties of unfoldings .",
    "its proof is straightforward and left to the reader .",
    "[ lem : propertiesofunfold ] let @xmath46 be an interpretation , @xmath290 its i - unfolding , and @xmath291 its unfolding .",
    "then for every interpretation , the following conditions are satisfied :    1 .",
    "the function @xmath292 , @xmath293 , is a homomorphism from @xmath290 to @xmath46 preserving @xmath208 ; 2 .",
    "the function @xmath292 , @xmath294 , is a homomorphism from @xmath291 to @xmath46 preserving @xmath208 ; 3 .",
    "if there is an i - simulation from @xmath46 to @xmath178 , then there is a homomorphism from @xmath290 to @xmath178 preserving @xmath208 ; 4 .",
    "if there is a simulation from @xmath46 to @xmath178 , then there is a homomorphism from @xmath291 to @xmath178 preserving @xmath208 ; 5 .",
    "if @xmath46 is a model of @xmath7 and @xmath29 with @xmath7 an @xmath0-tbox , then @xmath290 is a model of @xmath7 and @xmath29 ; 6 .",
    "if @xmath46 is a model of @xmath7 and @xmath29 with @xmath7 an @xmath3-tbox , then @xmath291 is a model of @xmath7 and @xmath29 .",
    "an interpretation @xmath46 is called _ hom - initial in a class @xmath295 of interpretations _ if for every @xmath296 , there exists a homomorphism from @xmath46 to @xmath178 preserving @xmath208 .",
    "@xmath46 is called _ sim - initial ( i - sim - initial ) in a class @xmath295 of interpretations _",
    "if for every @xmath296 , there exists a simulation ( i - simulation ) from @xmath46 to @xmath178 .",
    "the following theorem provides the announced characterization of materializations in terms of simulations and homomorphisms . in the following , the class of all models of @xmath7 and @xmath29 is denoted by @xmath297 .",
    "[ lem : sem ] let @xmath7 be an @xmath0-tbox , @xmath29 an abox , and let @xmath298 be countable and generated . then is    1 .",
    "an eliq - materialization of and iff it is i - sim - initial in @xmath297 ; 2 .   a cq - materialization of and iff it is a peq - materialization of and iff it is hom - initial in @xmath299 ; 3 .",
    "an elq - materialization of and iff it is sim - initial in @xmath297 , provided that @xmath7 is an @xmath3-tbox .",
    "the ` only if ' directions of all three points hold without any of the assumed conditions on @xmath46 .",
    "we show that ( 1 ) follows from lemma  [ lem : simelq ] and lemma  [ lem : propertiesofunfold ] ; ( 2 ) and ( 3 ) can be proved similarly .",
    "we start with the direction from right to left .",
    "assume that @xmath46 is i - sim - initial in @xmath297 . since @xmath46 is a model of @xmath7 and @xmath29 , we have @xmath211 whenever @xmath300 for any eliq @xmath84 and @xmath301 .",
    "conversely , if @xmath302 then there exists a model @xmath178 of @xmath7 and @xmath29 such that @xmath303 .",
    "there is an i - simulation from @xmath46 to @xmath178 .",
    "thus , by the implication ( 2 ) @xmath209 ( 1 ) from lemma  [ lem : simelq ] , we have @xmath304 as required .    for the direction from left to right ,",
    "assume that @xmath46 is a materialization of @xmath7 and @xmath29 and take a model @xmath178 of @xmath7 and @xmath29 .",
    "we have to construct an i - simulation from @xmath46 to @xmath178 .",
    "it actually suffices to construct an i - simulation from to the i - unfolding @xmath305 of @xmath178 : by point  ( 3 ) of lemma  [ lem : propertiesofunfold ] , there is a homomorphism from @xmath305 to @xmath178 and the composition of an i - simulation with a homomorphism is again an i - simulation .    to obtain an i - simulation from to @xmath305 , we first identify a subinterpretation @xmath306 of @xmath305 that has finite outdegree and is still a model of @xmath7 and @xmath29 . by the implication ( 1 ) @xmath209 ( 2 ) from lemma  [ lem : simelq ] and since is a materialization , there must then be an i - simulation from @xmath46 to @xmath306 .",
    "clearly this is also an i - simulation from @xmath46 to @xmath305 and we are done .",
    "it thus remains to construct @xmath306 , which is done by applying selective filtration to @xmath307 in exactly the same way as in the proof of lemma  [ lem : count ] .",
    "it can be verified that the outdegree of the resulting subinterpretation @xmath306 of @xmath307 is bounded by @xmath308 and , therefore , finite . by construction , @xmath309 .",
    "the following example shows that the generatedness condition in theorem  [ lem : sem ] can not be dropped .",
    "we leave it open whether the same is true for countability .",
    "let @xmath310 and @xmath311 and consider the interpretation defined by @xmath312 a^{\\imc } & = & \\delta^{\\imc } \\\\[1 mm ] b^{\\imc } & = &   \\ { a \\ } \\\\[1 mm ] r^\\imc & = & \\{(a,0)\\}\\cup \\{(n , n+1)\\mid n \\in \\mathbbm{n}\\ } \\cup \\{(n',n'+1)\\mid n \\in \\mathbbm{z}\\}. \\end{array}\\ ] ] then is a peq - materialization of and , but it is not hom - initial ( and in fact not even sim - initial ) since the restriction of to domain @xmath313 is also a model of and , but there is no homomorphism ( and no simulation ) from to this restriction preserving @xmath314 .    as an application of theorem  [ lem : sem ] , we now show that materializability coincides for the query languages peq , cq , and eliq ( and that for @xmath3-tboxes , all these also coincide with elq - materializability ) .",
    "[ thm : disjmat ] let @xmath7 be an @xmath0-tbox .",
    "then the following conditions are equivalent :    1 .",
    "@xmath7 is peq - materializable ; 2 .",
    "@xmath7 is cq - materializable ; 3 .",
    "@xmath7 is eliq - materializable ; 4 .",
    "@xmath297 contains an i - sim - initial @xmath46 , for every abox @xmath29 that is consistent w.r.t .",
    "@xmath7 ; 5 .",
    "@xmath297 contains a hom - initial @xmath46 , for every abox @xmath29 that is consistent w.r.t .",
    "@xmath7 .",
    "if @xmath7 is an @xmath3-tbox , then the above is the case iff is elq - materializable iff @xmath297 contains a sim - initial @xmath46 , for every abox @xmath29 that is consistent w.r.t .",
    "@xmath7 .",
    "the implications ( 1 ) @xmath209 ( 2 ) and ( 2 ) @xmath209 ( 3 ) are trivial . for ( 3 ) @xmath209 ( 4 ) , let @xmath46 be an eliq - materialization of @xmath7 and an abox @xmath29 . by lemma  [ lem : count ] , we may assume that @xmath46 is countable and generated . by lemma  [ lem : sem ] , @xmath297 contains an i - sim - initial interpretation . for ( 4 )",
    "@xmath209 ( 5 ) , assume that @xmath315 is i - sim - initial . by points  ( 3 ) and ( 5 ) of lemma  [ lem : propertiesofunfold ] ,",
    "the i - unfolding of is hom - initial in @xmath297 and ( 5 ) follows .",
    "( 5 ) @xmath209 ( 1 ) follows from theorem  [ lem : sem ] .",
    "the implications for @xmath3-tboxes are proved similarly .",
    "because of theorem  [ thm : disjmat ] , we sometimes speak of _ materializability _ without reference to a query language and of _ materializations _ instead of peq - materializations .",
    "we show that non - materializability implies conp - hardness of query evaluation . to this end",
    ", we first establish that materializability is equivalent to the disjunction property , which is sometimes also called convexity and plays a central role in attaining ptime complexity for subsumption in dls @xcite , and for attaining ptime data complexity for query answering with dl tboxes @xcite .    a tbox @xmath7 has the _ abox disjunction property for eliq ( resp .",
    "elq ) _ if for all aboxes  @xmath29 , individuals @xmath316 , and eliqs ( resp .",
    "elqs ) @xmath317 , @xmath318 implies @xmath319 for some @xmath320 .",
    "[ thm : disjproperty ] an @xmath0- ( @xmath3- ) tbox is materializable iff it has the abox disjunction property for eliqs ( elqs ) .    for the nontrivial `` if '' direction , let @xmath29 be an abox that is consistent w.r.t .",
    "@xmath7 and such that there is no eliq - materialization of and .",
    "then @xmath321 is not satisfiable , where @xmath322 in fact , any satisfying interpretation would be an eliq - materialization . by compactness",
    ", there is a finite subset @xmath323 of @xmath324 such that @xmath325 is not satisfiable , i.e. @xmath326 since @xmath327 , we have @xmath302 for all @xmath328 .",
    "thus , @xmath7 lacks the abox disjunction property .    based on theorems  [ thm : disjmat ] and  [ thm : disjproperty ] , we now establish that materializability is a necessary condition for query - evaluation to be it ptime .",
    "[ thm : nomatlower ] if an @xmath0-tbox ( -tbox ) is not materializable , then eliq - evaluation ( elq - evaluation ) w.r.t .",
    "@xmath7 is conp - hard .",
    "the proof is by reduction of 2 + 2-sat , a variant of propositional satisfiability that was first introduced by schaerf as a tool for establishing lower bounds for the data complexity of query answering in a dl context  @xcite .",
    "clause _ is of the form @xmath329 , where each of @xmath330 is a propositional letter or a truth constant @xmath331 , @xmath332 .",
    "formula _ is a finite conjunction of 2 + 2 clauses .",
    "now , 2 + 2-sat is the problem of deciding whether a given 2 + 2 formula is satisfiable .",
    "it is shown in @xcite that 2 + 2-sat is -complete .",
    "we first show that if an @xmath0-tbox is not materializable , then ueliq - evaluation w.r.t .",
    "is conp - hard , where a ueliq is a disjunction @xmath333 , with each @xmath334 an eliq .",
    "we then sketch the modifications necessary to lift the result to eliq - evaluation w.r.t .  .",
    "since is not materializable , by theorem  [ thm : disjmat ] it does not have the disjunction property .",
    "thus , there is an abox @xmath335 , individual names @xmath336 , and eliqs @xmath337 such that @xmath338 , but @xmath339 for all @xmath340 .",
    "assume w.l.o.g .  that this sequence is minimal , i.e. , @xmath341 for all @xmath340 .",
    "this clearly implies that for all @xmath340 ,    * there is a model @xmath342 of and @xmath335 with @xmath343 and @xmath344 for all @xmath345 .",
    "we will use @xmath335 , the individuals @xmath346 , and the eliqs @xmath337 to generate truth values for variables in the input 2 + 2 formula .",
    "let @xmath347 be a 2 + 2 formula in propositional letters @xmath348 , and let @xmath349 for all @xmath350 .",
    "our aim is to define an abox @xmath351 with a distinguished individual name @xmath352 and a ueliq @xmath353 such that @xmath354 is unsatisfiable iff @xmath355 .",
    "to start , we represent the formula @xmath354 in the abox @xmath351 as follows :    * the individual name @xmath352 represents the formula @xmath354 ; * the individual names @xmath356 represent the clauses of @xmath354 ; * the assertions @xmath357 , associate @xmath352 with its clauses , where @xmath358 is a role name that does not occur in ; * the individual names @xmath359 represent variables , and the individual names @xmath360 represent truth constants ; * the assertions @xmath361 associate each clause with the variables / truth constants that occur in it , where @xmath330 are role names that do not occur in .",
    "we further extend @xmath351 to enforce a truth value for each of the variables @xmath362 . to this end , add to @xmath351 copies @xmath363 of @xmath335 obtained by renaming individual names such that @xmath364 whenever @xmath365 . as a notational convention ,",
    "let @xmath366 be the name used for the individual name @xmath367 in @xmath368 for all @xmath369 and @xmath370 .",
    "intuitively , the copy @xmath368 of is used to generate a truth value for the variable @xmath362 . to actually connect each individual name @xmath362 to the associated abox @xmath368",
    ", we use role names @xmath371 that do not occur in . more specifically , we extend @xmath351 as follows :    * link variables @xmath362 to the aboxes @xmath368 by adding assertions @xmath372 for all @xmath369 and @xmath370 ; thus , truth of @xmath362 means that the concept @xmath373 is true at @xmath362 and falsity means that one of the concepts @xmath374 , is true at @xmath362 ; * to ensure that 0 and 1 have the expected truth values , add a copy of @xmath375 viewed as an abox with root @xmath376 and a copy of @xmath377 viewed as an abox with root @xmath378 ; add @xmath379 and @xmath380 .",
    "consider the query @xmath381 with @xmath382 which describes the existence of a clause with only false literals and thus captures falsity of @xmath354 , where @xmath383 is an abbreviation for @xmath384 and @xmath385 an abbreviation for the @xmath386-concept @xmath387 .",
    "it is straightforward to show that @xmath354 is unsatisfiable iff @xmath388 . to obtain the desired ueliq @xmath353 , it remains to take @xmath389 and distribute disjunction to the outside .",
    "we now show how to improve the result from ueliq - evaluation to eliq - evaluation .",
    "our aim is to change the encoding of falsity of a variable @xmath362 from satisfaction of @xmath390 at @xmath362 to satisfaction of @xmath391 at @xmath362 , where @xmath150 is an additional role that does not occur in  .",
    "we can then replace the concept @xmath385 in the query @xmath392 with @xmath393 , which gives the desired eliq @xmath353 .",
    "it remains to modify @xmath351 to support the new encoding of falsity .",
    "the basic idea is that each @xmath362 has @xmath105 successors @xmath394 reachable via @xmath150 such that for @xmath395 ,    * @xmath396 is satisfied at @xmath397 for all @xmath398 and * the assertion @xmath399 is in @xmath351 .",
    "thus , @xmath400 is satisfied at @xmath397 iff @xmath401 is satisfied at @xmath366 , for all @xmath254 with @xmath402 . in detail",
    ", the modification of @xmath351 is as follows :    * for @xmath402 , add to @xmath351 a copy of @xmath401 viewed as an abox , where the root individual name is @xmath403 ; * for all @xmath369 , replace the assertions @xmath372 , @xmath404 , with the following : * * @xmath405 for all @xmath369 ; * * @xmath406 , @xmath407 for all @xmath369 and @xmath402 .",
    "this finishes the modified construction .",
    "again , it is not hard to prove correctness .    it remains to note that , when @xmath7 is an -tbox , then the above construction of @xmath408 yields an elq instead of an eliq .",
    "the converse of theorem  [ thm : nomatlower ] fails , i.e. , there are tboxes that are materializable , but for which eliq - evaluation is conp - hard . in fact , materializations of such a tbox and abox are guaranteed to exist , but can not always be computed in ( unless = conp ) .",
    "technically , this follows from theorem  [ thm : red0 ] later on which states that for every non - uniform csp , there is a materializable @xmath1-tbox for which boolean cq - answering has the same complexity , up to complementation of the complexity class .",
    "we make use of our results on materializability to show that ptime query evaluation w.r.t .",
    "@xmath0-tboxes does not depend on whether we consider peqs , cqs , or eliqs , and the same is true for datalog@xmath138-rewritability . for @xmath3-tboxes , we can add elqs to the list .",
    "theorem  [ equivalence ] below gives a uniform explanation for the fact that , in the traditional approach to data complexity in obda , the complexity of evaluating peqs , cqs , and eliqs has turned out to be identical for almost all dls .",
    "it allows us to ( sometimes ) speak of the ` complexity of query evaluation ' without reference to a concrete query language .",
    "[ equivalence ] for all -tboxes ,    1 .",
    "peq - evaluation w.r.t .",
    "is in ptime iff cq - evaluation w.r.t .",
    "is in ptime iff eliq - evaluation w.r.t .",
    "is in ptime ; 2 .",
    "@xmath7 is datalog@xmath138-rewritable for peq iff it is datalog@xmath138-rewritable for cq iff it is datalog@xmath138-rewritable for eliq ( unless ptime @xmath409 conp ) ; 3 .",
    "peq - evaluation w.r.t .",
    "is conp - hard iff cq - evaluation w.r.t .",
    "is conp - hard iff eliq - evaluation w.r.t .",
    "is conp - hard .",
    "if @xmath7 is an @xmath410-tbox , then eliq can be replaced by elq in ( 1 ) , ( 2 ) , and ( 3 ) .",
    "if @xmath7 is an @xmath2 tbox , then datalog@xmath138-rewritability can be replaced by datalog - rewritability in ( 2 ) .",
    "we start with points  ( 1 ) and  ( 2 ) , for which the `` only if '' directions are trivial . for the converse directions",
    ", we may assume by theorem  [ thm : nomatlower ] that the tbox @xmath7 is materializable .",
    "the implications from cq to peq in points  ( 1 ) and  ( 2 ) follow immediately from this assumption : one can first transform a given peq @xmath55 into an equivalent disjunction of cqs @xmath80 .",
    "cq - materializability of @xmath7 implies that , for any abox @xmath29 and @xmath109 in @xmath34 , @xmath72 iff there exists @xmath411 such that @xmath412 . thus if cq - evaluation w.r.t .",
    "@xmath7 is in ptime , evaluation of @xmath108 is in ptime .",
    "the same holds for datalog@xmath138-rewritability because the class of datalog@xmath138-queries is closed under finite union .",
    "we now consider the implications from eliq to cq ( and from elq to cq if @xmath7 is a @xmath3-tbox ) in points  ( 1 ) and  ( 2 ) , first concentrating on the ptime case .",
    "the following claim is the main step of the proof .",
    "it states that for any cq @xmath55 , we can reduce the evaluation of @xmath55 w.r.t .  on an abox to evaluating quantifier - free cqs and eliqs @xmath84 w.r.t .",
    "( elqs if @xmath7 is an @xmath3-tbox ) , both on .    * claim 1*. for any materializable tbox @xmath7 and cq @xmath55 with @xmath413 , one can construct a finite set @xmath414 of pairs @xmath415 , where    * @xmath79 is a ( possibly empty ) conjunction of atoms of the form @xmath416 or @xmath58 , where @xmath16 is a role name in @xmath55 and * @xmath417 is a finite set of eliqs    such that the following conditions are equivalent for any abox @xmath29 and @xmath418 from @xmath34 :    1 .",
    "@xmath72 ; 2 .",
    "there exists @xmath419 and an assignment @xmath63 in @xmath34 with @xmath68 for @xmath69 , @xmath420 , and @xmath421 for all @xmath422 .",
    "if @xmath7 is an @xmath3-tbox , then one can choose elqs instead of eliqs in each @xmath417 in @xmath414 .",
    "before we prove claim  1 , we show how the desired results follow from it .",
    "let a cq @xmath55 be given and let @xmath414 be the set of pairs from claim  1 .",
    "* assume that eliq - evaluation w.r.t .",
    "is in ptime .",
    "then @xmath72 can be decided in polynomial time since there are only polynomially many assignments @xmath63 and for any such @xmath63 , @xmath423 can be checked in polynomial time ( using a naive algorithm ) and @xmath421 can be checked in polynomial time for each eliq @xmath422 . *",
    "assume that @xmath7 is datalog@xmath424-rewritable for eliq .",
    "let @xmath425 . for each @xmath422",
    ", choose a datalog@xmath138-rewriting @xmath426 of @xmath427 , assume w.l.o.g  that none of the chosen programs share any idb relations , and that the goal relation of @xmath426 is @xmath428 .",
    "let @xmath429 be the datalog@xmath138 program that consists of the rules of all the chosen programs , plus the following rule : @xmath430 the desired datalog@xmath138-rewriting of @xmath108 is obtained by taking the union of all the constructed datalog@xmath138 queries , which can again be expressed in datalog@xmath424 .    the implications from elqs to cqs for @xmath3-tboxes in points  ( 1 ) and  ( 2 ) follow in the same way since , then",
    ", each @xmath417 in @xmath414 consists of elqs only .    for the proof of claim  1 , we first require a technical observation that allows us to deal with subqueries that are not connected to an answer variable in the cq @xmath55 . to illustrate , consider the query @xmath431 . to prove claim  1 for @xmath432 , we have to find a set @xmath414 of pairs @xmath433 satisfying conditions ( i ) and ( ii ) . clearly , in this case the components @xmath434 will be empty and so we have to construct a finite set @xmath417 of eliqs such that for any abox @xmath29 , @xmath435 iff there exists an eliq @xmath422 and an assignment @xmath63 in @xmath34 such that @xmath421",
    ". an _ infinite _ set @xmath417 with this property",
    "is given by the set of all eliqs @xmath436 , where @xmath437 is a sequence @xmath438 of roles @xmath278 in @xmath7 and @xmath439 stands for @xmath440this follows immediately from the assumption that @xmath7 is materializable and that , by lemma  [ lem : count ] , for any abox @xmath29 that is consistent w.r.t .",
    "@xmath7 , there exists a generated cq - initial model of @xmath7 and abox @xmath29 .",
    "the following result states that it is sufficient to include in @xmath417 the set of all @xmath441 with @xmath437 of length bounded by @xmath442",
    ".    * claim 2 . *",
    "let @xmath83 be an @xmath10-concept and assume that @xmath443 .",
    "if @xmath7 is materializable , then there exists a sequence of roles @xmath444 with @xmath278 in @xmath7 and of length @xmath445 and an @xmath446 such that @xmath447 . if @xmath83 is an @xmath4-concept and @xmath7 an @xmath3-tbox , then the sequence @xmath437 consists of role names in @xmath448 .",
    "* proof of claim 2 .",
    "* let @xmath46 be a cq - materialization of @xmath7 and @xmath29 . by points  ( 3 ) and ( 5 ) of lemma  [ lem : propertiesofunfold ]",
    ", we may assume that @xmath46 is i - unfolded . from @xmath443",
    ", we obtain @xmath449 .",
    "let @xmath450 be minimal such that there are @xmath451 and @xmath452 with @xmath453 where @xmath454 denotes the length of the shortest path from @xmath243 to @xmath95 in the undirected graph @xmath455 .",
    "if @xmath456 , we are done .",
    "otherwise fix an @xmath451 and denote by @xmath457 the set all @xmath458 with @xmath459 .",
    "let @xmath460 with @xmath461 , @xmath462 , and @xmath281 for @xmath463 be the shortest path from @xmath95 to @xmath243 .",
    "observe that @xmath464 for @xmath465 since @xmath46 is a materialization of @xmath7 and @xmath29 .",
    "we now employ a pumping argument to show that this leads to a contradiction .",
    "let @xmath466 denote the closure under single negation of the set of subconcepts of concepts in @xmath7 and @xmath83 .",
    "set @xmath467 as @xmath468 , then there exist @xmath277 and @xmath469 with @xmath470 and @xmath471 such that @xmath472 now replace in @xmath46 the interpretation induced by the subtree rooted at @xmath473 by the interpretation induced by the subtree rooted at @xmath474 .",
    "we do the same construction for all elements of @xmath457 and denote the resulting interpretation by @xmath178 .",
    "one can easily show by induction that @xmath178 is still a model of @xmath7 and @xmath29 , but now @xmath475 and so @xmath476 .",
    "this contradiction finishes the proof of claim  2 . for @xmath4-concepts and @xmath3-tboxes ,",
    "claim  2 can be proved similarly by using an unfolded ( rather than i - unfolded ) materialization , which exists by points  ( 4 ) and ( 6 ) of lemma  [ lem : propertiesofunfold ] .",
    "* proof of claim  1 . *",
    "assume that @xmath7 and @xmath477 are given .",
    "we have to construct a set such that conditions  ( i ) and  ( ii ) are satisfied .",
    "let be an abox with @xmath72 , a materialization of @xmath7 and @xmath29 that is i - unfolded , and @xmath63 an assignment in @xmath46 such that @xmath478 .",
    "we define a corresponding pair @xmath479 to be included in ( and these are the only pairs in  ) .    for identifying @xmath480 , set @xmath481 if @xmath482 and denote by @xmath483 $ ] the equivalence class of @xmath75 w.r.t .",
    "`` @xmath484 '' .",
    "let @xmath485 be the set of all atoms @xmath486,[y])$ ] such that @xmath487 and there are @xmath488 $ ] and @xmath489 $ ] with @xmath490 in @xmath491 .",
    "we obtain @xmath79 by selecting an answer variable @xmath492 $ ] for every @xmath483 $ ] that contains such a variable and then replacing @xmath483 $ ] by @xmath76 in @xmath485 , adding @xmath493 to @xmath480 for any two ( selected ) answer variables @xmath494 with @xmath495 , and by regarding the remaining equivalences classes @xmath496 $ ] that do not contain answer variables as variables in @xmath497 .",
    "we now identify @xmath417 .",
    "assume w.l.o.g .  that uses the naming scheme of i - unravelings .",
    "let @xmath451 .",
    "by @xmath498 , we denote the subinterpretation of @xmath46 induced by the set of all elements @xmath499 .",
    "let @xmath457 be a maximal connected component of @xmath500 .",
    "we associate with @xmath457 an eliq to be included in ( and these are the only eliqs in  ) .",
    "the conjunctive query @xmath501 consists of all atoms @xmath486,[y])$ ] such that @xmath502 and there are @xmath488,y'\\in [ y]$ ] with @xmath490 in @xmath491 and all atoms @xmath503)$ ] such that @xmath504 and there is @xmath488 $ ] with @xmath505 in @xmath491 .",
    "we again assume that equivalence classes @xmath483 $ ] that contain an answer variable ( there is at most one such class in @xmath501 ) are replaced with an answer variable from @xmath483 $ ] and regard the remaining equivalences classes as variables .",
    "note that @xmath501 is tree - shaped since @xmath506 is .",
    "we can thus pick a variable @xmath507 with @xmath508 such that @xmath509 is minimal .",
    "let @xmath75 be @xmath510 $ ] if @xmath510 $ ] contains no answer variable and , otherise , let @xmath75 be the answer variable that @xmath510 $ ] has been replaced with .",
    "let @xmath511,\\ldots,[y_{m}]$ ] be the variables in @xmath512 that are distinct from @xmath75 and consider the eliq @xmath513\\cdots \\exists [ y_{m}]\\varphi_{m}(x,[y_{1}],\\ldots,[y_{m}])$ ] , which we write as @xmath514 where @xmath515 is an appropriate @xmath10-concept .",
    "we now distinguish the following cases :    * @xmath516 . in this case",
    ", we include @xmath514 in @xmath417 ; * otherwise , we still know that @xmath443 .",
    "thus , by claim  2 there is a sequence of roles @xmath444 with @xmath278 in @xmath7 and @xmath445 such that @xmath517 for some @xmath446 . in this case",
    ", we include @xmath518 in @xmath417 for some fresh individual variable  @xmath76 .",
    "this finishes the construction of and thus of .",
    "clearly , @xmath414 is finite .",
    "the stated properties of @xmath414 follow directly from its construction . for @xmath3-tboxes and elqs , claim  1",
    "can be proved similarly using an unfolded materialization ( instead of an i - unfolded one ) and the observation that in this case all @xmath519)$ ] and @xmath518 are elqs ( @xmath437 uses role names only by claim  2 ) .",
    "we now turn our attention to point  ( 3 ) . here , the `` if '' directions are trivial and we prove the `` only if '' part .",
    "it suffices to show that if peq - evaluation w.r.t .",
    "a tbox is conp - hard , then so is eliq - evaluation .",
    "we start with showing the slightly simpler result that conp - hardness of cq - evaluation w.r.t",
    ".   implies conp - hardness of ueliq - evaluation , and then sketch the modifications required to strengthen the proof to attain the original statement .",
    "thus assume that evaluating the cq @xmath55 w.r.t .",
    "is conp - hard .",
    "we shall exhibit an ueliq @xmath520 such that for every abox and all @xmath71 , one can produce in polynomial time an abox @xmath521 with a distinguished individual @xmath522 such that @xmath523 iff @xmath524 . instead of constructing @xmath525 right away",
    ", we will start with describing the translation of to @xmath521 .",
    "afterwards , it will be clear how to construct @xmath525 .    thus , let be an abox and @xmath109 from @xmath34 .",
    "the construction of @xmath521 builds on claim  1 above .",
    "let @xmath142 be the set of pairs from that claim and reserve a fresh individual name @xmath522 . to obtain the desired abox @xmath521 , we extend for every pair @xmath526 in .",
    "let @xmath527 .",
    "then    * introduce a fresh individual name @xmath528 and fresh role names @xmath529 ; * add the assertion @xmath530 ; * for every assignment @xmath63 in @xmath34 with @xmath531 and @xmath532 , introduce * * a fresh individual name @xmath533 and the assertion @xmath534 ; * * the assertion @xmath535 for @xmath536 .    from claim  1 ,",
    "it is immediate that @xmath523 iff @xmath537 where @xmath520 is the ueliq @xmath538 with @xmath539 thus , evaluating @xmath520 w.r.t .",
    "is conp - hard , as required .",
    "it remains to modify the reduction by replacing cqs with peqs and ueliqs with eliqs .",
    "the former is straightforward : every peq is equivalent to a finite disjunction of cqs , and thus we can construct @xmath521 and @xmath520 in essentially the same way as before ; instead of considering all pairs from for a single cq , we now use the union of all sets for the finitely many cqs in question . finally , we can replace ueliqs with eliqs by using the same construction as in the proof of theorem  [ thm : nomatlower ] : after adding some straightforward auxiliary structure to @xmath521 , one can replace a disjunction of eliqs by ( essentially ) their conjunction , which is again an eliq .",
    "details are left to the reader .",
    "we remark that theorem  [ equivalence ] can be extended to also cover rewritability into first - order ( fo ) queries , and that the proof is almost identical to that for datalog@xmath138-rewritability .",
    "we develop a condition on tboxes , called unraveling tolerance , that is sufficient for the tbox to be datalog@xmath133-rewritable for peq , and thus also sufficient for peq - evaluation w.r.t .",
    "the tbox being in ptime .",
    "unraveling tolerance strictly generalizes syntactic ` horn conditions ' such as the ones used to define the dl horn-@xmath540 , which was designed as a ( syntactically ) maximal dl with ptime query evaluation @xcite .",
    "unraveling tolerance is based on an unraveling operation on aboxes , in the same spirit as the unfolding of an interpretation into a tree interpretation we discussed above .",
    "formally , the _ unraveling _ @xmath541 of an abox is the following ( possibly infinite ) abox :    * @xmath542 is the set of sequences , with @xmath543 and @xmath544 such that for all @xmath545 , we have @xmath546 and @xmath547 when @xmath548 ; * for each @xmath549 and @xmath550 with @xmath551 , @xmath552 ; * for each @xmath553 with @xmath554 , @xmath555 .    for all @xmath556 , we write @xmath557 to denote  @xmath558 .",
    "note that the condition @xmath547 is needed to ensure that functional roles can still be interpreted in a functional way after unraveling .",
    "a tbox is _ unraveling tolerant _ if for all aboxes and eliqs @xmath408 , we have that @xmath559 implies @xmath560 .",
    "it is not hard to prove that the converse direction ` @xmath561 implies @xmath559 ' is true for _ all _ @xmath0-tboxes .",
    "note that it is pointless to define unraveling tolerance for queries that are not necessarily tree shaped , such as cqs .",
    "[ ex : unrav ]     ( 1 )  the -tbox @xmath562 is unraveling tolerant .",
    "this can be proved by showing that ( i )  for any ( finite or infinite ) abox , the interpretation @xmath563 that is obtained from @xmath29 by extending @xmath564 with all @xmath565 that satisfy @xmath566 in ( when viewed as an interpretation ) is an eliq - materialization of @xmath567 and ; and ( ii )  @xmath568 iff @xmath569 for all eliqs @xmath84 and @xmath570 .",
    "the proof of ( ii ) is based on a straightforward induction on the structure of the @xmath10-concept  @xmath83 . as illustrated by the abox @xmath571 and the fact that @xmath572 , the use of inverse roles in the definition of @xmath541 is crucial here despite the fact that @xmath567 does not use inverse roles .",
    "( 2 )  a simple example for an -tbox that is not unraveling tolerant is @xmath573 for @xmath574 , it is easy to see that we have @xmath575 ( use a case distinction on the truth value of @xmath14 at @xmath95 ) , but @xmath576 .    before we show that unraveling tolerance indeed implies query evaluation , we first demonstrate the generality of this property by relating it to horn- , the -fragment of horn- .",
    "different versions of horn-@xmath5 have been proposed in the literature , giving rise to different versions of horn-@xmath0 @xcite .",
    "as the original definition from @xcite based on polarity is rather technical , we prefer to work with the following equivalent and less cumbersome definition .",
    "horn-@xmath0-tbox _ is a finite set of concept inclusions @xmath577 and functionality assertions where @xmath578 and @xmath579 are built according to the following syntax rules : @xmath580",
    "l , l ' & : : = & \\top \\mid \\bot \\mid a \\mid l \\sqcap l ' \\mid l \\sqcup",
    "l ' \\mid \\exists r .",
    "l   \\end{array}\\ ] ] with @xmath16 ranging over @xmath581 and @xmath582 abbreviating @xmath583 .",
    "whenever convenient , we may assume w.l.o.g .  that contains only a single concept inclusion @xmath584 where @xmath585 is built according to the topmost rule above .",
    "by applying some simple transformations , it is not hard to show that every horn-@xmath0-tbox according to the original polarity - based definition is equivalent to a horn-@xmath0-tbox of the form introduced here .",
    "although not important in our context , we note that even a polynomial time transformation is possible .",
    "[ lem : hornalc ]   + every horn-@xmath0-tbox is unraveling tolerant .    as a preliminary ,",
    "we give a characterization of the entailment of eliqs in the presence of horn -- tboxes which is in the spirit of the chase procedure as used in database theory @xcite and of consequence - driven algorithms as used for reasoning in horn description logics such as @xmath586 and horn- @xcite .",
    "we use _ extended aboxes _ ,",
    "i.e. , finite sets of assertions @xmath587 and @xmath31 with @xmath83 a _ potentially compound _ concept .",
    "an _ @xmath588-concept _ is a concept that is formed according to the second syntax rule in the definition of horn- .",
    "for an extended abox @xmath521 and an assertion @xmath587 , @xmath83 an @xmath588-concept , we write @xmath589 if @xmath587 _ has a syntactic match _ in @xmath521 , formally :    * @xmath590 is unconditionally true ; * @xmath591 if @xmath592 for some @xmath593 ; * @xmath594 if @xmath595 ; * @xmath596 if @xmath589 and @xmath597 ; * @xmath598 if @xmath589 or @xmath597 ; * @xmath599 if there is an @xmath600 such that @xmath601 .    now for the announced characterization .",
    "let @xmath602 be a horn-@xmath0-tbox and @xmath29 a potentially infinite abox ( so that the characterization also applies to unravelings of aboxes ) .",
    "we produce a sequence of extended aboxes @xmath603 , starting with @xmath604 . in what follows",
    ", we use additional individual names of the form @xmath605 with @xmath606 , @xmath607 roles that occur in , and @xmath608 subconcept of concept in @xmath7 .",
    "we assume that contains such names as needed and use the symbols @xmath609 also to refer to individual names of this compound form .",
    "each extended abox @xmath610 is obtained from @xmath368 by applying the following rules in a fair way :    * if @xmath611 , then add @xmath612 . *",
    "if @xmath613 , then add @xmath587 and @xmath614 ; * if @xmath615 and @xmath616 , then add @xmath614 ; * if @xmath617 and @xmath618 , then add @xmath619 and @xmath620 ; * if @xmath617 , @xmath621 , and @xmath622 , then add @xmath623 ; * if @xmath617 , @xmath621 , and there is no @xmath622 , then add @xmath619 and @xmath620 ; * if @xmath624 and @xmath622 , then add @xmath623 .    let @xmath625 be the _ completion _ of the original abox . , but is irrelevant for the remainder of the proof . ] note that @xmath626 may be infinite even if @xmath29 is finite , and that none of the above rules is applicable in @xmath626 .",
    "we write ` @xmath627 ' instead of ` @xmath628 for some @xmath629 ' . if @xmath630 , then @xmath631 corresponds to an interpretation @xmath632 in the standard way , i.e. , @xmath633      a^{\\imc_c } & = & \\ { a \\mid a(a ) \\in \\amc_c \\ } & \\text{for all } a \\in \\nc\\\\[1 mm ]     r^{\\imc_c } & = & \\ { r(a , b ) \\mid r(a , b ) \\in   \\amc_c \\ } & \\text{for all } r     \\in \\nr % \\\\[1 mm ]     % a^\\imc & = & a & \\text{for all } a \\in \\mn{ind}(\\amc)\\\\[1 mm ]     % a^\\imc & = & a_\\top & \\text{for all } a \\in \\ni \\setminus \\mn{ind}(\\amc )    \\end{array}\\ ] ] where in @xmath632 we assume that only the individual names in @xmath34 are elements of @xmath634 .",
    "+ * claim  1*. if @xmath635 , then @xmath632 is a peq - materialization of @xmath7 and @xmath29 .",
    "+ to prove claim  1 it suffices to show that there is a homomorphism @xmath150 preserving @xmath34 into any model @xmath178 of @xmath7 and @xmath29 and that @xmath632 is a model of @xmath7 and @xmath29 .",
    "the homomorphism @xmath150 can be constructed inductively following the construction of @xmath631 .",
    "similarly , following the construction of @xmath631 it is readily checked that @xmath632 is a model of @xmath7 and @xmath29 . using claim  1 and the easily proved fact that @xmath635 iff @xmath29 is consistent w.r.t .",
    "@xmath7 one can now prove + * claim  2*. @xmath636 iff @xmath637 or @xmath627 , for all eliqs @xmath84 and @xmath638 .",
    "+ we now turn to the actual proof of theorem  [ lem : hornalc ] . consider the application of the above completion construction to both the original abox and its unraveling @xmath541 . recall that individuals in @xmath541 are of the form @xmath639 .",
    "consequently , individuals in @xmath640 take the form @xmath641 . for @xmath642 and @xmath643",
    ", we write @xmath644 if @xmath95 and @xmath645 are of the form @xmath646 and @xmath647 , respectively , with @xmath648 .",
    "note that , in particular , @xmath649 for all @xmath570 .",
    "the following claim can be shown by induction on @xmath650 .",
    "+ * claim  3*. for all @xmath611 and @xmath651 with @xmath644 , we have    1 .",
    "@xmath616 iff @xmath652 for all @xmath10-concepts @xmath83 ; 2 .   @xmath653 iff @xmath654 for all subconcepts @xmath83 of concepts in @xmath7 .",
    "now , unraveling tolerance of follows from claims  2 and  3 .",
    "theorem  [ lem : hornalc ] shows that unraveling tolerance and horn logic are closely related .",
    "yet , the next example demonstrates that there are unraveling tolerant -tboxes that are not equivalent to any horn sentence of fo . since any horn --",
    "tbox is equivalent to such a sentence , it follows that unraveling tolerant @xmath0-tboxes strictly generalize horn-@xmath0-tboxes .",
    "this increased generality will pay off in section  [ sect : depth1 ] when we establish a dichotomy result for tboxes of depth one .",
    "[ ref : matexa ] take the -tbox @xmath655 one can show as in example  [ ex : unrav ] ( 1 ) that is unraveling tolerant ; here , the materialization is actually @xmath29 itself rather than some extension thereof , i.e. , as far as eliq ( and even peq ) evaluation is concerned , can not be distinguished from the empty tbox .",
    "it is well - known that fo horn sentences are preserved under direct products of interpretations @xcite . to show that is not equivalent to any such sentence",
    ", it thus suffices to show that @xmath7 is not preserved under direct products .",
    "this is simple : let @xmath193 and @xmath194 consist of a single @xmath16-edge between elements @xmath243 and @xmath656 , and let @xmath657 and @xmath658 ; then the direct product of @xmath193 and @xmath194 still has the @xmath16-edge between @xmath659 and @xmath660 and satisfies @xmath661 , thus is not a model of .",
    "we next show that unraveling tolerance is indeed a sufficient condition for datalog@xmath133-rewritability ( and thus for query evaluation ) .",
    "in section  [ sect : dicho ] , we will establish a connection between query evaluation under dl tboxes and constraint satisfaction problems ( csps ) . the datalog@xmath138 program constructed in the proof of",
    "the following result resembles canonical monadic datalog programs for csps  @xcite .",
    "note that it is not clear how to attain a proof of theorem  [ thm : unravupperlem : hornalclem : hornalc ] via the csp connection : first , as we will also see in section  [ sect : dicho ] , functional roles break this connection ; and second , canonical datalog programs are available only for boolean queries while we construct programs for unary queries .",
    "[ thm : unravupperlem : hornalclem : hornalc ] every unraveling tolerant @xmath0-tbox is datalog@xmath133-rewritable for peq .",
    "let @xmath7 be an unraveling tolerant -tbox .",
    "by theorem  [ equivalence ] , it suffices to show that @xmath7 is datalog@xmath133-rewritable for eliq .",
    "let be an abox and @xmath662 an eliq .",
    "recall from the proof of theorem  [ equivalence ] that @xmath663 denotes the closure under single negation of the set of subconcepts of and @xmath664 . for an interpretation and @xmath665",
    ", we use @xmath666 to denote the set of concepts @xmath667 such that @xmath668 .",
    "@xmath669-type _ is a subset @xmath670 such that for some model of , we have @xmath671 .",
    "we use @xmath672 to denote the set of all , @xmath408-types . for @xmath673 and @xmath16 a role , we write @xmath674 if there are a model of and @xmath675 such that @xmath676 , @xmath677 , and @xmath678 .    introduce , for every set @xmath679 a unary idb relation @xmath680 . define a datalog@xmath133 program @xmath129 that consists of the following rules :    1 .",
    "@xmath681 for all concept names @xmath682 and @xmath683 ; 2 .",
    "@xmath684 for all @xmath685 and all role names @xmath16 that occur in @xmath663 and their inverses , where @xmath686 ; 3 .",
    "@xmath687 for all @xmath685 ; 4 .",
    "@xmath688 for all @xmath689 such that @xmath690 implies @xmath691 ; 5 .",
    "@xmath692 ; 6 .",
    "@xmath693 for all @xmath694 .",
    "to show that @xmath129 is a rewriting of the omq @xmath695 , it suffices to establish the following .",
    "+ * claim . * @xmath696 iff @xmath697 for all aboxes @xmath29 and @xmath698 .",
    "+ the `` if '' direction is straightforward : by induction on the number of rule applications , one can show that whenever @xmath129 derives @xmath699 , then every model of @xmath7 and @xmath29 satisfies @xmath700 . by definition of the goal rules of @xmath129 , @xmath701 thus implies that every model of and makes @xmath702 true or that is inconsistent w.r.t .",
    "@xmath7 . consequently , @xmath697 .    for",
    "the `` only if '' direction , it suffices to show that @xmath703 implies @xmath704 since is unraveling tolerant . because of the rules in @xmath129 of the form ( 3 ) , for every @xmath570 we can find a unique minimal @xmath705 such that @xmath706 is derived by @xmath129 .",
    "observe that , @xmath707 , @xmath708 , and @xmath709 implies @xmath710 because of the rules of the form ( 1 ) in @xmath129 and by construction of @xmath541 .",
    "we first associate with every @xmath711 a concrete @xmath669-type @xmath712 . to start ,",
    "we choose @xmath713 arbitrarily for all @xmath570 .",
    "now assume that @xmath714 has already been chosen and that @xmath715 . then @xmath716 .",
    "because of the rules in @xmath129 of the form ( 2 ) and ( 5 ) , we can thus choose @xmath717 such that @xmath718 . in this way , all types @xmath714 will eventually be chosen .",
    "we now construct an interpretation , starting with @xmath719    a^\\imc & = & \\ {   \\alpha \\mid a \\in t_\\alpha \\ } \\text { for all concept names } a\\\\[1 mm ]    r^\\imc & = & \\ { ( \\alpha,\\beta ) \\mid r(\\alpha,\\beta ) \\in \\amc^u \\ } \\text { for all role names } r. \\end{array}\\ ] ] next , consider every @xmath711 and every @xmath720 such that @xmath541 does not contain an assertion @xmath721 with @xmath722 .",
    "first assume that @xmath723 .",
    "there must be a @xmath669-type @xmath724 such that @xmath725 and @xmath726 .",
    "choose a model @xmath727 of and @xmath728 , a @xmath729 , and an @xmath730 with @xmath731 .",
    ", we can assume that @xmath727 is tree - shaped with root @xmath243 .",
    "let @xmath732 be obtained from @xmath727 by dropping the subtree rooted at @xmath656 .",
    "now disjointly add @xmath732 to , additionally including @xmath733 in  @xmath165 .",
    "now assume that @xmath734 .",
    "then , if there exists @xmath735 , then @xmath722 as otherwise we do not have @xmath736 . thus , assume there is no @xmath735 .",
    "there must be a @xmath669-type @xmath724 such that @xmath725 and @xmath726 .",
    "we then have @xmath737 for all @xmath738 and so construct only a single @xmath732 for the role @xmath16 and disjointly add @xmath732 to , additionally including @xmath733 in  @xmath165 .",
    "this finishes the construction of .",
    "the following claim can be proved by induction on @xmath83 , details are omitted .",
    "+ * claim . * for all @xmath739 :    * @xmath740 iff @xmath741 for all @xmath711 and * @xmath742 iff @xmath743 for all @xmath744 and all @xmath745 .    by construction of and since @xmath707 implies @xmath746 , is a model of . due to the rules in @xmath129 that are of the form ( 4 ) , point  ( a ) of the claim yields @xmath747",
    "finally , we observe that is a model of .",
    "the concept inclusions in are satisfied by the above claim , since @xmath748 means that @xmath726 implies @xmath749 for every @xmath669-type @xmath724 , and since each @xmath727 is a model of . due to the rules in @xmath129 that are of the form ( 6 ) and since each",
    "@xmath727 is a model of , all functionality assertions in are satisfied as well . summing up , we have shown that @xmath704 , as required .",
    "together with theorems  [ equivalence ] and  [ lem : hornalc ] , theorem  [ thm : unravupperlem : hornalclem : hornalc ] also reproves the known upper bound for the data complexity of cq - evaluation in horn-@xmath0 @xcite .    by theorems  [ thm : nomatlower ] and",
    "[ thm : unravupperlem : hornalclem : hornalc ] , unraveling tolerance implies materializability unless @xmath750 . based on the disjunction property , this implication can also be proved without the side condition .",
    "[ lem : utimpliesmat ] every unraveling tolerant @xmath0-tbox is materializable .",
    "we show the contrapositive using a proof strategy that is very similar to the second step in the proof of theorem  [ thm : nomatlower ] .",
    "thus , take an @xmath0-tbox that is not materializable . by theorem  [ thm :",
    "disjmat ] , does not have the disjunction property . thus , there are an abox @xmath335 , eliqs @xmath751 , and @xmath752 such that @xmath753 , but @xmath754 for all @xmath340 .",
    "let @xmath368 be @xmath755 viewed as a tree - shaped abox with root @xmath756 , for all @xmath340 .",
    "assume w.l.o.g .  that none of the aboxes @xmath757 share any individual names and reserve a fresh individual name @xmath96 and role names @xmath758",
    "that do not occur in .",
    "construct an abox @xmath759      & & \\displaystyle \\cup \\ , \\ { r_0(b_0,a_0),\\dots , r_k(b_k , a_k ) \\ }     \\end{array}\\ ] ] and an eliq @xmath760 by the following claim , @xmath29 and @xmath408 witness that is not unraveling tolerant .",
    "+ * claim . *",
    "@xmath761 , but @xmath762 .",
    "+ _ proof .",
    "_ `` @xmath761 '' .",
    "take a model of and . by construction of",
    ", we have @xmath763 whenever @xmath365 . due to the edges @xmath764 and since @xmath753",
    ", we thus find at least one @xmath756 such that @xmath765 .",
    "consequently , @xmath766 .",
    "`` @xmath767 '' ( sketch ) .",
    "consider the elements @xmath768 in @xmath541 .",
    "each such element is the root of a copy of the unraveling @xmath769 of @xmath335 , restricted to those individuals in @xmath335 that are reachable from @xmath770 .",
    "since @xmath754 , we find a model @xmath342 of and @xmath335 with @xmath771 . by unraveling ,",
    "we obtain a model @xmath772 of and @xmath773 with @xmath774 . combining the models @xmath775 in a suitable way , one can craft a model of and @xmath769 such that @xmath776 for all @xmath340 .",
    "consequently , @xmath777 .",
    "in practical applications , the concepts used in tboxes are often of very limited quantifier depth . motivated by this observation , we consider tboxes of _ depth one _ which are sets of cis @xmath51 such that the maximum nesting depth of the constructors @xmath778 and @xmath779 in @xmath83 and @xmath780 is one . to confirm that this is indeed a practically relevant case ,",
    "we have analyzed the 429 ontologies in the bioportal repository , finding that after removing all constructors that are not part of @xmath781 , more than 80% of them are of depth one .",
    "the main result of this section is a dichotomy between and conp for tboxes of depth one which is established by proving a converse of theorem  [ lem : utimpliesmat ] , that is , showing that materializability implies unraveling tolerance ( and thus query evaluation and even datalog@xmath133-rewritability by theorem  [ thm : unravupperlem : hornalclem : hornalc ] ) for tboxes of depth one . together with theorem  [ thm : nomatlower ] , which says that non - materializability implies conp - hardness , this yields the dichotomy .",
    "we remark that the same strategy can not be used to obtain a dichotomy in the case of unrestricted depth .",
    "in particular , the well - known technique of rewriting a tbox into depth one by introducing fresh concept names can change its complexity because it enables querying for concepts such as @xmath782 or @xmath783 which are otherwise ` invisible ' to ( positive existential ) queries . for tboxes of unrestricted depth ( and even in ) it is in fact neither the case that query evaluation implies unraveling tolerance nor that query evaluation implies datalog@xmath138 rewritability nor that materializability implies query evaluation . as an example for the former , we show in section  [ sect : dicho ] how the tbox @xmath784 from example  [ ex1 ] , which encodes 2-colorability , can be modified to have query evaluation .",
    "however , 2-colorability is not invariant under tree unravelings and , consequently , @xmath784 is not unraveling tolerant .",
    "also the latter two statements follow from results established in section  [ sect : dicho ] .",
    "[ thm : depthoneimpliesut ] every materializable @xmath0-tbox of depth one is unraveling tolerant .",
    "let be a materializable tbox of depth  one , an abox , @xmath375 an eliq , and @xmath785 such that @xmath786 .",
    "we have to show that @xmath787 .",
    "it follows from @xmath786 that @xmath541 is consistent w.r.t .  .",
    "there must thus be a materialization @xmath291 for and @xmath541 , despite the fact that @xmath541 is infinite : by theorem  [ thm : depthoneimpliesut ] , has the disjunction property and the argument from the proof of theorem  [ thm : depthoneimpliesut ] that the disjunction property implies materializability goes through without modification also for infinite aboxes .",
    "our aim is to turn @xmath291 into a model of and such that @xmath788 . to achieve this ,",
    "we first uniformize @xmath291 in a suitable way .",
    "we assume w.l.o.g .",
    "that @xmath291 has forest - shape , i.e. , that @xmath291 can be constructed by selecting a tree - shaped interpretation @xmath789 with root @xmath645 for each @xmath790 , then taking the disjoint union of all these interpretations , and finally adding role edges @xmath791 to @xmath792 whenever @xmath793 .",
    "in fact , to achieve the desired shape we can take the i - unfolding of @xmath291 defined and analysed in lemmas  [ lem : propertiesofunfold ] and  [ lem : sem ] , where we start the i - unfolding from the elements of @xmath794 . we start with exhibiting a self - similarity inside the unraveled abox @xmath541 and inside @xmath291 .",
    "+ * claim  1*. for all @xmath795 with @xmath796 ,    1 .",
    "@xmath797 iff @xmath798 for all eliqs @xmath84 ; 2 .",
    "@xmath799 iff @xmath800 for all concepts @xmath83 built only from concept names , @xmath801 , and @xmath802 .    to establish point  ( 1 ) , take @xmath795 such that @xmath796 and @xmath803 .",
    "then there is a model of @xmath541 and such that @xmath804 .",
    "one can find a model of @xmath541 and such that @xmath805 , as follows . by construction of @xmath541",
    ", there is an isomorphism @xmath806 with @xmath807 such that @xmath808 iff @xmath809 and @xmath810 iff @xmath811 for all @xmath812 , all concept names @xmath14 , and all role names @xmath16 .",
    "we obtain @xmath178 from by renaming each @xmath812 with @xmath813 .",
    "point  ( 2 ) can be proved by a straightforward induction on @xmath83 .",
    "the base case uses point  ( 1 ) and the fact that @xmath291 is a materialization of and .",
    "this finishes the proof of claim  1 .",
    "now for the announced uniformization of @xmath291 .",
    "what we want to achieve is that for all @xmath814 , @xmath796 implies @xmath815 ( recall that @xmath789 is the tree component of @xmath291 rooted at @xmath645 , and likewise for @xmath816 ) .",
    "construct the interpretation @xmath817 as follows :    * for each @xmath711 with @xmath708 , take a copy @xmath818 of @xmath506 with the root @xmath95 renamed to  @xmath645 ; * then @xmath817 is the disjoint union of all interpretations @xmath818 , @xmath711 , extended with a role edge @xmath819 whenever @xmath820 .",
    "our next aim is to show that @xmath817 is as required , that is , it is a model of @xmath7 and @xmath541 and satisfies @xmath821 .",
    "it is indeed straightforward to verify that @xmath817 is a model of @xmath541 : all role assertions are satisfied by construction ; moreover , @xmath707 implies @xmath822 where @xmath823 , thus @xmath824 and @xmath825 .",
    "next , we show that @xmath817 is a model of .",
    "let @xmath826 be a mapping that assigns to each domain element of @xmath817 the original element in @xmath291 of which it is a copy .",
    "+ * claim 2*. @xmath827 iff @xmath828 for all @xmath829 and -concepts @xmath83 of depth one .",
    "+ the proof of claim  2 is by induction on the structure of @xmath83 .",
    "we assume w.l.o.g .  that @xmath83 is built only from the constructors @xmath801 , @xmath802 , and @xmath181 .",
    "the base case , where @xmath83 is a concept name , is an immediate consequence of the definition of @xmath817 .",
    "the case where @xmath830 and @xmath831 is routine .",
    "it thus remains to consider the case @xmath832 , where @xmath780 is built from @xmath801 and @xmath802 only .",
    "first let @xmath827 .",
    "then there is a @xmath833 with @xmath834 .",
    "first assume that the edge @xmath835 was added to @xmath836 because @xmath837 and @xmath838 for some @xmath814 with @xmath793 .",
    "let @xmath708 and @xmath839 .",
    "then we have @xmath840 and @xmath841 . by construction of @xmath541",
    ", @xmath793 implies that @xmath842 or @xmath843 . in both cases we have @xmath148 , thus @xmath844 , thus @xmath845 . since @xmath846 , induction hypothesis yields that @xmath847 . from point",
    "( 2 ) of claim  1 , we obtain @xmath848 and we are done .",
    "now assume that there is an @xmath711 such that @xmath849 . by construction of @xmath817",
    ", we then have @xmath850 and induction hypothesis yields @xmath851 .",
    "now let @xmath828 .",
    "then there is an @xmath852 with @xmath853 .",
    "first assume that @xmath854 and @xmath838 for some @xmath814 with @xmath793 .",
    "since @xmath855 , we must have @xmath856 and @xmath857 with @xmath858 . by construction of @xmath541",
    ", @xmath859 implies that @xmath860 , thus @xmath148 , thus @xmath861 with ( i )  @xmath862 or ( ii )  @xmath863 and @xmath864 . since @xmath865 , point  ( 2 ) of claim  1 yields @xmath866 . since @xmath864 implies @xmath867 , induction hypothesis yields @xmath868 and we are done .",
    "now assume that there is an @xmath711 such that @xmath869 . by construction of @xmath817 , @xmath870",
    "being in @xmath789 implies that @xmath871 for some @xmath570 and that there is an @xmath872 such that @xmath243 is in @xmath873 and @xmath874 .",
    "again by construction of @xmath817 , we thus find an @xmath875 in @xmath873 with @xmath876 and @xmath877 .",
    "induction hypothesis yields @xmath878 .",
    "this finishes the proof of claim  2 .",
    "it follows from claim  2 that @xmath817 satisfies all cis in . to show that @xmath817 is a model of , it remains to show that @xmath817 satisfies all functionality assertions .",
    "thus , let @xmath879 and @xmath880 .",
    "if @xmath881 , then it is straightforward to verify that , by construction of @xmath817 , @xmath243 has at most one @xmath16-successor in @xmath817 .",
    "now assume @xmath882 and let @xmath708 .",
    "by construction of @xmath817 and @xmath541 , @xmath645 has the same number of @xmath16-successors in @xmath817 as @xmath95 in @xmath291 .",
    "since @xmath291 satisfies @xmath883 , @xmath645 can have at most one @xmath16-successor in  @xmath817 .",
    "the final condition that @xmath817 should satisfy is @xmath821 .",
    "assume to the contrary .",
    "we view @xmath884 as a ( tree - shaped ) cq .",
    "take a homomorphism @xmath150 from @xmath884 to @xmath817 with @xmath885 .",
    "( in this proof we consider homomorphisms that do not have to preserve any individual names . )",
    "let the cq @xmath353 be obtained from @xmath884 by identifying variables @xmath886 whenever @xmath887 . to achieve a contradiction , it suffices to exhibit a homomorphism @xmath888 from @xmath889 to @xmath291 with @xmath890 .",
    "we start with setting @xmath891 whenever @xmath892 .",
    "let @xmath893 be obtained from @xmath889 by dropping all role atoms @xmath58 with @xmath894 and @xmath895 already defined ( which are satisfied under @xmath888 by construction of @xmath817 and since @xmath291 is a model of ) . because of the forest shape of @xmath817 and by construction , @xmath893 is a disjoint union of eliqs such that , in each eliq @xmath84 contained in @xmath893 , @xmath888 is defined for the root @xmath75 of @xmath84 , but not for any other variable in it .",
    "consequently , it suffices to show that whenever @xmath896 for some eliq @xmath84 and @xmath711 , then @xmath897 ; the remaining part of @xmath888 can then be constructed in a straightforward way .",
    "now @xmath896 implies @xmath898 where @xmath823 by choice of @xmath818 , which yields @xmath899 and thus @xmath897 by point  ( 1 ) of claim  1 .",
    "this finishes the construction and analysis of the uniform model @xmath817 .",
    "it remains to convert @xmath817 into a model of and the original abox such that @xmath900 :    * take the disjoint union of the components @xmath901 of @xmath817 , for each @xmath570 ; * add the edge @xmath902 to @xmath48 whenever @xmath903 .",
    "it is straightforward to verfiy that is a model of : all role assertions are satisfied by construction of ; moreover , @xmath146 implies @xmath822 implies @xmath904 implies @xmath905 . to show that is a model of and that @xmath747 , we first observe the following . a _",
    "bisimulation between interpretations @xmath193 and @xmath194 _ is a relation @xmath195 such that    1 .   for all @xmath59 and @xmath197 :",
    "@xmath906 iff @xmath198 ; 2 .   for all @xmath907 :",
    "if @xmath197 and @xmath199 , then there exists @xmath200 such that @xmath201 and @xmath202 ; 3 .   for all @xmath907 :",
    "if @xmath197 and @xmath202 , then there exists @xmath908 such that @xmath201 and @xmath909 .",
    "recall that , whenever there is a bisimulation @xmath125 between @xmath193 and @xmath194 with @xmath910 , then @xmath911 iff @xmath912 for all -concepts @xmath83 @xcite .",
    "+ * claim 3*. there is a bisimulation @xmath125 between @xmath817 and @xmath46 such that @xmath205 for all @xmath570 .",
    "+ since @xmath817 is uniform in the sense that @xmath818 is isomorphic to @xmath913 whenever @xmath796 , we find a bisimulation between @xmath818 and @xmath914 whenever @xmath708 .",
    "it can be verified that the union of all these bisimulations qualifies as the desired bisimulation @xmath125 for claim  3 .",
    "thus , claim  3 is proved .",
    "it follows from claim  3 that @xmath46 satisfies all concept inclusions in , and that @xmath747 .",
    "it thus remains to verify that also satisfies all functionality assertions in .",
    "this can be done in the same way in which we have verified that @xmath817 satisfies all those assertions .",
    "the desired dichotomy follows : if an @xmath0-tbox of depth one is materializable , then peq - evaluation w.r.t .",
    "is in ptime and datalog@xmath133-rewritable by theorems  [ thm : depthoneimpliesut ] and  [ thm : unravupperlem : hornalclem : hornalc ] .",
    "otherwise , eliq - evaluation w.r.t .",
    "is conp - complete by theorem  [ thm : nomatlower ] .",
    "[ thm : depthonedicho ] for every @xmath915-tbox of depth one , one of the following is true :    * -evaluation w.r.t .",
    "is in for any @xmath916peq@xmath917cq@xmath917eliq@xmath918 ( and datalog@xmath133-rewritable ) ; * -evaluation w.r.t .",
    "is conp - complete for any @xmath919peq@xmath917cq@xmath917eliq@xmath918 .",
    "we show that query evaluation w.r.t .",
    "@xmath1- and @xmath2-tboxes has the same computational power as non - uniform csps in the following sense :    1 .   for every csp",
    ", there is an -tbox @xmath7 such that the csp can be reduced in polynomial time to the complement of evaluating an omq @xmath921 and , conversely , for _ every _ omq @xmath922 query evaluation can be reduced in polynomial time to the csp s complement ; 2 .   for every omq @xmath922 with @xmath7 an -tbox and @xmath408 an eliq , there is a csp such that the complement of the csp and the query evaluation problem for the @xmath922 are reducible to each other in polynomial time .",
    "this result has many interesting consequences .",
    "in particular , the feder - vardi conjecture holds if and only if there is a ptime / conp - dichotomy for query evaluation w.r.t.@xmath1-tboxes ( equivalently : w.r.t .",
    "@xmath2-tboxes ) .",
    "remarkably , all this is true already for _ materializable _ tboxes . by theorem",
    "[ equivalence ] and since we carefully choose the appropriate query language in each technical result below , it furthermore holds for any of the query languages eliq , cq , and peq ( and elq for -tboxes ) .",
    "we begin by introducing csps . since every csp is equivalent to a csp with a single predicate that is binary , up to polynomial time reductions @xcite , we consider csps over unary and binary predicates ( concept names and role names ) only .",
    "a _ signature _",
    "@xmath215 is a finite set of concept and role names .",
    "an abox @xmath29 is a _ @xmath215-abox _",
    "if all concept and role names in @xmath29 are in @xmath215 .",
    "for two finite @xmath215-aboxes @xmath29 and @xmath923 , we write @xmath924 if there is a homomorphism from @xmath925 to @xmath926 that does not have to preserve any individual names .",
    "any @xmath215-abox @xmath923 gives rise to the following ( non - uniform ) constraint satisfaction problem    * @xmath927 : given a finite @xmath215-abox @xmath925 , decide whether @xmath928 .",
    "@xmath923 is called the _ template _ of @xmath929 .",
    "many algorithmic problems can be given in the form @xmath927 .",
    "for example , @xmath105-colorability is @xmath930 , where @xmath931 is the @xmath932-abox containing @xmath933 for all @xmath934 .",
    "we now formulate and prove points ( 1 ) and ( 2 ) from above , starting with ( 1 ) .",
    "[ thm : red0 ] for every template , one can construct in polynomial time a materializable @xmath1-tbox @xmath935 such that , for a distinguished concept name @xmath457 , the following hold :    1 .",
    "@xmath929 is polynomial time reducible to the complement of the query evaluation problem for @xmath936 ; 2 .",
    "the query evaluation problem for @xmath937 is polynomial time reducible to the complement of @xmath927 , for all peqs @xmath408 .",
    "our approach to proving theorem  [ thm : red0 ] is to generalize the reduction of @xmath105-colorability to query evaluation w.r.t .",
    "-tboxes discussed in examples  [ ex1 ] and  [ ex3 ] , where the main challenge is to overcome the observation from example  [ ex3 ] that csps such as 2-colorability may be translated into conp - hard tboxes .",
    "note that this is due to the disjunction in the tbox @xmath143 of example  [ ex1 ] , which causes non - materializability .",
    "our solution is to replace the concept names @xmath938 in @xmath143 with suitable compound concepts that are ` invisible to the ( positive existential ) query ' . unlike the original depth one tbox @xmath143 , the resulting tbox is of depth three .",
    "we first define and analyze the replacement of concept names by compound concepts in some detail ( as this will be reused later in the paper again ) and then return to the proof of theorem  [ thm : red0 ] .",
    "let @xmath215 be a set of concept names .",
    "for any @xmath939 , let @xmath940 be a fresh concept name and let @xmath941 and @xmath942 be fresh role names .",
    "the _ abstraction of @xmath943 _ is the @xmath1-concept @xmath944 .",
    "@xmath215-abstraction @xmath945 of a ( potentially compound ) concept @xmath83 _ is obtained from @xmath83 by replacing every @xmath939 with  @xmath946 .",
    "the _ @xmath215-abstraction of a tbox @xmath7 _ is obtained from @xmath7 by replacing all concepts in @xmath7 with their @xmath215-abstractions .",
    "we associate with @xmath215 an auxiliary tbox @xmath947 finally , @xmath948 is called the _ enriched @xmath215-abstraction _ of @xmath7 and @xmath215 . in",
    "what follows , we are going to replace tboxes @xmath7 with their enriched abstractions .",
    "the following example shows that the tbox @xmath949 is crucial for hiding the concept names in @xmath215 : without @xmath950 , disjunctions in over concept names from @xmath215 can still induce disjunctions in the @xmath215-abstraction .",
    "[ ex : abstraction ] let @xmath951 and @xmath952 .",
    "then @xmath953 is the @xmath215-abstraction of @xmath7 . for @xmath954",
    ", we derive @xmath955 but @xmath956 and @xmath957 .",
    "thus @xmath958 does not have the abox disjunction property and is not materializable .",
    "in contrast , it follows from lemma  [ lem : abstraction ] below that @xmath948 is materializable and , in fact , @xmath959 iff @xmath960 holds for all peqs @xmath408 .",
    "we say that a tbox @xmath7 _ admits trivial models _ if the singleton interpretation @xmath46 with @xmath961 for all @xmath962 is a model of @xmath7 .",
    "moreover , we write @xmath963 to denote the abox obtained from the abox @xmath29 by removing all assertions in @xmath29 that use a symbol that is not in @xmath215 , and likewise for @xmath964 and symbols that are in @xmath215 . an abox @xmath29 is _",
    "strongly @xmath965-consistent w.r.t .  a tbox @xmath7 _ if there exists a model @xmath46 of @xmath7 and @xmath966 such that @xmath967 , @xmath968 for all @xmath969 , and @xmath970 for all role names @xmath971 .",
    "thus , strong @xmath965-consistency formalizes the intuition that we regard the symbols in @xmath215 as existentially quantified second - order variables .",
    "the following lemma summarizes the main properties of abstractions .",
    "points  ( 1 ) and ( 2 ) establish a close link between the original tbox and its enriched abstraction .",
    "points  ( 3 ) and ( 4 ) together state that query evaluation is tractable for the enriched abstraction of a tbox @xmath7 for aboxes that are strongly @xmath965-consistent w.r.t .  @xmath7 .",
    "[ lem : abstraction ] assume that @xmath7 admits trivial models and let @xmath215 be a finite set of concept names and @xmath972 the enriched @xmath215-abstraction of .",
    "then for every abox @xmath29 and all @xmath2 concepts @xmath83 not using the fresh symbols from @xmath215-abstractions :    1 .",
    "@xmath966 is consistent w.r.t .",
    "@xmath7 iff @xmath29 is consistent w.r.t .",
    "@xmath948 ; 2 .   for all @xmath446 and the @xmath215-abstraction @xmath945 of @xmath83 : @xmath973 and if @xmath83 is a concept name : @xmath974 3 .",
    "@xmath949 is datalog@xmath133-rewritable for peqs ; 4 .   if @xmath29 is strongly @xmath965-consistent w.r.t .",
    "@xmath7 , then @xmath975 for all peqs @xmath408 and all @xmath109 .",
    "observe that ( 1 ) follows from ( 2 ) as we can choose @xmath976 .",
    "thus we prove ( 2 ) .",
    "let @xmath945 be the @xmath215-abstraction of @xmath83 .",
    "we first consider ( @xmath209 ) .",
    "assume @xmath977 .",
    "take a model @xmath46 of @xmath948 and @xmath29 that witnesses this .",
    "define an interpretation @xmath178 in the same way as @xmath46 except that @xmath978 for all @xmath939 .",
    "it is straightforward to show for all @xmath175 that @xmath979 iff @xmath980 holds for all @xmath2-concepts @xmath780 not using the fresh symbols from @xmath215-abstractions and their @xmath215-abstractions @xmath981 .",
    "thus @xmath178 is a model of @xmath7 and @xmath966 and shows that @xmath982 if @xmath977 .",
    "the same proof shows that ( @xmath209 ) holds for queries of the form @xmath983 and @xmath984 as well ( even if @xmath83 is not a concept name ) .",
    "now consider ( @xmath985 ) .",
    "assume @xmath982 or @xmath986 ( where @xmath14 is a concept name ) .",
    "let @xmath46 be a model of @xmath7 and @xmath966 that witnesses this .",
    "construct a model @xmath987 of @xmath948 and @xmath29 as follows : @xmath988 is the set of words @xmath989 such that @xmath175 and @xmath990 where @xmath991 if ( i ) @xmath992 or ( ii ) @xmath993 and ( @xmath994 or @xmath995 ) .",
    "now let @xmath996 by construction of @xmath987 , we have @xmath997 for all @xmath939 .",
    "thus for all concepts @xmath780 ( not using symbols from @xmath215-abstractions ) and their @xmath215-abstractions @xmath981 and all @xmath175 , we have @xmath998 iff @xmath999 .",
    "thus , the cis of @xmath958 hold in all @xmath175 since the cis of @xmath7 hold in all @xmath175 .",
    "the cis of @xmath958 also hold in all @xmath1000 since @xmath7 admits trivial models .",
    "thus @xmath987 is a model of @xmath958 .",
    "since @xmath987 is a model of @xmath949 by construction , it follows that @xmath987 is a model of @xmath948 .",
    "it also follows that @xmath987 shows @xmath977 if @xmath46 shows that @xmath982 and that @xmath987 shows that @xmath1001 if @xmath46 shows that @xmath1002 .",
    "\\(3 ) is a consequence of the fact that @xmath950 can be viewed as a tbox formulated in the description logic dl - lite@xmath1003 and that any omq @xmath922 with a dl - lite@xmath1003-tbox and @xmath408 a peq is known to be rewritable into a union of cqs  @xcite .",
    "\\(4 ) assume that @xmath29 is strongly @xmath965-consistent w.r.t .",
    "@xmath7 and that @xmath1004 .",
    "we show @xmath1005 .",
    "note first that one can construct a hom - initial model @xmath1006 of @xmath949 and @xmath29 in the same way as @xmath987 was constructed from @xmath46 above ( by replacing @xmath46 with the interpretation @xmath1007 corresponding to @xmath29 and not using the symbols @xmath1008 in the construction ) .",
    "thus , @xmath1009 is the set of words @xmath1010 such that @xmath446 and @xmath1011 .",
    "we have @xmath1012 .",
    "now , as @xmath29 is strongly @xmath965-consistent w.r.t .",
    "@xmath7 , there is a model @xmath46 of @xmath7 and @xmath966 with @xmath967 and @xmath1013 for all @xmath969 , and @xmath1014 for all role names  @xmath16 .",
    "construct the model @xmath987 of @xmath948 and @xmath29 in the same way as in the proof of ( 2 ) .",
    "define a mapping @xmath1015 by setting @xmath1016 , where @xmath1017 is obtained from @xmath1018 by replacing every @xmath1008 by @xmath942 .",
    "one can show that @xmath150 is a homomorphism .",
    "thus @xmath1019 and so @xmath1020 , as required .",
    "the converse direction is trivial .",
    "we are now ready to prove theorem  [ thm : red0 ] .",
    "* proof of theorem  [ thm : red0]*. assume a @xmath1021-template @xmath923 is given .",
    "we construct the tbox @xmath1022 in two steps .",
    "first take for any @xmath1023 a concept name @xmath1024 and define a tbox @xmath1025 with the following cis : @xmath1026     a_{d } \\sqcap a_{e } & \\sqsubseteq & \\bot & \\hspace*{-6 mm } \\text{for all } d , e\\in { \\sf ind}(\\bmc ) , d\\not = e \\\\[1 mm ]    a_{d } \\sqcap \\exists r. a_{e } & \\sqsubseteq & \\bot & \\hspace*{-6 mm } \\text{for all } d , e\\in { \\sf ind}(\\bmc ) , r \\in \\sigma_{0 } , r(d , e)\\not\\in \\bmc\\\\[1 mm ]    a_d \\sqcap a & \\sqsubseteq & \\bot & \\hspace*{-6 mm } \\text{for all } d\\in { \\sf ind}(\\bmc ) , a \\in \\sigma_{0 } , a(d)\\not\\in \\bmc . \\end{array}\\ ] ] here @xmath1027 stands for the set of cis @xmath1028 where @xmath16 and @xmath14 range over all role and concept names in @xmath1021 , respectively .",
    "we use a ci of the form @xmath1029 rather than @xmath1030 to ensure that the tbox @xmath1031 admits trivial models .",
    "let @xmath457 be a fresh concept name and set @xmath1032 .",
    "then the following can be proved in a straightforward way .",
    "* claim 1 . * for any abox @xmath29 the following conditions are equivalent :    1 .",
    "@xmath1033 ; 2 .",
    "@xmath966 is consistent w.r.t .",
    "@xmath1025 ; 3 .",
    "@xmath1034 .",
    "thus , @xmath929 and the complement of the query evaluation problem for @xmath1035 are reducible to each other in polynomial time . because of the disjunctions , however , the query evaluation problem w.r.t  @xmath1025 is typically conp - hard even if @xmath929 is in .",
    "we thus ` hide ' the concept names @xmath1024 by replacing them with their abstractions @xmath1036 .",
    "let @xmath1037 be the enriched @xmath215-abstraction of @xmath1025 . from claim  1 and lemma  [ lem : abstraction ] ( 1 ) according to which @xmath966 is consistent w.r.t .",
    "@xmath1025 iff @xmath29 is consistent w.r.t .",
    "@xmath1038 , we obtain    * claim 2 . * for any abox @xmath29 , the following conditions are equivalent :    1 .",
    "@xmath1039 ; 2 .",
    "@xmath29 is consistent w.r.t .",
    "@xmath1038 ; 3 .",
    "@xmath1034 .",
    "let @xmath1040 be the enriched @xmath215-abstraction of @xmath1031 .",
    "we show that @xmath1022 is as required to prove theorem  [ thm : red0 ] .",
    "\\(1 ) we have to show that @xmath929 is reducible in polynomial time to the complement of the query evaluation problem for @xmath1041 . but given a @xmath1021-abox @xmath29 , we have by claim  2 that @xmath924 iff @xmath1042 . ( 2 ) for the converse reduction ,",
    "let @xmath408 be a peq .",
    "we have to show that the query evaluation problem for @xmath937 is reducible in polynomial time to the complement of @xmath927 .",
    "let be an abox and @xmath109 from @xmath1043 .",
    "we show that the following are equivalent :    * @xmath1044 ; * @xmath1045 or @xmath1046 .    regarding ( b )",
    ", we remark that by lemma  [ lem : abstraction ] ( 3 ) @xmath1046 can be checked in polynomial time and thus can be checked as part of the reduction .",
    "first assume that ( a ) holds . if @xmath1034 , then by claim  1 the abox @xmath966 is consistent w.r.t",
    ".  @xmath1025 .",
    "thus there is a model @xmath46 of @xmath1025 and @xmath966 satisfying @xmath967 and @xmath1047 for all concept names @xmath1048 and @xmath1049 for all role names @xmath16 .",
    "thus , @xmath29 is strongly @xmath965-consistent w.r.t .  @xmath1025 . by lemma  [ lem : abstraction ]",
    "( 4 ) we have @xmath1044 iff @xmath1046 for all peqs @xmath408 and all @xmath109 , as required .",
    "conversely , assume ( b ) holds . if @xmath1050 , then by claim  2 @xmath29 is not consistent w.r.t .",
    "@xmath1022 and so @xmath1044 . if @xmath1046 , then @xmath1044 since @xmath1051 .",
    "the following converse of theorem  [ thm : red0 ] is proved in @xcite .",
    "[ thm : tods ] for every @xmath2-tbox @xmath7 and eliq @xmath84 , one can compute a template @xmath923 in exponential time such that the query evaluation problem for @xmath427 and the complement of @xmath929 are polynomial time reducible to each other .    the proof of theorem  [ thm : tods ] given in @xcite proceeds in two steps . to deal with answer variables ,",
    "it uses _ generalized csps with constants _ , defined by a finite set of templates ( instead of a single one ) and admitting the inclusion of constant symbols in the signature of the csp ( instead of only relation symbols ) .",
    "one shows that ( i ) for every omq @xmath427 , one can construct a generalized csp with a single constant whose complement is mutually reducible in polynomial time with the query evaluation problem for @xmath427 and ( ii ) every generalized csp with constants is mutually reducible in polynomial time with some standard csp . for the reader s",
    "convenience , we illustrate the construction of the template from a given omq , concentrating on _ boolean eliqs _ which are of the form @xmath983 with @xmath84 an eliq . in this special case , one can avoid the use of generalized csps with constants .",
    "[ thm : red2 ] let @xmath7 be an @xmath2-tbox , @xmath1052 with @xmath83 an @xmath1053 , and @xmath215 the signature of and @xmath408",
    ". then one can construct ( in time single exponential in @xmath1054 ) a @xmath215-template @xmath1055 such that for all aboxes  @xmath29 : @xmath1056    assume @xmath7 and @xmath1052 are given .",
    "we use the notation from the proof of theorem  [ thm : unravupperlem : hornalclem : hornalc ] .",
    "thus , @xmath1057 denotes the closure under single negation of the set of subconcepts of @xmath7 and @xmath83 , @xmath672 denotes the set of @xmath669-types and for @xmath1058 we write @xmath1059 if @xmath724 and @xmath1060 can be satisfied in domain elements of a model of @xmath7 that are related by @xmath16 .",
    "now , a _ @xmath669-type @xmath724 omits  @xmath408 _ if it is satisfiable in a model @xmath46 of @xmath7 with @xmath1061 .",
    "let @xmath1055 be the set of assertions @xmath1062 such @xmath724 omits @xmath408 and @xmath1063 and @xmath1064 such that @xmath724 and @xmath1060 omit @xmath408 and @xmath674 .",
    "it is not difficult to show that condition @xmath1065 holds for all aboxes @xmath29 .",
    "observe that @xmath1055 can be constructed in exponential time since the set of @xmath669-types omitting @xmath408 can be constructed in exponential time .",
    "let @xmath1066 and define @xmath1067 .",
    "then @xmath1055 is defined , up to isomorphism , as @xmath1068 .    as a consequence of theorems  [ thm : red0 ] and  [ thm : tods ] ,",
    "we obtain the following .",
    "there is a dichotomy between ptime and conp for cq - evaluation w.r.t .",
    "@xmath1-tboxes if and only if the feder - vardi conjecture is true .",
    "the same is true for @xmath2-tboxes , for eliqs , and for peqs . for -tboxes",
    ", it additionally holds for elqs .",
    "let @xmath1069 be an -intermediate csp , i.e. , a csp that is neither in ptime nor -hard .",
    "take the tbox @xmath1070 from theorem  [ thm : red0 ] . by point  1 of that theorem , cq - evaluation w.r.t .",
    "is not in . by point  2 ,",
    "cq - evaluation w.r.t .",
    "@xmath1022 is not conp - hard .",
    "conversely , let be an -tbox for which cq - evaluation w.r.t .",
    "is neither in ptime nor conp - hard",
    ". then by theorem  [ equivalence ] , the same holds for eliq - evaluation w.r.t .  .",
    "it follows that there is a concrete eliq  @xmath408 such that query evaluation for @xmath922 is conp - intermediate . by theorem  [ thm : tods ] , there is a template @xmath923 such that evaluating @xmath922 is mutually reducible in polynomial time with the complement of @xmath1069 .",
    "thus @xmath1069 is -intermediate , as required .",
    "observe that the tbox constructed in the proof of theorem  [ thm : red0 ] has depth three .",
    "thus , a dichotomy between ptime and conp for cq - evaluation w.r.t .",
    "@xmath1-tboxes of depth three would imply that the feder - vardi conjecture is true . on the other hand ,",
    "we have proved a dichotomy between ptime and conp for cq - evaluation w.r.t .",
    "@xmath1071-tboxes of depth one .",
    "the behavior of tboxes of depth two remains open .",
    "we show that the complexity landscape of query evaluation w.r.t .- tboxes is much richer than for @xmath2 , and in fact too rich to be fully manageable .",
    "in particular , we prove that for cq - evaluation , there is no dichotomy between and conp ( unless @xmath1072=@xmath1072 ) .",
    "we also establish that materializability , datalog@xmath133-rewritability , query evaluation , and conp - hardness of query evaluation are undecidable .",
    "we start with the undecidability proofs , which are by reduction of an undecidable rectangle tiling problem and reuse the ` hidden concepts ' introduced in the previous section .",
    "next , the tbox from that reduction is adapted to prove the non - dichotomy result by an encoding of the computations of nondeterministic polynomial time turing machines ( and again using hidden concepts ) . the basis for the technical development in this section is a tbox constructed in @xcite to prove the undecidability of _ query emptiness _ in .",
    "an instance of the finite rectangle tiling problem is given by a triple @xmath1073 with @xmath1074 a finite set of _ tile types _ including an _ initial tile _",
    "@xmath1075 to be placed on the lower left corner and a _ final tile _",
    "@xmath1076 to be placed on the upper right corner , @xmath1077 a _ horizontal matching relation _ , and @xmath1078 a _ vertical matching relation_. a _ tiling _ for @xmath1079 is a map @xmath1080 such that @xmath1081 , @xmath1082 , @xmath1083 , @xmath1084 for all @xmath1085 , and @xmath1086 for all @xmath1087 .",
    "we say that @xmath1088 _ admits a tiling _ if there exists a map @xmath352 that is a tiling for @xmath1088 .",
    "it is undecidable whether an instance of the finite rectangle tiling problem admits a tiling .",
    "now let @xmath1073 be a finite rectangle tiling problem with @xmath1089 .",
    "we regard the tile types in @xmath1090 as concept names and set @xmath1091 , where @xmath75 , @xmath76 , @xmath1092 , and @xmath1093 are _ functional _ role names .",
    "the tbox @xmath1094 is defined as the following set of cis , where @xmath1095 range over all triples from such that @xmath1096 and @xmath1097 and where for @xmath1098 the concept @xmath1099 ranges over all conjunctions @xmath1100 with @xmath1101 , for concept names @xmath1102  ( @xmath1103 ) : @xmath1104     b_x \\sqcap \\exists x. \\exists \\hat{x}. b_{x } & \\sqsubseteq   i_x \\\\",
    "b_y \\sqcap \\exists y. \\exists \\hat{y}. b_{y } & \\sqsubseteq   i_y \\\\    \\exists x .",
    "\\exists y .",
    "b_c \\sqcap \\exists y . \\exists x . b_c    & \\sqsubseteq c \\\\",
    "\\midsqcup_{1 \\leq s < t \\leq p } t_s",
    "\\sqcap t_t   & \\sqsubseteq   \\bot    \\end{aligned}\\ ] ] @xmath1105 @xmath1106 with the exception of the cis in the last line , the tbox @xmath1094 has been defined and analyzed in @xcite . here , we briefly give intuition and discuss its main properties .",
    "the role names @xmath75 and @xmath76 are used to represent horizontal and vertical adjacency of points in a rectangle .",
    "the role names @xmath1092 and @xmath1093 are used to simulate the inverses of @xmath75 and @xmath76 .",
    "the concept names in @xmath1094 serve the following puroposes :    * @xmath1107 , @xmath579 , @xmath578 , and @xmath780 mark the upper , right , left , and lower ( ` down ' ) border of the rectangle .",
    "* in the @xmath1108 concepts , the concept names @xmath1109 and @xmath1110 serve as second - order variables and ensure that a flag @xmath83 is set at positions where the grid cell is closed . * in the concepts @xmath1111 and @xmath1112 , the concept names @xmath1113 also serve as second - order variables and ensure that flags @xmath1114 and @xmath1115 are set at positions where @xmath75 and @xmath1092 as well as @xmath76 and @xmath1093 are inverse to each other . * the concept name @xmath1116 is propagated through the grid from the upper right corner to the lower left one , ensuring that these flags are set everywhere , that every position of the grid is labeled with at least one tile type , and that the horizontal and vertical matching conditions are satisfied . * finally ,",
    "when the lower left corner of the grid is reached , the concept name @xmath14 is set as a flag .    because of the use of the concepts @xmath1099 , cq evaluation w.r.t .",
    "@xmath1094 is conp - hard : we leave it as an exercise to the reader to verify that @xmath1117 does not have the abox disjunction property . @xmath1094 without the three cis involving the concepts @xmath1099 , however , is ( equivalent to ) a horn-@xmath3 tbox and thus enjoys cq - evaluation .",
    "it can also be verified that @xmath1094 admits trivial models .",
    "call a @xmath1118-abox @xmath29 an _ grid abox ( with initial individual @xmath95 ) _ if @xmath29 represents a grid along with a proper tiling for  @xmath1088 .",
    "in detail , we require that there is a tiling @xmath352 for @xmath1088 with domain @xmath1119 and a bijection @xmath1120 with @xmath1121 such that    * for all @xmath1122 , @xmath1123 : @xmath1124 iff @xmath1125 ; * for all @xmath1126 : @xmath1127 iff @xmath1128 iff there are @xmath1122 , @xmath1123 such that @xmath1129 ; * for all @xmath1126 : @xmath1130 iff @xmath1131 iff there are @xmath1132 , @xmath1133 such that @xmath1134 .",
    "clearly , if @xmath1088 admits a tiling then a grid abox exists and for any grid abox @xmath29 , @xmath1135 for the ( uniquely determined ) initial individual @xmath95 of @xmath29 .",
    "the following summarizes relevant properties of @xmath1136-aboxes that follow almost directly from the analysis of @xmath1094 in @xcite .",
    "we say that an abox _ contains _ an abox @xmath521 if @xmath1137 and that @xmath29 _ contains a closed abox _ if , additionally , @xmath1138 and @xmath1139 implies @xmath1140 for @xmath1141 .",
    "moreover , we say that _ inconsistency of ( @xmath215-)aboxes w.r.t .",
    "a tbox @xmath7 is datalog@xmath133-rewritable _ if there is a boolean datalog@xmath133-program @xmath129 such that for any ( @xmath215-)abox , @xmath1142 iff @xmath29 is inconsistent w.r.t .  .",
    "[ lem : descr ] let @xmath1088 be a finite rectangle tiling problem . then the following holds .",
    "1 .   inconsistency of @xmath1118-aboxes w.r.t .",
    "@xmath1094 is datalog@xmath133-rewritable .",
    "2 .   if a @xmath1118-abox @xmath29 is consistent w.r.t .",
    "@xmath1094 , then it is @xmath1118-strongly consistent w.r.t .",
    "@xmath1094 and contains * closed grid aboxes @xmath1143 , @xmath99 , with mutually disjoint sets @xmath1144 and * a ( possibly empty ) @xmath1118-abox @xmath521 disjoint from @xmath1145 + such that @xmath1146 and @xmath1147 iff @xmath95 is the initial node of some  @xmath1148 .",
    "moreover , there is a model witnessing @xmath1118-strong consistency w.r.t .",
    "@xmath1094 that satisfies @xmath1149 iff @xmath95 is the initial node of some @xmath1148 .",
    "\\(1 ) assume a @xmath1118-abox @xmath29 is given .",
    "apply the following rules exhaustively to @xmath29 :    * add @xmath1150 to @xmath29 if there exists @xmath96 with @xmath1151 ; * add @xmath1152 to @xmath29 if there exists @xmath96 with @xmath1153 ; * add @xmath587 to @xmath29 if there exist @xmath1154 with @xmath1155 , @xmath1156 , @xmath1157 , @xmath1158 .    denote the resulting abox by @xmath1159",
    "now remove the three cis involving the concepts @xmath1099 from @xmath1094 and denote by @xmath1160 the resulting tbox . using the analysis of the cis involving the concepts @xmath1099 in @xcite",
    ", one can show that @xmath29 is consistent w.r.t .",
    "@xmath1094 iff @xmath1159 is consistent w.r.t .  @xmath1160 .",
    "since the latter is a horn-@xmath3-tbox , it is unraveling tolerant and one can build a datalog@xmath133-rewriting of the inconsistency of @xmath1118-aboxes w.r.t .",
    "@xmath1160 , essentially as in the proof of theorem  [ thm : unravupperlem : hornalclem : hornalc ] .",
    "finally , the obtained program can be modified so as to behave as if started on @xmath1161 when started on , by implementing rules ( a ) to ( c ) as datalog rules .",
    "\\(2 ) this is almost a direct consequence of the properties established in @xcite .",
    "in particular , one finds the desired model @xmath46 from the ` moreover ' part by applying the three rules from the proof of point  ( 1 ) and then applying the cis in @xmath1162 as rules .",
    "the only condition on the decomposition of the abox @xmath29 into @xmath1163 that does not follow from @xcite is that the containment of @xmath1164 in is closed also for the role names @xmath1092 and @xmath1093 . to ensure this condition",
    ", we use the cis that mention @xmath578 and @xmath780 that were not present in the tbox used in that paper .",
    "in fact , the following two properties follow directly from these cis : ( i )  the individuals @xmath358 reachable along an @xmath75-path in @xmath29 from some @xmath95 with @xmath1135 all satisfy @xmath1165 and so do not have an @xmath1092-successor ; and ( ii )  the individuals @xmath358 reachable along a @xmath76-path in @xmath29 from some @xmath95 with @xmath1166 all satisfy @xmath1167 and so do not have a @xmath1093-successor .",
    "( i ) and ( ii ) together with the properties established in @xcite entail that the containment of @xmath1164 in is closed also for the role names @xmath1092 and @xmath1093 , as required .",
    "note that it follows from lemma  [ lem : descr ] ( 2 ) that if @xmath29 is consistent w.r.t .",
    "@xmath7 , then the sequence @xmath1164 is empty iff @xmath1168 ( and @xmath521 is non - empty since aboxes are non - empty ) . in particular this must be the case when does not admit a tiling . in the proof lemma  [ lem : undecidability ] below , this is actually all we need from from lemma  [ lem : descr ] ( 2 ) . in full generality",
    ", it will only be used in the proof of non - dichotomy later on .",
    "we also remark that the decomposition @xmath1169 of in lemma  [ lem : descr ] ( 2 ) is unique .",
    "let @xmath1170 , where @xmath1171 and @xmath1172 are fresh concept names . set @xmath1173 and let @xmath1174 be the enriched @xmath215-abstraction of @xmath7 .    [ lem : undecidability ]   +    1 .",
    "if @xmath1088 admits a tiling , then cq - evaluation w.r.t .",
    "@xmath1175 is conp - hard and @xmath1175 is not materializable .",
    "2 .   if @xmath1088 does not admit a tiling , then cq - evaluation w.r.t .",
    "@xmath1175 is datalog@xmath133-rewritable and @xmath1175 is materializable .",
    "\\(1 ) if @xmath1088 admits a tiling , then there is a grid abox @xmath29 with initial node @xmath95 .",
    "@xmath29 uses symbols from @xmath1118 , only .",
    "we have @xmath1147 and @xmath29 is consistent w.r.t .  @xmath1094 .",
    "thus @xmath1176 and @xmath1177 for @xmath1103 . by lemma  [ lem :",
    "abstraction ] ( 2 ) , @xmath1178 and @xmath1179 for @xmath1103 .",
    "thus @xmath1180 does not have the abox disjunction property .",
    "it follows that @xmath948 is not materializable and that cq - evaluation w.r.t .",
    "@xmath948 is conp - hard .",
    "\\(2 ) assume that @xmath1088 does not admit a tiling .",
    "let @xmath408 be a peq .",
    "we show how to construct a datalog@xmath133-rewriting @xmath129 of @xmath1181 . on aboxes that are inconsistent w.r.t .",
    "@xmath1175 , @xmath129 is supposed to return all tuples over @xmath34 of the same arity as @xmath408 . by lemma  [ lem :",
    "abstraction ] ( 1 ) , an abox is consistent w.r.t .  @xmath1175 iff @xmath966 is consistent w.r.t .",
    "it thus follows from lemma  [ lem : descr ] ( 1 ) that inconsistency of aboxes w.r.t .",
    "@xmath1175 is datalog@xmath133-rewritable . from a concrete rewriting , we can build a datalog@xmath133-program @xmath1182 that checks inconsistency and , if successful , returns all answers .",
    "now for aboxes that are consistent w.r.t .  @xmath1183 . by lemma  [ lem :",
    "abstraction ] ( 1 ) , @xmath966 is consistent w.r.t .  @xmath1094 .",
    "since @xmath1088 does not admit a tiling and by lemma  [ lem : descr ] ( 2 ) , @xmath1184 .",
    "thus , by lemma  [ lem : descr ] ( 2 ) we find a model @xmath46 of @xmath1094 and @xmath966 such that @xmath967 , @xmath1185 for all @xmath969 , @xmath1186 for all role names @xmath16 , and @xmath1187 .",
    "since @xmath1187 , @xmath46 is a model of @xmath7 . from lemma  [ lem :",
    "abstraction ] ( 4 ) , we thus obtain that @xmath1188 iff @xmath1046 , for all  @xmath109 . by lemma  [ lem : abstraction ]",
    "( 3 ) , @xmath1189 is datalog@xmath138-rewritable into a program @xmath1190 .",
    "the desired program @xmath129 is simply the union of @xmath1182 and @xmath1191 , assuming disjointness of idb relations .",
    "lemma  [ lem : undecidability ] implies the announced undecidability results .",
    "[ thm : undec ] for @xmath3-tboxes @xmath7 , the following problems are undecidable ( points  1 and  2 are subject to the side condition that @xmath1192 ) :    1 .",
    "cq - evaluation w.r.t .",
    "@xmath7 is in ptime ; 2 .",
    "cq - evaluation w.r.t .",
    "@xmath7 is conp - hard ; 3 .",
    "@xmath7 is datalog@xmath133-rewritable ; 4 .",
    "@xmath7 is materializable .",
    "we now come to the proof of non - dichotomy .",
    "[ nondicho ] for every language @xmath1193 , there exists an @xmath3-tbox @xmath7 such that , for a distinguished concept name @xmath1194 , the following holds :    1 .",
    "@xmath578 is polynomial time reducible to the evaluation of @xmath1195 ; 2 .",
    "the evaluation of @xmath922 is polynomial time reducible to @xmath578 , for all peqs @xmath408 .",
    "to prove theorem  [ nondicho ] let @xmath1196 .",
    "take a non - deterministic polynomial time turing machine @xmath457 that recognizes the complement of @xmath578 .",
    "let @xmath1197 with @xmath1198 a finite set of states , @xmath1199 and @xmath1200 finite input and tape alphabets such that @xmath1201 and @xmath1202 contains the blank symbol @xmath1203 , @xmath1204 the starting state , @xmath1205 the transition relation , and @xmath1206 the accepting and rejecting states .",
    "denote by @xmath1207 the language recognized by @xmath457 .",
    "we can assume w.l.o.g .  that there is a fixed symbol @xmath1208 such that all words accepted by @xmath457 are of the form @xmath1209 with @xmath1210 ; in fact , it is easy to modify @xmath457 to satisfy this property without changing the complexity of its word problem .",
    "we also assume that for any input @xmath1211 , @xmath457 uses exactly @xmath1212 cells for the computation , halts after exactly @xmath1213 steps in the accepting or rejecting state , and does not move to the left of the starting cell .    to represent inputs to @xmath457 and to provide the space for simulating computations , we use grid aboxes as in the proof of theorem  [ thm : undec ] , where the tiling of the bottom row represents the input word followed by blank symbols . as the set of tile types , we use",
    "@xmath1214 where @xmath1215 is a ` default tile ' that labels every position except those in the bottom row and the upper right corner .",
    "identify @xmath1216 with @xmath1217 and let @xmath1218 .",
    "consider the tbox @xmath1219 defined above , for @xmath1220 with @xmath1221 recall that @xmath1219 checks whether a given @xmath1118-abox contains a grid structure with a tiling that respects @xmath1222 , @xmath1223 , @xmath1224 , and @xmath1225 , and derives the concept name @xmath14 at the lower left corner of such grids .",
    "we now construct a tbox @xmath1226 that , after the verification has finished , initiates a computation of @xmath457 on the grid .",
    "in addition to the concept names in @xmath1219 , @xmath1226 uses concept names @xmath1227 and @xmath1228 for all @xmath1229 and @xmath1230 to represent symbols written during the computation ( in contrast to the elements of @xmath1200 as concept names , used to encode the input word ) and to represent the state and head position . in detail",
    ", @xmath1226 contains the following cis :    * when the verification of the grid has finished , @xmath14 floods the abox : @xmath1231 * the initial configuration is as required : @xmath1232 * for every @xmath1233 , the transition relation of @xmath457 is satisfied : @xmath1234 & & \\midsqcup_{(q,\\gamma , q',\\gamma',r)\\in \\delta}\\exists y. ( a_{\\gamma ' } \\sqcap \\midsqcup_{\\gamma '' \\in \\gamma_1}\\exists x.a_{q',\\gamma ' } ) .",
    "\\end{array}\\ ] ] * the symbol written on a cell does not change if the head is not on the cell : @xmath1235 * the rejecting state is never reached : @xmath1236",
    "let @xmath1237 .",
    "we are going to show that an appropriate extended abstraction of satisfies conditions  ( 1 ) and  ( 2 ) of theorem  [ nondicho ] .",
    "we start with the following lemma which summarizes two important properties of @xmath7 .",
    "[ lem : coni ]   +    1 .",
    "@xmath7 admits trivial models . 2 .",
    "for any @xmath1118-abox @xmath29 , @xmath29 is consistent w.r.t .",
    "@xmath7 iff the following two conditions hold : 1 .",
    "@xmath29 is consistent w.r.t .",
    "@xmath1238 ; 2 .",
    "let @xmath1239 be the decomposition of @xmath29 given in lemma  [ lem : descr ] ( 2 ) and assume that @xmath1148 is the @xmath1240-grid abox with input @xmath1241 for @xmath1242 .",
    "then the following hold for @xmath1242 : 1 .",
    "@xmath1243 and @xmath1244 and 2 .",
    "+ moreover , if @xmath29 is consistent w.r.t .",
    "@xmath7 , then it is strongly @xmath1118-consistent w.r.t .",
    "@xmath7 .",
    "since ( 1 ) follows directly from the shape of the cis in @xmath7 , we concentrate on ( 2 ) .",
    "assume first that @xmath29 is consistent w.r.t .",
    "then @xmath29 is consistent w.r.t .",
    "@xmath1238 and so we can assume that there is a decomposition @xmath1246 of @xmath29 as in lemma  [ lem : descr ] ( 2 ) . by definition ,",
    "each @xmath1148 is an @xmath1247-grid abox with input @xmath1241 . since @xmath29 is consistent w.r.t .",
    "@xmath7 , there is a model @xmath46 of @xmath29 and @xmath7 . by the first cis of @xmath1226 and since the initial node @xmath95 of each @xmath1148 must be in @xmath1248 by lemma  [ lem : descr ] , @xmath1249 for each @xmath650 .",
    "thus the restriction of @xmath46 to @xmath1250 simulates an accepting computation of @xmath457 starting with @xmath1241 .",
    "but since every computatation of @xmath457 starting with a word of length @xmath450 requires at least @xmath1251 space and @xmath1252 time and the containment of @xmath1148 in @xmath29 is closed for the role names @xmath75 and @xmath76 , this is impossible if @xmath1253 or @xmath1254 and also if @xmath1255 .",
    "thus ( i ) and ( ii ) hold , as required .    for the converse direction , assume that ( a ) and ( b ) hold . since @xmath29 is consistent w.r.t .",
    "@xmath1238 , there is a decomposition @xmath1169 of @xmath29 as in lemma  [ lem : descr ] ( 2 ) . also by lemma  [ lem : descr ] ( 2 )",
    ", there is a model @xmath46 that witnesses strong @xmath1118-consistency of @xmath29 w.r.t .",
    "@xmath1238 such that @xmath1256 iff @xmath95 is the initial node of some @xmath1148 .",
    "we construct a model @xmath1257 of @xmath7 by modifying @xmath46 as follows : with the exception of @xmath14 , the symbols of @xmath1238 are interpreted in the same way as in @xmath46 and thus @xmath1257 is a model of @xmath1238 . to satisfy the first ci of @xmath1226 , we set @xmath1258 .",
    "note that this suffices since the containment of each @xmath368 in is closed for the role names @xmath75 and  @xmath76 .",
    "the remaining symbols from @xmath1226 are now interpreted in such a way that they describe on each @xmath1148 an accepting computation for @xmath1241 .",
    "this is possible since @xmath1259 , @xmath1243 and @xmath1244 , and each computation of @xmath457 starting with a word @xmath1260 of length @xmath450 requires at most @xmath1251 space and @xmath1252 time .",
    "it can be verified that @xmath1257 is a model of @xmath1261 ; note that since @xmath14 is a conjunct of the left hand side of every ci in @xmath1226 , the cis in @xmath1226 are trivially satisfied in every node @xmath1262 .",
    "thus @xmath1257 satisfies @xmath7 and @xmath29 and we have proved consistency of @xmath29 w.r.t .",
    "@xmath7 , as required .    for the ` moreover ' part of the lemma",
    ", it suffices to observe that @xmath1257 witnesses strong @xmath1118-consistency of @xmath29 w.r.t .",
    "@xmath7 .",
    "we are now in the position to prove non - dichotomy .",
    "* proof of theorem  [ nondicho ] .",
    "* let @xmath1193 and let @xmath457 and be the tm and tbox from above",
    ". set @xmath1263 and let @xmath948 be the enriched @xmath215-abstraction of @xmath7 .",
    "thus , the only concept names that we are not ` hiding ' are the concept names in @xmath1118 .",
    "we show that satisfies points  ( 1 ) and  ( 2 ) from theorem  [ nondicho ] .",
    "\\(1 ) it suffices to give a polynomial time reduction from @xmath1207 to the complement of evaluating @xmath1264 ( note that @xmath1265 does not occur in any of the involved tboxes ) .",
    "assume that an input word @xmath1260 for @xmath457 is given .",
    "if @xmath1260 is not from @xmath1266 , then reject .",
    "otherwise , construct in polynomial time the @xmath1267-grid abox @xmath29 with input  @xmath1260 .",
    "observe that @xmath29 is consistent w.r.t .",
    "@xmath1238 and has the trivial decomposition @xmath1268 in lemma  [ lem : descr ] ( 2 ) . thus lemma  [ lem : coni ] ( 2 ) implies that @xmath1269 iff @xmath29 is consistent w.r.t .",
    "the latter condition is equivalent to @xmath1270 since @xmath1194 does not occur in @xmath29 or @xmath7 . since @xmath7 admits trivial models , lemma  [ lem : abstraction ] ( 2 ) thus yields @xmath1269 iff @xmath1271 .",
    "\\(2 ) we first make the following observation .",
    "* claim 1 . *",
    "@xmath1272 iff    * @xmath1273 is not consistent w.r.t .",
    "@xmath7 or * @xmath1046 .    for the ` only if ' direction , observe that if @xmath1273 is consistent w.r.t .",
    "@xmath7 , then lemma  [ lem : coni ] yields that @xmath29 is strongly @xmath1118-consistent w.r.t .  @xmath7 .",
    "thus , by lemma  [ lem : abstraction ] ( 4 ) , @xmath1272 iff @xmath1046 . for the ` if ' direction , observe that if @xmath1273 is not consistent w.r.t .",
    "@xmath7 , then by lemma  [ lem : abstraction ] ( 1 ) @xmath29 is not consistent w.r.t .",
    "this finishes the proof of the claim .    by lemma  [ lem :",
    "abstraction ] ( 3 ) , @xmath1046 can be decided in polynomial time .",
    "thus , claim  1 implies that it suffices to give a polynomial time reduction of abox consistency w.r.t . to @xmath1207 .",
    "but lemma  [ lem : coni ] ( 2 ) provides a polynomial reduction of abox consistency w.r.t . to @xmath1207 since    * condition ( a ) of lemma  [ lem : coni ] ( 2 ) can be checked in polynomial time ( by lemma  [ lem : descr ] ( 1 ) ) ; * the decomposition of @xmath29 in condition ( b ) of lemma  [ lem : coni ] ( 2 ) as well as the words @xmath1241 , @xmath69 , can be computed in polynomial time ; * and point  ( i ) of condition ( b ) can be checked in polynomial time .",
    "it thus remains to check whether @xmath1245 for @xmath69 .",
    "this finishes the proof of theorem  [ nondicho ] .",
    "theorems  [ nondicho ] and  [ equivalence ] imply that that there is no /conp - dichotomy , unless @xmath1072=@xmath1072 .",
    "observe that the tboxes constructed in the undecidability and the non - dichotomy proof are both of depth four .",
    "this can be easily reduced to depth three : recall that the tboxes of depth four are obtained from tboxes @xmath7 of depth two by taking their enriched @xmath215-abstractions .",
    "one can obtain a tbox of depth three ( for which query evaluation has the same complexity up to polynomial time reductions ) by first replacing in @xmath7 compound concepts @xmath83 in the scope of a single value or existential restriction by fresh concept names @xmath1274 and adding @xmath1275 to @xmath7 .",
    "then the fresh concept names are added to the signature @xmath215 and one constructs the enriched abstraction of the resulting tbox for the extended signature .",
    "this tbox is as required .",
    "thus , our undecidability and non - dichotomy results hold for @xmath3 tboxes of depth three already .",
    "we have studied the complexity of query evaluation in the presence of an ontology formulated in a dl between and @xmath0 , focussing on the boundary between ptime and conp . for @xmath0-tboxes of depth one ( which covers the vast majority of practically relevant cases ) ,",
    "our results are very positive : there is a dichotomy between and conp and it can be precisely characterized in terms of unraveling tolerance and materializability .",
    "moreover and unlike in the general case , ptime complexity coincides with rewitability into datalog@xmath133 .",
    "the case of higher or unrestricted depth is harder to analyze . we have shown that for - and -tboxes of depth three , the existence of a dichotomy between ptime and conp is equivalent to the feder - vardi conjecture that there is a dichotomy between ptime and np for csps with finite template  the case of depth two remains as an open problem .",
    "for tboxes of depth three we have shown that there is no dichotomy unless @xmath9 and that deciding whether a given tbox admits ptime query evaluation is undecidable , and so are related questions .",
    "\\(1 ) is it decidable whether a given - or -tbox admits ptime query evaluation and , closely related , whether it is unraveling tolerant and whether it is materializable ? we conjecture that this is indeed the case for tboxes of depth one , but we have no conjecture for tboxes of larger depth .",
    "it is interesting to point out that unraveling tolerance is decidable for omqs whose tbox is formulated in ( where a concrete query is given , unlike in the case of unraveling tolerance of tboxes ) ; in that case , unraveling tolerance is equivalent to rewritability into monadic datalog @xcite .",
    "it would also be interesting to study more general notions of unraveling tolerance based on unravelings into structures of bounded treewidth rather than into real trees .",
    "\\(2 ) it would be interesting to study additional complexity classes such as logspace , nlogspace , and ac@xmath12 .",
    "it is known that all these classes occur even for tboxes of depth one , see e.g.  @xcite .",
    "for example , cq - evaluation w.r.t .",
    "the depth one -tbox @xmath1276 , which encodes reachability in directed graphs , is nlogspace - complete .",
    "it would thus be interesting to identify further dichotomies such as between nlogspace and ptime .",
    "we conjecture that for -tboxes of depth one , it is decidable whether query evaluation is in ptime , nlogspace , logspace , and  ac@xmath8 .",
    "\\(3 ) apart from deciding whether query evaluation w.r.t .  a given tbox has a certain complexity , it is also interesting to decide whether the tbox admits rewritability into relevant query languages such as fo - queries or datalog queries . in the context of omqs ,",
    "several results have been obtained , see e.g.  @xcite for fo - rewritability of omqs whose tbox is formulated in a horn dl and  @xcite for fo- and datalog - rewritability of omqs whose tbox is formulated in or an extension thereof . in the tbox ( rather than omq )",
    "case , a first relevant result has been established in @xcite where it is shown that that fo - rewritability is decidable for materializable @xmath0-tboxes of depth one .",
    "this underlines the importance of deciding materializability , which would allow to lift this result to ( otherwise unrestricted ) @xmath0-tboxes of depth one .",
    "diego calvanese , giuseppe de  giacomo , domenico lembo , maurizio lenzerini , and riccardo rosati .",
    "tractable reasoning and efficient query answering in description logics : the _ dl - lite _ family .",
    ", 39(3):385429 , 2007 ."
  ],
  "abstract_text": [
    "<S> we analyze the data complexity of ontology - mediated querying where the ontologies are formulated in a description logic ( dl ) of the family and queries are conjunctive queries , positive existential queries , or acyclic conjunctive queries . </S>",
    "<S> our approach is non - uniform in the sense that we aim to understand the complexity of each single ontology instead of for all ontologies formulated in a certain language . </S>",
    "<S> while doing so , we quantify over the queries and are interested , for example , in the question whether all queries can be evaluated in polynomial time w.r.t .  a given ontology . </S>",
    "<S> our results include a /conp - dichotomy for ontologies of depth one in the description logic @xmath0 , the equivalence of a /conp - dichotomy for @xmath1- and @xmath2-ontologies of unrestricted depth to the famous dichotomy conjecture for csps by feder and vardi , and the failure of /conp - dichotomy theorem for @xmath3-ontologies . regarding the latter dl , we also show that it is undecidable whether a given ontology admits ptime query evaluation . </S>"
  ]
}