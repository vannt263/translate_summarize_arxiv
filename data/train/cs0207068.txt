{
  "article_text": [
    "solving ordering constraints in term algebras with various reduction orders is used in rewriting to prove termination of recursive definitions and in automated deduction to prune the search space @xcite .",
    "@xcite connects further progress in automated deduction with constraint - based deduction .",
    "two kinds of orders are used in automated deduction : the knuth - bendix order @xcite and various versions of recursive path orders @xcite .",
    "the knuth - bendix order is used in the state - of - the - art theorem provers , for example , e @xcite , spass @xcite , vampire @xcite , and waldmeister @xcite .",
    "there is extensive literature on solving recursive path ordering constraints ( e.g. , @xcite ) .",
    "the decidability of knuth - bendix ordering constraints was proved only recently in @xcite .",
    "the algorithm described in that paper shows that the problem belongs to 2-nexptime .",
    "it was also shown that the problem is np - hard by reduction of the solvability of systems of linear diophantine equations to the solvability of the knuth - bendix ordering constraints . in this paper",
    "we present a nondeterministic polynomial - time algorithm for solving knuth - bendix ordering constraints , and hence show that the problem is contained in np for every term algebra with a knuth - bendix order . as a consequence",
    ", we obtain that the existential first - order theory of any term algebra with a knuth - bendix order is np - complete too .",
    "let us note that the problem of solvability of a knuth - bendix ordering constraints consisting of a single inequality can be solved in polynomial time @xcite .",
    "this paper  is structured as follows . in section  [ sec : preliminaries ] we define the main notions of this paper . in section [ sec : isolated : forms ] we introduce the notion of isolated form of constraints and show that every constraint can be effectively transformed into an equivalent disjunction of constraints in isolated form .",
    "this transformation is represented as a nondeterministic polynomial - time algorithm computing members of this disjunction .",
    "after this , it remains to show that solvability of constraints in isolated form can be decided by a nondeterministic polynomial - time algorithm . in section  [ sec : isolated->diophantine ] we present such an algorithm using transformation to systems of linear diophantine inequalities over the weights of variables .",
    "finally , in section  [ sec : main : result ] we complete the proof of the main result and present some examples . section  [ sec : related ] discusses related work and open problems .",
    "a _ signature _ is a finite set of function symbols with associated arities . in this paper",
    "we assume an arbitrary but fixed signature @xmath0 .",
    "_ constants _ are function symbols of the arity @xmath1 .",
    "we assume that @xmath0 contains at least one constant .",
    "we denote variables by @xmath2 and terms by @xmath3 .",
    "the set of all ground terms of the signature @xmath0 can be considered as the _ term algebra _ of this signature , _ @xmath4 _ , by defining the interpretation @xmath5 of any function symbol @xmath6 by @xmath7 .",
    "for details see e.g.@xcite or @xcite .",
    "it is easy to see that in term algebras any ground term is interpreted by itself .",
    "denote the set of natural numbers by _",
    "@xmath8_. the knuth - bendix order is a family of orders parametrized by two parameters : a weight function and a precedence relation .",
    "we call a _ weight function _ on @xmath0 any function @xmath9 such that ( i ) @xmath10 for every constant @xmath11 , ( ii ) there exist at most one unary function symbol @xmath12 such that @xmath13 . given a weight function @xmath14 , we call @xmath15 the _ weight _ of @xmath6",
    "weight _ of any ground term @xmath16 , denoted _",
    "@xmath17 _ , is defined as follows : for every constant @xmath18 we have @xmath19 and for every function symbol @xmath6 of a positive arity @xmath20 .",
    "these conditions on the weight function ensure that the knuth - bendix order is a simplification order total on ground terms ( see , e.g. , @xcite ) . in this paper , _ _",
    "@xmath21 _ will always denote a unary function symbol of the weight @xmath1_.    the following lemma is straightforward .",
    "[ lem : weight : props ] every weight function satisfies the following properties .    1 .",
    "the weight of every term is positive .",
    "if @xmath0 contains no unary function symbol of the weight @xmath1 , then for every natural number @xmath22 there is only a finite number of terms of the weight @xmath22 .",
    "if @xmath0 contains the unary function symbol of the weight @xmath1 , then every weight contains either no terms at all or an infinite number of different terms .",
    "if a term @xmath23 is a subterm of @xmath16 and @xmath24 , then @xmath16 has the form @xmath25 for some @xmath26 ( recall that @xmath21 is the function symbol of the weight @xmath1 ) .",
    "@xmath27    a _ precedence relation _ on @xmath0 is any total order @xmath28 on @xmath0 .",
    "a precedence relation @xmath28 is said to be _ compatible _ with a weight function @xmath14 if the existence of a unary function symbol @xmath21 of the weight zero implies that @xmath21 is the greatest element w.r.t .",
    "@xmath28 .    in the sequel",
    "we assume a fixed weight function _ @xmath14 _ on @xmath0 and a fixed precedence relation @xmath28 on @xmath0 , compatible with @xmath14 .",
    "the _ knuth - bendix order _ on @xmath4 is the binary relation _ @xmath29 _ defined as follows . for any ground terms @xmath30 and @xmath31 we have @xmath32 if one of the following conditions holds :    1 .",
    "@xmath33;[cond : kb:1 ] 2 .",
    "@xmath34 and @xmath35;[cond : kb:2 ] 3 .",
    "@xmath34 , @xmath36 and for some @xmath37 we have @xmath38 and @xmath39.[cond : kb:3 ]    note that the knuth - bendix order is a total monotonic well - founded order , see , e.g. , @xcite .",
    "some authors @xcite define knuth - bendix orders with real - valued weight functions .",
    "we do not consider such orders here , because for real - valued functions even the comparison of ground terms can be undecidable ( see example  [ ex : realkbo ] in section [ sec : main : result ] ) .",
    "the main result of this paper  is the following .    to prove this result ,",
    "we introduce a notion of knuth - bendix ordering constraint and show the following .",
    "we also show that the systems of linear diophantine equations and inequalities can be represented as ordering constraints for some knuth  bendix orders , and as a corollary we obtain the following .    the proof of theorem  [ thm : main ]",
    "will be given after a series of lemmas .",
    "the idea of the proof is as follows .",
    "first , we will make @xmath4 into a two - sorted structure by adding the sort of natural numbers , and extend its signature by    1 .",
    "the weight function @xmath40 on ground terms ; 2 .",
    "the addition function @xmath41 on natural numbers ; 3 .",
    "the knuth - bendix order @xmath29 on ground terms .",
    "given an existential formula of the first - order theory of a term algebra with the knuth - bendix order , we will transform it step by step into an equivalent disjunction of existential formulas of the extended signature .",
    "the main aim of these steps is to replace all occurrences of @xmath29 by linear diophantine inequalities on the weights of variables .",
    "after such a transformation we will obtain existential formulas consisting of linear diophantine inequalities on the weight of variables plus statements expressing that , for some fixed natural number @xmath42 , there exists at least @xmath42 terms of the same weight as @xmath43 , where @xmath44 is a variable .",
    "we will show how these statements can be expressed using systems of linear diophantine inequalities on the weights of variables and then use the fact that the decidability of systems of linear diophantine equations is in np .",
    "we denote by _ @xmath45 _ the following structure with two sorts : the _ term algebra sort _ and the _ arithmetical sort_. the domains of the term algebra sort and the arithmetical sort are the sets of ground terms of @xmath0 and natural numbers , respectively .",
    "the signature of @xmath45 consists of    1 .",
    "all symbols of @xmath0 interpreted as in @xmath4 ; 2 .",
    "symbols @xmath46 having their conventional interpretation over natural numbers ; 3 .",
    "the binary relation symbol @xmath29 on the term algebra sort , interpreted as the knuth - bendix order ; 4 .   the unary function symbol @xmath40 , interpreted as the weight function mapping terms to numbers .",
    "when we need to distinguish the equality @xmath47 on the term algebra sort from the equality on the arithmetical sort , we denote the former by _ @xmath48 _ , and the latter by _",
    "we will prove that the existential theory of @xmath45 is in np , from which the fact that the existential theory of any term algebra with the knuth - bendix order belongs to np follows immediately .",
    "we consider _ satisfiability _ , _ validity _ , and _ equivalence _ of formulas with respect to the structure @xmath45 .",
    "we call a _ constraint _ in the language of @xmath45 any conjunction of atomic formulas of this language .",
    "[ lem : e - theory = satisfiability ] the existential theory of @xmath45 is in np if and only if so is the constraint satisfiability problem .",
    "obviously any instance @xmath50 of the constraint satisfiability problem can be considered as validity of the existential sentence @xmath51 , where @xmath52 are all variables of @xmath50 , so the `` only if '' direction is trivial .    to prove the `` if '' direction , take any existential formula @xmath53 .",
    "this formula is satisfiable if and only if so is the quantifier - free formula @xmath50 . by converting @xmath50 into disjunctive normal form",
    "we can assume that @xmath50 is built from literals using @xmath54 .",
    "replace in @xmath50    1 .",
    "any formula @xmath55 by @xmath56 , 2 .",
    "any formula @xmath57 by @xmath58 , 3 .",
    "any formula @xmath59 by @xmath60 , 4 .",
    "any formula @xmath61 by @xmath62 ,    and convert @xmath50 into disjunctive normal form again .",
    "it is easy to see that we obtain a disjunction of constraints .",
    "the transformation gives an equivalent formula since both orders @xmath29 and @xmath63 are total .",
    "it follows from these arguments that there exists a nondeterministic polynomial - time algorithm which , given an existential sentence @xmath50 , computes on every branch a constraint @xmath64 such that @xmath50 is valid if and only if one of the constraints @xmath64 is satisfiable .",
    "a _ substitution _ is a mapping from the set of variables to the set of terms .",
    "a substitution @xmath65 is called _ grounding _ for an expression @xmath66 ( i.e. , term or constraint ) if for every variable @xmath44 occurring in @xmath66 the term @xmath67 is ground .",
    "let @xmath65 be a substitution grounding for an expression @xmath66 .",
    "we denote by @xmath68 the expression obtained from @xmath66 by replacing in it every variable @xmath44 by @xmath67 .",
    "a substitution @xmath65 is called a _",
    "solution _ to a constraint @xmath66 if @xmath65 is grounding for @xmath66 and @xmath68 is valid in @xmath45 .    in the sequel",
    "we will often replace a constraint @xmath69 by a formula @xmath70 containing extra variables @xmath71 and say that they are `` equivalent '' . by this we mean that @xmath72 .",
    "in other words , the set of solutions to @xmath66 is exactly the set solutions to @xmath50 projected on @xmath73 .",
    "we are interested not only in satisfiability of constraints , but also in their solutions .",
    "our algorithm will consist of equivalence - preserving transformation steps .",
    "when the signature contains no unary function symbol of the weight @xmath1 , the transformation will preserve equivalence in the following strong sense . at each step , given a constraint @xmath69 , we transform it into constraints @xmath74 such that for every sequence of ground terms @xmath75 , the constraint @xmath76 holds if and only if there exist @xmath77 and a sequence of ground terms @xmath78 such that @xmath79 holds .",
    "in other words , the following formula holds in @xmath45 :    @xmath80 moreover this transformations will be presented as a nondeterministic polynomial - time algorithm which computes on every branch some @xmath81 , and every @xmath81 is computed on at least one branch .",
    "when the signature contains a unary function symbol of the weight @xmath1 , the transformation will preserve a weaker form of equivalence : some solutions will be lost , but solvability will be preserved . more precisely , we will introduce a notion of an @xmath21-variant of a term and show that the following formula holds :    @xmath82    where @xmath83 expresses that @xmath73 and @xmath84 are @xmath21-variants .    in our proof",
    ", we will reduce solvability of knuth - bendix ordering constraints to the problem of solvability of systems of linear diophantine inequalities on the weights of variables .",
    "condition [ cond : kb:1 ] of the definition of the knuth - bendix order @xmath85 has a simple translation into a linear diophantine inequality , but conditions [ cond : kb:2 ] and [ cond : kb:3 ] do not have .",
    "so we will split the knuth - bendix order in two partial orders : @xmath86 corresponding to condition [ cond : kb:1 ] and @xmath87 corresponding to conditions [ cond : kb:2 ] and [ cond : kb:3 ] .",
    "formally , we denote by _ @xmath88 _ the formula @xmath33 and by _",
    "@xmath89 _ the formula @xmath90 . obviously , @xmath91 if and only if @xmath92 .",
    "so in the sequel we will assume that @xmath29 is replaced by the new symbols @xmath87 and @xmath86 .",
    "we use @xmath93 to denote the formula @xmath94 , and similar for other binary symbols in place of @xmath29 .",
    "a term @xmath16 is called _ flat _ if @xmath16 is either a variable or has the form @xmath95 , where @xmath96 , @xmath97 , and @xmath98 are variables .",
    "we call a constraint _ chained _ if    1 .",
    "it has a form @xmath99 , where each occurrence of @xmath100 is @xmath86 , @xmath87 or @xmath48 ; 2 .",
    "each term @xmath101 is flat ; 3 .   if some of the @xmath101 s has the form @xmath102 , then @xmath52 are some of the @xmath103 s",
    ".    denote by _",
    "@xmath104 _ the logical constant `` false '' .",
    "[ lem : chained ] any constraint @xmath66 is equivalent to a disjunction @xmath105 of chained constraints .",
    "moreover , there exists a nondeterministic polynomial - time algorithm which , for a given @xmath66 , computes on every branch either @xmath104 or some @xmath64 ; and every @xmath64 is computed on at least one branch .    first , we can apply flattening to all terms occurring in @xmath66 as follows .",
    "if a nonflat term @xmath106 occurs in @xmath66 , take any @xmath107 such that @xmath101 is not a variable .",
    "then replace @xmath66 by @xmath108 , where @xmath109 is a new variable and @xmath110 is obtained from @xmath66 by replacing all occurrences of @xmath101 by @xmath109 . after a finite number of such replacements all terms will become flat .",
    "let @xmath111 be flat terms occurring in @xmath66 such that no comparison @xmath112 occurs in @xmath66 . using the valid formula @xmath113 we can replace @xmath66 by the disjunction of the constraints    @xmath114 by repeatedly doing this transformation we obtain a disjunction of constraints @xmath105 in which for every terms @xmath111 and every @xmath115 some comparison constraint @xmath112 occurs in @xmath64 .    to complete the proof",
    "we show how to turn each @xmath64 into a chained constraint .",
    "let us call a _ cycle _ any constraint @xmath116 , where @xmath117 .",
    "we can remove all cycles from @xmath64 using the following observation :    1 .   if all @xmath100 in the cycle are @xmath48 , then @xmath118 can be removed from the constraint ; 2 .",
    "if some @xmath100 in the cycle is @xmath86 or @xmath87 , then the constraint @xmath64 is unsatisfiable .",
    "after removal of all cycles the constraint @xmath64 can still be not chained because it can contain _ transitive subconstraints _ of the form @xmath119 , @xmath120 .",
    "then either @xmath64 is unsatisfiable or @xmath121 can be removed using the following observations :    1 .",
    "_ case : @xmath121 is @xmath122 .",
    "_ if some @xmath100 in @xmath123 is @xmath86 , then @xmath122 follows from @xmath123 , otherwise @xmath124 implies @xmath125 and hence @xmath64 is unsatisfiable .",
    "case : @xmath121 is @xmath126 .",
    "_ if some @xmath100 in @xmath123 is @xmath86 , then @xmath64 is unsatisfiable .",
    "if all @xmath100 in @xmath124 are @xmath48 , then @xmath64 is unsatisfiable too .",
    "otherwise , all @xmath100 in @xmath124 are either @xmath87 or @xmath48 , and at least one of them is @xmath87 .",
    "it is not hard to argue that @xmath126 follows from @xmath127 .",
    "case : @xmath121 is @xmath128 .",
    "_ if all @xmath100 in @xmath123 are @xmath48 , then @xmath128 follows from @xmath124 , otherwise @xmath64 is unsatisfiable .",
    "it is easy to see that after the removal of all cycles and transitive subconstraints the constraint @xmath64 becomes chained .",
    "note that the transformation of @xmath66 into the disjunction of constraints @xmath105 in the proof can be done in nondeterministic polynomial time in the following sense : there exists a nondeterministic polynomial - time algorithm which , given @xmath66 computes on every branch either @xmath104 or some @xmath64 , and every @xmath64 is computed on at least one branch .",
    "we will now introduce several special kinds of constraints which will be used in our proofs below , namely _ arithmetical _ , _ triangle _ , _ simple _ , and _",
    "isolated_.    a constraint is called _ arithmetical _ if it uses only arithmetical relations @xmath49 and @xmath63 , for example @xmath129 .",
    "a constraint @xmath130 is said to be in _ triangle form _ if    1 .",
    "@xmath131 are pairwise different variables , and 2 .",
    "for all @xmath132 the variable @xmath133 does not occur in @xmath103 .",
    "the variables @xmath131 are said to be _ dependent _ in this constraint .",
    "a constraint is said to be _ simple _ if it has the form    @xmath134 where @xmath135 are pairwise different variables .",
    "a constraint is said to be in _ isolated form _ if either it is @xmath104 or it has the form    @xmath136 where @xmath137 is an arithmetical constraint , @xmath138 is in triangle form , and @xmath139 is a simple constraint such that no variable of @xmath139 is dependent in @xmath138 .",
    "our decision procedure for the knuth - bendix ordering constraints is designed as follows . by lemma  [ lem : chained ] we can transform any constraint into an equivalent disjunction of chained constraints . our next step is to give a transformation of any chained constraint into an equivalent disjunction of constraints in isolated form .",
    "then in section  [ sec : isolated->diophantine ] we show how to transform any constraint in isolated form into an equivalent disjunction of systems of linear diophantine inequalities on the weights of variables .",
    "then we can use the result that the decidability of systems of linear diophantine inequalities is in np .",
    "let us show how to transform any chained constraint into an equivalent disjunction of isolated forms .",
    "the transformation will work on the constraints of the form    @xmath140    such that    1 .",
    "@xmath141 are as in the definition of isolated form ; 2 .",
    "@xmath142 is a chained constraint ; 3 .",
    "each variable of @xmath142 neither occurs in @xmath139 nor is dependent in @xmath138 .",
    "we will call such constraints ( [ eqn : chained ] ) _ working_. let us call the _ size _ of a chained constraint @xmath66 the total number of occurrences of function symbols and variables in @xmath66 .",
    "likewise , the _ essential size _ of a working constraint is the size of its chained part @xmath142 .    at each transformation step",
    "we will replace working constraint ( [ eqn : chained ] ) by a disjunction of working constraints but of smaller essential sizes .",
    "evidently , when the essential size is @xmath1 , we obtain a constraint in isolated form .",
    "let us prove some lemmas about solutions to constraints of the form ( [ eqn : chained ] ) .",
    "note that any chained constraint is of the form    @xmath143    where each @xmath100 is either @xmath48 or @xmath87 and each @xmath144 is a flat term .",
    "we call a _ row _ in such a constraint any maximal subsequence @xmath145 in which @xmath86 does not occur",
    ". so constraint ( [ eqn : chained1 ] ) contains @xmath77 rows , the first one is @xmath146 and the last one @xmath147 .",
    "note that for any solution to ( [ eqn : chained1 ] ) all terms in a row have the same weight .",
    "[ lem : one : occurrence ] there exists a polynomial - time algorithm which transforms any chained constraint @xmath66 into an equivalent chained constraint @xmath110 such that the size of @xmath110 is not greater than the size of @xmath66 , either @xmath110 is @xmath104 or of the form ( [ eqn : chained1 ] ) , and @xmath110 has the following property .",
    "suppose some term of the first row @xmath148 of @xmath110 is a variable @xmath149",
    ". then either    1 .",
    "@xmath149 has exactly one occurrence in @xmath110 , namely @xmath148 itself ; or 2 .",
    "@xmath149 has exactly two occurrences in @xmath110 , both in the first row : some @xmath150 has the form @xmath151 for @xmath152 , and @xmath13 ; moreover in this case there exists at least one @xmath87 between @xmath150 and @xmath148 .    note that if @xmath149 occurs in any term @xmath153 which is not in the first row , then @xmath66 is unsatisfiable , since for any solution @xmath65 to @xmath66 we have @xmath154 , which is impossible .",
    "suppose that @xmath149 has another occurrence in a term @xmath150 of the first row .",
    "consider two cases .    1 .   _ @xmath150 coincides with @xmath149_. then either @xmath66 has no solution , or part of the first row between @xmath150 and @xmath148 has the form @xmath155 . in the latter case",
    "part @xmath156 can be removed from the first row , so we can assume that no term in the first row except @xmath148 is @xmath149 .",
    "@xmath150 is a nonvariable term containing @xmath149 .",
    "_ since @xmath150 and @xmath149 are in the same row , for every solution @xmath65 to @xmath66 we have @xmath157 . since @xmath150 is a flat term , by lemma  [ lem : weight : props ] the equality @xmath157 is possible only if @xmath150 is @xmath151 and @xmath152 .",
    "finally , if @xmath151 has more than one occurrences in the first row , we can get rid of all of them but one in the same way as we got rid of multiple occurrences of @xmath149 .",
    "note that the transformation presented in this proof can be made in polynomial time .",
    "it is also not hard to argue that the transformation does not increase the size of the constraint .",
    "we will now take a working constraint @xmath158 , whose chained part satisfies lemma  [ lem : one : occurrence ] and transform it into an equivalent disjunction of working constraints of smaller essential sizes in lemma  [ lem : into : isolated ] below .",
    "more precisely , these constraints will be equivalent when the signature contains no unary function symbol of the weight @xmath1 .",
    "when the signature contains such a symbol @xmath21 , a weaker notion of equivalence will hold , see formula ( [ eq : f - equiv ] ) on page .",
    "a term @xmath23 is called an _",
    "@xmath21-variant _ of a term @xmath16 if @xmath23 can be obtained from @xmath16 by a sequence of operations of the following forms : replacement of a subterm @xmath159 by @xmath160 or replacement of a subterm @xmath160 by @xmath159 .",
    "evidently , @xmath21-variant is an equivalence relation .",
    "two substitutions @xmath161 and @xmath162 are said to be @xmath21-variants if for every variable @xmath44 the term @xmath163 is an @xmath21-variant of @xmath164 . in the proof of several lemmas below",
    "we will replace a constraint @xmath69 by a formula @xmath70 containing extra variables @xmath71 and say that @xmath69 and @xmath70 are _ equivalent up to @xmath21_. by this we mean the following .    1 .   for every substitution @xmath161 grounding for @xmath73 such that @xmath165 , there exists a substitution @xmath162 grounding for @xmath166 such that @xmath167 , and the restriction of @xmath162 to @xmath73 is an @xmath21-variant of @xmath161 .",
    "2 .   for every substitution @xmath162 grounding for @xmath166 such that @xmath168 , there exists a substitution @xmath161 such that @xmath169 and @xmath161 is an @xmath21-variant of the restriction of @xmath162 to @xmath73 . in other words ,",
    "formula ( [ eq : f - equiv ] ) on page holds .",
    "note that when the signature contains no unary function symbol of the weight @xmath1 , equivalence up to @xmath21 is the same as equality of terms in @xmath45 .",
    "let @xmath170 be a working constraint and @xmath161 be a solution to @xmath66 .",
    "let @xmath162 be an @xmath21-variant of @xmath161 such that    1 .",
    "@xmath162 is a solution to @xmath142 and 2 .",
    "@xmath162 coincides with @xmath161 on all variables not occurring in @xmath142 .",
    "then there exists an @xmath21-variant @xmath171 of @xmath162 such that    1 .",
    "@xmath171 is a solution to @xmath66 and 2 .",
    "@xmath171 coincides with @xmath162 on all variables except for the dependent variables of @xmath138 .",
    "let us first prove that @xmath162 is a solution to both @xmath137 and @xmath139 . since @xmath139 and @xmath142 have no common variables , it follows that @xmath161 and @xmath162 agree on all variables of @xmath139 , and so @xmath162 is a solution to @xmath139 .",
    "since @xmath161 and @xmath162 are @xmath21-variants and the weight of @xmath21 is @xmath1 , for every term @xmath16 we have @xmath172 , whenever @xmath173 is ground .",
    "therefore , @xmath162 is a solution to @xmath137 if and only if so is @xmath161 .",
    "so @xmath162 is a solution to @xmath137 .",
    "it is fairly easy to see that @xmath162 can be changed on the dependent variables of @xmath138 obtaining a solution @xmath171 to @xmath66 which satisfies the conditions of the lemma .",
    "this lemma will be used below in the following way .",
    "instead of considering the set @xmath174 of all solutions to @xmath142 we can restrict ourselves to a subset @xmath175 of @xmath174 as soon as for every solution @xmath176 there exists a solution @xmath177 such that @xmath162 is an @xmath21-variant of @xmath161 .",
    "let us call an _",
    "@xmath21-term _ any term of the form @xmath178 . by the _",
    "@xmath21-height _ of a term @xmath16 we mean the number @xmath22 such that @xmath179 and @xmath23 is not an @xmath21-term .",
    "note that the @xmath21-terms are exactly the terms of a positive @xmath21-height .",
    "we call the _ @xmath21-distance _ between two terms @xmath23 and @xmath16 the difference between the @xmath21-height of @xmath23 and @xmath21-height of @xmath16 . for example , the @xmath21-distance between the terms @xmath180 and @xmath181 is @xmath182 .",
    "let us now prove a lemma which implies that any solution to @xmath66 can be transformed into a solution with a `` small '' @xmath21-height .",
    "[ lem : f - height ] let @xmath142 be a chained constraint of the form    @xmath183 where each @xmath100 is either @xmath48 or @xmath87 .",
    "further , let @xmath142 satisfy the conditions of lemma  [ lem : one : occurrence ] and @xmath65 be a solution to @xmath142",
    ". then there exists an @xmath21-variant @xmath184 of @xmath65 such that    1 .",
    "@xmath184 is a solution to @xmath142 and 2 .   for every @xmath185",
    ", the @xmath21-height of @xmath186 is at most @xmath77 .",
    "let us first prove the following statement    the row @xmath187 has a solution @xmath161 , such that ( i ) @xmath161 is an @xmath21-variant of @xmath65 , ( ii ) for every @xmath188 the @xmath21-distance between @xmath189 and @xmath190 is at most @xmath191 .",
    "[ itm : z1 ]    suppose that for some @xmath77 the @xmath21-distance between @xmath192 and @xmath193 is @xmath194 . evidently , to prove ( [ itm : z1 ] ) it is enough to show the following .",
    "there exists a solution @xmath162 such that ( i ) @xmath162 is an @xmath21-variant of @xmath65 , ( ii ) the @xmath21-distance between @xmath195 and @xmath196 is @xmath197 , and ( iii ) for every @xmath198 the @xmath21-distance between @xmath199 and @xmath200 coincides with the @xmath21-distance between @xmath201 and @xmath202 .",
    "[ itm : z2 ]    let us show ( [ itm : z2 ] ) , and hence ( [ itm : z1 ] ) . since @xmath65 is a solution to the row , then for every @xmath203 the @xmath21-distance between any @xmath204 and @xmath192 is nonnegative .",
    "likewise , for every @xmath205 the @xmath21-distance between any @xmath193 and @xmath206 is nonnegative .",
    "therefore , for all @xmath207 , the @xmath21-distance between @xmath204 and @xmath206 is @xmath208 , and hence is at least @xmath209 .",
    "let us prove the following .",
    "every variable @xmath44 occurring in @xmath210 does not occur in @xmath211 .",
    "[ itm : z3 ]    let @xmath44 occur in terms @xmath212 and @xmath213 such that @xmath214 and @xmath215 . since the constraint satisfies lemma  [ lem : one : occurrence ] , then @xmath216 and @xmath217 .",
    "then the @xmath21-distance between @xmath218 and @xmath219 is @xmath191 , but by our assumption it is at least @xmath209 , so we obtain a contradiction . hence ( [ itm : z3 ] ) is proved .",
    "now note the following .    if for some @xmath203 a variable @xmath44 occurs in @xmath220",
    ", then @xmath221 is an @xmath21-term .",
    "[ itm : z4 ]    suppose , by contradiction , that @xmath221 is not an @xmath21-term .",
    "note that @xmath204 has a positive @xmath21-height , so @xmath220 is either @xmath44 of @xmath222 .",
    "but we proved before that the @xmath21-distance between @xmath220 and @xmath223 is at least @xmath209 , so @xmath44 must be an @xmath21-term .",
    "now , to satisfy ( [ itm : z2 ] ) , define the substitution @xmath162 as follows :    @xmath224{l }                  \\text{if $ x$ occurs in $ p_l,\\ldots , p_k$ }                  \\text { and } \\theta(x ) = f(t ) .",
    "\\end{array }            \\end{array }          \\right.\\ ] ] by ( [ itm : z3 ] ) and ( [ itm : z4 ] ) , @xmath162 is defined correctly .",
    "we claim that @xmath162 satisfies ( [ itm : z2 ] ) . the properties ( i)-(iii ) of ( [ itm : z2 ] ) are straightforward by our construction , it only remains to prove that @xmath162 is a solution to the row , i.e.  for every @xmath225 we have @xmath226 .",
    "well , for @xmath227 we have @xmath228 and @xmath229 , and for @xmath230 we have @xmath231 and @xmath232 , in both cases @xmath226 follows from @xmath233 .",
    "the only difficult case is @xmath234 .",
    "assume @xmath235 . since the @xmath21-distance between @xmath192 and @xmath193 is @xmath194 , we have @xmath236 , and hence @xmath237 must be @xmath238 . since @xmath65 is a solution to @xmath238 and since @xmath162 is an @xmath21-variant of @xmath65 , the weights of @xmath195 and @xmath196 coincide .",
    "but then @xmath239 follows from the fact that the @xmath21-distance between @xmath195 and @xmath196 is @xmath240 .",
    "now the proof of ( [ itm : z2 ] ) , and hence of ( [ itm : z1 ] ) , is completed . in the same way as ( [ itm : z1 ] ) , we can also prove    the constraint @xmath142 has a solution @xmath184 such that ( i ) @xmath184 is an @xmath21-variant of @xmath65 , ( ii ) for every @xmath188 the @xmath21-distance between @xmath189 and @xmath241 is at most @xmath191 .",
    "( iii ) the @xmath21-height of @xmath242 is at most @xmath191 ; ( iv ) @xmath184 and @xmath65 coincide on all variables occurring in the rows below the first one .",
    "[ itm : z5 ]    it is not hard to derive lemma  [ lem : f - height ] from ( [ itm : z5 ] ) .",
    "the following lemma is the main ( and the last ) lemma of this section .",
    "[ lem : into : isolated ] let @xmath170 be a working constraint in which @xmath142 is nonempty . there exists a nondeterministic polynomial - time algorithm which transforms @xmath66 into a disjunction of working constraints having @xmath142 of smaller sizes and equivalent to @xmath66 up to @xmath21 .",
    "the proof is rather complex , so we will give a plan of it .",
    "the proof is presented as a series of transformations on the first row of @xmath142 .",
    "these transformations may result in new constraints added to @xmath137 , @xmath138 , and @xmath139 .",
    "first , we will get rid of equations @xmath243 in the first row , by introducing _ quasi - flat _ terms , i.e.  terms @xmath244 , where @xmath16 is flat .",
    "if the first row contained no function symbols , then we will replace the first row by new constraints added to @xmath139 and @xmath137 , thus decreasing the size of the chained part .",
    "if there were function symbols in the first row , we will continue as follows .",
    "we will `` guess '' the values of some variables @xmath44 of the first row , i.e. replace them by some quasi - flat term @xmath245 , where @xmath71 is a sequence of new variables .",
    "after these steps , the size of the first row can , in general , increase .",
    "then we will show how to replace the first row by new constraints involving only variables occurring in the row , but not function symbols .",
    "finally , we will prove that the number of variables from the new constraints that remain in the chained part is not greater than the original number of variables in the first row , and therefore the size of the chained part decreases .",
    "formally , consider the first row of @xmath142 .",
    "let this row be @xmath246 .",
    "then @xmath142 has the form @xmath247 .",
    "if @xmath248 , i.e. , the first row consists of one term , we can remove this row and add @xmath249 to @xmath137 obtaining an equivalent constraint with smaller essential size , that is , the size of @xmath142 .",
    "so we assume that the first row contains at least two terms .",
    "as before , we assume that @xmath21 is a unary function symbol of the weight @xmath1 . by lemma  [ lem : f - height ] , if some @xmath212 is either a variable @xmath44 or a term @xmath222 , it is enough to search for solutions @xmath65 such that the height of @xmath221 is at most @xmath250 .",
    "a term is called _ quasi - flat _ if it has the form @xmath244 where @xmath16 is flat .",
    "we will now get rid of equalities in the first row , but by introducing quasi - flat terms instead of the flat ones .",
    "when we use notation @xmath244 below , we assume @xmath251 , and @xmath252 will stand for @xmath16 .",
    "we eliminate equalities from the first row in two steps",
    ". first we will eliminate equalities among variables and @xmath21terms transforming them into an equivalent set of equalities in triangle form , then we eliminate all other equalities in the first row .",
    "consider the set @xmath253 of all equalities @xmath254 occurring in the first row of @xmath142 , where @xmath23 and @xmath16 are either variables or flat @xmath21terms .",
    "we will transform @xmath253 into an equivalent system @xmath255 in triangle form such that all terms in @xmath255 will be flat .",
    "we assume that before the transformation @xmath255 is empty .",
    "first we replace all equalities in @xmath253 of the form @xmath256 by @xmath257 obtaining an equivalent system @xmath258 in which all equalities are of the form @xmath259 .",
    "now , either @xmath258 is unsatisfiable or there exists an equality @xmath259 in @xmath258 , such that @xmath44 does not occur in @xmath21terms of @xmath258 .",
    "we move such an equality @xmath260 into @xmath255 and replace all occurrences of @xmath44 in @xmath258 by @xmath16 , obtaining @xmath261 .",
    "it is easy to see that the system @xmath262 is equivalent to @xmath253 , all terms in @xmath262 are flat , @xmath255 is in triangle form and the number of variables occurring into @xmath261 is less than the number of variables occurring into @xmath253 . repeating this process we can eliminate all variables from @xmath253 and obtain the required @xmath255 in polynomial time .",
    "now we remove from @xmath142 all equalities occurring in @xmath253 .",
    "let us note that variables of @xmath255 can occur in @xmath142 only in the first row , and only in the terms @xmath263 for @xmath264 .",
    "next we repeatedly replace all occurrences of dependent variables of @xmath255 occurring in @xmath142 obtaining an equivalent constraint in chained form with terms of the form @xmath265 where @xmath77 is bounded by the size of @xmath255 .",
    "finally we move @xmath255 into @xmath138 .",
    "after all these transformations we can assume that equalities @xmath266 do not occur in the first row .",
    "if the first row contains an equality @xmath267 between a variable and a term , we replace this equality by @xmath16 , replace all occurrences of @xmath44 by @xmath16 in the first row , and add @xmath259 to @xmath138 obtaining an equivalent working constraint . since @xmath44 can occur only in the terms of the form @xmath268 , it is easy to see that these replacements can be done in polynomial time . if the first row contains an equality @xmath269 where @xmath6 and @xmath270 are different function symbols , the constraint is unsatisfiable .    if the first row contains an equality @xmath271 we do the following .",
    "if the term @xmath102 coincides with @xmath272 , replace this equality by @xmath102 .",
    "otherwise , find the smallest number @xmath107 such that @xmath273 is different from @xmath133 and    1 .",
    "add @xmath274 to @xmath138 ; 2 .",
    "replace all occurrences of @xmath133 in @xmath142 by @xmath273 .",
    "we apply this transformation repeatedly until all equalities @xmath275 disappear from the first row .",
    "so we can now assume that the first row contains no equalities and hence it has the form @xmath276 , where all of the terms @xmath277 are quasi - flat .",
    "if all of the @xmath277 are variables , we can move @xmath276 to @xmath139 and add @xmath278 to @xmath137 obtaining an equivalent working constraint of smaller essential size .",
    "hence , we can assume that at least one of the @xmath277 is a nonvariable term .",
    "take any term @xmath279 in the first row such that @xmath279 is either a variable @xmath44 or a term @xmath280 .",
    "note that other occurrences of @xmath44 in @xmath142 can only be in the first row , and only in the terms of the form @xmath265 .",
    "consider the formula @xmath281 defined as    @xmath282    where @xmath71 is a sequence of pairwise different new variables . since we proved that it is enough to restrict ourselves to solutions @xmath65 for which the height of @xmath221 is at most @xmath250 , the formulas @xmath66 and @xmath283 are equivalent up to @xmath21 .",
    "using the distributivity laws , @xmath283 can be turned into an equivalent disjunction of formulas @xmath284 . for every such formula ,",
    "replace @xmath44 by @xmath245 in the first row , and add @xmath285 to the triangle part .",
    "we do this transformation for all terms in the first row of the form @xmath286 , where @xmath251 and @xmath287 is a variable .",
    "now all the terms in the first row are of the form @xmath245 , where @xmath6 is different from @xmath21 and @xmath97 .",
    "let us show how to replace constraints of the first row with equivalent constraints consisting of constraints on variables and arithmetical constraints .",
    "consider the pair @xmath288 . now",
    "@xmath289 and @xmath290 for some variables @xmath291 and function symbols @xmath292 .",
    "then @xmath293 is @xmath294 . if @xmath295 or ( @xmath296 and @xmath297 ) , then @xmath294 is equivalent to @xmath104 . if @xmath298 or ( @xmath296 and @xmath35 ) , then @xmath294 is equivalent to the arithmetical constraint @xmath299 which can be added to @xmath137 .",
    "if @xmath296 and @xmath300 ( and hence @xmath301 ) , then    @xmath302 we can now do the following .",
    "add @xmath303 to @xmath137 and replace @xmath293 with the equivalent disjunction    @xmath304    then using the distributivity laws turn this formula into the equivalent disjunction of constraints of the form @xmath305 for all @xmath306 .",
    "for each of these constraints , we can move , as before , the equalities @xmath307 one by one to the triangle part @xmath138 , and make @xmath308 into a disjunction of chained constraints as in lemma  [ lem : chained ] .",
    "let us analyze what we have achieved .",
    "after these transformations , in each member of the obtained disjunction the first row is removed from the chained part @xmath142 of @xmath66 . since the row contained at least one function symbol , each member of the disjunction will contain at least one occurrence of a function symbol less than the original constraint .",
    "this is enough to prove termination of our algorithm , but not enough to present it as a nondeterministic polynomial - time algorithm .",
    "the problem is that , when @xmath309 is a variable @xmath44 or a term @xmath222 , one occurrence of @xmath44 in @xmath309 can be replaced by one or more constraints of the form @xmath310 , where @xmath273 and @xmath133 are new variables . to be able to show that the essential sizes of each of the resulting constraints is strictly less than the essential size of the original constraint , we have to modify our algorithm slightly .",
    "the modification will guarantee that the number of new variables introduced in the chained part of the constraint is not greater than the number of variables eliminated from the first row .",
    "we will achieve this by moving some constraints to the simple part @xmath139 .",
    "the new variables only appear when we replace a variable in the first row by a term @xmath311 or by @xmath312 obtaining a constraint @xmath313 { { \\succ}_{\\mathit{lex}}}f^k(h(v_1,\\ldots , v_m))$ ] , which is then replaced by    @xmath314    let us call a variable @xmath315 ( respectively , @xmath316 ) _ new _ if @xmath311 occurred in the terms of the first row when we replaced a variable by a nonvariable term containing @xmath270 using formula ( [ eqn : into : isolated : f ] ) .",
    "in other words , new variables are those that did not occur in the terms of the first row before our transformation , but appeared in the terms of the first row during the transformation .",
    "all other variables are called _ old_. after the transformation we obtain a conjunction @xmath317 of constraints of the form @xmath318 or @xmath319 , where @xmath320 can be either new or old . without loss of generality we can assume that this conjunction of constraints does not contain chains of the form @xmath321 where @xmath120 and at least one of the @xmath100 s is @xmath29 . indeed ,",
    "if @xmath317 contains such a chain , then it is unsatisfiable .",
    "we will now show that the number of new variables can be restricted by moving constraints on these variables into the triangle or simple part . among the new variables ,",
    "let us distinguish the following three kinds of variables .",
    "a new variable @xmath44 is called _ blue in @xmath317 _ if @xmath317 contains a chain @xmath322 , where @xmath323 is an old variable .",
    "evidently , a blue variable @xmath44 causes no harm since it can be replaced by an old variable @xmath323 .",
    "let us denote by _",
    "@xmath324 _ the inverse relation to @xmath29 .",
    "a new variable @xmath44 is called _ red in @xmath317 _ if it is not blue in @xmath317 and @xmath317 contains a chain @xmath325 , where @xmath323 is an old variable , and all of the @xmath100 s are either @xmath48 , or @xmath29 , or @xmath324 .",
    "red variables are troublesome , since there is no obvious way to get rid of them .",
    "however , we will show that the number of red variables is not greater than the number of replaced variables ( such as the variable @xmath44 in ( [ eqn : into : isolated : f ] ) ) .",
    "finally , all new variables that are neither blue nor red in @xmath317 are called _ green _ in @xmath317 .    * getting rid of the green variables .",
    "* we will now show that the green variables can be moved to the simple part of the constraint @xmath139 . to this end , note an obvious property : if @xmath317 contains a constraint @xmath326 and @xmath44 is green , then @xmath149 is green too .",
    "we can now do the following with the green variables . as in lemma",
    "[ lem : chained ] , we can turn all the green variables into a disjunction of chained constraints of the form @xmath327 , where @xmath100 are @xmath48 , @xmath86 , or @xmath87 , and use the distributivity laws to obtain chained constraints @xmath327 . let us call this constraint a _",
    "green chain_. then , if there is any equality @xmath328 in the green chain , we add this equality to @xmath138 and replace this equality by @xmath329 in the chain . further , if the chain has the form @xmath330 , we add @xmath331 to @xmath139 and @xmath332 to @xmath137 , and replace the green chain by @xmath333 .",
    "we do this transformation until the green chain becomes of the form @xmath334 .",
    "after this , the green chain can be removed from @xmath317 and added to @xmath139 .",
    "evidently , this transformation can be presented as a nondeterministic polynomial - time algorithm .    * the red variables .",
    "* let us show the following : in every term @xmath335 in the first row at most one variable among @xmath336 is red .",
    "it is not hard to argue that it is sufficient to prove a stronger statement : if for some @xmath107 the variable @xmath315 is red or blue , then all variables @xmath337 are blue .",
    "so suppose that @xmath315 is either red or blue and @xmath338 is a shortest chain in @xmath317 such that @xmath339 is old .",
    "we prove that the variables @xmath337 are blue , by induction on @xmath22 .",
    "when @xmath340 and @xmath315 is red , @xmath317 contains either @xmath341 or @xmath342 , where @xmath339 is old . without loss of generality",
    "assume that @xmath317 contains @xmath341",
    ". then ( cf .",
    "( [ eqn : replacement ] ) ) this equation appeared in @xmath317 when we replaced @xmath343 by @xmath344 and @xmath345 .",
    "but then @xmath317 also contains the equations @xmath346 , where the variables @xmath347 are old , and so the variables @xmath337 are blue . in the same way we can prove that if @xmath315 is blue then @xmath337 are blue .",
    "the proof for @xmath348 is similar , but we use the fact that @xmath347 are blue rather than old .    to complete the transformation ,",
    "we add all constraints on the red and the old variables to @xmath142 and make @xmath142 into a disjunction of chained constraint as in lemma  [ lem : chained ] .",
    "* getting rid of the blue variables . *",
    "if @xmath317 contains a blue variable @xmath44 , then it also contains a chain of constraints @xmath349 , where @xmath323 is an old variable .",
    "we replace @xmath44 by @xmath323 in @xmath66 and add @xmath350 to the triangle part @xmath138 .",
    "when we completed the transformation on the first row , the row disappears from the chained part @xmath142 of @xmath66 .",
    "if the first row contained no function symbols , the size of @xmath142 will become smaller , since several variables will be removed from it . if @xmath142 contained at least one function symbol , that after the transformation the number of occurrences of function symbols in @xmath142 will decrease .",
    "some red variables will be introduced , but we proved that their number is not greater than the number of variables eliminated from the first row .",
    "therefore , the size of @xmath142 strictly decreases after the transformation due to elimination of at least one function symbol .",
    "again , it is not hard to argue that the transformation can be presented as a nondeterministic polynomial - time algorithm computing all members of the resulting disjunction of constraints .",
    "lemmas  [ lem : chained ] and [ lem : into : isolated ] imply the following :    [ lem : into : isolated : strong ] let @xmath66 be a constraint . then there exists a disjunction @xmath351 of constraints in isolated form equivalent to @xmath66 up to @xmath21 .",
    "moreover , members of such a disjunction can be found by a nondeterministic polynomial - time algorithm .",
    "our next aim is to present a nondeterministic polynomial - time algorithm solving constraints in isolated form .",
    "let @xmath66 be a constraint in isolated form    @xmath352 our decision algorithm will be based on a transformation of the simple constraint @xmath139 into an equivalent disjunction @xmath353 of arithmetical constraints .",
    "then we can check the satisfiability of the resulting formula @xmath354 by using an algorithm for solving systems of linear diophantine inequalities on the weights of variables .    to transform @xmath139 into an arithmetical formula , observe the following .",
    "the constraint @xmath139 is a conjunction of the constraints of the form    @xmath355 having no common variables . to solve such a constraint we have to ensure that there exist at least @xmath42 different terms of the same weight as @xmath356 ( since the knuth - bendix order is total ) .    in this section",
    "we will show that for each @xmath42 the statement `` there exists at least @xmath42 different terms of a weight @xmath14 '' can be expressed in the presburger arithmetic as an existential formula of one variable @xmath14 .",
    "we say that a relation @xmath357 on natural numbers is _",
    "@xmath358-definable _ , if there exists an existential formula of presburger arithmetic @xmath359 such that @xmath357 is equivalent to @xmath360 .",
    "we call a function @xmath361 @xmath358-definable if so is the relation @xmath362 .",
    "note that composition of @xmath358-definable function is @xmath358-definable .",
    "let us fix an enumeration @xmath363 of the signature @xmath0 .",
    "we assume that the first @xmath364 symbols @xmath365 have an arity @xmath366 , and the first @xmath255 symbols @xmath367 are nonconstants .",
    "the arity of each @xmath368 is denoted by @xmath369 .",
    "_ in this section we assume that @xmath364 , @xmath255 , @xmath253 , and the weight function @xmath14 are fixed . _",
    "we call the _ contents _ of a ground term @xmath16 the tuple of natural numbers @xmath370 such that @xmath371 is the number of occurrences of @xmath368 in @xmath16 for all @xmath107 . for example",
    ", if the sequence of elements of @xmath0 is @xmath372 , and @xmath373 , the contents of @xmath16 is @xmath374 .",
    "[ lem : exists ] the following relation @xmath375 is @xmath358-definable : there exists at least one ground term of @xmath0 of the weight @xmath44 and contents @xmath370",
    ".    we will define @xmath375 by a conjunction of two linear diophantine inequalities .",
    "the first equation is    @xmath376    it is not hard to argue that this equation says : every term with the contents @xmath370 has weight @xmath44 .",
    "the second formula says that the number of constant and nonconstant function symbols in @xmath370 is appropriately balanced for constructing a term :    @xmath377    let us prove some lower bounds on the number of terms of a fixed weight .",
    "we leave the following two lemmas to the reader .",
    "the first one implies that , if there exists any ground term @xmath16 of a weight @xmath44 with at least @xmath42 occurrences of nonconstant symbols , including at least one occurrence of a function symbol of an arity @xmath366 , then there exists at least @xmath42 different ground terms of the weight @xmath44 .",
    "[ lem : n : binary ] let @xmath378 be natural numbers such that @xmath375 holds , @xmath379 and @xmath380",
    ". then there exists at least @xmath42 different ground terms with the contents @xmath370 .",
    "the second lemma implies that , if there exists any ground term @xmath16 of a weight @xmath44 with at least @xmath42 occurrences of nonconstant function symbols , including at least two different unary function symbols , then there exists at least @xmath42 different ground terms of the weight @xmath44 .",
    "[ lem : n : unary ] let @xmath381 be natural numbers such that @xmath375 holds , @xmath382 and at least two numbers among @xmath383 are positive",
    ". then there exists at least @xmath42 different ground terms with the contents @xmath370 .",
    "let us note that if our signature consists only of a unary function symbol of a positive weight and constants , then the number of different terms in any weight is less or equal to the number of constants in the signature .",
    "the remaining types of signatures are covered by the following lemma .",
    "[ lemm : n : linear ] let @xmath0 contain a function symbol of an arity greater than or equal to @xmath209 , or contain at least two different unary function symbols .",
    "then there exist two natural numbers @xmath384 and @xmath385 such that for all natural numbers @xmath42 and @xmath44 such that @xmath386 , the number of terms of the weight @xmath44 is either @xmath1 or greater than @xmath42 .",
    "if @xmath0 contains a unary function symbol of the weight @xmath1 then the number of different terms of any weight is either @xmath1 or @xmath387 and the lemma trivially holds .",
    "therefore we can assume that our signature contains no unary function symbol of the weight @xmath1 .",
    "define    @xmath388 take any @xmath42 and @xmath44 such that @xmath389 .",
    "let us prove that if there exists a term of the weight @xmath44 then the number of occurrences of nonconstant function symbols in this term is greater than @xmath42 . assume the opposite , i.e.  there exists a term @xmath16 of the weight @xmath44 such that the number of occurrences of nonconstant function symbols in @xmath16 is @xmath390 .",
    "let @xmath370 be the contents of @xmath16 and @xmath391 denote the number of occurrences of constants in @xmath16 .",
    "note that ( [ eqn : signature2 ] ) implies @xmath392 . then using ( [ eqn : signature1 ] ) we obtain    @xmath393          w\\cdot(m+l ) =          w\\cdot(m + 1 + \\sum_{1\\leq i\\leq f}({\\mathit{arity}}_{i } - 1)\\cdot n_i ) \\leq",
    "\\\\[.9ex ]          w\\cdot(m + 1 + ( a-1)\\sum_{1\\leq i\\leq f } n_i ) =          w\\cdot(m+1 + ( a-1 ) \\cdot m ) =          \\\\[.9ex ]          w\\cdot(m\\cdot a + 1 ) \\leq          w\\cdot(n \\cdot a + 1 )",
    "<          n\\cdot n_1+n_2 .",
    "\\end{array}\\ ] ] so we obtain a contradiction .",
    "consider the following possible cases .    1 .",
    "_ there exists a term of the weight @xmath44 with an occurrence of a function symbol of an arity greater than or equal to @xmath209 .",
    "_ in this case by lemma [ lem : n : binary ] the number of different terms of the weight @xmath44 is greater than @xmath42 .",
    "there exists a term of the weight @xmath44 with occurrences of at least two different unary function symbols_. in this case by lemma [ lem : n : unary ] the number of different terms of the weight @xmath44 is greater than @xmath42 .",
    "3 .   _ all terms of the weight @xmath44 have the form @xmath394 for some unary function symbol @xmath6 and a constant @xmath18 .",
    "_ we show that this case is impossible .",
    "in particular , we show that for any nonconstant function symbol @xmath270 there exists a term of the weight @xmath44 in which @xmath6 and @xmath270 occur , therefore we obtain a contradiction with the assumption .",
    "+ we have @xmath395 .",
    "denote by @xmath396 the arity of @xmath270 .",
    "let us define integers @xmath397 as follows + @xmath398 let us prove that @xmath399 and there exists a term of the weight @xmath44 with @xmath400 occurrences of @xmath270 , @xmath401 occurrences of @xmath6 and @xmath402 occurrences of @xmath18 and hence obtain a contradiction .",
    "+ since @xmath6 is unary , @xmath403 , and so @xmath404 . since @xmath405 , we have @xmath406 .",
    "let us show that @xmath407 , i.e. @xmath408 .",
    "we have + @xmath409 it remains to show that there exists a term of the weight @xmath44 with @xmath400 occurrences of @xmath270 , @xmath401 occurrences of @xmath6 and @xmath402 occurrences of @xmath18 . to this end",
    "we have to prove ( cf .",
    "( [ eqn : signature1 ] ) and ( [ eqn : signature2 ] ) ) + @xmath410            1 + ( h - 1 ) \\cdot m_1 + ( 1 - 1 ) \\cdot m_2 + ( 0 - 1 ) m_3 = 0 .          \\end{array}\\ ] ] this equalities can be verified directly by replacing @xmath397 by their definitions and @xmath44 by @xmath411 .",
    "@xmath27    define the binary function _",
    "( truncated number of terms ) as follows : @xmath413 is the minimum of @xmath42 and the number of terms of the weight @xmath414 and let us show that @xmath412 can be computed in time polynomial of @xmath415 . to give a polynomial - time algorithm for this function",
    "we need an auxiliary definition and a lemma .",
    "let @xmath416 and @xmath417 be two tuples of natural numbers .",
    "we say that @xmath416 _ extends _",
    "@xmath417 if @xmath418 for @xmath419 .",
    "the _ depth _ of a term is defined by induction as usual : the depth of every constant is @xmath191 and the depth of every nonconstant term @xmath420 is equal to the maximum of the depth of the @xmath101 s plus @xmath191 .",
    "[ lem : extended : content ] let @xmath421 be a collection of different terms of the same depth and @xmath422 be the contents of a term such that @xmath422 extends the contents of all terms @xmath101 , @xmath423",
    ". then there exists at least @xmath22 different terms with the contents @xmath422 .",
    "let us define the notion of _ leftmost subterm _ of a term @xmath16 as follows : every constant @xmath18 has only one leftmost subterm , namely @xmath18 itself , and leftmost subterms of a nonconstant term @xmath424 are this term itself and all leftmost subterms of @xmath425 .",
    "evidently , for each positive integer @xmath426 and term @xmath16 , @xmath16 has at most one leftmost subterm of the depth @xmath426 .",
    "it is not hard to argue that from the condition of the lemma it follows that for every term @xmath101 there exists a term @xmath427 with the contents @xmath422 such that @xmath101 is a leftmost subterm of @xmath427 .",
    "but then the terms @xmath428 are pairwise different , since they have different leftmost subterms of the depth @xmath426 .",
    "[ lem : numbnm ] let the signature @xmath0 contain no unary function symbol of the weight @xmath1 and contain either a function symbol of an arity greater than or equal to @xmath209 or contain at least two different unary function symbols .",
    "then the function @xmath413 is computable in time polynomial of @xmath429 .",
    "it is not hard to argue that for every contents @xmath370 such that some of the @xmath371 s is greater than @xmath414 , any term with these contents has the weight greater than @xmath414 .",
    "the number of different contents in which each of the @xmath371 s is less or equal than @xmath414 is @xmath430 , i.e.  it is polynomial in @xmath414 , moreover , all these contents can be obtained by an algorithm working in time polynomial in @xmath414 .",
    "therefore it is sufficient to describe a polynomial - time algorithm which for all contents @xmath431 , where @xmath432 , returns the minimum of @xmath42 and the number of terms with these contents .",
    "let us fix contents @xmath433 where @xmath434 . using equations ( [ eqn : signature1 ] ) and ( [ eqn : signature2 ] )",
    ", one can check in polynomial time whether there exists a term with the contents @xmath422 , so we assume that there exists at least one such term .    our algorithm constructs , step by step , sets @xmath435 , of different terms with contents which can be extended to the contents @xmath436 .",
    "each set @xmath437 will consist only of terms of the depth @xmath107 .    1 .",
    "_ define @xmath438 .",
    "2 .   _ step @xmath439 . _ define + @xmath440{l }                          g",
    "\\in \\sigma,~                            { { t}_1,\\ldots,{t}_{m } } \\in t_1 \\cup \\ldots \\cup t_i,~\\\\                            \\mathit{con } \\text { extends the content of }                              g({{t}_1,\\ldots,{t}_{m } } ) , \\text { and}\\\\                            \\text{the depth of $ g({{t}_1,\\ldots,{t}_{m}})$ is } i + 1                          \\}.                        \\end{array}\\ ] ] if @xmath441 has @xmath42 or more terms , then by lemma  [ lem : extended : content ] there exists at least @xmath42 different terms of the content @xmath422 , so we terminate and return @xmath42 . if @xmath441 is empty , we return as the result the minimum of @xmath42 and the number of terms with the content @xmath422 in @xmath442 .",
    "let us prove some obvious properties of this algorithm .    1 .",
    "_ if some @xmath437 contains @xmath42 or more terms , then there exists at least @xmath42 terms with the content @xmath422 . _ as we noted",
    ", this follows from lemma  [ lem : extended : content ] .",
    "_ at the end of step @xmath439 the set @xmath443 contains all the terms with the contents @xmath422 of the depth @xmath444 .",
    "_ this property obviously holds by our construction .",
    "this property ensure that the algorithm is correct .",
    "to prove that it works in time polynomial in @xmath445 it is enough to note that each step can be made in time polynomial in @xmath42 and the total number of steps is at most @xmath446 .",
    "now we are ready to prove the main lemma of this section .",
    "[ lem : atleast ] there exists a polynomial time of @xmath42 algorithm , which constructs an existential formula @xmath447 valid on a natural number @xmath44 if and only if there exists at least @xmath42 different terms of the weight @xmath44 .",
    "if the signature @xmath0 contains a unary function symbol of the weight @xmath1 then the number of different terms in any weight is either @xmath1 or @xmath387 .",
    "therefore we can define @xmath447 as @xmath448 .",
    "let us consider the case when the signature @xmath0 consists of a unary function symbol @xmath6 of a positive weight .",
    "for every constant @xmath18 in @xmath0 consider the formula @xmath449 .",
    "it is not hard to argue that @xmath450 holds if and only if there exists a term of the form @xmath394 .",
    "let @xmath451 be the set of all sets of cardinality @xmath42 consisting of constants of @xmath0 ( the cardinality of @xmath451 is obviously polynomial in @xmath42 ) .",
    "it is easy to see that    @xmath452 it remains to consider the case when our signature contains a function symbol of an arity greater than or equal to @xmath209 , or contain at least two different unary function symbols . by lemma [ lemm :",
    "n : linear ] , there exist constants @xmath384 and @xmath385 such that for any natural number @xmath44 such that @xmath386 the number of terms of the weight @xmath44 is either @xmath1 or greater than @xmath42 .",
    "let us denote @xmath453 as @xmath414 and the set @xmath454 as @xmath455 . by lemmas [ lemm :",
    "n : linear ] , [ lem : numbnm ] we have    @xmath456",
    "in this section we complete the proofs of the main results of this paper .",
    "[ thm : kboisnp ] for every knuth - bendix order , the problem of solving ordering constraints is contained in np .",
    "take a constraint . by lemma  [ lem : into : isolated ] it can be effectively transformed into an equivalent disjunction of isolated forms , so it remains to show how to check satisfiability of constraints in isolated form .",
    "suppose that @xmath66 is a constraint in isolated form .",
    "recall that @xmath66 is of the form    @xmath457    let @xmath139 contain a chain @xmath458 such that @xmath459 does not occur in the rest of @xmath139 .",
    "denote by @xmath460 the constraint obtained from @xmath139 by removing this chain .",
    "it is not hard to argue that @xmath66 is equivalent to the constraint    @xmath461 in this way we can replace @xmath139 by an arithmetical constraint , so we assume that @xmath139 is empty .",
    "let @xmath138 have the form    @xmath462 let @xmath463 be the set of all variables occurring in @xmath464 .",
    "it is not hard to argue that @xmath464 is satisfiable if and only if the following constraint is satisfiable :    @xmath465 so we reduced the decidability of the existential theory of term algebras with a knuth - bendix order to the problem of solvability of systems of linear diophantine inequalities .",
    "our proof can be represented as a nondeterministic polynomial - time algorithm .",
    "this theorem implies the main result of this paper .",
    "let us call a signature @xmath0 _ trivial _ if it consists of one constant symbol . evidently , the first - order theory of the term algebra of a trivial signature is polynomial .",
    "[ thm : main ] the existential first - order theory of any term algebra of a non - trivial signature with the knuth - bendix order is np - complete .",
    "the containment in np follows from theorem  [ thm : kboisnp ] .",
    "it is easy to prove np - hardness by reducing propositional satisfiability to the existential theory of the algebra ( even without the order ) .",
    "let us show that for some knuth - bendix orders even constraint solving can be np - hard .",
    "[ exa : ldi ] consider the signature @xmath466 , where @xmath270 is binary , @xmath467 are unary , and @xmath18 is a constant .",
    "define the weight of all symbols as @xmath191 , and use any order @xmath28 on @xmath0 such that @xmath468 .",
    "our aim is to represent any linear diophantine equation by knuth - bendix constraints . to this end",
    ", we will consider any ground term @xmath16 as representing the natural number @xmath469 .",
    "define the formula    @xmath470 it is not hard to argue that , for any ground terms @xmath471 @xmath472 holds if and only if @xmath473 .",
    "it is enough to consider systems of linear diophantine equations of the form    @xmath474    where @xmath475 are pairwise different variables , and @xmath476 .",
    "consider the constraint      it is not hard to argue that    formula ( [ eqn : con ] ) holds if and only if [ kkk ]    @xmath478    using ( [ kkk ] ) , we can transform any system @xmath479 of linear diophantine equations of the form ( [ eqn : dio ] ) into a constraint @xmath480 such that for every tuple of ground terms @xmath481 , @xmath482 holds if and only if so does @xmath483 .",
    "similar , using a formula @xmath484 one can represent systems of linear inequalities using knuth  bendix constraints .    since it is well - known that solving linear diophantine equations is np - hard , we have the following theorem .",
    "[ thm : kboisnpcomp ] for some knuth - bendix orders , the problem of solving ordering constraints is np - complete .",
    "this result does not hold for all non - trivial signatures , as the following theorem shows .",
    "there exists a polynomial time algorithm which solves ordering constraints for any given term algebra over a signature consisting of constants and any total ordering @xmath485 on that term algebra .",
    "let @xmath486 , w.l.o.g .",
    "we can assume that @xmath487 .",
    "let @xmath66 be an ordering constraint .",
    "first we get rid of equalities as follows .",
    "if @xmath254 occurs in @xmath66 and @xmath16 syntactically equal to @xmath23 then we remove @xmath254 from @xmath66 , if @xmath16 is a variable then we replace all occurrences of @xmath16 in @xmath66 by @xmath23 and remove @xmath254 from @xmath66 , otherwise @xmath16 and @xmath23 are different constants and @xmath66 is unsatisfiable . now",
    "@xmath66 consists of conjunctions of atomic formulas of the form @xmath488 .",
    "we define a relation @xmath489 on terms as follows : @xmath490 if and only if @xmath491 occurs into @xmath66 .",
    "let @xmath492 denote a transitive closure of @xmath489 .",
    "it is easy to see , that using a polynomial time algorithm for transitive closure , we can compute the relation @xmath493 in polynomial time .",
    "note that if @xmath492 is not a strict order then the constraint @xmath66 is unsatisfiable .",
    "so we assume that @xmath492 is a strict partial order .",
    "now we replace all variables in @xmath66 by constants as follows .",
    "take a variable @xmath44 such that there is no variable less than @xmath44 w.r.t .",
    "there are two possible cases :    1 .",
    "[ lem : const : min ] @xmath44 is a minimal term w.r.t .",
    "@xmath492 , then we replace all occurrences of @xmath44 in @xmath66 by @xmath494 .",
    "[ lem : const : const ] there exist some constants less than @xmath44 w.r.t .",
    "@xmath492 , then let @xmath495 be the greatest w.r.t . @xmath485 constant among such constants .",
    "if @xmath495 is the maximal constant in @xmath4 then the constraint @xmath66 is unsatisfiable , otherwise we replace all occurrences of @xmath44 by @xmath496 .    repeating this process",
    "we replace all variables in @xmath66 in polynomial time . to complete the proof of the lemma",
    ", it remains to show that transformations [ lem : const : min],[lem : const : const ] above , preserve satisfiability of constraints without equality . to this end",
    ", we consider a constraint @xmath66 without equality and a solution @xmath65 to @xmath66 .",
    "if the transformation [ lem : const : min ] is applicable to @xmath66 then it is easy to see that @xmath497 is a solution to the constraint obtained after applying the transformation [ lem : const : min ] to @xmath66 .",
    "similar one can show that the transformation [ lem : const : const ] preserves satisfiability of constraints without equality .",
    "[ ex : realkbo ] there exists a polynomial time algorithm which checks solvability of ordering constraints for any given knuth ",
    "bendix order on any term algebra over a signature consisting of constants .    as we mentioned in section",
    "[ sec : preliminaries ] , if we consider real  valued knuth - bendix orders then even comparison of ground terms might be undecidable .",
    "let us show it on the following example .",
    "consider a non - computable real number @xmath160 such that @xmath498 , i.e. there is no algorithm which given a positive integer @xmath22 computes @xmath160 with the precision @xmath499 , in other words finds two natural numbers @xmath500 such that @xmath501 .",
    "now we consider a signature consisting of two unary symbols @xmath502 and a constant @xmath18 and consider any knuth ",
    "bendix order @xmath29 on the corresponding term algebra , such that @xmath503 and @xmath504 .",
    "let us show that comparison of terms in this knuth  bendix order is undecidable . consider a positive integer @xmath22 .",
    "then , it is easy to see that there exists a positive integer @xmath26 such that @xmath505 . since @xmath506",
    ", we have @xmath507 . from the definition of the weight function we have that @xmath508 and therefore @xmath509 .",
    "let us take @xmath510 and @xmath511 , then we have @xmath512 . therefore using comparison of terms we can compute @xmath160 with the precision @xmath499 .",
    "this implies that comparison of terms for this knuth  bendix order is undecidable .",
    "in this section we overview previous work on knuth - bendix orders , recursive path orders , and extensions of term algebras with various relations .",
    "the knuth - bendix order was introduced in @xcite .",
    "later , @xcite introduced recursive path orders ( rpos ) and @xcite lexicographic path orders ( lpos ) . a number of results on recursive path orders and solving lpo and rpo ordering constraints are known .",
    "however , except for the very general result of @xcite the techniques used for rpo constraints are not directly applicable to knuth - bendix orders .",
    "we used systems of linear diophantine inequalities in our decidability proofs .",
    "this is not coincidental : example  [ exa : ldi ] shows that systems of linear diophantine inequalities are definable in the knuth - bendix order .",
    "@xcite proved that lpo constraint solving is np - hard already for constraints consisting of a single inequality .",
    "in @xcite we prove that the problem of solving knuth - bendix ordering constraints consisting of a single inequality can be solved in polynomial time .    in @xcite we present a polynomial time algorithm for the orientability problem : given a system of rewrite rules @xmath513 , does there exist a knuth  bendix order which orients every ground instance of every rewrite rule in @xmath513 . a similar problem of orientability by the non - ground version of the real  valued knuth ",
    "bendix order was studied by dick , kalmus , and martin @xcite and an algorithm for orientability was given .",
    "algorithms for , and complexity of , orientability problem for various versions of the recursive path orders were considered in @xcite . in particular , in @xcite it is shown that the orientability problem by the non - ground version of the recursive path order is np - complete .",
    "@xcite proved the decidability and @xcite np - completeness of lpo constraint solving .",
    "@xcite proved the decidability and @xcite np - completeness of rpo constraint solving .",
    "recently , @xcite proposed a new efficient method for solving rpo constraints .",
    "term algebras are rather well - studied structures .",
    "@xcite was the first to prove the decidability of the first ",
    "order theory of term algebras .",
    "other methods of proving decidability were developed by @xcite , @xcite , @xcite , @xcite .",
    "if we introduce a binary predicate into a term algebra , then one can obtain a richer theory .",
    "term algebras with the subterm predicate have an undecidable first  order theory and a decidable existential theory @xcite .",
    "term algebras with lexicographic path orders have an undecidable first  order theory @xcite .",
    "however , if we consider term algebras over signatures consisting of unary symbols and constants then the first ",
    "order theory of lexicographic path orders over such term algebras is decidable @xcite . in @xcite",
    "we show that the first  order theory of any knuth ",
    "bendix order over any term algebra over a signature consisting of unary function symbols and constants is decidable .    to conclude",
    ", we mention two open problems related to the knuth  bendix order . one problem is whether whole first  order theory of the knuth  bendix orders is decidable .",
    "another problem is to describe the complexity of the constraint solving problem for knuth  bendix orders in the case of signatures consisting of unary function symbols and constants .",
    "1988 , model theory of locally free algebras ( in russian ) , _ in _ ` model theory and its applications ' , vol .  8 of _ trudy instituta matematiki _ , nauka , novosibirsk , pp .",
    "english translation in translations of the american mathematical society .",
    "1985 , a procedure for automatically proving the termination of a set of rewrite rules , _ in _ j .- p .",
    "jouannaud , ed . , ` rewriting techniques and applications , first international conference , rta-85 ' , vol .",
    "202 of _ lecture notes in computer science _ , springer verlag , dijon , france , pp .",
    "255270 .          1991 , satisfiability of systems of ordinal notations with the subterm property is decidable , _ in _",
    "j.  albert , b.  monien m.  rodrguez - artalejo , eds , ` automata , languages and programming , 18th international colloquium , icalp'91 , vol .",
    "510 of _ lecture notes in computer science _ , springer verlag , madrid , spain , pp .  455468 .",
    "1995 , on the use of constraints in automated deduction , _ in _",
    "a.  podelski , ed .",
    ", ` constraint programming : basics and tools ' , vol .",
    "910 of _ lecture notes in computer science _ , springer verlag , pp .",
    "128146 .",
    "2000 , a decision procedure for the existential theory of term algebras with the knuth - bendix ordering , _ in _ ` proc .",
    "15th annual ieee symp . on logic in computer science ' , santa barbara , california , pp .",
    "291302 .",
    "2001 , verifying orientability of rewrite rules using the knuth - bendix order , _ in _",
    "a.  middeldorp , ed . , ` rewriting techniques and applications , 12th international conference , rta 2001 ' , vol .",
    "2051 of _ lecture notes in computer science _ , springer verlag , pp",
    ".  137153",
    ". an extended version will appear in information and computation .",
    "1999 , rpo constraint solving is in np , _ in _",
    "g.  gottlob , e.  grandjean  k.  seyr , eds , ` computer science logic , 12th international workshop , csl'98 , vol .",
    "1584 of _ lecture notes in computer science _ , springer verlag , pp",
    ".  385398 .",
    "1999 , rewrite - based deduction and symbolic constraints , _ in _ h.  ganzinger , ed . , ` automated deduction  cade-16 .",
    "16th international conference on automated deduction ' , lecture notes in artificial intelligence , trento , italy , pp .",
    "302313 .    1999 , solved forms for path ordering constraints , _ in _ ` in proc .",
    "10th international conference on rewriting techniques and applications ( rta ) ' , vol .",
    "1631 of _ lecture notes in computer science _ , trento , italy , pp .",
    "115 .    1999 ,",
    "vampire , _ in _",
    "h.  ganzinger , ed . , `",
    "automated deduction  cade-16 .",
    "16th international conference on automated deduction ' , vol .",
    "1632 of _ lecture notes in artificial intelligence _ ,",
    "trento , italy , pp .",
    "292296 .    1999 ,",
    "system abstract : e 0.3 , _ in _ h.  ganzinger , ed .",
    ", ` automated deduction  cade-16 .",
    "16th international conference on automated deduction ' , lecture notes in artificial intelligence , trento , italy , pp .",
    "297301 .      1999 , system description : spass version 1.0.0 , _ in _ h.  ganzinger , ed . , `",
    "automated deduction  cade-16 .",
    "16th international conference on automated deduction ' , vol .",
    "1632 of _ lecture notes in artificial intelligence _ ,",
    "trento , italy , pp ."
  ],
  "abstract_text": [
    "<S> we show the np - completeness of the existential theory of term algebras with the knuth - bendix order by giving a nondeterministic polynomial - time algorithm for solving knuth - bendix ordering constraints . </S>"
  ]
}