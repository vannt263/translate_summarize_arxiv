{
  "article_text": [
    "the advent of the new class of 10-m ground based telescopes is having a strong impact on the study of galaxy evolution .",
    "for instance , instruments as lris at the keck allow observers to regularly secure redshifts for dozens of @xmath3 galaxies in several hours of exposure .",
    "technical advances in the instrumentation , combined with the proliferation of similar telescopes in the next years guarantees a vast increase in the number of galaxies , bright and faint , for which spectroscopical redshifts will be obtained in the near future . notwithstanding",
    "this progress in the sheer numbers of available spectra , the @xmath3 ` barrier ' ( for reasonably complete samples ) is likely to stand for a time , as there are not foreseeable dramatic improvements in the telescope area or detection techniques .    despite the recent spectacular findings of very high redshift galaxies , ( @xcite , @xcite , @xcite ) , it is extremely difficult to secure redshifts for such objects . on the other hand , even moderately deep ground based imaging routinely contain many high redshift galaxies ( although hidden amongst myriads of foreground ones ) , not to mention the hubble deep field or the images that will be available with the upcoming advanced camera .",
    "to push further in redshift the study of galaxy evolution is therefore very important to develop techniques able to extract galaxy redshifts from multicolor photometry data .",
    "this paper applies the methods of bayesian probability theory to photometric redshift estimation . despite the efforts of thomas loredo , who has written stimulating reviews on the subject ( loredo 1990 , 1992 ) , bayesian methods are still far from being one of the staple statistical techniques in astrophysics .",
    "most courses and monographs on statistics only include a small section on bayes theorem , and perhaps as a consequence of that , bayesian techniques are frequently used _",
    "ad hoc _ , as another tool from the available panoply of statistical methods . however , as any reader of the fundamental treatise by e.t .",
    "jaynes ( 1998 ) can learn , bayesian probability theory represents an unified look to probability and statistics , which does not intend to complement , but to fully substitute the traditional , ` frequentist ' statistical techniques ( see also bretthorst 1988 , 1990 )    one of the fundamental differences between ` orthodox ' statistics and bayesian theory , is that the probability is not defined as a frequency of occurrence , but as a reasonable degree of belief .",
    "bayesian probability theory is developed as a rigorous full  flegded alternative to traditional probability and statistics based on this definition and three _ desiderata _ : a)degrees of belief should be represented by real numbers , b)one should reason consistently , and c)the theory should reduce to aristotelian logic when the truth values of hypothesis are known .",
    "one of the most attractive features of bayesian inference lies on its simplicity .",
    "there are two basic rules to manipulate probability , the product rule @xmath4 and the sum rule @xmath5 where `` @xmath6 '' means `` @xmath7 and @xmath8 are true '' , and `` @xmath9 '' means `` either @xmath7 or @xmath8 or both are true '' . from the product rule , and taking into account that the propositions `` @xmath6 '' and `` @xmath10 '' are identical , it is straightforward to derive bayes theorem    @xmath11    if the set of proposals @xmath12 are mutually exclusive and exhaustive , using the sum rule one can write @xmath13 which is known as bayesian marginalization .",
    "these are the basic tools of bayesian inference .",
    "properly used and combined with the rules to assign prior probabilities , they are in principle enough to solve most statistical problems .",
    "there are several differences between the methodology presented in this paper and that of @xcite , the most significant being the treatment of priors ( see sec .",
    "[ bpz ] ) .",
    "the procedures developed here offer a major improvement in the redshift estimation and based on them it is possible to generate new statistical methods for applications which make use of photometric redshifts ( sec . [ appli ] ) .",
    "the outlay of the paper is the following : sec .",
    "2 reviews the current methods of photometric redshifts estimation making emphasis on their main sources of error .",
    "3 introduces an expression for the redshift likelihood slightly different from the one used by other groups when applying the sed ",
    "fitting technique . in sec .",
    "4 it is described in detail how to apply bayesian probability to photometric redshift estimation ; the resulting method is called bpz . sec 5",
    "compares the performance of traditional statistical techniques , as maximum likelihood , with bpz by applying both methods to the hdf spectroscopic sample and to a simulated catalog .",
    "6 briefly describes how bpz may be developed to deal with problems in galaxy evolution and cosmology which make use of photometric redshifts .",
    "sec 7 briefly summarizes the main conclusions of the paper .",
    "there are two basic approaches to photometric redshift estimation . using the terminology of @xcite ,",
    "they may be termed ` sed fitting ' and ` empirical training set ' methods .",
    "the first technique ( @xcite , @xcite , @xcite , @xcite , @xcite , etc . ) involves compiling a library of template spectra , empirical or generated with population synthesis techniques .",
    "these templates , after being redshifted and corrected for intergalactic extinction , are compared with the galaxy colors to determine the redshift @xmath14 which best fits the observations . the training set technique",
    "( @xcite , @xcite , @xcite ) starts with a multicolor galaxy sample with apparent magnitudes @xmath15 and colors @xmath16 which has been spectroscopically identified . using this sample , a relationship of the kind @xmath17",
    "is determined using a multiparametric fit .",
    "it should be said that these two methods are more similar than what it is usually considered . to understand this ,",
    "let s analyze how the empirical training set method works . for simplicity ,",
    "let s forget about the magnitude dependence and let s suppose that only two colors @xmath18 are enough to estimate the photometric redshifts , that is , given a set of spectroscopic redshifts @xmath19 and colors @xmath20 , the training set method tries to fit a surface @xmath21 to the data .",
    "it must be realized that this method makes a very strong assumption , namely that the surface @xmath21 is a _ function _ defined on the color space : each value of @xmath16 is assigned one and only one redshift .",
    "visually this means that the surface @xmath21 does not ` bend ' over itself in the redshift direction .",
    "although this functionality of the redshift / color relationship can not be taken for granted in the general case ( at faint magnitudes there are numerous examples of galaxies with very similar colors but totally different redshifts ) , it seems to be a good approximation to the real picture at @xmath22 redshifts and bright magnitudes ( @xcite ) .",
    "a certain scatter around this surface is allowed : galaxies with the same value of @xmath23 may have slightly different redshifts and it seems to be assumed implicitly that this scatter is what limits the accuracy of the method .",
    "the sed fitting method is based on the color / redshift relationships generated by each of the library templates @xmath24 , @xmath25 . a galaxy at the position @xmath16 is assigned the redshift corresponding to the closest point of any of the @xmath26 curves in the color space .",
    "if these @xmath26 functions are inverted , one ends up with the curves @xmath27 , which , in general , are not functions ; they may present self  crossings ( and of course they may also cross each other ) .",
    "if we limit ourselves to the region in the color / redshift space in which the training set method defines the surface @xmath21 , for a realistic template set the curves @xmath27 would be embedded in the surface @xmath21 , conforming its ` skeleton ' and defining its main features .",
    "the fact that the surface @xmath21 is continuous , whereas the template - defined curves are sparsely distributed , does not have a great practical difference .",
    "the gaps may be filled by finely interpolating between the templates ( @xcite ) , but this is not strictly necessary : usually the statistical procedure employed to search for the best redshift performs its own interpolation between templates .",
    "when the colors of a galaxy do not exactly coincide with one of the templates , @xmath28 or the maximum likelihood method will assign the redshift corresponding to the nearest template in the color space .",
    "this is equivalent to the curves @xmath27 having extended ` influence areas ' around them , which conform a sort of step  like surface which interpolates across the gaps , and also extends beyond the region limited by them in the color space .",
    "therefore , the sed - fitting method comes with a built - in interpolation ( and extrapolation ) procedure . for this reason ,",
    "the accuracy of the photometric redshifts does not change dramatically when using a sparse template set as the one of @xcite ( @xcite ) or a fine grid of template spectra ( @xcite ) .",
    "the most crucial factor is that the template library , even if it contains few spectra , adequately reflects the main features of real galaxy spectra and therefore the main ` geographical accidents ' of the surface @xmath21    the intrinsic similarity between both photometric redshift methods explains their comparable performance , especially at @xmath29 redshift ( @xcite ) . when the topology of the color ",
    "redshift relationship is simple , as apparently happens at low redshift , the training set method will probably work slightly better than the template fitting procedure , if only because it avoids the possible systematics due to mismatches between the predicted template colors and the real ones , and also partially because it includes not only the colors of the galaxies , but also their magnitudes , what helps to break the color / redshift degeneracies ( see below ) .",
    "however , it must be kept in mind that although the fits to the spectroscopic redshifts give only a dispersion @xmath30 ( @xcite ) , there is not a strong guarantee that the predictive capabilities of the training set method will keep such an accuracy , even within the same magnitude and redshift ranges . as a matter of fact , they do not seem to work spectacularly better than the sed fitting techniques ( @xcite ) , even at low and intermediate redshifts .",
    "however , the main drawback of the training set method is that , due to its empirical and _ ad hoc _ basis , in principle it can only be reliably extended as far as the spectroscopic redshift limit . because of this , it may represent a cheaper method of obtaining redshifts than the spectrograph , but which can not really go much fainter than it . besides it is difficult to transfer the information obtained with a given set of filters , to another survey which uses a different set .",
    "such an extrapolation has to be done with the help of templates , what makes the method lose its empirical purity . and last but not least",
    ", it is obvious that as one goes to higher redshifts / fainter magnitudes the topology of the color - redshift distribution @xmath31 displays several nasty degeneracies , even if the near - ir information is included , and it is impossible to fit a single functional form to the color - redshift relationship .",
    "although the sed fitting method is not affected by some of these limitations , it also comes with its own set of problems .",
    "several authors have analyzed in detail the main sources of errors affecting this method ( @xcite,@xcite ) .",
    "these errors may be divided into two broad classes :      fig .",
    ". shows @xmath32 vs @xmath33 for the morphological types employed in sec [ test ] and @xmath34 .",
    "the color / redshift degeneracies happen when the line corresponding to a single template intersects itself or when two lines cross each other at points corresponding to different redshifts for each of them ( these cases correspond to `` bendings '' in the redshift / color relationship @xmath21 ) .",
    "it is obvious that the likelihood of such crossings increases with the extension of the considered redshift range and the number of templates included .",
    "it may seem that even considering a very extended redshift range , such confusions could in principle be easily avoided by using enough filters .",
    "however , the presence of color / redshift degeneracies is highly increased by random photometric errors , which can be visualized as a blurring or thickening of the @xmath35 relationship ( fig .",
    "[ colors]b ) : each point of the curves in fig .",
    "[ colors]a is expanded into a square of size @xmath36 , the error in the measured color .",
    "the first consequence of this is a ` continuous ' ( @xmath37 ) increase in the rms of the ` small - scale ' errors in the redshift estimation , and , what it is worse , the overlaps in the color - color space become more frequent , with the corresponding rise in the number of ` catastrophic ' redshift errors . in addition , multicolor information may often be degenerate , so increasing the number of filters does not break the degeneracies ; for instance , by applying a simple pca analysis to the photometric data of the hdf spectroscopic sample it can be shown that the information contained in the seven @xmath38 filters for the hdf galaxies can be condensed using only three parameters , the coefficients of the principal components of the flux vectors ( see also @xcite ) .",
    "therefore , if the photometric errors are large , it is not always possible to get totally rid of the degeneracies even increasing the number of filters .",
    "this means that the presence of color / redshift degeneracies is unavoidable for faint galaxy samples .",
    "the training set method somehow alleviates this problem by introducing an additional parameter in the estimation , the magnitude , which in some cases may break the degeneracy .",
    "however , it is obvious that color / redshift degeneracies also affect galaxies with the same magnitude , and the training set method does not even contemplate the possibility of their existence !    the sed ",
    "fitting method at least allows for the existence of this problem , although it is not extremely efficient in dealing with it , especially with noisy data .",
    "its choice of redshift is exclusively based on the goodness of fit between the observed colors and the templates . in cases as the one described above , where two or more redshift / morphological type combinations have practically the same colors , the value of the likelihood @xmath39 would have two or more approximately equally high maxima at different redshifts ( see fig . [ peaks ] ) .",
    "depending on the random photometric error , one maximum would prevail over the others , and a small change in the flux could involve a catastrophic change in the estimated redshift ( see fig .",
    "[ peaks ] ) .",
    "however , in many cases there is additional information , discarded by ml , which could potentially help to solve such conundrums .",
    "for instance , it may be known from previous experience that one of the possible redshift / type combinations is much more likely than any other given the galaxy magnitude , angular size , shape , etc . in that case , and since the likelihoods are not informative enough , it seems clear that the more reasonable decision would be to choose the option which is more likely _ a priori _ as the best estimate .",
    "plain common sense dictates that one should compare all the possible hypotheses with the data , as ml does , but simultaneously keeping in mind the degrees of plausibility assigned to them by previous experience .",
    "there is not a simple way of doing this within ml , at best one may remove or change the redshift of the problematic objects by hand or devise _ ad hoc _",
    "solutions for each case .",
    "in contrast , bayesian probability theory allows to include this additional information in a rigorous and consistent way , effectively dealing with this kind of errors ( see sec [ bpz ] )      in some cases , the spectra of observed galaxies have no close equivalents in the template library .",
    "such galaxies will be assigned the redshift corresponding to the nearest template in the color / redshift space , no matter how distant from the observed color it is in absolute terms .",
    "the solution is obvious , one has to include enough templates in the library so that all the possible galaxy types are considered . as was explained above , the sed fitting techniques perform their own ` automatic ' interpolation and extrapolation , so once the main spectral types are included in the template library , the results are not greatly affected if one finely interpolates among the main spectra .",
    "the effects of using a correct but incomplete set of spectra are shown in sec [ test ] .",
    "both sources of errors described above are exacerbated at high redshifts .",
    "high redshift galaxies are usually faint , therefore with large photometric errors , and as the color / redshift space has a very extended range in @xmath14 , the degeneracies are more likely ; in addition the template incompleteness is worsened as there are few or no empirical spectra with which compare the template library .",
    "the accuracy of any photometric redshift technique is usually established by contrasting its output with a sample of galaxies with spectroscopic redshifts .",
    "it should be kept in mind , though , that the results of this comparison may be misleading , as the available spectroscopic samples are almost ` by definition ' especially well suited for photometric",
    "redshift estimation : relatively bright ( and thus with small photometric errors ) and often filling a privileged niche in the color - redshift space , far from degeneracies ( e.g. lyman - break galaxies ) .",
    "thus , it is risky to extrapolate the accuracy reached by current methods as estimated from spectroscopic samples ( and this also applies to bpz ) to fainter magnitudes .",
    "this is especially true for the training set methods , which deliberately minimize the difference between the spectroscopic and photometric redshifts .",
    "photometric redshift techniques based on template fitting look for the best estimate of a galaxy redshift from the comparison of its measured fluxes in @xmath40 filters @xmath41 , @xmath42 , with a set of @xmath43 template spectra which try to represent the different morphological types , and which have fluxes @xmath44 .",
    "these methods find their estimate @xmath45 by maximizing the likelihood @xmath39 ( or equivalently minimizing @xmath28 ) over all the possible values of the redshift @xmath14 , the templates @xmath24 and the normalization constant @xmath46 .",
    "@xmath47 since the normalization constant @xmath46 is considered a free parameter , the only information relevant to the redshift determination is contained in the ratios among the fluxes @xmath41 , that is , in the galaxy colors .    the definition of the likelihood in eq .",
    "( [ li ] ) is not convenient for applying bayesian methods as it depends on a normalization parameter @xmath46 , which is not convenient to define useful priors either theoretically or from previous observations .",
    "here we prefer to normalize the total fluxes in each band by the flux in a ` base ' filter , e.g. the one corresponding to the band in which the galaxy sample was selected and is considered to be complete .",
    "then the ` colors ' @xmath48 , are defined as @xmath49 @xmath50 , where @xmath51 is the base flux .",
    "the exact way in which the colors are defined is not relevant , other combinations of filters are equally valid .",
    "hereinafter the magnitude @xmath15 ( corresponding to the flux @xmath51 ) will be used instead of @xmath51 in the expressions for the priors . and",
    "so , assuming that the magnitude errors @xmath52 are gaussianly distributed , the likelihood can be defined as    @xmath53    where @xmath54[c_j - c_{tj}(z)]\\ ] ] and the matrix of moments @xmath55 can be expressed as @xmath56    by normalizing by @xmath51 instead of @xmath46 , one reduces the computational burden as it is not necessary to maximize over @xmath51 , which is already the ` maximum likelihood ' estimate for the value of the galaxy flux in that filter .",
    "it is obvious that this assumes that the errors in the colors are gaussian , which in general is not the case , even if the flux errors are .",
    "fortunately , the practical test performed below ( sec .",
    "[ test ] ) shows that there is little change between the results using both likelihood definitions ( see fig .",
    "[ comparison]a ) .",
    "within the framework of bayesian probability , the problem of photometric redshift estimation can be posed as finding the probability @xmath57 , i.e. , the probability of a galaxy having redshift @xmath14 given the data @xmath58 , _ and _ the prior information @xmath59 . as it was mentioned in the introduction ,",
    "bayesian theory states that _ all _ the probabilities are conditional ; they do not represent frequencies , but states of knowledge about hypothesis , and therefore always depend on other data or information ( for a detailed discussion of this and many other interesting issues see jaynes , 1998 ) .",
    "the prior information @xmath59 is an ample term which in general should include any knowledge that may be relevant to the hypothesis under consideration and is not already included in the data @xmath60 .",
    "note that in bayesian probability the relationship between the prior and posterior information is _ logical _ ; it does not have to be temporal or even causal .",
    "for instance , data from a new observation may be included as prior information to estimate the photometric redshifts of an old data set .",
    "although some authors recommend that the @xmath61 should not be dropped from the expressions of probability ( as a remainder of the fact that all probabilities are conditional and especially to avoid confusions when two probabilities based on different prior informations are considered as equal ) , here the rule of simplifying the mathematical notation whenever there is no danger of confusion will be followed , and from now @xmath62 will stand for @xmath63 , @xmath64 for @xmath65 etc .    as a trivial example of the application of bayes s theorem ,",
    "let s consider the case if which there is only one template and the likelihood @xmath39 only depends on the redshift @xmath14 . then ,",
    "applying bayes theorem @xmath66 the expression @xmath67 is simply the likelihood : the probability of observing the colors @xmath16 if the galaxy has redshift @xmath14 ( it is assumed for simplicity that @xmath39 only depends on the redshift and morphological type , and not on @xmath15 ) the probability @xmath68 is a normalization constant , and usually there is no need to calculate it .    the first factor , the _ prior _ probability @xmath69 , is the redshift distribution for galaxies with magnitude @xmath15 .",
    "this function allows to include information as the existence of upper or lower limits on the galaxy redshifts , the presence of a cluster in the field , etc .",
    "the effect of the prior @xmath69 on the estimation depends on how informative it is .",
    "it is obvious that for a constant prior ( all redshifts equally likely _ a priori _ ) the estimate obtained from eq .",
    "( [ 1 ] ) will exactly coincide with the ml result .",
    "this is also roughly true if the prior is ` smooth ' enough and does not present significant structure .",
    "however , in other cases , values of the redshifts which are considered very improbable from the prior information would be `` discriminated '' ; they must fit the data much better than any other redshift in order to be selected .",
    "note that in rigor , one should write the prior in eq .",
    "( [ 1 ] ) as @xmath70 where @xmath71 is the ` true ' value of the observed magnitude @xmath15 , @xmath72 is proportional to the number counts as a function of the magnitude @xmath15 and @xmath73 $ ] , i.e , the probability of observing @xmath15 if the true magnitude is @xmath71 . the above convolution accounts for the uncertainty in the value of the magnitude @xmath15 , which has the effect of slightly ` blurring ' and biasing the redshift distribution @xmath69 .",
    "to simplify our exposition this effect would not be consider hereinafter , and just @xmath69 and its equivalents will be used .",
    "it may seem from eq . [ 1 ] ( and unfortunately it is quite a widespread misconception ) that the only difference between bayesian and ml estimates is the introduction of a prior , in this case , @xmath69 . however , there is more to bayesian probability than just priors .",
    "the galaxy under consideration may belong to different morphological types represented by a set of @xmath43 templates .",
    "this set is considered to be _ exhaustive _ , i.e including all possible types , and _ exclusive _ : the galaxy can not belong to two types at the same time . in that case , using bayesian marginalization ( eq . [ mar ] ) the probability @xmath74 can be ` expanded ' into a ` basis ' formed by the hypothesis @xmath75 ( the probability of the galaxy redshift being @xmath14 _ and _ the galaxy type being @xmath24 ) .",
    "the sum over all these ` atomic ' hypothesis will give the total probability @xmath74 .",
    "that is , @xmath76 @xmath77 is the likelihood of the data @xmath16 given @xmath14 and @xmath24 .",
    "the prior @xmath78 may be developed using the product rule .",
    "for instance @xmath79 where @xmath80 is the galaxy type fraction as a function of magnitude and @xmath81 is the redshift distribution for galaxies of a given spectral type and magnitude .",
    "( [ bas ] ) and fig .",
    "[ peaks ] clearly illustrate the main differences between the bayesian and ml methods .",
    "ml would just pick the highest maximum over all the @xmath77 as the best redshift estimate , without looking at the plausibility of the corresponding values of @xmath14 or @xmath24 . on the contrary ,",
    "bayesian probability averages all these likelihood functions after weighting them by their prior probabilities @xmath78 . in this way",
    "the estimation is not affected by spurious likelihood peaks caused by noise as it is shown in fig .",
    "[ peaks ] ( see also the results of sec .",
    "[ test ] ) .",
    "of course that in an ideal situation with perfect , noiseless observations ( and a nondegenerate template space , i.e , only one @xmath16 for each @xmath82 pair ) the results obtained with ml and bayesian inference would be the same .    instead of a discrete set of templates ,",
    "the comparison library may contain spectra which are a function of continuous parameters .",
    "for instance , synthetic spectral templates depend on the metallicity @xmath83 , the dust content , the star formation history , etc . even starting from a set of a few templates",
    ", they may be expanded using the principal component analysis ( pca ) technique ( @xcite ) . in general ,",
    "if the spectra are characterized by @xmath84 possible parameters @xmath85 ( which may be physical characteristics of the models or just pca coefficients ) , the probability of @xmath14 given @xmath86 can be expressed as @xmath87      sometimes , instead of finding a ` point ' estimate for a galaxy redshift , one needs to establish if that redshift belongs within a certain interval .",
    "for instance , the problem may be to determine whether the galaxy has @xmath88 , where @xmath89 is a given threshold , or whether its redshift falls within a given @xmath90 , e.g. in the selection of cluster members or background galaxies for lensing studies .",
    "as an example , let s consider the classification of galaxies into the background - foreground classes with respect to a certain redshift threshold @xmath91 .",
    "one must choose between the hypothesis @xmath92 and its opposite , @xmath93 .",
    "the corresponding probabilities may be written as @xmath94 and @xmath95 the ( ` bookmaker ' ) odds of hypothesis @xmath96 are defined as the probability of @xmath96 being true over the probability of @xmath96 being false ( jaynes 1998 ) @xmath97 when @xmath98 , there is not enough information to choose between both hypothesis .",
    "a galaxy is considered to have @xmath99 if @xmath100 , where @xmath101 is a certain decision threshold .",
    "there are no fixed rules to choose the value of @xmath101 , and the most appropriate value depends on the task at hand ; for instance , to be really sure that no foreground galaxy has sneaked into the background sample , @xmath101 would have to be high , but if the main goal is selecting all the background galaxies and one does not mind including some foreground ones , then @xmath101 would be lower , etc .",
    "basically this is a problem concerning decision theory .    in the same way",
    ", the cluster galaxies can be selected by choosing a redshift threshold @xmath102 which defines whether a galaxy belongs to the cluster .",
    "the corresponding hypothesis would be @xmath103 .",
    "@xmath104 and @xmath105 similarly , the odds of @xmath106 are defined as @xmath107      in those cases where the prior information is vague and does not allow to choose a definite expression prior probability , bayesian inference offers the possibility of `` calibrating '' the prior , if needed using the very data sample under consideration .    let s suppose that the distribution @xmath108 is parametrized using @xmath109 continuous parameters @xmath110 .",
    "they may be the coefficients of a polynomial fit , a wavelet expansion , etc . in that case , including @xmath110 in eq .",
    "( [ bas ] ) , the probability can be written as @xmath111 where @xmath112 is the prior probability of @xmath110 , and @xmath113 is the prior probability of @xmath114 and @xmath15 as a function of the parameters @xmath110 .",
    "the latter have not been included in the likelihood expression since @xmath16 is totally determined once the values of @xmath14 and @xmath24 are known .",
    "now let s suppose that the galaxy belongs to a sample containing @xmath115 galaxies .",
    "each @xmath116th galaxy has a ` base ' magnitude @xmath117 and colors @xmath118 .",
    "the sets @xmath119 and @xmath120 contain respectively the colors and magnitudes of all the galaxies in the sample .",
    "then , the probability of the @xmath121th galaxy having redshift @xmath122 given the full sample data @xmath123 and @xmath124 can be written as @xmath125 the sets @xmath126 and @xmath127 , @xmath128 are identical to @xmath123 and @xmath124 except for the exclusion of the data @xmath129 and @xmath130 . applying bayes theorem , the product rule and simplifying @xmath131 where as before it has been considered that the likelihood of @xmath129 only depends on @xmath132 and that the probability of @xmath122 and @xmath24 only depend on @xmath133 and @xmath134 through @xmath110 . the expression to which we arrived is very similar to eq .",
    "( [ 20 ] ) only that now the shape of the prior is estimated from the data @xmath135 .",
    "this means that even if one starts with a very sketchy idea about the shape of the prior , the very galaxy sample under study can be used to determine the value of the parameters @xmath110 , and thus to provide a more accurate estimate of the individual galaxy characteristics . assuming that the data @xmath133 ( as well as @xmath124 ) are independent among themselves @xmath136 where @xmath137    if the number of galaxies in our sample is large enough , it can be reasonably assumed that the prior probability @xmath138 will not change appreciably with the inclusion of the data @xmath139 belonging to a single galaxy . in that case , a time - saving approximation is to use as a prior the probability @xmath140 , calculated using the whole data set , instead of finding @xmath138 for each galaxy . in addition",
    ", it should be noted that @xmath140 represents the bayesian estimate of the parameters which define the shape of the redshift distribution ( see fig .",
    "[ nz ] ) .      in some cases spectroscopical redshifts",
    "@xmath141 are available for a fraction of the galaxy sample .",
    "it is straightforward to include them in the prior calibration procedure described above , using a delta  function likelihood weighted by the probability of the galaxy belonging to a morphological type , as it is done to determine the priors in sec [ test ] .",
    "this gives the spectroscopical subsample a ( deserved ) larger weight in the determination of the redshift and morphological priors in comparison with the rest of the galaxies , at least within a certain color and magnitude region , but , unlike what happens with the training set method , the information contained in the rest of the sample is not thrown away .",
    "if nevertheless one wants to follow the training set approach and use only the spectroscopic sample , it is easy to develop a bayesian variant of this method .",
    "as before , the goal is to find an expression of the sort @xmath142 , which would give us the redshift probability for a galaxy given its colors and magnitude .",
    "if the color / magnitude / redshift multidimensional surface @xmath31 were infinitely thin , the probability would just be @xmath143 , where @xmath144 is a delta - function .",
    "but in the real world there is always some scatter around the surface defined by @xmath145 ( even without taking into account the color / redshift degeneracies ) , and it is therefore more appropriate to describe @xmath142 as e.g. a gaussian of width @xmath146 centered on each point of the surface @xmath145 .",
    "let s assume that all the parameters which define the shape of this relationship , together with @xmath146 are included in the set @xmath147 . using the prior calibration method introduced above",
    ", the probability distribution for these parameters @xmath148 can be determined from the training set @xmath149 .",
    "@xmath150    the expression for the redshift probability of a galaxy with colors @xmath16 and @xmath15 would then be @xmath151    the redshift probability obtained from eq .",
    "( [ 25 ] ) is compatible with the one obtained in eq .",
    "( [ bas ] ) using the sed  fitting procedure .",
    "therefore it is possible to combine them in a same expression . as an approximation ,",
    "let s suppose that both of them are given equal weights , then @xmath152    in fact , due to the above described redundancy between the sed ",
    "fitting method and the training set method ( sec .",
    "[ sed ] ) , it would be more appropriate to combine both probabilities using weights which would take these redundancies into account in a consistent way , roughly using eq.([25 ] ) at brighter magnitudes , where the galaxies are well studied spectroscopically and leaving eq.([bas ] ) for fainter magnitudes .",
    "the exploration of this combined , training set / sed - fitting approach will be left for a future paper , and in the practical tests performed below the followed procedure uses the sed ",
    "fitting likelihood .",
    "the hubble deep field ( hdf ; @xcite ) has become _ the _ benchmark in the development of photometric redshift techniques . in this section bpz",
    "will be applied to the hdf and its performance contrasted with the results obtained with the standard ` frequentist ' ( in the bayesian terminology ) method , the procedure usually applied to the hdf ( @xcite,@xcite , @xcite , etc . ) .",
    "the photometry used for the hdf is that of @xcite , which , in addition to magnitudes in the four hdf filters includes jhk magnitudes from the observations of @xcite .",
    "@xmath153 is chosen as the base magnitude .",
    "the colors are defined as described in sec .",
    "[ ml ] .",
    "the template library was selected after several tests with the hdf subsample which has spectroscopic redshifts ( 108 galaxies ) , spanning the range @xmath2 .",
    "the set of spectra which worked best is similar to that used by @xcite .",
    "it contains four @xcite templates ( e / s0 , sbc , scd , irr ) , that is the same spectral types used by @xcite , plus the spectra of 2 starbursting galaxies from @xcite(@xcite used two very blue seds from gissel ) .",
    "all the spectra were extended to the uv using a linear extrapolation and a cutoff at @xmath154 , and to the near  ir using gissel synthetic templates .",
    "the spectra are corrected for intergalactic absorption following @xcite .",
    "it could seem in principle that a synthetic template set which takes ( at least tentatively ) into account galaxy evolution is more appropriate than ` frozen ' template library obtained at low redshift and then extrapolated to very high redshifts .",
    "however , as @xcite has convincingly shown , the extended cww set offers much better results than the gissel synthetic models @xcite .",
    "i have also tried to use the rvf set of spectra and the agreement with the spectroscopic redshifts is considerably worse than using the empirical template set . and if the synthetic models do not work well within the magnitude range corresponding to the hdf spectroscopic sample is relatively bright , there is little reason to suppose that their performance will improve at fainter magnitudes .",
    "however , even working with empirical templates , it is important to be sure that the template library is complete enough .",
    "[ comparison ] illustrates the effects of template incompleteness in the redshift estimation .",
    "the left plot displays the results obtained using ml ( sec [ ml ] ) redshift estimation using only the four cww templates ( this plot is very similar to the @xmath155 diagram shown in @xcite , which confirms the validity of the expression for the likelihood introduced in sec [ ml ] ) . on the right , the results obtained also using ml ( no bpz yet ) but including two more templates , sb2 and sb3 from @xcite .",
    "it can be seen that the new templates almost do not affect the low redshift range , but the changes at @xmath156 are quite dramatic , the ` sagging ' of the cww  only diagram disappears and the general scatter of the diagram decreases by @xmath157 .",
    "this shows how important it is to include enough galaxy types in the template library .",
    "no matter how sophisticated the statistical treatment is , it will do little to improve the results obtained with a deficient template set .",
    "the first step in the application of bpz is choosing the shape of the priors . due to the depth of the hdf",
    "there is little previous information about the redshift priors , so this is a good example in which the prior calibration procedure described in sec[bpz ] has to be applied .",
    "it will be assumed that the early types ( e / s0 ) and spirals ( sbc , scd ) have a spectral type prior ( eq . [ pri ] ) of the form @xmath158 with @xmath159 for early types and @xmath160 for spirals .",
    "the irregulars ( the remaining three templates ; @xmath161 ) complete the galaxy mix .",
    "the fraction of early types at @xmath162 is assumed to be @xmath163 and that of spirals @xmath164 .",
    "the parameters @xmath165 and @xmath166 are left as free .",
    "based on the result from redshift surveys the following shape for the redshift prior has been chosen : @xmath167^{\\alpha_t }   \\ } \\label{par1}\\ ] ] where @xmath168 and @xmath169 , @xmath170 and @xmath171 are considered free parameters . in total , 11 parameters have to be determined using the calibration procedure . for those objects with spectroscopic redshifts ,",
    "a ` delta - function ' located at the spectroscopic redshift of the galaxy has been used instead of the likelihood @xmath77 .",
    "table 1 shows the values of the ` best ' values of the parameters in eq .",
    "( [ par1],[par2 ] ) found by maximizing the probability in eq .",
    "( [ 25 ] ) using the subroutine _ amoeba _ ( @xcite ) .",
    "the errors roughly indicate the parameter range which encloses @xmath172 of the probability .",
    "the values of the parameters in eq .",
    "( [ par ] ) are @xmath173 and @xmath174 .",
    "the prior in redshift @xmath69 can obviously be found by summing over the ` nuisance ' parameter ( jaynes 1998 ) , in this case @xmath24 : @xmath175 fig .",
    "[ priors ] plots this prior for different magnitudes .",
    "with the priors thus found , one can proceed with the redshift estimation using eq .",
    "( [ 20 ] ) . here the multiplication by the probability distribution @xmath112 and the integration over @xmath176 will be skipped . as it can be seen from table 1 ,",
    "the uncertainties in the parameters are rather small and it is obvious that the results would not change appreciably , so the additional computational effort of performing a 11-dimensional integral is not justified .",
    "there are several options to convert the continuous probability @xmath142 to a point estimate of the ` best ' redshift @xmath177 . here",
    "the ` mode ' of the final probability is chosen , although taking the ` median ' value of @xmath14 , corresponding to @xmath178 of the cumulative probability , or even the ` average ' @xmath179 is also valid .",
    "it was mentioned in sec [ bpz ] that bayesian probability offers a way to characterize the accuracy of the redshift estimation using the odds or a similar indicator , for instance by analogy with the gaussian distribution a ` @xmath180 ' error may be defined using a interval with contains @xmath172 of the integral of @xmath142 around @xmath177 , etc .",
    "here it has been chosen as an indicator of the redshift reliability the quantity @xmath181 , the probability of @xmath182 , where @xmath14 is the galaxy redshift . in this way ,",
    "when the value of @xmath181 is low , we are warned that the redshift prediction is unreliable . as it will be shown below",
    ", @xmath181 is extremely efficient in picking out galaxies with ` catastrophic errors ' in their redshifts .",
    "the photometric redshifts resulting from applying bpz to the spectroscopic sample are plotted in fig .",
    "galaxies with a probability @xmath183 ( there are three of them ) have been discarded , where @xmath102 is chosen to be @xmath184 , to take into account that the uncertainty grows with the redshift of the galaxies .",
    "it is evident from fig .",
    "[ hdf ] that the agreement is very good at all redshifts .",
    "the residuals @xmath185 have @xmath186 .",
    "if @xmath187 is divided by a factor @xmath188 , as suggested in @xcite , the rms of the quantity @xmath189 is only @xmath190 .",
    "there are no appreciable systematic effects in the residuals .",
    "one of the three objects discarded because of their having @xmath183 is the only clear outlier in our ml estimation , with @xmath191 and @xmath192 ( see fig .",
    "[ comparison]b ) , evidence of the usefulness of @xmath181 to generate a reliable sample .    from the comparison of fig .",
    "[ comparison]b with fig .",
    "[ hdf ] , it may seem that , apart from the exclusion of the outlier , there is not much profit in applying bpz with respect to ml .",
    "this is not surprising in the particular case of the hdf spectroscopic sample , which is formed mostly by galaxies either very bright or occupying privileged regions in the color space .",
    "the corresponding likelihood peaks are thus rather sharp , and little affected by smooth prior probabilities .",
    "to illustrate the effectiveness of bpz under worse than ideal conditions , the photometric redshifts for the spectroscopic sample are estimated again using ml and bpz but restricting the color information to the ubvi hst filters .",
    "the results are plotted in fig .",
    "the ml redshift diagram displays 5 ` catastrophic errors ' ( @xmath193 ) .",
    "note that these are the same kind of errors pointed out by @xcite in the first hdf photometric redshifts estimations .",
    "bpz with a @xmath194 threshold ( which eliminates a total of 7 galaxies ) totally eliminates those outliers .",
    "this is a clear example of the capabilities of bpz ( combined with an adequate template set ) to obtain reliable photometric redshift estimates .",
    "note that even using near ",
    "ir colors , the ml estimates shown in fig .",
    "[ comparison ] presented outliers .",
    "this shows that applying bpz to uv  only data may yield results more reliable than those obtained with ml including near - ir information ! although of course no more accurate ; the scatter of fig .",
    "[ comparison]b , once the outliers are removed is @xmath195 , whereas fig .",
    "[ 4f]b has a scatter of @xmath196 , which incidentally is approximately the scatter of fig .",
    "[ comparison]a .    another obvious way of testing the efficiency of bpz is with a simulated sample .",
    "the latter can be generated using the procedure described in @xcite .",
    "each galaxy in the hdf is assigned a redshift and type using ml ( this is done deliberately to avoid biasing the test towards bpz ) and then a mock catalog is created containing the colors corresponding to the best fitting redshifts and templates . to represent the photometric errors present in observations , a random photometric noise of the same amplitude as the photometric error",
    "is added to each object .",
    "[ 90]b shows the ml estimated redshifts for the mock catalog ( @xmath197 ) against the ` true ' redshifts ; although in general the agreement is not bad ( as could be expected ) there are a large number of outliers ( @xmath198 ) , whose positions illustrate the main source of color / redshift degeneracies : high @xmath14 galaxies which are erroneously assigned @xmath29 redshifts and vice versa .",
    "this shortcoming of the ml method is analyzed in detail in @xcite .",
    "in contrast , fig .",
    "[ 90]a shows the results of applying bpz with a threshold of @xmath199 .",
    "this eliminates @xmath157 of the initial sample ( almost half of which have catastrophically wrong redshifts ) , but the number of outliers is reduced to a remarkable @xmath200 .",
    "is it possible to define some ` reliability estimator ' , similar to @xmath181 within the ml framework ?",
    "the obvious choice seems to be @xmath28 .",
    "[ odds]b plots the value of @xmath28 vs. the ml redshift error for the mock catalog .",
    "it is clear that @xmath28 is almost useless to pick out the outliers .",
    "the dashed line marks the upper @xmath201 quartile in @xmath28 ; most of the outliers are below it , at smaller @xmath28 values . in stark contrast ,",
    "[ odds]a plots the errors in the bpz redshifts _ vs. _ the values of @xmath181 .",
    "the lower @xmath201 quartile , under the dashed line , contains practically all the outliers . by setting an appropriate threshold one",
    "can virtually eliminate the ` catastrophic errors ' .",
    "[ oddsmz ] shows the numbers of galaxies above a given @xmath181 threshold in the hdf as a function of magnitude and redshifts .",
    "it shows how risky it is to estimate photometric redshifts using ml for faint , @xmath202 objects ; the fraction of objects with possible catastrophic errors grows steadily with magnitude .",
    "there is one caveat regarding the use of @xmath181 or similar quantities as a reliability estimator .",
    "they provide a safety check against the color / redshift degeneracies , since basically they tell us if there are other probability peaks comparable to the highest one , but they can not protect us from template incompleteness .",
    "if the template library does not contain any spectra similar to the one corresponding to the galaxy , there is no indicator able to warn us about the unreliability of the prediction .",
    "because of this , no matter how sophisticated the statistical methods become , it is fundamental to have a good template set , which contains  even if only approximately  all the possible galaxy types present in the sample .",
    "finally , fig .",
    "[ nz ] shows the redshift distributions for the hdf galaxies with @xmath203 .",
    "no objects have been removed on the basis of @xmath181 , so the values of the histogram bins should be taken with care .",
    "the overplotted continous curves are the distributions used as priors and which simultaneously are the bayesian fits to the final redshift distributions .",
    "the results obtained from the hdf will be analyzed in more detail , using a revised photometry , in a forthcoming paper .",
    "as we argue above , the use of bpz for photometric redshift estimation offers obvious advantages over standard ml techniques .",
    "however , quite often obtaining photometric redshifts is not an end in itself , but an intermediate step towards measuring other quantities , like the evolution of the star formation rate ( @xcite ) , the galaxy  galaxy correlation function ( @xcite,@xcite ) , galaxy or cluster mass distributions ( @xcite ) , etc .",
    "the usual procedure consists in obtaining photometric redshifts for all the galaxies in the sample , using ml or the training set method , and then work with them as if these estimates were accurate , reliable spectroscopic redshifts .",
    "the results of the previous sections alert us to the dangers inherent in that approach , as it hardly takes into account the uncertainties involved in photometric redshift estimation .",
    "in contrast , within the bayesian framework there is no need to work with the discrete , point ",
    "like ` best ' redshift estimates .",
    "the whole redshift probability distribution can be taken into account , so that the uncertainties in the redshift estimation are accounted for in the final result . to illustrate this point ,",
    "let s outline how bpz can be applied to several problems which use photometric redshift estimation .",
    "if , instead of working with a discrete set of templates , one uses a spectral library whose templates depend of parameters as the metallicity , the star - formation history , initial mass function , etc . , represented by @xmath7 in sec [ bpz ] , it is obvious from equation ( [ cont ] ) that the same technique used to estimate the redshift can be applied to estimate any of the parameters @xmath7 which characterize the galaxy spectrum .",
    "for instance , let s suppose that one want to estimate the parameter @xmath204 . then defining @xmath205",
    ", we have @xmath206 that is , the likelihoods @xmath207 and the weights @xmath208 are the same ones used for the redshift estimation ( eq . [ cont ] ) , only that now the integration is performed over the variables @xmath14 and @xmath209 instead of @xmath7 . in this way ,",
    "depending on the template library which is being used , one can estimate galaxy characteristics as the metallicity , dust content , etc .",
    "an important advantage of this method over ml is that the estimates of the parameter @xmath204 automatically include the uncertainty of the redshift estimation , which is reflected in the final value of @xmath210 . besides , by integrating the probability over all the parameters @xmath209 , one precisely includes the uncertainties caused by possible parameter degeneracies in the final result for @xmath204 .",
    "it should also be noted that as many of the results obtained in this paper , this method can be almost straightforwardly applied to spectroscopical observations ; one has only to modify the likelihood expression which compares the observed fluxes with the spectral template .",
    "the rest of the formalism remains practically identical .",
    "one frequent application of photometric redshift techniques is the study of galaxy cluster fields .",
    "the goals may be the selection of cluster galaxies to characterize their properties , especially at high redshifts , or the identification of distant , background galaxies to be used in gravitational lensing analysis ( @xcite ) .",
    "bpz offers an effective way of dealing with such problems .    to simplify the problem , the effects of gravitational lensing on the background galaxies ( magnification , number counts depletion , etc",
    ". ) will be neglected ( see however the next subsection ) .",
    "let s suppose that we already have an estimate of the projected surface density of cluster galaxies ( which can roughly be obtained without any photometric redshifts , just from the number counts surface distribution ) @xmath211 , where @xmath212 is the position with respect to the cluster center .",
    "the surface density of ` field ' , non  cluster galaxies is represented by @xmath213 . for each galaxy in the sample",
    "we know its magnitude and colors @xmath214 and also its position @xmath212 , which is now a relevant parameter in the redshift estimation .",
    "following eq .",
    "( [ bas ] ) we can write @xmath215 a dependence on the magnitude ( e.g. for the early types cluster sequence ) could easily be included in the likelihood @xmath77 if needed .",
    "the prior can be divided into the sum of two different terms : @xmath216 where @xmath217 represents the prior probability of the galaxy belonging to the cluster , whereas @xmath218 corresponds to the prior probability of the galaxy belonging to the general field population .",
    "the expression for @xmath217 can be written as @xmath219    the probability @xmath220 corresponds to the expected galaxy mix fraction in the cluster , which in general will depend on the magnitude and will be different from that of field galaxies .",
    "the function @xmath221 is the redshift profile of the cluster ; a good approximation could be a gaussian with a width corresponding to the cluster velocity dispersion .",
    "the second prior takes the form @xmath222    which uses the priors for the general field galaxy population ( sec [ test ] ) . finally , the hypothesis that the galaxy belongs to the cluster or not can be decided about with the help of a properly defined @xmath181 , or with the odds introduced in sec [ bpz ] .",
    "we have assumed above that the cluster redshift and its galaxy surface density distribution are known . however , in some cases , there is a reasonable suspicion about the presence of a cluster at a certain redshift , but not total certainty , and our goal is to confirm its existence .",
    "an example using ml photometric redshift estimation is shown in @xcite .",
    "an extreme case with minimal prior information occur in optical cluster surveys , galaxy catalogs covering large areas of the sky are searched for clusters . in those cases there are no previous guesses about the position or redshift of the cluster , and a ` blind ' , automatized search algorithm has to be used ( @xcite ) .",
    "the prior expression used in the previous subsection offers a way to build such a searching method . instead of assuming that the cluster redshift and its surface distribution are known , the redshift can be left as a free parameter @xmath223 and the expression characterizing the cluster galaxy surface density distribution @xmath211 can be parametrized using the quantities @xmath224 .",
    "for simplicity , let s suppose that @xmath225 where @xmath226 is the cluster ` amplitude ' , @xmath227 is the number counts distribution expected for the cluster ( which in general will depend on the redshift @xmath223 ) and @xmath228 represents the cluster profile , centered on @xmath229 and with a scale width of @xmath230 .",
    "this expression , except for the dependence on the redshift is very similar to that used by @xcite to define their likelihood .",
    "then for a multicolor galaxy sample with data @xmath124 , @xmath231 and @xmath232 , the probability @xmath233 can be developed analogously to how it was done in sec .",
    "[ bpz ] . the probability assigned to the existence of a cluster at a certain redshift and position may be simply defined as @xmath234 .",
    "it seems that the most obvious application of bpz to cluster lensing analysis is the selection of background galaxies with the technique described in the previous subsection in order to apply the standard cluster mass reconstruction techniques ( @xcite , @xcite , @xcite , @xcite ) .",
    "however , using bayesian probability it is possible to develop an unified approach which simultaneously considers the lensing and photometric information in an optimal way .    in a simplified fashion",
    ", the problem of determining the mass distribution of a galaxy cluster from observables can be stated as finding the probability @xmath235 where @xmath236 represent the parameters which describe the cluster mass distribution ; their number may range from a few , if the cluster is described with a simplified analytical model or as many as wanted if the mass distribution is characterized by e.g. fourier coefficients ( @xcite ) .",
    "@xmath237 represents the cosmological parameters , which sensitively affect the lensing strength .",
    "the parameter set @xmath238 represents the properties of the background galaxy population which affect the lensing , as its redshift distribution , number counts slope , etc .",
    "and it is assumed to be known previously .",
    "the data @xmath239 correspond to the galaxy ellipticities , @xmath240 to their angular positions . as above , @xmath241 correspond to their colors and magnitudes . for simplicity , it will be assumed that the cluster and foreground galaxies have been already removed and we are dealing only with the background galaxy population .",
    "analogous to eq .",
    "( [ 23 ] ) , we can develop eq .",
    "( [ 38 ] ) as @xmath242 where the last factor may be written as @xmath243 the meaning of the three factors on the right side of the equation is the following : @xmath244 represents the likelihood of measuring a certain ellipticity @xmath245 in a galaxy given its redshift , position , etc .",
    "the second factor @xmath246 corresponds to the so called `` broadhurst effect '' , the number counts depletion of background galaxies caused by the cluster magnification @xmath247 ( broadhurst 1995 , bentez & broadhurst 1998 ) .",
    "the last factor , @xmath248 is the redshift probability , but including a correction which takes into account that the observed magnitude of a galaxy @xmath15 is affected by the magnification @xmath249 .",
    "it is clear that the simplified method outlined here is not the only way of applying bayesian probability to cluster mass reconstruction .",
    "my purpose here is to show that this can be done considering the photometric redshifts in a integrated way with the rest of the information .",
    "as it has been shown in section ( [ bpz ] ) , bpz can be used to estimate the parameters characterizing the joint magnitude  redshift ",
    "morphological type galaxy distribution . for small fields",
    ", this distribution may be dominated by local perturbations , and the redshift distribution may be ` spiky ' , as it is observed in redshift surveys of small fields .",
    "however , if one were to average over a large number of fields , the resulting distribution would contain important information about galaxy evolution and the fundamental cosmological parameters .",
    "@xcite included galaxy counts as one of the four fundamental tests of observational cosmology , although noting that the number - redshift distribution is in fact more sensitive to the value of @xmath250 .",
    "as @xcite also notes , the color distribution of the galaxies in a survey hold also much more information about the process of galaxy evolution that the raw number counts . however , quite often the only method of analyzing multicolor observations is just comparing them with the number counts model predictions , or at most , with color distributions .",
    "there are several attempts at using photometric redshifts to study global galaxy evolution parameters ( e.g. @xcite , @xcite ) , but so far there is not an integrated statistical method which would simultaneously considers all the information , magnitudes and colors , contained in the data , and set it against the model predictions .",
    "it is then clear that eq .",
    "( [ 23 ] ) can be used to estimate these parameters from large enough samples of multicolor data . if it is assumed that all the galaxies belong to a few morphological types , the joint redshift - magnitude-`type ' distribution can be written as @xmath251 where @xmath252 is the comoving volume as a function of redshift , which depends on the cosmological parameters @xmath253 and @xmath254 , and @xmath255 is the schecter luminosity function for each morphological type @xmath24 , where the absolute magnitude @xmath256 has been substituted by the apparent magnitude @xmath15 ( a transformation which depends on the redshifts , cosmological parameters and morphological type ) .",
    "schecter s function also depend on @xmath257 , @xmath258 and @xmath259 , and on the evolutionary parameters @xmath260 , such as the merging rate , the luminosity evolution , etc .",
    "therefore , the prior probability of @xmath14,@xmath7 and @xmath261 depends on the parameters @xmath262 , @xmath263 and @xmath260 . as an example , let s suppose that one wants to estimate @xmath260 , independently of the rest of the parameters , given the data @xmath264 .",
    "then @xmath265 @xmath266 the prior @xmath267 can be derived from @xmath268 in eq .",
    "( [ 5 ] ) .",
    "the prior @xmath269 allows to include the uncertainties derived from previous observations or theory in the values of these parameters , even when they are strongly correlated among themselves , as in the case of the schecter function parameters @xmath270 .",
    "the narrower the prior @xmath269 is , the less ` diluted ' the probability of @xmath260 and the more accurate the estimation .",
    "despite the remarkable progress of faint galaxy spectroscopical surveys , photometric redshift techniques will become increasingly important in the future .",
    "the most frequent approaches , the template  fitting and empirical training set methods , present several problems related which hinder their practical application .",
    "here it is shown that by consistently applying bayesian probability to photometric redshift estimation , most of those problems are efficiently solved . the use of prior probabilities and bayesian marginalization allows the inclusion of valuable information as the shape of the redshift distributions or the galaxy type fractions , which is usually ignored by other methods .",
    "it is possible to characterize the accuracy of the redshift estimation in a way with no equivalents in other statistical approaches ; this property allows to select galaxy samples for which the redshift estimation is extremely reliable . in those cases",
    "when the _ a priori _ information is insufficient , it is shown how to ` calibrate ' the prior distributions , using even the data under consideration . in this way it is possible to determine the properties of individual galaxies more accurately and simultaneously",
    "estimate their statistical properties in an optimal fashion .",
    "the photometric redshifts obtained for the hubble deep field using optical and near - ir photometry show an excellent agreement with the @xmath0 spectroscopic redshifts published up to date in the interval @xmath271 , yielding a rms error @xmath272 and no outliers .",
    "note that these results , obtained with an empirical set of templates , have not been reached by minimizing the difference between spectroscopic and photometric redshifts ( as for empirical training set techniques , which may lead to an overestimation of their precision ) and thus offer a reasonable estimate of the predictive capabilities of bpz .",
    "the reliability of the method is also tested by estimating redshifts in the hdf but restricting the color information to the ubvi filters ; the results are shown to be more reliable than those obtained with the existing techniques even including the near - ir information .",
    "the bayesian formalism developed here can be generalized to deal with a wide range of problems which make use of photometric redshifts .",
    "several applications are outlined , e.g. the estimation of individual galaxy characteristics as the metallicity , dust content , etc . , or the study of galaxy evolution and the cosmological parameters from large multicolor surveys .",
    "finally , using bayesian probability it is possible to develop an integrated statistical method for cluster mass reconstruction which simultaneously considers the information provided by gravitational lensing and photometric redshift estimation .",
    "i would like to thank tom broadhurst and rychard bouwens for careful reading the manuscript and making valuable comments .",
    "thanks also to alberto fernndez - soto and collaborators for kindly providing me with the hdf photometry and filter transmissions , and to brenda frye for help with the intergalactic absorption correction .",
    "the author acknowledges a basque government postdoctoral fellowship .",
    "jaynes , `` probability theory : the logic of science '' , to be published in cambridge university press . a preliminary version can be obtained from thomas loredo s web page at _ http://astrosun.tn.cornell.edu / staff / loredo / bayes/_."
  ],
  "abstract_text": [
    "<S> photometric redshift estimation is becoming an increasingly important technique , although the currently existing methods present several shortcomings which hinder their application . here it is shown that most of those drawbacks are efficiently eliminated when bayesian probability is consistently applied to this problem . the use of prior probabilities and bayesian marginalization allows the inclusion of valuable information , e.g. the redshift distributions or the galaxy type mix , which is often ignored by other methods . </S>",
    "<S> it is possible to quantify the accuracy of the redshift estimation in a way with no equivalents in other statistical approaches ; this property permits the selection of galaxy samples for which the redshift estimation is extremely reliable . in those cases </S>",
    "<S> when the _ a priori _ information is insufficient , it is shown how to ` calibrate ' the prior distributions , using even the data under consideration .    </S>",
    "<S> there is an excellent agreement between the @xmath0 hdf spectroscopic redshifts and the predictions of the method , with a rms error @xmath1 up to @xmath2 and no systematic biases nor outliers . </S>",
    "<S> note that these results have not been reached by minimizing the difference between spectroscopic and photometric redshifts ( as is the case with empirical training set techniques ) , which may lead to an overestimation of the accuracy . </S>",
    "<S> the reliability of the method is further tested by restricting the color information to the ubvi filters . </S>",
    "<S> the results thus obtained are shown to be more reliable than those of standard techniques even when the latter include near - ir colors .    </S>",
    "<S> the bayesian formalism developed here can be generalized to deal with a wide range of problems which make use of photometric redshifts . </S>",
    "<S> several applications are outlined , e.g. the estimation of individual galaxy characteristics as the metallicity , dust content , etc . , or the study of galaxy evolution and the cosmological parameters from large multicolor surveys . </S>",
    "<S> finally , using bayesian probability it is possible to develop an integrated statistical method for cluster mass reconstruction which simultaneously considers the information provided by gravitational lensing and photometric redshift estimation . </S>"
  ]
}