{
  "article_text": [
    "let @xmath4 be a surface .",
    "two closed curves @xmath5 are , written @xmath6 , if there exists a continuous map @xmath7\\times\\r/\\z$ ] such that @xmath8 and @xmath9 for all @xmath10 . assuming the curves in generic position , their number of intersections is @xmath11 their only depends on their free homotopy classes and is defined as @xmath12 likewise",
    ", the number of self - intersections of @xmath13 is given by @xmath14 and its minimum over all the curves freely homotopic to @xmath13 is its @xmath15 .",
    "note the one half factor that comes from the identification of @xmath16 with @xmath17 .",
    "the geometric intersection number is an important parameter that allows to stratify the set of homotopy classes of curves on a surface .",
    "the surface is usually endowed with a hyperbolic metric , implying that each homotopy class is identified by its unique geodesic representative . extending a former result by mirzakhani  @xcite",
    ", sapir  @xcite has recently provided tight asymptotics for the number of closed geodesics with bounded length and bounded geometric intersection number . chas and",
    "lalley  @xcite also proved that the distribution of the geometric intersection number with respect to the length of geodesics approaches the gaussian distribution as the length grows to infinity .",
    "other more experimental results were obtained with the help of a computer to show the existence of length - equivalent homotopy classes with distinct geometric intersection numbers  @xcite .",
    "hence , for both theoretical and practical reasons various aspects of the computation of geometric intersection numbers have been studied in the past including the algorithmic ones .",
    "nonetheless , all the previous approaches rely on rather complex mathematical arguments and to our knowledge no exact complexity analysis has yet appeared . in this paper , we make our own the words of dehn who noted that the metric on words ( on some basis of the fundamental group of the surface ) can advantageously replace the hyperbolic metric  @xcite .",
    "we propose a combinatorial framework that leads to simple algorithms of low complexity to compute the geometric intersection number of curves or to test if this number is zero .",
    "our approach is based on the computation of canonical forms as recently introduced in the purpose of testing whether two curves are homotopic  @xcite .",
    "canonical forms are instances of combinatorial geodesics who share nice properties with the geodesics of a hyperbolic surface . on such surfaces",
    "each homotopy class contains a unique geodesic that moreover minimizes the number of self - intersections .",
    "although a combinatorial geodesic is generally not unique in its homotopy class , it must stay at distance one from its canonical representative and a careful analysis of its structure leads to the first result of the paper .",
    "[ th : main - result ] given two curves represented by closed walks of length at most @xmath0 on a combinatorial surface of complexity @xmath1 we can compute the geometric intersection number of each curve or of the two curves in @xmath2 time .    as usual the complexity of a combinatorial surface stands for its total number of vertices , edges and faces .",
    "a key point in our algorithm is the ability to compute the primitive root of a canonical curve in linear time .",
    "we next provide an algorithm to compute an actual curve immersion that minimizes the number of self - interactions in its homotopy class .",
    "[ th : compute - immersion ] let @xmath18 be a closed walk of length @xmath0 in canonical form .",
    "we can compute a combinatorial immersion with @xmath19 crossings in @xmath20 time .",
    "we also propose a nearly optimal algorithm that answers an old problem studied by poincar  @xcite : decide if the geometric intersection number of a curve is null , that is if the curve is homotopic to a simple curve .",
    "[ th : simple - curve ] given a curve represented by a closed walk of length @xmath0 on a combinatorial surface of complexity @xmath1 we can decide if the curve is homotopic to a simple curve in @xmath21 time . in the affirmative",
    "we can construct an embedding of @xmath18 in the same amount of time .    in the next section we review some of the previous relevant works .",
    "we introduce our combinatorial framework in section  [ sec : framework ] and discuss the structure of combinatorial geodesics in section  [ sec : geodesics ] .",
    "section  [ sec : strategy ] presents our general simple strategy to compute the geometric intersection number .",
    "the proof of theorem  [ th : main - result ] is given in the next three sections where the case of non - primitive curves is also treated .",
    "the computation of a minimally crossing immersion is presented in section  [ sec : computing - immersions ] and  [ sec : finding - bigons ] with the proof of theorem  [ th : compute - immersion ] .",
    "we finally propose a simple algorithm to detect and embed curves homotopic to simple curves ( theorem  [ th : simple - curve ] ) in section  [ sec : simple - curves ] .",
    "in the fifth supplement to its _ analysis situs _ poincar  @xcite describes a method to decide whether a given closed curve @xmath22 on a surface can be continuously deformed to a simple curve . for this",
    ", he considers the surface as the quotient @xmath23 of the poincar disk @xmath24 by a ( fuchsian ) group @xmath25 of hyperbolic transformations .",
    "the endpoints of a lift of @xmath22 in the poincar disk are related by a hyperbolic transformation whose axis is a hyperbolic line @xmath26 representing the unique geodesic homotopic to @xmath22 .",
    "he concludes that @xmath22 is homotopic to a simple curve if and only if all the transforms of @xmath26 by @xmath25 are pairwise disjoint or equal .",
    "this method was turned into an algorithm by reinhart  @xcite who worked out the explicit computations in the poincar disk using the usual representation of hyperbolic transformations by two - by - two matrices .",
    "the entries of the matrices being algebraic the computation could indeed be performed accurately on a computer .",
    "the ability to recognize curves that are _ primitive _ , i.e. whose homotopy class can not be expressed as a proper power of another class , happens to be crucial in this algorithm though computationally expensive .",
    "birman ans series  @xcite subsequently proposed an algorithm for the case of surfaces with nonempty boundary that avoids manipulating algebraic numbers .",
    "while their arguments appeal to a hyperbolic structure , their algorithm is purely combinatorial .",
    "intuitively , a surface with boundary deform retracts onto a fat graph ( in fact a fat bouquet of circles ) whose universal covering space embeds as a fat tree in the poincar disk .",
    "the successive lifts of a curve @xmath22 trace a bi - infinite path in this tree .",
    "the limit points of this path belongs to the circle @xmath27 at infinity and coincide with the ideal endpoints of the axis of the hyperbolic transformation corresponding to any of the lifts of the curve in the path .",
    "the question as to whether two lifts give rise to intersecting axes can thus be reduced to test if the corresponding bi - infinite paths have separating limit points on @xmath27 . as for reinhart , birman and series",
    "assume that the homotopy class of @xmath22 is given by a word @xmath28 on some given set of generators of the fundamental group of the surface . in turn , the above test on bi - infinite paths boils down to consider the cyclic permutations of @xmath28 and @xmath29 in a cyclic lexicographic order and to check if this ordering is well - parenthesized with respect to some pairing of the words .",
    "cohen and lustig  @xcite further observed that the approach of birman and series could be extended to count the geometric intersection number of one or two curves . in a second paper lustig  @xcite",
    "tackles the case where the curves are taken on a surface without boundary .",
    "he considers a closed surface with negative euler characteristic as the quotient of the poincar disk by a group of transformations isomorphic to the fundamental group of the surface .",
    "the main contribution of the paper is to define a canonical representative for every free homotopy class @xmath13 given as a word in some fixed system of loops generating the fundamental group .",
    "lustig first notes that there is no known way of choosing a unique word for @xmath13 .",
    "in particular , the shortest words are far from unique .",
    "he rather represents ( a lift of ) @xmath13 by a path in the union @xmath30 of three tessellations of @xmath24 , where the edges of @xmath31 are all the lifts of the generating loops , @xmath32 is the dual tessellation , and the edges of @xmath33 joins the vertices of @xmath31 with the vertices of @xmath32 .",
    "( although the graphs of @xmath31 , @xmath32 and @xmath33 are embedded their union is not as every edge of @xmath31 crosses its dual edge in @xmath32 . )",
    "lustig gives a purely combinatorial characterization of canonical paths and argues that the method in his first paper  @xcite can be applied to the canonical representative of @xmath13 .",
    "overall the two papers adds up to 60 pages with essential arguments from hyperbolic geometry and the complexity of the whole procedure remains to be done .",
    "other approaches were developed without assuming any hyperbolic structure .",
    "based on the notion of winding number , chillingsworth  @xcite provides an algorithm to test whether a curve is homotopic ( this time with fixed basepoint ) to a simple curve on a surface with nonempty boundary .",
    "he also proposed an algorithm for determining when a given set of _ simple _ closed curves can be made disjoint by ( free ) homotopy  @xcite .",
    "while the winding number relies on a differentiable structure , zieschang  @xcite used the connection between the automorphisms of a topological surface and the automorphisms of its fundamental group in order to detect the homotopy classes of simple closed curves .",
    "a related work by hass and scott  @xcite is concerned with curves which have excess intersection , i.e. that can be homotoped so as to reduce their number of intersections .",
    "hass and scott introduce various types of monogons and bigons that can be either embedded , singular or weak .",
    "a _ singular monogon _ of a curve @xmath34 is a contractible subpath of @xmath22 whose endpoints define a self - intersection of @xmath22 .",
    "a _ bigon _ of @xmath22 is defined by two self - intersections joined by two homotopic subpaths ( with fixed endpoints ) @xmath35 and @xmath36 with @xmath37 .",
    "the bigon is said _ singular _ if the defining segments @xmath38 are disjoint and _ weak _ otherwise .",
    "hass and scott prove that a curve with excess self - intersection on an orientable surface must have a singular monogon or a singular bigon .",
    "their result directly suggests an algorithm to compute the geometric intersection number of a curve : iteratively remove monogons or untie bigons until there is no more .",
    "the final configuration must have the minimal number of self - intersections .",
    "designing an efficient procedure to find monogons and bigons remains the crux of this approach . in any case , the method can not be extended to compute the geometric intersection number of two curves since hass and scott give two counter - examples to the fact that two curves with excess intersections should have a singular monogon or bigon .",
    "one of their counter - examples contains a curve with excess self - intersections and the other one contains a non - primitive curve .",
    "our counter - example , figure  [ fig : no - singular - bigon ] , shows that even assuming each curve to be primitive and in minimal configuration , we may have excess intersections without singular bigons .",
    "nonetheless , it was proved  @xcite that starting from any configuration of curves one may reach a configuration with a minimal number of intersections by applying a finite sequence of elementary moves involving monogons , bigons and trigons similar to the reidemeister moves in knot theory .",
    "a surprising consequence was obtained by neumann - coto  @xcite .",
    "define a _ cut and paste _ on a family of curves by cutting the curves at some of their intersection points and glueing the resulting arcs in a different order .",
    "neumann - coto proves that any set of primitive curves can be brought to a homotopic set with minimal ( self-)intersections by a set of cut and paste operations .",
    "note that each intersection of two curve pieces can be re - arranged in three different manners , including the original one , by a cut and paste .",
    "hence , if the curves have @xmath39 ( self-)intersections we may find a minimal configuration out of the @xmath40 possible re - configurations !",
    "we also mention the algebraic approach of gonalves et al .",
    "@xcite based on previous works by turaev  @xcite who introduced intersection forms over the integral group ring of the fundamental group of the surface .",
    "see  @xcite for more historical notes .",
    "we introduce our combinatorial framework and show that it faithfully represents its continuous analogue .    [ [ combinatorial - surfaces . ] ] combinatorial surfaces .",
    "+ + + + + + + + + + + + + + + + + + + + + + +    as usual in computational topology , we model a surface by a cellular embedding of a graph @xmath31 in a compact topological surface @xmath4 .",
    "such a cellular embedding can be encoded by a composed of the graph @xmath31 itself together with a rotation system  @xcite that records for every vertex of the graph the clockwise cyclic order of the incident arcs .",
    "the are obtained from the rotation system by the face traversal procedure as described in  @xcite . in order to handle surfaces with boundaries we allow every face of @xmath31 in @xmath4 to be either an open disk or an annulus ( open on one side ) . in other words",
    "@xmath31 is a cellular embedding in the closure of @xmath4 obtained by attaching a disk to every boundary of @xmath4 .",
    "we record this information by storing a boolean for every facial walk of @xmath31 indicating whether the associated face is perforated or not .",
    "all the considered graphs may have loop and multiple edges .",
    "a directed edge will be called an and each edge corresponds to two opposite arcs .",
    "we denote by @xmath41 the arc opposite to an arc @xmath42 . for simplicity , .",
    "every combinatorial surface @xmath43 can be reduced by first contracting the edges of a spanning tree and then deleting edges incident to distinct faces .",
    "the resulting has a single vertex and a single face . the combinatorial surface @xmath43 and its reduced version encodes different cellular embeddings on a same topological surface .    [ [ combinatorial - curves . ] ] combinatorial curves .",
    "+ + + + + + + + + + + + + + + + + + + + +    consider a combinatorial surface with its graph @xmath31 . a combinatorial curve ( or path )",
    "@xmath18 is a walk in @xmath31 , i.e. an alternating sequence of vertices and arcs , starting and ending with a vertex , such that each vertex in the sequence is the target vertex of the previous arc and the source vertex of the next arc .",
    "we generally omit the vertices in the sequence .",
    "a combinatorial curve is closed when additionally the first and last vertex are equal .",
    "when no confusion is possible we shall drop the adjective combinatorial .",
    "the of @xmath18 is its total number of arc occurrences , which we denote by @xmath44 .",
    "if @xmath18 is closed , we write @xmath45 , @xmath46 , for the vertex of index @xmath47 of @xmath18 and @xmath48 for the arc joining @xmath45 to @xmath49 . for convenience we set @xmath50=c[\\ibar,\\ibar+1]{\\ensuremath{^{-1}}}$ ] to allow the traversal of @xmath18 in reverse direction .",
    "in order to differentiate the arcs with their occurrences we denote by @xmath51_c$ ] the corresponding occurrence of the arc @xmath52 $ ] in @xmath53 , where @xmath54 is obtained by traversing @xmath55 in the opposite direction .",
    "more generally , for any non - negative integer @xmath0 and any sign @xmath56 , the sequence of indices @xmath57 is called an of @xmath18 of length @xmath0",
    ". the index path can be ( @xmath58 ) or ( @xmath59 ) and can be longer than @xmath18 so that an index may appear more than once in the sequence .",
    "we denote this path by @xmath60 .",
    "its is given by the arc sequence @xmath61,c[\\overline{\\imath+\\varepsilon},\\overline{\\imath+2\\varepsilon}],\\dots , c[\\overline{\\varepsilon(\\ell-1)},\\overline{\\varepsilon\\ell}]).\\ ] ] the image path of a length zero index path is just a vertex .",
    "a of @xmath18 is a subsequence of the form @xmath62 where @xmath42 is an arc .",
    "a closed curve is if it is homotopic to a trivial curve ( i.e. , a curve reduced to a single vertex ) .",
    "we will implicitly assume that a homotopy has fixed endpoints when applied to paths and is free when applied to closed curves .",
    "[ [ combinatorial - immersions . ] ] combinatorial immersions .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + +    following the notion of a combinatorial set of loops as in  @xcite , we define a of a set @xmath63 of combinatorial curves as the data for each arc @xmath42 in @xmath31 of a left - to - right order @xmath64 over all the occurrences of @xmath42 or @xmath41 in the curves of @xmath63 .",
    "the only requirement is that opposite arcs should be associated with inverse orders .",
    "let @xmath65 be the set of occurrences of @xmath42 or @xmath41 in the curves of @xmath63 where @xmath42 runs over all arcs of @xmath31 with origin @xmath66 .",
    "a combinatorial immersion induces for each vertex @xmath66 of @xmath31 a circular order @xmath67 over @xmath65 ; if @xmath68 is the clockwise - ordered list of arcs of @xmath31 with origin @xmath66 , then @xmath67 is the cyclic concatenation of the orders @xmath69 .",
    "an immersion of @xmath63 restricts to an immersion of each of its curves .",
    "conversely , given an immersion of each curve in @xmath63 we can built an immersion ( in general many ) of their union by merging for each arc @xmath42 the left - to - right orders @xmath64 of each curve immersion .",
    "[ [ combinatorial - crossings . ] ] combinatorial crossings .",
    "+ + + + + + + + + + + + + + + + + + + + + + + +    given an immersion @xmath70 of two combinatorial closed curves @xmath18 and @xmath71 we define a of @xmath72 as a pair of indices @xmath73 such that @xmath74 .",
    "likewise , a double point of @xmath18 is a pair @xmath75 with @xmath76 and @xmath74 the double point @xmath77 is a in @xmath70 if the pairs of arc occurrences @xmath78_c,[\\ibar,\\ibar+1]_c)$ ] and @xmath79_d,[\\jbar,\\jbar+1]_d)$ ] are linked in the @xmath80-order , i.e. if they appear in the cyclic order @xmath81_c\\cdots [ \\jbar,\\jbar-1]_d\\cdots [ \\ibar,\\ibar+1]_c\\cdots [ \\jbar,\\jbar+1]_d\\cdots,\\ ] ] with respect to @xmath80 or the opposite order .",
    "an analogous definition holds for a self - crossing of a single curve , taking @xmath82 in the above definition .",
    "note that the notion of ( self-)crossing is independent of the traversal directions of @xmath18 and @xmath71 .",
    "the number of crossings of @xmath18 and @xmath71 and of self - crossings of @xmath18 in @xmath70 is denoted respectively by @xmath83 and @xmath84 .",
    "we define the of @xmath18 , denoted by @xmath19 , as the minimum of @xmath85 over all the combinatorial immersions @xmath86 of any combinatorial curve @xmath87 freely homotopic to @xmath18 .",
    "the of two combinatorial curves @xmath18 and @xmath71 is defined the same way taking into account crossings between @xmath18 and @xmath71 only .",
    "[ lem : geometric - vs - combinatorial ] the combinatorial ( self-)crossing number coincides with the geometric ( self-)intersection number , i.e. for every combinatorial closed curves @xmath18 and @xmath71 : @xmath88    every combinatorial immersion @xmath86 of @xmath18 can be realized by a continuous curve @xmath89 with the same number of self - intersections as the number of self - crossings of @xmath86 . to construct @xmath22",
    "we consider small disjoint disks centered at the images of the vertices of @xmath31 in @xmath4 .",
    "we connect those vertex disks by disjoint strips corresponding to the edges of @xmath31 . for every arc @xmath42 of @xmath31 we draw inside the corresponding edge strip parallel curve pieces labelled by the occurrences of @xmath42 or @xmath41 in @xmath18 in the left - to - right order @xmath64 .",
    "the endpoints of those curve pieces appear on the boundary of the vertex disks in the circular vertex orders induced by @xmath70 .",
    "it remains to connect those endpoints by straight line segments inside each disk ( via a parametrization over a euclidean disk ) according to the labels of their incident curve pieces .",
    "the resulting curve @xmath22 can be homotoped to @xmath90 and its self - intersections may only appear inside the vertex disks .",
    "clearly , an intersection of two segments of @xmath22 in a disk corresponds to linked pairs of arc occurrences , i.e. to a combinatorial crossing , and vice - versa .",
    "it follows that @xmath91 . to prove the reverse inequality we show that for any continuous curve @xmath22 in generic position there exists a combinatorial immersion of a curve @xmath87 such that @xmath92 and the number of self - crossings @xmath87 is at most the number of self - intersections of @xmath22 . by an isotopy we can enforce the self - intersections of @xmath22 to lie inside the vertex disks . after removing the vertex disks from @xmath4 ,",
    "we are left with a set of disjoint and simple pieces of @xmath22 that can be isotoped inside the edge strips and vertex disks without introducing any new intersections . if a piece of curve in a strip has its endpoints on the same end of the strip we can further isotope the piece inside the incident vertex disk .",
    "this way all the curve pieces join the two ends of their strip and can be ordered from left - to - right inside each strip ( assuming a preferred direction of the strip ) . replacing each curve piece by an arc occurrence we thus define a combinatorial immersion of a curve @xmath87 with the required properties .",
    "the same constructions apply to an immersion of two curves showing that @xmath93 .",
    "[ [ reduction - to - a - system - of - quads . ] ] reduction to a system of quads .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    let @xmath43 be a combinatorial surface with negative euler characteristic .",
    "we describe the construction of a system of quads for a surface without boundary .",
    "a similar construction applies when @xmath43 has perforated faces . following lazarus and rivaud  @xcite",
    "we start putting @xmath43 into a standard form called a by erickson and whittlesey  @xcite . after reducing @xmath43 to a surface @xmath94 with a single vertex @xmath66 and a single face @xmath95 this system of quads",
    "is obtained by adding a vertex @xmath96 at the center of @xmath95 , adding edges between @xmath96 and all occurrences of @xmath66 in the facial walk of @xmath95 , and finally deleting the edges of @xmath94 .",
    "the graph of the resulting system of quads , called the  @xcite , is bipartite .",
    "it contains two vertices , namely @xmath66 and @xmath96 , and @xmath97 edges , where @xmath98 is the genus of @xmath43 .",
    "all its faces are quadrilaterals .",
    "note that the system of quads can be deduced from @xmath43 by a sequence of edge contractions , deletions and insertions .",
    "every cycle @xmath18 of @xmath43 can thus be modified accordingly to give a cycle @xmath99 in the system of quads .",
    "clearly , there exist cellular embeddings @xmath100 of the graphs of @xmath43 and of the system of quads in a same topological surface such that @xmath101 .",
    "[ lem : systems - of - quads ] let @xmath1 be the number of edges of the combinatorial surface @xmath43 .",
    "the above construction of a system of quads can be performed in @xmath102 time so that for every closed curve @xmath18 of length @xmath0 in @xmath43 , we can compute in @xmath103 time a curve @xmath87 of length at most @xmath104 in the system of quads such that @xmath105 .    for the rest of the paper we shall assume that .",
    "[ [ diagrams . ] ] diagrams .",
    "+ + + + + + + + +    a over the combinatorial surface @xmath43 is a combinatorial sphere @xmath106 with one perforated face together with a labelling of the arcs of @xmath106 by the arcs of @xmath43 such that    1 .",
    "opposite arcs receive opposite labels , 2 .",
    "the facial walk of each non - perforated face of @xmath106 is labelled by the facial walk of some non - perforated face of @xmath43 .",
    "the diagram is when no edge of @xmath106 is incident to two non - perforated faces labelled by the same facial walk ( with opposite orientations ) of @xmath43 .",
    "an is defined similarly by a combinatorial sphere with two distinct perforated faces .",
    "a vertex of a diagram that is not incident to any perforated face is said .",
    "[ lem : diagram ] a cycle of @xmath43 is contractible if and only if it is the label of the facial walk of the perforated face of a reduced disk diagram over @xmath43 .",
    "two cycles are freely homotopic if and only if the facial walks of the two perforated faces of a reduced annular diagram over @xmath43 are labelled by these two cycles respectively .",
    "note that two non - perforated faces that are adjacent and consistently oriented in a reduced diagram are labelled by adjacent faces that are consistently oriented in @xmath43 .",
    "moreover , the degree of an interior vertex of the diagram is a multiple of the degree of the corresponding vertex in @xmath43 . in the sequel , .    [ [ spurs - brackets - and - canonical - curves . ] ] spurs , brackets and canonical curves .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    thanks to lemma  [ lem : systems - of - quads ] we may assume that our combinatorial surface @xmath43 is a system of quads . moreover , the construction of this system of quads with the assumption on the euler characteristic implies that . following the terminology of erickson and whittlesey  @xcite",
    ", we define the of a pair of arcs @xmath107 sharing their origin vertex @xmath66 as the number of face corners between @xmath108 and @xmath109 in clockwise order around @xmath66 . hence",
    ", if @xmath66 is a vertex of degree @xmath71 in @xmath43 , the turn of @xmath107 is an integer modulo @xmath71 that is zero when @xmath110 .",
    "the of a subpath @xmath111 of a closed curve of length @xmath0 is the sequence of @xmath112 turns of @xmath113 for @xmath114 , where indices are taken modulo @xmath0 .",
    "the subpath may have length @xmath0 , thus leading to a sequence of @xmath115 turns .",
    "note that the turn of @xmath113 is zero precisely when @xmath116 is a spur .",
    "a is any subpath whose turn sequence has the form @xmath117 or @xmath118 where @xmath119 stands for a possibly empty sequence of turns @xmath120 and @xmath121 stands for @xmath122 .",
    "it follows from lemma  [ lem : diagram ] and a simple combinatorial gauss - bonnet theorem  @xcite that    [ th : four - vertex ] a nontrivial contractible closed curve on a system of quads must have either a spur or four brackets .",
    "moreover , if the curve is the label of the boundary of a disk diagram with at least one interior vertex , then the curve must have either a spur or five brackets .",
    "lazarus and rivaud  @xcite have introduced a canonical form for every free homotopy class of closed curves in a system of quads . in particular , two curves",
    "are freely homotopic if and only if their canonical forms are equal ( up to a circular shift of their vertex indices ) .",
    "it was further characterized by erickson and whittlesey  @xcite in terms of turns and brackets .",
    "[ th : canonical ] the canonical form of a combinatorial closed curve of length @xmath0 on a system of quads can be computed in @xmath103 time .",
    "it is the unique homotopic curve that contains no spurs or brackets and whose turning sequence contains no @xmath123 s and contains at least one turn that is not @xmath124 .",
    "the canonical form is an instance of a , i.e. a curve that contains no spurs or brackets .",
    "the canonical form is the rightmost homotopic geodesic .",
    "the definitions of a geodesic and of a canonical form extend trivially to paths .",
    "in particular , the canonical form of a path is its unique rightmost homotopic geodesic and is characterized as for closed curves .",
    "[ th : canonical - path ] the canonical form of a combinatorial path is the unique homotopic path that contains no spurs or brackets and whose turning sequence contains no @xmath123 s .",
    "although we can not claim in general the uniqueness of geodesics in a homotopy class , homotopic geodesics are almost equal and have the same length . specifically , define a as a planar sequence of quads obtained by stitching an alternating sequence of rows and columns of quads to form a staircase .",
    "assuming that the staircase goes up from left to right , we define the of a quad staircase as the lower left vertex of the first quad in the sequence .",
    "the is defined as the upper right vertex of the last quad .",
    "a is obtained by identifying the two vertical arcs incident to the initial and final tips of a staircase .",
    "[ th : geodesic ] let @xmath125 be two non - trivial homotopic combinatorial geodesics .",
    "if @xmath125 are closed curves , then they label the two boundary cycles of an annular diagram composed of a unique closed staircase or of an alternating sequence of paths ( possibly reduced to a vertex ) and quad staircases connected through their tips . likewise , if @xmath125 are paths , then the closed curve @xmath126 labels the boundary of a disk diagram composed of an alternating sequence of paths ( possibly reduced to a vertex ) and quad staircases connected through their tips .",
    "we only detail the proof when @xmath125 are paths .",
    "see figure  [ fig : lentille - plate ] .",
    "the similar case of closed curves is covered in  @xcite . by lemma  [ lem :",
    "diagram ] , @xmath126 is the label of the facial walk of the perforated face of a disk diagram @xmath106 .",
    "this diagram has a cactus - like structure composed of 2-cells subdivided into quads and connected by trees .",
    "a vertex @xmath66 such that @xmath127 is not connected is called a _",
    "cut vertex_. we also consider as cut vertices the endpoints of @xmath18 in @xmath106 .",
    "a 2-cell of @xmath106 must have more than one cut vertex on its boundary .",
    "otherwise , this boundary is entirely labelled by a subpath of either @xmath18 or @xmath71 and theorem  [ th : four - vertex ] implies the existence of four brackets , one of which ( in fact two ) must avoid the cut vertex , hence be contained in the interior of this subpath .",
    "this would contradict that @xmath18 and @xmath71 are geodesic .",
    "moreover , because @xmath18 and @xmath71 have no spur , @xmath106 can not have more than two degree one vertices .",
    "it follows that @xmath106 is an alternating sequence of paths and 2-cells .",
    "in particular , each 2-cell has exactly two cut vertices .",
    "no 2-cell in this sequence has an interior vertex . for otherwise , by the second part of theorem  [ th : four - vertex ]",
    ", the boundary of this 2-cell would contain five brackets one of which would be contained in the interior of either @xmath18 or @xmath71 and this would again contradict that @xmath18 and @xmath71 are geodesic .",
    "it follows that the dual of a 2-cell , viewed as an assembling of quads , is a tree .",
    "we finally remark that this tree must be a path with a staircase shape .",
    "indeed , any other shape would imply the existence of a bracket in either @xmath18 or @xmath71 .",
    "[ cor : equal - length ] with the hypothesis of theorem  [ th : geodesic ] , @xmath18 and @xmath71 have equal length which is minimal among homotopic curves .    [ cor : no - monogon ] a combinatorial geodesic has no non - trivial index path whose image path is contractible .",
    "the next two remarks follow directly from the characterization of geodesics and canonical forms in terms of spurs , brackets and turns .",
    "[ rem : sub - geodesic ] the image path of any index path of a combinatorial geodesic is geodesic .",
    "if the combinatorial geodesic is in canonical form , so is the image path .",
    "[ rem : geodesic - power ] likewise , any power @xmath128 of a combinatorial closed geodesic @xmath18 is also a combinatorial geodesic .",
    "moreover , if @xmath18 is in canonical form , so is @xmath128 .",
    "let @xmath129 and @xmath130 be canonical paths such that @xmath131 . in other words",
    ", @xmath132 is the leftmost geodesic homotopic to @xmath129 . by theorem",
    "[ th : geodesic ] , there is a disk diagram @xmath106 composed of quad staircases and paths and whose left and right boundaries @xmath133 and @xmath134 are labelled by @xmath132 and @xmath129 respectively .",
    "the next technical lemma will be used in proposition  [ prop : counting - crossings ] to analyze the intersection of canonical curves .",
    "a is a non - boundary edge of @xmath106 .",
    "[ lem : double - path - struct ] let @xmath135 be two vertices , one on each side of @xmath106 . then @xmath106 contains a path @xmath136 from @xmath66 to @xmath96 labelled by a canonical path .",
    "moreover , @xmath136 can be uniquely decomposed as either @xmath137 , @xmath138 , @xmath139 or @xmath140 , where    1 .",
    "[ it : lambda ] @xmath141 is a subpath ( possibly reduced to a vertex ) of @xmath133 or @xmath142 , 2 .",
    "@xmath143 is a subpath ( possibly reduced to a vertex ) of @xmath134 or @xmath144 , 3 .",
    "@xmath145 is a spoke , 4 .",
    "[ it : neg - l ] if @xmath141 is a subpath of @xmath142 of positive length then @xmath146 , 5 .",
    "[ it : pos - r ] if @xmath143 is a subpath of @xmath134 of positive length then @xmath147 .",
    "[ it : both - neg ] if @xmath143 is a subpath of @xmath144 and @xmath141 is a subpath of @xmath133 then either @xmath143 is reduced to a vertex and @xmath147 or @xmath141 is reduced to a vertex and @xmath146 .",
    "we assume that @xmath66 is on the left side and @xmath96 on the right side of @xmath106 , the other case being symmetric .",
    "let @xmath148 be such that @xmath149 and @xmath150 .",
    "we first consider the case where @xmath151 .",
    "if @xmath133 and @xmath134 coincide at @xmath66 , then we trivially obtain the desired decomposition as @xmath152 . otherwise , @xmath66 may be incident to @xmath153 or @xmath154 spokes .    *",
    "if @xmath66 is not incident to a spoke then @xmath155 is either the initial tip of a staircase or is incident to a spoke @xmath145 .",
    "we set @xmath156 in the first case and @xmath157 otherwise .",
    "the path @xmath158 has no spurs or @xmath123 turns but may start with a bracket .",
    "if not , by the characterization of theorem  [ th : canonical - path ] , @xmath158 is already canonical and we can set @xmath159 . otherwise , we short cut the bracket in @xmath158 to obtain a canonical path @xmath136 satisfying the above points  [ it : lambda ] to  [ it : pos - r ] .",
    "see figure  [ fig : structure - geodesic ] .",
    "* if @xmath66 is incident to exactly one spoke @xmath145 , then @xmath145 connects @xmath66 to either @xmath160 or @xmath161 . in the former case we set @xmath162 . as above",
    ", @xmath158 may be canonical or starts with a bracket and we easily obtain the path @xmath136 with the desired properties .",
    "see figure  [ fig : structure - geodesic - i ]",
    ". + if @xmath145 is incident to @xmath161 and @xmath163 the path @xmath164 has the required properties .",
    "when @xmath145 is incident to @xmath161 and @xmath165 , then either @xmath155 is incident to a spoke @xmath166 and we must have @xmath167 , or @xmath155 must be the initial tip of a staircase and we must have @xmath168 . *",
    "if @xmath66 is incident to two spokes , then one of them , @xmath169 , connects @xmath66 to @xmath160 and the other @xmath170 connects @xmath66 to @xmath161 .",
    "we can directly set @xmath171 if @xmath165 and @xmath172 if @xmath163 .    for point",
    "[ it : both - neg ] in the lemma , we note that we can not have @xmath173 or @xmath174 with both @xmath141 and @xmath143 being subpaths of positive length of @xmath133 and @xmath144 respectively .",
    "indeed , @xmath136 would have a spur or a @xmath175 turn in the first case and a bracket in the other case .",
    "moreover , if @xmath143 is reduced to a vertex and @xmath141 is a subpath of @xmath133 , we may assume that the intersection @xmath176 is reduced to @xmath143 .",
    "otherwise , the canonical path between any other intersection point and @xmath143 would have to follow @xmath134 and we could express @xmath136 so that @xmath143 is a subpath of positive length of @xmath134 .",
    "an analogous argument holds to show that we can assume @xmath177 if @xmath141 is reduced to a vertex .",
    "we next consider the case @xmath178 .",
    "when @xmath133 and @xmath134 coincide at @xmath96 , we obtain the desired decomposition as @xmath179 . otherwise , @xmath96 may be incident to @xmath153 or @xmath154 spokes .",
    "similar arguments as in the case @xmath151 allow to conclude the proof .",
    "following poincar s original approach we represent the surface @xmath4 as the hyperbolic quotient surface @xmath180 where @xmath25 is a discrete group of hyperbolic motions of the poincar disk @xmath181 .",
    "we denote by @xmath182 the universal covering map .",
    "any closed curve @xmath183 gives rise to its infinite power @xmath184 that wraps around @xmath13 infinitely many times .",
    "a of @xmath13 is any curve @xmath185 such that @xmath186 where the parameter of @xmath187 is defined up to an integer translation ( we thus identify the curves @xmath188 , @xmath189 ) . note that @xmath190 is the union of all the images @xmath191 of @xmath187 by the motions in @xmath25 .",
    "the curve @xmath187 has two limit points on the boundary of @xmath181 which can be joined by a unique hyperbolic line @xmath26 .",
    "the projection @xmath192 wraps infinitely many times around the unique geodesic homotopic to @xmath13 .",
    "in particular , the limit points of @xmath187 are independent of the chosen representative in the homotopy class of @xmath13 .",
    "no two motions of @xmath25 have a limit point in common unless they are powers of the same motion .",
    "this can be used to show that when @xmath13 is primitive , its lifts are uniquely identified by their limit points  @xcite .",
    "let @xmath13 and @xmath193 be two primitive curves .",
    "we fix a lift @xmath187 of @xmath13 and denote by @xmath194 the hyperbolic motion sending @xmath195 to @xmath196 .",
    "let @xmath197 be the set of lifts of @xmath193 .",
    "we consider the subset of lifts @xmath198    [ lem : strategy ] @xmath199 where @xmath200 is the set of equivalence classes of lifts generated by the relations @xmath201",
    ".    put @xmath202 .",
    "define a map @xmath203 as follows .",
    "given @xmath204 there is , by the unique lifting property of coverings , a unique lift @xmath205 of @xmath193 that satisfies @xmath206 .",
    "we set @xmath207 to the class of this lift .",
    "note that changing @xmath208 to @xmath209 , @xmath189 , leads to the lift @xmath210 , so that @xmath211 is well - defined .",
    "the map @xmath211 is onto . indeed ,",
    "if @xmath212 then @xmath205 and @xmath187 must intersect at some point @xmath206 .",
    "it follows that @xmath207 is the class of @xmath205 . as an immediate consequence , @xmath213 when @xmath13 and @xmath193 are geodesics all their lifts are hyperbolic lines and",
    "@xmath211 is a bijection .",
    "we conclude that @xmath214 is minimized among all homotopic curves so that @xmath215 .    when @xmath13 and @xmath193 are hyperbolic geodesics , their lifts being hyperbolic lines have alternating limit points exactly when they have a non - empty intersection and they have a unique intersection point in that case .",
    "this point projects to a crossing of @xmath13 and @xmath193 that actually identifies the corresponding element of @xmath200 .",
    "when @xmath13 and @xmath193 are not geodesic the situation is more ambiguous and their lifts may have multiple intersection points . those intersection points project to crossings of @xmath13 and @xmath193 , so that the elements of @xmath200 are now identified with subsets of crossing points ( with odd cardinality ) rather than single crossing points",
    ". the induced partition is generated by the following relation : two crossings are equivalent if they are connected by a pair of homotopic subpaths of @xmath13 and @xmath193 , namely one of the two subpaths of @xmath13 and one of the two subpaths of @xmath193 cut by the two crossings .",
    "indeed , if the two crossings are projections of intersections of two lifts , then the paths between those intersections in each lift project to homotopic paths .",
    "conversely , homotopic paths lift to paths with common endpoints that can be seen as subpaths of two intersecting lifts . in order to compute the above partition , we thus essentially need an efficient procedure for testing if two paths are homotopic .",
    "this homotopy test can indeed be performed in linear time according to theorem  [ th : canonical ] .",
    "since a combinatorial curve of length @xmath0 may have @xmath216 crossings , we directly obtain an algorithm with time complexity @xmath217 to compute the above partition .",
    "when dealing with combinatorial ( canonical ) geodesics , the situation is more constrained and somehow intermediate between the ideal hyperbolic case and the most general situation .",
    "thanks to theorem  [ th : geodesic ] , we know that homotopic paths must stay parallel and at distance at most one .",
    "see figure  [ fig : strategy ] .",
    "this allows us to identify equivalent crossings more efficiently .",
    "these ideas are formalized in the next sections .",
    "let @xmath125 be two combinatorial closed curves on a combinatorial surface .",
    "a of @xmath72 of length @xmath0 is a pair of forward index paths @xmath218 with the same image path @xmath219 . if @xmath220 then the double path is just a double point .",
    "a double path of @xmath18 is defined similarly , taking @xmath82 and assuming @xmath221 .",
    "the next lemma follows from remark  [ rem : sub - geodesic ] .",
    "[ lem : double - path ] let @xmath222 and @xmath223 be forward index paths of two canonical curves @xmath18 and @xmath71 such that the image paths @xmath224 and @xmath225 are homotopic .",
    "then @xmath226 and @xmath218 is a double path .",
    "a double path @xmath227 gives rise to a sequence of @xmath115 double points @xmath228 for @xmath229 $ ] .",
    "a priori a double point could occur several times in this sequence .",
    "the next two lemmas claim that this is not possible when the curves are primitive . recall that a curve is if its homotopy class can not be expressed as a proper power of another class .",
    "[ lem : short - double - path - c ] a double path of a primitive combinatorial curve @xmath18 can not contain a double point more than once in its sequence .",
    "in particular , a double path of @xmath18 must be strictly shorter than @xmath18 .",
    "suppose that a double path @xmath230 of @xmath18 contains two occurrences of a double point @xmath231 . because the couples @xmath231 and @xmath232 represent the same double point there are two cases to consider .",
    "* if @xmath230 contains the couple @xmath231 twice then it must contain a subsequence of length @xmath44 starting with @xmath231 .",
    "we thus have @xmath233 .",
    "this implies that @xmath18 is equal to some non - trivial circular permutation of itself .",
    "it is a simple exercise to check that @xmath18 must then be a proper power of some other curve , contradicting that @xmath18 is primitive . * otherwise @xmath230 contains @xmath231 and @xmath232 .",
    "let @xmath0 be the distance between these two occurrences in @xmath230 .",
    "we thus have @xmath234 from which we deduce that @xmath18 is a square ( and @xmath235 ) , contradicting that @xmath18 is primitive .",
    "[ lem : short - double - path - c - d ] let @xmath18 and @xmath71 be two non - homotopic primitive combinatorial curves .",
    "a double path of @xmath72 can not contain a double point more than once in its sequence .",
    "moreover , the length of a double path of @xmath72 must be less than @xmath236 .",
    "suppose that a double path of @xmath72 contains two occurrences of a double point .",
    "after shortening the double path if necessary , we may assume that these two occurrences are the first and the last double points of the double path .",
    "its length must accordingly be a nonzero integer multiple @xmath136 of @xmath44 as well as a nonzero integer multiple @xmath158 of @xmath237 .",
    "it follows that for some circular permutations @xmath87 of @xmath18 and @xmath238 of @xmath71 we have @xmath239 . by a classical result of combinatorics on words  (",
    "1.3.1 ) this implies that @xmath87 and @xmath238 are powers of a same curve , in contradiction with the hypotheses in the lemma .",
    "in fact , by a refinement due to fine and wilf  ( * ? ? ? * prop .",
    "1.3.5 ) it suffices that @xmath240 and @xmath241 have a common prefix of length @xmath236 to conclude that @xmath87 and @xmath238 are powers of a same curve .",
    "this proves the second part of the lemma .",
    "a double path whose index paths can not be extended is said . as an immediate consequence of lemmas  [",
    "lem : short - double - path - c ] and  [ lem : short - double - path - c - d ] we have :    [ cor : partition - double - paths ] the maximal double paths of a primitive curve or of two primitive curves in canonical form induce a partition of the double points of the curves .",
    "let @xmath231 and @xmath242 be the first and the last double points of a maximal double path of @xmath72 , possibly with @xmath82 .",
    "when @xmath243 the arcs @xmath244 $ ] , @xmath245 $ ] , @xmath246 $ ] must be pairwise distinct because canonical curves have no spurs , and similarly for the three arcs @xmath247 $ ] , @xmath248 $ ] , @xmath249 $ ] .",
    "we declare the maximal double path to be a if the circular ordering of the first three arcs at @xmath45 and the circular ordering of the last three arcs at @xmath250 are either both clockwise or both counterclockwise with respect to the rotation system of the system of quads .",
    "when @xmath220 , that is when the maximal double path is reduced to the double point .",
    "which notion of crossings is used should always be clear from the context . ]",
    "@xmath251 , we require that the arcs @xmath252,d[j , j-1 ] , c[i , i+1 ] , d[j , j+1]$ ] are _ pairwise distinct _ and appear in this circular order , or its opposite , around the vertex @xmath253 .",
    "let @xmath125 be primitive combinatorial curves such that @xmath71 is canonical and let @xmath129 and @xmath254 be the canonical curves homotopic to @xmath18 and @xmath54 respectively .",
    "we denote by @xmath106 the annular diagram corresponding to @xmath129 and @xmath132 . when the two boundaries @xmath134 and @xmath133 of @xmath106 have a common vertex we implicitly assume that @xmath129 and @xmath132 are indexed so that this vertex corresponds to the same index along @xmath134 and @xmath133 .",
    "we consider the following set of double paths :    * @xmath255 is the set of crossing double paths of positive length of @xmath129 and @xmath71 , * @xmath256 is the set of crossing double paths @xmath251 of zero length of @xmath129 and @xmath71 such that either * * the two boundaries of @xmath106 coincide at @xmath257 and @xmath258 = c_l[i-1,i]$ ] or @xmath259 = c_l[i , i+1]$ ] , or * * one of @xmath260 $ ] or @xmath259 $ ] is the label of a spoke @xmath261 of @xmath106 and @xmath262 = c_l[i'-1,i']$ ] in the first case or @xmath263 = c_l[i',i'+1]$ ] in the other case .",
    "* @xmath264 is the set of crossing double paths @xmath265 ( @xmath266 ) of @xmath254 and @xmath71 such that _ none _ of the following situations occurs : * * the two boundaries of @xmath106 coincide at @xmath267 and @xmath258 = c_r[i'-1,i']$ ] , * * the two boundaries of @xmath106 coincide at @xmath268 and @xmath269 , * * @xmath258 $ ] is the label of a spoke @xmath270 of @xmath106 and @xmath262 = c_r[i'-1,i']$ ] , * * @xmath271 $ ] is the label of a spoke @xmath272 of @xmath106 and @xmath273 = c_r[i',i'+1]$ ] .",
    "those definitions allow the case @xmath274 , recalling that the index paths of a double path of @xmath18 must be distinct by definition . referring to section  [ sec : strategy ]",
    ", we view the underlying surface of the system of quads @xmath43 as a quotient @xmath180 of the poincar disk .",
    "the system of quads lifts to a quadrangulation of @xmath181 and the lifts of a combinatorial curve in @xmath43 are combinatorial bi - infinite paths in this quadrangulation . by remark  [ rem : geodesic - power ] , if the combinatorial curve is geodesic ( resp .",
    "canonical ) so are its lifts . in this case , each lift is simple by corollary  [ cor : no - monogon ] .",
    "we fix a lift @xmath275 of @xmath129 and consider the set @xmath200 of lemma  [ lem : strategy ] corresponding to the classes of lifts of @xmath71 whose limit points alternate with the limit points of @xmath275 along @xmath276 .    [",
    "prop : counting - crossings ] @xmath200 is in 1 - 1 correspondence with the disjoint union @xmath277 .",
    "let @xmath278 be the lift of @xmath132 with the same limit points as @xmath275 .",
    "these two lifts project onto the boundaries of the annular diagram @xmath106 and thus form an infinite strip @xmath279 of width at most 1 in @xmath181 composed of paths and quad staircases ( possibly a single infinite staircase ) .",
    "we shall define a correspondence between @xmath200 and @xmath277 . to this end",
    "we consider a lift @xmath280 of @xmath71 whose limit points alternate with those of @xmath275 .",
    "in other words , @xmath281 . the lift @xmath280 must cross @xmath279 .",
    "let @xmath282 and @xmath283 be respectively the smallest and largest index @xmath284 such that @xmath285 is in @xmath279 . by remark  [ rem : sub - geodesic ] , the corresponding subpath @xmath286 $ ] of @xmath280 is canonical .",
    "since @xmath181 is simply connected , @xmath286 $ ] is homotopic to any path joining the same extremities and we can apply lemma  [ lem : double - path - struct ] to show that @xmath286 $ ] is actually contained in @xmath279 and that it can be decomposed as either @xmath137 , @xmath138 , @xmath139 or @xmath140 where @xmath145 is a spoke of @xmath279 , @xmath287 and @xmath288 for some @xmath289 .    * if @xmath290 then by point  [ it : pos - r ] of lemma  [ lem : double - path - struct ] we have @xmath291 so that this intersection defines a maximal double path of @xmath280 and @xmath275 .",
    "it must be crossing since @xmath281 .",
    "its projection on @xmath43 is a crossing double path of length @xmath290 of @xmath71 and @xmath129 , hence in @xmath255 , to which we map @xmath280 . *",
    "if @xmath292 and @xmath293 , then point  [ it : both - neg ] of lemma  [ lem : double - path - struct ] implies @xmath291 . as above , @xmath143 must define a crossing double path of length zero of @xmath280 and @xmath275 .",
    "we map @xmath280 to the projection of this crossing double point on @xmath43 and remark that this projection is in @xmath256 .",
    "* otherwise , we must have @xmath294 and @xmath295 by point  [ it : both - neg ] of lemma  [ lem : double - path - struct ] .",
    "if @xmath296 then point  [ it : neg - l ] of lemma  [ lem : double - path - struct ] implies @xmath297 .",
    "this intersection defines a crossing double path of @xmath280 and @xmath298 and we map @xmath280 to its projection on @xmath43 .",
    "if @xmath220 and @xmath299 then point  [ it : both - neg ] of lemma  [ lem : double - path - struct ] implies @xmath300 , which also holds true if @xmath301 . in both cases",
    "@xmath141 corresponds to a crossing double path of length zero of @xmath280 and @xmath302 and we map @xmath280 to its projection on @xmath43 .",
    "we finally remark that this last projection or the above one belong to @xmath264 .",
    "because @xmath279 is left globally invariant by @xmath303 ( the hyperbolic motion that sends @xmath304 to @xmath305 ) , we have @xmath306 .",
    "it follows that @xmath280 and @xmath307 are mapped to the same crossing double path by the above rules .",
    "we thus have a well defined map @xmath308 .",
    "the uniqueness of the decomposition in lemma  [ lem : double - path - struct ] implies that this map is 1 - 1 . in order to check that the map is onto",
    "we consider a maximal crossing double path @xmath309 of @xmath129 and @xmath71 in @xmath255 . by the unique lift property of coverings",
    "there is a unique lift @xmath280 of @xmath71 such that @xmath310 and @xmath230 lifts to a crossing double path of @xmath280 and @xmath275 . by lemma  [ lem : double - path ]",
    "this double path is the only intersection of @xmath280 and @xmath275 so these lifts must have alternating limit points .",
    "in other words @xmath280 is in @xmath311 and is mapped to @xmath230 .",
    "a similar argument applies to the crossing double paths of @xmath256 and @xmath264 .",
    "this leads to a simple algorithm for computing combinatorial crossing numbers .",
    "[ cor : crude - result ] let @xmath125 be primitive curves of length at most @xmath0 on a combinatorial surface with complexity @xmath1 .",
    "the crossing numbers @xmath312 and @xmath19 can be computed in @xmath313 time .    by lemma  [ lem : systems - of - quads ]",
    "we may assume that the surface is a system of quads . by theorem",
    "[ th : canonical ] we may compute the canonical forms of @xmath314 and @xmath71 in @xmath103 time . according to proposition  [",
    "prop : counting - crossings ] , we have @xmath315 the set @xmath255 can be constructed in @xmath216 time . indeed , since the maximal double paths of @xmath18 and @xmath71 form disjoint sets of double points by corollary  [ cor : partition - double - paths ] , we just need to traverse the grid @xmath316 and group the double points into maximal double paths .",
    "those correspond to diagonal segments in the grid that can be computed in time proportional to the size of the grid .",
    "we can also determine which double paths are crossing in the same amount of time .",
    "likewise , we can construct the sets @xmath256 and @xmath264 in @xmath216 time .",
    "we can also compute @xmath19 in quadratic time using that @xmath317 .",
    "in order to finish the proof of theorem  [ th : main - result ] , we need to tackle the case of non - primitive curves .",
    "thanks to canonical forms , computing the primitive root of a curve becomes extremely simple .",
    "[ lem : non - primitive ] let @xmath18 be a combinatorial curve of length @xmath293 in canonical form .",
    "a primitive curve @xmath71 such that @xmath18 is homotopic to @xmath318 for some integer @xmath284 can be computed in @xmath103 time .    by theorem",
    "[ th : canonical ] , we may assume that @xmath18 and @xmath71 are in canonical form . by remark  [ rem : geodesic - power",
    "] , the curve @xmath318 is also in canonical form .",
    "the uniqueness of the canonical form implies that @xmath319 , possibly after some circular shift of @xmath71 .",
    "it follows that @xmath71 is the smallest prefix of @xmath18 such that @xmath18 is a power of this prefix .",
    "it can be found in @xmath103 time using a variation of the knuth - morris - pratt algorithm to find the smallest period of a word  @xcite .    the geometric intersection number of non - primitive curves is related to the geometric intersection number of their primitive roots .",
    "the next result is rather intuitive , see figure  [ fig : non - primitive ] , and is part of the folklore although we could only find references in some relatively recent papers .",
    "[ prop : non - primitive - formulas ] let @xmath18 and @xmath71 be primitive curves and let @xmath320 be integers . then , @xmath321    let @xmath125 and @xmath43 be the two combinatorial curves and the combinatorial surface as in the theorem .",
    "we first assume that the @xmath43 has negative euler characteristic .",
    "we can compute the canonical forms of @xmath18 and @xmath71 in @xmath103 time after @xmath102 time preprocessing by lemma  [ lem : systems - of - quads ] .",
    "thanks to lemma  [ lem : non - primitive ] we can further determine primitive curves @xmath87 and",
    "@xmath238 and integers @xmath320 such that @xmath322 and @xmath323 in @xmath103 time .",
    "we can compute @xmath324 and @xmath325 in @xmath216 time according to corollary  [ cor : crude - result ] .",
    "we finally use the formulas in the previous proposition to deduce @xmath312 and @xmath19 from @xmath324 and @xmath325 .",
    "if @xmath43 is a sphere or a disk , then every curve is contractible and @xmath326 .",
    "if @xmath43 is a cylinder , then every two curves can be made non crossing so that @xmath327 while @xmath328 . finally ,",
    "if @xmath43 is a torus , the radial graph of the system of quads can be decomposed into two loops @xmath329 such that @xmath330 and @xmath331 .",
    "we may then use the classical formulas : @xmath332 and @xmath333 .",
    "in the subsequent sections we only deal with the self - intersection number of a single curve . we thus drop the subscript @xmath18 to denote an index path @xmath334 or an arc occurrence @xmath335 .",
    "we also implicitly consider intersections as self - intersections . by theorem",
    "[ th : main - result ] we can compute the geometric intersection number of a curve efficiently . here , we describe a way to compute a minimal immersion , that is an actual immersion with the minimal number of intersections .",
    "we refer to the combinatorial framework of section  [ sec : framework ] to describe such an immersion combinatorially .",
    "thanks to lemma  [ lem : geometric - vs - combinatorial ] , we know that this framework faithfully encodes the topological configurations .    [ [ bigons - and - monogons . ] ] bigons and monogons .",
    "+ + + + + + + + + + + + + + + + + + + +    a of an immersion @xmath70 of @xmath18 is a pair of index paths @xmath336 whose @xmath224 and @xmath337 have strictly positive lengths , are homotopic , and whose @xmath251 and @xmath338 are combinatorial crossings for @xmath70 .",
    "a of @xmath70 is an index path @xmath334 of strictly positive length such that @xmath339 is a combinatorial crossing and the image path @xmath224 is contractible .",
    "[ prop : bigon ] a combinatorial immersion of a primitive curve has excess self - crossing if and only if it contains a bigon or a monogon .    we just need to prove the existence of a bigon or monogon for a continuous realization @xmath34 of the combinatorial immersion .",
    "this bigon or monogon corresponds to a combinatorial bigon or monogon as claimed in the proposition . to prove the topological counterpart , we first note as in section  [ sec : strategy ] that the minimal number of intersections is counted by the lifts of @xmath22 whose limit points alternate along @xmath27 .",
    "it follows that @xmath22 is minimally crossing when its lifts are pairwise disjoint unless the corresponding limit points alternate in @xmath27 and they should intersect exactly once in that case .",
    "when @xmath22 is not minimally crossing there must exist two lifts intersecting more than necessary , thus forming a bigon in @xmath181 .",
    "the projection of such a bigon on @xmath4 gives the desired result .",
    "note that a statement similar to the one in the proposition holds for an immersion of a pair of primitive curves @xmath18 and @xmath71 with excess crossing . in appendix  [ app : bigon ] , we provide a purely combinatorial proof of the direct implication of the proposition in the case of two curves .",
    "suppose that @xmath86 is a combinatorial immersion of a primitive geodesic @xmath18 .",
    "it can not have a monogon by corollary  [ cor : no - monogon ] .",
    "hence , according to proposition  [ prop : bigon ] the immersion @xmath86 is minimal unless it contains a bigon .",
    "the two sides of such a bigon may share some common part that would prevent us from swapping these two sides . in agreement with the terminology of hass and scott  @xcite ,",
    "a bigon @xmath336 is said if    1 .",
    "its two index paths have disjoint interiors , i.e. they do not share any arc occurrence ; 2 .",
    "when @xmath340 the following arc occurrences @xmath341,\\focc{\\imath},[\\jmath+k,\\jmath+k+1],[j , j+1],[\\jmath+k,\\jmath+k-1]\\ ] ] do not appear in this order or its opposite in the circular ordering induced by @xmath86 at @xmath342 ; 3 .",
    "when @xmath343 the following arc occurrences @xmath344 do not appear in this order or its opposite in the circular ordering induced by @xmath86 at @xmath345 .",
    "note that when @xmath18 is geodesic and @xmath346 there can not be any identification between @xmath347 and @xmath348 .",
    "for instance , @xmath349 implies @xmath350 so that @xmath351 , while @xmath340 implies @xmath352 so that @xmath353 . in both cases",
    "@xmath18 would have a monogon which would contradict lemma  [ cor : no - monogon ] .",
    "when @xmath18 is primitive and geodesic , we can not have @xmath354 and @xmath355 at the same time",
    ". otherwise , we must have @xmath226 by the preceding paragraph , and @xmath18 would be a circular shift of @xmath356 and thus homotopic to a square . also remark that when one of the last two conditions in the definition is not satisfied , the bigon maps to a non - singular bigon in the continuous realization of @xmath70 as in lemma  [ lem : geometric - vs - combinatorial ] .",
    "see figure  [ fig : singular - def ] .",
    "when the bigon is singular we can swap its two sides by exchanging the two arc occurrences @xmath357 $ ] and @xmath358 $ ] , for @xmath359 and @xmath360 .",
    "[ lem : swap ] swapping the two sides of a singular bigon of an immersion of a geodesic primitive curve decreases its number of crossings by at least two .",
    "this is relatively obvious if one considers a continuous realization of the immersion , performs the swapping and comes back to a combinatorial immersion as in the proof of lemma  [ lem : geometric - vs - combinatorial ] .",
    "we nonetheless provide a purely combinatorial proof in appendix  [ app : swap ] .",
    "hence , by swapping singular bigons we may decrease the number of crossings until there is no more singular bigons .",
    "it follows from the next lemma that the resulting immersion has no excess crossing .",
    "[ th : singular - bigon ] an immersion of a primitive geodesic curve has excess crossing if and only if it contains a singular bigon .",
    "we realize @xmath70 by a continuous curve @xmath22 with the same construction as in lemma  [ lem : geometric - vs - combinatorial ] . by theorem 4.2 in  @xcite the curve @xmath22 has a singular bigon . in turn",
    "this bigon corresponds to a singular bigon in @xmath70 .    in the next section",
    "we describe how to detect bigons in practice .",
    "if an immersion @xmath86 of a primitive geodesic @xmath18 has a bigon then its two sides have equal length according to corollary  [ cor : equal - length ] and form a sequence of paths and staircases following the description of theorem  [ th : geodesic ] . in particular , the vertices of the two sides can be put in 1 - 1 correspondence and corresponding vertices are at distance at most one . hence ,",
    "when looking for bigons in @xmath86 , we can start from any crossing @xmath251 and walk in parallel along the two sides from @xmath282 and @xmath283 , checking that the two sides stay at distance one .",
    "however , we do not know a priori if the two sides will cross again to form a bigon and the search may be unsuccessful .",
    "in order to analyze the complexity of the bigon search we thus consider pair of paths that could potentially be part of a bigon , but that are not necessarily so . formally , a pair @xmath361 of distinct index paths such that @xmath224 and @xmath362 are corresponding subpaths of homotopic geodesic paths is called a of length @xmath0 . in other words ,",
    "a thick double path is such that its image paths can be extended to form homotopic geodesic paths . as for a double path ,",
    "a thick double path gives rise to a sequence of @xmath115 index pairs @xmath363 for @xmath229 $ ] .",
    "let @xmath106 be a disk diagram whose boundary is labelled by homotopic geodesic paths extending the thick double path as illustrated on figure  [ fig : thick ] .    the restriction of @xmath106 to the part delimited by the thick double path is called a . in a partial diagram",
    "each index pair @xmath363 may be in at most one of five : either the corresponding vertices coincide in the partial diagram , or they appear diagonally opposite in a quad ; in turn this quad may be labelled by one of the ( at most ) four quads incident to either @xmath364 $ ] or @xmath365 $ ] .",
    "a partial diagram is if it can not be extended to form a partial diagram of a longer thick double path .",
    "[ lem : configurations ] if @xmath18 is a primitive geodesic curve each configuration of an index pair may occur at most once in a partial diagram .",
    "suppose for a contradiction that the index pair @xmath251 occurs twice in the same configuration in a partial diagram of a thick double path of @xmath18 .",
    "exchanging the roles of @xmath282 and @xmath283 if necessary , we may assume that the indices @xmath148 are represented by integers such that @xmath366 .",
    "the two occurrences of @xmath251 are separated by a path whose length is an integer multiple of @xmath44 , say @xmath367 .",
    "we first assume that the two index paths of the thick double path are both forward . in the partial diagram , @xmath345 and @xmath342 label vertices that are either identical or opposite in a quad .",
    "they are thus connected by a path @xmath136 of length zero or two .",
    "we infer that @xmath368{\\ensuremath{^{-1}}}\\cdot c\\ipath{\\imath}{k|c|}\\cdot c[i , j]\\ ] ] this can be written as @xmath369 where @xmath370 is a cyclic permutation of @xmath18 and @xmath371{\\ensuremath{^{-1}}}$ ] is a ( closed ) path of length at most @xmath372 .",
    "since the homotopy classes of the loops @xmath373 and @xmath158 are commuting they must admit a common primitive root  @xcite .",
    "we thus have _ ( i ) _ @xmath374 and _ ( ii ) _",
    "@xmath375 for some primitive curve @xmath208 and some @xmath376 .",
    "( i ) _ implies that @xmath87 and @xmath377 are also commuting so that @xmath87 is homotopic to a power of the primitive curve @xmath208 . but",
    "@xmath87 being also primitive we actually have @xmath378 . by remark  [ rem : geodesic - power ] , @xmath379 is geodesic , hence has minimal length in its homotopy class . from _",
    "( ii ) _ we obtain @xmath380 .",
    "this is only possible if @xmath381 or if @xmath382 and @xmath383 ( indices in a pair have the same parity ) .    *",
    "if @xmath381 , then @xmath384 , so that @xmath385 $ ] . since @xmath18 is geodesic , we must have @xmath386 , hence @xmath387 and the corresponding vertices must be diagonally opposite in a quad .",
    "two homotopic paths each of length two bound a disk diagram composed of either a length two path or a single quad .",
    "in other words , @xmath388 $ ] and @xmath136 are either equal or bound the first quad in the partial diagram . in either case we infer that @xmath389= c[i , j].c[j , j+1]$ ] contains a spur or a bracket , leading to a contradiction . * if @xmath382 and @xmath383 , then @xmath390 ( recall that @xmath391 ) . a simple case study of the possible partial diagrams for such a @xmath18 lead to a contradiction in each case .",
    "see the appendix  [ sec : end - proof - lem - config ] for a proof .",
    "we now assume that the thick double path is composed of a forward and a backward index paths . similarly to the previous case , we infer that @xmath392 , where @xmath370 and @xmath371{\\ensuremath{^{-1}}}$ ] .",
    "equivalently , @xmath18 and its inverse are freely homotopic .",
    "this is however impossible unless @xmath18 is contractible .",
    "[ cor : index - pairs ] each configuration of an index pair may occur at most once in the set of maximal partial diagrams .    by the preceding lemma",
    ", we only need to check that a configuration of an index pair can not occur twice in distinct partial diagrams of maximal thick double paths .",
    "this is essentially the unique lift property of coverings .    by theorem",
    "[ th : canonical ] we can assume that @xmath18 is geodesic .",
    "we first consider the case where @xmath18 is primitive .",
    "let @xmath70 be a randomly chosen immersion of @xmath18 . we store the induced vertex orderings of the arc occurrences in arrays so that we can test if a double point is a crossing in constant time using pointer arithmetic . by theorem",
    "[ th : singular - bigon ] , if @xmath70 has excess crossing it has a singular bigon .",
    "this singular bigon defines a thick double path that must appear in some maximal partial diagram of @xmath70 as two boundary paths with common extremities .",
    "hence , in order to find a singular bigon we just need to scan the index pairs in every maximal partial diagram and test whether the two sides between consecutive index pairs define a singular bigon . by the very definition of a singular bigon",
    ", each test can be easily performed in constant time .",
    "the number of tests is itself bounded by the number of index pairs in all the maximal partial diagrams .",
    "this is @xmath216 by corollary  [ cor : index - pairs ] .",
    "once a singular bigon is found we swap its sides in @xmath103 time .",
    "this preserves the geodesic character and , by lemma  [ lem : swap ] , the number of crossings is reduced by at least two . since @xmath70 may have @xmath216 excess crossings , we need to repeat the above procedure @xmath216 times and we may conclude the theorem in the case of primitive curves . when @xmath393 , with @xmath71 primitive , we first find a minimally crossing immersion for @xmath71 by the above procedure .",
    "we further traverse the immersion @xmath136 times duplicating @xmath71 as many times .",
    "as we start each traversal we connect the last arc occurrence of the previously traversed copy with the first occurrence of the next copy .",
    "we continue this copy by duplicating each traversed arc occurrence to its right .",
    "it is easily seen that the number of crossings of the final immersion of @xmath18 , after connecting the last traversed arc with the first one , satisfies the formula in proposition  [ prop : non - primitive - formulas ] .",
    "we end this section with some refinements of lemma  [ lem : configurations ] and its corollary .",
    "we first highlight a simple property of the system of quads .    [ lem : facial - walk ] the facial walk of a quad can not contain an arc twice , either with the same or the opposite orientations .",
    "if the facial walk of a quad contains two occurrences of an arc with the same orientation , then their identification creates a mbius strip in the system of quads , in contradiction with its orientability .",
    "if the facial walk contains two consecutive occurrences of an arc with opposite orientations , then their common endpoint must have degree one in the system of quads .",
    "this contradicts the minimal degree 8 in our system of quads .",
    "finally , if the facial walk contains non consecutive occurrences of an arc with opposite orientations , then their identification creates a cylinder bounded by loop edges .",
    "however , the radial graph being bipartite , this can not occur .",
    "[ lem : no - common - index ] let @xmath18 be a primitive geodesic curve . if a forward index path @xmath394 and a backward index path @xmath395 have homotopic image paths @xmath396 , then they can not share any index .",
    "remark that we can not have @xmath397 for otherwise @xmath398 in contradiction with corollary  [ cor : no - monogon ] .",
    "likewise , we can not have @xmath399 . by way of contradiction , suppose that the index paths @xmath394 and @xmath395 have a common index @xmath400 for some integers @xmath401 . by the previous remark we have @xmath402 .",
    "it follows that @xmath403 is an interior index pair of @xmath404 , where @xmath405 ( recall that @xmath282 and @xmath283 have the same parity ) .",
    "consider a disk diagram for @xmath396 .",
    "the index pair @xmath403 can not correspond to the same vertex in the diagram since the path @xmath388=c[i , m].c[m , j]$ ] would then label a closed path in the diagram , hence be contractible .",
    "this would again contradict corollary  [ cor : no - monogon ] .",
    "it ensues that @xmath403 corresponds to opposite vertices in a quad of the diagram .",
    "this quad is part of a staircase where the arc @xmath406 $ ] labels two arcs on either sides of the partial diagram .",
    "figure  [ fig : m - m - opposite-1 ] depicts the four possible configurations .    in each case",
    "we infer that the system of quads would contain a mbius strip , in contradiction with its orientability .",
    "[ lem : ell - plus - un ] two distinct index paths of a non - trivial primitive geodesic curve @xmath18 having homotopic image paths have length distinct from @xmath44 and at most @xmath407 .",
    "when the index paths have opposite orientations , the previous lemma directly implies the result .",
    "let @xmath408 and let @xmath409 be two index paths such that @xmath410 . clearly , @xmath411 since otherwise @xmath18 would be homotopic to a conjugate of itself by the shorter curve @xmath388 $ ] , in contradiction with the primitivity of @xmath18 . for",
    "the sake of a contradiction , suppose that @xmath412 .",
    "consider a diagram @xmath106 with sides @xmath134 and @xmath133 for the homotopic paths @xmath410 . by lemma  [ lem : configurations ] the vertices @xmath413 and @xmath414 must be diagonally opposite in a quad of @xmath106 . using that @xmath415 and @xmath416",
    "are labelled by the same edges and similarly for @xmath417 and @xmath418 we easily deduce that the system of quads has a quad with two occurrences of a same arc in its facial walk , or has a vertex of degree at most @xmath419 , or is non - orientable .",
    "this would contradict lemma  [ lem : facial - walk ] or the hypotheses on the system of quads . in details ,",
    "figure  [ fig : lengthbigon ] depicts the five possible configurations ( a , b , c , d ) for @xmath415 and @xmath417 in the diagram @xmath106 and the eight possible configurations ( a1 - 2 , b1 - 3 , c1 - 3 ) for @xmath416 and @xmath418 .",
    "remark that cases c1 - 3 are symmetric to cases b1 - 3 , so that we only need to consider the five configurations a1 - 2 , b1 - 3 .",
    "we denote by @xmath420 the conjunction of configurations @xmath421 and @xmath422 in @xmath106 . the quads in configurations a , b , c , d are part of an initial staircase in @xmath106 that may have a positive or negative orientation according to whether or not its orientation is consistent with some default orientation of the quad system and similarly for the final staircase containing @xmath413 and @xmath414 .    *",
    "if the orientations of the two staircases have the same sign , then the face to the right of @xmath423 $ ] has the same facial walk as the face to the right of @xmath424 .",
    "the induced identifications imply that for @xmath425 a quad is bounded twice by the same arc ( with or without the same orientation ) in contradiction with lemma  [ lem : facial - walk ] .",
    "if @xmath426 , we easily deduce that @xmath427 has degree four in the system of quads , again a contradiction .",
    "* when the initial and final staircases have opposite orientations the faces to the right of @xmath423 $ ] and to the right of @xmath424 ( resp . to the left of @xmath428 $ ] and to the left @xmath429 $ ] ) correspond to the two faces incident to @xmath430 $ ] ( resp .",
    "we further split case @xmath431 into two variants a@xmath432 and a@xmath433 according to whether the two quads ( see figure  [ fig : lengthbigon ] ) have consistent orientations or not . by the induced identifications we derive the following forbidden situations : two occurrences of a same arc in a quad for @xmath434 , a degree two vertex ( namely @xmath435 ) for @xmath436 , a degree three vertex for @xmath437 , a degree four vertex for @xmath438 , a degree five vertex for @xmath439 , and finally a mbius band for @xmath440 .",
    "when the initial and final staircases in the above proof have consistent orientations it is sufficient to use that @xmath441 and @xmath442 are labelled by the same edge , and similarly for @xmath443 and @xmath444 , in order to reach a contradiction for cases @xmath445 and @xmath431 . in other words ,",
    "the two homotopic paths @xmath410 can not have length @xmath115 .",
    "this leads to the following refinement .",
    "[ lem : short - bigon ] a bigon @xmath446 of an immersion of a primitive geodesic curve @xmath18 without intermediate crossings ( i.e. , no index pair @xmath447 , @xmath448 , is a combinatorial crossing ) has length @xmath449 .",
    "[ lem : flat - bigons ] if two forward index paths of a canonical curve have homotopic image paths then they actually have the same image paths , i.e. they form a double path . in particular , bigons composed of two forward paths must be flat .    by theorem",
    "[ th : geodesic ] the image paths bound a disk diagram composed of paths and staircase .",
    "remark that a staircase with both sides directed forward must have a @xmath175 turn on its left side .",
    "since the curve is canonical we infer that the diagram can not have any staircase , implying that the two sides coincide .",
    "we now turn to the original problem of poincar  @xcite , deciding whether a given curve @xmath18 is homotopic to a simple curve . in the affirmative we know by lemma  [ lem : swap ] and theorem  [ th : singular - bigon ] that some geodesic homotopic to @xmath18 must have a ( combinatorial ) , i.e. an immersion without crossings . rather than swapping the sides of a singular bigon as in lemma  [",
    "lem : swap ] we can choose to switch one side along the other side .",
    "this will also decrease the number of crossings if the bigon contains no other interior bigons . by considering interior - most bigons only",
    ", we can thus enforce a given edge of @xmath18 to stay fix as we remove crossings .",
    "this suggests an incremental computation of an embedding in which the image of the first arc occurrence is left unchanged : we assume that @xmath18 is canonical and consider the trivial embedding of its first arc occurrence @xmath450 $ ] .",
    "we next insert the successive arc occurrences incrementally to obtain an embedding of the path formed by the already inserted arcs .",
    "when inserting the occurrence @xmath451 $ ] we need to compare its left - to - right order with each already inserted arc occurrence @xmath193 of its supporting arc .",
    "if @xmath452 $ ] we can use the comparison of the occurrence @xmath453 $ ] with the occurrence @xmath22 preceding @xmath193 ( or succeeding @xmath193 if it is a backward occurrence ) .",
    "if @xmath453 $ ] and @xmath22 have the same supporting arc , we just propagate their relative order to @xmath451 $ ] and @xmath193 .",
    "otherwise , we use the circular ordering of the supporting arcs of @xmath453 $ ] , @xmath22 and @xmath451 $ ] in order to conclude .",
    "when @xmath454 $ ] , we can not use the occurrence preceding @xmath450 $ ] as it is not yet inserted .",
    "we rather compare @xmath451 $ ] and @xmath450 $ ] as follows . in the poincar disk , we consider two lifts @xmath455 and @xmath456 of @xmath18 such that @xmath457=\\tilde{d}_0[0,1]$ ] . we decide to insert @xmath451 $ ] to the left ( right ) of @xmath450 $ ] if one of the limit points of @xmath455 lies to the left ( right ) of @xmath456 .",
    "note that when @xmath18 is homotopic to a simple curve the two limit points of @xmath455 should lie on the same side of @xmath456 .    after comparing @xmath451 $ ] with all the occurrences of its supporting arc , we can insert it in the correct place .",
    "if no crossings were introduced this way , we proceed with the next occurrence @xmath458 $ ] .",
    "it may happen , however , that no matter how we insert @xmath451 $ ] in the left - to - right order of its supporting arc , the resulting immersion of @xmath459 will have a combinatorial crossing . in order to handle this case",
    ", we first check if @xmath451 $ ] is , i.e. if for some @xmath460 and some turns @xmath461 the subpath @xmath462 has turn sequence @xmath463 and the index path @xmath464 does not contain the arc occurrence @xmath450 $ ] . when @xmath451 $ ] is switchable we can switch @xmath136 to a new subpath @xmath465 with turn sequence @xmath466 such that @xmath136 and @xmath465 bound a diagram composed of a single horizontal staircase",
    ". see figure  [ fig : switch - path ] .",
    "we indeed perform the switch if some intersection is actually avoided this way .",
    "more formally , this happens when there is a crossing @xmath251 such that the turn of @xmath467 , c[i , i+1])$ ] or of @xmath468 , c[i , i+1])$ ] is one as illustrated on figure  [ fig : switch - path-1 ] .",
    "note that replacing @xmath136 by @xmath465 leads to a curve @xmath87 that is still geodesic and homotopic to @xmath18 . moreover , _",
    "the part of @xmath87 that remains to be embedded is in canonical form _ as it contains no @xmath175 turns .",
    "we then insert the arc occurrence @xmath451 $ ] and proceed with the algorithm using @xmath87 in place of @xmath18 .",
    "the successive switches in the course of the computation untangle @xmath18 incrementally and we call our embedding procedure the . for further reference",
    "we make some observations that easily follows from the above switch procedure and the fact that @xmath18 is initially canonical .",
    "[ rem : switchable ] if @xmath451 $ ] is switchable but not switched at the time of being processed it remains true until the end of the algorithm , meaning that the vertex of index @xmath282 is directly followed by a subpath @xmath136 with a turn sequence of the form @xmath469 ( @xmath284 may get smaller if some other arc of @xmath136 is switched ) . similarly ,",
    "if @xmath451 $ ] is not switchable because of an inappropriate turn sequence , it remains true until the end of the algorithm .",
    "[ rem:01-right - side ] let @xmath87 be a curve homotopic to @xmath18 obtained after a certain number of switches during the execution of the algorithm .",
    "then @xmath87 can not contain a subpath with turn sequence @xmath470 that ends at index @xmath471 , nor can it contain a subpath with turn sequence @xmath472 that starts at index @xmath471 .    [ lem : zipper - complexity ] the algorithm applied to a canonical primitive curve @xmath18 of length @xmath0 can be implemented to run in @xmath473 time .",
    "we first traverse @xmath18 in reverse direction to mark all the switchable arcs .",
    "in the course of the algorithm , each time a switchable arc triggers the switch of a subpath @xmath136 we unmark all the arcs in @xmath136 except the last one that may become switchable ( depending on the last turn of @xmath136 and on the status of the arc following @xmath136 ) .",
    "it easily follows that an arc can be switched at most twice and that the amortized cost for the switches is linear .",
    "alternatively , we could use the run - length encoded turn sequence of @xmath18 ( as defined in  @xcite ) to detect each switchable arc and update the turn sequence in constant time per switches . in a preprocessing phase",
    "we also compute the relative order of @xmath450 $ ] with all the other occurrences of the same arc in @xmath18 as follows .",
    "if @xmath364=c[0,1]$ ] , the corresponding arc occurrences form a double path of length one and we compute their relative order by extending maximally this double path in the backward direction .",
    "looking at the tip of this double path , say @xmath474 , we can decide which side is to the left of the other . indeed",
    ", the three arcs @xmath475 , @xmath476 and @xmath477 must be pairwise distinct and their circular order about their common origin vertex in the system of quads provides the necessary information as follows from lemma  [ lem : flat - bigons ] .    the computation of the maximal extensions in the backward direction amounts to evaluate the longest common prefix of @xmath54 with all its circular shifts .",
    "overall , this can be done in @xmath103 time thanks to a simple variation of the knuth - morris - pratt algorithm .",
    "we next initialize an empty ( balanced ) binary search tree for every edge of the system of quads . assuming a default orientation of each edge",
    ", its search tree should eventually contain the set of occurrences of the corresponding arc using the left - to - right order induced by the embedding .",
    "we now traverse @xmath18 in the forward direction starting with @xmath450 $ ] and insert each traversed arc occurrence @xmath478 $ ] in its tree .",
    "if the search tree is empty , we just insert @xmath13 at the root .",
    "otherwise , either @xmath13 is switchable and needs to be switched to a new arc @xmath42 , or it should be inserted into a non - empty search tree . the former case can be easily detected in @xmath479 time using a dichotomy over the occurrences of @xmath42 : _ @xmath13 needs to be switched when one of these occurrences defines a crossing with @xmath13 at their common endpoint_. in the latter case , we perform the usual tree insertion : each time @xmath13 must be compared with some already inserted arc occurrence @xmath452 $ ] we can use the comparison of the occurrence preceding @xmath13 with the occurrence preceding @xmath193 ( or succeeding @xmath193 if it is a backward occurrence ) .",
    "this takes @xmath479 time .",
    "when @xmath480 $ ] we can use our precomputed comparisons unless @xmath13 was previously switched , thus not compared with @xmath450 $ ] during the preprocessing phase . since @xmath18 is canonical , arcs may only be switched to their left in one of four possible configurations as on figure  [ fig : under_a0 ]    and we infer that @xmath13 must lie to the right of @xmath450 $ ] as justified by lemma  [ lem : relative - pos ] below . in conclusion , each comparison costs @xmath479 time so that @xmath13 can be inserted in its search tree in @xmath481 time .",
    "note that after @xmath13 is inserted we do not try to determine if the current immersion has a crossing or not .",
    "this will be checked in a second step after the algorithm is completed .",
    "[ lem : relative - pos ] let @xmath482 and @xmath280 be two lifts of a primitive canonical geodesic in the poincar disk @xmath181 .",
    "the limit points of @xmath482 cut the boundary circle @xmath483 into two pieces . by the _",
    "right piece _",
    ", we mean the piece of @xmath483 that bounds the part of @xmath484 to the right of @xmath18 .",
    "suppose that @xmath482 contains an arc @xmath42 and that @xmath280 contains an arc @xmath485 such that @xmath42 and @xmath485 are in one of the four relative positions depicted on figure  [ fig : relative - pos ] .",
    "then one of the limit points of @xmath280 is in the right piece of @xmath483 .",
    "we first note that @xmath485 itself lies to the right of @xmath482 .",
    "indeed , @xmath482 would have to use a @xmath175 turn to see @xmath485 on its left or to pass along @xmath485 , in contradiction with its canonicity .",
    "if both limit points of @xmath280 were to the left of @xmath482 , then @xmath482 and @xmath280 would form a bigon with one staircase part containing @xmath485 .",
    "the @xmath482 side of this staircase would thus see @xmath485 on its right , which is impossible since @xmath482 is canonical ( here , we have not used that @xmath280 is canonical but only geodesic ) .",
    "[ prop : zipper ] if @xmath486 the algorithm returns an embedding of a geodesic homotopic to @xmath18 .",
    "let @xmath70 be the immersion computed by the algorithm .",
    "we denote by @xmath487 the geodesic homotopic to @xmath18 resulting from the first switches in the algorithm up to the insertion of the arc occurrence @xmath488 $ ] .",
    "note that @xmath489 implies @xmath490 .",
    "suppose that @xmath70 has a crossing .",
    "for the rest of this proof , we denote by @xmath282 the smallest index such that the insertion of @xmath451 $ ] creates a crossing , i.e. the restriction of @xmath70 to @xmath459 has a crossing double point while its restriction to @xmath491 is an embedding . by convention we set @xmath492 if the crossing appeared after the last arc insertion .",
    "we shall show that @xmath493 has two lifts whose limit points are alternating on the boundary of the poincar disk .",
    "it will follow from section  [ sec : strategy ] that @xmath494 thus proving the proposition .",
    "we first establish some preparatory claims .",
    "[ claim : branched - crossing ] if @xmath251 is a crossing of @xmath70 with @xmath495 , then the backward arc @xmath496 $ ] and the forward arc @xmath497 $ ] are distinct from the supporting arc @xmath498 $ ] of @xmath451 $ ] . moreover ,",
    "if @xmath451 $ ] was switched just before its insertion , then @xmath496 $ ] and @xmath497 $ ] are also distinct from the supporting arc @xmath499 $ ] of @xmath451 $ ] _ just before its switch_.    the first part of the claim follows directly from our insertion procedure and the fact that the restriction of @xmath70 to @xmath491 is an embedding .",
    "moreover , assume that @xmath451 $ ] was switched just before its insertion . by the insertion procedure",
    ", this means that the insertion of @xmath451 $ ] before the switch would have induced a crossing @xmath500 where @xmath501 and @xmath502 , c_{i-1}[k , k-1 ] \\neq c_{i-1}[i , i+1]$ ] by the first part of the claim . by the same first part we have @xmath496 , c_i[j , j+1]\\neq c_i[i , i+1]$ ] .",
    "since the restriction of @xmath70 to @xmath503 has no crossing , the length 2 path @xmath504 separates @xmath505 from @xmath499 $ ] , implying @xmath496 , c_i[j , j+1]\\neq c_{i-1}[i , i+1]$ ] as desired .",
    "[ claim : parallel - right ] if @xmath506 has a @xmath175 turn at index @xmath507 , with @xmath508 , then there is an index @xmath509 with @xmath510 such that    * @xmath511=c_{k}[r , r-1]$ ] , * the arc @xmath512 $ ] lies to the right of @xmath513 $ ] , * @xmath514\\neq c_{k-1}[k , k+1]$ ] .",
    "a @xmath175 turn can only occur at the destination of an arc that has been switched and such that the next arc was not switched ( otherwise , we would get a @xmath515 turn ) .",
    "if @xmath506 has a @xmath175 turn at @xmath507 then so has @xmath516 since the algorithm never backtracks .",
    "it follows that the arc @xmath511 $ ] must have been switched just before its insertion , thus witnessing the existence of an arc @xmath42 of the form @xmath517 $ ] or @xmath518 $ ] , with @xmath519 , that lies parallel to and to the right of @xmath511 $ ] ( with respect to @xmath70 ) .",
    "moreover , according to claim  [ claim : branched - crossing ] we can also assume @xmath517 $ ] and @xmath518 $ ] to be distinct from the supporting arc of @xmath488 $ ] just before it was switched , namely @xmath520 $ ] .",
    "in the case @xmath521 $ ] , we may set @xmath522 and conclude .",
    "otherwise , @xmath523 $ ] and , recalling that the restriction of @xmath70 to @xmath524 has no crossing , it must be that @xmath525 also lies parallel to and to the right of @xmath526 .",
    "so @xmath506 has a @xmath175 turn at index @xmath527 , and we are back to the hypothesis of the claim , decreasing the value of @xmath284 to @xmath208 .",
    "we can repeat the same arguments inductively , each time decreasing the value of @xmath284 in the claim .",
    "since @xmath528 , the process must stop , implying that we have reached the former case .",
    "recall that @xmath282 is the smallest index such that the restriction of @xmath70 to @xmath459 has a crossing .",
    "we denote by @xmath529 the geodesic homotopic to @xmath18 resulting from all the switches in the course of the algorithm execution .",
    "let @xmath251 be a crossing of @xmath70 with @xmath495 .",
    "we consider two lifts @xmath530 and @xmath531 of @xmath87 in the poincar disk such that @xmath532 .",
    "we first suppose @xmath533 .    [",
    "claim : no - crossing - after - i ] we can choose @xmath283 so that @xmath534 has no crossing with @xmath531 .",
    "( crossings are defined with respect to the lift of @xmath70 in the poincar disk . )",
    "fix any @xmath283 such that @xmath251 is a crossing of @xmath70 ( @xmath495 ) and suppose that @xmath534 and @xmath531 cross .",
    "let @xmath535 be the smallest positive integer such that @xmath455 and @xmath531 crosses at @xmath536 .",
    "we thus have a bigon of the form @xmath537 for some @xmath538 .",
    "moreover , this bigon has no intermediate crossings by the choice of @xmath535 .",
    "let @xmath106 be a disk diagram for this bigon , oriented consistently with the system of quads .",
    "@xmath106 must start with a staircase part by claim  [ claim : branched - crossing ] .",
    "in particular , the turn @xmath120 between @xmath539 $ ] and @xmath540 $ ] should be @xmath541 . the algorithm may have run across four possible situations at step @xmath282 .    1 .",
    "[ enum:1 ] either @xmath451 $ ] was switchable just before its insertion but was not switched , 2 .",
    "[ enum:2 ] or it was switchable and switched , 3 .",
    "[ enum:3 ] or it was not switchable because of an inappropriate turn sequence , 4 .",
    "[ enum:4 ] or it was not switchable because the part to be switched contains @xmath450 $ ] .",
    "in the first situation , we know by remark  [ rem : switchable ] that @xmath542 is followed by a turn sequence of the form @xmath543 . hence , @xmath120 is exactly @xmath544 ; but this contradicts the fact that @xmath451 $ ] was not switched though switchable .",
    "the third situation together with remark  [ rem : switchable ] also lead to a contradiction as the inappropriate turn sequence prevents @xmath545 from being part of any staircase .",
    "thanks to claim  [ claim : branched - crossing ] , the second situation equally prevents @xmath545 from being part of any staircase . it remains to consider the fourth situation .",
    "we first suppose @xmath546 , i.e. that the diagram @xmath106 corresponds to the bigon @xmath547 . by lemma  [ lem : short - bigon ]",
    ", we have @xmath548 and the fourth situation implies that the @xmath549 side of the bigon contains @xmath450 $ ] .",
    "these two properties imply that @xmath550 .",
    "it ensues that the @xmath551 side contains index @xmath282 , for otherwise @xmath552 would be a crossing occurring before step @xmath282 .",
    "however , the occurrence of @xmath282 on both sides of the bigon contradicts lemma  [ lem : no - common - index ] .",
    "hence , it must be that @xmath553 , i.e. that @xmath106 is bounded by two forward paths . since the @xmath549 side of @xmath106 contains @xmath450 $ ] and since @xmath554 , it ensues from remark  [ rem:01-right - side ] that @xmath70 has a @xmath175 turn at index @xmath112 .",
    "claim  [ claim : parallel - right ] ensures the existence of a smaller index @xmath509 such that @xmath555=c_{j}[r , r-1]$ ] and @xmath556\\neq c_{j-1}[j , j+1]$ ] .",
    "since @xmath555 $ ] makes a one turn with both @xmath557 $ ] and @xmath540 $ ] , these last arcs are equal and , since @xmath558 is not a crossing , @xmath559 must be a crossing of @xmath70 .",
    "we replace @xmath283 by @xmath509 to obtain another lift @xmath560 that crosses @xmath455 at the same point @xmath561 with the additional property that @xmath562 $ ] and @xmath457 $ ] make a one turn .",
    "we finally observe that @xmath560 satisfies the claimed property . indeed",
    ", the first staircase of @xmath106 must lie to the left of its @xmath549 side by remark  [ rem:01-right - side ] , hence the other side of @xmath106 must start with @xmath563 $ ] .",
    "this is however impossible by the preceding argument for @xmath546 .",
    "it follows that @xmath534 and @xmath560 have no crossing .",
    "we next consider the smallest positive integer @xmath509 such that @xmath455 and @xmath531 crosses at @xmath564 .",
    "if no such @xmath509 exists , then by the above claim  [ claim : no - crossing - after - i ] , @xmath531 and @xmath455 have a unique intersection point and we may conclude that their limit points alternate",
    ". we can thus assume the existence of a bigon @xmath565 with @xmath290 and @xmath56 , and without intermediate crossings .",
    "we first examine the case @xmath546 where the bigon @xmath566 has oppositely oriented index paths .",
    "we must have @xmath567 for otherwise the tip @xmath568 of the bigon would define a crossing occurring before step @xmath282 , contradicting the choice of @xmath282 .",
    "hence , @xmath569 contains @xmath283 .",
    "this is however impossible by lemma  [ lem : no - common - index ] .",
    "we now look at the case of two forwards index paths ( @xmath553 ) .",
    "we must have @xmath570 for otherwise the tip @xmath571 of the bigon would define a crossing occurring before step @xmath282 , again contradicting the choice of @xmath282 .",
    "it follows that @xmath572 contains @xmath450 $ ] and that the forward branches @xmath573 and @xmath574 have a unique intersection point .",
    "the bigon labels a disk diagram @xmath106 composed of paths and staircases as described in theorem  [ th : geodesic ] .    *",
    "if @xmath450 $ ] and @xmath575 $ ] label the same arc of a path part in @xmath106 there are two possibilities : either it holds initially that @xmath576=c(\\alpha)$ ] or @xmath13 was switched in the course of the algorithm . in the former case , we know by the preprocessing phase and lemma  [ lem : flat - bigons ] that the left - to - right order of @xmath450 $ ] and @xmath13 is coherent with its extension in the backward direction .",
    "this implies that ultimately in the backward direction @xmath455 lies on the same side of @xmath531 as does @xmath13 . in the latter case , as described in the end of the proof of lemma  [ lem : zipper - complexity ] , we know by the insertion procedure that at least one of the limit points of @xmath455 lies on the same side of @xmath531 as does @xmath13 . since @xmath251 is the only crossing in the forward direction , we conclude in both cases that @xmath531 and @xmath455 have alternating limit points .",
    "* otherwise , @xmath450 $ ] and @xmath13 label two distinct arcs , say @xmath577 and @xmath578 , of a staircase part @xmath579 of @xmath106 .",
    "let @xmath580 $ ] and @xmath581 $ ] , @xmath582 be the index paths corresponding to the sides @xmath583 and @xmath584 of @xmath579 . by remark  [ rem:01-right - side ] ,",
    "@xmath585 $ ] must label the right side @xmath584 while @xmath580 $ ] can not contain @xmath450 $ ] .",
    "it follows that @xmath586 , whence @xmath580\\subset [ 1,i]$ ] .",
    "if @xmath578 belongs to a horizontal part of @xmath583 , the first vertex in this part has a @xmath175 turn and we let @xmath587 be the index of this vertex .",
    "otherwise , @xmath578 belongs to a vertical part whose last vertex has a @xmath175 turn .",
    "it follows that the vertex of index @xmath588 had a @xmath175 turn at step @xmath589 of the algorithm and we set @xmath590 . by claim  [ claim : parallel - right ]",
    ", there is an arc occurrence @xmath591 $ ] , with @xmath592 , that lies to the right of @xmath578 and such that the turn at @xmath593 is not one .",
    "we view @xmath106 as a subset of the poincar disk so that @xmath133 and @xmath134 can be seen as portions of @xmath455 and @xmath531 respectively .",
    "let @xmath594 be the lift of @xmath87 that extends the above occurrence @xmath591 $ ] in @xmath181 .",
    "see figure  [ fig : push-1 ] .",
    "+ we denote by @xmath595 and @xmath596 the portion of @xmath594 respectively after and before its vertex with index @xmath421 .",
    "+ we claim that @xmath597 can not cross @xmath455 .",
    "otherwise , we would get a pair of homotopic paths , one piece of @xmath597 starting at index @xmath421 and one piece of @xmath455 ending at index @xmath587 , with opposite orientations . by lemma  [ lem : no - common - index ] ,",
    "the @xmath597 piece would not contain index @xmath587 and would thus have length at most @xmath598 . in turn , this would imply that the @xmath455 piece would only contain vertices with indices in @xmath599 $ ] .",
    "the crossing of @xmath597 and @xmath455 would thus occur before step @xmath282 , a contradiction . +",
    "we next claim that @xmath600 can not cross @xmath531 . to see this",
    ", first note that the index path corresponding to the part of @xmath600 inside @xmath106 must contain @xmath471 .",
    "indeed , @xmath600 must cross @xmath133 or the part of @xmath134 after @xmath577 and , in any case , the index along @xmath600 of the corresponding crossing should be at least @xmath282 , since no crossing occurs before step @xmath282 .",
    "+ it follows from the above claims that @xmath594 and @xmath455 have alternating limit points .",
    "see figure  [ fig : push-2 ] .    it remains to consider the case @xmath492 where the first crossing appears after the last arc insertion .",
    "since all the arcs have been inserted without introducing crossings it means that the crossings of the computed immersion @xmath70 must have the form @xmath601 .",
    "we first claim that each bigon of @xmath70 must have its two sides oriented the same way .",
    "otherwise , the tips of the bigon must have the form @xmath601 and @xmath602 for some index @xmath603 , implying that @xmath604 is contractible .",
    "this would contradict corollary  [ cor : no - monogon ] .",
    "let @xmath605 and @xmath531 be two intersecting lifts of @xmath87 in the poincar disk . if @xmath605 and @xmath531 intersect only once , then we are done as they must have alternating limit points .",
    "we now suppose that @xmath605 and @xmath531 intersect at least twice and we consider the bigon @xmath106 between their last two intersections in the forward direction . by lemma  [ lem : short - bigon ] , the length of @xmath106 is smaller than @xmath0",
    ". let @xmath601 and @xmath606 be the tips of @xmath106 , so that @xmath607 .",
    "* if @xmath450 $ ] and @xmath608 $ ] label the same arc @xmath609 = \\tilde{d}_j(\\alpha)$ ] then , by the insertion procedure , one of the limit points of @xmath605 is on the same side of @xmath531 as does @xmath13 . the same argument as in the general case @xmath533 allows to conclude that @xmath605 and @xmath531 have alternating limit points .",
    "* we finally suppose that @xmath450 $ ] and @xmath13 label distinct arcs , say @xmath577 and @xmath610 , of a staircase part @xmath579 of @xmath106 . as in the general case @xmath533",
    ", @xmath577 must see @xmath579 on its left , while @xmath610 must see @xmath579 on its right .",
    "hence , the @xmath531 side of @xmath579 is canonical while the side along @xmath605 is not and must have been switched . by claim  [ claim : parallel - right ] , there is an arc occurrence @xmath193 to the right of @xmath611 $ ] with the opposite orientation .",
    "let @xmath594 be the lift of @xmath87 that extends @xmath193 .",
    "as in the general case @xmath533 , we can show that the part of @xmath594 after @xmath193 can not cross @xmath605 , while the part before @xmath193 can not cross @xmath531 . using that @xmath601 is the last crossing along @xmath605 and @xmath531 ,",
    "we equally conclude that @xmath605 and @xmath594 have alternating limit points .",
    "see figure  [ fig : push-2 ] with @xmath492 .",
    "let @xmath18 be a combinatorial curve of length @xmath0 on a combinatorial surface of size @xmath1 .",
    "we compute its canonical form in @xmath612 time and check in linear time that @xmath18 is primitive . in the negative , we conclude that either @xmath18 is contractible , hence reduced to a vertex , or that @xmath18 has no embedding by proposition  [ prop : non - primitive - formulas ] . in the affirmative ,",
    "we apply the algorithm to compute an immersion @xmath70 of some geodesic @xmath87 homotopic to @xmath18 . according to proposition  [ prop : zipper ]",
    ", we have @xmath486 if and only if @xmath70 has no crossings .",
    "this is easily verified in @xmath612 time by checking for each vertex @xmath66 of the system of quads that the set of paired arc occurrences with @xmath66 as middle vertex form a well - parenthesized sequence with respect to the local ordering @xmath613 induced by @xmath70 .",
    "we conclude the proof thanks to lemma  [ lem : zipper - complexity ] .",
    "a related problem was tackled by chang _",
    "et al . _",
    "8.2 ) who try to find an embedding of a given closed path on a combinatorial surface . in their formulation , though , the path is not authorized to be modified . in our terminology , they only look for the existence of a combinatorial immersion without crossings . they suggest a linear time complexity for this problem and it seems likely that we could also eliminate the @xmath614 factor in our complexity .",
    "the existence of a singular bigon claimed in theorem  [ th : singular - bigon ] relies on theorem 4.2 of hass and scott  @xcite .",
    "as noted by the authors themselves this result is `` surprisingly difficult to prove '' . except for this result and the recourse to some hyperbolic geometry in the general strategy of section  [ sec : strategy ] our combinatorial framework allows to provide simple algorithms and to give simple proofs of results whose known demonstrations are rather involved . concerning proposition  [ prop : bigon ] ,",
    "the existence of an immersion without bigon could be achieved in our combinatorial viewpoint by showing that if an immersion has bigons , then one of them can be swapped to reduce the number of crossings .",
    "( the example in figure  [ fig : no - singular - bigon ] shows that such a bigon need not be singular . )",
    "what is more , if those swappable bigons could be found easily this would provide an algorithm to compute a minimally crossing immersion of two curves by iteratively swapping bigons as in section  [ sec : computing - immersions ] for the case of a single curve . however , we were unable to show the existence or even an appropriate definition of a swappable bigon .",
    "note that in the analogous approaches using reidemeister - like moves by de graff and schrijver  @xcite or by paterson  @xcite , the number of moves required to reach a minimal configuration is unknown .",
    "comparatively , the number of bigon swapping would be just half the excess crossing of a given immersion .    although the geometric intersection number of a combinatorial curve of length @xmath0 may be @xmath615 , it is not clear that the complexity in theorem  [ th : main - result ] is optimal .",
    "in particular , it would be interesting to see if the algorithm of section  [ sec : simple - curves ] yields minimally crossing curves even with curves that are not homotopic to simple curves , thus improving theorem  [ th : compute - immersion ] .",
    "this would lead to an algorithm that is faster to find an immersion with the minimal number of crossings than to actually count them !",
    "it is also tempting to check whether the algorithm applies to compute the geometric intersection number of two curves rather than a single curve . another intriguing question related to the computation of minimally crossing immersions comes from the fact that they are not unique . given a combinatorial immersion we can construct a continuous realization as described in the proof of lemma  [ lem : geometric - vs - combinatorial ] .",
    "say that two realizations are in the if there is an ambient isotopy of the surface where they live that brings one realization to the other .",
    "it was shown by neumann - coto  @xcite that every minimally crossing immersion is in the configuration of shortest geodesics for some riemaniann metric @xmath616 , but hass and scott  @xcite gave counterexamples to the fact that we could always choose @xmath616 to be hyperbolic .",
    "+ _ is there an algorithm to construct or detect combinatorial immersions that have a realization in the configuration of geodesics for some hyperbolic metric ? _",
    "+    cdvl05    joan  s. birman and caroline series .",
    "an algorithm for simple curves on surfaces .",
    ", 29(2):331342 , 1984 .",
    "ric colin  de verdire and francis lazarus . optimal system of loops on an orientable surface .",
    ", 33(3):507  534 , march 2005 .",
    "hsien - chih chang , jeff erickson , and chao xu . detecting weakly simple polygons . in _ proc .",
    "acm - siam symp",
    ". discrete algorithms _ , pages 16551670 , 2015 .",
    "moira chas .",
    "self - intersection numbers of length - equivalent curves on surfaces . , 23(3):271276 , 2014 .",
    "david  r.j .",
    "simple closed curves on surfaces .",
    ", 1(3):310314 , 1969 .",
    "david  r.j .",
    "an algorithm for families of disjoint simple closed curves on surfaces . , 3(1):2326 , 1971 .",
    "david  r.j .",
    "chillingworth . winding numbers on surfaces .",
    "ii . , 199(3):131153 , 1972 .    marshall cohen and martin lustig .",
    "paths of geodesics and geometric intersection numbers : i. in _ combinatorial group theory and topology _ , volume 111 of _ ann . of math .",
    "_ , pages 479500 .",
    "princeton univ . press , 1987 .",
    "moira chas and steven  p lalley .",
    "self - intersections in combinatorial topology : statistical structure .",
    ", 188(2):429463 , 2012 .",
    "tamal  k. dey and sumanta guha .",
    "transforming curves on surfaces .",
    ", 58(2):297325 , 1999 .",
    "maurits de  graaf and alexander schrijver .",
    "making curves minimally crossing by reidemeister moves .",
    ", 70(1):134156 , 1997 .",
    "pierre de  la  harpe .",
    "topologie , thorie des groupes et problmes de dcision : clbration dun article de max dehn de 1910 .",
    ", 125:4175 , 2010 .",
    "jeff erickson and kim whittelsey . transforming curves on surfaces redux . in _ proc .",
    "acm - siam symp .",
    "discrete algorithms _ , 2013 .",
    "benson farb and dan margalit . .",
    "princeton university press , 2012 .",
    "daciberg  l. gonalves , elena kudryavtseva , and heiner zieschang .",
    "an algorithm for minimal number of ( self-)intersection points of curves on surfaces . in _ proceedings of the seminar on vector and tensor analysis _ , volume  26 , pages 139167 , 2005 .",
    "steve  m. gersten and hamish  b. short .",
    "small cancellation theory and automatic groups .",
    ", 102:305334 , 1990 .",
    "joel hass and peter scott .",
    "intersections of curves on surfaces . , 51(1 - 2):90120 , 1985 .",
    "joel hass and peter scott . shortening curves on surfaces . , 33(1):2543 , 1994 .    joel hass and",
    "peter scott .",
    "configurations of curves and geodesics on surfaces . , 2:201213 , 1999 .",
    "donald  e. knuth , james  h. morris , jr , and vaughan  r. pratt .",
    "fast pattern matching in strings .",
    ", 6(2):323350 , 1977 .",
    "m.  lothaire . .",
    "cambridge university press , 1997 .",
    "francis lazarus and julien rivaud . on the homotopy test on surfaces . in _ proc .",
    "ieee symp .",
    "foundations of computer science _ , pages 440449 , 2012 .",
    "martin lustig .",
    "paths of geodesics and geometric intersection numbers : ii . in _",
    "combinatorial group theory and topology _ , volume 111 of _ ann . of math .",
    "_ , pages 501543 .",
    "princeton univ . press , 1987 .",
    "maryam mirzakhani .",
    "growth of the number of simple closed geodesies on hyperbolic surfaces . , pages 97125 , 2008 .",
    "maryam mirzakhani .",
    "counting mapping class group orbits on hyperbolic surfaces .",
    "preprint http://arxiv.org/pdf/1601.03342[arxiv:1601.03342 ] , january 2016 .",
    "bojan mohar and carsten thomassen . .",
    "studies in the mathematical sciences .",
    "johns hopkins university press , 2001 .",
    "max neumann - coto .",
    "a characterization of shortest geodesics on surfaces .",
    ", 1:349368 , 2001 .",
    "a combinatorial algorithm for immersed loops in surfaces .",
    ", 123(2):205234 , 2002 .",
    "henri poincar .",
    "cinquime complment  lanalysis situs .",
    ", 18(1):45 110 , 1904 .",
    "bruce  l. reinhart .",
    "algorithms for jordan curves on compact surfaces .",
    ", pages 209222 , 1962 .",
    "jenya sapir .",
    "bounds on the number of non - simple closed geodesics on a surface .",
    "preprint http://arxiv.org/pdf/1505.07171[arxiv:1505.07171 ] , may 2015 .",
    "vladimir  g. turaev .",
    "intersections of loops in two - dimensional manifolds . , 35(2):229 , 1979 .",
    "heiner zieschang .",
    "algorithmen fr einfache kurven auf flchen .",
    ", 17:1740 , 1965 .",
    "heiner zieschang .",
    "algorithmen fr einfache kurven auf flchen ii .",
    ", 25:4958 , 1969 .",
    "* appendix *",
    "if a combinatorial immersion of one or primitive curves has excess ( self-)crossing then it contains a bigon or a monogon .",
    "we first introduce some terminology .",
    "an on a combinatorial curve @xmath18 consists in adding or removing a spur , or replacing in @xmath18 a possibly empty part of a facial walk by its complementary part . for a free elementary homotopy",
    "we can also apply a circular shift to the indices of the closed curve @xmath18 . the equivalence relation generated by ( free ) homotopies",
    "is called combinatorial ( free ) homotopy .",
    "let @xmath617 be a cellular embedding of @xmath31 in a topological surface @xmath4 corresponding to the combinatorial surface we are working with .",
    "every combinatorial curve @xmath18 can be realized by a continuous curve on @xmath4 by replacing each arc in @xmath18 with a continuous arc deduced from the restriction of @xmath143 to the corresponding arc .",
    "we denote this continuous realization by @xmath90 .",
    "it is part of the folklore that ( free ) combinatorial homotopy coincides with continuous ( free ) homotopy , meaning that @xmath18 is ( freely ) homotopic to @xmath71 if an only if @xmath90 is ( freely ) homotopic to @xmath618 .",
    "an of a combinatorial immersion consists either in an elementary homotopy or in an , i.e. in exchanging the left - to - right order of two occurrences in a same arc where one occurrence is next to the right of the other .",
    "we further require before performing an elementary homotopy that the immersion is in .",
    "this means , if the elementary homotopy applies to a nonempty part @xmath208 of a facial walk of some face , that each arc occurrence in @xmath208 should be the rightmost element of its arc , i.e. the most interior to the face . when removing a spur",
    ", we just require that the two arc occurrences to be removed are adjacent in left - to - right order .",
    "see figure  [ fig : elementary - moves ] .    the elementary homotopy does not modify the order of the remaining arc occurrences .",
    "when inserting a spur we make the inserted arc occurrences adjacent and when inserting part of a facial walk we insert each arc occurrence after the rightmost element of its arc . remark that by a sequence of adjacent transpositions we can always enforce an immersion to be in good position .",
    "we consider the case of an immersion @xmath70 of two curves @xmath18 and @xmath71 .",
    "suppose that @xmath70 has @xmath136 excess crossings .",
    "we shall prove the stronger claim that @xmath70 has at least @xmath619 bigons whose tips are pairwise distinct .",
    "let @xmath620 be an immersion of two curves @xmath87 and @xmath238 respectively homotopic to @xmath18 and @xmath71 such that @xmath620 has no excess crossings .",
    "consider a sequence of elementary homotopies from @xmath621 to @xmath72 . following the above remark",
    ", we can insert adjacent transpositions between each elementary homotopy in order to obtain a sequence of elementary moves from @xmath620 to @xmath70 . see the above remark .",
    "the claim is trivially verified by @xmath620 .",
    "we now check that the claim remains true after each elementary move . if the move is an adjacent transposition we may assume that we exchange an arc occurrence of @xmath18 with an arc occurrence of @xmath71 since we only consider intersections between @xmath18 and @xmath71 . without loss of generality",
    "we also assume exchanging the forward occurrences @xmath622_c$ ] and @xmath623_d$ ] .",
    "there are three cases to consider .    1 .",
    "if none of @xmath77 and @xmath624 is a crossing then the transposition adds two crossings that we may pair as the tips of a new bigon .",
    "we now have @xmath625 excess crossings with at least @xmath626 bigons as required .",
    "[ it : one - of - two ] if @xmath77 is a crossing but @xmath624 is not and if @xmath77 is paired to form the tips of a bigon , say @xmath627 , we may just replace this bigon by @xmath628 sliding its tip @xmath77 to @xmath624 .",
    "a similar procedure applies when @xmath624 is a crossing but @xmath77 is not . in each case",
    "the number of excess crossings and bigons is left unchanged .",
    "[ it : two - of - two ] it remains the case where both @xmath77 and @xmath624 are crossings .",
    "if none of the two is paired to form the tips of a bigon , then the transposition removes two crossings and no pairing , so that the claim remains trivially true . if exactly one of the two is paired or if the two are paired together , we loose one bigon and two crossings after the transposition so that the claim remains true . otherwise , there are two bigons of the form @xmath627 and @xmath629 that we can recombine to form the bigon @xmath630",
    ". we again have one less bigon and two less crossings .",
    "we now consider the application of an elementary homotopy as described before the proof .",
    "there are again three possibilities .    1 .",
    "if the homotopy replaces a nonempty subpath @xmath208 of a facial walk @xmath631 by the nonempty complementary part @xmath66 then no crossing may appear or disappear as we assume the immersion in good position .",
    "in particular , no crossing may use an internal vertex of @xmath208 and @xmath208 is either entirely included in or excluded from any side of any bigon .",
    "we can replace @xmath208 by @xmath66 in any bigon side where @xmath208 occurs to obtain valid bigons in the new immersion after the elementary homotopy is applied .",
    "the number of excess crossings and bigons is left unchanged .",
    "2 .   when @xmath208 is empty in the above replacement , or when inserting a spur , we may only add crossings by pairs forming bigons with one zero - length side and the complement of @xmath208 or the spur as the other side .",
    "a similar analysis as in case   of a transposition applies to take care of each pair .",
    "3 .   when @xmath66 is empty in the above replacement , or when removing a spur , we may only remove crossings by pairs and a similar analysis as in case   of a transposition applies to take care of each pair .",
    "this ends the proof for the case of two curves .",
    "a similar proof holds for the existence of a bigon or a monogon in an immersion with excess self - intersection .",
    "this time the excess crossings are either paired to form bigons or left alone as the tips of monogons .",
    "swapping the two sides of a singular bigon of an immersion of a geodesic primitive curve decreases its number of crossings by at least two .",
    "consider a singular bigon @xmath632 of an immersion @xmath70 of a closed primitive canonical curve @xmath18 .",
    "let @xmath620 be the immersion after the bigon has been swapped .",
    "we shall partition the set of potential double points and show that the net change of the number of crossings with respect to @xmath70 and @xmath620 is non positive in each part .",
    "as the tips of the bigon are not crossings in @xmath620 , this will prove the lemma .",
    "we set for @xmath633 and @xmath634 : @xmath635 when @xmath636 or @xmath340 , the set @xmath637 consists of three double points only ( or zero if @xmath638 ) .",
    "note that we can not have both equalities as this would imply @xmath639 , whence @xmath235 and @xmath18 would be a square , in contradiction with the hypothesis that @xmath18 is primitive .",
    "for each double point in @xmath640 the four incident arc occurrences are left in place in @xmath70 and @xmath620 .",
    "it ensues that @xmath640 has the same crossings in @xmath70 and @xmath620 .",
    "the double points in @xmath641 are the tips of the bigon .",
    "they are crossings in @xmath70 and not in @xmath620 , whence a net change of @xmath124 crossings . for each of @xmath642 or",
    "@xmath643 , the first double point in their above definition is a crossing in @xmath70 ( resp .",
    "@xmath620 ) if and only if the second one is a crossing in @xmath620 ( resp .",
    "@xmath70 ) .",
    "their net change of crossings is thus null . for @xmath644 , @xmath645 , @xmath646 and @xmath647",
    "there are a few case analysis depending on the relative ordering of the two arc occurrences incident to @xmath648 ( resp .",
    "@xmath649 , @xmath650 ) with respect to the crossing @xmath77 ( resp . @xmath242 . in each case",
    "( see figure  [ fig : dx1 ] ) the number of crossings can not increase from @xmath70 to @xmath620 .    , @xmath645 , @xmath646 or @xmath647 has four distinct possible configurations .",
    "the blue and red strands represent the crossing @xmath77 ( resp .",
    "@xmath242 ) and each arrow links the left configuration before the bigon swap ( in @xmath70 ) with the right configuration after the swap is applied ( in @xmath620 ) . ]    for @xmath637 there are three cases according to whether @xmath651 , @xmath652 , or none of the two identifications occurs .",
    "recall from the paragraph before the lemma that we can not have both identifications .",
    "the first two cases can be treated the same way .",
    "see figure  [ fig : d2special ] .    ,",
    "the end of @xmath334 overlaps with the beginning of @xmath653 ( in the purple strand ) .",
    "the third configuration on the right is actually forbidden by the definition of a singular bigon !",
    "it corresponds to the non - singular bigon on figure  [ fig : singular - def ] . ]",
    "the number of possible configurations is much larger in the last case , i.e. when @xmath654 and @xmath655 .",
    "we essentially have to shuffle two circular orderings of length four corresponding to the two crossing tips . without loss of generality",
    "we can assume that the path from @xmath47 to @xmath656 is the right side of the bigon .",
    "we consider the following arc occurrences : @xmath657 since @xmath77 and @xmath242 are crossings we must see @xmath658 in this counterclockwise order around the vertex @xmath659 and similarly for @xmath660 .",
    "we denote by @xmath661 and @xmath662 , respectively , these two circular sequences .",
    "we need to consider the effect of the bigon swapping on all the possible shuffles of @xmath661 and @xmath662 .",
    "the restriction of these shuffles to @xmath663 and @xmath664 gives the 6 possible shuffles of @xmath665 and @xmath666 . among them",
    "the order @xmath667 can not occur .",
    "indeed , since the bigon is a thick double path the arcs @xmath668 and @xmath669 either coincide or form a corner of a quad .",
    "this would force @xmath670 and @xmath671 to lie in a similar configuration .",
    "in turn , the constrained order @xmath662 would also enforce @xmath672 and @xmath670 to coincide or form a corner of a quad in contradiction with the hypothesis that @xmath18 has no spurs or brackets .",
    "similar arguments show that the orders @xmath673 , @xmath674 , @xmath675 and @xmath676 can only occur as factors in the possible shuffles of @xmath661 and @xmath662 .",
    "these 4 orders thus leads to 24 distinct shuffles of @xmath661 and @xmath662 by factoring with the 6 shuffles of @xmath677 with @xmath678 . by exchanging the roles of @xmath665 and @xmath666 and by turning clockwise instead of",
    "counterclockwise we see that @xmath674 leads to the same orders as @xmath673 and a similar correspondence holds for @xmath675 and @xmath676 .",
    "we thus only need to check the 12 configurations depicted on figure  [ fig : d2quater ] .",
    "on @xmath637 for all the orders including the factor @xmath673 or @xmath675 .",
    "the blue strand represents @xmath679 , the red one @xmath680 , the orange one @xmath681 and the green one @xmath682 . ]",
    "it remains to consider the order @xmath683 .",
    "because of the constrained order @xmath662 , @xmath684 and @xmath685 can not lie between @xmath22 and @xmath664 .",
    "this leaves out @xmath686 possible shuffles of @xmath678 and @xmath683 : @xmath687 we finally shuffle each of these orders with @xmath688 . since @xmath689 and @xmath690 can not lie between @xmath13 and @xmath193 , we obtain @xmath691 possible shuffles when considering either @xmath692 or @xmath693 , @xmath694 possible shuffles with @xmath695 or @xmath696 , and @xmath686 possible shuffles with @xmath697 . by swapping left and right and turning clockwise instead of counterclockwise , we remark that @xmath698 and @xmath693 lead to the same orders and similarly for @xmath695 and @xmath696 .",
    "we thus only need to consider the shuffles of @xmath688 and @xmath699 or @xmath697 to complete the inspection of all the cases .",
    "those shuffles are represented on figures  [ fig : d2-s1 ] ,  [ fig : d2-s2 ] ,  [ fig : d2-s4 ] ,  [ fig : d2-s6 ] respectively .    in each of the configurations",
    ", we trivially check that the number of crossings is not increasing .",
    "this allows to conclude the lemma when the two index paths of a singular bigon are directed the same way .",
    "a similar analysis can be made when their directions are opposite , that is when the considered bigon has the form @xmath700 .",
    "_ claim : let @xmath18 be a primitive geodesic of length four and let @xmath284 be a positive integer .",
    "then @xmath701 and @xmath702 can not bound a partial diagram where the index pairs @xmath703 and @xmath704 are in the same configuration . _    consider a partial diagram @xmath106 for the thick double path @xmath705 and suppose that the index pairs @xmath703 and @xmath704 are in the same configuration . in order to reach a contradiction",
    "we will use the fact that @xmath706 label the first arcs of the @xmath707 side of @xmath230 as well as the last arcs of the @xmath708 side , and similarly for @xmath709 .",
    "if the first and last index pairs of @xmath230 correspond to the same vertex in @xmath106 , then there are five possible configurations for the first two arcs on each side of @xmath230 ( depicted on figure  [ fig : length - partial - diag ] , b1 - 5 ) and five possible configurations for the last two arcs on each side of @xmath230 ( depicted on figure  [ fig : length - partial - diag ] , e1 - 5 ) .",
    "clearly , @xmath106 can not start with a path part of length two ( case b1 ) , as this would imply @xmath710 and in turn @xmath711 would be a square ; this would contradict the fact that @xmath18 is primitive .",
    "case b2 leads to the same contradiction noting that @xmath712 .",
    "cases e1 and e2 can be dealt with analogously . as in lemma",
    "[ lem : ell - plus - un ] , we denote by @xmath713 the conjunction of configurations @xmath421 and @xmath714 .    *",
    "if the orientations of the first and last staircases in @xmath106 coincide , we easily obtain that @xmath715 has degree 2 for the conjunctions @xmath716 , @xmath717 has degree 2 for @xmath718 , @xmath715 has degree 3 for @xmath719 and @xmath720 and @xmath715 has degree 4 for @xmath721 , @xmath722 , @xmath723 and @xmath724 .",
    "in case @xmath725 a quad has two sides labelled by the same arc , which is forbidden by lemma  [ lem : facial - walk ] . *",
    "if the orientations of the first and last staircases in @xmath106 are opposite then each conjunction of @xmath726 with @xmath727 implies that a quad has two sides labelled by the same arc , which is again forbidden .",
    "when the first and last index pairs of @xmath230 correspond to diagonally opposite vertices in a quad , we get eight possible configurations for the first two arcs on each side of @xmath230 ( depicted on figure  [ fig : length - partial - diag ] , b1 - 8 ) and eight possible configurations for the last two arcs on each side of @xmath230 ( depicted on figure  [ fig : length - partial - diag ] , e1 - 8 ) .",
    "all the pink quads in the figure denote the same quad with the same orientation , recalling that the configuration for the first and last index pairs of @xmath230 is the same .",
    "we easily get in each case that a vertex has degree at most 5 , or that a quad has two sides labelled by the same arc , or that @xmath18 is a square ( case @xmath728 ) . in each case",
    ", we have thus reached a contradiction ."
  ],
  "abstract_text": [
    "<S> the geometric intersection number of a curve on a surface is the minimal number of self - intersections of any homotopic curve , i.e. of any curve obtained by continuous deformation . </S>",
    "<S> likewise , the geometric intersection number of a pair of curves is the minimal number of intersections of any homotopic pair . given two curves represented by closed walks of length at most @xmath0 on a combinatorial surface of complexity @xmath1 we describe simple algorithms to compute the geometric intersection number of each curve or of the two curves in @xmath2 time . </S>",
    "<S> we also propose an algorithm of complexity @xmath3 to decide if the geometric intersection number of a curve is zero , i.e. if the curve is homotopic to a simple curve . </S>"
  ]
}