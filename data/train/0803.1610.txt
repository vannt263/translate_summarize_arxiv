{
  "article_text": [
    "this paper analyzes the performance of a simple file sharing principle during a flash crowd scenario when a popular content becomes available on a peer - to - peer network .",
    "it is supposed that a given peer is willing to share a given file with a community of @xmath0 peers , which are initially asleep .",
    "an asleep peer becomes active at some random time , i.e. , it tries to download the file from a peer having the complete file .",
    "once a peer has downloaded the file , it immediately becomes a server from which another peer can download the file . to simplify the model ,",
    "we assume that the file is in one piece and not segmented into chunks ; the time needed to download the file from one server is supposed to be random in order to take into account the diversity of upload capacities of peers .    the goal of this paper is to understand how the network builds up in this situation as peers join the system . in particular , we are interested in analyzing the growth of the number of available servers in the system .",
    "note that there are eventually as many servers as peers since each of them can complete the file download .    in spite of its apparent simplicity ,",
    "the analysis of the system is quite difficult because we have to cope with a network comprising a random number of servers : when peers complete their download , they become new servers so that the number of servers is continually increasing .",
    "it is assumed that an incoming peer chooses a server with the smallest number of queued peers .",
    "other routing policies are considered at the end of this paper .",
    "the analysis performed in this paper substantially differs from earlier studies appeared so far in the technical literature in the sense that we consider the transient formation of a network of peers .",
    "yang and de veciana  @xcite considered a similar setting which they analyzed with results related to branching processes to describe the exponential growth of the number of servers .",
    "our goal in this paper is precisely to obtain more detailed asymptotics of this transient regime . except the paper by yang and de veciana  @xcite , most of the papers published so far on the performance of peer - to - peer systems assume that peers join and leave the system and that a steady state regime exists .",
    "the problem is then to evaluate the impact of some parameters of the file sharing protocol on the equilibrium of the system .",
    "different techniques can be used to perform such an analysis , for instance by using a markovian chain to describe the state of the system , possibly by using approximation techniques when the state space related to the number of peers in the system is too large .",
    "see ge  @xcite .",
    "a fluid flow analysis with an underlying markovian structure is proposed in clvenot and nain  @xcite in order to model the squirrel peer - to - peer caching system . in qiu and srikant",
    "@xcite , the authors directly use a fluid approximation to study the steady state of a peer to peer network , subsequently complemented by diffusion variations around the steady state solutions . in massouli and vojnovi",
    "@xcite , the authors study the performance of a file sharing system via a stochastic coupon replication formulation , a coupon corresponding to a chunk of a file .",
    "the goal of this study is to understand the impact of the policy applied by users for choosing coupons on the performance of the system .",
    "the system is studied in equilibrium as in qiu and srikant  @xcite .",
    "the rest of this paper is organized as follows : in section  [ sec : model ] , we describe the system under consideration and some heuristics to study the system are presented .",
    "it turns out that the dynamics of the system can be decomposed in two regimes . in the first one , there are almost no empty servers and we establish an analogy with a random urn and ball problem on the real line . by approximating the probability of selecting an urn by its mean value , we analyze in section  [ urnball ] the corresponding deterministic urn and ball problem . the analysis for the random urn and",
    "ball problem is much more complicated to analyze .",
    "the complete analysis is done in @xcite and only the main results are summarized in section  [ sec : mathr ] . in section  [ sec : discussion ] , we support via simulation the different approximations and heuristics made in this paper to analyze the file sharing system .",
    "concluding remarks are presented in section  [ conclusion ] .",
    "we consider throughout this paper a system composed of @xmath0 peers interested in downloading a given file . at the beginning , only one peer ( the initial server ) has the file and other peers are asleep .",
    "when becoming active , after an exponentially distributed duration of time with parameter @xmath1 , a peer tries to download the file from the server that is the less loaded in terms of number of queued peers .",
    "in particular , the first peer becoming active downloads the file from the initial server .",
    "the time needed to download the file is assumed to be exponentially distributed with mean @xmath2 .",
    "[ [ exponential - distributions ] ] exponential distributions + + + + + + + + + + + + + + + + + + + + + + + + +    the hypothesis on the distribution on the duration of the time for a peer to be active is quite reasonable : this is a classical situation when a large number of _ independent _ users may access some network .",
    "the assumption on the duration of the time to download is not realistic in practice since this quantity is related to the size of the file requested whose distribution is more likely to be bounded by the maximal size of a chunk . as it will be seen , even within this simplified setting ( in order to have a nice probabilistic description of the process )",
    ", mathematical problems turn out to be quite intricate to solve . in this respect ,",
    "our study could be seen as a first step in the analysis of flash crowd scenarios .",
    "it turns out that our current investigations in the general case seem to show that the exponential distribution does not have a critical impact on the qualitative behavior as long as the fifo policy is used by servers .",
    "mathematically , however , numerous technical points are not settled in this case .",
    "we assume that peers requesting the file from the same server are served according to the fifo discipline .",
    "note that , because of the exponential distribution assumption , this case is equivalent to the processor - sharing discipline , i.e. , when @xmath0 peers are present for a duration of time @xmath3 , each of them receives the amount of work @xmath4 . just after completing the file download , a peer immediately becomes a server from which other peers can retrieve the file .",
    "the problem of `` free riders '' , i.e. , peers who do not become servers after service completion , is not discussed here .",
    "as it will be seen , this feature does not change significantly the qualitative properties of the system .",
    "the problem of servers who disconnect while they have downloads in progress will not be discussed in this paper .",
    "it is worth noting that the model under consideration describes a `` flash crowd '' scenario .",
    "indeed , a peer having a file accepts to share it with other peers and we are interested in the dynamics of the sharing process when a large population of peers tries to download the file . moreover , since the durations for which these peers stay inactive are independent and identically distributed , the flow of arrivals of peers into the system is not stationary , but rather accumulates at the beginning and is then less and less intense .",
    "we are hence interested in the transient regime of the system .",
    "contrary to the earlier studies @xcite , we are not interested in the steady state regime of the system , where peers continually join and leave the system .",
    "it is intuitively clear that there should exist two different regimes for this system .",
    "initially , it starts congested : many peers request the file , and only a few servers are available .",
    "afterward , the situation is reversed : there are a large number of servers and only a few requests from the remaining inactive peers .",
    "these two regimes clearly appear in figure  [ fig : empty_servers ] depicting the simulation results with @xmath5 peers and @xmath6 .",
    "it shows that before time @xmath7 time units ( or equivalently mean download times ) , there are almost no empty servers , while after that time , more and more servers are empty until all peers have completed their download .",
    "but as long as the input rate is high , a new server immediately receives a customer .",
    "this is all the more true under the routing policy considered , since new peers entering the system choose an empty server if any .",
    "( -240,20 ) ( -40,20)time      from the above description , the system can be represented by means of a queueing system with a random number of queues .",
    "initially , the system is composed of a single server , and once a customer has completed its service , it becomes a new server . since only a finite total number of customers is considered , there are eventually as many servers as customers .",
    "when peer inter - arrival times and file download times are assumed to be exponentially distributed , a minimal markovian representation of this queueing model requires the knowledge of the number of peers which are still asleep and the number of peers connected to each server . since this markov process is ultimately absorbing ( all peers are servers at the end ) , the transient behavior of the system is of course the main object of interest in the analysis . even in very simple queueing systems ,",
    "the transient behavior is delicate to analyze and much more difficult to describe than the stationary behavior .",
    "the classical @xmath8 queue is a good ( and simple ) example of such a situation when transient characteristics are not easy to express with simple closed form formulas .",
    "see asmussen  @xcite for example .    given the multi - dimensional description ( with unbounded dimension ) of the markov process , the system considered here is much more intricate and challenging . to analyze this system , a simpler mathematical model with urns and balls",
    "is used to investigate the duration of the first regime of this system .",
    "the specific point addressed in this paper is to describe the transient behavior when @xmath0 becomes large .",
    "initially , the input rate is large and therefore a newly created server receives very quickly many requests from the numerous peers becoming active . the first regime described in the previous section and illustrated in figure  [ fig : empty_servers ]",
    "is hence characterized by the fact that the duration times during which some servers are idle are negligible . in a second phase",
    "the number of empty servers begins to be significant before increasing very rapidly in the last phase .",
    "this phenomenon is discussed in section  [ sec : discussion ] .",
    "for the first regime , this leads us to describe the dynamics of the system as follows .",
    "let @xmath9 be the time at which the @xmath10-th server is created , with the convention that @xmath11 ( the initial server has label 0 ) . during the @xmath10-th time interval @xmath12 for @xmath13",
    ", there are by definition exactly @xmath10 servers .",
    "so if we assume , as argued above , that empty servers are negligible during the first regime , @xmath14 is well approximated by the minimum of @xmath10 independent exponential random variables with parameter @xmath2 .",
    "the random variable @xmath9 can thus be represented as @xmath15 , where @xmath16 is an exponential random variable with parameter @xmath2 independent of the past . in particular , during the first regime , the following approximation is accurate .",
    "[ approx : heuristic ] for @xmath17 , as long as the system is still in the first regime , the instant of creation of the @xmath10-th server is given by @xmath18 , where @xmath19 and @xmath16 being i.i.d .",
    "exponential random variables with unit mean .    despite this approximation seems to be quite rough , ( a rigorous mathematical formulation of the approximation @xmath20 seems to be difficult to establish ) , proposition  [ prop : heuristic ] and the subsequent discussion below provide strong arguments to support its accuracy . in the definition of the above approximation , it is essential to determine the duration of the first regime , in particular to know whether @xmath18 holds or not .",
    "for instance , one could consider as definition for the duration of the first regime the last time when there are no empty servers .",
    "this time is unfortunately not a stopping time and turns out to be much more difficult to study . in section  [ sec : discussion ]",
    ", we shall consider different heuristics for evaluating the length of the first regime .",
    "we start the analysis by introducing the index @xmath21 defined as follows .",
    "[ def : heuristic ] the duration of the first regime is defined as @xmath22 , where @xmath21 is the first index @xmath13 so that one or no peer arrive between @xmath23 and @xmath24 .    according to this definition , the first regime lasts as long as between the creation of two successive servers , at least two peers arrive in the system .",
    "the intuition behind this heuristic is that , because of the policy for the choice of servers , if many peers arrive in any interval , then the least loaded servers will receive requests from arriving peers .",
    "thus , as long as many peers arrive , it is quite rare for a server to remain empty .",
    "the phase transition should occur when the number of arrivals between the creation of two successive servers is not sufficient to give work to empty servers which are created .",
    "in particular , if no peers arrive in some interval , then there will be at least two empty servers at the beginning of the next time interval .",
    "so the first time when only a few peers arrive in some interval should be a good indication on the current state of the system .",
    "a probably more natural heuristic would have been to consider the first interval in which no peer arrives . nevertheless , an argument in favor of",
    "the former heuristic is that it enjoys the following nice property .",
    "[ prop : heuristic ] for @xmath25 , at most two servers are simultaneously empty in the @xmath10-th interval @xmath26 .",
    "the proof is by induction . for @xmath27 ,",
    "the property is trivial , since there is only one server in the first interval .",
    "consider now @xmath28 , and suppose that the property holds for @xmath29 .",
    "since at least two peers arrive in the @xmath30-th interval , and since these peers are necessarily routed to empty servers , if any , there is no empty server just before @xmath23 .",
    "therefore , just after @xmath23 , there are at most two empty servers , and so the property holds as long as @xmath25 .",
    "we are now able to justify approximation  [ approx : heuristic ] . indeed , for @xmath25",
    ", the number of non idle servers is between @xmath31 and @xmath10 .",
    "for @xmath10 large , approximately @xmath10 servers are busy , thus @xmath32 is close in distribution to an exponentially distributed random variable with parameter @xmath10 . during the first time intervals ,",
    "the number of empty servers is negligible .",
    "indeed , consider any finite index @xmath10 , then it is easy to see that the mean number of peers that arrive in the @xmath10-th interval is proportional to @xmath0 .",
    "so after the creation of the @xmath10-th server , the mean time before the next arrival behaves as @xmath33 , and so is very small when @xmath0 is large .",
    "this intuitively shows that the fraction of idle servers is initially negligible , which justifies approximation  [ approx : heuristic ] .    from now on , the identification of @xmath9 and @xmath34 , where the sequence @xmath35 is defined by equation  ,",
    "is assumed to hold .",
    "results on @xmath34 can be assumed to hold for @xmath9 when @xmath25 .",
    "denote by @xmath36 an i.i.d .  sequence of exponentially distributed random variables with parameter @xmath1 . for @xmath37 ,",
    "@xmath38 is the time at which the @xmath39-th peer becomes active .",
    "we introduce the following urn and ball model on the real line : the interval @xmath40 is the @xmath10-th urn and the variables @xmath41 are the locations of @xmath0 balls thrown on the real line . the set @xmath42 is simply the event that the @xmath39-th ball falls into the @xmath10-th urn . conditionally on the sizes of the urns , i.e. , on @xmath43 , we have that the probability of such an event ( which does not depend on @xmath39 ) is @xmath44 where the random variables @xmath16 , @xmath13 , are independent and exponentially distributed with mean unity .    with the above formulation",
    ", we have then to deal with the following urn and ball model :    1 .   a random probability distribution @xmath45 is given ( urns with random sizes ) .",
    "2 .   @xmath0 balls are thrown independently according to the probability distribution @xmath46 .",
    "it is worth noting that the above urn and ball model has an infinite number of urns .",
    "in addition , although urn and ball problems have been widely studied in the literature , our model presents a remarkable feature : for @xmath47 , a ball falls into urn @xmath39 with probability @xmath48 which is a random variable , but conditionally on the sequence @xmath49 , this is a classical urn and ball problem .",
    "mathematical results for urn models with random distributions are quite rare .",
    "see kingman  @xcite and gnedin  @xcite and the references therein where some related models have been investigated .",
    "the random model under consideration will give us some information on the behavior of our system . the following proposition",
    "establishes a simple but important characterization for the asymptotic behavior of @xmath49 .",
    "[ prop : asymptotic ] let @xmath50 , @xmath51 , be independent exponential random variables with parameter @xmath2 .",
    "then , for @xmath17 @xmath52 and the sequence @xmath53 converges almost surely to a finite random variable @xmath54 whose distribution is given by @xmath55 for @xmath56 .",
    "the conditional probability @xmath57 of throwing a ball into the @xmath10-th urn can be written as @xmath58 where @xmath59 are independent random variables .",
    "as @xmath10 goes to infinity , @xmath60 ( resp .",
    "@xmath61 ) converges in distribution to @xmath62 ( resp .",
    "@xmath63 ) .",
    "the convergence of @xmath64 to @xmath65 holds almost surely and in @xmath66 , for any @xmath67 .",
    "the limiting variable @xmath63 has an exponential distribution with parameter @xmath2 and @xmath62 has a weibull distribution with parameter @xmath68 , @xmath69    let @xmath70 be the variables @xmath71 in increasing order .",
    "in particular @xmath72 . with the convention @xmath73 , due to standard properties of the exponential distribution , the variables @xmath74 , @xmath75, ",
    "@xmath76 are independent and the variable @xmath77 is the minimum of @xmath78 exponential variables with parameter @xmath2 , i.e. , has the same distribution as @xmath79 .",
    "the distribution identity   then follows .    since @xmath80",
    ", it converges in distribution to an exponential distribution with parameter one .",
    "define @xmath81 where @xmath82 is the sequence of harmonic numbers , @xmath83 .",
    "the sequence @xmath84 is clearly a martingale , it is bounded in @xmath85 since @xmath86 it therefore converges almost surely .",
    "see williams  @xcite for example .",
    "the almost sure convergence of @xmath87 is thus proved .",
    "identity   gives that , for @xmath88 , @xmath89 as @xmath10 goes to infinity .",
    "since @xmath90 one gets the almost sure convergence of @xmath64 .",
    "it is easy to check that , for @xmath91 , @xmath92 when @xmath93 , where @xmath94 is the usual gamma function , and where the last equivalence easily comes from stirling s formula . in particular , for any @xmath91 , the @xmath95-th moment of @xmath60 is therefore bounded with respect to @xmath10 .",
    "one deduces the convergence in @xmath66 of the sequence @xmath64 . since @xmath96",
    ", one has the equality in distribution @xmath97 which gives the law of @xmath62 .",
    "it is important to note that the probability distribution @xmath45 is a _",
    "random _ element in the set of probability distributions on @xmath98 .",
    "the decay of this distribution follows a power law with parameter @xmath99 , because according to the previous proposition , @xmath100 converges in distribution to @xmath101 . using the asymptotic behavior derived in   with @xmath102 ,",
    "it is easy to see that the average probability for a ball to fall into the @xmath10-th urn satisfies the following relation @xmath103 this equivalence suggests the introduction of a deterministic version of the urn and ball problem considered .",
    "denote by @xmath104 a probability distribution on @xmath98 such that @xmath105 for some @xmath106 and @xmath107 . for each @xmath10",
    ", @xmath108 can be seen as the probability for a ball to fall in the @xmath10-th urn . when @xmath109 and @xmath110 , the sequence @xmath111 has the same asymptotic behavior as @xmath112 given by equation  .",
    "hence , this model may be considered as the deterministic equivalent of the urn and ball problem defined in the previous section . for the sake of clarity , the problem with the probability distribution @xmath113 ( resp .",
    "@xmath114 ) will be referred to as the random ( resp .",
    "deterministic ) problem .",
    "the deterministic problem amounts to throwing @xmath0 exponential variables with parameter @xmath1 on the half - real line , where this line has been divided into deterministic intervals @xmath115 with @xmath116 .",
    "the main quantity of interest in the following is the asymptotic behavior with respect to @xmath0 of the index of the first urn that does not receive any ball .",
    "let us denote by @xmath117 ( resp .",
    "@xmath118 ) the number of balls in the @xmath39-th urn when @xmath0 balls have been thrown in the random ( resp .",
    "deterministic ) urn and ball problem , and define @xmath119    in view of definition  [ def : heuristic ] , to investigate the duration of the first regime of the system , the asymptotic behavior of the sequences @xmath120 and @xmath121 is analyzed . since we consider that the first regime lasts until one or no peers arrive between the creation of two successive servers , we should have to consider @xmath122 to be rigorous .",
    "in fact , the mathematical analysis of the index of the first empty urn can easily be extended to the first urn that receives less than @xmath123 balls . for the sake of simplicity",
    ", we therefore only treat the case @xmath124 .",
    "neither the orders of magnitude nor the asymptotic behaviors established in the following are affected by the value of @xmath123 , and in particular if we consider @xmath2 instead of @xmath125 .    to conclude this section ,",
    "let us give a rough approximation of the correct order of magnitude for @xmath126 and @xmath127 as @xmath0 gets large .",
    "rigorous mathematical analysis is carried out in section  [ sec : math ] , while section  [ sec : discussion ] compares the insights provided by the two models .    for @xmath128 , @xmath129 .",
    "hence , in the deterministic model , a finite number of balls will fall in the @xmath39-th urn as soon as @xmath39 is of the order of @xmath130 as @xmath0 becomes large .",
    "hence we expect that in the deterministic model , @xmath131 converges in distribution for @xmath132 .",
    "theorem  [ thm : determinist ] below shows that the location of the first empty urn is in fact slightly smaller than @xmath133 , i.e. , of the order of @xmath134 .",
    "nevertheless this heuristic approach gives the correct exponent in @xmath0 .",
    "although @xmath135 has the same asymptotic behavior , the corresponding heuristic approach in the case of the random model is more subtle .",
    "indeed , we have @xmath136 so the number of balls falling in the @xmath39-th urn should be of the order @xmath137 .",
    "however , in the random model , the @xmath39-th interval is with random length @xmath138 .",
    "so from @xmath139 , the next point @xmath140 is at a distance @xmath141 and the first ball is at a distance corresponding to the minimum of @xmath137 i.i.d .  exponential random variables with parameter @xmath2 .",
    "thus , with this approximation , the @xmath39-th interval is empty with probability @xmath142 when @xmath143 , this probability is non negligible as soon as @xmath39 is of order @xmath144 , which is significantly below what we found in the deterministic case .",
    "theorem  [ thm : random ] below shows that this is indeed the correct answer .",
    "the order of magnitude is one order smaller , compared to the deterministic case , because of the variability of the intervals size : to some extent , a very small interval is generated , so that no balls fall in it , while in the deterministic case , some balls would have .",
    "cski and fldes  @xcite gives the asymptotic behavior of the distribution of @xmath145 when @xmath0 is large . a more complete description of the locations of the first empty urns ( and not only for the first one ) can however be achieved . for this purpose ,",
    "the variable @xmath146 is defined as the number of empty urns whose index is less than @xmath123 when @xmath0 balls have been thrown .",
    "this random variable is formally defined as @xmath147 the distribution of @xmath146 is analyzed when @xmath123 is dependent on @xmath0 .",
    "first , some estimates for the mean value and the variance of @xmath146 are required .",
    "[ prope ] assume that the sequence @xmath148 is non - increasing . for @xmath149 , if @xmath150\\right\\rfloor,\\end{gathered}\\ ] ] where @xmath151 is the integral part of @xmath152 , then @xmath153    for @xmath123 , @xmath154 @xmath155 for @xmath156 , @xmath157 where @xmath158 is the unique solution to the equation @xmath159 , since the function @xmath160 has a maximum at point @xmath158 .",
    "it is easily seen that @xmath161 ( in fact @xmath162 as @xmath163 ) , so that for @xmath164 @xmath165 with this relation , we obtain @xmath166 so that for @xmath167 and large @xmath0 , @xmath168 can be replaced with @xmath169 in the expression of @xmath170 .    for the sake of simplicity ,",
    "we assume that @xmath171 , for @xmath128 . the general case of a non - increasing sequence @xmath148 follows along the same lines since the crucial relation below holds true with a convenient function @xmath95 .",
    "one defines @xmath172 for @xmath173 .",
    "@xmath174 the difference between these two integrals is bounded by @xmath175 .",
    "now take @xmath176 with @xmath177 with the same order of magnitude as @xmath178 , say , @xmath179 for some @xmath180 .",
    "we have @xmath181 the right hand side of the above equation is given by @xmath182 now let @xmath183 and consider @xmath184 since @xmath185 and @xmath186 as @xmath163 .",
    "therefore , an equivalent expression of the integral in the right hand side of equation   has been obtained .",
    "gathering these results , we obtain @xmath187 relation   is obtained by taking @xmath188 .",
    "the following proposition shows the equivalence of the variance and the mean value of @xmath189 under a convenient scaling .",
    "this result is crucial to prove the limit theorems of this section .",
    "[ propvar ] assume that the sequence @xmath148 is non - increasing .",
    "for @xmath149 , let @xmath190 be defined by equation  , then @xmath191    for @xmath192 , by using equation   ( which does not depend on @xmath193 ) .",
    "@xmath194)^2=\\sum_{1\\leq i , j\\leq   k } ( 1-q_i - q_j+q_iq_j)^n,\\ ] ] and @xmath195=\\e[w_n^k]+\\sum_{1\\leq",
    "i\\not= j\\leq   k } ( 1-q_i - q_j)^n,\\ ] ] so that , to prove the equivalence of @xmath196 and @xmath170 , it is sufficient to show that the quantities @xmath197\\ ] ] and @xmath198 are negligible with respect to @xmath170 . since we consider @xmath199 , this amounts to show that these quantities are @xmath200 by proposition  [ propvar ] .",
    "the second term is the expected number of empty urns for the distribution @xmath201 such that @xmath202 .",
    "estimate   shows that @xmath203    by using the fact that for @xmath204 , @xmath205 , the second term satisfies @xmath206 \\\\ \\leq n \\sum_{1\\leq i , j\\leq   k}q_iq_j ( 1-q_i - q_j+q_iq_j)^{n-1 }",
    "\\\\ = \\frac{1}{n } \\left(\\sum_{i=1}^{k}nq_i ( 1-q_i)^{n-1 } \\right)^2.\\end{gathered}\\ ] ] by using a similar method as in the proof of proposition  [ prope ] , we obtain the equivalence @xmath207 this equivalence together with equation   complete the proof of the proposition .    [ thm : determinist ] let @xmath111 be a non - increasing sequence satisfying relation",
    ". for @xmath149 and @xmath154 , set @xmath208 when @xmath0 goes to infinity , the variable @xmath189 converges in distribution to a poisson random variable with parameter @xmath209 .",
    "the index @xmath127 of the first empty urn defined by equation   is such that the variable @xmath210 converges in distribution to a random variable @xmath211 defined by @xmath212    chen - stein s method is the basic tool in the proof of the theorem .",
    "see barbour  @xcite for a detailed presentation of this powerful method .",
    "let @xmath0 , and @xmath123 be in @xmath98 and @xmath213 .",
    "the variable @xmath146 conditioned on the event @xmath214 has the same distribution as the number of empty urns when the balls in the @xmath215-th urn are thrown again until the @xmath215-th urn is empty .",
    "it follows that the number of balls in any other urn is larger than in the case when they are assigned at first draw .",
    "one deduces that for @xmath216 , @xmath217 the variables @xmath218 are therefore negatively correlated , see barbour  @xcite .",
    "then , by ( * ? ? ?",
    "* corollary 2.c.2 ) , the following relation holds , @xmath219 by taking @xmath167 and by using propositions  [ prope ] and  [ propvar ] , we obtain the convergence in distribution of @xmath189 to a poisson distribution with parameter @xmath220 . the last part of the theorem is a simple consequence of the identity @xmath221 .",
    "the convergence in distribution of @xmath127 has been proved by cski and fldes  @xcite with a different method .",
    "our result gives a more accurate description of the location of empty urns ( and not only the first one ) near the index @xmath222 .",
    "the following corollary is a straightforward application of the detailed asymptotics obtained in the above theorem .    under the assumption of theorem  [ thm : determinist ] ,",
    "if @xmath223 then , as @xmath0 goes to infinity , the following convergence in distribution holds : for @xmath224 , @xmath225    so far , only indexes of empty urns have been considered .",
    "the result below shows that the first empty urn happens at a time of the order of @xmath226 .",
    "remembering the approximation of the peer to peer system , it suggests that the time the system begins to serve quickly the incoming peers should be of the same order .",
    "[ corolhit ] let @xmath227 under the assumptions of theorem  [ thm : determinist ] , the quantity @xmath228 converges in distribution to @xmath54 , where @xmath54 is the random variable defined in proposition  [ prop : asymptotic ] .",
    "if @xmath229 is the variable defined by expression  , then @xmath230 since by theorem  [ thm : determinist ] the sequence @xmath231 converges in distribution , it implies that the right hand side of the above expression converges in distribution to @xmath125 .",
    "proposition  [ prop : asymptotic ] shows that @xmath232 converges almost surely to @xmath54 .",
    "for the random model , the probability @xmath57 of selecting the @xmath10-th urn is given by equation   of proposition  [ prop : asymptotic ] .",
    "in the ( almost sure ) limit as @xmath10 goes to infinity , @xmath233 and in distribution , @xmath61 is asymptotically an exponentially distributed random variable with parameter @xmath2 .",
    "the sequence @xmath49 can be approximated by @xmath234 where @xmath235 are i.i.d .",
    "exponential variables with unit means .    in spite of the fact that the decay of @xmath57 follows a power law , the random factor plays an important role",
    "this factor is composed of two variables , one ( namely @xmath62 ) is fixed once for all and the other ( namely @xmath61 ) changes for every urn .",
    "the fact that @xmath61 , related to the `` width '' of the @xmath10-th urn , can be arbitrarily small with a positive probability suggests that the index @xmath236 of the first empty urn should be smaller than the corresponding quantity for the deterministic case .",
    "this is indeed true but the situation in this case is much more complex to analyze . the complete analysis of the random case is given in @xcite , and only sketches of proof are given for proposition  [ prop : process ] and theorem  [ thm : random ] in the present paper .",
    "it must be noticed that a similar problem where @xmath62 and the sequence @xmath237 are independent is fairly easy to solve . however here , these random variables are dependent , and this dependency requires quite technical probabilistic tools .    to derive asymptotic results for @xmath236 , as in the previous section , the asymptotic behavior of the random variable @xmath146 defined by @xmath238 is investigated .",
    "although in the deterministic case , chen - stein s method makes it possible to reduce the analysis of @xmath146 to its first and second moments , this is no longer the case for the random problem . indeed , because of the variability of the urns sizes , the random variables @xmath239 are no longer negatively correlated .",
    "moreover , the ratio of the expected value to the variance of @xmath240 does not converge to @xmath2 for a convenient sequence @xmath241 as in the deterministic case ( proposition  [ propvar ] ) , which suggests that if a limit in distribution exists , it can not be poisson .",
    "as was pointed out in hwang and janson  @xcite , the sequence @xmath242 plays a central role in the limiting behavior of @xmath243 .",
    "the following technical proposition gives a result on the asymptotic behavior of this sequence .",
    "it is important since it introduces the scale @xmath144 which turns out to be the correct scaling for the variable @xmath126 ; see @xcite for the proof .",
    "[ prop : process ] let @xmath244 .",
    "when @xmath0 goes to infinity , the random sequence @xmath245 converges in distribution to a doubly stochastic poisson process with a random intensity @xmath246 .",
    "because of the technicality involved , we only give a sketch of the proof .",
    "the reader is referred to  @xcite for more details .    to prove the convergence of the sequence of point processes @xmath247 with @xmath248 , it is enough to show the convergence of the laplace transforms of these point processes applied to some suitable functions .",
    "non - negative continuous functions with a compact support would be enough to prove the result , but the next theorem requires a slightly stronger result , namely it requires the converge of laplace transforms for non - negative continuous functions vanishing at infinity , i.e. , that for any function @xmath249 continuous vanishing at infinity , we have @xmath250 where , conditionally on @xmath62 , @xmath251 is a poisson process with intensity @xmath252 .",
    "the general idea is to condition on the random variable @xmath62 .",
    "however , for each @xmath13 , @xmath62 and @xmath61 are dependent , so that this can not be directly done .",
    "instead , the first step of the proof is to show that only the last terms of the point process matter , i.e. , that @xmath253 and @xmath254 have the same limit , for any sequence @xmath255 .",
    "so we are left with large indexes @xmath256 , for which the approximation @xmath257 can be justified .",
    "the main tool behind this approximation is doob s inequality applied to the reversed martingale @xmath258 and now , due to this approximation , it is perfectly rigorous to condition on @xmath259 : since for @xmath256 , @xmath260 is independent of @xmath261 , we are exactly left with proving the result for the sequence of point processes @xmath262 with any converging sequence @xmath263 ( @xmath158 has to be thought as being equal to @xmath264 ) .",
    "if @xmath265 has a compact support , it is possible to conclude by applying a result from grigelionis  @xcite to show that this sequence of point processes converges to a poisson process with intensity @xmath266 . in the general case",
    ", the convergence is shown thanks to computations , by controlling the speed at which @xmath260 converge in law to an exponential random variable .",
    "this result together with standard poissonization techniques make it possible to prove the following theorem , which is the main result of this section .",
    "[ thm : random ] let @xmath267 . for @xmath244",
    ", @xmath268 converges in distribution to a poisson random variable with a random parameter @xmath246 when @xmath269 .",
    "again , only a sketch of the proof is given .",
    "the first step of the proof is to show the result for the random variable @xmath270 where @xmath271 is a poisson random variable with parameter @xmath0 , independent of everything else so far .",
    "the idea is that the law of @xmath270 is not sensitive to the fluctuations of @xmath271 around its mean value , equal to @xmath0 , so that the law of @xmath270 and of @xmath268 will have the same asymptotic behavior .    to show the convergence of @xmath270",
    ", we consider its generating function : for @xmath272 and @xmath273 , we can compute @xmath274 where @xmath275 , and @xmath276 for @xmath277 .",
    "then @xmath278 , so that we conclude with the previous proposition that @xmath268 converges to a random variable which , conditionally on @xmath62 , is a poisson random variable with parameter @xmath279 .",
    "the fact that @xmath268 and @xmath270 have the same asymptotic behavior ( in law ) then follows by standard arguments .",
    "this theorem readily yields the following corollary .",
    "the random variable @xmath280 converges in distribution to a random variable @xmath211 such that @xmath281 finally , if @xmath282 then , for the convergence in distribution , @xmath283    the fact that the parameter of the limiting poisson law is random has important effects , especially concerning the expectation .",
    "indeed , it stems from equation   and proposition  [ prop : asymptotic ] that @xmath284 is proportional to @xmath285 and @xmath286 if and only if @xmath287 .",
    "note in particular that the value @xmath288 plays a special role for our system .    for @xmath289 ,",
    "the mean value of @xmath268 diverges because it happens that a finite number of intervals ( actually , the @xmath290 first intervals ) capture most of the balls .",
    "this event happens with an increasingly small probability , so that in the limit as @xmath0 goes to infinity , it does not have any impact on our system .",
    "however , for a fixed @xmath0 , this event happens with a fixed probability as well .",
    "for instance , we commonly observed on various simulations for @xmath291 and @xmath292 that more than @xmath293 of the peers go to the first server , which is clearly an undesirable behavior of the system .",
    "in this section , a set of simulations of the file sharing principle is presented to test the different approximations made in this paper in term of urn and ball models .",
    "these simulations are in particular used to justify approximation  [ approx : heuristic ] , as well as to compare the insights into the dynamics of the system provided by the two urn and ball models studied in this paper . moreover ,",
    "another server selection policy is considered , namely when an incoming peer chooses the server at random .    throughout this section",
    ", we discuss the relevance of several random variables .",
    "the goal is to assess the accuracy of the procedure consisting of estimating the length of the first regime by using the random variable @xmath21 specified in definition  [ def : heuristic ] . for this purpose ,",
    "we define different times :    1 .",
    "@xmath294 is the first time when two servers are created and less than 2 peers have arrived .",
    "2 .   @xmath295 is the last time when there is an empty server .",
    "@xmath296 is the first time when the input rate is smaller than the output rate ( see section  [ sec : other_heuristics ] ) .",
    "4 .   @xmath297 the first time when a server becomes empty , i.e. , when a peer leaves a server where it was alone .",
    "we consider the corresponding quantities @xmath298 : for @xmath299 , @xmath298 is the index of the interval @xmath300 in which the event corresponding to @xmath301 happens . in particular , @xmath302 corresponds to definition  [ def : heuristic ] . in every simulation ,",
    "the averages of the quantities @xmath303 and @xmath304 are calculated for the value @xmath291 over @xmath305 iterations of the system which proved to be sufficient in term of numerical stability .",
    "the number of peers @xmath0 ranges up to @xmath306 .",
    "definition  [ def : heuristic ] specifies the variable considered throughout this paper to determine the duration of the first regime of the file sharing system .",
    "this variable was chosen for two reasons .",
    "first , it is a good indicator of the current equilibrium of the system : the output rate begins to be comparable with the input rate when only a few peers arrive between the creation of two successive servers .",
    "moreover , the stopping time defined in this way is mathematically tractable when transposed into the context of a certain urn and ball model . compared to  @xcite , it is interesting to note that we are actually able to rigorously prove results , and not only rely on simulation . as a byproduct ,",
    "the mathematical problems arising in this context are interesting in themselves .",
    "for the sake of completeness , several points need to be addressed .",
    "first , for how long is approximation  [ approx : heuristic ] valid ?",
    "since the random variable @xmath21 specified in definition  [ def : heuristic ] corresponds to @xmath307 , we argued in section  [ sec : modeling ] that this approximation holds until @xmath294 .",
    "this is the main assumption that makes it possible to cast our problem in terms of urns and balls , and to derive precise results on @xmath307 and @xmath308 .    in order to validate the results of section  [ sec : mathr ]",
    ", we check that @xmath309 and @xmath310 behave as predicted by theorem  [ thm : random ] . from this theorem",
    ", we expect to have @xmath311 for some constant @xmath312 , and @xmath313 . figure  [ fig : validation ] shows the graphs @xmath314 and @xmath310 versus @xmath315 : the straight lines depicted prove a good agreement with the theory . moreover , via a fitting procedure , one can compute the slopes of these lines : the results are summarized in table  [ tab ] .",
    "( -30,20)@xmath226    the values of interest in table  [ tab ] are in the row labeled `` min '' : we see that simulations exhibit a slope of @xmath316 for @xmath302 and of @xmath317 for @xmath294 , whereas the theory predicts @xmath318 in both cases ( because @xmath319 ) .",
    "these results are in good agreement with approximation  [ approx : heuristic ] , which justifies the fact that we can use this approximation up to time @xmath294 .      in this section ,",
    "we compare the random and deterministic urn and ball models with @xmath320 , the expected value of the last time when there is an empty server .",
    "it clearly appears in figure  [ fig : empty_servers ] that @xmath321 closely corresponds to the shift in equilibrium of the system , and this fact has been observed in numerous simulations .",
    "however , as we will see in the following , approximation  [ approx : heuristic ] does not hold until time @xmath295 , which explains why it is very challenging from a mathematical point of view to derive results on @xmath295 .",
    "( note in addition that @xmath295 is not a stopping time ) .",
    "figure  [ fig : hindsight ] shows that @xmath294 is much smaller than @xmath295 : this result is nevertheless not surprising .",
    "indeed , as discussed in section  [ sec : model ] , results obtained for the random model point out a local behavior : the first empty urn arrives in a region , where still many peers arrive in each interval .",
    "although many peers should arrive in this time interval , this is in reality not the case because a very small interval is generated .",
    "thus , in some sense , the order of magnitude @xmath144 provided by the random urn and ball model is misleading for the initial system .",
    "( -45,115)@xmath322 ( -48,101)@xmath323 ( -45,90)@xmath324 ( -220,20 ) ( -10,20)@xmath0    in the deterministic model , the sizes of urns are not random , and the stochastic fluctuations arising in the random model do not occur .",
    "the deterministic model smooths the local behavior that appears in the random model , and the order of magnitude @xmath325 gives more insight into the global situation of the system .",
    "when only a few peers arrive in an interval , it really means that the equilibrium begins to shift .",
    "one can check in figure  [ fig : hindsight ] that the theoretical result @xmath326 defined by equation   predicted by the deterministic model is closer to to @xmath295 than to @xmath294 .",
    "although considering the deterministic model indeed improves the approximation , @xmath295 still seems much larger that @xmath326 .",
    "however , thanks to our urn and ball models , we know that the first order approximation of the times @xmath304 is logarithmic , whereas the first order approximation for the indexes @xmath303 is polynomial .",
    "table  [ tab ] provides useful information to understand the situation .",
    "first , the deterministic model yields a reasonable estimate of the exponent in @xmath327 : simulations give @xmath328 and the deterministic model @xmath329 .",
    "note that the random model predicts @xmath318 , so a substantial improvement in accuracy is obtained when using the deterministic model .",
    "this suggests that approximation  [ approx : heuristic ] holds until @xmath326 , i.e. , up to times of order @xmath130 .",
    "second , we observe a significant discrepancy between the exponent for @xmath330 and the coefficient of @xmath295 : if approximation  [ approx : heuristic ] were to hold until @xmath331 , one would have @xmath332 , which would yield , because @xmath333 , that @xmath334 .",
    "however , we find that the time @xmath295 is better approximated by @xmath335 , and so approximation  [ approx : heuristic ] does not hold until time @xmath295 .",
    "this clearly poses the challenge to derive asymptotic results for @xmath295 .",
    "moreover , this triggers another interesting question : for how long does approximation  [ approx : heuristic ] hold ? we give a partial answer to this question by considering the times @xmath296 and @xmath297 in the next section .      throughout this paper",
    ", we have tried to estimate the time when the equilibrium of the system begins to shift . as long as approximation  1 holds , the input rate @xmath336 of the system is the number of peers , that are not active at time @xmath337 , times @xmath1 , while the output rate @xmath338 is just the number of servers at time @xmath337 ( since the service has mean one ) .",
    "initially , @xmath339 and @xmath340 , and @xmath341 and @xmath342 . to study the time at which the equilibrium of the system begins to shift , it is therefore very natural to consider the first time @xmath296 at which @xmath343 , i.e. , when the number of servers is greater than @xmath1 times the number of non - active peers .",
    "as shown in the following , considering this time leads to the order of magnitude given by the deterministic model ( with less precise asymptotics of course ) .    for times",
    "@xmath344 , we assume that approximation  [ approx : heuristic ] holds , so that we can cast @xmath345 in terms of our urn and ball problem .",
    "let @xmath346 be the number of balls that fall in the @xmath347 first intervals : @xmath348 the index @xmath349 then corresponds to @xmath350 the asymptotic behavior of @xmath351 when @xmath347 goes to infinity with @xmath0 is easy to derive : @xmath352 therefore @xmath353 for @xmath354 , i.e.@xmath345 is of order @xmath130 , which is the same order of magnitude as in the deterministic model .",
    "rigorous mathematical analysis could be done to prove this result , but in our view , considering @xmath294 has one main advantage : proposition  [ prop : heuristic ] is almost a rigorous justification of approximation  [ approx : heuristic ] .",
    "when considering another time , in particular @xmath296 , we were not able to provide such a strong justification . and as we have seen in the case of @xmath295 , approximation  [ approx : heuristic ] does not hold for the whole first regime , and a strong justification as proposition  [ prop : heuristic ] is therefore very valuable .    finally , let us give some brief results on @xmath297 , the first time when a server empties .",
    "simulations show that @xmath355 and @xmath297 have similar behavior as before ( polynomial and logarithmic growths , respectively ) .",
    "results in table  [ tab ] show that the slope for @xmath297 is similar to the exponent of @xmath356 , suggesting that approximation  [ approx : heuristic ] holds until @xmath297 .",
    "in conclusion , approximation  [ approx : heuristic ] holds at least until @xmath130 , which corresponds to @xmath294 and @xmath296 .",
    "however , it does not hold until @xmath357 , whereas figure  [ fig : empty_servers ] shows that until @xmath295 , the system is still in the first regime . for the particular value @xmath291",
    ", we have @xmath358 and simulations show that @xmath359 , and so our approximation by the means of a urn and ball problem is not so far from the exponent that we want to capture .",
    "proposition  [ prop : heuristic ] shows that until @xmath145 , there are only few empty servers : so between @xmath326 and @xmath295 , it could happen that there is a fraction of empty servers , and although this fraction is small , it has an impact on the system .",
    "similar phenomenon have been observed in sanghavi  @xcite .    to conclude this section , we discuss a different routing policy . throughout this paper , we have considered the policy where an incoming peer selects the least loaded server , in terms of number of peers .",
    "this policy is compared against the random one , where an incoming peer selects a server uniformly at random among all possible servers .",
    "simulations show that these policies are very close as shown in figures  [ fig:23 ] , [ fig:25 ] and  [ fig:24 ] .",
    "the only noticeable difference is concerning @xmath360 , cf .",
    "figure  [ fig:26 ] .",
    "however , table  [ tab ] shows that the exponents of @xmath361 are very similar in the random and in the minimum policy .",
    "one can easily check that they are indeed proportional one to another .",
    "( -190,-100 ) ( -30,-110)@xmath0    ( -190,-100 ) ( -30,-110)@xmath0    ( -210,-130 ) ( -30,-130)@xmath0    ( -210,-130 ) ( -30,-130)@xmath0    table  [ tab ] shows that for the first time when a server becomes empty , the policy has a great influence .",
    "this is easily understandable : in the min case , it is much harder for a server to become empty , because least loaded servers are selected by incoming peers .",
    "the simulations moreover underlined the existence of a second regime during which although the fraction of idle servers is small , the output rate is no longer as high as possible .",
    "this second regime is then followed by a third regime during which the capacity offered by the system exceeds by far the input rate , and so the system mainly creates empty servers .",
    "our urn and ball approach can no longer be applied to these two regimes , and so they will be studied in the near future using other probabilistic techniques .",
    "a possible extension of our results consists of incorporating the possibility for a peer to leave the system right after completing its download . in terms of urn and ball",
    ", this just amounts to change the parameter that defines the length of the @xmath10-th interval : instead of @xmath10 , one would just have to consider @xmath362 if @xmath363 is the probability for a peer to become a server after completing its download . an extended model where the file is split into different chunks essentially amounts to study a multi - class queueing network with a random number of servers of different classes which proves to be a much more difficult problem .",
    "finally , a natural extension is to consider a general service distribution , instead of the exponential one . in this case",
    ", the process of creation of servers can be described as an age - dependent branching process , and more precisely a binary bellman - harris branching process .",
    "see athreya  @xcite .",
    "if this setting complicates significantly the analysis of the file sharing system , it seems that most of the results obtained in the exponential case should still hold .",
    "alexander gnedin , ben hansen , and jim pitman , _ notes on the occupancy problem with infinitely many boxes : general asymptotics and power laws _ , probability surveys * 4 * ( 2007 ) , 146171 ( electronic ) . mr mr2318403"
  ],
  "abstract_text": [
    "<S> we investigate in this paper the performance of a simple file sharing principle . for this purpose , we consider a system composed of @xmath0 peers becoming active at exponential random times ; the system is initiated with only one server offering the desired file and the other peers after becoming active try to download it . </S>",
    "<S> once the file has been downloaded by a peer , this one immediately becomes a server . to investigate the transient behavior of this file sharing system , we study the instant when the system shifts from a congested state where all servers available are saturated by incoming demands to a state where a growing number of servers are idle . in spite of its apparent simplicity , this queueing model ( with a random number of servers ) </S>",
    "<S> turns out to be quite difficult to analyze . </S>",
    "<S> a formulation in terms of an urn and ball model is proposed and corresponding scaling results are derived . </S>",
    "<S> these asymptotic results are then compared against simulations .    [ modeling techniques </S>",
    "<S> , performance attributes ] </S>"
  ]
}