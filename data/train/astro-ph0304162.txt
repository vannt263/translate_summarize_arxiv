{
  "article_text": [
    "only for very special lens models can numerical methods be avoided in gravitational lensing studies .",
    "there are three essential reasons for that .",
    "one is the non - linearity of gravitational lensing , i.e.  the fact that image and source positions are related to one another in a non - linear fashion .",
    "this gives rise to the well - known phenomena of mutiple imaging , strong image distortions , and so forth .",
    "the second reason is that lenses exist which are themselves best described by numerical models .",
    "galaxy clusters are one example , lensing by large - scale structures is another .",
    "although it is true that many aspects of gravitational lensing by large - scale structures can be derived analytically , detailed simulations require numerical techniques .",
    "the third reason is that the interpretation of gravitational lensing effects or events often require the application of sophisticated algorithms to ever growing amounts of data .",
    "one example is the reconstruction of the projected mass density distribution of a galaxy cluster from the observed image distortions due to gravitational shear .",
    "needless to say , there are many more aspects of numerical methods related to gravitational lensing than i can cover in this review .",
    "an outstanding example are the highly elaborate methods that have been developed over recent years for determining image shapes of faint background galaxies on ccd frames , and for extracting the gravitational shear signal from them .",
    "this is a whole branch of data analysis on its own .",
    "here , i can only deal with numerical methods for relating mass distributions to their gravitational lensing effects .",
    "consequently , the outline of this lecture is as follows : first , i shall discuss methods for studying individual lenses , i.e.  their imaging properties , their critical curves and caustics . in particular , the use of adaptive grids and techniques for searching and characterising images will be discussed .",
    "second , i shall describe how extended lenses can be treated numerically using the multiple - lens plane theory .",
    "this will lead to the basic equations for tracing light rays through ( simulated ) cosmological volumes .",
    "a large fraction of the discussion will be devoted to issues of resolution and noise , and to spurious effects in simulated lensing statistics .",
    "finally , third , i shall describe inversion techniques , i.e.  methods for reconstructing the projected mass distribution of lenses whose distortion has been measured .",
    "the classic kaiser - squires method will be described , and also maximum - likelihood techniques and maximum - entropy methods .",
    "general lensing theory and the theory of weak lensing are covered by koenraad kuijken s and peter schneider s lectures in this volume .",
    "basic references on lensing include the textbook by schneider et al .",
    "( 1992 ) and the lecture by narayan & bartelmann ( 1999 ) , reviews of weak lensing are mellier ( 1999 ) and bartelmann & schneider ( 2001 ) .",
    "a brief reminder of the basic assumptions underlying the theory of individual lenses may be in order .",
    "there are three main assumptions . first , the newtonian gravitational potential of the lens be small , @xmath0 .",
    "second , velocities in the gravitational lens system , both of constituents within the lenses and of the lenses with respect to the rest frame of the microwave background , be small @xmath1 .",
    "third , the extent of the lenses along the line - of - sight be small compared to the other distances in the system , which are usually cosmological and thus comparable to the hubble radius , @xmath2 , with @xmath3 being the hubble constant and @xmath4 .",
    "it is worth noting how well these assumptions are satisfied in ordinary lensing situations . consider a galaxy cluster with mass @xmath5 .",
    "assuming spherical symmetry , the newtonian potential at a distance @xmath6 from its centre is @xmath7 evidently much smaller than the speed of light squared .",
    "a typical length scale for the radius of a galaxy cluster is @xmath8 , which is several hundred times smaller than typical distances in a cluster - lensing system .",
    "finally , peculiar velocities of galaxy clusters with respect to the hubble flow are of order several hundred @xmath9 , and typical velocities of galaxies within galaxy clusters reach of order @xmath10 , but both velocities are way below the speed of light .",
    "the above assumptions hold even better for lensing by galaxies , of course",
    ".    we can thus safely assume the above conditions to be satisfied .",
    "it is then possible to project the lensing mass distribution onto a plane perpendicular to the line - of - sight , the lens plane , and describe it by its surface mass density @xmath11 .",
    "sources are assumed to be located on a corresponding plane , the source plane .",
    "a typical lens system is sketched in fig .",
    "[ fig:1 ] .     between the observer and the lens , the observer and the source , and between the lens and the source , respectively .",
    "due to space - time curvature , these distances are generally not additive . ]    the three distances @xmath12 shown in fig .",
    "[ fig:1 ] and explained in its caption are generally not additive because of space - time curvature , thus @xmath13 in contrast to flat space - time .",
    "let us now introduce physical coordinates @xmath14 and @xmath15 on the lens and source planes , respectively . alternatively , it is often convenient to introduce angular coordinates @xmath16 and @xmath17 , which are obviously related to @xmath14 and @xmath15 through @xmath18 dimensional coordinates are of course not suitable for numerical calculations , which can only handle numbers .",
    "we thus have to introduce a length scale @xmath19 , or alternatively an angular scale @xmath20 , in the lens plane .",
    "this length scale is so far _ arbitrary_. it implies a length or angular scale @xmath21 in the source plane .",
    "dimension - less coordinates are then defined by @xmath22 in the lens and source planes , respectively .",
    "the numerical code will have to deal with the dimension - less vectors @xmath23 and @xmath24 .",
    "it helps numerical accuracy greatly if these numbers are of order unity .",
    "thus , the first challenge in setting up a lensing simulation is to choose an appropriate length- or angular scale @xmath19 or @xmath20 , which should both be adapted to the physical problem at hand , and to the requirement that numerical codes work most accurately if the numbers they are dealing with are neither too large nor too small , compared to machine accuracy . choosing unappropriate length scales can , for instance , render image searches unsuccessful",
    ".      it will be convenient for the following discussion to introduce the lensing potential @xmath25 as the basic physical quantity for lensing studies .",
    "it is the scaled , projected newtonian gravitational potential of the lens , @xmath26 the so - called _ reduced _",
    "( i.e.  appropriately scaled ) deflection angle is the gradient of the potential , @xmath27 and the lensing convergence ( i.e.  the appropriately scaled surface - mass density ) is @xmath28 finally , the gravitational tidal field is described by the two - component shear , @xmath29 where the convention was used that @xmath30 is the derivative of the @xmath31-th component of @xmath32 with respect to the coordinate @xmath33 .",
    "it is important to note that the fact that all lensing quantities can be derived from the scalar lensing potential establishes relations between all of them .",
    "this will be exploited several times later .",
    "note that the lensing quantities must be rescaled in case the coordinate scale @xmath19 is changed .",
    "suppose @xmath34 is introduced instead of @xmath19 .",
    "since the physical surface - mass density of the lens must remain the same at any given physical location , the reduced deflection angle must transform as @xmath35 and convergence and shear transform as @xmath36=    \\left(\\frac{\\xi_0'}{\\xi_0}\\right)^2\\ ,    \\left[\\kappa(\\vec",
    "x)\\,,\\,\\gamma_i(\\vec x)\\right]\\;. \\label{eq:10}\\ ] ]      suppose now we were given some description of the lensing potential @xmath37 , or of the deflection angle @xmath38 .",
    "this description could be an analytical formula , or it could be in form of an array , i.e.  a set of numbers given at grid points @xmath39 .",
    "we wish to know how the given lens images its background .",
    "we introduce a coordinate grid @xmath40 on the lens plane subject to the condition that it be sufficiently well resolved .",
    "this means that the smallest features in the lens must be covered by at least a few grid points .",
    "since we are given the deflection angle as a function of position , we can compute a deflection - angle grid , @xmath41 .",
    "the mapped grid on the source plane is then simply @xmath42 .",
    "this mapped grid will appear as a distorted image of the regular grid in the lens plane , as the example in the left panel of fig .",
    "[ fig:2 ] shows .",
    "the mapping process must now be reversed in order to obtain an image created by the lens .",
    "for doing so , the _ source _ plane is first covered with a regular grid , @xmath43 .",
    "next , we loop over all grid points @xmath40 in the _ lens _ plane and find its mapped source point @xmath44 in the source plane , and search for the nearest neightbours @xmath45 surrounding @xmath44 in the source plane .",
    "this is illustrated in the right panel of fig .",
    "[ fig:2 ] .",
    "the surface brightness of the source , known at the positions @xmath45 , can then be interpolated to @xmath44 and the result assigned to the image point @xmath40 .",
    "that way , the surface brightness at all points in the lens plane can be determined , and thus the lensed image be constructed .",
    "[ fig:3 ] shows an example .",
    "the left panel of the figure shows a simulated cmb temperature fluctuation field of @xmath46 angular size .",
    "the temperature increases from white to red .",
    "in essence , the temperature fluctuation corresponds to a fairly smooth gradient across the field .",
    "the right panel shows the gravitational lensing signature imprinted on the cmb at such angular scales by a galaxy cluster .",
    "the temperature visible at an angular position @xmath16 on the sky , @xmath47 , is related to the intrinsic temperature @xmath48 through @xmath49 $ ] .",
    "thus , the light deflection by the cluster causes the visible temperature distribution to be rearranged , yielding a highly specific pattern ( seljak & zaldarriaga 2000 ) .",
    "as mentioned in the introduction , the deflection - angle field contains full information on the lensing mass distribution .",
    "all other quantities like convergence and shear , but also image magnifications , follow from the deflection angle via differentiation .",
    "it is thus a common task to compute numerical derivatives .",
    "suppose a function @xmath50 is tabulated on a grid , so that we are given the values @xmath51 at the grid points @xmath40 .",
    "the derivative of @xmath50 at a particular point @xmath52 in the first coordinate direction is approximated by @xmath53 where @xmath54 is the separation of the grid points in the chosen direction ; cf .",
    "the left panel of fig .",
    "[ fig:4 ] .",
    "this centred difference has the advantage compared to the more straightforward one - sided differences @xmath55 or @xmath56 of being second - order in the grid separation @xmath54 .",
    "there are higher - order differencing schemes using function values at more than two grid points , but the second - order scheme is usually sufficient .",
    "no lensing quantity should vary strongly between two adjacent grid points because otherwise the resolution of the grid would be grossly insufficient .",
    "we will typically need derivatives of the deflection angle @xmath57 . since @xmath57 is itself the gradient of a scalar potential",
    ", its derivatives must satisfy @xmath58 .",
    "it is thus usually preferable to check that this relation is satisfied within numerical accuracy , and to use @xmath59 instead of either @xmath60 or @xmath61 alone .",
    "critical curves in the lens plane are defined by the condition that the jacobian determinant of the lens mapping vanish there , @xmath62 .",
    "the elements of the jacobian matrix are @xmath63 , thus the jacobian determinant is @xmath64 it can be computed once the ( numerical ) derivatives of the both deflection - angle components have been determined .    one method of identifying grid points in the lens plane next to the critical curve proceeds as follows .",
    "let @xmath65 , and consider one particular grid point @xmath52 in the lens plane .",
    "the point is next to the critical curve if , and only if , the sign of the jacobian determinant changes between it and one or more of its nearest neighbours .",
    "hence , if the condition @xmath66 is satisfied , the grid point @xmath52 is next to a critical curve ( cf .",
    "the right panel of fig .",
    "[ fig:4 ] ) . of course",
    ", @xmath52 is not itself _ on _ the critical curve , but to the positional accuracy determined by the grid resolution , the position of the critical curve can be constrained that way .",
    "points on the source plane next to the caustic curve are then easily found via the lens equation , @xmath67 , where the @xmath68 are the grid points in the lens plane next to critical curves .    as an example , consider a lens model for a spiral galaxy , consisting of a spherical halo and a flat disk seen almost edge - on ( bartelmann & loeb 1998 ) .",
    "the deflection - angle field of such a lens can be given analytically ( cf .",
    "keeton & kochanek 1998 ) .",
    "convergence and total shear @xmath69 as determined by numerical differentiation are shown together with the modulus of the deflection angle in fig .",
    "[ fig:5 ] .",
    "the critical curves and caustics of that lens model as determined with the method described above are shown in fig .",
    "[ fig:6 ] .    .,title=\"fig : \" ] .,title=\"fig : \" ]      one of the most prominent goals of gravitational lensing studies with individual strong lenses is to determine the imaging statistics of a given lens model , for example the abundance of highly magnified events , the occurrence of multiple imaging with the images satisfying certain conditions , and the like .",
    "this is done in principle by distributing many sources across the source plane , imaging them as described before , and determining the image properties .",
    "however , such events are rare .",
    "if one were to cover the entire source plane with a regular grid of sources , this grid would have to have a very high resolution for rare events to be reliably found . in turn , most of the sources probed would produce images failing the criteria imposed , so by far the largest fraction of the cpu time used would be wasted .",
    "this situation calls for adaptive grids . we know in advance that any strongly lensed image will occur near a critical curve , or any strongly lensed source near a caustic .",
    "it is those sources that we need to treat in detail , while those far from caustic curves are usually only required to normalise the statistics properly .",
    "one approach for defining an adaptive grid , and there may be others more suitable for a particular lensing situation , proceeds as follows . again",
    ", we assume that we know the deflection angle of the lens , either because it was provided numerically or because it is described by a known analytic formula .",
    "then , we saw in the preceding subsection how grid points can easily be identified which are close to a critical curve in the lens plane , or a caustic curve in the source plane .    in order to save computational time ,",
    "the source plane is first covered with a coarse grid .",
    "this grid should obviously be fine enough for the caustics to be properly resolved ; for instance , it must not be so coarse that the typically two types of caustic curve , the radial and the tangential one , are closer than a few times the grid separation .",
    "next , those points on that coarse grid are identified and saved which are next to a caustic curve .",
    "this can , for instance , be done by masking , i.e.  by attaching a logical variable to all grid points and setting it to either _ true _ or _ false _ depending on whether it is or is not next to a critical curve .",
    "one can then cover the source plane with a grid whose resolution is doubled in both dimensions , and keep only those points which are identical with , or surrounded by , points of the coarse grid which were masked in the preceding step .",
    "this procedure can be repeated as often as desired , i.e.  until the finest grid level reaches the ultimately required resolution .",
    "note that it is not the grids and their masks which need to be saved , but only the coordinates of those grid points which are either part of the coarse initial grid , or whose logical mask values are _ true_. that way , lists of source positions can be constructed which are to be probed later for the images they give rise to .",
    "naturally , this can only be a basic recipe which needs to be adapted to the situation at hand .",
    "for instance , the condition that grid points need to be next to a caustic can be replaced by the condition that the absolute value of the jacobian determinant be less than a given threshold which can be lowered at each step of grid refinement .",
    "such a criterion would naturally increase the grid resolution near such grid positions where sources are certain to be highly magnified .    of course",
    ", if statistics is the ultimate goal , one has to take into account that sources near caustic curves were positioned such as to have an unfair advantage over sources far from caustics .",
    "since we have chosen to double the grid resolution at each refinement step , each source on a refined grid represents only a quarter of the area on the source plane represented by a source on the next coarser grid .",
    "assigning a statistical weight of unity to the sources on the finest grid , the weight must quadruple for each coarser level .",
    "if the grid was refined @xmath70 times , the weight of sources on the coarsest grid is thus @xmath71 .",
    "each source is assigned a statistical weight @xmath72 in that way , and counts @xmath72 times in the final statistical evaluation .",
    "the left panel in fig .",
    "7 shows the source locations chosen for evaluating image statistics of the spiral lens model illustrated in fig .",
    "[ fig:6 ] .",
    "the principle of finding the images of a given source is simple : given a source at position @xmath73 , find those grid points @xmath74 on the lens plane which are mapped sufficiently close to @xmath75 , i.e.  whose mapped points @xmath44 are within a specified distance from @xmath73 .",
    "the problem with this approach is that a square - shaped or rectangular grid cell from the image plane is mapped onto a distorted figure in the source plane . in most cases",
    ", this figure will be a parallelogram , but in rare cases , opposing corners of the original rectangle may even be interchanged on the source plane .",
    "how can it then be decided whether a given point in the source plane is inside or outside the mapped grid cell , or in other words , whether the image of the given source falls within that particular grid cell on the lens plane ?    the solution is to split each grid cell in the lens plane into two triangles , because a mapped triangle always remains a triangle , which always has a well - defined interiour ( cf .",
    "schneider et al .  1992 ) .",
    "for the shown vectors @xmath76 are positive . ]    consider fig .",
    "[ fig:8 ] .",
    "the three grid points marked on the lens plane in the left panel of the figure are mapped to the distorted triangle shown on the right panel , which contains the source position .",
    "call @xmath77 the three vectors from the mapped triangle s corners towards the source position .",
    "it can be shown that the source is inside the mapped triangle if the three vector products @xmath78 are all positive , with the vector product in two dimensions being defined as @xmath79    one straightforward way to verify this condition is to convince one s self that the source point is inside the triangle if all vectors @xmath80 point within the angles spanned by the adjacent sides of the triangle , and that this condition translates to eq .",
    "( [ eq:14 ] ) above .",
    "this algorithm for finding images works well as long as the separation between images is larger than the size of the grid cells in the lens plane .",
    "very close images can be contained within the same grid cell , in which case the algorithm would find only one .",
    "of course , this potential problem can be remedied by increasing the grid resolution , but then a very large number of grid cells would have to be checked in vain for containing an image .    again , a viable solution uses adaptive grids",
    ". one can start with a coarse grid on the lens plane .",
    "searching for images on that coarse grid will almost certainly not yield all images of a multiply imaged source , but those missed will be closer than the grid separation to those found . then , those grid cells containing images can individually be covered with a highly resolved grid , and the image search repeated on those sub - grids .",
    "hence , the first step represents a coarse scan of the lens plane for grid cells containing at least one image , and the second step scans only those regions on the lens plane in detail where images are sure to be found .",
    "if needed , further sub - grids can be similarly nested .",
    "of course , even though this procedure is highly adaptive and efficient , it always has a remaining resolution limit , and images closer than that will not be resolved .",
    "it is then important to adapt the resolution of the finest sub - grid to the situation at hand , for instance such that remaining unresolved images would neither be resolved by observations .",
    "the right panel in fig .",
    "[ fig:7 ] illustrates the result of an adaptive image search for all sources at the positions shown in the figure s left panel .",
    "colours denote image numbers : black means one image , blue three , and red five , while green shows source positions for which an even number of images has been found , in contradiction to the necessarily odd image number produced by non - singular lenses .",
    "such events are rare , but they do occur because of the finite resolution limit of the algorithm applied .",
    "figure  [ fig:9 ] gives an example for possible results of that adaptive technique for finding images .",
    "colour - coded is the total magnification of point sources in the source plane behind the almost edge - on spiral lensing galaxy introduced above .",
    "the increasing spatial resolution towards the caustic curves is evident .",
    "the panel inserted into the figure shows caustics ( blue ) and critical curves ( red ) of the lens , the source position as a blue dot just inside the right - hand `` naked '' cusp , and the three images as red hexagons whose size logarithmically encodes the image magnification .",
    "so far , we have used a model for a spiral galaxy as an example for a complex lens whose properties need to be determined numerically . despite its complexity , the model is still highly symmetric ; and what is more , its deflection angle is given as an analytic formula .",
    "sources were so far assumed to be point - like .",
    "let us now increase the level of complexity and use a numerically simulated galaxy cluster to gravitationally lens extended sources .",
    "again , we assume the deflection angle to be given and postpone the question as to how it can be determined from an @xmath70-body simulation .",
    "all techniques described above for computing convergence and shear from the deflection angle , for finding critical curves and caustics , for placing sources on an adaptive grid , and for finding images within grid cells split into triangles remain valid unchanged .",
    "figure  [ fig:10 ] shows an example .",
    "the modulus of the cluster s deflection angle is shown as the colour plot in the left panel .",
    "the right panel shows a section of the source plane with the dots marking source positions , and their colour illustrating the image number .",
    "black , blue and red means one , three , or five images , respectively .",
    "the caustic structures can clearly be identified as the boundaries between black and blue and between blue and red , respectively .",
    "extended sources can be described in a variety of ways .",
    "what follows is a simple description for elliptical sources , but alternative source models can easily be constructed along similar lines .",
    "we assume that source positions @xmath73 have already been found , preferentially on an adaptive grid as described before . also , we need to be sure that the grid resolution in the source plane is sufficiently high as to resolve the smallest sources to be considered .",
    "elliptical sources are described by three more parameters , viz .",
    "their size , their ellipticity , and their position angle @xmath81 .",
    "let us describe the ellipticity by @xmath82 , with @xmath83 and @xmath84 being the semi - major and semi - minor axes of the ellipse , respectively .",
    "finally , we introduce an effective radius @xmath85 by demanding that a circle of radius @xmath85 have the same area as the ellipse , hence @xmath86 . by rotating by an angle",
    "@xmath81 an ellipse centred on the coordinate origin whose axes are aligned with the coordinate axes , it can straightforwardly be shown that a grid point @xmath44 is enclosed by the ellipse if the condition @xmath87 is satisfied , where @xmath88 .",
    "if the grid point @xmath40 , whose image in the source plane is @xmath44 , satisfies eq .",
    "( [ eq:16 ] ) , the image point @xmath40 is part of the source , and the image can be constructed by assigning the source s surface brightness at @xmath89 to the image point @xmath40 . by mapping the entire lens plane onto the source plane and checking eq .",
    "( [ eq:16 ] ) for each individual imaged grid point @xmath44 , all image points belonging to the given source can be identified .",
    "it is often desired for statistical purposes to automatically characterise a large number of images .",
    "an example is the determination of cross sections for the formation of large gravitational arcs by a numerically simulated galaxy cluster , for which a large number of sources need to be imaged and the image properties automatically quantified to search for the rare `` giant '' arcs .",
    "most of the methods described here have been introduced and used extensively e.g.  by bartelmann & weiss ( 1994 ) , bartelmann et al .",
    "( 1995 , 1998 ) , meneghetti et al .",
    "( 2000 , 2001 ) ; see also the contribution by massimo meneghetti to this volume .",
    "a source may have multiple images , thus the point sets in the lens plane found by imaging extended sources need not be connected .",
    "the first step is therefore to group the image points into images .",
    "this can be done with a variant of the classical friends - of - friends algorithm : pick one arbitrary point out of any given set of image points and search for another image point which is at most @xmath90 grid units away from the first point ; @xmath54 is the grid size in the lens plane .",
    "if there is such a point , it is called a `` friend '' and grouped into the same image as the first point .",
    "now take the `` friend '' and repeat until no further `` friends '' can be found and the image is complete .",
    "if more image points are left on the lens plane , pick one of those and repeat the process until all image points have been grouped .",
    "if the image is large enough , and the grid resolution on the lens plane is high enough for the image to consist of many points , the image magnification is simply the ratio between the numbers of pixels covered by an image and the number of pixels covered by the source .",
    "once all image points belonging to a single image have been identified , it is often useful to determine the boundary points of that image , e.g.  by identifying those points inside an image which have a neighbour outside the image . by suitably ordering the boundary points , a boundary line can be found whose length can be measured and used in further steps of the automatic image classification .",
    "next , the curvature of the image can be found by first identifying the image point which of the source centre , then search for the boundary point most distant from the so - defined image centre , and finally searching for the boundary point most distant from the first boundary point .",
    "these three points uniquely define a circle whose radius can be used as an approximation for the arc radius . and so on , you get the drift : once image points are grouped into individual images and boundary curves have been determined , images can be classified by adapting elementary geometrical figures to them .",
    "so far we have assumed to be given the deflection angle either as an analytic expression or as two two - dimensional arrays of numbers giving its two components as a function of position in the lens plane .",
    "we now need to describe methods for obtaining the deflection angle of a numerically simulated lens .",
    "the first issue to be discussed is the spatial resolution .",
    "since the simulated lens is composed of discrete particles which represent a smooth mass distribution in reality , the deflection angle must not be computed by simply summing up the deflection angles of the individual particles : the result would be a collection of microlenses rather than a single macrolens , having many spurious and undesired imaging features .    rather , the collection of particles has to be projected onto a lens plane , on which it needs to be smoothed in some way .",
    "we will return later to the issue of how particles should be sorted into grid cells .",
    "an important point to be addressed before is how large the grid cells should be chosen .",
    "they should be small enough for important features of the lens to remain identifiable ; they should be large enough for the surface density to lose the `` graininess '' due to its being composed of individual particles , and they should be large enough so that poisson errors are smaller than a certain threshold .",
    "if the number of particles per grid cell is @xmath91 , its poisson fluctuation is @xmath92 , thus the discreteness of the particles gives rise to fluctuations in the surface - mass density .",
    "demanding that the relative fluctuations of the density should be smaller than @xmath93 , the cell size @xmath54 has to be chosen such as to satisfy @xmath94 .",
    "it is impossible to give a general rule applicable to the majority of lensing situations , but it is clear that resolution , smoothing and particle noise have to be carefully balanced by choosing the grid cell size appropriately .",
    "assigning particle masses to grid points in order to obtain a smooth density distribution is an art of its own ( cf .",
    "hockney & eastwood 1988 ) . in principle , the particle mass could simply be attributed to the single grid point next to its position .",
    "this `` nearest grid point '' ( ngp ) method is appropriate for particles near the centre of a cell , but particles near cell boundaries should be attributed to the cell and its neighbour(s ) in order to avoid boundary effects like density discontinuities .",
    "numerous schemes for interpolating particles across cells have been proposed .",
    "they are generally of the form @xmath95 where @xmath96 is the quantity to be interpolated onto a point @xmath23 , e.g.  the particle mass , the sum extends over all particles sufficiently close to the point of interest @xmath23 , and @xmath97 is a smoothing or interpolation kernel depending on the separation vector between the particle position @xmath98 and @xmath99 .",
    "the kernel is decomposed into three factors directions , @xmath100 one for each dimension , the @xmath31-th of which depends only on the @xmath31-component of the separation vector .",
    "interpolation methods can now be classified according to the kernel factors @xmath101 and their width .",
    "the `` cloud - in - cell '' ( cic ) scheme uses the kernel factors @xmath102 which implies that the particle is distributed over the four nearest grid points .",
    "a more elaborate scheme is the `` triangular shaped cloud '' ( tsc ) method , which uses the kernel factors @xmath103 the cic and tsc interpolation schemes are illustrated for two dimensions in fig .",
    "[ fig:11 ] . for all schemes ,",
    "the kernel has to be normalised such that all particle mass fractions add up to unity .",
    "suppose now we have obtained the surface mass density on a grid @xmath104 , then the deflection angle can most straightforwardly be determined by direct summation as @xmath105 depending on the number of grid cells , the direct summation can be prohibitively slow . in many circumstances of astrophysical interest , fast - fourier techniques",
    "can then be applied . in order to see how this works ,",
    "note that the deflection angle can be written as a convolution of the convergence @xmath106 with a kernel @xmath107 this allows the fourier convolution theorem to be applied , which holds that the fourier transform of a convolution is the product of the fourier transforms of the functions to be convolved , hence @xmath108 the fourier transform of the kernel @xmath109 can be determined and tabulated once .",
    "using fast - fourier techniques to determine the fourier transform of the convergence @xmath110 requires the convergence to be periodic on the lens plane . in many cases ,",
    "this can be safely assumed or arranged .",
    "often , lens planes are constructed from large - scale @xmath70-body simulations which have periodic boundary conditions by design , or the lens is an isolated object like a galaxy cluster , which can be surrounded by a sufficiently large field for the convergence to drop near zero everywhere around the edges of the field .",
    "fast - fourier methods speed up the computation of the deflection angle considerably .",
    "if necessary , derivatives of the deflection angle field can also be determined in fourier space .",
    "once the convergence has been fourier transformed , one can employ the two - dimensional poisson equation to compute the fourier transform of the lensing potential , @xmath111 from which the fourier transforms of the deflection angle and the shear components can easily be determined , @xmath112 relations like those and the exploitation of fast - fourier methods are particularly relevant for simulating gravitational lensing by large - scale structures .",
    "obviously , the thin - lens approximation that we have been using so far breaks down if one wishes to study gravitational lensing by large - scale structures .",
    "the solution then is to cover the complete cosmic volume whose lensing effects one wants to simulate with simulation boxes stacked along the line - of - sight , to project suitable slices on individual lens planes , and to use multiple lens - plane theory for describing light propagation .",
    "the multiplicity of lens planes , and the general weakness of lensing by large - scale structures , make questions of angular and mass resolution particularly relevant for cosmic lensing . for instance",
    ", lens planes close to the observer are typically poorly resolved because even small grid cells span a large solid angle near the observer , and making grid cells smaller is not generally an acceptable solution because then the number of particles per grid cell becomes small , and the shot noise possibly unacceptably large .",
    "however , lens planes near the observer are less efficient than lens planes approximately half - way to the source because the lensing efficiency function is zero at the observer and source redshifts and peaks in between .",
    "yet , structures grow over time , thus the lensing efficiency function is skewed towards lower redshifts because structures are geometrically less efficient lenses , but their density contrast keeps growing . by a related argument , sources at very high redshifts do not require the entire cosmological volume between them and the observer to be filled with lens planes because lens planes at very high redshift are geometrically inefficient and have a low density contrast .",
    "the left panel of fig .",
    "[ fig:12 ] shows two examples for the lensing efficiency function times the linear growth factor , which is the relevant quantity combining structure growth with geometrical efficiency .",
    "similarly , the effective angular resolution of the simulation is dominated by the angular resolution of those lens planes near the peak in the combined efficiency function , i.e.  the product of geometrical efficiency and linear growth factor .",
    "the shot noise caused by the discretisation of mass into particles is particularly important for studies of weak lensing by large - scale structures . even in absence of density inhomogeneities , shot noise leads to density fluctuations .",
    "they need to be sufficiently smaller than the signal , i.e.  the convergence fluctuations which cause weak lensing .",
    "in essence , this requirement also imposes a resolution limit .",
    "suppose we wish to quantify the weak - lensing signal within a solid angle @xmath113 .",
    "the volume spanned by @xmath113 within redshifts @xmath114 and @xmath115 is @xmath116 where @xmath117 and @xmath118 are the angular diameter and proper distances to redshift @xmath114 . in absence of density inhomogeneities , this volume element contains @xmath119 particles , with @xmath120 where @xmath121 is the mean matter density at redshift @xmath114 , and @xmath122 is the mass of an @xmath70-body particle in the simulation .",
    "the contribution to the lensing convergence by these particles has to be weighted by the effective lensing distance , @xmath123 , and by numerical factors .",
    "poisson fluctuations in the particle number thus cause convergence fluctuations whose variance is @xmath124 these fluctuations need to be compared with , and smaller than , the convergence fluctuations due to large - scale structure , which are typically of order @xmath125 for sources near redshift unity and angular scales of order @xmath126 . according to eqs .",
    "( [ eq:25 ] ) through ( [ eq:27 ] ) , the _ rms _ shot noise @xmath127 scales like @xmath128 , thus the requirement that the signal - to - noise ratio @xmath129 exceed a specified threshold translates into a lower limit to the solid angle @xmath113 which can reasonably be resolved by the simulation .",
    "the smallness of the _ rms _ cosmic convergence @xmath130 implies that many particles need to be enclosed by the `` cone '' spanned by @xmath113 for the simulation to be reliable .",
    "the right panel of fig .",
    "[ fig:12 ] shows an example .",
    "the _ rms _ cosmic convergence in per cent and the _ noise - to - signal _ ratio are plotted as functions of angular scale .",
    "the noise level was adapted to an @xmath70-body simulation with particle mass @xmath131 .",
    "the curves show that the noise - to - signal ratio drops below unity for sources at redshift @xmath132 only if the angular resolution is lowered to @xmath133 , while an angular resolution of @xmath134 can be achieved for @xmath135 ( i.e.  for weak lensing of the cmb ; pfrommer 2002 ) .",
    "weak lensing by large - scale structures requires the cosmic volume to be split into multiple lens planes rather than a single one ( for general reference on multiple lens - plane theory , see schneider et al .",
    "the lens plane closest to the observer is the image plane which represents the observer s sky .",
    "a light ray piercing the image plane at a physical coordinate @xmath136 is mutiply deflected on @xmath70 lens planes and finally reaches the source plane at the physical coordinate @xmath137 where the @xmath138 and @xmath139 are the angular diameter distances from the observer to the @xmath31-the lens plane , and from the @xmath31-th lens plane to the source , respectively .",
    "the light ray passes the @xmath31-th plane at @xmath140 , where it is deflected by @xmath141 .",
    "similarly , the @xmath140 are determined by @xmath142 where @xmath143 is the angular diameter distance from the @xmath31-th to the @xmath144-th lens plane .",
    "introducing angular coordinates @xmath145 yields @xmath146 where we have introduced the _",
    "reduced _ deflection angle @xmath147 .",
    "we now define the matrices @xmath148 clearly , @xmath149 is the jacobian matrix of the lens mapping between the @xmath31-th lens plane and the image plane , thus @xmath150 is the jacobian matrix of the mapping between the source and image planes .",
    "the goal is thus to determine @xmath150 in order to obtain convergence , shear , and magnification for a light ray starting out into direction @xmath151 .",
    "the ray - tracing equation ( [ eq:31 ] ) implies the recursion relation @xmath152 starting with @xmath153 , the identity matrix . in summary , the deflection - angle fields @xmath154 on the @xmath70 lens planes can be used to construct the matrices @xmath155 according to eq .",
    "( [ eq:32 ] ) , then eq .  ( [ eq:33 ] ) can be used to determine the lensing experienced by a light ray starting out into any direction on the image plane .",
    "the left panel in fig .",
    "[ eq:13 ] shows the total convergence experienced by sources at @xmath156 on a lens plane with a side length of @xmath157 , obtained from an @xmath70-body simulation ( pfrommer 2002 ) .        the right panel in fig .",
    "[ fig:13 ] shows numerically determined power spectra for the effective convergence as functions of wave number @xmath158 , which is the fourier conjugate variable to the angular scale .",
    "the lines in this figure show the theoretically expected power spectra .",
    "the agreement between the numerical and theoretical results is very good over a limited range of wave numbers .",
    "once the wave numbers increase beyond the limit set by the angular resolution , the simulated convergence fields lack power and the numerical results fall below the theoretical ones .",
    "this happens at lower @xmath158 for smaller source redshifts , because a fixed angular scale , and thus wave number @xmath158 , corresponds to smaller physical scales at lower distances . on the low-@xmath158 end ,",
    "i.e.  for large structures , the errors on the numerically determined power spectra increase because the number of independent modes in the simulated convergence field decreases as the modes increase .",
    "this example should suffice to demonstrate that numerical simulations of gravitational lensing by large - scale structures should be carefully designed to match their final purpose .",
    "let us conclude with a brief discussion of inversion techniques .",
    "they are typically less demanding numerically , but the methods which have been developed for this purpose are interesting in their own right .",
    "we have seen before in eqs .",
    "( [ eq:23 ] ) and ( [ eq:24 ] ) that convergence and shear are related because they are both linear combinations of second derivatives of the scalar lensing potential @xmath25 . in fourier space ,",
    "the relations are algebraic and can easily be combined to eliminate the fourier transform @xmath159 of the potential .",
    "transforming back into configuration space , the convergence turns out to be a convolution of the shear with a well - known kernel , @xmath160\\ ; , \\label{eq:34}\\ ] ] with @xmath161 this is the classic kaiser & squires ( 1993 ) shear inversion equation .",
    "its limitations have been discussed in detail and removed to satisfaction by modifying e.g.  the kernel components @xmath162 ; they are not of interest for the discussion here ( cf .",
    "peter schneider s lecture in this volume ) .    a suitable practical approximation of ( [ eq:34 ] ) using measured galaxy ellipticities @xmath163 ( @xmath164 ) is @xmath165\\ ; , \\label{eq:36}\\ ] ] where @xmath166 is the number density of lensed galaxies on the sky .",
    "in practice , however , it turns out that an approximation like ( [ eq:36 ] ) would have infinite noise because of the random sampling of the shear components @xmath167 by @xmath70 galaxy ellipticities @xmath163 .",
    "this can be remedied by introducing a smoothed kernel @xmath168 instead of @xmath169 , e.g. @xmath170\\,\\mathcal{d}\\ ; , \\label{eq:37}\\ ] ] where @xmath171 is the angular smoothing scale ( seitz & schneider 1995 ) . the noise convariance matrix between the convergence values at two different grid points @xmath172 and",
    "@xmath173 is then @xmath174\\ ; , \\label{eq:38}\\ ] ] where @xmath175 is the scatter of the intrinsic galaxy ellipticities ( van waerbeke 2000 ) .",
    "this expression demonstrates that smoothing introduces correlations on the convergence map on the angular scale @xmath171 , but the variance of @xmath176 can become very high if @xmath171 is chosen too small .",
    "a careful balance between the local variance and non - local correlations is necessary in order to arrive at a convergence map with the required properties .",
    "an entirely different approach to lens inversion uses the maximum - likelihood technique ( bartelmann et al .",
    "each lensed background galaxy @xmath31 provides a measurement of two ellipticity components @xmath177 and its angular size . comparing the size of a galaxy behind a galaxy cluster to the average size of unlensed galaxies of the same surface brightness",
    ", an estimate @xmath178 of the inverse magnification of the lensed galaxy can be derived .",
    "thus @xmath70 galaxies provide a @xmath179-dimensional data vector @xmath180 the goal of the lens inversion is then to find a two - dimensional array @xmath181 of lensing potential values such that the ellipticities and inverse magnifications caused by that potential at the positions @xmath172 of the real galaxies optimally reproduce the measured ellipticities and inverse magnifications . in other words , the potential values @xmath181 have to be determined such as to minimise the mean - square difference between the data vector @xmath182 and the model data vector @xmath183 $ ] , @xmath184 ^ 2}{\\sigma_i^2 }    \\right\\}\\ ; , \\label{eq:40}\\ ] ] where the errors @xmath185 can be estimated from the data themselves .",
    "the minimisation of @xmath186 with respect to the potential values @xmath181 can be done with any minimisation algorithm like , e.g.  the downhill simplex method . for large fields ,",
    "the number of potential values can become very large .",
    "in that case , conjugate - gradient methods are preferred , which make use of the fact that the derivatives of @xmath186 with respect to the @xmath181 are known analytically .",
    "such methods can speed up the minimisation sufficiently to render it feasible even for large potential arrays ( cf .",
    "press et al .",
    "1992 ) .",
    "the minimisation of @xmath186 is a special case of the maximum - likelihood technique for assumed gaussian deviations of the measured data around the model values .",
    "improvements of the maximum - likelihood technique can be derived starting from bayes theorem , @xmath187 which states that the probability @xmath188 of finding the potential @xmath25 given the data @xmath182 is proportional to the probability @xmath189 of obtaining the data given the potential , times the probability @xmath190 for finding the potential .",
    "the denominator @xmath191 is called the _ evidence _ and simply normalises eq .  ( [ eq:41 ] ) .",
    "@xmath190 is called the prior , quantifying any _ a priori _ information one has or assumes on the potential @xmath25 , @xmath189 is called the likelihood , and @xmath188 is the _ posterior _ probability .",
    "the goal is now to maximise the latter , which is equivalent to maximising the product @xmath192 of likelihood and prior . if we have or can assume gaussian noise and a diagonal noise correlation matrix , the likelihood reduces to @xmath193 .",
    "it can now be shown that in absence of any further information , the best , i.e.  least prejudiced , prior is the maximum - entropy prior , @xmath194\\ ; , \\label{eq:42}\\ ] ] with the _ cross entropy _",
    "@xmath195 where @xmath196 is a model vector for the potential which can encode expectations on the potential , or simply be chosen to be uniform for all @xmath31 .",
    "the potential array is then determined by maximising @xmath197 , or equivalently by minimising @xmath198 instead of the simple @xmath186 in eq .",
    "( [ eq:40 ] ) .",
    "the parameter @xmath199 can be included into the minimisation .",
    "bayesian theory implies that a good approximation to the optimal choice for @xmath199 is determined such that @xmath200 at the potential minimum @xmath201 .",
    "the error covariance matrix for the potential @xmath25 is given by the inverse curvature matrix of @xmath202 , @xmath203 maximum - entropy methods have been suggested and used for regularising shear - inversion techniques such that their spatial resolution is adapted to the strength of the lensing signal ( bridle et al .",
    "1998 ; seitz et al .  1998 ) .",
    "many numerical methods have been used for gravitational lensing studies which i was not able to cover during the limited time of the lecture . among them",
    "are the hierarchical tree - code methods introduced into microlensing by wambsganss et al .",
    "( 1990 ) and the methods for constraining cluster mass distributions from multiple arc systems ( e.g.  kneib et al .  1993 ; see also jean - paul kneib s presentation in this volume ) . despite this unavoidable incompleteness ,",
    "i hope to have given a flavour of how numerical methods can be used for lensing , and what the main problem areas are .",
    "bartelmann , m. , weiss , a. 1994 , a&a 287 , 1 bartelmann , m. , steinmetz , m. , weiss , a. 1995 , a&a 297 , 1 bartelmann , m. , narayan , r. , seitz , s. , schneider , p. 1996",
    ", apj 464 , l115 bartelmann , m. , loeb , a. 1998 , apj 503 , 48 bartelmann , m. , schneider , p. 2001 , phys . rep .",
    "340 , 291 bridle , s.l . ,",
    "hobson , m.p . ,",
    "lasenby , a.n . , saunders , r. 1998 , mnras 299 , 895 hockney , r.w . , eastwood , j.w .",
    "1988 , computer simulations using particles ( bristol : hilger ) kaiser , n. , squires , g. 1993 , apj 404 , 441 keeton , c.r . ,",
    "kochanek , c.s .",
    "1998 , apj 495 , 157 kneib , j .-",
    "p . , mellier , y. , fort , b. , mathez , g. 1993 , a&a 273 , 367 mellier , y. 1999 , ann .",
    "37 , 127 meneghetti , m. , yoshida , n. , bartelmann , m. , moscardini , l. springel , v. , tormen , g. , white , s.d.m .",
    "2001 , mnras 325 , 435 meneghetti , m. , bolzonella , m. , bartelmann , m. , moscardini , l. , tormen , g. 2000 , mnras 314 , 338 narayan , r. , bartelmann , m. 1999 , in : formation of structure in the universe , eds .",
    "a. dekel and j.p .",
    "ostriker , p. 360",
    "( cambridge : university press ) pfrommer , c. 2002 , _ diploma thesis _ , munich university press , w.h . , teukolsky , s.a . ,",
    "vetterling , w.t . , flannery , b.p .",
    "1992 , numerical recipes ( cambridge : university press ) schneider , p. , ehlers , j. , falco , e.e .",
    "1992 , gravitational lenses ( heidelberg : springer verlag ) seitz , c. , schneider , p. 1995 , a&a 297 , 287 seitz , s. , schneider , p. , bartelmann , m. 1998 , a&a 337 , 325 seljak , u. , zaldarriaga , m. 2000 , apj 538 , 57 van waerbeke , l. 2000 , mnras 313 , 524 wambsganss , j. , paczyski , b. , katz , n. 1990 , apj 352 , 407"
  ],
  "abstract_text": [
    "<S> most problems in gravitational lensing require numerical solutions . the most frequent types of problems are ( 1 ) finding multiple images of a single source and classifying the images according to their properties like magnification or distortion ; ( 2 ) propagating light rays through large cosmological simulations ; and ( 3 ) reconstructing mass distributions from their tidal field . </S>",
    "<S> this lecture describes methods for solving such problems . </S>",
    "<S> emphasis is put on using adaptive - grid methods for finding images , issues of spatial resolution and reliability of statistics for weak lensing by large - scale structures , and methodical questions related to shear - inversion techniques . </S>"
  ]
}