{
  "article_text": [
    "extracting free energy differences from a suitable set of computer simulation data is an active field of research and of interest for e.g. drug design @xcite or nonperturbative quantum chromodynamics @xcite . concerning estimators for the free energy difference , an extensive literature can be found .",
    "probably the most elementary estimator is the traditional free energy perturbation @xcite , which is briefly introduced in the following .",
    "assume we have given two systems , arbitrarily labeled as system @xmath0 and system @xmath1 , that are characterized by hamiltonians @xmath2 and @xmath3 , respectively , depending on the point @xmath4 in phase space .",
    "further , let @xmath5 denote the thermal equilibrium phase space density of system @xmath6 , @xmath7 where @xmath8 denotes the partition function and @xmath9 the inverse temperature .",
    "we are interested in the helmholtz free energy difference @xmath10 of the systems , defined as @xmath11 .",
    "traditional free energy perturbation @xcite originates from the equality @xmath12 with @xmath13 .",
    "the latter quantity may be interpreted as the work performed during an infinitely fast switching process transforming system @xmath0 to system @xmath1 , with initial configuration @xmath4 @xcite . a direct consequence of eq .",
    "is the perturbation identity @xmath14 which is frequently used to obtain an estimate of @xmath10 in drawing a sample @xmath15 from @xmath16 ( e.g. by monte carlo simulations ) and evaluating the estimator @xmath17 the overbar denotes a sample average [ i.e. @xmath18 where @xmath19 stands for an arbitrary function ] . as can be seen by comparison with eq .",
    ", the integrand appearing in eq .   is proportional to @xmath20 , and thus the main contributions to an accurate estimate of @xmath10 with eq .",
    "come from realizations @xmath4 ( drawn from @xmath21 ) that are typical for the density @xmath20 .",
    "this means that the performance of such an estimate depends strongly on the degree of overlap of @xmath21 with @xmath20 .",
    "if the overlap is small , the traditional free energy perturbation is plagued with a slow convergence and a large bias .",
    "this can be overcome by using methods that bridge the gap between the densities @xmath21 and @xmath20 , for instance the thermodynamic integration .",
    "since thermodynamic integration samples a sequence of many equilibrium distributions , it soon becomes computationally expensive .",
    "another method is umbrella sampling @xcite which distorts the original distribution in order to sample regions that are important for the average . because of the distortion ,",
    "the latter method is in general restricted to answer only one given question , e.g. the value of the free energy difference , but fails to give further answers .",
    "this is of particular concern , if in addition the values of some other thermodynamic variables are sought , for example pressure or internal energy .",
    "there are dynamical methods @xcite that make use of the jarzynski work theorem @xcite .",
    "they allow to base the estimator on work values of fast , finite time , non - equilibrium processes connecting system @xmath0 with system @xmath1 . however , the dynamic simulation of the trajectories is typically very expensive .",
    "six years ago , the targeted free energy perturbation method @xcite was introduced ; a promising method which is based on mapping equilibrium distributions close to each other in order to overcome the problem of insufficient overlap , without the need to draw from biased distributions .",
    "however , this method is hardly used in the literature .",
    "an obstacle might be that there is no general description of how to construct a suitable map .",
    "a recent improvement is the escorted free energy simulation @xcite which is a dynamical generalization of the targeted free energy perturbation .",
    "any free energy difference refers to two equilibrium ensembles .",
    "the above mentioned methods draw only from one of the two ensembles and propagate the system in direction of the other . insofar , they are `` one - sided '' methods . however , it is of advantage to draw from both equilibrium distributions and combine the obtained `` two - sided '' information .",
    "optimizing the elementary `` two - sided '' estimator for free energy differences results in the acceptance ratio method @xcite .",
    "the next step of improvement is to implement a `` two - sided '' targeted free energy method that optimally employs the information of drawings from both equilibrium distributions .",
    "our aim is to combine the advantages of the acceptance ratio method with the advantages of the targeted free energy perturbation .",
    "the central result of this paper is a fluctuation theorem for the distributions of generalized work values that is derived and presented in section [ sec - ft ] . from this fluctuation theorem ,",
    "the desired optimal two - sided targeted free energy estimator follows in section [ sec - est ] . in section [ sec - rms ] ,",
    "appropriate measures are introduced which relate the overlap of @xmath22 with @xmath20 to the mean square errors of the one- and two - sided free energy estimators . in section",
    "[ sec - con ] , a convergence criterion for the two - sided estimator is proposed . from section [ sec - num ] on",
    ", numerics plays an important part .",
    "in particular , section [ sec - cavity ] deals with explicit numerical applications .",
    "based on the two - sided targeted free energy estimator , in section [ sec - mu ] , an estimator for the chemical potential of a high - density homogeneous fluid is established and applied to a dense lennard - jones fluid . finally , the construction and performance of suitable maps is studied .    in order to get some notation straight",
    ", we start by recalling the targeted free energy perturbation method .",
    "let @xmath23 and @xmath24 denote the phase spaces of the systems @xmath0 and @xmath1 , respectively .",
    "we require that @xmath25 contains only those points @xmath4 for which @xmath5 is non - zero .",
    "mapping the phase space points of system @xmath0 , @xmath26 , such that the mapped phase space @xmath27 coincides with the phase space @xmath24 and such that the mapped distribution @xmath22 overlaps better with the canonical distribution @xmath20 results in the _ targeted free energy perturbation _",
    "@xcite where the samples are drawn _ effectively _ from @xmath22 , instead .",
    "following the idea of jarzynski @xcite , we introduce such a phase space map .",
    "if @xmath23 and @xmath24 are diffeomorph , there exists a bijective and differentiable map @xmath28 from @xmath23 to @xmath24 , @xmath29 where the absolute value of the jacobian is @xmath30 the inverse map reads @xmath31    according to @xmath32 , the phase space density @xmath21 is mapped to the density @xmath22 , @xmath33 which can be written as @xmath34 or @xmath35    in analogy to eq .",
    ", the targeted free energy perturbation is based on the identity @xmath36 which follows from the densities and with @xmath37 being defined by @xmath38 multiplying eq .   by @xmath39 and integrating over @xmath23 yields the targeted free energy perturbation formula ,",
    "@xmath40 an alternative derivation is given in @xcite .",
    "the traditional free energy perturbation formula can be viewed as a special case of eq .  .",
    "the latter reduces to the former if @xmath28 is chosen to be the identity map , @xmath41 .",
    "[ this requires that @xmath42 holds . ]    now an obvious estimator for @xmath10 , given a sample @xmath43 drawn from @xmath16 , is @xmath44 which we refer to as the targeted _ forward _ estimator for @xmath10 .",
    "the convergence problem of the traditional forward estimator , eq .",
    ", in the case of insufficient overlap of @xmath21 with @xmath20 is overcome in the targeted approach by choosing a suitable map @xmath28 for which the image @xmath22 of @xmath21 overlaps better with @xmath20 . indeed , suppose for the moment that the map is chosen to be ideal , namely such that @xmath45 coincides with @xmath46 .",
    "then , as a consequence of eq .  , the quantity @xmath47 is constant and equals @xmath10 , and the convergence of the targeted estimator is immediate .",
    "although the construction of such an ideal map is impossible in general , the goal of approaching an ideal map guides the design of suitably good maps .    to complement the _ one - sided _",
    "targeted estimator , a second perturbation formula in the `` reverse '' direction is derived from eq .  ,",
    "@xmath48 leading to the definition of the targeted _ reverse _ estimator @xmath49 of @xmath10 , @xmath50 the index @xmath1 indicates that the set @xmath51 is drawn from @xmath20 . using the identity map @xmath41 in eq .   gives the traditional reverse estimator , which is valid if @xmath52 holds .",
    "it will prove to be beneficial to switch from phase space densities to one - dimensional densities which describe the value distributions of @xmath47 and @xmath53 , cf .",
    "eqs .   and .",
    "this is done next and results in the fluctuation theorem for generalized work distributions .",
    "we call @xmath47 , @xmath54 , function of the _ generalized work _ in _ forward _ direction and @xmath53 , @xmath55 , function of the _ generalized work _ in _ reverse _ direction , having in mind that these quantities are the functions of the actual physical work for special choices of the map @xmath28 @xcite .    the probability density @xmath56 for the outcome of a specific value @xmath57 of the generalized work in forward direction subject to the map @xmath32 when sampled from @xmath21 is given by @xmath58 conversely , the probability density @xmath59 for the observation of a specific value @xmath57 of the generalized work in reverse direction when sampled from @xmath20 reads @xmath60 relating the forward and reverse `` work '' probability densities to each other results in the fluctuation theorem @xmath61 this identity provides the main basis for our further results . it is established by multiplying eq .   with @xmath62 and integrating with respect to @xmath63 .",
    "the left hand side yields @xmath64 and the right hand side gives @xmath65    it is worth to emphasize that the fluctuation theorem is an exact identity for _ any _ differentiable , bijective map @xmath28 from @xmath23 to @xmath24 .",
    "especially , it covers known fluctuation theorems @xcite related to the _ physical _ work applied to a system that is driven externally and evolves in time according to some deterministic equations of motion , e.g. those of hamiltonian dynamics , nos - hoover dynamics or gaussian isokinetic dynamics @xcite .    as an example , consider the time - reversible adiabatic evolution of a conservative system with hamiltonian @xmath66 , depending on an externally controlled parameter @xmath67 ( e.g. the strength of an external field ) .",
    "let @xmath68 with @xmath69 be the flow of the hamiltonian system which is a functional of the parameter @xmath70 that is varied from @xmath71 to @xmath72 according to some prescribed protocol that constitutes the forward process .",
    "the hamiltonian flow can be used to define a map , @xmath73 .",
    "since the evolution is adiabatic and hamiltonian , no heat is exchanged , @xmath74 , and the jacobian is identical to one , @xmath75 .",
    "consequently , the generalized work in forward direction reduces to the physical work applied to the system , @xmath76 . for each forward path @xmath77",
    "we have a reverse path @xmath78 , where the superscript @xmath79 indicates that quantities that are odd under time reversal ( such as momenta ) have changed their sign . the generalized work in reverse direction",
    "reduces to the physical work done _ by _ the system , @xmath80 .",
    "starting the forward process with an initial canonical distribution , @xmath16 , some probability distribution for the physical work in forward direction follows , @xmath81 .",
    "starting the reverse process with an initial canonical distribution , @xmath82 , some probability distribution for the physical work in reverse direction follows , @xmath83 .",
    "the distributions @xmath84 and @xmath85 are related to each other by the identity which coincides with the fluctuation theorem of crooks @xcite .    from the fluctuation theorem",
    "some important inequalities follow that are valid for any map @xmath28 .",
    "first of all we state that the targeted free energy perturbation formulas and can be regarded as a simple consequence of the fluctuation theorem and can be rewritten in terms of the generalized work distributions , @xmath86 and @xmath87 , where the angular brackets with subscript @xmath6 denote an ensemble average with respect to the density @xmath88 , @xmath89 .",
    "the monotonicity and convexity of the exponential function appearing in the above averages allows the application of jensen s inequality , @xmath90 . from",
    "this follows the fundamental inequality @xmath91 which shows that the values of the average work in forward and reverse direction constitute an upper and a lower bound on @xmath10 , respectively .",
    "concerning one - sided estimates of @xmath10 , the targeted forward and reverse estimators and can be written @xmath92 and @xmath93 , where the overbar denotes a sample average according to a sample @xmath94 and @xmath95 of forward and reverse work values , respectively . similarly to one finds the inequalities @xmath96 and @xmath97 .    taking the ensemble averages @xmath98 , @xmath89 , of the one - sided estimates and applying jensen s inequality to the averages of the logarithms , @xmath99 , one obtains @xmath100 in other words , the forward and reverse estimators are biased in opposite directions for any finite size @xmath101 of the work samples , but their mean values form closer upper and lower bounds on @xmath10 than the values of the mean work do .",
    "so far , we were concerned with one - sided estimates of @xmath10 , only .",
    "however , the full power of the fluctuation theorem will develop when dealing with a two - sided targeted free energy estimator where a sample of forward _ and _ reverse work values is used simultaneously , since the fluctuation theorem relates the forward and reverse work probability densities to each other in dependence of the free energy difference .    in the next section",
    ", we will drop to mention the target map @xmath28 explicitly in order to simplify the notation .",
    "for instance , we will write @xmath102 , but mean @xmath88 , instead .",
    "an important feature of the fluctuation theorem is that it provides a way to answer the following question : given a sample of @xmath103 work values @xmath104 in the forward direction and a second sample of @xmath105 work values @xmath106 in the reverse direction , what would be the best estimator of @xmath10 that utilizes the entire two samples ?",
    "if drawn from an ensemble that consists of forward and reverse work values , the elements are given by a pair of values @xmath107 of work and direction , where @xmath108 indicates the forward and @xmath109 the reverse direction .",
    "the probability density of the pairs @xmath107 is @xmath110 .",
    "the probability density for the work is @xmath111 , and that for the direction is @xmath112 .",
    "bayes theorem , @xmath113 implies the `` balance '' equation @xmath114 from the fluctuation theorem and bayes theorem follows @xmath115 with @xmath116 together with the normalization @xmath117 , eq",
    ".   determines the explicit form of the conditional direction probabilities @xcite , @xmath118 replacing both , the ensemble averages by sample averages and the ratio @xmath119 by @xmath120 , the balance equation , @xmath121 , results in the two - sided targeted free energy estimator , @xmath122 , which reads @xmath123 it is worth to emphasize that this estimator is _ the _ optimal two - sided estimator , a result that is shown with a constraint maximum likelihood approach in appendix [ app.likeli ] .",
    "a derivation of this estimator is also given by shirts et al .",
    "@xcite in the framework of a maximum likelihood approach .",
    "if samples of @xmath103 forward and @xmath105 reverse work values @xmath124 and @xmath125 are given , but no further information is present , it is the two - sided estimator that yields the best estimate of the free energy difference with respect to the mean square error . if needed , the samples @xmath124 and @xmath125 can be obtained indirectly by drawing samples @xmath126 and @xmath127 of @xmath21 and @xmath20 and setting @xmath128 and @xmath129 .",
    "opposed to the one - sided estimators and , the two - sided targeted free energy estimator is an implicit equation that needs to be solved for @xmath130 .",
    "note however that the solution @xmath130 is unique .",
    "let us mention a subtlety concerning the choice of the ratio @xmath119 .",
    "the mixed ensemble @xmath131 is specified by the mixing ration @xmath119 , and by the conditional work probability densities @xmath132 . with the mixed ensemble we are free to choose the mixing ratio .",
    "for instance , replacing the ensemble averages in the balance equation by sample averages results in an estimator @xmath133 for @xmath10 that depends on the value of the mixing ratio .",
    "this raises the question of the optimal choice for @xmath119 . as shown in the appendix [ app.likeli ]",
    ", it is optimal to choose the mixing ratio equal to the sample ratio , @xmath134 . a result that may be clear intuitively , since then the mixed ensemble reflects the actual samples best .",
    "other free energy estimators follow , if the explicit expressions and the definition of the constant @xmath135 , eq .  , are inserted in the balance equation .",
    "the latter can then be expressed as @xmath136 and results in the estimator @xmath137 the non - targeted version of this estimator , i.e. for @xmath138 , is due to bennett @xcite who used a variational principle in order to find the estimator for the free energy difference that minimizes the mean square error .",
    "equation   is an identity for any value of @xmath135 , since with the ratio @xmath119 the value of @xmath139 can be chosen arbitrarily . however , concerning the estimator , different values of @xmath135 yield different estimates .",
    "bennett s choice is @xmath140 i.e. @xmath141 , which results from minimizing the mean square error @xmath142 , where the angular brackets denote an average over infinitely many repetitions of the estimation process with @xmath103 and @xmath105 being fixed .",
    "according to the appendix [ app.likeli ] , bennett s choice is also optimal for any target map @xmath28 .    with @xmath143 , eq .",
    "has to be solved in a self - consistent manner which is tantamount to solve the two - sided targeted estimator . in other words",
    ", @xmath144 is the unique root @xmath130 of eq .  .",
    "targeted work probability distributions for the expansion / contraction of a cavity in an ideal gas and the associated overlap distribution .",
    "the up ( down ) triangles display the normalized histogram of a sample of forward ( reverse ) work values .",
    "the smooth solid curves are the exact analytic work distributions @xmath56 ( right ) and @xmath59 ( left ) , and the dashed curve shows their overlap distribution @xmath145 .",
    "the straight vertical lines show the values of the targeted estimates of @xmath10 on the abscissa . from left to right : the reverse , the two - sided ( which is indistinguishable from the exact analytic value ) and the forward estimate . ]    in this section we introduce measures for the overlap of @xmath22 with @xmath20 , or , equivalently , of @xmath56 with @xmath59 and relate them to the mean square error of one- and two - sided estimators .    the estimators , and are subject to both , bias and variance .",
    "taking both errors into account results in the mean square error .",
    "let us consider the mean square errors of the one - sided targeted estimators first .",
    "they read @xmath146 in forward direction , and analogously in backward direction .",
    "in forward direction , it can be quantified by expanding the logarithm into a power series about the mean value of its argument , @xmath147 , and neglecting terms of higher order in @xmath148 , which gives @xmath149 equation   is valid for a sufficiently large sample size @xmath101 ( large @xmath101 limit ) @xcite . with",
    "the use of the fluctuation theorem , the variance appearing on the right hand side of eq .",
    "can be written @xmath150 .",
    "this yields the inequality @xmath151 in the same manner as above the inequality @xmath152 is obtained for the mean square error @xmath153 of the reverse estimator @xmath49 .    the inequalities and specify the minimum sample size @xmath101 that is required to obtain a forward and reverse estimate @xmath154 , respectively , whose root mean square error @xmath155 is not larger than @xmath156 .",
    "namely , @xmath157 is required for a forward , and @xmath158 for a reverse estimate .",
    "similar expressions are found in ref .",
    "@xcite . since the required sample size @xmath101 depends exponentially on the dissipation , it is good to choose a target map @xmath28 which reduces the dissipation in the opposite direction .",
    "the dissipation is related to the overlap of @xmath22 with @xmath20 .",
    "the overlap of two probability densities @xmath159 and @xmath160 of a random variable @xmath161 can be quantified with the kullback - leibler divergence @xmath162 a positive semidefinite measure that yields zero if and only if @xmath163 is identical to @xmath164 . applied to the densities @xmath20 and @xmath22 , the kullback - leibler divergence turns out to be identical with the kullback - leibler divergence of @xmath59 with @xmath56 and results in the generalized dissipated work in reverse direction , @xmath165 which is established with the use of eqs .   and , and the fluctuation theorem .",
    "similarly , we have @xmath166 for the one - sided targeted free energy estimators this means that choosing a target map which reduces the dissipation in the opposite direction is the same as choosing a target map which enhances the overlap of @xmath22 with @xmath20 .",
    "now , we proceed with the overlap measure and the mean square error of the two - sided free energy estimator . in order to keep the notation simple , we assume that the samples of forward and reverse work values are of equal size , @xmath167 .",
    "( a generalization to @xmath168 is straightforward possible , but not given in this paper . )",
    "consider the overlap density @xmath145 , @xmath169 where the normalization constant @xmath170 reads @xmath171 @xmath170 is a measure for the overlap area of the distributions and takes its maximum value @xmath172 in case of coincidence .",
    "using the fluctuation theorem , the two - sided overlap measure can be written @xmath173 comparing eq .   with the two - sided targeted free energy estimator",
    ", one sees that the two - sided targeted free energy estimation method readily estimates the two - sided overlap measure .",
    "the accuracy of the estimate depends on how good the sampled work values reach into the main part of the overlap distribution @xmath145 . by construction , the overlap region",
    "is sampled far earlier than the further distant tail that lies in the peak of the other distribution , cf .",
    "[ fig:1 ] .",
    "this is the reason why the two - sided estimator is superior if compared to the one - sided estimators .    in the large @xmath101 limit",
    "the mean square error @xmath174 of the two - sided estimator can be expressed in terms of the overlap measure and reads @xmath175 cf .",
    "note that if an estimated value @xmath176 is plugged in , this formula is valid in the limit of large @xmath101 only , but it is not clear a priori when this limit is reached .",
    "therefore , we develop a simple convergence criterion for the two - sided estimate .",
    "in this section , a measure for the convergence of two - sided estimate is developed , again for the special case @xmath167 .",
    "first , we define the estimate @xmath176 of the overlap measure @xmath170 with @xmath177 which is equal to @xmath178 , as we understand the estimate @xmath130 to be obtained according to with the same samples of forward and reverse work values .",
    "since the accuracy of the estimated value @xmath176 is unknown , we need an additional quantity to compare with .",
    "another expression for the overlap measure is @xmath179 which can be verified with the fluctuation theorem .",
    "based on eq .",
    ", we define the overlap estimator of second order @xmath180    because @xmath130 converges to @xmath10 , both , @xmath176 and @xmath181 converge to @xmath170 in the limit @xmath182 .",
    "however , the second order estimator @xmath181 converges slower and is for small @xmath101 typically much smaller than @xmath176 , since the main contributions to the averages appearing in eq .",
    "result from work values that lie somewhat further in the tails of the work distributions .",
    "we use the relative difference @xmath183 to quantify the convergence of the two - sided estimate @xmath130 , where @xmath176 , @xmath181 and @xmath130 are understood to be calculated with the same two samples of forward and reverse work values .    from eqs .  ,",
    ", and follows that @xmath184 holds .",
    "hence , the convergence measure @xmath185 is bounded by @xmath186 for any @xmath101 .",
    "a necessary convergence condition is @xmath187 .",
    "this means that only if @xmath185 is close to zero , the two - sided overlap estimators can have converged .",
    "typically , @xmath185 being close to zero is also a sufficient convergence condition .",
    "hence , if @xmath185 is close to zero , the mean square error of @xmath130 is given by eq .",
    "with @xmath188 . as can be seen from eq .  , the mean square error and in turn the variance and the bias are reduced by both , by taking a larger sample size @xmath101 and by choosing a map @xmath28 that enhances the overlap of @xmath22 with @xmath20 .    with the targeted free energy estimators at hand ,",
    "together with their mean square errors , we are now ready to compute free energy differences numerically .",
    "we investigate two numerical applications .",
    "one is the free energy difference of a fluid subject to the expansion of a cavity which allows the comparison with published results @xcite .",
    "the other is the chemical potential of a fluid in the high density regime .    beneath an ideal gas ,",
    "the fluid is chosen to be a lennard - jones fluid with pairwise interaction @xmath189 where @xmath190 is the distance between the k - th and l - th particle , @xmath191 .",
    "the parameters used are those of argon , @xmath192  and @xmath193k @xcite .    in all applications , the samples from the densities @xmath21 and @xmath20 are simulated with the metropolis algorithm @xcite . in order to simulate macroscopic behavior with a small number @xmath194 of particles , periodic boundary conditions and the minimum image convention @xcite",
    "pairwise interactions are truncated at half of the box length @xmath195 , but are not shifted , and the appropriate cut - off corrections are applied @xcite .       the geometric setup . ]    the expansion of a cavity in a fluid is given by the following setup : consider a fluid of @xmath194 point molecules with pairwise interaction @xmath196 confined in a cubic box of side length @xmath197 , but excluded from a sphere of radius @xmath198 , compare with fig .",
    "[ fig:0 ] .",
    "both , the box and the sphere are centered at the origin @xmath199 .",
    "a configurational microstate of the system is given by a set @xmath200 of particle positions @xmath201 . growing the sphere from @xmath202 to @xmath203 decreases the volume accessible to the particles and",
    "the fluid is compressed .",
    "we are interested in the increase of free energy @xmath10 subject to the compression of the fluid . since the kinetic contribution to the free energy is additive and independent of @xmath204 , the difference @xmath10 depends only on the configurational part of the hamiltonian .",
    "the latter reads @xmath205 with @xmath89 .",
    "@xmath23 and @xmath24 denote the accessible parts of configuration space of the system @xmath0 ( @xmath202 ) and @xmath1 ( @xmath203 ) , respectively .",
    "we assume that @xmath206 holds which implies @xmath207 .",
    "drawing a sample @xmath43 from @xmath21 and applying the traditional forward estimator results in the following : @xmath208 takes the values one and zero depending on whether @xmath209 or not , i.e.whether the region between the two spheres of radius @xmath210 and @xmath211 is found vacant of particles or not . a comparison with eq .",
    "reveals that @xmath212 is the probability for the spherical shell being observed devoid of particles @xcite .",
    "hence , the rate of convergence of @xmath213 decreases with the latter probability and will in general be poor .",
    "conversely , drawing a sample @xmath214 from @xmath20 and applying the traditional reverse estimator @xmath215 ( eq .   with @xmath41 ) figures out to be invalid , because the term @xmath216 takes always the value one . in concequence ,",
    "the traditional reverse estimator is inconsistent .",
    "the deeper reason for this is that @xmath217 holds : eq .",
    "is valid only for @xmath218 . by the same reason ,",
    "the traditional two - sided estimator is invalid , too .",
    "the mentioned shortcomings are avoided with a well chosen target map .",
    "consider mapping each particle separately according to @xmath219 where @xmath220 is the distance of the @xmath221-th particle with respect to the origin , and @xmath222\\to(r_1,r_{\\text{max}}]$ ] is a bijective and piecewise smooth radial mapping function . in order not to map particles out of the confining box",
    ", it is required that @xmath223 holds for @xmath224 .",
    "the jacobian for the radial map reads @xmath225 ( this formula is immediately clear when changing to polar coordinates ) we use the map of ref .",
    "@xcite which is designed to uniformly compress the volume of the shell @xmath226 to the volume of the shell @xmath227 .",
    "thus , for @xmath228 $ ] the radial mapping function @xmath229 is defined by @xmath230 with the compression factor @xmath231 . according to eq .  , we have @xmath232 , where @xmath233 is the number of particles in the shell @xmath234 .      as a first illustrative and exact solvable example we choose the fluid to be an ideal gas , @xmath235 .",
    "in this case the free energy difference is solely determined by the ratio of the confined volume @xmath236 , @xmath89 , and is given by @xmath237 .",
    "using the radial map , the work in forward direction as a function of @xmath4 reads @xmath238 and takes discrete values only , as @xmath239 holds with @xmath240 .",
    "consequently , the probability @xmath241 of observing the work @xmath242 in forward direction is binomial , @xmath243 where @xmath244 is the probability of any fixed particle to be found in the shell @xmath245 .",
    "in analogy , the probability distribution @xmath246 for observing the work @xmath247 in reverse direction is given by replacing the index @xmath0 with @xmath1 in .",
    "finally , the work probability distributions ( rather then the densities ) obey the fluctuation theorem for any @xmath248 , @xmath249    a simple numerical evaluation highlights the convergence properties . choosing the parameters to be @xmath250 , @xmath251",
    ", @xmath252 , and @xmath253 ( @xmath254 arbitrary ) , the free energy difference takes the value @xmath255 . because @xmath256 can take only the numbers zero and one , the probability of observing a configuration @xmath4 with non - vanishing contribution in the traditional forward estimator of @xmath10 is @xmath257 .",
    "hence , in practice it is impossible to use the traditional method successfully , since it would require at least @xmath258 monte carlo trial moves .",
    "however , the targeted approach already gives reasonable estimates with a sample size of just a few thousands .",
    "figure [ fig:1 ] shows estimates of the targeted work probability distributions for samples of size @xmath259 from @xmath21 and @xmath20 each . while the forward distribution @xmath56 is obviously well sampled in the central region , the sampling size is too small in order to reach the small values of @xmath260 where the reverse distribution @xmath59 is peaked .",
    "exactly the latter values would be required for an _ accurate _ exponential average in the targeted forward estimator eq .  .",
    "therefore , the targeted forward estimate of @xmath10 is still inaccurate ; it yields @xmath261 .",
    "the same is true for the targeted reverse estimate which gives @xmath262 .",
    "the errors are calculated using root mean squares and propagation of uncertainty .",
    "a more accurate estimate follows from the targeted two - sided estimator which yields @xmath263 ( @xmath167 ) .",
    "this is clear , as for the two - sided estimate it is sufficient yet that the forward and reverse work - values sample the region where the overlap distribution @xmath145 , eq",
    ".  , is peaked , which is obviously the case , cf .",
    "[ fig:1 ] .",
    "free energy estimates for the expansion of a cavity in a lennard - jones fluid . shown are average values of traditional and targeted estimates of @xmath10 in dependence of the sample size @xmath101 , with an errorbar of one standard - deviation . in order to distinguish",
    "the data points those corresponding to targeted estimates are shifted to the right and are spread , whereas those corresponding to traditional estimates are shifted to the left .",
    "for example , all four data points in the vicinity of @xmath264 refer to @xmath264 .",
    "the dashed horizontal line represents a targeted two - sided estimate with @xmath265 , see table [ tab0 ] . ]",
    "we now focus on particles with lennard - jones interaction .",
    "the parameters are chosen to coincide with those of ref .",
    "@xcite , i.e. @xmath250 , @xmath266 , @xmath267 , @xmath268 , and @xmath269k . in lennard - jones units ,",
    "the reduced densities @xmath270 of the systems @xmath0 ( @xmath202 ) and @xmath1 ( @xmath203 ) are @xmath271 and @xmath272 , respectively , and @xmath273 holds for both .",
    "if we had an ideal gas , the probability of observing the space between the spheres of radius @xmath210 and @xmath211 to be vacant of particles would be @xmath274 .",
    "because of the strong repulsive part , this probability is much smaller in case of a dense lennard - jones fluid .",
    "we generate samples of @xmath16 and @xmath46 with a metropolis monte carlo simulation .",
    "each run starts with @xmath275 equilibration sweeps , followed by the production run .",
    "in the production run the configurational microstate @xmath4 is being sampled every @xmath276-th sweep only in order to reduce correlations between successive samples .",
    "the use of decorrelated data is of particular importance for the self - consistent two - sided estimate @xmath130 , because it depends intrinsically on the ratio @xmath120 of the numbers of _ uncorrelated _ samples , cf .",
    "eq .  .    fig",
    ".  [ fig:2 ] gives an overview of independent runs with different sample sizes @xmath101 , where the one- and two - sided targeted estimators can be compared with each other and with the traditional forward estimator .",
    "displayed is the estimated mean @xmath277 in dependence of the sample size @xmath101 .",
    "the error bars reflect the estimatet standard deviation @xmath278 .",
    "each mean and each standard - deviation is estimated using @xmath279 independent estimates @xmath280 . in ascending order of @xmath101 , @xmath279 reads @xmath281 , @xmath282 , @xmath283 , @xmath284 . for the two - sided estimates , @xmath167",
    "is used and eq .   is solved .",
    "note that the theoretical mean of _ traditional _ forward estimates of @xmath10 is infinite _ for any finite n _ , because of the finite probability of observing a sequence of length @xmath101 of solely vanishing contributions to the exponential average @xmath213 .",
    "strictly spoken , the estimator @xmath285 is not well defined , because @xmath217 . nevertheless , in fig .",
    "[ fig:2 ] there are two finite _ observed _ mean values of traditional forward estimates displayed , what by no means is a contradiction .",
    "infinite values are observed in the cases where @xmath286 holds .",
    "this is symbolized by the rising dashed line .",
    "the mentioned ill - definiteness of the traditional estimator is removed by using the map .",
    "figure [ fig:2 ] shows that all three targeted estimators are consistent even for small @xmath101 in the sense that the error bars overlap . whereas the targeted forward and reverse estimators show to be decreasingly biased with increasing @xmath101 , the targeted two - sided estimator does not show any noticeable bias at all",
    "this example demonstrates how worth it can be to take all three estimators , forward , reverse , and two - sided , into account .",
    "the one - sided estimators are biased in opposite directions and may serve as upper and lower bounds for @xmath10 , eq .  , whereas the two - sided is placed in between the one - sided .",
    "we conclude this example with explicit estimates obtained from a single run with @xmath287 , that are summarized in table [ tab0 ] .",
    "the errors are derived using block averages @xcite and propagation of uncertainty .",
    ".cavity in a lennard - jones fluid .",
    "estimated free energy differences @xmath288 for the expansion of a cavity , using targeted and traditional estimators .",
    "[ cols=\">,<\",options=\"header \" , ]     it should be mentioned that the optimal value of @xmath290 found here is not universal , but depends on the density @xmath291 . if another value is chosen for @xmath291 , the optimal @xmath290 can again be found from numerical simulations .",
    "note that the maps used here can be applied to simulations where particles are inserted and deleted at random @xcite , too .",
    "one simply has to use the point of insertion ( deletion ) as temporary origin of the coordinate system and apply the map there .",
    "this might enhance the efficiency of the simulation .",
    "the central result of this paper , a fluctuation theorem for generalized work distributions , allowed us to establish an optimal targeted two - sided estimator of the free energy difference @xmath10 .",
    "we have numerically tested this estimator and found it to be superior with respect to one - sided and non - targeted estimators .",
    "in addition we have demonstrated that this estimator can be applied successfully to estimate the chemical potential of a lennard - jones fluid in the high density regime .    in order to use the targeted two - sided estimator it is however crucial to use a suitable map .",
    "we have investigated the construction of maps and developed appropriate measures which enabled a quantitative comparison of the performance of different maps .",
    "especially , a measure for the convergence of the two - sided estimate was designed .",
    "this paths the way for better results when free energy differences or chemical potentials need to be estimated numerically .",
    "we thank andreas engel for helpful hints and discussions .",
    "deriving the optimal estimator of @xmath10 , given a collection of @xmath103 forward @xmath292 and @xmath105 reverse @xmath293 work - values drawn from @xmath294 and @xmath295 , respectively , leads to bennett s acceptance ratio method @xcite with the target map included .    in section [ sec - est ] , the mixed ensemble is introduced , where the elements are given by pairs of values @xmath107 of work and direction , and which is specified by the probabilities of direction @xmath296 and the densities @xmath132 . with the mixture ensemble , the mixing ratio @xmath119 can be chosen arbitrarily .",
    "crucial about the mixture ensemble is that , according to the fluctuation theorem , the analytic form of the conditional probabilities @xmath297 can be derived explicitly , regardless of whether @xmath132 is known , see sec .",
    "[ sec - est ] .",
    "this provides a natural way to construct a constraint maximum likelihood estimator @xcite for @xmath10 .",
    "since it is only possible to draw from the ensembles @xmath132 , but not from @xmath298 , the proper log - likelihood is @xmath299 a _ direct _ maximization of with respect to @xmath10 is impossible without knowledge of the analytic form of the probability densities @xmath132 .",
    "however , according to bayes theorem the log - likelihood can be split into @xmath300 with @xmath301 @xmath302 and @xmath303 where the sum in the prior likelihood runs over all @xmath304 observed forward and reverse work values .",
    "since the definite form of @xmath305 is unknown , we treat it in the manner of an unstructured prior distribution and maximize with respect to the constant @xmath10 _ and _ to the function @xmath305 @xcite .",
    "thereby , @xmath306 and @xmath307 enter as constraints .",
    "using lagrange parameters @xmath67 and @xmath308 , the constrained log - likelihood reads @xmath309    the conditional direction probabilities @xmath297 are known explicitly in dependence of @xmath10 , eq .  , and",
    "their partial derivatives read @xmath310 and @xmath311 .",
    "this allows to extremize the constraint log - likelihood with respect to @xmath10 , @xmath312 extremizing the conditional likelihood with respect to the function @xmath305 gives @xmath313 which can be solved in @xmath305 , @xmath314 or written as @xmath315    if interested in the values of the lagrange multipliers @xmath67 and @xmath308 , one multiplies eq .   with @xmath305 and integrates .",
    "this yields @xmath316 a second independent equation follows from inserting eq .   into eq .   which results in @xmath317 and the lagrange multipliers",
    "take the values @xmath318    with the distribution the constraints and read @xmath319 and @xmath320 where @xmath321 denotes @xmath322 with @xmath323 .",
    "whenever the constraint is fulfilled , the constraint and the variational equations and are automatically satisfied . in consequence , eq .   defines the constrained maximum likelihood estimate of @xmath10 . note that the estimator is _ independent _ of the choice of @xmath119 . moreover , eq .   is equivalent to eq .",
    "regardless of the choice of @xmath119 .",
    "an alternative derivation of the estimator was presented by shirts et al .",
    "there , the specific choice @xmath141 was _ necessary_. with this choice , the lagrange parameter @xmath67 is identical to zero .",
    "hence , there is no need to take any constraint into consideration and the posterior log - likelihood results directly in the estimator of @xmath10 .",
    "m. r. reddy and m. d. erion , _ free energy calculations in rational drug design _ , ( kluwer academic , new york , 2001 )",
    ". t. schfer and e. v. shuryak , rev .",
    "phys . * 70 * , 323 ( 1998 ) .",
    "r. w. zwanzig , j. chem .",
    "phys . * 22 * , 1420 ( 1954 ) . c. jarzynski , phys .",
    "rev . lett .",
    "* 78 * , 2690 ( 1997 ) .",
    "g. m. torrie and j. p. valleau , j. comput . phys . * 23 * , 187 ( 1977 ) .",
    "d. frenkel and b. smit _ understanding molecular simulation _",
    "( academic press , london , 2002 ) . c. jarzynski , phys .",
    "e * 65 * , 046122 ( 2002 ) .",
    "s. vaikuntanathan and c. jarzynski , phys .",
    ". lett . * 100 * , 190601 ( 2008 ) . c. h. bennett , j. comput",
    "* 22 * , 245 ( 1976 ) .",
    "g. e. crooks , phys .",
    "e * 61 * , 2361 ( 2000 ) .",
    "m. r. shirts , e. bair , g. hooker , and v. s. pande , phys .",
    "lett . * 91 * , 140601 ( 2003 ) .",
    "e. schll - paschinger and c. dellago , j. chem . phys .",
    "* 125 * , 054105 ( 2006 ) .",
    "g. e. crooks , phys .",
    "e * 60 * , 2721 ( 1999 ) . c. jarzynski , j. stat .",
    "phys . * 98 * , 77 ( 2000 ) .",
    "d. j. evans , mol .",
    "* 101 * , 1551 ( 2003 ) .",
    "m. a. cuendet , phys .",
    "lett . * 96 * , 120602 ( 2006 ) .",
    "j. gore , f. ritort and c. bustamante , proc .",
    "sci . * 100 * , 12564 ( 2003 ) .",
    "c. jarzynski , phys .",
    "e * 73 * , 046105 ( 2006 ) .",
    "n. metropolis , a. w. rosenbluth , m. n. rosenbluth , a. h. teller , and e. teller , j. chem . phys . * 21 * , 1087 ( 1953 ) .",
    "r. c. reid , j. m. prausnitz and t. k. sherwood _ the properties of gases and liquids _ , 3rd ed .",
    "( mcgraw - hill , new york , 1977 ) , appendices a and c. h. flyvbjerg and h. g. petersen , j. chem .",
    "phys . * 91 * , 461 ( 1989 ) .",
    "b. widom , j. chem .",
    "phys . * 39 * , 2808 ( 1963 ) . j. aitchison and s. d. silvey , ann .",
    "* 29 * , 813 ( 1958 ) .",
    "j. a. anderson , biometrika * 59 * , 19 ( 1972 ) .",
    "r. l. prentice and r. pyke , biometrika * 66 * , 403 ( 1979 ) ."
  ],
  "abstract_text": [
    "<S> we derive a fluctuation theorem for generalized work distributions , related to bijective mappings of the phase spaces of two physical systems , and use it to derive a two - sided constraint maximum likelihood estimator of their free energy difference which uses samples from the equilibrium configurations of both systems . as an application , we evaluate the chemical potential of a dense lennard - jones fluid and study the construction and performance of suitable maps . </S>"
  ]
}