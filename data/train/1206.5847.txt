{
  "article_text": [
    "dynamical diffraction theory describes the multiple elastic scattering of electrons through a crystal .",
    "the theory has been formulated almost a century ago , originally for photons by bragg and von laue .",
    "later it was extended also to electrons on the basis of wave - particle duality , as proven by the famous experiments of davidson and germer , and thomson and reid .",
    "the importance of inelastic electron scattering and the wealth of information contained in this process was for the first time observed by kikuchi@xcite , who observed a complicated pattern of lines going beyond the diffraction patterns expected for elastic scattering of light or electrons .",
    "the diffraction theory that included quantitative description of kikuchi patterns was given by kainuma following qualitative theories of shinohara and von laue@xcite .",
    "various sources of energy loss , such as excitations of phonons or valence electrons to conduction band or core electrons to conduction band were discussed by okamoto et al.@xcite    the inelastic electron scattering is typically described as a three - step process : 1 ) an elastic scattering of the probe electron from entrance surface to a selected atom in the sample , 2 ) an inelastic event exchanging the momentum and energy between a probe and sample electron , and 3 ) an elastic propagation of the scattered probe electron towards the exit sample surface .",
    "this needs to be summed over all possible inelastic scattering centers .",
    "such description holds , when there is only one inelastic scattering event for each observed probe electron .",
    "if its mean free path is much longer than the thickness of the sample , then it is a good approximation .",
    "otherwise one needs to consider multiple inelastic scattering@xcite .",
    "the inelastic event is described by mixed dynamical form - factor ( mdff ) introduced by kohl @xcite . for calculations of mdff , there are various levels of sophistication , ranging from an isotropic dipole approximation @xmath0 , through a parametrized atomic multiplets description @xcite , configuration interaction @xcite , to a density functional theory evaluation @xcite .",
    "recently a dft - based dipole model for mdffs has been published in @xcite using local electronic structure properties to set the coefficients in the dipole approximation , thereby providing a realistic dft - based mdff model with efficiency equal to a simple dipole approximation ( at the cost of losing the fine structure in energy dependence ) .",
    "the elastic scattering can be simulated by one of the two major methods widely used today , the multislice method@xcite and bloch - waves ( bw ) method@xcite .",
    "the latter one is typically more efficient for periodic structures without defects , while the multislice method has an advantage when dealing with large non - periodic structures or structures with defects . in this article",
    "we will study the convergence properties of the bw method in electron energy - loss near edge structure ( elnes ) calculations and describe an efficient algorithm for bw summation .",
    "in ref .   we have described our theoretical approach to simulate general orientation - sensitive elnes experiment from first principles . for the sake of completeness",
    ", we present here a brief summary of the key equations .",
    "the first step is a solution of the secular equation for a fast electron of known energy moving in and out of the crystal . expanding the solutions - bloch waves - into plane waves ( indexed by reciprocal lattice vectors @xmath1 )",
    "the secular equation has the following form : @xmath2 e^{i(\\mathbf{k}^{(j)}+\\mathbf{g } ) \\cdot \\mathbf{r}}=0\\ ] ] where @xmath3 , @xmath4 and @xmath5 are , respectively , the electron mass and charge , @xmath6 where @xmath7 are the fourier components of the crystal potential , and @xmath8 are bloch vectors related to the beam direction @xmath9 and sample surface normal @xmath10 .",
    "solution of the secular equation is a set of bloch waves indexed by @xmath11 , given by so called bloch coefficients @xmath12 and elongations of the wave vector @xmath13 .",
    "evaluation of the double differential scattering cross - section involves calculation of the following sum [ see , e.g. , ref .  , eq .  ( 24 ) ] @xmath14 where @xmath15 here @xmath12 and @xmath16 are the bloch coefficients for the incoming and outgoing bloch fields . the quantity",
    "@xmath17 is the mixed - dynamic form - factor ( mdff ) divided by squares of momentum transfer vectors @xmath18 ( coulomb potential factors ) .",
    "@xmath19 is a thickness function , which depends on bloch wave indices and experimental geometry .",
    "@xmath20 is a number of atoms in the unit cell , where @xmath21 is a base vector .",
    "momentum transfer vectors actually depend on several indices , but to simplify the notation we will not write this dependence explicity . for evaluation of mdffs we typically use an approximation @xmath22 which neglects elongations of the wave vectors @xmath23 .",
    "here we will discuss two known algorithms used in bloch wave calculations and propose new algorithms for improved convergence and efficiency of summation .",
    "the simplest one is based on a choice of beams `` by hand '' let s say on a base of visible spots in diffraction pattern , or all beams from a set of integer indices below certain cut - off , or beams on a systematic row , etc .",
    "for example , in @xcite we used a systematic row approximation both for secular equation and summation , i.e. , we picked only a set of @xmath24 beams along the systematic row of reflections .",
    "pragmatic hand - selection of beams is widespread in literature , see for example refs.@xcite .      in our previous work",
    "@xcite we suggested to choose beams on the base of their excitation error @xmath25 and extinction distances @xmath26 .",
    "their product forms a dimensionless variable @xmath27 , for which we set a cut - off criterion .",
    "this method picks beams that follow the ewald sphere and provides automatically a more economic and accurate description .",
    "a variant of this method uses two different cut - offs for the @xmath27 - one for the secular equation ( hundreds or thousands of beams ) and one for the summation ( 1015 beams ) .",
    "we can safely take a rather large set of beams in the first step  the solution of the secular equation ",
    "and then for the summation we pick only a subset of the beams and bloch waves .",
    "the selection of the subset of bloch waves is based on their norm within the subspace of beams selected for summation@xcite .",
    "this has been used in our more recent publications , e.g. , @xcite .",
    "both this approach and the manual selection of beams identify a set of beams and bloch waves and then they count all the cross - terms .",
    "i.e. , if we have @xmath28 beams and @xmath29 bloch waves , the summation runs over @xmath30 terms , which can be a huge number already for only 10 @xmath31-vectors and 10 bloch waves .",
    "a detailed inspection of these terms shows , that majority of them are actually negligible .",
    "that means , that we sum a lot of tiny terms , which is not only inefficient but also contributes to the propagation of machine rounding off errors .",
    "terms magnitudes as a function of number of @xmath31-vectors and bloch waves ( bw ) .",
    "[ fig : hist],width=321 ]    to illustrate the finding , we have set - up test calculations in a 3-beam orientation with @xmath32 and detector orientation @xmath33 . by setting the maximum @xmath34 for the secular equation , the program identified a list of 628 and 627 @xmath31-vectors for incoming and outgoing beams , respectively . for the summation we set the maximum @xmath35 , which filtered the list down to 12 and 14 @xmath31-vectors .",
    "these contained @xmath36 $ ] , @xmath37 $ ] , @xmath38 $ ] , @xmath39 $ ] , @xmath40 $ ] , @xmath41 $ ] , @xmath42 $ ] and @xmath43 $ ] .",
    "the outgoing beam included on top of that @xmath44 $ ] and @xmath45 $ ] . with the criterion of minimal norm of the bloch wave in the subspace of identified beams",
    "@xmath46 we got 5 and 9 bloch waves , while for criterion @xmath47 we got 9 and 14 bloch waves for incoming and outgoing beam , respectively . in total that makes above 57 million vs 354 million terms , per energy and thickness .",
    "the computing time of one thickness profile on a single 2.0  ghz intel pentium 4 xeon cpu was 45s vs 285s , respectively .    instead of increasing number of bloch waves",
    ", we also tested the effect of enlarging the set of @xmath31-vectors in summation by setting @xmath48 .",
    "the number of selected @xmath31-vecotrs grows to 22 and 20 , and some of the @xmath49 beams have nonzero @xmath50 ( higher order laue zones ) . keeping minimal norm for bloch waves @xmath46 we got 7 and 9 bloch waves . in total",
    "it gives 768 milions of terms , which were summed in 3886s .",
    "figure  [ fig : hist ] shows histograms of distributions of the sizes of all these terms .",
    "it turns out that if we want to assure that all of the , let s say , 1000 dominant terms ( for our fixed selection of beams ) are included in the summation , we are also including into the sum many millions of terms with much smaller magnitudes , majority of them having negligible influence on results . as we will show below",
    ", 1000 dominant terms might not always be enough in terms of convergence .",
    "then one can easily conclude that requiring a summation over , e.g. , @xmath51 dominant terms would require such a number of beams and bloch waves that we would end up summing billions of terms , greatly wasting computational resources .",
    ", width=321 ]    the new methods described below are designed to 1 ) avoid summation of negligible terms , 2 ) improve the scaling of the summation . they are built on top of the @xmath27 based selection of the beams for diagonalization , assuming that we take a sufficiently large set of beams for the secular equation , typically hundreds up to few thousands .",
    "new development is in the algorithm for selection of terms to be summed from the large set of beams and bloch waves , where no term is a priori rejected .",
    "the algorithm is controlled by a single cut - off criterion @xmath52 . in the first step",
    "we create lists of diads of the bloch coefficients , @xmath53 and @xmath54 , for incoming and outgoing beam , respectively .",
    "since none of @xmath55 or @xmath56 is larger than one , we can safely ignore all bloch waves , for which @xmath57 or @xmath58 .",
    "the resulting array is sorted according to decreasing magnitude using quicksort algorithm . in total , this step has computational complexity @xmath59 , where @xmath60 is length of the list of diads .",
    "the next step is creation of a list of quadruple products @xmath61 .",
    "this operation is @xmath62 , where @xmath63 is the number of the quadruples larger than @xmath52 , because the lists of diads were sorted by magnitude .",
    "the maximum number of failed comparisons is @xmath64 , where @xmath60 is the length of the longer of the two lists of diads formed in previous step .",
    "the list of quadruples is again sorted with quicksort algorithm , but this time first by the @xmath65-vector given by @xmath66 and then by magnitude .",
    "this operation costs @xmath67 operations .",
    "now we have prepared data for the final step , which is an identification and output of octuple products larger than @xmath52 and , simultaneously , output of the @xmath68 diads for the mdff calculation . thanks to the way , how we sorted the list of quadruples , we can serially process the list and output @xmath68 and corresponding octuples without actually holding the array of octuples in memory .",
    "the number of operations is @xmath69 , where @xmath70 is the number of octuples larger than @xmath52 .",
    "maximum number of failed comparisons is given by the number of @xmath68 diads , which is well below @xmath70 .",
    "as a graphical summary of the main steps of the algorithm , a schematic flowchart diagram has been plotted in fig .",
    "[ fig : flowchart ] .",
    "memory requirements are very favorable .",
    "most often , the largest arrays are the @xmath71 matrices used in the secular equation .",
    "the lists of quadruples rarely reach this lengths , only perhaps for extremely small @xmath52 of the order below @xmath72 .",
    "the octuples are never held in memory , since the array is created and output serially based on the favorable sorting of the list of quadruples .",
    "as will be shown below , @xmath70 can be orders of magnitude below the @xmath30 , even if naturally it has to be proportional to that .",
    "its value strongly depends on @xmath52 and it turns out that there is an approximately inverse proportionality between , i.e. , @xmath73 . tuning the @xmath52 allows to find a suitable compromise between the speed and accuracy , which will be discussed below .",
    "also note that we are selecting largest terms from a large set of beams , of the order of 1000 , which is not feasible to treat by above - mentioned methods .",
    "therefore it can happen that stricter selections of beams + including all cross - terms can lead to less accurate calculations , because some singular contributions of considerable magnitude beams can be missed .",
    "examples of such situations will be shown below .",
    "a modification of the algorithm is possible , if we take an advantage of the dipole - type asymptotic of the mdffs and the @xmath74 denominator . for large @xmath65-vectors",
    "the denominator suppresses the terms , therefore we can do an even more efficient rejection of the negligible terms .    in the dipole approximation mdff",
    "is proportional to @xmath75 where @xmath76 is a energy - resolved tensor dependent on density of states , local anisotropies and spin - orbit coupling and @xmath77 is an energy - resolved vector function of local magnetic properties @xcite .",
    "ignoring the energy dependence , the asymptotic behavior of mdff as a function of @xmath68 vectors is @xmath78 . combining this with the denominator @xmath74 accompanying every mdff",
    ", we obtain @xmath79 asymptotic behavior of terms .    in order to keep a dimensionless variable for the cut - off criterion",
    ", we attach to the lists of quadruples a factor @xmath80 , where @xmath81 and @xmath82 .",
    "a small complication arises from this choice , since it is possible that the ratio @xmath80 is larger than one for some larger scattering angles or energy losses . for such eventualities",
    "we need to make sure that our lists of diads have a ` reserve ' , i.e. , the cut - off for the list of diads needs to be reduced .",
    "we have implemented a cut - off @xmath83 for the list of diads , which is an arbitrary choice , yet it turned out to be both safe and not too costly , when compared to other list operations in the algorithm .",
    "the rest of algorithm is unchanged , only when outputting the list of selected octuples , we remove the asymptotic factor @xmath84 .    in the rest of the article",
    ", we use this modified automatic term selection algorithm ( mats ) .",
    "in this section we compare the various methods of performing the bloch waves summation and demonstrate some of new possibilities offered by the mats .      .",
    "top row corresponds to 30 nm sample thickness , bottom row is at 100 nm . from left to right various methods of calculation",
    "have been used , namely systematic row ( sr ) approximation , @xmath27-based beam selection ( wgbs ) and automatic term selection with mdff asymptotics ( mats ) with two different cut - offs ( see text for details ) .",
    "intensities are on a logarithmic scale.[fig : compare],width=321 ]    in systematic row geometries , many simulations have been performed by only choosing beams along the systematic row . however , depending on the tilt of the beam , some of the spots outside the systematic row can be weakly excited . that can be easily missed in the systematic row approximation . here",
    "we will show a simulation of a three - beam orientation for bcc iron with systematic row index @xmath32 . we will consider a beam tilt of approximately 5 degrees from @xmath85 zone axis orientation , which corresponds approximately to incoming beam orientation @xmath86 .",
    "let s compare precision and timing of a systematic row approximation ( sra ) , @xmath27-based beam selection ( wgbs ) and the mats . in the sra we included beams up to @xmath87 , in total 9 beams and the summation",
    "was performed over all 9 resulting bloch waves . in the wgbs , for the secular equation we set the @xmath27 cut - off to 100000 , which resulted in approximately 630 beams . for the summation",
    ", we used cut - off 300 , which was fulfilled by 814 beams . for the bloch waves we required the subspace norm to be larger than 0.01 , which was fulfilled by 427 bloch waves .",
    "finally , in the mats we tested for summation the following two cut - off criteria : @xmath88 and @xmath89 .",
    "the resulting diffraction patterns are summarized in fig .",
    "[ fig : compare ] .    regarding the computing costs , the fastest was the mats simulation with @xmath88 , which finished in 43 cpu hours .",
    "in this calculation , larger part of the time was spent in diagonalization of the secular matrices of dimension 630 .",
    "mats calculation with @xmath90 finished in 98 cpu hours .",
    "the sra calculation took considerably more time , despite being much less accurate : the 9-beam calculation finished in 561 cpu hours .",
    "note that here we are diagonalizing very small matrices , only 9-by-9 , therefore practically all the computing time is spent in summation .",
    "finally , the wgbs calculation required 2800 cpu hours , almost 70-times more than mats with @xmath88 , yet being of lower accuracy . while in our sra calculation we always sum @xmath91 terms , in mats with @xmath90 it was on average only @xmath92 , in maximum reaching half million .",
    "ratio maps ( bottom row ) a function of convergence parameter @xmath52 .",
    "calculations were performed for 20 nm layer of bcc iron in two - beam geometry with @xmath32 , at 300kev.[fig : conv],width=321 ]    electron magnetic circular dichroism ( emcd ) is a recently developed experimental technique @xcite , which uses elnes to extract the atom - specific magnetic characteristics , such as spin and orbital moments . for quantitative analyses it used sum rules @xcite , using",
    "which one can extract the ratio of orbital and spin moment of the studied atom @xcite .",
    "these properties are highly sensitive functions of the edge - dependent elnes spectra .",
    "similarly as in experiment , also in simulations there is a high demand for precision .",
    "below we will show the performance of mats for the similar setup as above , two - beam case with @xmath94 and beam tilt of 10 degrees , showing diffraction pattern , distribution of the magnetic signal and the map of the @xmath95 ratio as a function of the cut - off variable @xmath52 .    in more detail ,",
    "the distribution of the magnetic signal is obtained as a difference of the diffraction pattern and its mirror image with respect to the systematic row mirror axis . in the figure , it is shown as a relative quantity , that means it is divided by the sum of the diffraction pattern and its mirror image . in other words , it is an antisymmetric part of the diffraction pattern divided by its symmetric part . here we will not enter the discussions about the continuum signal extraction or post - edge normalization @xcite , since our main focus is the convergence of the bloch waves calculation .    the maps of the @xmath93 ratio are evaluated pixel - by - pixel from the magnetic signals @xmath96 and @xmath97 integrated over @xmath98 and @xmath99 edge regions , respectively , by the following formula @xcite @xmath100 intuitively , this should be a constant function throughout the diffraction plane .",
    "however , in fact , large variations occur due to asymmetries discussed in detail in @xcite .",
    "the map of the @xmath93 ratio is a highly sensitive function of the scattering cross - section and is an excellent test of the convergence properties of the newly developed method .",
    "we have used the same @xmath27 cut - off as in previous sub - section , but we have varied the @xmath52 from @xmath101 down to @xmath72 and recorded some statistic information about the number of terms included in the summation , table  [ tab : conv ] .",
    "note that , as anticipated , the number of summed terms is inversely proportional to @xmath52 .",
    "importantly , even at the most accurate calculation , the number of summed terms stays many orders of magnitude below @xmath102 , demonstrating the high efficiency of the selection of terms .",
    ".average lengths of double @xmath103 , quadruple @xmath104 and octuple @xmath105 product lists , average number of momentum transfer diads per energy step @xmath106 and computing times ( total and per - pixel average ) for maps in fig .",
    "[ fig : conv ] as a function of convergence parameter @xmath52 .",
    "times refer to a single intel pentium 4 xeon processor at 2.5ghz.[tab : conv ] [ cols=\"<,>,>,>,>,>,>\",options=\"header \" , ]     note that the diffaction pattern appears to be reasonably converged already for @xmath107 .",
    "an attentive reader might spot slightly fuzziness , but nevertheless , the differences between all five diffraction patterns are visually negligible .",
    "the relative difference map requires better convergence , at least @xmath108 , or better @xmath109 .",
    "note the numerical noise at @xmath108 , particularly along the vertical line going through the transmitted beam .",
    "although a slight fuzziness remains at @xmath108 , but the accuracy is already satisfactory . the most sensitive quantity presented here is the apparent @xmath93 ratio . since the orbital momentum in iron is small , the nominator in the sum rule expression is a difference of two ( typically small ) differences of spectra , integrated over @xmath99 or @xmath98 edge , respectivelly .",
    "it requires high accuracy to obtain well converged maps .",
    "calculation with @xmath109 seems to produce reasonably converged results .",
    "the only visible difference at @xmath110 , when compared to @xmath109 , appears around @xmath111 and @xmath112 positions .",
    "the results of calculation with @xmath113 are visually indistinguishable from @xmath110 .    looking back into the table  [ tab : conv ]",
    ", we see that for most of our purposes @xmath109 provides highly converged results at average costs 3-times lower than the simplest testing calculation discussed in sec .  [",
    "sec : wgbs ] .",
    "nevertheless , this criterion can depend on the studied crystal structure and orientation and always should be tested , when performing simulations of new systems .",
    "high efficiency of the mats method allows us to approach experimental geometries , which require a large number of beams for a converged simulation .",
    "particularly , the zone axis orientation is highly computationally intensive . here",
    "we will follow the development of the diffraction pattern , when tilting from an exact zone axis towards the 3-beam case with @xmath32 in small steps of the tilt .",
    "extremely rich patterns are observed , particularly when looking at the distribution of the magnetic signal , with formation of a dense network of kikuchi bands and lines .",
    "the @xmath27 cut - off was the same as in previous sections , the @xmath52 was set to @xmath114 , leading to well converged diffraction patterns and maps of the magnetic signal , as demonstrated in sec .",
    "[ sec : conv ] .",
    "we chose to demonstrate the results at a sample thickness 50 nm , because at this thickness the kikuchi patterns appear sharp enough , yet not so sharp that we would observe aliasing artefacts due to discrete grid of pixels .",
    "the incoming beam is gradually tilted from an exact zone axis @xmath85 direction towards the 3-beam orientation via @xmath115 degrees , @xmath116 degrees , @xmath117 degrees and @xmath118 degrees tilt . at the endpoints we also did calculations with manual selection of beams . for the exact zone axis case we included",
    "kinematically allowed @xmath31-vectors from the zero - order laue zone ( zolz ) with @xmath49 indices less than 4 ( in total 25 @xmath31-vectors ) and for the final 3-beam orientation we included beams of up to @xmath119 ( in total 11 @xmath31-vectors ) .",
    "zone - axis orientation to 3-beam orientation @xmath120 . left halfplane of zone axis orientation is calculated with 25-beams , right half - plane of 3-beam orientation is calculated with 11 beams on the systematic row ( see text for details ) .",
    "note the differences from mats calculations.[fig : zatilt],width=321 ]    the results are summarized in fig .",
    "[ fig : zatilt ] . at the zone axis orientation",
    "we see a rich pattern , consisting of bragg spots and multitude of kikuchi bands and lines .",
    "the kikuchi pattern is even better visible on the map of the magnetic signal .",
    "number of thin lines with varying intensity and sign form a rich symmetric structure .",
    "now let s compare them to a calculation with 25 @xmath31-vectors from zolz .",
    "the diffraction pattern seems to display the same structure , except for higher intensity .",
    "a cautious eye would spot some differences in relative intensity around @xmath121 spots .",
    "more differences can be seen in the maps of the magnetic signal . particularly at larger scattering angles ,",
    "the pattern of kikuchi lines is more rich in the mats description .",
    "as we tilt the beam , the pattern of beams is deforming , following the movement of the zone axis spot down . at beam tilt",
    "@xmath122 degrees , corresponding to approximately 25  mrad , the zone axis spot moved down by a bit less than @xmath123 .",
    "the two - fold bragg angle corresponding to @xmath32 in bcc iron is 13.8  mrad , therefore the @xmath124  mrad , which agrees with the position of the zone axis spot in the map .",
    "the dominant kikuchi bands are passing around this spot . in the map of the magnetic signal a noise - like signal forms around the zone axis center , and at the same time",
    ", there evolves a different dominant sign in the four quadrants of the diffraction plane .",
    "both these trends continue with the tilt @xmath125 degrees .",
    "the zone axis spot has weaker intensity , moves further down , to around @xmath126 under the transmitted beam .",
    "at this angle and thickness , we see relatively strongly excited beams for @xmath127 and @xmath128 , i.e. , spots under the systematic row of reflections . at @xmath129 degrees tilt the zone axis spot is outside the vertical range of our maps , we see a clean 3-beam pattern , with some intensities at @xmath130 and @xmath131 .",
    "maps of the magnetic signal are considerably simpler , having a dominant sign in each quadrant .",
    "the four vertical lines represent kikuchi lines .",
    "skew lines at larger scattering angles show unexpectedly high magnetic signal , which might be a finding of potential practical importance .    at the final step , almost @xmath132 degrees tilt the patterns complete the trends : three strongly excited spots along the systematic row , and three dominant kikuchi bands .",
    "magnetic signal showing the four vertical lines with signs corresponding to their quadrants .",
    "interesting is a comparison to a systematic row approximation , where we used only 11 @xmath31-vectors  multiples of the @xmath32 .",
    "these patterns completely miss the skew kikuchi bands and in the maps of the magnetic signal there is a very reduced pattern of lines .      a similar but alternative computer program which calculates inner - shell ionization and backscattering cross sections for fast electrons incident on a crystal is available , known as the icsc code , developed by oxley and allen @xcite .",
    "the program calculates the inelastic scattering coefficients for inner - shell ionization , pertinent to eels and energy dispersive x - ray ( edx ) analysis , using parameterizations of the atomic inelastic scattering factors .",
    "the program treats the dynamical scattering in a very similar way to mats , but simplifies the calculations of dynamical form factors , using the approximation where the integration over all the final states of the scattered electron is replaced by an analytic expression , which unfortunately does not cover mdff calculation .",
    "this means that the icsc code only allows the eels detector geometry concentric with the incident beam direction .",
    "the icsc code has been intensively tested for edx results of atom location by channeling enhanced microanalysis ( alchemi ) , but little was published in testing the icsc program for experimental eels .",
    "it is thus a good chance for comparing between the two methods .    as a benchmark we selected a cubic sic crystal and the orientation dependent si k - edge cross sections",
    "were compared .",
    "we have done two sets of calculations : 1 ) thickness dependence in a beam - rocking experiment in a systematic row orientation , and , 2 ) 2-dimensional beam - rocking in a ( 001 ) zone - axis orientation . in both cases",
    ", we selected parallel illumination and convergence angle of 10  mrad .",
    "the acceleration voltage was set to 300  kev .",
    "icsc uses doyle - turner scattering factors @xcite , therefore for the sake of consistency , we used these also in calculations with the new code .",
    "and the vertical axis is thickness in nm .",
    "a ) icsc calculation , b ) calculation with the new code , adopting the same parameters as icsc , c ) mats calculation.[fig : icsc_sr],width=321 ]    in the systematic row calculation , we assumed a beam tilt of approximately 10 degrees towards the @xmath133 systematic row conditions , i.e. , the zone axis was @xmath134 .",
    "for icsc we used as set of 85 beams @xmath135 . with the new code",
    "we did two sets of calculations - one with the fixed set of 9 beams from the systematic row ( sr ; up to @xmath136 ) and another in the mats approach with convergence parameter @xmath114 .",
    "results are summarized in fig .",
    "[ fig : icsc_sr ] .",
    "the results show good qualitative agreement , yet there are clear differences in details , even when comparing the icsc calculation to a sr calculation .",
    "that indicates that approximations introduced in icsc partially neglect some details of the dynamical diffraction process .",
    "full mats calculation shows expectedly even more of a fine structure , especially at larger thicknesses .",
    "detailed comparison to experiment would be needed to verify the fine features observed in mats calculation .",
    "zone - axis orientation as a function of beam rocking .",
    "axes corresponds to a beam tilt in multiples of @xmath32 .",
    "a ) icsc calculation at 100  nm , b ) calculation with the new code , adopting the same parameters as icsc , c ) mats calculation at 100  nm , d)-f ) the same as a)-c ) , but at 200  nm.[fig : icsc_za],width=321 ]    the dependence of the double - differential scattering cross - section on beam rocking from the @xmath85 zone axis orientation is shown in fig .  [",
    "fig : icsc_za ] .",
    "the icsc used results are shown in the left column .",
    "a set of 197 beams was used , all from the zero - order laue zone .",
    "the same ones were used for comparison with the new code ( shown in the middle column ) . finally , results obtained by the mats method are shown in the right column .",
    "general qualitative features are in good agreement between all three computational approaches , nevertheless , as in the systematic - row orientation , also here we observe notable differences .",
    "of particular interest is a soft breaking of the four - fold symmetry in the case of mats calculations .",
    "it is easier to spot at 100  nm , where the central intensity maximum has a slighly prolate shape along the main diagonal of the pattern .",
    "this can be explained by presence of beams from higher - order laue zones in the secular equation .",
    "they introduce @xmath137 beams with @xmath138 and due to the curvature of the ewald sphere , @xmath137 and @xmath139 have different excitation errors and thus their corresponding bloch coefficients differ . in combination with the four - fold screw axis of this structure and a lack of inversion symmetry , the resulting beam - rocking pattern shows deviation from four - fold symmetry .",
    "we have developed a new method for accurate summation over bloch waves and their plane wave components ( beams ) named modified automatic term selection ( mats ) .",
    "the complexity of mats scales inversely proportionally with the cut - off for the term sizes .",
    "it allows highly accurate calculations at much lower computational costs compared to previous methods .",
    "we have demonstrated advantages of the method on capturing the intensity of the weakly excited spots outside the systematic row .",
    "the convergence properties of mats were studied on a two - beam case simulation with focus on faint effects observed in emcd experiments .",
    "a rich pattern of kikuchi bands and lines was presented in a simulation of a tilting of the bcc crystal from the zone axis orientation to a three - beam orientation .",
    "we have also compared the new method to icsc code and both display qualitatively the same results . in more detail",
    ", mats calculation seems to provide more rich structures , most likely due to larger number of beams included in the secular equation .",
    "j.r .  acknowledges the support of swedish research council and stint .",
    "simulations were performed on computer cluster david of czech academy of sciences .",
    "this work was in part supported by the grant - in - aid for scientific research from mext , japan ."
  ],
  "abstract_text": [
    "<S> we discuss in detail the bloch waves method for calculation of energy and orientation dependent scattering cross - section for inelastic scattering of electrons on crystals . </S>",
    "<S> convergence properties are investigated and a new algorithm with superior timing and accuracy is described . </S>",
    "<S> the new method is applied to calculations of intensity of weakly excited spots , maps of magnetic signal , and tilt series from zone axis orientation towards three - beam orientation . </S>"
  ]
}