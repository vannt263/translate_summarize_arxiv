{
  "article_text": [
    "fmos ( the fiber multi - object spectrograph ) is a near - infrared ( nir ) fiber - fed spectrograph for the subaru telescope , which is capable of collecting nearly 400 spectra in a @xmath1 deg@xmath2 field - of - view ( @xcite ) available at the prime - focus of the telescope .",
    "the 400 fibers are divided into two groups of 200 fibers and connected to the two spectrographs , irs1 ( infra - red spectrograph ) and irs2 , for spectroscopy .",
    "a feature of fmos is the suppression of bright oh - airglow emission lines using oh mask mirrors , which reduce the oh - airglow emission lines by more than @xmath11 ( @xcite ) .",
    "since these airglow lines are the largest noise source in the nir region , the oh suppression allows fmos to perform nir spectroscopic observations with a substantially reduced background level .",
    "nir spectroscopy is a useful probe for a variety of topics in astronomy .",
    "the detection of emission lines ( e.g. , h@xmath3@xmath12 , [ nii]@xmath13 , [ oiii]@xmath14 ) ) in galaxies provide us with information on diverse galaxy properties including the redshift , star formation rate , metallicity and ionisation state .",
    "a cosmological redshift survey , fastsound , is ongoing , using fmos to measure @xmath15 redshifts of star - forming galaxies at @xmath16 from h@xmath3 lines over a total area of @xmath17 ( @xcite ) .",
    "the main science goal is the measurement of redshift space distortion ( rsd ) for the first time in this redshift range , to measure the structure growth rate as a test of general relativity on cosmological scales ( see , e.g. , @xcite ; @xcite ; @xcite ; @xcite ; @xcite ; @xcite ; @xcite for recent galaxy redshift surveys whose scientific targets include rsd ) .",
    "a key for studies treating many emission line galaxies in a large data set is to automatically search and detect emission lines . in the case of fmos ,",
    "residual oh airglow lines just outside the oh mask regions and cosmic rays often show spectral shapes similar to those of real emission lines .",
    "if such spurious line detections are included into a statistical sample of emission lines , they will cause a systematic error in , e.g. , measurements of galaxy clustering power spectra .",
    "therefore , an efficient automatic line detection software with minimized probability of false detection is highly desirable .    in this paper",
    ", we present the development of an emission line detection software for fmos spectroscopy , field ( fmos software for image - based emission line detection ) .",
    "two - dimensional spectral images for each fiber are used in this algorithm in order to detect faint emission line features , while efficiently filtering out unwanted spurious detections .",
    "we examine the performance of this routine by applying it to a part of the fastsound project data .",
    "we test various parameters about shapes of emission lines in the 2d spectral images , to cut spurious objects efficiently .",
    "the contamination fraction of spurious objects is estimated by inverted 2d spectral images , which are obtained by exchanging object frames and sky frames .    in section [ sample ]",
    ", we describe the data used in this work . in section [ method ] , we present the algorithm for detecting emission line candidates and describe key features that effectively reduce false detections caused by residual oh emission lines and cosmic rays .",
    "the results are presented in section [ results ] and we summarize this work in section [ conclusion ] .",
    "the targets for fmos spectroscopy were selected using photometric redshift and h@xmath3 flux estimates using @xmath18 data of canada - france - hawaii telescope legacy survey ( cfhtls ) wide ( @xcite ; @xcite ) .",
    "observations are done with the normal - beam - switch ( nbs ) mode of fmos , in which the object frame is taken using nearly all @xmath0 fibers for targets , followed by an offset - sky frame with the same fiber configuration . in fastsound ,",
    "the exposure time for one frame is @xmath19 s , and two frames ( i.e. , total exposure of @xmath20 min ) are taken both for the object and sky frames .",
    "we use the high - resolution ( hr ) mode with spectral resolution of @xmath21 and the wavelength range of @xmath22@xmath23 m .",
    "the detector size is 2k@xmath242k , and the pixel scale is @xmath25}$ ] .",
    "the primary fmos data set used in this paper are eight fmos field - of - views ( fovs ) observed during march 2829 and april 12 of 2012 , as part of the fastsound project .",
    "the fastsound field ids are w2_041 , 062 , and 063 from the cfhtls w2 field , and w3_162 , 163 , 164 , 177 , and 192 from w3 .",
    "( see a forthcoming fastsound paper tonegawa , in prep . for details of the fastsound observations . )",
    "fmos fibers were allocated to @xmath26 galaxies in the eight fmos fovs and the emission line detection rate is typically @xmath27 as reported in tonegawa et al .",
    "the mean seeing is @xmath28 in the @xmath29 band .",
    "these eight fovs are representative of fastsound data in normal observing conditions .    in rare cases ( four out of @xmath30 fovs in the fastsound project ) ,",
    "images taken by irs2 spectrograph just after sunset show unusual dark patterns on the edge of detector , likely because of the instability of detector resulting from overexposures by dome - flat lamp or twilight .",
    "these patterns usually appear vertically in the left end ( @xmath22@xmath31 m ) of the image , but sometimes appear horizontally in the top or bottom end . though the fraction of such data is not large in the total fastsound data set , line detection must be affected in these regions . hence we also examine the performance of our software in these four fovs in these bad conditions .",
    "these are w2_042 ( taken in 2013 feb . ) , w3_173 ( 2012 apr . ) , w3_206 and 221 ( 2012 jun . ) .",
    "the fmos two - dimensional raw data are reduced with the standard data reduction pipeline , _ fibre - pac _ ( iwamuro et al , 2012 ) . in fmos images ,",
    "the @xmath32-axis is used for the wavelength direction , and @xmath33 pixels are assigned in the @xmath34-axis direction for each fiber .",
    "the profile in the @xmath34-axis is just the point spread function ( psf ) of light from a fiber .",
    "first , sky subtraction is performed for each frame . in order to trace the time - variance of sky background",
    ", the linear combination of two sky frames is used for the subtraction .",
    "after sky subtraction , the bias difference between the four detector quadrants , cross talk , bad pixels , distortions , and residual oh lines are corrected .",
    "the two images are then combined into the total exposure .",
    "the wavelength calibration is applied by making a correlation between @xmath32-axis and physical wavelength using images of a th - ar lamp .",
    "_ fibre - pac _ creates not only a science frame from object and sky images , but also square - noise and bad pixel maps for each fov ( figure 1 ) .",
    "the square - noise map gives the square of noise level of each pixel , which is measured using @xmath35 pixels around each pixel along the @xmath34-axis with a @xmath36 clipping algorithm iterated ten times .",
    "the bad pixel map indicates the quality of each pixel by a value between between @xmath37 ( bad ) and @xmath38 ( normal ) .",
    "those pixels on the detector flagged as non - functioning by _ fibre - pac _ and temporally prominent pixels appearing in one exposure ( by cosmic ray events in most cases ) are rejected and replaced in the science frames , by an interpolated value from surrounding pixels ( @xcite ) .",
    "these pixels are stored as a bad pixel map for each exposure of @xmath39 min .",
    "our exposure time is @xmath20 min , and hence we have two bad pixel maps for each field - of - view .",
    "when these two maps are combined , true defects of the detector are presented as the value @xmath37 on the bad pixel map because they appear in both of two bad pixel maps , while cosmic rays have a value of @xmath40 because they affect only one of the two science sub - frames .",
    "the information from the square - noise and bad pixel maps are utilized in the line detection algorithm presented below .    as well as the normal science frame",
    ", we also create an  inverted \" science frame by exchanging object and sky frame in the _ fibre - pac _ procedures .",
    "the line detection algorithm is also applied to this inverted science frame .",
    "any candidates detected in this inverted frames will not be genuine features , because real emission lines are negative in the frame and absorption lines are usually below the detection limit of fmos for galaxies beyond @xmath41 .",
    "therefore we can reduce the overall false detection rate by tuning the software to minimize the detection rate in the inverted frames .",
    "( 80mm,80mm)figure1a.eps ( 80mm,80mm)figure1b.eps    our goal is to automatically detect spectral features corresponding to emission lines from the fmos data with high reliability . to achieve this , we develop an emission line detection algorithm which is based on a convolution of the fmos 2-d spectral images weighted by a detection kernel that is similar to the typical emission line profile ( see , e.g. , @xcite for similar approaches ) .",
    "note that we do not use the flux - calibrated 1-d spectra for emission line detection because they do not retain the 2-d shape of the psf , which is useful to filter out false detections .",
    "the algorithm uses a flat - field image , square - noise map and bad pixel map as well as the science frame ( see  [ sample ] ) . the science frame and square - noise map are both convolved with the kernel , producing an effective signal - to - noise ( @xmath6 ) ratio of a line centered at each pixel along the wavelength direction .",
    "the flat - field image and bad pixel map are used to remove the oh mask regions or bad pixels from the calculation of @xmath6 , so that the false detection rate is minimized",
    ".      an important feature of the fmos spectra in the nir is the hardware suppression of the the oh airglow .",
    "inclusion of the masked regions does not improve the line detection efficiency , and the noise level is often particularly high at the border of oh masks , which would have a negative effect for efficient line detection . to remove such regions , we utilize the dome - flat image .",
    "the dome - flat image is divided by the detector - flat image to correct for different quantum efficiency between pixels ( @xcite ) .",
    "after normalization , the flat - field image have values of @xmath42 at normal pixels , while @xmath43 at oh mask regions .",
    "we then make a new square - noise map by dividing the original square - noise map by this flat image .",
    "this operation increases the noise level inside and around oh mask regions by a large factor , making such regions ineffective in the line @xmath6 calculation ( see the next subsection ) .",
    "this approach is better than , e.g. , simply removing oh mask regions by wavelength information , because the detailed performance of the oh mask depends on the temperature of fmos instrument that changes with time .",
    "however , the effect of noisy regions around the border of oh masks can not be completely removed by this operation , and hence we further remove the pixels whose original noise level ( before dividing by the flat image ) is higher than the mean by more than @xmath44 , from the line @xmath6 calculation .    in order to decrease the chance of detecting cosmic rays and detector defects , we use of the bad pixel map ( figure [ figure : fmosimage ] ) . since the bad pixel map has values of @xmath42 at good pixels , @xmath43 at defects , and @xmath45 at pixels hit by cosmic rays , we exclude the pixels having values lower than @xmath46 in the bad pixel map from the line @xmath6 calculations .",
    "finally , the continuum component of galaxies may affect the detection efficiency of emission lines .",
    "therefore the continuum component of each spectrum in the object frame was subtracted by applying fit1d task of iraf with a 5th - order chebyshev polynomial along the wavelength direction .",
    "this procedure was adopted separately for each pixel along the vertical direction perpendicular to wavelength .",
    "we define the detection kernel by a two - dimensional gaussian that imitates the typical shape of an emission line : @xmath47\\ ] ] where @xmath48 and @xmath49 are the typical dispersion of emission lines along @xmath32-axis ( corresponding to wavelength ) and @xmath34-axis ( corresponding to the fiber aperture ) on the detector .",
    "although @xmath48 and @xmath49 are adjustable , we fix @xmath50 [ pix ] as the quadratic sum of the spectral resolution of fmos ( @xmath51  fwhm at @xmath52 m in the hr mode ) and the typical velocity dispersion of galaxies ( @xmath53 fwhm ) , and @xmath54 [ pix ] as representative of the fmos fiber profile on the detector . because fmos is a fiber - fed spectrograph , @xmath49 is just an instrumetal spread of light from fibers without spatial information of target objects .    for each pixel @xmath55 , we define the signal @xmath56 of a supposed line centered at the pixel as : @xmath57 which is an integration over pixels @xmath58 around @xmath55 confined within the region @xmath59 .",
    "this region is an ellipse whose center is @xmath55 and the radii along the major and minor axis are @xmath60 [ pix ] and @xmath61 [ pix ] .",
    "the parameter @xmath3 is the best - fit flux normalization of this kernel to the observed count @xmath62 in the pixels in @xmath59 : @xmath63 which can be derived by minimizing @xmath64 , where @xmath65 ^ 2}{n_i^2 } \\ , \\ ] ] where @xmath66 is @xmath67 noise at @xmath68-th pixel from the noise - square ( @xmath69 ) map . from the expression for @xmath3",
    ", it can be understood that the signal @xmath56 ( equation [ s ] ) is a convolution of the count @xmath62 with the detection kernel , weighted by @xmath70 .",
    "we then define the noise @xmath71 for the line ; since @xmath56 is a linear combination of @xmath62 whose noise is @xmath66 , its statistical error can be calculated as : @xmath72 then the signal - to - noise ratio @xmath6 is simply calculated from @xmath56 and @xmath71 .    the @xmath6 is calculated along the wavelength direction , with @xmath73 fixed at the central pixel ( @xmath74 ) among the 9 pixels for one fiber .",
    "when a certain pixel has a local peak of @xmath6 map , the pixel is likely to be the center of an emission line feature .",
    "therefore , we select emission line candidates by extracting pixels with @xmath6 values higher than a threshold and locally greatest within the range of @xmath7530 pixels from @xmath76 along the wavelength direction . the latter condition is introduced to avoid multiple detections of the same line - like feature .",
    "although the use of @xmath7530 pixels as the minimum separation is a simplistic approach , it suffices for fastsound , because the closest lines ( h@xmath3@xmath12 and [ nii]@xmath13 ) at @xmath16 are separeted by @xmath77 [ pix ] on the image .",
    "more sophisticated methods to discriminate multiple lines , such as connected - pixel approach , will be examined in future work .",
    "the selection threshold can be changed by the user : if one increases the threshold , the number of false detections decreases but the number of real lines would also be reduced .",
    "the false detection rate and its dependence on the threshold are discussed in  [ results ] .",
    "the image shape of each candidate line includes important information that allows discrimination between real and false lines .",
    "we measure the following shape parameters :    \\(1 ) center along @xmath34-axis : @xmath78 ( 2 ) dispersion along @xmath34-axis : @xmath79 ( 3 ) fraction of positive pixels : @xmath80 where @xmath81 is a step function ( 1 for @xmath82 and 0 otherwise ) .",
    "+ ( 4 ) position angle of the major axis of an elliptical fit : @xmath83 ( 5 ) axis ratio of the elliptical fit : @xmath84 where @xmath85 and @xmath86 are semi - major and minor axes , respectively .",
    "+ ( 6 ) signal - to - noise fluctuation per pixel : @xmath87 where angle brackets denote the mean over the region @xmath59 .",
    "we applied our algorithm to an  inverted \" science frame , obtained by running the fmos image reduction pipeline with the object and sky frames exchanged , as well as the  normal \" science frame .",
    "all the candidates in the inverted frames must be spurious , and their statistical nature should be the same as the spurious features in the normal frames , because the analysis procedures are exactly the same except for swapping the object / sky frames .",
    "for example , residual oh emission lines in the science frame can be positive or negative at the same probability depending on the observing conditions , and cosmic rays fall randomly both on the object and sky frames .",
    "note that an emission line galaxy can accidentally fall in a fiber during the sky exposures , but we did not take these cases into account , because the possibility should be small .",
    "figure [ figure : param ] shows the distribution of the shape parameters defined above , as a function of @xmath6 , both for the normal and inverted frames .",
    "it is found that in some regions ( especially for the data in the 4 fovs at the bad condition in the plots of @xmath88 , @xmath89 , @xmath90 , and @xmath91 plots ) the number of inverted - frame objects is relatively large compared with the normal - frame objects , and the numbers in normal / inverted frames are similar .",
    "false lines are expected to be dominant over real lines in such regions , and hence we introduced an event cut as shown by the solid curves in the figure .",
    "these conditions are expressed as : @xmath92 it should be noted that the region of many inverted - frame objects is also found in the plot of minor / major axis ratio .",
    "we did not include a condition on this quantity , because we found that almost all of the false objects in this region are effectively removed by the other three conditions .",
    "we also examined the spectral images of the rejected events by eye , and confirmed that false detections do indeed dominate .",
    "these events mainly arise from unusual dark patterns appearing in the bad - condition four fovs , when the detector was in an unstable state .",
    "examples of emission line candidates detected by the software are shown in figure [ figure : sample ] .",
    "( 75mm,75mm)figure2a.eps ( 75mm,75mm)figure2b.eps ( 75mm,75mm)figure2c.eps ( 75mm,75mm)figure2d.eps ( 75mm,75mm)figure2e.eps ( 75mm,75mm)figure2f.eps    ( 80mm,66mm)figure3a.eps ( 80mm,66mm)figure3e.eps ( 80mm,66mm)figure3b.eps ( 80mm,66mm)figure3f.eps ( 80mm,66mm)figure3c.eps ( 80mm,66mm)figure3g.eps ( 80mm,66mm)figure3d.eps ( 80mm,66mm)figure3h.eps",
    ".detected line candidate statistics for the eight fovs under normal condition . [ cols=\"^,^,^,^\",options=\"header \" , ]     [ table : linestat ]    in table [ table : linestat ] , the number of emission line candidates in the eight fovs under normal condition is shown for three different thresholds of @xmath6 , both for the normal and inverted frames .",
    "there is only one false - detection in the inverted frame above @xmath93 , indicating that the false detection rate should be less than 1% at @xmath8 .",
    "we inspected the seven detections in the inverted frame at @xmath94 by eye , and found that five were close to oh mask region , one at the edge of the detector , and the other one due to a cluster of hot pixels that shows a collective instability because of high dark current .",
    "although the line detection algorithm suppresses the contribution to @xmath6 from the oh mask region , strong residual oh emission often remains because of unstable oh airglow in the nir , resulting in a small fraction of false detections . since the events at the border of oh masks are the major source of the false detections , more strict cuts in such regions may further improve the fraction of real lines .",
    "the cumulative @xmath6 distribution of emission line candidates are displayed in figure [ figure : snhist ] .",
    "the lower limit to the number of real emission lines can be estimated from the difference between the normal and inverted frames , i.e. , red and blue lines .",
    "( they are lower limits because the line detection completeness is not 100% by statistical fluctuation and oh mask effects .",
    "see the next paragraph . )",
    "one can see that the number of detections sharply increases with decreasing @xmath6 under @xmath95 , but this is mainly due to the increase of false detections in the inverted frame .",
    "the wavelength of the detected lines are plotted against @xmath6 in figure [ figure : zhist ] .",
    "again , we see a tendency for detections in the inverted images to be close to the oh mask regions , indicating that residuals from the oh airglow is one of the major reasons for false detections .",
    "the completeness of detection , i.e. , the probability of successful detection for a given real emission line is also an important statistic to evaluate the performance of the software . to estimate this we ran a simulation by placing artificial objects and then applying our detection algorithm .",
    "the completeness against input brightness ( @xmath6 ) is displayed in figure [ figure : completeness ] , for some different values of detection @xmath6 thresholds .",
    "the completeness does not reach 100% but stays lower than 90% at large input @xmath6 , and this can be explained by the effect of oh masks that cover about 20% of the observed wavelength range .",
    "indeed , we confirmed that the completeness becomes close to @xmath96 when we carried out the same simulation excluding the oh mask regions .",
    "the completeness is about 40% for the input @xmath6 same as the adopted @xmath6 threshold , which is a reasonable result expected from statistical fluctuation and the oh mask effect .",
    "it should be noted that we assumed the same gaussian psf as the kernel described in  [ subsection : algorithm ] for the artificial objects distributed in the simulation .",
    "though the kernel is set to be similar to typical line profiles , the completeness for real emission galaxies is expected to be lower than this .",
    "a quantitative estimate of the completeness including this effect would be model dependent about the line profile distribution of a galaxy sample , which is beyond the scope of this work .",
    "( 80mm,80mm)figure4a.eps ( 80mm,80mm)figure4b.eps    ( 160mm,80mm)figure5.eps    ( 80mm,80mm)figure6.eps",
    "in this work we developed an automated emission line detection software for fmos on the subaru telescope , using the data from the fastsound project , targeting h@xmath3 emission line galaxies at @xmath16 .",
    "emission line detection is based on @xmath6 obtained by a convolution between the two - dimensional science frame and a line - profile kernel .",
    "a unique feature of the software for the fmos data having many oh airglow suppression masks is the amplification of noise level ( and consequent suppression in the @xmath6 calculation ) in the masked region by use of a flat - field image .",
    "bad pixels on the detectors and pixels affected by cosmic - rays are removed from the @xmath6 calculation .",
    "we also calculated six shape parameters for the detected lines , and these are used for further rejection of false detections .",
    "this is particularly useful to remove those spurious sources caused by unusual dark patterns when the detectors are in unstable condition .",
    "the efficiency and reliability of the line detection were examined by applying the method to inverted science frames obtained by exchanging the object and sky images in the reduction process .",
    "the false - detection rate is @xmath97 , @xmath98 and @xmath99 for @xmath6 above @xmath100 , @xmath101 , and @xmath102 , respectively .",
    "the emission line flux corresponding to @xmath103 is about @xmath104}$ ] in normal condition .",
    "the software is open to the community , and currently available on request to the authors .",
    "blake ,  c. ,  2011 , , 415 , 2876 beutler ,  f. ,  2012 , , 423 , 3430 de la torre ,  s. , guzzo ,  l. , peacock ,  j.  a. ,  2013 , , 557 , a54 guzzo ,  l. ,  2008 , nature , 451 , 541 gilbank ,  d.  g. , baldry ,  i.  k. , balogh ,  m.  l. , glazebrook ,  k. , & bower , r.  g.  2010 , , 405 , 2594 gwyn , s.  d.  j 2012 , a&a , 143 , 38 hawkins ,  e. ,  2003 , , 346 , 78 iwamuro ,  f. , motohara ,  k. , maihara ,  t. , hata ,  r. , & harashima ,  t.  2001 , , 53 , 355 iwamuro ,  f. ,  2012 , , 64 , 59 kimura ,  m. , maihara ,  t. , iwamuro ,  f. ,  2010 , , 62 , 1135 reid , b.  a. ,  2012 , , 426 , 2719 samushia ,  l , percival , w.  j & raccanelli ,  a 2013 , , 420 , 2102 tonegawa ,  m. , totani ,  t. , akiyama ,  m. ,  2014 , , 66 , 43"
  ],
  "abstract_text": [
    "<S> we describe the development of automated emission line detection software for the fiber multi - object spectrograph ( fmos ) , which is a near - infrared spectrograph fed by @xmath0 fibers from the @xmath1 deg@xmath2 prime focus field of view of the subaru telescope . </S>",
    "<S> the software , field ( fmos software for image - based emission line detection ) , is developed and tested mainly for the fastsound survey , which is targeting h@xmath3 emitting galaxies at @xmath4 to measure the redshift space distortion as a test of general relativity beyond @xmath5 . the basic algorithm is to calculate the line signal - to - noise ratio ( @xmath6 ) along the wavelength direction , given by a 2-d convolution of the spectral image and a detection kernel representing a typical emission line profile . </S>",
    "<S> a unique feature of fmos is its use of oh airglow suppression masks , requiring the use of flat - field images to suppress noise around the mask regions . </S>",
    "<S> bad pixels on the detectors and pixels affected by cosmic - rays are efficiently removed by using the information obtained from the fmos analysis pipeline . </S>",
    "<S> we limit the range of acceptable line - shape parameters for the detected candidates to further improve the reliability of line detection . </S>",
    "<S> the final performance of line detection is tested using a subset of the fastsound data ; the false detection rate of spurious objects is examined by using inverted frames obtained by exchanging object and sky frames . </S>",
    "<S> the false detection rate is @xmath7% at @xmath8 , allowing an efficient and objective emission line search for fmos data at the line flux level of @xmath9[erg / cm@xmath2/s ] . </S>"
  ]
}