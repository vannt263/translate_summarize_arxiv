{
  "article_text": [
    "the burgeoning volume of multiwavelength galaxy observations reveals an interactive complexity of patterns that couple merging , environmental interaction , enhanced epochs of star - formation , and gas accretion histories ( e.g. * ? ? ?",
    "each mass component ",
    "dark matter , stellar and compact objects , atomic and molecular gas  is sensitive to different although overlapping ranges of length and time scales .",
    "key to piecing together these complex interactions is an understanding of the mutual dynamical evolution of each component . for gas in particular , winds , accretion flows and other collisionally - induced structures often produce phase interfaces at shocks .",
    "not only do the density enhancements at these shocks result in radiative cooling and instabilities , these enhancements provide gravitational _ handles _ for momentum transfer and torques .    more generally , galaxies are particularly sensitive to the conditions in _ transitional _ regimes .",
    "these transitions occur in density ( e.g. between galaxy components ) , gas temperature and gravitational acceleration .",
    "for example , on the largest scales , the standard model predicts that gravitational potential of a galaxy is dominated by dark matter .",
    "the baryons in the halo are rarefied with a temperature characteristic of the escape velocity from the halo , approximately @xmath0 degrees k. moving inwards , there is a transition between the baryon - dominated stellar and gaseous galaxy and the collisionless dark halo . in this region",
    ", the gravitational dynamics of both components may conspire to produce structure .",
    "the increased gas density shortens the atomic and molecular cooling time , producing a dense cold gas layer .",
    "this implies that there must be an interface of coexistence between the discrete rarefied and dense phases .",
    "finally , each of these gas phases and the gravitationally dominant collisionless components has a characteristic length and time scale that produces a range of accelerations .",
    "these transitions regions provide tests of the standard and alternative galaxy formation hypotheses .",
    "in particular , numerical simulations based on the standard @xmath1cdm scenario have made a variety of predictions on small galactic scales with both successes and failures .",
    "however , first - principle physical simulations are often infeasible at the scales where many of the failures occur , so at this point , the failures may either intrinsic or methodological .",
    "alternately , some propose that the root cause of the failures may be the nature of gravity itself and that _ modified newtonian dynamics _ ( mond ) produces a better prediction of observed rotations curves than standard @xmath1cdm .",
    "since the outer galaxy will be dominated by dark matter in the standard scenario or by non - newtonian forces in mond , the response in the outer galaxy to the dynamics may provide a sensitive test for these hypotheses .",
    "in addition , the temporal differences between the collisionless and collisional responses of media within each galaxy component provides clues to the history of a galaxy s evolution that depend on the underlying cosmogony .",
    "for example , the gas responds over several hundred million years to a disturbance in the stellar and dark - matter response to an external perturbation taking place over gigayears .",
    "the observation of both responses _ together _ can provide key diagnostics to the evolutionary history and possibly the underlying physics .    unfortunately , these transition regions are difficult to simulate reliably . therefore , the most productive use of the combined dsmc ",
    "n - body hybrid code will be the investigation of interface dynamics and energetics on small and intermediate scales .",
    "an experimental version of our code uses the full chianti atomic database @xcite for collisional cross sections and recombination ( bound - bound and bound - free ) and standard plasma transitions ( free - free ) for the ionized regime .",
    "the current version does not treat the electrons as a separate kinetic species , but rather assumes that they follow the ions .",
    "this restriction will be relaxed in a future version of this code and this will allow a fully self - consistent treatment of electron conduction and allow the dynamical influence of fixed magnetic fields to be investigated .",
    "dsmc could be incorporated into a full - fledged pic plasma code ( e.g. * ? ? ?",
    "* ) but this is well beyond the scope of our current implementation .    our main purpose for this and the companion paper ( * ? ? ?",
    "* hereafter paper 2 ) is a demonstration of the value of the kinetic approach for astrophysical flows by applying it to some classic scenarios . to facilitate this comparison , we use the standard , simplified local thermodynamic equilibrium ( lte ) scheme ( e.g. * ? ? ?",
    "* ) rather than the full - fledged self - consistent cross - section based approach",
    ". we will begin , in the next section , with a very brief overview of the different regimes for gas dynamics from rarefied to dense .",
    "this will motivate the need for an understanding of gas in the transitional regime .",
    "section [ sec : method ] describes the numerical approach in two parts :  [ sec : dsmc ] introduces the dsmc algorithm and a hybrid variant that exploits the near - equilibrium solution when the mean - free path is very short , and ",
    "[ sec : implement ] briefly reviews the n - body code , describes the implementation of the dsmc algorithm in parallel using mpi @xcite and presents diagnostics necessary for parameter tuning .",
    "we present two code tests in  [ sec : tests ] : the standard one - dimensional shock tube (  [ sec : shock ] ) and the recovery of the kelvin - helmholtz instability (  [ sec : kh ] ) .",
    "we conclude in  [ sec : summary ] with a discussion and summary .",
    "gas dynamics in galaxies is most often simulated through numerical solutions of the navier - stokes equations : @xmath2 where @xmath3 is the flow velocity , @xmath4 is the fluid density , @xmath5 is the pressure , @xmath6 is the stress tensor , and @xmath7 represents body forces ( per unit volume ) acting on the fluid .",
    "in essence , this equation is an application of newton s second law to a continuum and is most often derived from this point of view .",
    "however , to truly begin with newton s laws requires the application of kinetic theory with the boltzmann equation as a starting point ( e.g. see * ? ? ?",
    "the navier - stokes equations ( eq .",
    "[ eq : nse ] ) are rife with shock discontinuities in general and are notoriously difficult to solve .",
    "physically , the width of the shock interfaces are of order the mean - free path , and therefore are formally inconsistent with the continuum approximation . on the other hand ,",
    "these shock discontinuities are responsible for driving important astrophysical phenomena on many scales ( thermal heating , chemistry and radiation , turbulence , to name a few ) and must be treated carefully . because of this , much of the difficult work in computational fluid dynamics concerns the approximations at interfaces .",
    "for example , grid and finite element - schemes use shock - capturing methods to stabilize the solution in presence of discontinuities .",
    "these methods often introduce numerical dissipation to achieve stability and add some _ width _ to the discontinuity prevent numerically - induced oscillations .",
    "the sph method requires the introduction of artificial dissipation terms that enable the conservation energy and momentum at the otherwise unresolved shock discontinuity .",
    "therefore , the effective width of the shock will most often not correspond to the intrinsic width which is of order the mean - free path .",
    "although artificial viscosity allows the discontinuity to be resolved , the algorithm may also introduce unphysical dynamics .",
    "for example , @xcite illustrated the appearance of a smooth ordered layer of particles near discontinuities that inhibits kelvin - helmholtz and rayleigh - taylor instabilities near density gradients .",
    "a number of fixes have been recently introduced to help address this problem @xcite . in the case of discontinuous galerkin methods ,",
    "one may use order reduction or limiting to prevent spurious oscillations near discontinuities .",
    "spectral methods , which project the fluid equations onto basis functions ( e.g. spherical harmonics , chebyshev polynomials ) , yield high - accuracy solutions but one must be _ even more _ careful at interfaces .",
    "current state of the art in spectral methods is to use high - accuracy shock - fitting algorithms . in summary ,",
    "when the interactions in the shock interface are critical to the resulting energetics and observational diagnostics , artificial viscosity and shock - capturing techniques which rely on approximating the discontinuous nature of the shock will miss important physics .",
    "a more general formulation of gas dynamics follows from the collisional boltzmann equation , @xmath8 which describes the change to the phase - space density , @xmath9 , induced by the collisions between particles , @xmath10 . since @xmath9 has a six - dimensional domain and the fields in the navier - stokes equation have a three - dimensional domain , equation ( [ eq : be ] ) appears harder and certainly more time consuming to solve than equation ( [ eq : nse ] )",
    ". however , the high level of algorithmic complexity in computational fluid dynamics ( cfd ) follows from the mathematical requirements that arise from the maintenance of the continuum limit . on the other hand ,",
    "the left - hand side of equation ( [ eq : be ] ) is the collisionless part of the boltzmann that may be readily solved using n - body techniques while the left - hand describes the particle collisions . unlike the equations of hydrodynamics",
    ", the collisional boltzmann equation has _ no problem _ with transition regimes or discontinuities since the information about the collisions are carried ballistically rather than by constitutive relationships .",
    "said another way , the continuum limit will often fail by definition at transition regimes while the kinetic approach represents the physical nature of the transition and can not fail .",
    "the price for this generalization is performance : the kinetic approach requires smaller timescales and length scales .",
    "solutions of the collisional boltzmann equation are often an order of magnitude slower or more than hydrodynamic solutions for the same problem .     line is shown in red . the shaded blue region is the transition region . for @xmath11 ,",
    "the flow is strongly in the kinetic regime , where collisions and excitation may be important overall but rare . for @xmath12 , the continuum limit , e.g. the navier - stokes equation ,",
    "is appropriate .",
    "a number of classic astronomical interface regimes are shown in labeled boxes.,scaledwidth=50.0% ]    given the difficulties in solving equation ( [ eq : nse ] ) and its inappropriateness for true transitional regimes , it is worth exploring alternatives .",
    "direct solution of the collisional boltzmann equation ( [ eq : be ] ) using a kinetic simulation method is attractive for a number of reasons .",
    "the simplest kinetic method , molecular dynamics , solves the full n - body system including the collisions directly , at often great expense . on the other hand ,",
    "it is straightforward to incorporate any number of species and specific physical couplings that would be difficult in cfd , and generalization to multiple species and interactions is straightforward .",
    "several alternatives to pure molecular dynamics exist ; each achieves computational efficiency by approximating some aspect of equation ( [ eq : be ] ) .",
    "for example , lattice boltzmann methods ( lbm ) discretize and solve equation ( [ eq : be ] ) on a grid and naturally yield the navier - stokes equation in the small mean - free path limit .",
    "this is a form of mesoscopic solution designed to produce the correct solution on scales larger than the particle scale but smaller than the continuum macroscopic scale .",
    "the final example of a mesoscopic solution is monte carlo solution of boltzmann equation .",
    "this approach exploits the classical indeterminacy of the collisional trajectories on the mean - free - path scale .",
    "the effects of the collisions are incorporated with a monte - carlo procedure that reproduces the per - particle cross sections that affect the flow at intermediate length scales .",
    "this method of solution may be one of the few practical approaches available to understand multiscale phenomena such as turbulence .",
    "some gas flows are not fluids and _ must _ be treated by a kinetic - theory approach .",
    "the nature of the flow is described in kinetic theory by the ratio of the mean free path to the characteristic scale , called _",
    "knudsen _ number or @xmath13 : @xmath14 in astrophysics , typical characteristic scales include density , temperature , and gravitational - field scale lengths . for @xmath15 ,",
    "the solutions of the continuum fluid equations deviate from the exact solutions @xcite .",
    "it should not be surprising that many of the most important astrophysical regimes are near this boundary , as shown in figure [ fig : regimes ] .",
    "the knowledge of the physical state within the transition regime is necessary for predicting the physical processes that may dominate the observed emission or cooling even if  is small elsewhere .",
    "in other regimes , the continuum limit is not appropriate even without a transition region or discontinuity .",
    "the direct simulation monte carlo method ( dsmc , see * ? ? ?",
    "* ) has been widely used in engineering applications for gas flows beyond the continuum limit .",
    "dsmc is a numerical method , originally conceived for modeling rarefied gas particles with mean free paths the same order or greater than the characteristic physical length scale ( i.e. @xmath16 ) . in such rarefied flows , the navier - stokes equations can be inaccurate .",
    "but recently , the dsmc method has been extended to model near continuum flows ( @xmath17 ) , making it appropriate for astrophysical problems with large dynamic ranges and multiple phases .",
    "in addition , dsmc is fully shock capturing in the sense that the discontinuity implied by the shock is naturally determined by dsmc .",
    "it reproduces standard shock tests ( see  [ sec : shock ] ) and instabilities such as kelvin - helmholtz ( see  [ sec : kh ] ) .",
    "because the method works for arbitrary values of , dsmc may be used in astrophysical problems that have short and long mean free paths that might occur in the interaction between cold gas and hot rarefied gas in cluster environments ( e.g. see paper 2 for an application to ram - pressure stripping ) .",
    "furthermore , dsmc is always stable ( no courant - friedrichs - lewy condition ) . as will be described in ",
    "[ sec : tuning ] , there _ are _ conditions on the step size and collision parameters for optimal performance , but poor parameter choices lead to some inaccuracy but not failure through instability .",
    "the main problem with dsmc approach is computational speed : for a point of comparison , dsmc is more efficient per particle than a smoothed - particle hydrodynamics ( sph ) code , but it requires at least an order of magnitude more particles to achieve a similar resolution .",
    "the performance in our implementation is bottlenecked by the tree structure supporting the parallel domain decomposition and thereby marks this area for further technical development .",
    "nonetheless , dsmc will never compete in speed and accuracy with hydrodynamic methods in the @xmath18 limit .",
    "rather , the goal of the dsmc method is an investigation of the effect of microphysics and gas dynamics in the transition regimes themselves ; these regimes can not be studied within the hydrodynamic paradigm .",
    "dsmc incorporates the internal degrees of freedom of the atoms and molecules in a gas through a variety of approximations that redistribute the kinetic energy , momentum and internal energy of two collision partners . for a simple monoatomic gas ,",
    "the only relevant energies are those of translation , electronic excitation and radiative emission by the particles .",
    "this system is described by a phase - space distribution function , @xmath19 , that represents the expected number density of molecules of species @xmath20 in a small volume @xmath21 about the point at @xmath22 which have a velocity in the range @xmath3 to @xmath23 , and internal energy @xmath24 a given instant @xmath25 .",
    "the limiting kinetic equation for dsmc is the nonlinear collisional boltzmann equation @xcite .",
    "dsmc splits the simulated solution of the collisional boltzmann equation into two sequentially - applied parts .",
    "first , the particles are first advanced on collisionless trajectories using the standard n - body method .",
    "second , the flow field is divided into cells , and collisions are between the simulation particles realized consistent with the local collision rate .",
    "dsmc represents the atoms and molecules of a gas by much smaller number of simulation particles .",
    "the number of collisions reproduces the rate in the physical system by increasing the cross section for the simulation particles by the ratio of the simulation mass to the true mean atomic and molecular mass .",
    "this generic feature is exploited in a variety of ways to improve dsmc performance .",
    "for example , if the collision rate is sufficiently large , the velocity distribution in a cell will approach the equilibrium maxwell - boltzmann distribution and this may be used to limit the number of computed collisions explicitly .",
    "if the collision rate is low , however , there will be little redistribution of energy and momentum and the distribution will remain close to the collisionless solution which may be far from thermodynamic equilibrium .",
    "the details of the algorithm will be outlined in  [ sec : algorithm ] below .",
    "dsmc is presently the most widely used numerical algorithm in kinetic theory @xcite . in dsmc , particle pairs are randomly chosen to collide according to the probability distribution implied by the interparticle potential .",
    "this probability is proportional to the particles relative speed and effective geometric cross section .",
    "the post - collision velocities are determined by randomly selecting the collision angles and redistributing the energy into atomic and molecular internal degrees of freedom .",
    "therefore , unlike molecular dynamics , dsmc particles are chosen to collide even if their actual trajectories do not overlap .",
    "this is not an inconsistency but required by the probabilistic nature of the solution .",
    "the application of the _ classic _ dsmc algorithm is restricted to dilute gases .",
    "recently , the consistent boltzmann algorithm ( cba ) was introduced as a simple variant of dsmc for dense gases @xcite .",
    "the cba collision algorithm follows the dsmc algorithm with two additions .",
    "first , the unit vector parallel to the line connecting the centers at impact is computed from the pre- and post - collision velocities of the colliding pair .",
    "each particle is displaced along this direction corresponding to the mean separation they would have experienced had they collided as hard spheres .",
    "secondly , the collision rate must be increased over the dilute rate to account for the volume displaced by the hard spheres representing the atoms and molecules themselves .",
    "these algorithmic changes are unlikely to play a major role in astrophysical flows , but are trivial to include . with these two simple additions",
    ", cba yields the hard sphere equation of state at all densities .",
    "@xcite showed that the high - density transport properties are not exact but remain comparable to with molecular dynamics simulations and the enskog approximation .",
    "although cba can be generalized to any equation of state here we will only consider the hard sphere gas whose particle diameter is a constant fraction of the bohr diameter .",
    "the two sequential steps that simulate equation ( [ eq : be ] ) are a ballistic or collisionless computation based on the left - hand side and a collisional computation based on the right hand side .",
    "practically , one advances the particles according the collisionless boltzmann equation , @xmath26 using standard n - body techniques .",
    "one then solves for the collisions using @xmath27 the collision operator is @xmath28 \\,d\\omega\\,d\\mathbf{v}_\\ast \\label{eq : collop}\\end{aligned}\\ ] ] where @xmath29 denotes the collision cross section , the primed @xmath30 and @xmath31 describe all the possible post - collisional velocities of two particles colliding with respective pre - collisional velocities @xmath3 and @xmath32 , and @xmath33 denotes the interaction angles . in dsmc , the collision operator is solved by a monte carlo realization of equation ( [ eq : collop ] ) as follows :    1 .",
    "move all of the particles collisionlessly according to the mean field ( eq . [ eq : advect ] ) using the n - body solver .",
    "2 .   partition particles into cells",
    "whose linear scale is of order the mean free path @xmath34 .",
    "3 .   compute collision frequency in a cell for all particle species and interactions of interest .",
    "this discretizes the spatial dependence of the phase - space density @xmath9 to provide @xmath35 .",
    "4 .   select random collision partners within cell ; this samples @xmath35 and @xmath36 in equation ( [ eq : collop ] ) .",
    "we assume that probability that a pair collides only depends on their relative velocity .",
    "that is , all particles in the cell are valid collision partners .",
    "the post - collision velocities ( 6 quantities ) are constrained by the conservation of momentum ( 3 constraints ) and energy ( 1 constraint ) . the post - collision direction in the center of mass frame",
    "is specified by two randomly chosen variates .",
    "repeat these steps beginning with step ( i ) .    in this way ,",
    "the net change in the phase - space density implied by equations ( [ eq : be ] ) and ( [ eq : collop ] ) are computed by evolving velocity distributions consistent with the interaction potential implicit in the cross section @xmath37 .",
    "this , in turn , leads to mass , momentum , and energy flux through the collision cells . see @xcite and @xcite for additional practical details and theoretical underpinning of this approach .",
    "dsmc is most efficient and accurate when the interaction cell size @xmath38 is of order the mean free path @xmath34 @xcite and a free particle crosses the cell in a time step ( @xmath39 where @xmath40 is the mean one - dimensional particle velocity and @xmath41 is the time step ) ; let us call @xmath42 he _ flight length_. this motivates defining two scale - free quantities : @xmath43 the mean - free path ratio , @xmath44 , is the mean - free path @xmath45 in units of the cell size @xmath38 .",
    "the flight - length ratio , @xmath46 , is the length of flight in one time step in units of cell size .",
    "the cell size @xmath38 is chosen to satisfy two additional constraints : 1 ) @xmath38 should be smaller than any flow scale of interest ; and 2 ) the cell size should enclose approximately 10 particles .",
    "clearly , if the cell size is so small that the probability of occupation is small , no interactions are possible .",
    "conversely , if the occupation number is large , the expense may increase without improving the accuracy of the result .",
    "this parametrization leads to the following limiting scenarios and tuning prescriptions :    * @xmath47 .",
    "some particles will pass through multiple cells in one time step , possibly leading to artificial viscosity ( see  [ sec : mfp_eff ] ) .",
    "the remedy is to decrease step size , @xmath41 . *",
    "particles can not reach their interaction partners in one time step .",
    "this leads to excess correlation .",
    "the remedy is to increase step size , @xmath41 . in our dsmc implementation",
    ", the appropriate time step is selected automatically selected for each gas particle based on these criteria as long as the times step criteria demanded by the poisson solver ( eqs .",
    "[ eq : eps1][eq : eps3 ] ) are not violated . *",
    "mean free path is very short compared to any scale of interest .",
    "the system is approaching the continuum limit with many collisions per particle in a time step .",
    "one remedy is to use a collision limiting scheme .",
    "here , we use the equilibrium particle simulation method ( epsm ) described in  [ sec : epsm ] . when using epsm , the relevant velocity in equation ( [ eq : epsv ] ) is the mean flow velocity @xmath50 not the mean ballistic velocity @xmath51 .",
    "of course , if this condition obtains everywhere in the computational volume , all cells will use epsm and the resulting calculation will be in the cfd regime . *",
    "mean free path is very large compared to any scale of interest .",
    "the partial remedy is to increase @xmath38 and possibly @xmath41 as long as @xmath38 remains smaller than any scale of interest .",
    "otherwise , the system is approaching the collisionless limit and all is well .",
    "this regimes are summarized schematically in figure [ fig : tuning ] .",
    "@xmath46 plane .",
    "the light green box shows the desirable range for the two parameters for efficiency .",
    "the dark green box shows the ideal range .",
    "if @xmath46 is too large , particles may cover multiple cells for @xmath53 ( red shaded region ) ; the step size should be reduced .",
    "if it is too small , the particles may interact with particles that can not be reached by free flight in one time step . for @xmath54 ( blue shaded region ) ,",
    "the limiting epsm algorithm is used.,scaledwidth=50.0% ]      dsmc is computationally expensive , although much cheaper than molecular dynamics .",
    "the expense can be mitigated by only using dsmc where it is needed !",
    "a number of recent contributions to the literature describe hybrid navier - stokes  dsmc solvers using finite - element methods and amr techniques ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "because of the unusual geometries and large dynamic range in astrophysical flows , the implementation of the kinetic theory is greatly simplified by using a particle method throughout these simulations rather than a hybrid dsmc  navier - stokes code .",
    "a pure particle code easily accommodates the arbitrary geometry of interfaces , simplifies the transition between regimes without the numerical artifacts owing to the statistical noise incurred by moving between the particle simulation and continuum representation .",
    "however , in the high density regions that are collision dominated and make dsmc infeasible , the system will approach thermodynamic equilibrium .",
    "based on this , @xcite suggested that the number of collisions per particle be limited to only the number necessary to achieve equilibrium .",
    "a further simplification eliminates individual collision computations altogether when the density and collision rates are high .",
    "if one can predict that the number of collisions will be sufficient to achieve equilibrium without simulating the collisions , the limiting thermodynamic state for a collision - dominated cell may be computed a priori , and one may achieve a significant computational advantage . this high - collision limit of dsmc",
    "was proposed by @xcite who called it the equilibrium particle simulation method ( epsm ) .",
    "this approach has been more recently explored by @xcite .",
    "in essence , epsm selects new velocity components from the equilibrium thermodynamic distribution within each cell while simultaneously conserving the total energy and momentum .",
    "an estimate of the temperature , @xmath55 may be derived from the total energy of the finite sample of @xmath56 particles in a cell using the standard relation for the mean energy of single degree of freedom @xmath57 .",
    "although pullin s application was a single species in one dimension , the approach is straightforwardly generalized to any number of species in three dimensions .",
    "we will combine the dsmc and epsm collision computation approximations using a heuristic such as the mean number of collisions between particles to switch between the two .",
    "more sophisticated collision limiting approaches with fewer limitations are under investigation ( see * ? ? ?",
    "* ) and will be explored in the future .",
    "owing to the random realization of evolved states in both dsmc and epsm , the epsm solution will differ from the dsmc solution and the exact molecular dynamics solution , even after many collisions .",
    "these differences lead to statistical scatter about the exact solution .",
    "presumably , the scatter will be larger for dsmc than for epsm , since initially identical initial states will contain slightly different total amounts of energy and momentum .",
    "it might also be possible to improve the use of both algorithms together by conserving or matching incoming and outgoing fluxes at cell boundaries between the two regimes .",
    "epsm is expected to be more efficient than dsmc close to thermodynamic equilibrium .",
    "however in dsmc , the time step is chosen to be of order the collision time .",
    "obviously , this condition must be relaxed in epsm , otherwise the mean number of collisions per particle would be @xmath58 and the distribution could be far from equilibrium . in both schemes , large cell sizes @xmath59 and step sizes @xmath41 larger than the local collision time may be used in regions where the flow gradients are small .",
    "[ sec : mfp_eff ] for additional complications .      to summarize",
    ", epsm is an infinite collision rate limit of dsmc with a finite sample of simulator particles .",
    "if the time step exceeds the time of flight across a typical cell , or equivalently @xmath60 , then particles with momentum and energy representative of the equilibrium distribution of one particular cell can be _ non - physically _ transported to a distant cell with possibly different equilibrium conditions .",
    "close to equilibrium , this distance is approximately @xmath61 , where @xmath62 is the particle mass . on the other hand",
    ", the distance covered by particles in @xmath41 should be at least as large as the mean free path to prevent inducing non - physical correlations .",
    "if the criteria described in  [ sec : tuning ] are close to ideal , the probability that particles will cross the cell in any one time step is small in the high - collision - rate limit .",
    "however , the ideal tuning parameters are not always computationally feasible .    to understand the implications of these limits , let us consider transport of particles between two adjacent cells .",
    "consider a euclidean set of coordinate axes for a collision cell , @xmath63 with @xmath64 chosen perpendicular to the cell face common to the adjacent cells .",
    "let this face be located at @xmath65 .",
    "let the mass density of the two cells to the left and right of the boundary @xmath65 be denoted by @xmath66 and @xmath67 , respectively . for notational simplicity , let factor the phase - space distribution function into a density and velocity distribution function",
    ": @xmath68 ; this is consistent with our discretization of the phase space into collision cells .",
    "the velocity distribution function describing the state in the adjacent cells will be different in general : @xmath69 .",
    "that is , particles that cross the cell boundary with @xmath70 ( @xmath71 ) have the parent distribution function @xmath72 ( @xmath73 ) .",
    "this discontinuity gives rise to an effective viscosity .",
    "demonstrating this explicitly is an easy exercise using the standard techniques from kinetic theory ( e.g. * ? ? ?",
    "let @xmath74 denote some velocity moment of @xmath75 , such as the momentum .",
    "the net flux of the @xmath74 across the interface , @xmath76 , can be split into two contributions by the direction of the particles crossing the cell face , @xmath77 , as follows : @xmath78 in general , the gradient in velocity parallel to cell wall will not vanish across the interface : @xmath79 .",
    "setting @xmath80 and taking @xmath72 and @xmath73 to be maxwell - boltzmann distributions with the temperatures @xmath81 and @xmath82 in the adjacent cells , the momentum fluxes parallel to the cell wall are @xmath83     \\rho^{<0 } \\langle v_x^{<0}\\rangle\\langle v_y^{<0}\\rangle \\nonumber \\\\ & & +     \\sqrt{\\frac{k_bt^{<0}}{2\\pi m } } e^{-\\langle      v_x^{<0}\\rangle^2/2k_bt^{<0}/m }   \\rho^{<0 } \\langle v_y^{<0}\\rangle \\\\    { { \\cal f}}^{>0}_{mv_y } & = &     \\frac12\\left[1 - { \\mathop{\\rm erf}\\nolimits}\\left(\\langle        v_x^{>0}\\rangle/\\sqrt{2k_bt^{>0}/m}\\right)\\right ]    \\rho^{>0 } \\langle v_x^{>0}\\rangle\\langle v_y^{>0}\\rangle      \\nonumber \\\\ & & -     \\sqrt{\\frac{k_bt^{>0}}{2\\pi m } } e^{-\\langle      v_x^{>0}\\rangle^2/2k_bt^{>0}/m } \\rho^{>0 } \\langle v_y^{>0}\\rangle      \\\\\\end{aligned}\\ ] ] where @xmath84 and analogously for @xmath85 .",
    "assume that there are no additional gradients for simplicity ; this implies that @xmath86 and @xmath87 .",
    "in addition , assume that the mean velocity is small compared to the thermal velocity , @xmath88 . then , the net momentum flux across the cell boundary becomes @xmath89    now , define the distance that the mean particle transports its momentum as @xmath90 .",
    "the value of @xmath90 will depend both the details of dsmc code and the physics of the interactions and gives us an approximation to the gradient : @xmath91 combining these relations , we may express the net momentum flux as @xmath92 this is a shear stress induced at the cell boundary by the discretization .",
    "physically , viscosity arises from the shear stress at an interface that opposes an applied force .",
    "the classic example is the laminar flow of a viscous fluid in the space between two relatively moving parallel plates , known as couette flow .",
    "the force applied to the plates causes the fluid between the plates to shear with a velocity gradient in the direction of relative motion .",
    "in other words , the shear stress between layers is proportional to the velocity gradient in the direction perpendicular to the layers : @xmath93 where @xmath94 is the proportionality factor called the _",
    "viscosity_.    comparing equation ( [ eq : stress ] ) that describes our discretization shear stress to the usual relation between mean free path and viscosity for planar couette flow ( eq . [ eq : couette ] ) , we may estimate the effective viscosity for the simulation in the near equilibrium limit to be @xmath95 the mean free path for a hard sphere with viscosity @xmath94 is @xmath96 @xcite .",
    "this implies that the effective mean free path due to the transport across the cell boundary in the simulation is then @xmath97 .",
    "the epsm algorithm mixes the transported momentum into the entire cell of size @xmath38 .",
    "interestingly , this suggests that @xmath98 and the effective mean free path in dsmc simulation becomes @xmath99 where @xmath34 is the local mean free path .",
    "this is equivalent to the dsmc requirement that the cell size should be smaller than the collisional mean free path for physical accuracy .",
    "however , when scale of all macroscopic observables is large compared to the mean free path , the less expensive epsm solution should closely approximate the dsmc solution .",
    "in other words , dsmc and epsm should give similar results when the number of collisions per particle per time step in dsmc is large , which justifies the use of cell sizes much larger than the mean free path and artificially limiting the number of collisions per particle in this limit .",
    "similarly , the same arguments leading to equation ( [ eq : stress ] ) suggest that if dsmc grid cells are too large ( @xmath100 ) , non - local particles will be selected for collisions resulting in the numerical diffusion of gradients on the cell - size scale .",
    "conversely , if dsmc cells are too small ( @xmath101 ) , but still contain the same number of particle per cell , the number of simulated particles becomes far more than necessary , resulting in an accurate but highly inefficient simulation .    in some flow problems of astrophysical interest , it is not possible to use a sufficient number of particles to populate cells at the mean - free - path scale . in these cases",
    ", we resort to using an under - resolved collision - limited dsmc solution with large cells .",
    "as we have seen , the overall effect of such an approximation is to misrepresent the transport coefficients giving rise to an effective viscosity .",
    "this should not lead to significant misestimations as long as the gradients of the flow are small with length scales greater than the cell size .",
    "we have implemented the dsmc kinetic algorithm in our n - body expansion code , exp . owing to its long effective relaxation times ,",
    "the expansion or `` self - consistent field '' algorithm ( scf , e.g. hernquist & ostriker 1992 ) is ideal for representing the large - scale global response of a galaxy to a long - term disturbance .",
    "weinberg ( 1999 ) extended this algorithm from fixed analytic bases to adaptive bases using techniques from statistical density estimation to derive an optimal smoothing algorithm for scf that in essence selects the minimum statistically significant length scale .",
    "this is combined with the empirically determined orthogonal functions that best represent the particle distribution and separate any correlated global patterns .",
    "the rapid convergence of the expansion series using this matched basis minimizes fluctuations in the gravitational force by reducing the number of degrees of freedom in the representation and by increasing the signal - to - noise ratio for those that do contribute .",
    "in addition , exp contains a particle - in - cell poisson solver as well as a parallelized direct - summation solver .",
    "the former may be ideal for investigating the importance of small self - gravitating spatial inhomogeneities that are a small part larger astrophysical flow .",
    "the exp code is modular with an object - oriented architecture and easily incorporates dsmc .",
    "the standard scf algorithm is `` embarrassingly '' parallel and the implementation here uses the message passing interface communications package ( mpi , e.g. @xcite ) , making the code easily portable to a variety of parallel systems . practically speaking , parallel scf with the new algorithm",
    "makes tractable disk and halo simulations on modest - sized pc - based clusters with up to 100 million particles .",
    "exp uses a multiple time step algorithm as follows .",
    "we begin by partitioning phase space @xmath102 ways such that each partition contains @xmath103 particles that require a time step @xmath104 where @xmath105 is the largest time step .",
    "the time step with @xmath106 corresponds to the smallest single time - step in the simulation . since the total cost of a time step is proportional to the number of force evaluations , this algorithm improves the run time by the following factor @xmath107 where @xmath108 .",
    "if all particles were the deepest level , @xmath106 , we have @xmath109 .",
    "on the other hand , if most of the particles are in the level @xmath110 , we have @xmath111 . for an @xmath112 nfw dark - matter profile @xcite with @xmath113 particles as an example",
    ", we find that @xmath114 and @xmath115 , an enormous speed up ! forces in the scf algorithm depend on the expansion coefficients and the leap frog algorithm requires interpolation of these coefficients to maintain second - order error accuracy per step . the contribution to each expansion coefficient for particles in time - step partition @xmath116",
    "are separately accumulated and linearly interpolated for levels @xmath117 as needed .",
    "higher - order interpolation would have higher - order truncation error than the ordinary differential equation solver and would be wasteful .",
    "exp uses the minimum of three separate time step criteria for choosing the appropriate time - step partition @xmath116 for each particle @xmath118 :    1 .   a local _ force _ time scale : @xmath119 this sets the time step to be a fraction @xmath120 of the estimated change of local velocity by the gravitational force ; that is , this time step is based on the rate of velocity change implied by the gravitational field .",
    "2 .   a local _ work _ time scale : @xmath121 this sets the time step to be a fraction @xmath122 of the time required to change the particle s potential energy .",
    "a local _ escape _ time scale : @xmath123 this time step will be small for a fast moving particle near a local feature in the gravitational field or for a particle that samples a large range of gravitational field strengths over its orbit .    we calibrate the leading coefficients @xmath124 for accuracy using a test simulation for each new set of initial conditions .",
    "typically @xmath125 yields better than 0.3% accuracy over a dynamical time .",
    "our implementation uses an octree for partitioning space to make dsmc collisions cells .",
    "each node in the octree is a rectangular prism most often chosen to be a cube .",
    "each node is dividing into eight child nodes of equal volume formed by a single bisection in each dimension .",
    "octrees are the three - dimensional analog of quadtrees . unlike kd - trees ,",
    "the octree partitioning is on volume alone , so that the aspect ratio of all nodes are self similar .",
    "this is desirable for collisions cells that assume that any particle in a cell whose linear dimension is approximately a mean free path is a good collision partner for another particle from that same cell .",
    "most contemporary supercomputers are networked clusters with multiple multi - core processors per node .",
    "each of the cpu cores share the memory and communication resources of the parent node , and each node is interconnected to the others through a fast low - latency network . to simplify the parallel domain decomposition and exploit the typical cluster topology",
    ", we use a two - level nested tree as follows .",
    "the first level is a coarse octree constructed with approximately an order of magnitude more cells than nodes .",
    "the computational work for all particles belonging to leaves of the coarse tree is accumulated and used to balance load among the nodes when the domain is decomposed .",
    "the second level constructs a tree in each leaf of the coarse first - level tree .",
    "spatially contiguous leaves are preferentially assigned to the same node .",
    "the goal of the second - level tree are collections of interaction cells that contain approximately @xmath126 simulation particles .",
    "aggregated cells or super cells used for statistical diagnostics contain @xmath127 particles , typically @xmath128 .",
    "to minimize the intranode communication overhead , we run one multithreaded process per node .",
    "multithreaded tasks include determining expansion coefficients , force evaluation , and dsmc collision computations .",
    "the full domain decomposition is computationally expensive and would horribly dominate the run time if performed at the smallest time step : @xmath106 in equation ( [ eq : ts ] ) .",
    "rather , the tree is extended as necessary by updating the particle - node association and constructing new tree nodes as necessary for time intervals short compared to the evolution time scale but long compared @xmath129 .",
    "the interim procedure updates the octree consistently but without exchanging particles between processors . at some preselected intermediate time step assigned by choosing @xmath130 with @xmath131 , the domain decomposition is reconstructed anew , exchanging particles between processors as necessary . in other words , at time steps with @xmath132 , both the coarse- and fine - grained octrees are recomputed from scratch . at time steps with @xmath133 ,",
    "the fine - grained octrees are updated only .",
    "it is therefore possible to have the _ same _ cell populated by _ different _",
    "particles on separate nodes for a short period of time during the simulation .",
    "this will introduce some errors since the densities in the duplicated cells will be underestimated .",
    "however , the value of @xmath130 is chosen so that @xmath134 remains smaller than any characteristic dynamical time except for the collision time , and therefore , i do not anticipate that this procedure will lead to significant quantitative or qualitative errors .",
    "if there is any doubt , the value of @xmath130 may be increased to @xmath62 as check . along the same lines , dsmc and dsmc - epsm",
    "explicitly conserve energy and momentum at the collision scale , including those describing atomic and molecular internal degrees of freedom",
    ". therefore , even if small - scale features are mildly compromised by duplication errors , these are unlikely to propagate .",
    "putting together the requirements on collision cells scales and time steps described in ",
    "[ sec : tuning ] and  [ sec : mfp_eff ] , we may summarise the interaction between particle number , resolution , cell size and time step as follows :    1 .   the time step must be sufficiently small that the dsmc particles do not move through more than one cell of length @xmath38 in one time step , @xmath135 .",
    "that is the flight - length ratio @xmath46 should be of order unity .",
    "the time - step criterion becomes @xmath136 .",
    "the fundamental resolution scale of the fluid is determined by the mean - free path , @xmath34 .",
    "this suggests that collision - cell size scale , @xmath38 , should be of order @xmath34 .",
    "increasing @xmath38 beyond @xmath34 may lead to viscosity as described in ",
    "[ sec : mfp_eff ] .",
    "large separations between collision partners when @xmath34 is large also reduces spatial accuracy .",
    "@xcite proposed defining virtual _ subcells _ within collision cells to maintain finer spatial control by choosing neighboring collision partners .",
    "this will be implemented and explored in a future version of our code .",
    "each simulation particle represents many atoms and molecules and the variance per cell will scale as inversely with the number of particles per cell .",
    "however , the computational effort scales as @xmath137 so large values of @xmath138 lead to infeasible simulations .",
    "empirically , the overall accuracy scales as @xmath139 , and many tests suggest that @xmath140@xmath141 is a good compromise between these competing demands @xcite .    in summary ,",
    "the physical properties of the simulation determine the number of particles required for an accurate dsmc simulation .",
    "too few particles degrade the resolution , since collision cells must have @xmath38 such that @xmath142 .",
    "values @xmath100 may lead to artificial viscosity if the characteristic scales of flow gradients are not resolved .",
    "however , if the mean - free path is smaller than any scale of interest and the energetics _ in _ shocks are not critical , the @xmath38 may be increased artificially without sacrificing reality .",
    "some knowledge of the consequences will help motivate whether computational feasibility justifies this trade off physically .",
    "for example , the flows on very large scales are likely to be correct owing to accurate energy and momentum conservation in dsmc independent of @xmath34 as long as the small scale features are not critical to determining features on large scales . unlike traditional cfd or n - body simulations ,",
    "a dsmc simulation does not converge with increasing particle number ; rather , increasing the particle number increases the resolution .",
    "a `` converged '' solution is obtained by averaging the mean quantities from multiple simulations .",
    "the monte carlo realization of the collision integral depends on the interaction cross section from equation ( [ eq : collop ] ) and defines the probability of internal excitation , ionization , recombination , radiation or scattering .",
    "since the spontaneous emission times are most often very small compared to the collision times for astrophysical flows , therefore we do not need track the excitation state of the atoms and molecules between collisions .",
    "thus , collisional cooling is a straightforward natural by - product of dsmc .",
    "however , there are some intrinsic difficulties in doing this accurately that require some additional specialized methods . for example",
    ", the existence of trace ionized components ( e.g. the elements c , n , o ) that have a significant effect on cooling but carry negligible momentum can not be simulated naively if there will be fewer than one trace - species particle per interaction cell .",
    "we elect therefore to change the ratio of the true particle number to simulation particle number for trace species .",
    "then , we populate the simulation with sufficient numbers of the trace species to yield accurate statistical representation of the trace interactions with weights to account for their true mass fraction .",
    "a further issue is the treatment of free electrons . in principle",
    ", it is not difficult to implement free electrons as a separate species .",
    "however as a consequence , the large velocities of the electrons relative to the ions in equipartition require very small time steps and lead to infeasibly large computational expense .",
    "we will approach this problem in two incremental steps . in the first",
    ", we will assume that the electrons remain in the vicinity of their parent ions , both preventing charge separation and eliminating the need for time steps on order of the mean flight time of the simulated electrons .",
    "in the second , we will include the free electrons as a separate species to feel the electrostatic field induced by charge separation .",
    "computational requirements will restrict this application to very small simulation regions and will be used , primarily , to explore mesoscale dynamics in various astrophysical regimes .    alternatively , one may account for the energetic affects of the trace species by using their reaction rates computed from the thermodynamic properties approximated from the dsmc fields .",
    "in particular , the electronic level populations due to collisional and radiative excitation may be described by rate equations using the electron density , temperature and background radiation field .",
    "even if the flow is far from equilibrium , as long as the processes that establish the electronic level populations occur much more quickly than the time for any significant flow pattern to change , an equilibrium distribution will be a fair approximation in many situations .",
    "this approach is called the _ quasi steady state _ ( qss ) approximation @xcite .",
    "the electron densities , temperatures and ion densities may then be used to evaluate the qss rates .",
    "the qss rates can be obtained from individual particle cross sections by assuming that the electron velocity distributions are maxwell - boltzmann .",
    "these same set of assumptions yields the standard cooling curves used in cosmological and ism continuum gas simulations ( e.g. * ? ? ?",
    "heating by cosmic rays , photoelectric heating , etc . may be computed similarly using the qss method .    in this and paper 2",
    ", we will employ such an approximate qss solution based on lte . then to treat the electrons",
    ", we estimate the ionization fraction based on the local thermal state and assume that the electrons follow the ions in space .",
    "the implementation here computes the effective temperature from the super cell of @xmath143 particles ( see  [ sec : parallel ] ) and estimates collision rates based on a total effective hard - sphere geometric cross section .      for very small mean free paths , our algorithm transitions to the navier - stokes equations using the equilibrium particle simulation through the use of epsm (  [ sec : epsm ] ) .",
    "if the number of mean collisions per body in a cell exceeds some preselected value , @xmath144 the epsm update is performed in one of two ways .",
    "first , using the original @xcite algorithm .",
    "this algorithm constructively computes random variates while simultaneously enforcing the constraints of momentum and energy conservation , much the same way as in the proof for distribution of the consistency of the sample variance ( e.g. * ? ? ?",
    "alternatively , it is straightforward to realize normal variates with any convenient mean and variance , followed by a shift and scale operation to recover the conserved total momentum and energy .",
    "both algorithms were implemented for completeness and yielded equivalent values but the latter is faster in tests and is the default .",
    "the use of epsm may be toggled by a run - time parameter .",
    "in addition , if epsm is not used , one may elect to limit the total number of collisions per cell to a maximum value as suggested by @xcite while maintaining the correct heating and cooling rates consistent with the predicted number of collisions .",
    "the simulation particles directly represent the physical properties of the gas .",
    "they are not _ tracers _ of an underlying field but rather all momentum , kinetic energy , internal energy and chemical fluxes must be computed directly from the particle distribution .",
    "therefore , the density , temperature and other traditional field quantities may only be _ estimated _ as an ensemble average .",
    "owing to the typically small number of particles , @xmath56 , in an interaction cell , these estimates are computed using the super cells with @xmath143 particles ( see  [ sec : parallel ] ) . as a consequence ,",
    "the estimates used for producing a field representation for the gas physical state have lower spatial resolution than the simulation but are useful diagnostics nonetheless .",
    "in contrast , graphical representations from hydrodynamic simulations represent the full computed resolution of the field quantities .",
    "our current implementation computes ensemble temperature , density , knudsen number , and cell size to flight - length ratio .",
    "these quantities are carried by each gas simulation particle that are saved in phase - space output files .",
    "the exp - dsmc module keeps copious diagnostics on the physical parameters necessary to verify the validity of the dsmc approximation .",
    "for example , the time of flight across the cell , the mean - free path , and energy radiation rates per cell to ensure that the conditions required for an accurate dsmc simulation are maintained ( see  [ sec : tuning ] ) . the necessary time step required for the particles in each cell",
    "is fed back into the time step selection algorithm to adaptively change the stem steps for particles as described in ",
    "[ sec : nbody ] .",
    "the riemann shock tube @xcite is a special case of a riemann problem in eulerian hydrodynamics and is defined by an initial state with two fluids of different density and pressure at rest divided by a planar interface .",
    "the rankine - hugoniot conditions allow one to compute the flow properties across the shock . using this ,",
    "an exact solution may be obtained analytically for an adiabatic gas from the one - dimensional euler equations written in conservation form .",
    "see @xcite for details .",
    "because an exact solution is straightforwardly computed , the riemann shock tube has become a standard benchmark for computational fluid dynamics problems .",
    "the shock tube simulation is a strong test for hydrodynamics solvers which must explicitly and stably compute the shock - front and contact discontinuities .",
    "failure may lead to post - shock oscillation in the solution .    here , we perform four tests for two different sets of initial conditions .",
    "the first set of initial conditions is the original sod example with @xmath145 and the second set is a _ strong _ shock case with @xmath146 suggested by f. x. timmes . for each initial condition",
    ", we tested a pure dsmc and the hybrid epsm / dsmc with indistinguishable results .",
    "figure [ fig : st1 ] compares the results of the pure dsmc simulation and the exact riemann solution for both cases @xcite .",
    "the mean - free path is @xmath147 for the sod initial conditions and @xmath148 for the strong - shock initial conditions , determined by the particle numbers and computational efficiency as described in  [ sec : accuracy ] .",
    "we expect that the shock and contact discontinuities will be smeared over several mean - free paths owing to the internal kinetics of the gas - particle interactions and some positional variance in the interfaces .",
    "the reproduction of the density regimes by the dsmc and the dsmc - epsm hybrid methods without issues of stability or oscillation is expected owing to the local nature of the momentum and energy transport in a kinetic simulation .",
    "the traditional kelvin - helmholtz ( kh ) instability is defined for the flow of two incompressible inviscid fluids with an infinite plane - parallel interface .",
    "each fluid has different bulk velocities @xmath149 and @xmath150 parallel to the interface between the two fluids with densities @xmath151 and @xmath152 .",
    "we assume that @xmath153 .",
    "for ease of discussion , we observe the fluid from the frame of reference moving at @xmath154 ; this implies that fluid 1 moves to the right with velocity @xmath155 and fluid 2 moves to the left with velocity @xmath156 . for this initial condition ,",
    "the vorticity is only non - zero at the interface between the two fluids . with this initial condition ,",
    "an external sinusoidal perturbation causes a growing instability as follows . consider a sinusoidal perturbation to the interface .",
    "the pressure increases in the concave regions and decreases in convex regions of the interface ( i.e. the bernoulli principle ) which allows the perturbation to grow .",
    "the peak of the vortex sheet is carried forward by fluid 1 and the trough is carried backward by fluid 2 .",
    "this causes the initially sinusoidal corrugation interface to stretch , tighten and eventually roll up with the same sense as the vorticity at the original interface .",
    "in nature , such interfaces abound and the kh instability is thought to be critical for understanding a wide variety of astrophysical phenomena .",
    "for example , the non - linear development of the kh instability leads to turbulent mixing in a `` free shear layer '' .",
    "these same interfaces are critical in understanding the development of jets in radio galaxies and quasars @xcite .",
    "figure [ fig : kh ] shows the non - linear development of a kh instability for a fluid box with periodic boundary conditions in the @xmath157 and @xmath158 directions and reflecting boundary conditions in the @xmath159 direction .",
    "the simulation has @xmath0 particles and unit dimensions and temperatures @xmath160 k and @xmath161 k. the density ratio of the shearing fluids is 2 with pressure equilibrium at the boundary , @xmath162 .",
    "the relative fluid velocity has mach number 1/2 .",
    "the disturbance is seeded everywhere in the box with a transverse velocity amplitude of 1/4 the shear velocity and spatial frequency of 1/3 according to the kelvin - helmholtz dispersion relation @xcite .",
    "the instability develops and evolves as expected , consistent with the spatial frequency and velocity of the linear mode .",
    "the figure illustrates that the interface is well - maintained throughout the evolution .",
    "the sound wave that results from the linear - mode seeded in the initial conditions can be clearly seen throughout the box .",
    "of course , the particle numbers place a limitation on the maximum spatial frequency that may be resolved owing to the dsmc requirements on cell size ( see [ sec : accuracy ] ) .",
    "nearly all gas dynamical simulations on galaxy scales or larger are numerical solutions of the navier - stokes equations ( also known as cfd ) .",
    "computational expediency has motivated the use of cfd even when the mean free path of particles becomes appreciable to the scales of interest , such as in the early phases of galaxy cluster formation or in the coronal  neutral gas interface at large galactocentric radii . in the transition between these regimes and in the rarefied regime where the mean free paths are of order or larger than scales of interest , the standard fluid approximation breaks down and one must solve the boltzmann equation with collisions using the kinetic theory of gases in order to understand the true nature of the flow",
    ".    moreover , astrophysical flows are rife with multiphase interfaces and shocks .",
    "shock interfaces are discontinuities in the fluid limit and there are many accurate and elaborate schemes for their numerical computation in the cfd pantheon . however , in many cases of interest , the dynamics of the particles in this interface regime is critical to understanding the overall energetics through cooling and heating and the observational signatures in the form of line and continuum strength predictions and are unlikely to be well - described by the lte approximation .",
    "such calculations also require a kinetic theory approach .",
    "this paper describes an implementation of a monte carlo solution to the collisional boltzmann equation known as _",
    "direct simulation monte carlo _ ( dsmc ) .",
    "algorithmically , it splits the full boltzmann equation into a purely collisionless left - hand side and a purely collisional right - hand side and solves the two parts sequentially .",
    "the solution of the former is solved is provided by a standard n - body procedure .",
    "the solution of the latter uses a space partition to define interaction domains for the simulated gas particles that are used to evaluate the boltzmann collision integral ( see  [ sec : algorithm ] ) .",
    "the implementation described here uses a doubly nested octree for decomposing the spatial domain ; the first - level coarse - grained tree is used for load balancing and the second - level fine - grained tree is used by each process to construct interaction domains ( see  [ sec : parallel ] ) .",
    "this approach is much faster than the brute - force approach of molecular dynamics but still much slower than cfd .",
    "although dsmc will work even in the limit of dense gases @xcite , we would like to use the full kinetic approach only when needed owing to its computational expense .",
    "a number of such approaches have been proposed in the literature , e.g. @xcite present adaptive mesh refinement schemes that use the navier - stokes equations or dsmc depending on the regime .",
    "the implementation in this paper also takes a multiscale adaptive approach based on the local density of particles : when the mean free path becomes small compared the density scale , we use a particle - only approach @xcite which solves the navier - stokes equations in the limit of large particle number ( see  [ sec : epsm ] ) .",
    "furthermore , although a bit noisier and possibly slower than the cfd  particle hybrid approaches , a particle - only scheme is straightforwardly parallelized and mated with a traditional n - body code .",
    "although we have thrown away the large - scale averaging implicit in the continuum hydrodynamic equations by adopting a particle - only approach , we have gained a method that is explicitly stable ( i.e. no courant - friedrichs - lewy condition ) and shock boundaries are naturally resolved without need for artificial viscosity or shock - capturing techniques .",
    "we have seen in  [ sec : tests ] that this code correctly reproduces the standard shock - tube tests and develops kelvin - helmholtz instabilities that follow the analytic dispersion relation , both in the continuum limit .",
    "this approach does require an order of magnitude ( at least ) more fluid particles in the continuum limit , although it has the advantage of consistently transitioning to dilute gases , correctly resolving shocks , and resolving phase boundaries .",
    "the tests in paper 2 use the classic fixed - composition cooling curves in the lte limit both to facilitate comparison with published results and for the ease of implementation .",
    "however , the traditional dsmc implementation is based on individual particle cross sections .",
    "it is natural and straightforward to include multiple distinct species , interactions , and excitations within the dsmc framework and self - consistently compute the radiation spectrum from the gas in the optically thin limit .",
    "when the heating or cooling of the gas overall depends on specific elemental or molecular lines from species with low fractional number density ( e.g. singly or multiply ionized oxygen , carbon and nitrogen with @xmath163 k ) , these species may be included as _ tracer _ subspecies by solving rate equations in the qss limit or using weighting schemes with or without particle production . as described in ",
    "[ sec : motivation ] and  [ sec : coolheat ] , we are currently testing a dsmc implementation that includes any specie whose atomic data is included in the chianti atomic data base @xcite , including the standard plasma cross sections . continuing to generalize the microphysics , it should be possible to consistently include additional plasma physics by adding the simultaneous solution of the electrostatic poisson equation . of course , the time - dependent solution of maxwell s equations is a very stiff challenging problem , but intermediate charge - flow problems are tractable using dsmc .",
    "paper 2 applies the hybrid dsmc ",
    "n - body code from this paper to study the effect of an icm wind on a galaxy s ism , commonly known as _",
    "ram pressure_. as illustrated by paper 2 , dsmc may help us understand the multiphase medium on small scales by enabling accurate treatment of interfaces in the ism . finally , on much larger scales , dsmc can be used to simulate the dominant processes in intra - cluster gas dynamics , such as the formation and interaction of bubbles , conduction at interfaces , etc .",
    "this material is based upon work supported by the national science foundation under grant no . ast-0907951 ."
  ],
  "abstract_text": [
    "<S> we describe a hybrid direct simulation monte carlo ( dsmc ) code for simultaneously solving the _ collisional _ boltzmann equation for gas and the _ collisionless _ boltzmann equation for stars and dark matter for problems important to galaxy evolution . </S>",
    "<S> this project is motivated by the need to understand the controlling dynamics at interfaces between gases of widely differing densities and temperature , i.e. multiphase media . while more expensive than hydrodynamics , the kinetic approach does not suffer from discontinuities and it applies when the continuum limit does not , such as in the collapse of galaxy clusters and at the interface between coronal halo gas and a thin neutral gas layer . </S>",
    "<S> finally , the momentum flux is carried , self - consistently , by particles and this approach explicitly resolves and thereby ` captures ' shocks .    </S>",
    "<S> the dsmc method splits the solution into two pieces : 1 ) the evolution of the phase - space flow _ without _ collisions ; and 2 ) the evolution governed the collision term alone _ without _ phase - space flow . </S>",
    "<S> this splitting approach makes dsmc an ideal match to existing particle - based n - body codes . </S>",
    "<S> if the mean free path becomes very small compared to any scale of interest , the method abandons simulated particle collisions and simply adopts the relaxed solution in each interaction cell consistent with the overall energy and momentum fluxes . </S>",
    "<S> this is functionally equivalent to solving the navier - stokes equations on a mesh . </S>",
    "<S> our implementation is tested using the sod shock tube problem and the non - linear development of an kelvin - helmholtz unstable shear layer .    </S>",
    "<S> [ firstpage ]    hydrodynamics  atomic processes  methods : numerical  galaxies : ism  ism : structure , evolution </S>"
  ]
}