{
  "article_text": [
    "let @xmath0 be probability measures on the real line @xmath1 .",
    "a monge  kantorovich transport from @xmath2 to @xmath3 is a probability @xmath4 on @xmath5 whose marginals are @xmath2 and  @xmath3 , respectively ; that is , if @xmath6 is the identity map on @xmath5 , then @xmath7 is the distribution of @xmath8 under @xmath4 and similarly @xmath9 .",
    "the set of all these transports is denoted by @xmath10 .",
    "let @xmath11 and consider the disintegration @xmath12 .",
    "if the stochastic kernel @xmath13 $ ] is given by the dirac mass @xmath14 for a map @xmath15 , then @xmath16 is called the corresponding monge transport . in general , a monge  kantorovich transport may be interpreted as a randomized monge transport .",
    "let @xmath17 be a ( measurable ) real function on @xmath5 ; then the cumulative reward for transporting @xmath2 to @xmath3 according to @xmath4 is @xmath18 \\equiv \\int_{{\\mathbb{r}}^{2 } } f(x , y ) \\,p(dx , dy)\\ ] ] and the monge  kantorovich optimal transport problem is given by @xmath19 in an alternate interpretation , the negative of @xmath17 is seen as a cost and the above is the minimization of the cumulative cost .",
    "one advantage of the monge ",
    "kantorovich formulation is that an optimizer @xmath11 exists as soon as @xmath17 is upper semicontinuous and sufficiently integrable ( of course , existence may fail when @xmath17 is merely measurable ) .",
    "optimal transport has been a very active field in the last several decades ; we refer to villani s monographs  @xcite or the lecture notes by ambrosio and gigli  @xcite for background .    in the so - called _ martingale optimal transport _ problem",
    ", we only consider transports which are martingale laws ; then @xmath2 can be seen as the distribution of a martingale at time @xmath20 and @xmath3 as the distribution of the process at @xmath21 .",
    "this problem was introduced by beiglbck , henry - labordre and penkner  @xcite in the discrete - time case and by galichon , henry - labordre and touzi  @xcite in continuous time . in the present paper ,",
    "we focus on the most fundamental case , where the transport takes place in a single time step .",
    "that is , a martingale transport from @xmath2 to @xmath3 is a law @xmath22 under which @xmath6 is a martingale ; of course , this necessitates that @xmath2 and @xmath3 have finite first moments . we let @xmath23=x\\ ; p{\\mbox{-a.s.}}\\big\\}\\ ] ] denote the set of martingale transports",
    ". alternately , consider a disintegration @xmath12 of @xmath22 ; then @xmath4 is a martingale transport if and only if  @xmath24 is the barycenter ( mean ) of @xmath25 for @xmath2-a.e .",
    "@xmath26 ; that is , @xmath27 . here",
    "we may also observe that monge transports are meaningless in this context  only a constant martingale is deterministic .",
    "the martingale property induces an asymmetry between @xmath2 and @xmath3the marginals can only become more dispersed over time .",
    "more precisely , the set @xmath28 is nonempty if and only if @xmath0 are in convex order , denoted @xmath29 , meaning that @xmath30 whenever @xmath31 is a convex function ( see proposition  [ pr : convexorder ] ) . under this condition ,",
    "the martingale optimal transport problem is given by @xmath32 the present paper develops a complete duality theory for this problem , for general reward functions and marginals .",
    "in particular , we obtain existence in the dual problem , and that is the main goal of this paper .",
    "the problem   was first studied in  @xcite . in analogy to the hoeffding ",
    "frchet coupling of classical transport , @xcite establishes a measure  @xmath4 , the so  called left - curtain coupling , that is optimal in   for reward functions  @xmath17 of a specific form .",
    "this form was generalized to a version of the spence ",
    "mirrlees condition in @xcite , where the coupling is also described more explicitly , whereas  @xcite shows the stability with respect to the marginals . on the other hand , @xcite find the optimal transports for @xmath33 .",
    "a generalization of the martingale transport problem , where an arbitrary linear constraint is imposed on @xmath10 , is studied in @xcite .",
    "martingale optimal transport is motivated by considerations of model uncertainty in financial mathematics .",
    "starting with  @xcite , a stream of literature studies robust bounds for option prices via the skorokhod embedding problem and this can be interpreted as optimal transport in continuous time ; cf .",
    "@xcite for surveys .",
    "the opposite direction is taken in @xcite , where skorokhod embeddings are studied from an optimal transport point of view .",
    "recently , a rich literature has emerged around the topics of model robustness and transport ; see , e.g. , @xcite for models in discrete time and @xcite for continuous - time models .",
    "let us first recall the duality results for the classical case  .",
    "indeed , the dual problem is given by @xmath34 here @xmath35 and @xmath36 are real functions that can be seen as lagrange multipliers for the marginal constraints in  .",
    "there are two fundamental results on this duality in a general setting , obtained by kellerer  @xcite .",
    "first , there is _ no duality gap _ ; i.e. , the values of   and   coincide .",
    "second , _ there exists an optimizer _",
    "@xmath37 for the dual problem , whenever its value   is finite .",
    "while additional regularity assumptions allow for easier proofs , the results of  @xcite apply to _ any _ borel function @xmath38 $ ] .",
    "an important application is the `` fundamental theorem of optimal transport '' @xcite or `` monotonicity principle '' which describes the trajectories used by optimal transports : there exists a set @xmath39 such that a given transport @xmath11 is optimal for   if and only if @xmath4 is concentrated on  @xmath40 .",
    "this set can be obtained directly from a dual optimizer @xmath41 by setting @xmath42 in fact , given @xmath43 , one can find @xmath44 by @xmath17-concave conjugation and vice versa , so that either of the functions may be called the kantorovich potential of the problem , and then @xmath40 is the graph of its @xmath17-subdifferential .",
    "the set @xmath40 has an important property called @xmath17-cyclical monotonicity which can be used to analyze the geometry of optimal transports ; we refer to  @xcite for further background .",
    "let us now move on to the dual problem in the case of interest , where the martingale constraint gives rise to an additional lagrange multiplier .",
    "formally , @xmath45=x$ ] is equivalent to @xmath46=0 $ ] for all functions @xmath47 and thus the domain of the analogue of   consists of triplets @xmath48 of real functions such that @xmath49 while the dual cost function is unchanged , @xmath50 in  @xcite , it was shown that there is no duality gap whenever the reward function  @xmath17 is _ upper semicontinuous _ and satisfies a linear growth condition , and the analogous result holds in the setting of  @xcite .",
    "on the other hand , a counterexample in  @xcite showed that the dual problem may _ fail _ to admit an optimizer , even if @xmath17 is bounded continuous and the marginals are compactly supported .",
    "the proofs of the positive results in  @xcite , absence of a duality gap , reduce to classical transport theory by dualizing the martingale constraint and using a minimax argument .",
    "only the latter step requires upper semicontinuity , and it is easy to believe that it is a technical condition necessitated only by the technique of proof .",
    "this turns out to be wrong : we provide a counterexample ( example  [ ex : dualitygap ] ) showing that the dual problem   can produce a duality gap in a fairly tame setting with compactly supported marginals and a reward function that is bounded and lower semicontinuous . regarding the absence of an optimizer",
    ", we provide a counterexample ( example  [ ex : noattainment ] ) which is , in a sense to be made specific , simpler than the one in  @xcite and suggests that failure of existence is generic as soon as the marginals do not satisfy a condition called irreducibility ( see below and section  [ se : prelimconvexorder ] ) and @xmath17 is not smooth .",
    "let us now introduce a formulation of the dual problem which will allow us to overcome both issues and develop a complete duality theory  dual existence and no duality gap  for general reward functions .",
    "the most important novelty is that we shall reformulate the pointwise inequality of   in a quasi - sure way .",
    "indeed , we say that a property holds _ @xmath28-quasi - surely _",
    "( q.s .  for short )",
    "if it holds outside a @xmath28-polar set ; that is , a set which is @xmath4-null for all @xmath51 .",
    "we then replace   by @xmath52 i.e. , the inequality holds @xmath4-a.s .  for all @xmath51 . for the classical transport",
    ", it is known that all polar sets are of a trivial type ",
    "they are negligible for one of the marginals .",
    "this is different in the martingale case . indeed , as observed in  @xcite , there are obstacles that can not be crossed by any martingale transport .",
    "these barriers divide the real line into intervals that ( almost ) do not interact and are therefore called irreducible components .",
    "our first important result ( theorem  [ th : polardescr ] ) provides a complete characterization of the @xmath28-polar sets : a subset of @xmath5 is polar if and only if it consists of trajectories a ) crossing a barrier or b ) negligible for one of the marginals . on the strength of this result , we have a rather precise understanding of  ; namely , it represents a pointwise inequality on each irreducible component , modulo sets that are not seen by the marginals .",
    "we thus proceed by first studying an irreducible component ; the analysis has two parts .",
    "on the one hand , there are soft arguments of separation ( hahn  banach ) and extension ( choquet theory ) that are familiar from classical transport theory . on the other hand",
    ", there is an important closedness result ( proposition  [ pr : closednessirred ] ) based on novel arguments : given reward functions @xmath53 and corresponding almost - optimal dual elements @xmath54 , we construct a limit @xmath48 for  @xmath17 . the proof of this result is deeply linked to the convex order of the marginals .",
    "indeed , we introduce concave functions  @xmath55 which control @xmath56 in the sense of one - sided bounds . a compactness result of arzela  ascoli type is established for the sequence @xmath57 , based on a bound of the form @xmath58 after finding a limit @xmath59 for @xmath55 , we can produce limits @xmath41 for @xmath56 by komlos - type arguments , and the corresponding function @xmath47 can be found in an a posteriori fashion .",
    "the compactness result yields some insight into the failure of the pointwise formulation   for the global problem : the bound   does not control the concavity of  @xmath55 at barriers because the inequality between @xmath2 and @xmath3 is not `` strict '' in the convex order at these points .",
    "a second relaxation is necessary to obtain our duality result ; namely , the cost @xmath60 needs to be defined in an extended sense .",
    "we provide counterexamples showing that the existence of dual optimizers ( example  [ ex : nointegrability ] ) and in some cases the absence of a duality gap ( example  [ ex : gapwithintegrability ] ) break down if one insists on @xmath44 and @xmath43 being integrable for @xmath2 and @xmath3 , individually .",
    "we shall see that several natural definitions of @xmath60 lead to the same value .    with these notions in place ,",
    "our main result ( theorem  [ th : dualityglobal ] ) is that duality holds for arbitrary borel reward functions @xmath61 $ ] ; here the lower bound can be relaxed easily ( remark  [ rk : lowerbound ] ) but not eliminated completely ( example  [ ex : dualitygaplower ] ) .",
    "moreover , existence holds in the dual problem whenever it is finite . as a consequence ,",
    "we derive a monotonicity principle ( corollary  [ co : monotonicityprinciple ] ) with a set analogous to   in a fairly definitive form , generalizing and simplifying results of @xcite .",
    "while there are no previous results on duality for irregular reward functions , we mention that the proof of the monotonicity principle in @xcite contains elements of a theory for dual optimizers for the case of continuous @xmath17 , although the dual problem as such is not formalized in @xcite .",
    "we expect that the quasi - sure formulation proposed in the present paper will prove to be a useful framework not only for the situation at hand but for a large class of transport problems ; in particular , to obtain dual attainment under general conditions .",
    "the remainder of the paper is organized as follows . in section  [",
    "se : prelimconvexorder ] , we recall preliminaries on the convex order and potential functions . the structure of @xmath28-polar sets is characterized in section  [ se : polarsets ] , and section  [ se : generalizedintegral ] discusses the extended definition of @xmath60 . the crucial closedness result for the dual problem is obtained in section  [ se : closednessonirred ] , which allows us to establish the duality on an irreducible component in section  [ se : dualityonirred ] .",
    "section  [ se : mainresults ] combines the previous results to obtain the global duality theorem and the monotonicity principle .",
    "the counterexamples are collected in the concluding section  [ se : counterexamples ] .",
    "it will be useful to consider finite measures , not necessarily normalized to be probabilities .",
    "the notions introduced in section  [ se : intro ] extend in an obvious way .",
    "let @xmath0 be finite measures on @xmath1 with finite first moment .",
    "we say that  @xmath2 and  @xmath3 are in _ convex order _ , denoted @xmath29 , if @xmath62 for any convex function @xmath63 .",
    "it then follows that @xmath2 and @xmath3 have the same total mass and the same barycenter .",
    "an alternative characterization of this order refers to the so - called potential function , defined by @xmath64 this is a nonnegative convex function with a minimum at the median of  @xmath2 , and @xmath2 can be recovered from @xmath65 via the second derivative measure .",
    "the following result is known ; the nontrivial part is ( * ? ? ?",
    "* theorem  8) .",
    "[ pr : convexorder ] suppose that @xmath66 .",
    "the following are equivalent :    1 .   the measures @xmath2 and @xmath3 are in convex order : @xmath29 .",
    "the potential functions of @xmath2 and @xmath3 are ordered : @xmath67 .",
    "there exists a martingale transport from @xmath2 to @xmath3 : @xmath68",
    ".    it will be important to distinguish the intervals where @xmath69 from the points where the potential functions touch , because such points act as barriers for martingale transports . in all that follows",
    ", the statement @xmath29 implicitly means that @xmath0 are finite measures on @xmath1 with finite first moment .",
    "[ de : irred ] the pair @xmath29 is _ irreducible _ if the set @xmath70 is connected and @xmath71 .",
    "in this situation , let  @xmath72 be the union of  @xmath73 and any endpoints of @xmath73 that are atoms of @xmath3 ; then  @xmath74 is the _ domain _ of @xmath75 .    as @xmath76 outside of @xmath73 and @xmath71 and @xmath2 ,",
    "@xmath3 have the same mass and mean , the measure @xmath3 is concentrated on @xmath72 . more precisely , the open interval  @xmath73 is the interior of the convex hull of the support of  @xmath3 , and @xmath72 is the minimal superset of @xmath73 supporting  @xmath3 .",
    "the marginals @xmath29 can be decomposed into irreducible components as follows ; cf .",
    "* theorem 8.4 ) .",
    "[ pr : decomp ] let @xmath29 and let @xmath77 be the ( open ) components of @xmath78 , where @xmath79 .",
    "set @xmath80 and @xmath81 for @xmath82 , so that @xmath83",
    ". then , there exists a unique decomposition @xmath84 such that @xmath85 and this decomposition satisfies @xmath86 for all @xmath87 .",
    "moreover , any @xmath51 admits a unique decomposition @xmath88 such that @xmath89 for all @xmath90 .    the index @xmath91 is special in the above : the measure @xmath92 is the unique martingale transport from @xmath93 to itself , given by the law of @xmath94 under @xmath93 .",
    "this corresponds to a constant martingale or the identical monge transport .",
    "in particular , @xmath92 does not depend on @xmath51 .",
    "we observe that @xmath92 is concentrated on @xmath95 , the part of the diagonal @xmath96 which is not contained in any of the squares @xmath97 for @xmath98 .",
    "thus , @xmath99 will play a role similar to @xmath97 for @xmath100 . a second remark",
    "is that both of the families @xmath101 and @xmath102 are mutually singular , whereas @xmath103 need not be .",
    "indeed , an atom of @xmath3 may be split such as to contribute to two adjacent components @xmath104 .",
    "we close this section with a technical remark for later use .",
    "[ rk : irredatoms ] we observe from the definition that the continuous convex function @xmath65 is affine to the left and to the right of the support of @xmath2 , with absolute slope equal to the mass of @xmath2 .",
    "moreover , discontinuities of the first derivative correspond to atoms of @xmath2 .",
    "let @xmath29 be irreducible with domain @xmath74 and write @xmath105 .",
    "as @xmath71 , the measure @xmath2 can not have atoms at the boundary points of  @xmath73 .",
    "suppose that @xmath106 ; then the derivative @xmath107 exists and is equal to  @xmath108 .",
    "however , the measure @xmath3 may have an atom at @xmath109 , and while the right derivative @xmath110 is always equal to @xmath107 , the left derivative satisfies @xmath111 similarly , if @xmath112 , we have @xmath113 and @xmath114",
    "the goal of this section is to characterize the sets which can not be charged by any martingale transport . given a collection @xmath115 of measures on some space  @xmath116 , a set @xmath117 is called _ @xmath115-polar _ if is it @xmath4-null for every @xmath118 .    for the classical mass transport , the following result can be obtained by applying kellerer s duality theorem  @xcite to the indicator function @xmath119 ; cf .",
    "* proposition  2.1 ) .",
    "[ pr : polardescrclassical ] let @xmath0 be finite measures of the same total mass and let @xmath120 be a borel set",
    ". then @xmath121 is @xmath10-polar if and only if there exist a @xmath2-nullset @xmath122 and a @xmath3-nullset @xmath123 such that @xmath124    the above result , which holds true more generally for arbitrary polish spaces , states that the only @xmath10-polar sets are the obvious ones : the sets which are not seen by the marginals .",
    "this is the reason why in the classical dual transport problem , there is no difference between a quasi - sure formulation and a pointwise formulation .",
    "namely , if @xmath125 holds @xmath10-q.s .",
    ", let @xmath121 be the exceptional set and let @xmath122 , @xmath123 be as above . then setting @xmath126 on @xmath122 and @xmath127 on @xmath123 yields @xmath125 pointwise on  @xmath5 , without changing the cost @xmath60 .    the situation is fundamentally different for the martingale transport . unless @xmath29 is irreducible , there are obstructions to all martingale transports , and more precisely , a set that `` fails to be on a component '' is polar , even if it is seen by the marginals .",
    "the following result completely describes the structure of @xmath28-polar sets .    , the striped areas correspond to the domains of two irreducible components .",
    "the dotted areas are polar even though they are not negligible for the marginals . ]",
    "[ th : polardescr ] let @xmath29 and let @xmath120 be a borel set",
    ". then @xmath121 is @xmath28-polar if and only if there exist a @xmath2-nullset @xmath122 and a @xmath3-nullset @xmath123 such that @xmath128 where @xmath96 is the diagonal .",
    "the main step in the proof is the following construction .",
    "[ le : dominatingmartingalelaw ] let @xmath29 be irreducible and let @xmath129 be a finite measure on  @xmath5 whose marginals @xmath130 satisfy we mean that @xmath131 for every borel set @xmath132 . ]",
    "@xmath133 and @xmath134 .",
    "then , there exists @xmath51 such that @xmath4 dominates @xmath129 in the sense of absolute continuity .",
    "let @xmath74 be the domain of @xmath75 .",
    "we may assume that @xmath0 are probability measures ; in particular , @xmath135 .",
    "\\(i ) we first show the result under the additional hypothesis that @xmath129 is supported on an compact rectangle @xmath136 .",
    "writing @xmath105 , the definition of @xmath74 implies that @xmath3 assigns positive mass to any neighborhood of @xmath137 .",
    "since @xmath138 is compact , it has positive distance to @xmath137 and we can find a compact set @xmath139 with @xmath140 to the left of @xmath138 ; i.e. , @xmath141 for all @xmath142 and @xmath143 .",
    "similarly , we can find a compact @xmath144 with positive mass to the right of @xmath138 .",
    "let @xmath145 be a disintegration of @xmath129 ; we may choose a version of the kernel @xmath146 that is concentrated on @xmath147 for all @xmath143 .",
    "we shall now change the mean of @xmath25 such as to render it a martingale kernel . indeed , let us introduce a kernel @xmath148 of the form",
    "@xmath149 here @xmath150 is the normalizing constant such that @xmath151 is a stochastic kernel .",
    "moreover , for @xmath24 such that the mean of @xmath152 is smaller or equal to @xmath24 , we set @xmath153 and define @xmath154 as the unique nonnegative scalar such that the mean of @xmath155 equals @xmath24 , and analogously in the opposite case . note that @xmath156 are well - defined because @xmath157 is at a positive distance to the left ( resp .",
    "right ) of @xmath143",
    ". then , @xmath158 is a martingale measure with @xmath159 and its marginals @xmath160 satisfy @xmath161 as well as @xmath162 ; the latter is due to @xmath163 and @xmath164 and @xmath165 we also note that @xmath166 where @xmath167 is the convex set generated by @xmath168 and @xmath169 .",
    "it remains to find @xmath51 such that @xmath170 .",
    "\\(a ) we first consider the case where @xmath171 . since @xmath172 is continuous and strictly positive on @xmath73 , this difference",
    "is uniformly bounded away from zero on the compact set @xmath173 . on the other hand ,",
    "the continuous function @xmath174 is uniformly bounded on @xmath175 .",
    "hence , there is @xmath176 such that @xmath177 but then this inequality extends to the whole of @xmath1 because @xmath178 outside of @xmath175 , due to  . noting also that @xmath179",
    ", we thus have @xmath180 and these are nonnegative measures due to @xmath181 and @xmath162 .",
    "hence , @xmath182 is nonempty ; cf .",
    "proposition  [ pr : convexorder ] .",
    "let  @xmath183 be any element of that set and define @xmath184 by construction , @xmath4 is an element of @xmath28 and @xmath185 .",
    "\\(b ) next , we discuss the case where @xmath3 has an atom at one or both of the endpoints of @xmath73 .",
    "suppose that @xmath186 ; then @xmath175 may touch the right boundary of @xmath72 and we need to give a different argument for the existence of @xmath187 as above , since @xmath172 need no longer be bounded away from zero on @xmath175 .",
    "however , the left derivatives satisfy @xmath188 by remark  [ rk : irredatoms ] , and similarly at @xmath137 if @xmath189 . recalling that the derivatives of any potential function  and in particular of @xmath190 and @xmath191are uniformly bounded by the total mass of the corresponding measure",
    ", we see that we can still find @xmath187 such that @xmath192 .",
    "the rest is as above .",
    "\\(ii ) finally , we treat the general case . as @xmath133 and @xmath134 , the measure  @xmath129",
    "is necessarily concentrated on @xmath193 .",
    "we can cover @xmath193 with a sequence @xmath194 of compact rectangles @xmath195 and define measures  @xmath196 supported by @xmath197 such that @xmath198 . for each @xmath199 ,",
    "our construction in ( i ) yields a martingale transport plan @xmath200 , and then @xmath201 satisfies the requirement of the lemma .",
    "[ co : polarsetsirred ] the pair @xmath29 is irreducible if and only if the @xmath10-polar sets and the @xmath28-polar sets coincide .",
    "if @xmath29 is irreducible , the conclusion is an immediate consequence of the preceding lemma .",
    "conversely , suppose that @xmath29 is not irreducible ; that is , there exists @xmath26 such that @xmath202 and @xmath203 and @xmath204 .",
    "then , the set @xmath205 is @xmath28-polar ( proposition  [ pr : decomp ] ) but not @xmath10-polar ( proposition  [ pr : polardescrclassical ] ) .    by proposition  [ pr : decomp ] and corollary  [ co : polarsetsirred ]",
    ", a borel set @xmath121 is @xmath28-polar if and only if @xmath206 is @xmath207-polar for all @xmath87 and @xmath208 is @xmath92-null .",
    "the result now follows by applying proposition  [ pr : polardescrclassical ] for each @xmath87 .",
    "let @xmath29 be irreducible with domain @xmath74 and let @xmath209 be a concave function and remark  [ rk : atomsestimate ] .",
    "moreover , we could allow @xmath59 to take the value @xmath210 on @xmath211 . ] .",
    "we assume that @xmath135 .",
    "our first aim is to define the difference @xmath212 .",
    "indeed , @xmath213 and @xmath214 are well defined in @xmath215 as @xmath216 has linear growth , but we need to elaborate on the difference",
    ". there are ( at least ) three natural definitions , and we shall see that they all yield the same value . to that end , note that @xmath59 is continuous on @xmath73 by concavity , but may have downward jumps at the boundary @xmath211 .",
    "we denote the absolute magnitude of the jump at @xmath217 by @xmath218 .    1 .   _ approximation .",
    "_ let @xmath219 be a sequence of open , bounded intervals increasing strictly to @xmath73 ( i.e. , @xmath220 has two components for all @xmath199 ) and consider the concave , linearly growing functions @xmath221 defined by the following conditions : @xmath222 on @xmath219 and on @xmath211 , whereas @xmath55 is affine on each component of @xmath220 , with continuous first derivative at the endpoints of @xmath219 .",
    "then , @xmath223 and @xmath224 are both finite and we set @xmath225.\\ ] ] we shall see below that the limit exists in @xmath226 $ ] .",
    "integration by parts .",
    "_ let @xmath227 be the ( locally finite ) second derivative measure of the convex function @xmath228 on @xmath73 and set @xmath229 as @xmath230 and @xmath231 , this quantity is well defined in @xmath226 $ ] .",
    "_ fix an arbitrary @xmath51 and consider a disintegration @xmath12 ; then we have @xmath232 for @xmath2-a.e .",
    "@xmath233 by jensen s inequality .",
    "thus , @xmath234    \\mu(dx)\\ ] ] is well defined in @xmath226 $ ] , and we shall see below that this value is independent of the choice of @xmath51 .",
    "this definition was already used in  @xcite .    for future reference ,",
    "let us recall the following fact about the second derivative measure @xmath235 : after normalizing @xmath59 and its left derivative @xmath236 such that @xmath237 for some @xmath238 ( by adding a suitable affine function ) , @xmath239 where @xmath240 $ ] are such that @xmath105 .",
    "if @xmath59 is continuous at the boundary of @xmath73 , this identity extends to @xmath241 by monotone convergence .",
    "[ le : intconcavewelldef ] the values @xmath242 are well defined in @xmath226 $ ] , depend only on @xmath59 and @xmath243 , and coincide for @xmath244 .    by concavity",
    ", @xmath59 is continuous on @xmath73 with possible downward jumps at the boundary .",
    "setting @xmath245 on @xmath73 and extending @xmath246 to @xmath72 by continuity , we have @xmath247 where @xmath248 is concave and continuous .",
    "by linearity of the @xmath3-integral , it suffices to show the claim for @xmath246 ; in other words , we may assume that @xmath59 is continuous .",
    "suppose first that @xmath249 .",
    "then , it is clear that @xmath242 is well defined for @xmath244 and that @xmath250 . to see the equality with @xmath251 ,",
    "let @xmath238 be arbitrary .",
    "writing again @xmath105 , we have @xmath252}\\int_{[a , r)}(s - t)^+ \\,\\chi''(dt)\\,(\\mu-\\nu)(ds ) .",
    "\\end{aligned}\\ ] ] applying fubini s theorem to both integrals and noting that the integrands vanish on certain sets , this can be rewritten as @xmath253 substituting @xmath254 in the first integral and using that @xmath2 and @xmath3 have the same mass and mean , this equals @xmath255 on the other hand , using @xmath256 yields that @xmath257 it follows that @xmath258 and that this value depends only on @xmath59 and @xmath243 .    for general @xmath59 ,",
    "define @xmath259 as before  ; the above establishes that the values of @xmath260 coincide for each @xmath199 . noting that @xmath55 decreases to @xmath59 stationarily and that @xmath261 is concave",
    ", monotone convergence entails that @xmath262 for @xmath263 , and in particular these limits coincide .",
    "it now follows that the limit defining @xmath264 must exist and have the same value .",
    "[ de : diffint ] we write @xmath265 for the common value of @xmath242 , @xmath244 .",
    "as the notation suggests , we have @xmath266 as soon as at least one of the latter integrals is finite  this follows from the representation  .",
    "however , it may happen that @xmath265 is finite but @xmath267 .",
    "the following remark elaborates on this .",
    "[ rk : finiteintegralsuffcond ] suppose that @xmath265 is finite ; then @xmath213 and @xmath214 are either both infinite or both finite .",
    "thus , one sufficient condition for their finiteness is that the support of @xmath2 be a compact subset of @xmath73 .",
    "a more general condition is the existence of a constant @xmath268 such that @xmath269 where @xmath270 is the barycenter of @xmath2 . indeed , by",
    ", this implies that @xmath271 thus , @xmath272 if the right - hand side is finite .",
    "one can formulate a similar sufficient condition by substituting @xmath273 with any measure @xmath274 satisfying @xmath275 and @xmath276 .",
    "[ ex : finiteintegralsuffcondgaussian ] let @xmath0 be gaussian with the same mean and variances @xmath277 .",
    "then , a direct computation shows that @xmath29 is irreducible and condition   is satisfied .",
    "it turns out that atoms at the endpoints of @xmath73 are helpful in terms of integrability .",
    "[ ex : finiteintegralsuffcondatoms ] suppose that @xmath29 is irreducible with domain @xmath74 .",
    "if @xmath73 is bounded and @xmath3 has atoms at both endpoints of @xmath73 , then   is satisfied .",
    "indeed , @xmath278 on @xmath73 and the slopes are separated at the endpoints ( cf .",
    "remark  [ rk : irredatoms ] ) so that @xmath279 has a positive limit at the boundary . using these two facts , follows .    very much in the same spirit , we have the following estimate related to the preceding example .",
    "[ rk : atomsestimate ] let @xmath29 be irreducible with domain @xmath74 , let @xmath73 have a finite right endpoint @xmath109 and let @xmath280 be a concave function such that @xmath237 , where @xmath238 is the common barycenter of  @xmath2 and  @xmath3 . in particular , @xmath281 and @xmath282 is concave . if @xmath3 has an atom at @xmath109 , then @xmath283 with a constant @xmath284 depending only on @xmath0 .",
    "indeed , as in example  [ ex : finiteintegralsuffcondatoms ] , remark  [ rk : irredatoms ] implies that there exists @xmath285 such that   holds on @xmath286 . as a consequence , @xmath287 where we have applied lemma  [ le : intconcavewelldef ] to @xmath282 .",
    "our next aim is to define expressions of the form @xmath60 in a situation where the individual integrals are not necessarily finite .",
    "we continue to assume that @xmath29 is irreducible with domain @xmath74 .",
    "[ de : modconcaveintegral ] let @xmath288 and @xmath289 be borel functions .",
    "if there exists a concave function @xmath209 such that @xmath290 and @xmath291 , we say that @xmath59 is a _ concave moderator _ for @xmath41 and set @xmath292,\\ ] ] where @xmath265 was introduced in definition  [ de : diffint ] .",
    "[ rk : integraldefindep ] the preceding definition is independent of the choice of the concave moderator @xmath59 . indeed , suppose there is another concave function @xmath246 such that @xmath293 and @xmath294 , then it follows that @xmath295 . using , for instance , the representation",
    ", we see that @xmath296 and now it follows that @xmath297 as desired .",
    "[ de : modconcavel ] we denote by @xmath298 the space of all pairs of borel functions @xmath288 and @xmath289 which admit a concave moderator @xmath59 such that @xmath299 .    in particular , @xmath60 is well defined and finite for @xmath300 , and has the usual value if @xmath301 .",
    "the following sanity check confirms that @xmath60 has the good value in the context of martingale transport .",
    "[ rk : integralofsuperhedge ] let @xmath300 and let @xmath302 be borel . if @xmath303 is bounded from below on @xmath193 , then @xmath304\\ ] ] for any @xmath51 .",
    "let @xmath59 be a concave moderator for @xmath41 .",
    "we may suppose that @xmath91 is a lower bound , so that @xmath305 as the first two terms are @xmath4-integrable , the negative part of the remaining expression is @xmath4-integrable and @xmath306 $ ] equals @xmath307.\\ ] ] let @xmath12 be a disintegration of @xmath4 ; then by the linear growth of  @xmath216 , the following integrals are well defined and equal , @xmath308 \\,\\kappa(x , dy ) = \\int [ \\chi(x)- \\chi(y ) ] \\,\\kappa(x , dy)\\ ] ] for @xmath2-a.e .  @xmath233 .",
    "as the negative part of @xmath309 is @xmath4-integrable , fubini s theorem ( for kernels ) yields @xmath310 = \\iint [ \\chi(x)- \\chi(y ) ] \\,\\kappa(x , dy)\\ , \\mu(dx)\\ ] ] and the right - hand side equals @xmath265 by lemma  [ le : intconcavewelldef ] .",
    "in this section , we analyze the dual problem on a single component ; that is , we continue to assume that @xmath29 is irreducible with domain @xmath74 .",
    "[ de : dualdomainpointw ] let @xmath311 $ ] .",
    "we denote by @xmath312 the set of all borel functions @xmath313 such that @xmath300 and @xmath314 moreover , we denote by @xmath315 the subset of all @xmath316 with @xmath35 and @xmath36 .",
    "we emphasize that in this definition , the inequality is stated in the pointwise ( `` pw '' ) sense . for later reference",
    ", we also note that there are two degrees of freedom in the choice of @xmath48 .",
    "namely , given constants @xmath317 , the triplet @xmath48 belongs to @xmath312 if and only if the the triplet @xmath318 does , and then @xmath319 .",
    "the goal of the present section is the following closedness result for @xmath312 ; it is at the very heart of our duality and existence theory .",
    "[ pr : closednessirred ] suppose that @xmath29 is irreducible with domain @xmath74 , let  @xmath320 $ ] be such that @xmath53 pointwise and let @xmath321 satisfy @xmath322 .",
    "then , there exist @xmath323    the irreducible pair @xmath29 is fixed for the rest of this section , so let us simplify the notation to @xmath324 as a first step towards the proof of proposition  [ pr : closednessirred ] , we introduce concave functions which will control simultaneously @xmath325 and @xmath326 , in the sense of one - sided bounds .",
    "[ le : passagetochi ] let @xmath327 .",
    "then , there exists a concave moderator @xmath209 for @xmath328 such that @xmath329 in particular , @xmath330 .",
    "the function @xmath331,\\quad y\\in j\\ ] ] is concave as an infimum of affine functions , and @xmath300 implies that @xmath332 on a nonempty set , so that @xmath231 everywhere on @xmath72 .",
    "moreover , we clearly have @xmath333 on @xmath73 . our assumption that @xmath334 shows that @xmath335 on @xmath72 . since @xmath300 , the set @xmath336 is dense in @xmath337 , and by concavity it follows that @xmath338 on the interior of the convex hull of @xmath337 ; that is , on the interval @xmath73 .",
    "moreover , @xmath339 must contain any atom of @xmath3 and in particular @xmath211 , so that @xmath338 on @xmath72 .    setting @xmath340 and @xmath341",
    ", we can write   as @xmath342 + h(x)(y - x ) \\geq0 , \\quad ( x , y)\\in i\\times j.\\ ] ] let @xmath343 be a disintegration of some @xmath51 . for fixed @xmath233 , all four terms above are bounded from below by linearly growing functions .",
    "it follows that for @xmath2-a.e .",
    "@xmath233 , the integral of the left - hand side with respect to @xmath146 can be computed term - by - term , which yields @xmath344 \\,\\kappa(x , dy).\\ ] ] these three terms are nonnegative , and thus the integral with respect to @xmath2 can again be computed term - by - term . by fubini s theorem and lemma  [ le : intconcavewelldef ] , it follows that @xmath345 + h(x)(y - x ) ] = \\mu(\\bar\\varphi ) + \\nu(\\bar\\psi)+ ( \\mu - \\nu)(\\chi).\\ ] ] of course , the left - hand side is also equal to @xmath306 $ ] and therefore finite by remark  [ rk : integralofsuperhedge ] .",
    "thus , the right - hand side is finite as well . as a result ,",
    "@xmath346 with concave moderator @xmath59 , and @xmath347 as desired .",
    "let us record a variant of the preceding construction for later use .",
    "[ rk : reverseintegrability ] let @xmath348 \\times ( -\\infty,\\infty ]   \\times { \\mathbb{r}}$ ] be borel functions such that @xmath349 then , @xmath300 if and only if @xmath306<\\infty$ ] for some ( and then all ) @xmath51 .",
    "the `` only if '' statement is immediate from remark  [ rk : integralofsuperhedge ] . for the converse ,",
    "let @xmath306<\\infty$ ] for some @xmath51 ; then @xmath44 is finite @xmath2-a.s .",
    "and @xmath43 is finite @xmath3-a.s .",
    "we can then follow the proof of lemma  [ le : passagetochi ] up to   to define a concave function @xmath209 such that @xmath340 and @xmath341 and @xmath350 = \\mu(\\bar\\varphi ) + \\nu(\\bar\\psi)+ ( \\mu - \\nu)(\\chi).\\ ] ] since the left - hand side is finite , the three ( nonnegative ) terms on the right - hand side are finite as well ; that is , @xmath300 with concave moderator  @xmath59 .",
    "our second tool for the main result is a compactness principle for concave functions .",
    "irreducibility is crucial for its proof , so let us restate this standing condition .",
    "the notation @xmath351 refers to the left derivative ( say ) .",
    "[ pr : concavecompactness ] let @xmath29 be irreducible with domain @xmath74 and let @xmath238 be the common barycenter of @xmath2 and @xmath3 .",
    "let @xmath221 be concave functions such that @xmath352 there exists a subsequence @xmath353 which converges pointwise on @xmath72 to a concave function @xmath209 , and @xmath354 .    by our assumption , @xmath355 is bounded uniformly in @xmath199 . in view of",
    ", this implies that there exists a constant @xmath356 such that @xmath357 where we have used that @xmath211 consists of ( at most two ) atoms of @xmath3 and @xmath358 on @xmath73 . by the same fact",
    ", we thus have @xmath359 for a suitable subsequence @xmath353 ; we may assume that @xmath360 .",
    "moreover , the first inequality shows that the sequence of finite measures defined by @xmath361 is bounded and thus relatively compact for the weak topology induced by the compactly supported continuous functions on @xmath73 . recalling that @xmath172 is continuous and strictly positive on @xmath73",
    ", it follows that @xmath362 is relatively weakly compact as well . in view of @xmath363 ,",
    "this implies a uniform bound for the lipschitz constant of @xmath55 on any given compact subset of @xmath73 . using also @xmath364 , the arzela ",
    "ascoli theorem then yields a function @xmath365 such that @xmath366 locally uniformly , after passing to a subsequence .",
    "clearly @xmath59 is concave , and integration by parts shows that @xmath367 converges weakly to the second derivative measure @xmath227 associated with @xmath59 . approximating @xmath368 from above with compactly supported continuous functions on @xmath73 , we then see that @xmath369 together with  , we can define @xmath59 on @xmath72 and the result follows via  .",
    "we can now derive the main result of this section .",
    "since @xmath370 and @xmath371 , we can introduce the associated concave functions @xmath55 as in lemma  [ le : passagetochi ] .",
    "normalizing @xmath54 as in   with suitable constants , we may assume that @xmath372 ; note that the relations @xmath373 and @xmath374 are preserved .",
    "after passing to a subsequence , proposition  [ pr : concavecompactness ] then yields a pointwise limit @xmath280 for the @xmath55 .    since @xmath375 , komlos lemma ( in the form of ( * ? ? ?",
    "* lemma  a1.1 ) and its subsequent remark ) shows that there are @xmath376 which converge @xmath2-a.s . , and similarly for @xmath326 .",
    "without loss of generality , we may assume that @xmath377 , and similarly for  @xmath326 .",
    "thus , setting @xmath378 yields borel functions @xmath44 , @xmath43 such that @xmath379 fatou s lemma and proposition  [ pr : concavecompactness ] then show that @xmath380 \\\\      & = \\liminf [ \\mu(\\varphi_{n } ) + \\nu(\\psi_{n } ) ] < \\infty .",
    "\\end{aligned}\\ ] ] in particular , this shows that @xmath300 with concave moderator @xmath59 , and then the above may be stated more concisely as @xmath381    it remains to find @xmath47 .",
    "for any function @xmath382 , let @xmath383 denote the concave envelope .",
    "given a sequence of such functions @xmath384 , we have @xmath385 as @xmath386 and @xmath387 is concave .",
    "moreover , @xmath370 means that @xmath388 which implies that @xmath389^{conc}(y ) , \\quad ( x , y)\\in i\\times j.\\ ] ] fix @xmath233 ; then these two facts yield @xmath390      & \\geq \\liminf [ f_{n}(x,\\cdot)-\\psi_{n}]^{conc}(y ) \\\\      & \\geq [ \\liminf   ( f_{n}(x,\\cdot)-\\psi_{n})]^{conc}(y ) \\\\      & \\geq [ f(x,\\cdot)-\\psi]^{conc}(y ) \\\\      & = : \\hat\\varphi(x , y )    \\end{aligned}\\ ] ] for all @xmath241 , and for the specific choice @xmath391 we obtain that @xmath392 as @xmath393 and @xmath394 , we have @xmath395 for all @xmath241 . if @xmath396 , the above inequalities also show that @xmath397 and as a result , the concave function @xmath398 is finite on @xmath72 and admits a left derivative @xmath399 by concavity , it follows that @xmath400 for all @xmath241 . setting @xmath401 on @xmath402",
    ", we then have @xmath403 for all @xmath404 , because the left - hand side is infinite for @xmath405 .",
    "thus , @xmath406 and the proof is complete .",
    "let @xmath29 be irreducible with domain @xmath74 .",
    "we define the primal and dual values as follows .",
    "[ de : primalanddualonirred ] let @xmath38 $ ] .",
    "the _ primal problem _ is @xmath407,\\ ] ] where @xmath408 refers to the outer integral if @xmath17 is not measurable .",
    "the _ dual problem _ is @xmath409.\\ ] ]    the goal of this section is the following duality result ; it corresponds to our main result in the case of irreducible marginals .",
    "we recall that a function @xmath38 $ ] is called _ upper semianalytic _ if the sets @xmath410 are analytic for all @xmath411 , where a subset of @xmath5 is called analytic if it is the ( forward ) image of a borel subset of a polish space under a borel mapping .",
    "any borel function is upper semianalytic and any upper semianalytic function is universally measurable ; see , e.g. , ( * ? ? ?",
    "* chapter  7 ) for background .",
    "[ th : dualityirred ] let @xmath29 be irreducible and let @xmath38 $ ] .    1 .",
    "if @xmath17 is upper semianalytic , then @xmath412 $ ] .",
    "if @xmath413 , there exists a dual optimizer @xmath414 .",
    "the proof of theorem  [ th : dualityirred ] is based on proposition  [ pr : closednessirred ] , choquet s theorem and a separation argument , so let us introduce the relevant terminology .",
    "let @xmath226^{{\\mathbb{r}}^2}$ ] be the set of all functions @xmath38 $ ] , let @xmath415 be the sublattice of upper semianalytic functions and let @xmath416 be the sublattice of bounded upper semicontinuous functions ; note that @xmath416 is stable with respect to countable infima .",
    "a mapping @xmath417^{{\\mathbb{r}}^2 } \\to [ 0,\\infty]$ ] is called a @xmath416-capacity if it is monotone , sequentially continuous upwards on @xmath226^{{\\mathbb{r}}^2}$ ] , and sequentially continuous downwards on  @xmath416 .",
    "we write @xmath418 and @xmath419 for the rest of this section ; both of these mappings will turn out to be capacities .",
    "[ le : siscapacity ] the mapping @xmath420^{{\\mathbb{r}}^2}\\to [ 0,\\infty]$ ] is a @xmath416-capacity .",
    "since @xmath28 is weakly compact , this follows by the standard arguments presented , e.g. , in ( * ? ? ?",
    "* propositions  1.21 , 1.26 ) .",
    "next , we show the absence of a duality gap for upper semicontinuous functions .",
    "this result is already known from ( * ? ? ?",
    "* corollary  1.1 ) which uses a minimax argument and kellerer s duality theorem  @xcite for classical transport",
    ". we shall give a direct and self - contained proof based on proposition  [ pr : closednessirred ] .",
    "[ le : uscduality ] let @xmath421 ; then @xmath422 .    let @xmath423 $ ] be bounded and upper semicontinuous ; then the inequality @xmath424 follows from remark  [ rk : integralofsuperhedge ] .",
    "below , we show the converse inequality .",
    "\\(i ) we first prove the result for a class of continuous reward functions .",
    "this will be a hahn  banach argument , which requires us to introduce a suitable space .",
    "recall that @xmath2 has a finite first moment .",
    "thus , by the de la valle  poussin theorem , there exists an increasing function @xmath425 of superlinear growth such that @xmath426 is @xmath2-integrable . the same applies to @xmath3 , and we set @xmath427 let @xmath428 be the vector space of all continuous functions @xmath429 such that @xmath430 vanishes at infinity ; this includes all continuous functions of linear growth .",
    "we equip @xmath431 with the norm @xmath432 , where @xmath433 is the uniform norm .",
    "let @xmath434 . then , setting @xmath435 and @xmath436 , we have @xmath437 for some constant @xmath438 , showing in particular that @xmath439 is finite .",
    "thus , we may assume that @xmath440 by a translation .",
    "consider the set @xmath441 this is a convex cone in @xmath431 , and proposition  [ pr : closednessirred ] implies that @xmath138 is closed ; here we use that a convergent sequence in @xmath431 is uniformly bounded from below by a function of the form @xmath442 .    assume for contradiction that @xmath443 ; that is , @xmath444 .",
    "then the hahn ",
    "banach theorem and the cone property yield a linear functional @xmath445 such that @xmath446 and @xmath447 .",
    "we will argue below that @xmath448 can be represented by a finite signed measure @xmath129 .",
    "note that @xmath446 and the fact that @xmath138 contains all functions of the form @xmath449 with @xmath450 imply that @xmath451 for all @xmath450 ; i.e. , @xmath2 is the first marginal of  @xmath129 , and similarly @xmath3 is the second marginal .",
    "thus , @xmath452 . moreover , if @xmath453 , then the function @xmath454 is in @xmath431 due to its linear growth , and a scaling argument shows that @xmath455 .",
    "this implies that @xmath129 is a martingale transport ; i.e. , @xmath456 .",
    "but now @xmath457 contradicts @xmath440 , and we have shown that @xmath458 .    it remains to argue that @xmath459 can be represented by finite signed measures .",
    "indeed , @xmath460 is an isomorphism of normed spaces from @xmath431 to the usual space @xmath461 of continuous functions vanishing at infinity with the uniform norm . by riesz representation theorem , any continuous linear functional on @xmath461",
    "can be represented by a signed measure @xmath462 , and hence any @xmath463 can be represented as @xmath464 . using @xmath465 as a radon  nikodym density , @xmath448",
    "is thus represented by the finite signed measure @xmath466 .",
    "\\(ii ) let @xmath17 be bounded and upper semicontinuous , then there exist @xmath467 decreasing to @xmath17 and we have @xmath468 for all @xmath199 by part  ( i ) of this proof .",
    "as @xmath469 by the decreasing continuity of  @xmath470 , cf .",
    "lemma  [ le : siscapacity ] , it remains to show that @xmath471 . since @xmath472",
    ", we have @xmath473 for all @xmath199 . on the other hand , shows that @xmath474 and this completes the proof .    our last preparation for the proof of theorem  [ th : dualityirred ] is to show that @xmath475 is a capacity ; again , this is a consequence of the closedness result in proposition  [ pr : closednessirred ] .",
    "[ le : iiscapacity ] the mapping @xmath476^{{\\mathbb{r}}^2 } \\to [ 0,\\infty]$ ] is a @xmath416-capacity .    as @xmath477 on @xmath416 by lemma  [ le : uscduality ] , lemma  [ le : siscapacity ] already shows that  @xmath475 is sequentially continuous downwards on @xmath416 .",
    "let @xmath478^{{\\mathbb{r}}^2}$ ] be such that @xmath479 increases to @xmath17 ; we need to show that @xmath471 .",
    "it is clear that @xmath475 is monotone ; in particular , @xmath480 , and @xmath471 if @xmath481 .    hence , we only need to show @xmath482 under the condition that @xmath483 .",
    "indeed , by the definition of @xmath484 there exist @xmath321 with @xmath485 proposition  [ pr : closednessirred ] then yields @xmath414 with @xmath486,\\ ] ] showing that @xmath482 as desired",
    ".    we can now deduce the main result of this section .",
    "\\(i ) in view of lemma  [ le : siscapacity ] , choquet s capacitability theorem shows that @xmath487 by lemma  [ le : iiscapacity ] , the same approximation formula holds for @xmath475 , and as @xmath488 on @xmath416 by lemma  [ le : uscduality ] , it follows that @xmath488 on @xmath415 .",
    "\\(ii ) to see that the infimum is attained when it is finite , it suffices to apply proposition  [ pr : closednessirred ] with the constant sequence @xmath489 .",
    "let @xmath29 be probability measures in convex order and let @xmath38 $ ] be a borel function . we continue to denote the primal problem by @xmath490 as in the irreducible case .",
    "some more notation needs to be introduced for the dual problem .",
    "let us first recall from proposition  [ pr : decomp ] the decompositions @xmath491 where @xmath492 is irreducible with domain @xmath493 for @xmath87 and @xmath494 .",
    "moreover , @xmath92 denotes the unique element of @xmath495 .",
    "let @xmath313 be borel .",
    "since @xmath92 is concentrated on the diagonal @xmath496 , we have @xmath497 that is , the function @xmath47 plays no role and @xmath498 enter only through their sum .",
    "in fact , the dual problem associated to @xmath499 is trivially solved , for instance , by setting @xmath500 and @xmath501 .",
    "there is no need to use integrability modulo concave functions , but to simplify the notation below , we set @xmath502 and @xmath503 for @xmath504 .",
    "moreover , @xmath505 is the set of all @xmath48 with @xmath504 and @xmath506 finally , it will be convenient to define @xmath507    we can now introduce the domain for the dual problem on the whole real line .",
    "[ de : globalintegrability ] let @xmath298 be the set of all borel functions @xmath508 such that @xmath509 for all @xmath90 and @xmath510 for @xmath300 , we define @xmath511 and @xmath512 is the set of all borel functions @xmath313 such that @xmath300 and @xmath513 finally , @xmath514.\\ ] ]    we emphasize that the dual domain @xmath512 is now defined in the quasi - sure sense . before making precise",
    "the correspondence with the individual components , let us recall that the intervals @xmath515 may overlap at their endpoints , so we have to avoid counting certain things twice .",
    "indeed , let @xmath516 .",
    "if @xmath515 contains one of its endpoints , it is an atom of  @xmath3 and hence  @xmath517 is finite on  @xmath518 .",
    "translating @xmath517 by an affine function and shifting @xmath519 and @xmath520 accordingly , cf .  , we can thus normalize @xmath521 such that @xmath522 on the strength of our analysis of the @xmath28-polar sets , the dual domain can be decomposed as follows .",
    "[ le : reductiontocomponentsdual ] let @xmath38 $ ] be borel , let @xmath29 and let @xmath523 be as in proposition  [ pr : decomp ] .    1 .",
    "let @xmath516 for @xmath98 , normalized as in  , and let @xmath524 and @xmath525 . if @xmath526 , then @xmath527 satisfies @xmath528 and @xmath529 2 .",
    "conversely , let @xmath528 .",
    "after changing @xmath44 on a @xmath2-nullset and @xmath43 on a @xmath3-nullset , we have @xmath530 for @xmath82 and @xmath531    in essence , this is a direct consequence of proposition  [ pr : decomp ] and theorem  [ th : polardescr ] . for  ( i ) , we note that @xmath532 for all @xmath533 , so that the sum is always well defined .",
    "regarding  ( ii ) , let @xmath121 be the polar set of all @xmath534 such that @xmath535 ; note that @xmath121 is borel because all these functions are borel .",
    "then for each @xmath98 , the set @xmath536 is contained in a union @xmath537 , where @xmath538 is @xmath2-null and @xmath539 is @xmath3-null .",
    "we then set @xmath126 on @xmath540 as well as on the @xmath93-nullset @xmath541 .",
    "proceeding analogously with @xmath43 , we obtain the desired properties .",
    "[ rk : samedualifirred ] ( i ) suppose that @xmath29 is irreducible .",
    "then , lemma  [ le : reductiontocomponentsdual ] implies that the pointwise and the quasi - sure formulation of the dual problem agree : @xmath542 if @xmath543 outside the domain @xmath74 , and otherwise the difference is @xmath544 due to our definitions . without the irreducibility condition ,",
    "the formulations may differ fundamentally ; cf .",
    "example  [ ex : dualitygap ] .",
    "\\(ii ) as a sanity check on our definitions , we note that @xmath304 , \\quad p\\in{\\mathcal{m}}(\\mu,\\nu)\\ ] ] whenever @xmath528 for some @xmath545 , as a consequence of lemma  [ le : reductiontocomponentsdual ] and remark  [ rk : integralofsuperhedge ]",
    ".    we can now state our main duality result .",
    "[ th : dualityglobal ] let @xmath38 $ ] be borel and let @xmath29",
    ". then @xmath546.\\ ] ] if @xmath547 , there exists an optimizer @xmath528 for @xmath548 .",
    "we first show that @xmath549 . to this end",
    ", we may assume that @xmath547 , so that there exists some @xmath528 .",
    "by lemma  [ le : reductiontocomponentsdual ] , this induces @xmath530 , and so the duality result of theorem  [ th : dualityirred ] yields that @xmath550 the claim follows as @xmath528 was arbitrary .",
    "next , we prove that @xmath551 , for which we may assume that @xmath552 .",
    "then @xmath553 for all @xmath90 and by theorem  [ th : dualityirred ] there exist @xmath516 such that @xmath554 with the induced @xmath528 as in lemma  [ le : reductiontocomponentsdual ] , it follows that @xmath555 which shows both the claimed inequality and that @xmath528 is optimal for @xmath548 .",
    "some remarks on the main result are in order .",
    "[ rk : lowerbound ] the lower bound on @xmath17 in theorem  [ th : dualityglobal ] can easily be relaxed .",
    "indeed , let @xmath556 be borel and suppose there exist borel functions @xmath313 such that @xmath35 , @xmath36 and @xmath557 then , we may apply theorem  [ th : dualityglobal ] to @xmath558^{+}\\ ] ] and the conclusion for @xmath17 follows , except that now @xmath559 has values in @xmath560 $ ] .",
    "however , the lower bound can not be eliminated completely ; cf .",
    "example  [ ex : dualitygaplower ]    we recall that in general , the duality theorem can only hold with a relaxed notion of integrability ; cf .  examples  [ ex : nointegrability ] and  [ ex : gapwithintegrability ] .",
    "we have the following sufficient condition for integrability in the classical sense .",
    "[ rk : integraledualsuffgllobal ] suppose that for each @xmath87 , either @xmath561 is supported on a compact subset of @xmath562 or @xmath563 for some constant @xmath564 , where @xmath565 is the barycenter of @xmath561 .",
    "then , @xmath566 and in particular the optimizer in theorem  [ th : dualityglobal ] satisfies @xmath35 and @xmath36 .",
    "indeed , remark  [ rk : finiteintegralsuffcond ] shows that all concave moderators can be chosen as @xmath567 in this situation .",
    "[ rk : dualityglobal ] in the setting of theorem  [ th : dualityglobal ] and the notation of proposition  [ pr : decomp ] and lemma  [ le : reductiontocomponentsdual ] , the following relations hold .    1",
    ".   we have @xmath568 and @xmath569 .",
    "if @xmath89 is optimal for @xmath570 for all @xmath90 , then @xmath51 is optimal for @xmath571 . if @xmath552 , the converse holds as well : if @xmath51 is optimal for @xmath571 , then @xmath89 is optimal for @xmath570 for all @xmath90 .",
    "if @xmath572 is optimal for @xmath573 for all @xmath90 , then @xmath528 is optimal for @xmath548 . if @xmath547 , the converse holds as well .",
    "an important consequence of the duality is the subsequent monotonicity principle describing the support of optimal transports ; its second part can be seen as a substitute for the cyclical monotonicity from classical transport theory . while similar results have been obtained in (",
    "* lemma  1.11 ) and ( * ? ? ?",
    "* theorem  3.6 ) , the present version is stronger in several ways . first , it is stated with a set @xmath40 that is universal ; i.e. , independent of the measure under consideration ; second , we remove growth and integrability conditions on  @xmath17 ; and third , the reward function is measurable rather than continuous .",
    "[ co : monotonicityprinciple ] let @xmath38 $ ] be borel , let @xmath29 be probability measures and suppose that @xmath552 .",
    "there exists a borel set @xmath39 with the following properties .    1 .",
    "a measure @xmath51 is concentrated on @xmath40 if and only if it is optimal for @xmath571 .",
    "2 .   let @xmath574 be probabilities on @xmath1 .",
    "if @xmath575 is concentrated on @xmath40 , then @xmath576 is optimal for @xmath577 .    if @xmath528 is a suitable(ii ) ] version of the optimizer from theorem  [ th : dualityglobal ] , then we can take the following set for @xmath40 , @xmath578    as @xmath579 , theorem  [ th : dualityglobal ] yields a dual optimizer @xmath528 and we can define @xmath40 as above . by remark  [ rk : integralofsuperhedge ] ,",
    "@xmath580 = \\mu(\\varphi)+\\nu(\\psi)\\ ] ] for all @xmath581 , whereas for @xmath51 with @xmath582 , the same holds with equality .",
    "this shows that @xmath583 . for the converse in  ( i ) , we observe that the inequality in   is strict if @xmath584 , and then @xmath585 shows that  @xmath586 can not be a maximizer .    for the proof of",
    "( ii ) , we choose a version of @xmath528 as in lemma  [ le : reductiontocomponentsdual](ii ) ; moreover , we may assume that @xmath587 .",
    "we shall show that @xmath588 ; once this is established , the proof of optimality is the same as above .",
    "\\(a ) on the one hand , we need to show that @xmath589 for this , it suffices to prove that the domains of the irreducible components of @xmath574 are subsets of the ones of @xmath29 ; i.e. , that @xmath202 implies @xmath590 , for any @xmath26 .",
    "indeed , let @xmath202 .",
    "since @xmath576 is concentrated on @xmath591 , we know that @xmath592 @xmath576-a.s .  on the set @xmath593 .",
    "writing @xmath594 $ ] for the expectation under @xmath576 , it follows that @xmath595 = e[(x - x){\\mathbf{1}}_{x\\geq x}]=e[(y - x){\\mathbf{1}}_{x\\geq x}]= e[|y - x|{\\mathbf{1}}_{x\\geq x}],\\ ] ] where we have used that @xmath596=x$ ] @xmath576-a.s .",
    "an analogous identity holds for @xmath597 , and thus @xmath598 = e[|y - x|]=u_{\\bar\\nu}(x)\\ ] ] as desired .",
    "\\(b ) on the other hand , we need to show that @xmath599 . by reducing to the components",
    ", we may assume without loss of generality that  @xmath600 is irreducible with domain @xmath74 .",
    "as @xmath414 and @xmath601 , we have @xmath602 = \\bar p ( f)<\\infty ,    $ ] and now remark  [ rk : reverseintegrability ] implies that @xmath599 as desired .",
    "we note that the dual optimizer @xmath48 need not be unique , and a different choice may lead to a different set @xmath40 . moreover , we observe that an optimal @xmath51 need not exist . however , the following yields a fairly general sufficient criterion in the spirit of @xcite .    [ rk : primalexistence ] let @xmath38 $ ] be borel , let @xmath29 be probability measures and suppose that @xmath552 .",
    "suppose there exist a polish topology @xmath603 on @xmath1 and a function @xmath604 $ ] such that @xmath605 is upper semicontinuous for @xmath606 and @xmath607 @xmath28-q.s .",
    "then , there exists an optimal @xmath51 for @xmath571 .",
    "indeed , the induced weak topology on @xmath28 does not depend on the choice of @xmath603 ; cf .",
    "* lemma  2.3 ) .",
    "thus , under the stated conditions , the mapping @xmath608 is upper semicontinuous on the compact set @xmath28 , and the result follows .",
    "we remark that compactness need not hold if non - product topologies are considered on @xmath5 , hence the use of @xmath606 .",
    "the flexibility of choosing @xmath603 allows us to include a broad class of functions .",
    "consider for instance @xmath17 of the product form @xmath609 , where @xmath610 and @xmath611 are borel measurable , or more generally any continuous function of @xmath612 and @xmath613 .",
    "then , we can choose @xmath603 such as to make @xmath17 continuous ( cf .  the proof of ( * ? ? ? * theorem  1 ) ) and the above applies .",
    "[ rk : kantorovichpotential ] corollary  [ co : monotonicityprinciple ] is a version of the classical `` fundamental theorem of optimal transport , '' see e.g.  ( * ? ? ?",
    "* theorem 2.13 ) , where @xmath40 is the graph of the @xmath438-superdifferential of a @xmath438-concave function , the so - called kantorovich potential ( here @xmath614 is the cost function ) . in our context , the roles of @xmath44 and @xmath43 are not symmetric , and it is @xmath43 that constitutes the analogue of the kantorovich potential .",
    "indeed , @xmath44 and @xmath47 can easily be obtained from @xmath43 by taking a concave envelope and its derivative , respectively ; see the end of the proof of proposition  [ pr : closednessirred ] .",
    "in this section , we present five counterexamples .",
    "examples  [ ex : dualitygap ] and  [ ex : noattainment ] show that the duality theory fails in the pointwise formulation ; i.e. , @xmath615 and thus justify our quasi - sure approach .",
    "the subsequent two examples demonstrate that a relaxed notion of integrability is necessary for the dual elements , and the final example shows that duality fails if @xmath17 does not have any lower bound .",
    "indeed , let @xmath2 be the restriction of the lebesgue measure @xmath616 to @xmath617 $ ] .",
    "setting @xmath618 , the set @xmath28 has a unique element , the law @xmath92 of @xmath94 under @xmath2 , which is nothing but the uniform distribution on the diagonal of the unit square @xmath617^{2}$ ] .",
    "consider the bounded reward function @xmath619 which is lower ( but not upper ) semicontinuous .",
    "since @xmath92 is concentrated on the diagonal , the primal value of the problem is @xmath620=e^{p_{0}}[f]=0.\\ ] ] now let @xmath621 be borel functions such that @xmath622;\\ ] ] then in particular @xmath623;\\ ] ] let @xmath187 . by lusin",
    "s theorem , there exists a borel set @xmath624 $ ] with @xmath625 such that the restriction @xmath626 is continuous .",
    "using another fact from measure theory ( * ? ? ?",
    "* exercise 1.12.63 , p.85 ) , the set @xmath627 can be chosen to be perfect ; i.e. , every point in @xmath627 is a limit point of @xmath627 .",
    "now let @xmath628 and let @xmath629 be a sequence of distinct points such that @xmath630 . then passing to the limit in @xmath631 yields that @xmath632 as @xmath187 was arbitrary",
    ", it follows that @xmath633:\\ , \\varphi(x ) + \\psi(x ) \\geq 1\\}=1 $ ] .",
    "in particular , @xmath634 .",
    "this bound is attained , for instance , by the triplet @xmath635 , @xmath501 , @xmath636 , so that the dual problem in the pointwise formulation admits an optimizer and has value @xmath637 ; in particular , there is a duality gap in the pointwise formulation .",
    "the next example shows that in general , the pointwise formulation fails to admit a dual optimizer .",
    "such an example was already presented in  @xcite , using marginals with infinitely many irreducible components .",
    "the subsequence example shows that existence may fail even with finitely many ( two ) components and in a reasonably generic setting .      1 .",
    "the reward function is continuous and the marginals are compactly supported ( but not irreducible ) ; 2 .",
    "there is no duality gap for either formulation of the dual problem ; 3 .",
    "there is no optimizer for the pointwise formulation of the dual problem .",
    "we fix two measures @xmath29 supported on @xmath638 such that there are two irreducible components with domains @xmath639 and @xmath640 .",
    "moreover , we assume that the origin is in the ( topological ) supports of @xmath2 and @xmath3 ; for instance , @xmath2 and @xmath3 could both be equivalent to the lebesgue measure on  @xmath638 , or they could be discrete with atoms accumulating at the origin .",
    "the reward function @xmath17 is any continuous function of linear growth such that @xmath641        suppose for contradiction that @xmath48 is a dual minimizer for the pointwise formulation ; then @xmath645 we have @xmath646 and as @xmath17 is continuous with linear growth , there is no duality gap ( even for the pointwise formulation ) ; cf .",
    "* corollary  1.1 ) .",
    "it follows that @xmath647=0 $ ] for all @xmath51 and thus @xmath648 let @xmath122 and @xmath123 be the corresponding nullsets as in theorem  [ th : polardescr ] and write @xmath649 for @xmath650 whenever @xmath73 is an interval .",
    "then @xmath651\\ , \\cup\\ , [ ( 0,1)_{\\mu}\\times ( 0,1)_{\\nu}]\\ ] ] and in particular , fixing an arbitrary @xmath652 yields @xmath653 so that @xmath43 must be an affine function @xmath654 on @xmath655 .",
    "it then follows that @xmath656 on @xmath657 and @xmath658 on @xmath657 , and a similar argument gives rise to constants @xmath659 for @xmath660 .",
    "now , spelling out the condition @xmath661 yields @xmath662 @xmath663 since @xmath664 and @xmath91 is an accumulation point of the intervals appearing on the right - hand side , it follows that @xmath665 , but then it follows that @xmath17 is @xmath642-a.s",
    ".  bounded from above by a linear function on @xmath666 , and all the same for @xmath667 .",
    "this is the desired contradiction .",
    "[ rk : nonexistencegeneric ] nothing essential changes in example  [ ex : noattainment ] if @xmath3 has one or more atoms at the boundary of the intervals @xmath562 . as a matter of fact",
    ", the example suggests that one can expect non - existence for the pointwise formulation as soon as there are at least two adjacent irreducible components , the reward function is not lipschitz where they touch , and the marginals exhibit some richness ( in particular , have infinite support ) .",
    "the next two examples concern the quasi - sure version of the dual problem ; i.e. , the setting of the main part of the present paper , and in particular the notion of integral introduced in section  [ se : generalizedintegral ] .",
    "the first one shows that it is necessary to relax the notion of integrability in order to have existence for the dual problem @xmath668 .",
    "the reward function @xmath17 is bounded ; 2 .",
    "primal and dual optimizers exist and there is no duality gap ; 3 .   whenever @xmath669 is a dual optimizer , @xmath44 is not @xmath2-integrable and @xmath43 is not @xmath3-integrable",
    ".    indeed , let @xmath670 be a sequence of strictly positive numbers satisfying @xmath671 such that the probability measure @xmath672 has finite first moment but infinite second moment",
    ". moreover , set @xmath673 and note that the moments of @xmath3 then have the same property .",
    "finally , our reward function is given by @xmath674    we observe that @xmath675 in particular , @xmath29 .",
    "moreover , let @xmath676 , @xmath677 and @xmath678 ; then we have @xmath679 for all @xmath680 , with equality holding on the set @xmath681 since @xmath4 is concentrated on @xmath40 , it follows as in corollary  [ co : monotonicityprinciple ] that @xmath51 is a primal optimizer and @xmath528 is a dual optimizer .",
    "one can observe that a concave moderator is given by @xmath682 .",
    "now let @xmath528 be an arbitrary optimizer ; then we must have @xmath683 and hence , by the definition of @xmath4 , this equality holds for all @xmath684 .",
    "it follows that @xmath685 in particular , @xmath686 on @xmath687 and @xmath688 all solutions of this difference equation satisfy @xmath689 for some constants @xmath690 .",
    "in particular , @xmath691 is not @xmath2-integrable and @xmath692 is not @xmath3-integrable , and as a result , there exists no optimizer for @xmath548 in the class @xmath693 .        1 .",
    "the reward function @xmath17 is continuous ; 2 .",
    "primal and dual problem are finite ; 3 .",
    "the set @xmath695 is empty ; in particular , there is a duality gap if @xmath512 is replaced by @xmath695 in the definition of the dual problem @xmath668 .",
    "let @xmath29 be as in example  [ ex : nointegrability ] ; we now make the specific choice @xmath696 where @xmath285 is the normalizing constant .",
    "this ensures that @xmath2 and @xmath3 have a first but no second moment .",
    "moreover , the strict concavity of @xmath697 implies that @xmath698 the associated potential functions satisfy @xmath699 on @xmath700 $ ] . if there were @xmath701 with @xmath202 , then as @xmath2 is the second ( distributional ) derivative of @xmath702 , we would have @xmath703 , a contradiction . as a result ,      for the reward function , we now consider @xmath706 as seen in in example  [ ex : nointegrability ] , setting @xmath676 , @xmath677 and @xmath678 yields @xmath528 with concave moderator @xmath682 ; in fact , @xmath707 in the notation of example  [ ex : nointegrability ] , and thus @xmath708 .",
    "suppose that there exists some @xmath709 .",
    "since @xmath29 is irreducible , corollary  [ co : polarsetsirred ] shows that every point in @xmath710 is charged by some element of @xmath28 and hence @xmath711 we see that @xmath43 must have at least quadratic growth in @xmath217 , and thus @xmath712 and @xmath713 . as a result , @xmath714 and",
    "the corresponding dual problem has infinite value , whereas the primal one satisfies @xmath715 .",
    "our last example shows that a duality gap may occur ( even in the quasi - sure formulation ) if @xmath17 does not have any lower bound .",
    "this should be compared with ( * ? ? ?",
    "* theorem  1 ) which shows that there is no duality gap if @xmath17 is upper semicontinuous with values in @xmath215 .",
    "indeed , let @xmath717}$ ] be the restriction of the lebesgue measure to @xmath617 $ ] , fix a constant @xmath718 and @xmath719}+ \\lambda|_{[\\delta,1+\\delta]}\\big).\\ ] ] then @xmath29 is irreducible with domain given by @xmath720 .",
    "indeed , a particular element of @xmath28 is given by @xmath721 , where @xmath722 for the reward function , we choose @xmath723    we first analyze the primal problem .",
    "let @xmath581 and let @xmath724 be a disintegration .",
    "we observe that @xmath725 if @xmath726 , then @xmath727 for @xmath2-a.e .",
    "@xmath24 and the above implies that @xmath728 for @xmath2-a.e .",
    "@xmath24 and therefore @xmath729 . as a result ,",
    "@xmath730 for all @xmath731 and @xmath732=e^{p}[f]=-1.\\ ] ]    we now turn to the dual problem ; since @xmath29 is irreducible , the quasi - sure formulation is equivalent to the pointwise one .",
    "let @xmath621 be borel functions such that @xmath733 then in particular @xmath734 adding these two inequalities yields @xmath735 let @xmath187 .",
    "as in example  [ ex : dualitygap ] , lusin s theorem can be used to find a set @xmath736 with @xmath737 such that for all @xmath628 there exists a sequence @xmath738 with @xmath739 .",
    "thus , passing to the limit in the above inequality shows that @xmath740 and as @xmath187 was arbitrary , the inequality holds @xmath2-a.e . but",
    "then @xmath741 = \\int \\varphi(x ) + \\frac{\\psi(x-\\delta)+\\psi(x+\\delta)}{2}\\,\\mu(dx)\\geq0.\\ ] ] as a result , the dual value is zero and a dual optimizer is given for instance by @xmath742 .",
    "d.  hobson . the skorokhod embedding problem and model - independent bounds for option prices . in _",
    "paris - princeton lectures on mathematical finance 2010 _ , volume 2003 of _ lecture notes in math .",
    "_ , pages 267318 .",
    "springer , berlin , 2011 ."
  ],
  "abstract_text": [
    "<S> we study the optimal transport between two probability measures on the real line , where the transport plans are laws of one - step martingales . </S>",
    "<S> a quasi - sure formulation of the dual problem is introduced and shown to yield a complete duality theory for general marginals and measurable reward ( cost ) functions : absence of a duality gap and existence of dual optimizers . </S>",
    "<S> both properties are shown to fail in the classical formulation . as a consequence of the duality result </S>",
    "<S> , we obtain a general principle of cyclical monotonicity describing the geometry of optimal transports .    </S>",
    "<S> _ keywords _ martingale optimal transport ; kantorovich duality    _ ams 2010 subject classification _ 60g42 ; 49n05 </S>"
  ]
}