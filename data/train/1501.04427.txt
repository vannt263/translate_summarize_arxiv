{
  "article_text": [
    "systems in which individual photons can interact strongly with each other constitute an exciting frontier for the fields of quantum and nonlinear optics @xcite . such systems",
    "enable the generation and manipulation of non - classical light , which are crucial ingredients for quantum information processing and quantum networks @xcite .",
    "at the many - body level , it has been predicted that these systems can produce phenomena such as quantum phase transitions of light @xcite or photon crystallization @xcite .",
    "early examples of such systems where strong interactions between photons could be observed consisted of individual atoms coupled to single modes of high - finesse optical cavities , within the context of cavity quantum electrodynamics  ( qed ) @xcite .",
    "more recently , a number of systems have emerged that produce strong optical nonlinearities between freely propagating photons , including cold atomic gases coupled to guided modes of tapered fibers @xcite , photonic crystal fibers @xcite or waveguides @xcite , cold rydberg gases in free space @xcite , and superconducting qubits coupled to microwave waveguides @xcite .",
    "the paradigm of cavity qed admits exact analytical or numerical solutions at the few - photon  ( and/or few - atom ) level through the elegant `` input - output '' formalism @xcite , as illustrated conceptually in fig .",
    "[ fig_1](a ) . in this formalism ,",
    "all of the properties of the field exiting the system ( the output ) can be determined based upon knowledge of the input field and the dynamics of the atom - cavity system alone .",
    "for a few excitations , the latter can be solved due to the small hilbert space associated with a small number of excitations of a discrete cavity mode .",
    "in contrast , despite rapid development on the experimental front , theoretical techniques to treat the dynamics of freely propagating photons interacting with spatially distributed emitters are generally lacking . at first glance , the challenge compared to the cavity case arises from the fact that a two - level system is a nonlinear frequency mixer , which is capable of generating a continuum of new frequencies from an initial pulse , as schematically depicted in fig .  [ fig_1](b ) . a priori , keeping track of this continuum as it propagates and re - scatters from other emitters appears to be a difficult task .",
    "an exception is the weak excitation limit , in which atoms can be treated as linear scatterers and the powerful transfer matrix method of linear optics can be employed  @xcite .",
    "the full quantum case has been solved exactly in a limited number of situations in which nonlinear systems are coupled to 1d waveguides , such as up to three photons scattering on a single atom  @xcite , one and two photons scattering on a cavity qed system @xcite , and many photons scattering on many atoms coupled to a chiral ( monodirectional ) waveguide @xcite . the formalism employed in ref .",
    "@xcite is particularly elegant , because it establishes an input - output relation to determine the nonlinear scattering from a two - level atom . here",
    ", we show that this technique can be efficiently generalized to many atoms , chiral or bi - directional waveguides , and arbitrary atomic configurations , providing a powerful tool to investigate nonlinear optical dynamics in all systems of interest .",
    "this paper is organized in the following way : first , we present a generalized input - output formalism to treat few - photon propagation in waveguides coupled to many atoms .",
    "we show that the infinite degrees of freedom associated with the photonic modes can be effectively integrated out , yielding an open , interacting `` spin '' model that involves only the internal degrees of freedom of the atoms .",
    "this open system can be solved using a number of conventional , quantum optical techniques .",
    "then , we show that the solution of the spin problem can be used to re - construct the optical fields . in particular",
    ", we provide a prescription to map spin correlations to s - matrix elements , which contain full information about the photon dynamics , and give explicit closed - form expressions for the one- and two - photon cases .",
    "importantly , in analogy with the cavity qed case , our technique enables analytical solutions under some scenarios , but in general allows for simple numerical implementation under a wide variety of circumstances of interest , such as different level structures , external driving , atomic positions , atomic motion , etc .",
    "finally , to illustrate the ease of usage , we apply our technique to the study of nonlinear field propagation through an optically dense ensemble of atoms with rydberg - like interactions .",
    "in this section we consider a generic system composed of many atoms located at positions @xmath0 along a bidirectional waveguide .",
    "we assume that there is an optical transition between ground and excited - state levels @xmath1 and @xmath2 to which the waveguide couples , but otherwise we leave unspecified the atomic internal structure and the possible interactions between them ( _ e.g. _ , rydberg interactions ) , as such terms do not affect the derivation presented here .",
    "the bare hamiltonian of the system is composed of a term describing the energy levels of the atoms @xmath3 , and a waveguide part @xmath4 , where @xmath5 is the wavevector and @xmath6 is an index for the direction of propagation , with the plus ( minus ) denoting propagation towards the right ( left ) direction .",
    "we assume that within the bandwidth of modes to which the atoms significantly couple , the dispersion relation for the guided modes can be linearized as @xmath7 .",
    "the interaction between atoms and photons is given by @xmath8 which describes the process where excited atoms can emit photons into the waveguide , or ground - state atoms can become excited by absorbing a photon . the coupling amplitude @xmath9 is assumed to be identical for all atoms , while the coupling phase depends on the atomic position ( @xmath10 ) . here",
    ", we will explicitly treat the more complicated bidirectional case , although all of the results readily generalize to the case of a single direction of propagation .",
    "our immediate goal is to generalize the well - known input - output formalism of cavity qed  @xcite and the more recent formalism for a single atom coupled to a waveguide @xcite , to the present situation of many spatially distributed atoms coupled to a common waveguide . in short",
    ", we will eliminate the photonic degrees of freedom by formal integration , which reveals that the output field exiting the collection of atoms is completely describable in terms of the input field and atomic properties alone .",
    "this formal integration also provides a set of generalized heisenberg - langevin equations that governs the atomic evolution .",
    "the heisenberg equations of motion for @xmath11 and @xmath12 can be readily obtained by calculating the commutators with @xmath13 . to simplify the presentation of the resulting equations , we replace the spin operators @xmath11 with the bosonic annihilation operator @xmath14 .",
    "the two - level nature of the atomic transition can be retained by introducing an interaction energy @xmath15 for multiple excitations , through the term @xmath16 in @xmath3 , and by taking the limit @xmath17 at the end of calculations for observable quantities .        the heisenberg equations for @xmath12 can be formally integrated and fourier transformed , to obtain the real - space wave equation @xmath18 here",
    "@xmath19 is the homogeneous solution , physically corresponding to the freely propagating field in the waveguide , while the second term on the right consists of the part of the field emitted by the atoms . inserting eq .   into the equation for @xmath14",
    ", we obtain @xmath20 - \\ii\\sqrt{2\\pi}g\\sum_{v = \\pm}\\,b_{v,\\text{in}}(t - vz_i / c)\\nonumber\\\\ & -&\\frac{2\\pi g^2}{c}\\sum_{j=1}^n\\,a_j(t-|z_i - z_j|/c)).\\end{aligned}\\ ] ]    in realistic systems , time retardation can be neglected , resulting in the markov approximation @xmath21 . here",
    ", @xmath22 is a central frequency around which the atomic dynamics is centered ( typically the atomic resonance frequency ) .",
    "this approximation is valid when the difference in free - space propagation phases @xmath23 is small across the characteristic system size @xmath24 and over the bandwidth of photons @xmath25 involved in the dynamics . as a simple example",
    ", the characteristic bandwidth of an atomic system is given by its spontaneous emission rate , corresponding to a few mhz , which results in a significant free - space phase difference only over lengths @xmath26 m much longer than realistic atomic ensembles .    we have thus obtained the generalized heisenberg - langevin equation @xmath27   - \\ii\\sqrt{c\\,\\gamma_{1d}/2}\\sum_{v = \\pm}\\,b_{v,\\text{in}}(t - vz_i / c)\\nonumber\\\\ & -&\\frac{\\gamma_{1d}}{2}\\sum_{j=1}^n\\,a_j\\,e^{\\ii \\omega_\\text{in}|z_i - z_j|/c},\\end{aligned}\\ ] ] where we have identified @xmath28 as the single - atom spontaneous emission rate into the waveguide modes .",
    "if we keep separated the terms proportional to @xmath29 coming from the right and left - going photonic fields , we can find easily that the lindblad jump operators corresponding to the decay of the atoms into the waveguide are @xmath30 , in terms of which we can write the master equation for the atomic density matrix @xmath31 \\equiv -\\ii[h_\\text{at } , \\rho ] + \\sum_{v=\\pm}\\,2o_v\\rho o^\\dagger_v - o^\\dagger_vo_v\\rho - \\rho o^\\dagger_v o_v$ ] .",
    "we also see that we can derive eq .   from a non - hermitian",
    "effective hamiltonian @xmath32 which can be used for a quantum jump description of the atomic dynamics .",
    "the resulting infinite - range interaction between a pair of atoms @xmath33,@xmath34 intuitively results from the propagation of a mediating photon between that pair , with a phase factor proportional to the separation distance .",
    "within the same approximations employed above to derive the heisenberg - langevin equations we can obtain a generalized input - output relation of the form @xmath35 , where the output field is defined for @xmath36 $ ] ( @xmath37 $ ] ) for right(left)-going fields .",
    "however , since the right - going output field propagates freely after @xmath38 , it is convenient to simply define @xmath39 as the field immediately past the right - most atom ( where @xmath40 is an infinitesimal positive number ) , and similarly for the left - going output .",
    "the derived relation shows that the out - going field properties are obtainable from those of the atoms alone .",
    "the emergence of infinite - range interactions between emitters mediated by guided photons , and input - output relationships between these emitters and the outgoing field , have been discussed before in a number of contexts @xcite , but the idea that such concepts could be used to study quantum interactions of photons in extended systems has not been fully appreciated . in the remaining sections , we will demonstrate the effectiveness of this approach to quantum nonlinear optics .",
    "in particular , the infinite - dimensional continuum of the photons is effectively reduced to a hilbert space of dimension @xmath41 = \\sum^n_{i=0}\\binom { n } { i}$ ] where @xmath42 is the maximum number of atomic excitations ( for @xmath43 we have @xmath41 = 2^n$ ] ) .",
    "the atomic dynamics , on the other hand , having been reduced to standard heisenberg - langevin equations , quantum jump , or master equations , are solvable by conventional prescriptions  @xcite .",
    "it is also possible to derive generalized master equations describing the atomic dynamics in response to arbitrary ( _ e.g. _ , non - classical ) incident states of light , as detailed in appendix c.",
    "the s - matrix characterizes how an incoming state of monochromatic photons evolves via interaction with atoms into a superposition of outgoing monochromatic photons .",
    "because monochromatic photons form a complete basis , the s - matrix thus contains all information about photon dynamics . here , we will show that s - matrix elements can be calculated from the dynamics of the atoms evolving under the effective spin model .",
    "formally , the s - matrix for the interaction of an @xmath42-photon state with an arbitrary system is defined as @xmath44 where the input and output creation operators respectively create freely propagating incoming and outgoing photonic states .",
    "the vectors @xmath45 and @xmath46 denote the outgoing and incoming frequencies of the @xmath42 photons .",
    "the input and output operators can be any combination of + and - propagation directions ( we have omitted this index here for simplicity ) . in the last line we have used a global fourier transformation @xmath47 , to express the s - matrix in time .",
    "the s - matrix has been calculated exactly before in a limited number of situations @xcite . here",
    ", we provide a general prescription to numerically obtain the s - matrix starting from the input - output formalism .",
    "first , it should be noted that the operators @xmath48 , @xmath49 correspond to the input and output operators defined in the previous section @xcite . on the other hand ,",
    "the input - output relation enables the correlator of eq . to be written purely in terms of atomic operators .",
    "for notational simplicity , we give a derivation for a single spin and a monodirectional waveguide , but its generalization to the bidirectional waveguide and many atoms is straightforward . for our purpose",
    "it is enough to have an input - output relation of the form @xmath50 where @xmath51 is in our case the spin operator @xmath52 .",
    "we summarize the main idea of the derivation here , while the details can be found in appendix a.1 .",
    "we begin by noting that eq .",
    "( [ eq : bound_1 ] ) enables one to replace output operators by a combination of system and input operators , or input operators by system and output operators . selectively using these substitutions",
    ", one can exploit favorable properties of either the input or output field , in order to gradually time order all of the system operators  ( where operators at later times appear to the left of those at earlier times ) , while removing input and output operators from the correlation .",
    "the favorable properties that can be used are that 1 ) system and input operators commute , @xmath53 = 0 $ ] , when @xmath54 , and likewise @xmath55 = 0 $ ] for @xmath56 , 2 ) input annihilation operators at different times commute amongst themselves , as do output annihilation operators , and 3 ) the correlator can be reduced in size using @xmath57=\\delta(t - t')$ ] , or made to vanish using @xmath58 or @xmath59 . through this procedure , the s - matrix can be expressed as a fourier transform of a sum of terms involving only time - ordered atomic operators  ( indicated by the operator @xmath60 ) .",
    "these functions generally have the form @xmath61\\ket{0},\\ ] ] with @xmath62 , multiplied by @xmath63 delta functions in time .    moreover , using the general expression for the heisenberg - langevin equation and the quantum regression theorem , it can be proven that when external fields driving the system do not generate waveguide photons , the correlation function of eq . can be evaluated by evolving @xmath64 as @xmath65 ( see appendix a.2 for a formal derivation ) . here , @xmath66 is the effective hamiltonian from eq . that contains only the spin operators .",
    "although such a form for @xmath64 is not true in general due to quantum noise , these noise terms have no influence on the correlation .",
    "a similar procedure as above enables one to express other important observables of the field , such as the second - order correlation function @xmath67 , in terms of correlation functions involving atoms alone .",
    "while the discussion has thus far been completely general , the case of s - matrix elements involving only one or two photons can be formally reduced to particularly simple expressions .",
    "for example , in appendix b , we show that the transmission coefficient @xmath68 for the many - atom , bi - directional waveguide case is related to the s - matrix by @xmath69 .",
    "furthermore , it can be expressed in terms of a known @xmath70 matrix corresponding to the single - excitation green s function @xmath71  ( whose form varies depending on the system details ) , @xmath72_{ij}e^{-\\ii k_\\text{in}(z_i - z_j)}.\\ ] ] similarly , the two - photon s - matrix in transmission is generally given by @xmath73 where the first and second terms on the right describe the linear and nonlinear contributions , respectively .",
    "the latter term can be expressed in terms of matrices @xmath74 related to the single - excitation green s function , and a known @xmath75 matrix @xmath60 characterizing atomic nonlinearities and interactions .",
    "( 8,4.5 ) ( -0.3,0 ) ( 0,4)(a ) ( 3,0 ) ) and excited states  ( @xmath2 ) interact with the quantum propagating field  @xmath76 of the waveguide .",
    "an additional classical field with rabi frequency @xmath77 couples state @xmath2 to a metastable state @xmath78 .",
    "the total single - atom linewidth of the excited state is given by @xmath79 .",
    "( b ) the real ( @xmath80 ) and imaginary ( @xmath81 ) parts of the linear susceptibility for a two - level atom ( upper panel ) and three - level atom ( lower panel ) , as a function of the dimensionless detuning @xmath82 of the field @xmath76 from the resonance frequency of the @xmath1-@xmath2 transition .",
    "for the three - level atom , the parameters used are @xmath83 and @xmath84.,title=\"fig:\",width=200 ] ( 2.6,4)(b )    ( 8,4.5 ) ( 0.4,0 ) ( a ) and @xmath85 ( b ) .",
    "plotted is the population @xmath86 of atom @xmath34 in the state @xmath87 .",
    "the blue line corresponds to the initial state , the green line to the state evolved over a time @xmath88 , and the red dots to the theoretically predicted evolution .",
    "other parameters : @xmath89 , @xmath90 , @xmath91 , @xmath92 , @xmath93 and @xmath94 , where @xmath95 is the lattice constant.,title=\"fig:\",width=245 ] ( 1.5,4)(a ) ( 1.5,2)(b )    in this section , we apply our formalism to a specific example involving three - level atoms under conditions of electromagnetically induced transparency ( eit ) and with rydberg - like interactions between atoms  @xcite . the linear susceptibility for a two - level atom with states @xmath96 and @xmath97 , in response to a weak probe field with detuning @xmath98 from the atomic resonance ,",
    "is shown in fig .",
    "[ eit_level : fig]b .",
    "it can be seen that the response on resonance is primarily absorptive , as characterized by the imaginary part of the susceptibility ( @xmath99 , red curve ) .",
    "in contrast , the response can become primarily dispersive near resonance if a third level @xmath87 is added , and if the transition @xmath100 is driven by a control field  ( characterized by rabi frequency @xmath77 and single photon detuning @xmath101 ) . specifically , via interference between the probe and control fields , the medium can become transparent to the probe field ( @xmath102 ) when two - photon resonance is achieved , @xmath103 , realizing eit  @xcite . in this process , the incoming probe field strongly mixes with spin wave excitations @xmath104 to create  dark - state polaritons . \"",
    "the medium remains highly transparent within a characteristic bandwidth @xmath105 around the two - photon resonance , which reduces to @xmath106 , when @xmath83 .",
    "here we have introduced the total single - atom linewidth @xmath79 ( see below ) and the optical depth @xmath107 , corresponding to the opacity of the medium in absence of eit and defined in terms of input and output intensity as @xmath108 .",
    "these polaritons propagate at a strongly reduced group velocity @xmath109 , as indicated by the steep slope of the real part of the susceptibility @xmath110 in fig .",
    "[ eit_level : fig]b , which is proportional to the control field intensity  @xcite .",
    "taking @xmath111 to be the annihilation operator for the state @xmath112 , eit is described within our spin model by the effective spin hamiltonian @xmath113 where the first line represents the explicit form of @xmath114 in eq .",
    "( [ eff_h : eq ] ) for the eit three - level atomic structure .",
    "in addition to waveguide coupling , here we have added an independent atomic decay rate @xmath115 into other channels ( _ e.g. _ , unguided modes ) , yielding a total single - atom linewidth of @xmath116 .",
    "our theoretical model nearly ideally describes experiments in which atoms are coupled to one - dimensional waveguides such as nanofibers  @xcite or photonic crystals  @xcite , in which the interaction probability of a single photon and atom is @xmath117 is significant and up to @xmath118 atoms are trapped .",
    "one consequence of the large interaction probability is that even a single atom can yield a significant reflectance for single photons  @xcite . in free - space experiments ,",
    "the atom - photon interaction probability is much smaller , while a much larger number of atoms is used to induce a significant optical response . while this large number can not be implemented numerically with our model , our system",
    "can nonetheless be used to reproduce macroscopic observables , thus making our approach an excellent description for atom - light interfaces in general .    intuitively ( and as can be rigorously shown , see below ) , provided that free - space experiments only involve a single transverse mode of light , one expects that the system response to light only depends on the interaction probability and number of atoms via their product .",
    "this product in fact defines the optical depth @xmath119  @xcite . as @xmath120 in free - space experiments",
    ", such systems can be evaluated using our spin model with several hundred atoms and suitably large @xmath121 .",
    "the only remaining issue is the potentially large reflection generated by atoms in the mathematical model , compared to free - space ensembles where reflection is negligible .",
    "reflection can be suppressed in the model by giving the atoms a lattice constant @xmath95 where @xmath122 , where @xmath123 is a non - negative integer , such that the reflection from atoms destructively interferes  @xcite .",
    "all subsequent numerical calculations are performed under this condition .    the spin model on a lattice describing eit , eq .",
    "( [ eit_ham : eq ] ) , can be exactly solved in the linear regime using the transfer matrix formalism  @xcite , which correctly reproduces the free - space result and dependence on optical depth for group velocity @xmath124 and transparency window @xmath105 , where @xmath42 is the ( linear ) atomic density .",
    "the corresponding minimum spatial extent of a pulse that can propagate inside the medium with high transparency is given by @xmath125 .",
    "a single photon propagating inside an ensemble of atoms under eit conditions is coherently mapped onto a single dark polariton , corresponding to a delocalized spin wave populating the single excitation subspace of the atomic ensemble .",
    "the polariton dynamics can be therefore visualized directly by monitoring the excitation probability @xmath126 of the atoms in the ensemble . in fig .",
    "[ eitsinglepolariton : fig ] , we initialize a single polariton inside the medium with an atomic wave function of the form @xmath127 , and we determine numerically the time evolution under @xmath13 in eq .",
    "( [ eit_ham : eq ] ) up to a final time @xmath88 .",
    "choosing an initially gaussian spin wave , @xmath128 , with spatial extent @xmath129 ( blue line ) , one sees that the wavepacket propagates a distance @xmath130 , and with little loss provided that @xmath131 .",
    "numerics ( green line ) show perfect agreement with theoretical predictions ( red lines ) obtained via the transfer matrix formalism  @xcite .",
    "( 8,15 ) ( 0.5,10 )   and @xmath132 of the infinite - range interaction strength .",
    "the linear transmission is independent of @xmath133 , while the two - photon spectrum exhibits a shift in the maximum transmission by an amount @xmath134 .",
    "other parameters : @xmath135 , @xmath136 , @xmath137 , @xmath138 , @xmath139 .",
    "( b ) contour plot of the two - photon transmission spectrum @xmath140 , as functions of interaction strength @xmath134 and two photon detuning @xmath141 ( @xmath142 ) .",
    "cuts of the contour plot ( illustrated by the dashed lines ) are plotted in a ) .",
    "( c ) comparison of @xmath143 evaluated by numerical simulations ( red dashed line ) and s - matrix theory ( black line ) . for constant infinite range interactions @xmath144 and @xmath145 , the interactions induce photon antibunching .",
    "other parameters : @xmath146 , @xmath147 , @xmath148 , @xmath138 , @xmath139.,title=\"fig:\",width=226 ] ( 0,4.6 )   and @xmath132 of the infinite - range interaction strength .",
    "the linear transmission is independent of @xmath133 , while the two - photon spectrum exhibits a shift in the maximum transmission by an amount @xmath134 .",
    "other parameters : @xmath135 , @xmath136 , @xmath137 , @xmath138 , @xmath139 .",
    "( b ) contour plot of the two - photon transmission spectrum @xmath140 , as functions of interaction strength @xmath134 and two photon detuning @xmath141 ( @xmath142 ) .",
    "cuts of the contour plot ( illustrated by the dashed lines ) are plotted in a ) .",
    "( c ) comparison of @xmath143 evaluated by numerical simulations ( red dashed line ) and s - matrix theory ( black line ) . for constant infinite range interactions @xmath144 and @xmath145 , the interactions induce photon antibunching .",
    "other parameters : @xmath146 , @xmath147 , @xmath148 , @xmath138 , @xmath139.,title=\"fig:\",width=283 ] ( 0.3,0 )   and @xmath132 of the infinite - range interaction strength .",
    "the linear transmission is independent of @xmath133 , while the two - photon spectrum exhibits a shift in the maximum transmission by an amount @xmath134 .",
    "other parameters : @xmath135 , @xmath136 , @xmath137 , @xmath138 , @xmath139 .",
    "( b ) contour plot of the two - photon transmission spectrum @xmath140 , as functions of interaction strength @xmath134 and two photon detuning @xmath141 ( @xmath142 ) .",
    "cuts of the contour plot ( illustrated by the dashed lines ) are plotted in a ) .",
    "( c ) comparison of @xmath143 evaluated by numerical simulations ( red dashed line ) and s - matrix theory ( black line ) . for constant infinite range interactions @xmath144 and @xmath145 , the interactions induce photon antibunching .",
    "other parameters : @xmath146 , @xmath147 , @xmath148 , @xmath138 , @xmath139.,title=\"fig:\",width=234 ] ( -0.4,14)(a ) ( -0.4,9)(b ) ( -0.4,4)(c )    the spin model formalism can be easily extended to include arbitrary atomic interactions , providing a powerful tool to study quantum nonlinear optical effects . as a concrete example",
    ", we consider a system in which atoms can interact directly over a long range , such as via rydberg states @xcite or photonic crystal bandgaps  @xcite .",
    "the total hamiltonian is given by @xmath149 in which @xmath150 represents a dispersive interaction between atoms @xmath33 and @xmath34 when they are simultaneously in state @xmath151 .",
    "as we are primarily interested in demonstrating the use of our technique , we take here a `` toy model '' where atoms experience a constant infinite - range interaction , @xmath152 .",
    "such a case enables the numerical results to be intuitively understood , although we note that other choices of @xmath150 do not increase the numerical complexity .",
    "in particular we are interested in studying the propagation of a constant weak coherent input field through the atomic ensemble .",
    "the corresponding driving then is given by @xmath153 , where @xmath154 is the amplitude of the constant driving field , @xmath155 the detuning from two photon resonance condition , and the initial state is given by the global atomic ground state @xmath156  @xcite . with infinite - range interaction , one spin flip to state",
    "@xmath157 shifts the energies of all other states @xmath158 by an amount @xmath133 .",
    "a second photon should then be able to propagate with perfect transparency , provided it has a detuning compensating for the energy shift @xmath133 , thus ensuring the two - photon resonance condition is satisfied . as we result , we expect to see a transparency window for two photons , whose central frequency shifts linearly with @xmath133 .",
    "this predicted behavior can be confirmed by plotting the transmitted intensity fraction , @xmath159 , and also the second - order correlation function @xmath160 , which corresponds roughly to the two - photon transmission .",
    "[ i_g20_mapping : fig ] shows the single - photon transmission @xmath161 and two - photon transmission @xmath162 as a function of the interaction strength @xmath133 and detuning from two photon resonance @xmath163 .",
    "as expected , @xmath161 shows a peak at @xmath164 independently of the interaction intensity @xmath133 ; instead the peak in @xmath162 shifts towards @xmath165 with increasing @xmath133 .",
    "the decay of @xmath162 for increasing @xmath133 can be intuitively understood by noting that we have a constant coherent state input , in which photons are randomly spaced , causing two photons to enter the medium at different times .",
    "thus , until the second photon enters , the first photon propagates as a single polariton detuned by @xmath163 from the single - photon transparency condition , getting partially absorbed in the process . by increasing the interaction we increase the detuning for this single polariton and consequently its absorption , explaining the trend observed for @xmath162 in fig .",
    "[ i_g20_mapping : fig ] .",
    "a quantitative description of this phenomenon is given in appendix d.    field correlation functions like intensity @xmath166 or @xmath167 can be computed according to the following strategy .",
    "first we switch from heisenberg representation to schrdinger representation , so that for the intensity we get : @xmath168 .",
    "the time evolved wave function , @xmath169 , is determined by numerically evolving the initial spin state @xmath170 under @xmath13 for a time @xmath171 .",
    "then , the state immediately after detection of one photon , @xmath172 , is evaluated by expressing @xmath173 in terms of spin operators using the input - output formalism : @xmath174 .",
    "finally we obtain the intensity by computing the probability of the one - photon detected state , @xmath175 . + for @xmath176 an extra step is needed .",
    "its numerator describes the process of detecting two photons , the first at time @xmath171 and the second at time @xmath177 : @xmath178 . as before we can switch to schrdinger picture , @xmath179 , and evaluate the state after dectection of the first photon , @xmath172 .",
    "then detection of a second photon after a time @xmath180 entails performing an extra evolution under @xmath13 and annihilating a photon , that is : @xmath181 .",
    "finally , we evaluate the quantity @xmath182 , by again expressing @xmath173 in terms of spin operators . in fig .",
    "[ i_g20_mapping : fig]c , we plot the numerically obtained result for @xmath143 , for the case where infinite - range interactions are turned on ( @xmath144 ) and for a weak coherent input state with detuning @xmath145 . in such a situation ,",
    "one expects for the single - photon component of the coherent state to transmit perfectly , while the two - photon component is detuned from its transparency window and becomes absorbed .",
    "this nonlinear absorption intuitively yields the strong anti - bunching dip @xmath183 .",
    "we also evaluate this second - order correlation function using the analytical result for the two - photon s - matrix in eq .",
    "( [ eq : s2 ] ) , which shows perfect agreement as expected .",
    "we have shown that the dynamics of a few photons , propagating under strong interactions mediated by quantum emitters , is fully and efficiently characterized by the dynamics of an open quantum spin model . as the spin model is solvable by standard quantum optical techniques for open systems , our approach provides an easily implementable recipe for the exact numerical study of a large class of quantum nonlinear optical systems . as an example",
    ", it provides an attractive alternative to numerical simulations of propagation through cold rydberg gases , where typically the continuous field is finely discretized and its degrees of freedom are explicitly kept track of  @xcite .",
    "our technique can also be used to treat a number of strongly nonlinear systems based upon atomic saturation  @xcite , where only approximate effective theories for field propagation were previously available .",
    "we anticipate that the availability of exact results will greatly aid in the development of effective theories for the generally challenging problem of quantum many - body states of light , and that our model will shed new insight on conceptual links between such systems and quantum spin systems .",
    "we thank h.j .",
    "kimble , a.v .",
    "gorshkov , and h. de riedmatten for stimulating discussions .",
    "mtm acknowledges support from a la caixa - severo ochoa phd fellowship .",
    "dec acknowledges support from fundacio cellex privada barcelona , the ramon y cajal program , and the marie curie cig project atomnano .",
    "tc , mtm and ts contributed equally to the work .",
    "we present here the full derivation of the decomposition of the s - matrix elements in terms of time - ordered atomic correlation functions .",
    "the starting point is the definition of the s - matrix in eq .  .",
    "since the output operators commute between themselves because of the indistinguishability of photons , they can be freely ordered by decreasing times . introducing the time ordering operator @xmath60 and also using eq .  , the operators in eq .",
    "can be written as @xmath184\\,\\times \\\\ \\times b^\\dagger_\\text{in}(t_1') .. b^\\dagger_\\text{in}(t_n').\\end{gathered}\\ ] ] it is natural to label the terms above by the number @xmath123 of system operators @xmath51 present in each term .",
    "thanks to the fact that @xmath53 = 0 $ ] for @xmath185 , all the input operators can be moved to the right of the spin operators .",
    "thus , the term of order @xmath123 will be of the form @xmath186\\,b_\\text{in}(t_{m+1}) .. b_\\text{in}(t_n)b^\\dagger_\\text{in}(t_1') .. b^\\dagger_\\text{in}(t_n')\\ket{0},\\ ] ] and can be simplified using the commutation relations between input operators @xmath187 = \\delta(t - t')$ ] . this manipulation results in a sum of @xmath188 terms for each original term of order @xmath123 .",
    "each term of the sum consists of @xmath63 delta functions multiplied by a correlation function of the form @xmath189b^\\dagger_\\text{in}(t_1') .. b^\\dagger_\\text{in}(t_m')\\ket{0}.\\ ] ] since the @xmath51 operators commute with the @xmath190 operators at later times , the time ordering operator can be extended to all the operators in the correlation function .",
    "using again eq .   to express the input operators",
    "one gets @xmath191\\ket{0}.\\end{gathered}\\ ] ] however , since the operators @xmath192 commute with all the operators @xmath51 on the left , only @xmath193\\ket{0}\\ ] ] remains , which reproduces eq .  .      in eq .",
    "the vacuum state @xmath194 stands for @xmath195 , i.e. , the vacuum state of field modes and the ground state of all the atoms .",
    "the atomic operators are in the heisenberg picture , @xmath196 , and @xmath13 is the hamiltonian of the whole system without the driving field . by taking the term with @xmath197 as an example ( our argument holds for any time ordering ) ,",
    "we show now that eq .",
    "can be evaluated by effectively evolving system operators as @xmath198 .",
    "the quantum regression theorem is applied here to eliminate the bath or photonic degree of freedom , and results in@xmath199 ,   \\label{o}\\end{aligned}\\]]where @xmath200 and @xmath201 is the lindblad super - operator of the system , defined in the main text .",
    "@xmath202 contains a deterministic part , which generates an evolution driven by @xmath203 and which conserves the number of excitations , and a jump part , which reduces the number of atomic excitations . because of the form of the correlators , which contain an equal number of atomic creation and annihilation operators , the jump part of the evolution of the operators gives a vanishing contribution to the correlation function , proving what was stated above",
    "in this section of the appendix we provide explicit examples of how to use the results derived above to calculate specific matrix elements .",
    "in particular we present the case of the scattering of 1 ) @xmath42 photons on a two - level atom coupled to a one - directional waveguide and 2 ) one and two photons scattering on a rydberg - eit system .",
    "the s - matrix element @xmath204 for the scattering of @xmath42 photons can be in general decomposed in a part that is a series of products of lower - order elements and a part that can not be expressed in such a way .",
    "the latter is called fully connected part of the matrix element and physically corresponds to a @xmath42-body interaction , and is denoted by @xmath205 .",
    "thus , knowing how to decompose the s - matrix , one has to calculate @xmath206 with @xmath207 to construct @xmath204 .",
    "furthermore , it can shown that the fully connected part in an element of order @xmath42 can be obtained by the system correlation function of order @xmath42 .",
    "we show here how to calculate such elements using the results presented above , for the case of a single two - level atom coupled to a one - directional waveguide",
    ". it will be possible to appreciate the simplicity of our formalism compared the more cumbersome method used in ref .",
    "@xcite to obtain the same result .",
    "we start from the relation between the connected part of the matrix element and the correlation function of atomic operators @xmath208 } = \\frac{(-\\gamma)^n}{(2\\pi)^n}\\int \\prod_{i=1}^n\\,dt_i\\,dt_i'\\,e^{\\ii({p_i}t_i-{k_i}t'_i ) } \\times \\\\ \\times\\,\\langle t \\tilde{\\sigma}_-(t_n) ... \\tilde{\\sigma}_-(t_1)\\tilde{\\sigma}_+(t'_n) ... \\tilde{\\sigma}_+(t'_1)\\rangle,\\end{gathered}\\ ] ] where @xmath209 , with @xmath210 .",
    "the time ordering in the correlator gives @xmath211 possible orderings , but it is easy to arrive to the conclusion that only orderings which start on the left with a @xmath212 operator and alternate @xmath213 and @xmath212 give a non - zero contribution .",
    "it is also immediate to see that the number of this possible orderings is @xmath214 .",
    "a possible ordering is for instance @xmath215 which , expressing explicitly the time dependence , is equal to @xmath216 since @xmath203 is diagonal in the @xmath217 basis , we can insert identity operators between the @xmath218 operators in the form of @xmath219 in order to evaluate the hamiltonians in the exponents .",
    "we immediately end up with @xmath220 where we have defined @xmath221 . inserting this result in eq .",
    "we get @xmath222 } = \\frac{(-\\gamma)^n}{(2\\pi)^n } \\int^{+\\infty}_{-\\infty}\\,dt_n\\,\\int^{t_n}_{-\\infty}dt_n'\\, ... \\int^{t_1}_{-\\infty}dt_1'\\,\\bigg[\\\\ \\prod_{i=1}^n\\,e^{\\ii({p_i}-\\alpha)t_i}\\,\\,e^{-\\ii({k_i}-\\alpha)t'_i } + \\text{permutations}\\bigg],\\end{gathered}\\ ] ] where the permutations are over the two sets of incoming and outgoing photon frequencies @xmath223 and @xmath224 . the integral gives @xmath225 } = -2\\pi\\ii\\bigg(\\frac{\\gamma}{2\\pi}\\bigg)^n\\,\\bigg\\{\\prod^{n-1}_{l=1}\\bigg(\\sum_{i=1}^l \\ , \\delta_i \\bigg)^{-1}\\,\\times\\\\ \\times \\prod_{m=1}^n\\bigg(k_m - \\alpha + \\sum_{i=1}^{m-1}\\,\\delta_i \\bigg)^{-1 } + \\text{permutations}\\bigg\\ } \\times \\\\ \\times \\delta\\big(\\sum_{i=1}^n \\,\\delta_i\\big),\\end{gathered}\\ ] ] where @xmath226 , which coincides with the result of ref . @xcite .",
    "the effective hamiltonian of the rydberg - eit system is given by@xmath227where @xmath228 is given by eq .",
    ", and the hardcore interaction is@xmath229with @xmath230 corresponding to the three - level atom .    for the single incident right moving photon with momentum @xmath5 , it follows from eqs .   and that the @xmath231-matrix element is@xmath232with @xmath233this element describes the amplitude of a single transmitted photon with momentum @xmath234 , using the time ordered correlation function of the system operator .",
    "we set for notational simplicity the speed of light @xmath235 .",
    "the second term of @xmath236 , i.e. , the fourier transform of the correlator@xmath237_{ij}^{aa}\\end{aligned}\\]]can be obtained from the green s function @xmath238 with the single - particle hamiltonian@xmath239here , we have expressed @xmath240 in the basis @xmath241 , and @xmath242_{ij}^{\\sigma \\sigma ^{\\prime } } $ ] denotes the element @xmath243 with @xmath244 .",
    "the element @xmath245 gives rise to the transmission coefficient@xmath246_{ij}^{aa}e^{-\\ii k_{\\mathrm{% in}}(z_{i}-z_{j})}.\\ ] ]    for two right - going incident photons with momenta @xmath247 and @xmath248 , the two - photon @xmath231-matrix element @xmath249 describes the amplitude to a final state with two transmitted photons of momenta @xmath250 and @xmath251 . by eqs .   and in the main text",
    ", we find that@xmath252with@xmath253here , @xmath254 denotes the connected four - point green s function , which involves an interaction between the two excitations in the system .",
    "the s - matrix also contains terms arising from disconnected correlation functions , e.g. , @xmath255 describing the linear propagation of each excitation separately , which yields the term in proportional to @xmath256 .",
    "the interaction between two excitations under the hamiltonian @xmath257 can be represented by the ladder diagram shown in fig .",
    "this diagram is represented mathematically by the two - body t - matrix , @xmath258 , which satisfies the lippmann - schwinger equation , @xmath259here , @xmath260 is the total energy , the vacuum bubble @xmath261 is given in terms of @xmath262 , and the interaction matrix @xmath263 has the diagonal element @xmath264 and @xmath265 in the basis @xmath266 .",
    "the solution of eq .",
    "( [ t2 ] ) is @xmath267 .",
    "the s - matrix can then be written as @xmath268_{ij}^{\\sigma _ { 1}\\sigma _ { 1}^{\\prime } } [ \\mathbf{t}% ( e)]_{ij;i^{\\prime } j^{\\prime } } ^{\\sigma _ { 1}\\sigma _ { 1}^{\\prime } ; \\sigma _ { 2}\\sigma _ { 2}^{\\prime } } [ w(k_{1},k_{2})]_{i^{\\prime } j^{\\prime } } ^{\\sigma _ { 2}\\sigma _ { 2}^{\\prime } }   \\notag \\\\ & & + ( p_{1}\\leftrightarrow p_{2}),\\end{aligned}\\]]where@xmath269_{i^{\\prime } j^{\\prime } } ^{\\sigma \\sigma ^{\\prime } } = \\sum_{j_{1}j_{2}}e^{\\ii k_{\\mathrm{in}% } ( z_{j_{1}}+z_{j_{2}})}[g_{0}(k_{1})]_{i^{\\prime } j_{1}}^{\\sigma a}[g_{0}(k_{2})]_{j^{\\prime } j_{2}}^{\\sigma ^{\\prime } a}.\\ ] ]    -matrix.,width=264 ]    the fourier transform of @xmath249 results in the wavefunction@xmath270_{ij}^{\\sigma _ { 1}\\sigma _ { 1}^{\\prime } }   \\notag \\\\ & & \\times \\lbrack \\mathbf{t}(e)]_{ij;i^{\\prime } j^{\\prime } } ^{\\sigma _ { 1}\\sigma _ { 1}^{\\prime } ; \\sigma _ { 2}\\sigma _ { 2}^{\\prime } } [ w(\\frac{e}{2}+k,% \\frac{e}{2}-k)]_{i^{\\prime } j^{\\prime } } ^{\\sigma _ { 2}\\sigma _ { 2}^{\\prime } } \\ } ,   \\label{wf2}\\end{aligned}\\]]of two transmitted photons , where the relative momentum @xmath271 , the center of mass coordinate @xmath272 , and the relative coordinate @xmath273",
    ". the symmetric function@xmath274_{ij}^{\\sigma \\sigma ^{\\prime } } = -\\ii\\sum_{i_{1}i_{2}}\\frac{e^{-\\ii k_{% \\mathrm{in}}(z_{i_{1}}+z_{i_{2}})}}{e-\\varepsilon _ { l}-\\varepsilon _ { l^{\\prime } } } \\sum_{ll^{\\prime } } \\chi _ { l}(a_{i_{1}})\\chi _ { l^{\\prime } } ( a_{i_{2 } } )   \\notag \\\\ & & \\tilde{\\chi}_{l}^{\\ast } ( \\sigma _ { i})\\tilde{\\chi}_{l^{\\prime } } ^{\\ast } ( \\sigma _ { j}^{\\prime } ) [ e^{\\ii(\\frac{e}{2}-\\varepsilon _ { l^{\\prime } } ) x}\\theta ( x)+e^{-\\ii(\\frac{e}{2}-\\varepsilon _ { l})x}\\theta ( -x ) ]   \\notag \\\\ & & + ( x\\rightarrow -x)\\end{aligned}\\]]is defined by the eigenstates @xmath275 and @xmath276 of @xmath277 and  @xmath278 with the corresponding eigenenergies @xmath279 and @xmath280 , @xmath281 and @xmath282",
    ". knowledge of the wave function in the case where the two incident photons have the same momentum , @xmath283 , enables one to calculate the second - order correlation function for the outgoing field , @xmath284 .",
    "we compare the result of @xmath285 from the scattering theory and that from numerically solving the effective spin model with the weak driving field in fig .",
    "[ i_g20_mapping : fig]c in the main text , which shows that they agree with each other perfectly .",
    "in this section , we extend our derivation of the atomic master equation , in order to calculate the response of the system to an arbitrary few - photon input state ( as opposed to a classical or coherent state ) .",
    "the initial state is generally written as @xmath286 , where @xmath287 is the initial state of the system , and@xmath288describes an arbitrary state of incident photons in the fock state basis by the wavefunction @xmath289 . by the relation@xmath290between the fock state @xmath291 and the coherent state @xmath292 , we rewrite @xmath293 by the operator@xmath294acting on the coherent state @xmath295 .",
    "the evolution of the reduced density matrix @xmath296 $ ] is determined by@xmath297,\\]]where @xmath298 is the density matrix of the initial state , and @xmath299 is the total hamiltonian in the rotating frame with @xmath300 . by the relation @xmath301 , the reduced density matrix reads@xmath302,\\]]where @xmath303 is the initial density matrix of the system . the displacement transformation @xmath304 leads to@xmath305and the generating density matrix@xmath306,\\]]where the unitary transformation@xmath307\\]]is given by @xmath308 .",
    "the hamitonian @xmath309 is obtained by replacing the operator @xmath12 by @xmath310 in the hamiltonian @xmath311 , where @xmath312 describes the system under the driving fields @xmath313 . in the density matrix @xmath314 ,",
    "the initial state becomes the vacuum state due to the displacement transformation , thus the evolution of @xmath314 satisfies the master equation@xmath315,\\]]where @xmath201 is the lindblad super - operator of the system without @xmath316 .    in conclusion ,",
    "( [ re ] ) establishes the relation bewteen the evolution of the reduced density matrix @xmath317 for a few incident photons ( which could be a non - classical state ) and the evolution of the reduced density matrix @xmath314 for the system with classical ( coherent state ) driving fields @xmath313 . as a result ,",
    "the few photon scattering problem can be understood as the perturbation expansion of the driving strength @xmath313 .",
    ") can be found by considering a larger space , where first the two photons are both outside the medium ( @xmath318 ) and where one photon enters the medium first .",
    "we specifically consider the case where infinite - range interactions cause the two photons to align with the eit transparency condition when they are both inside the medium , as discussed further in the main text .",
    "the two - photon transmission is proportional to the value of the two - photon wave function at @xmath319.,width=340 ]    in this section of the appendix we provide an intuitive explanation based on linear optics to the behavior of the two - photon transmission @xmath162 depicted in fig .",
    "[ i_g20_mapping : fig]a , b . by indicating with @xmath320 and",
    "@xmath321 the coordinates of the first and second photons , we can divide the space into four regions according to their positions : both photons outside the atomic medium , one photon inside and one outside , and both photons inside the medium , see fig .",
    "[ toy_model : fig ] .",
    "as we are studying an infinite - range interaction , within each region the evolution is effectively linear .",
    "the different dispersion relations in each region , however , leads to non - trivial boundary conditions at their edges .",
    "relevant to our discussion is the value of the two - photon wave function at the boundaries @xmath322 and @xmath323 .",
    "in particular , evolution in the region @xmath324 with these boundary conditions dictates the two - photon transmission , which is proportional to the value of the two - photon wave function at @xmath325 .",
    "+ we study the case where the two photons have detunings @xmath326 . in this case , infinite - range interactions cause these two photons to satisfy the eit transparency condition when both photons are inside the medium . then , there are two qualitatively different regimes for the boundary values of the two - photon wave function , depending on the detuning from two - photon resonance @xmath327 ( for simplicity we assume @xmath142 , so that @xmath328 ) : the small detuning regime , @xmath329 , in which a single photon can travel with high transmission through the medium and reach the detection point ; and the large detuning regime , @xmath330 , in which a single photon is absorbed and can not reach the detection point .    _ small detuning regime. _ within the first regime @xmath331 , a single polariton still fits within the eit transparency window and exhibits high transmission through the medium . a representative probability distribution for a single excitation in this regime is illustrated in fig .",
    "[ lin_intensity : fig]a .",
    "now , we consider the two - excitation manifold . after detection of the first outgoing photon , the second photon can be at any position inside the ensemble with nearly uniform probability , and on average has to travel over a distance @xmath332 before reaching the detection point .",
    "therefore we expect @xmath333 .",
    "the predicted behaviour is in good agreement with full simulations results as shown in fig .",
    "[ comparison : fig ] for small detuning .",
    "_ large detuning regime. _ in this regime a single photon is strongly absorbed .",
    "this is illustrated in fig .",
    "[ lin_intensity : fig]b , where one observes a strong decay of the single - polariton probability and field intensity inside the medium . within the context of fig .",
    "[ toy_model : fig ] , this localized single excitation serves as the boundary condition on the segments @xmath322 and @xmath323 .",
    "furthermore , the evolution in the region @xmath334 is effectively linear .",
    "thus , the effect of this boundary condition at the detection point ( a two - particle problem ) can be mapped onto a simpler problem , wherein one studies how a single excitation , initialized in the shape of the localized photon , transmits through the medium . in this regime",
    ", we therefore can estimate that @xmath162 is twice the value of the maximum transmission associated with this single localized photon , whose evolution we calculate numerically .",
    "( 8,10 ) ( 0.55,5 )   ( green ) and single polariton probabilities @xmath336 ( black ) and @xmath337 ( red ) as function of atom position @xmath34 , for asymptotically large time at @xmath338 ( a ) and at @xmath339 ( b ) .",
    "probabilities are in unit of @xmath340 . other parameters : @xmath341.,title=\"fig:\",width=253 ] ( 0.55,0 )   ( green ) and single polariton probabilities @xmath336 ( black ) and @xmath337 ( red ) as function of atom position @xmath34 , for asymptotically large time at @xmath338 ( a ) and at @xmath339 ( b ) .",
    "probabilities are in unit of @xmath340 . other parameters : @xmath341.,title=\"fig:\",width=253 ] ( 0,9)(a ) (",
    "0,4)(b )     versus @xmath335 : comparison of the full simulation @xmath162 ( red triangles ) with the simple models for the small detuning regime ( where one expects @xmath342 , black line ) and the large detuning regime ( blue curve ) , where the two - photon transmission is obtained from the propagation of a single photon localized at the front of the medium ( near @xmath343).,width=245 ]                              j.  d. pritchard , _ et al .",
    "* 105 * , 193603 ( 2010 ) ; j. pritchard , k. weatherill , and c. adams , nonlinear optics using cold rydberg atoms in _ annual review of cold atoms and molecules _ ( eds k.  w.  madison , y. wang , a.  m. rey , k. bongs ) * 1 * , 301 - 350 ( world scientific , 2013 ) ; t. peyronel , _ et al .",
    "_ , nature * 488 * , 57 ( 2012 ) ; o. firstenberg , _ et al .",
    "_ , nature * 502 * , 71 ( 2013 ) ; s. baur , d. tiarks , g. rempe and s. durr , phys .",
    "lett . * 112 * , 073901 ( 2014 )                            actually the formula @xmath344 is derived in the limit @xmath345 , where for a two - level atom the transmission on resonance is given by @xmath346 .",
    "such a regime of high transmission per single atom is relevant for the majority of eit experiments and indeed , as shown in the main text , known results of eit are reproduced correctly .",
    "however in the opposite limit @xmath347 a single atom behaves like a perfect mirror  @xcite ( @xmath348 ) and the correct theoretical description requires a different expansion for the transmission coefficient , @xmath349 ."
  ],
  "abstract_text": [
    "<S> there has been rapid development of systems that yield strong interactions between freely propagating photons in one dimension via controlled coupling to quantum emitters . </S>",
    "<S> this raises interesting possibilities such as quantum information processing with photons or quantum many - body states of light , but treating such systems generally remains a difficult task theoretically . here , we describe a novel technique in which the dynamics and correlations of a few photons can be exactly calculated , based upon knowledge of the initial photonic state and the solution of the reduced effective dynamics of the quantum emitters alone . we show that this generalized `` input - output '' formalism allows for a straightforward numerical implementation regardless of system details , such as emitter positions , external driving , and level structure . as a specific example , we apply our technique to show how atomic systems with infinite - range interactions and under conditions of electromagnetically induced transparency enable the selective transmission of correlated multi - photon states . </S>"
  ]
}