{
  "article_text": [
    "in the past decades , density functional theory@xcite has become the mainstream technique for electronic structure calculations of large molecules , clusters , liquids , and solids . in condensed matter applications , the most common functional",
    "has initially been based on the local density approximation ( lda),@xcite but generalized gradient approximations have become increasingly popular in the last two decades .",
    "a class of functionals that could potentially lead to higher accuracy include a fraction of exact nonlocal exchange in the exchange - correlation potential.@xcite this class of functionals , referred to as hybrid functionals , has become the standard electronic - structure approach in quantum - chemistry applications . for molecular systems ,",
    "these functionals achieve a more accurate description not only of atomization energies,@xcite but also of ionization potentials and electron affinities.@xcite however , several shortcomings still remain .",
    "for instance , the desired chemical accuracy is not always attained and no solution is offered for the treatment of van - der - waals interactions .",
    "nevertheless , it appears quite clearly that the inclusion of exact exchange constitutes an improvement , which might be particularly useful in several circumstances .",
    "when applied to semiconductors and insulators , hybrid functionals provide a superior description to semilocal functionals .",
    "for instance , structural parameters are found to be closer to experimental values.@xcite furthermore , hybrid functionals give electronic band gaps which are systematically larger than those achieved with semilocal functionals , generally leading to a better agreement with experiment.@xcite in particular , the improvement achieved by hybrid functionals in which the coulomb potential is screened is remarkable,@xcite and the origin of this successful description can be rationalized.@xcite a more accurate description of the band gap is especially important in certain classes of problems , such as the study of surface and interface states@xcite and the determination of defect energy levels.@xcite indeed , a physically meaningful description of electronic states lying in the band gap can only be achieved when the calculated band gap approaches the experimental one .    for the treatment of condensed systems ,",
    "hybrid functionals have been available for some time in codes combining gaussian basis sets and periodic boundary conditions.@xcite however , it is expected that the treatment of the electronic structure through hybrid functionals carries potential to be much more widely used in an implementation based on plane - wave basis sets and pseudopotentials.@xcite in this respect , the treatment of exact exchange poses several new problems with respect to the use of standard semilocal functionals .",
    "first , the calculation of exact exchange entails a significantly higher computational cost . to address this issue",
    ", efficient algorithms have been developed to optimize the scaling with respect to the number of plane waves.@xcite a further gain is achieved through optimal adaptation to new massively parallel computer platforms.@xcite despite these improvements , plane - wave based hybrid - functional calculations for a system of 1000 electrons still yield a computational cost exceeding that of semilocal ones by more than two orders of magnitude.@xcite nevertheless , such calculations are attracting increasing interest as larger computational resources become available .",
    "second , the expression for exact exchange includes an integrable divergence,@xcite which hinders its straightforward use within plane - wave formulations because of its slow convergence with the density of @xmath0 points .",
    "gygi and baldereschi proposed a numerical treatment of the divergence based on the analytic integration of an auxiliary function showing the same singularity.@xcite such auxiliary functions are nowadays available for arbitrary unit cells.@xcite alternative treatments consist in truncating the coulomb operator,@xcite using a screened coulomb potential,@xcite or transforming the bloch functions in order to compute real - space coulomb integrals.@xcite    third , the nonlocal exchange coupling between valence and core states also intervenes in the basic pseudopotential approximation .",
    "such interactions can be accounted for within an all - electron scheme in which the pseudopotential approximation consists in freezing the wave functions of the core states.@xcite the core - valence interactions due to exchange then lead to a modification of the nonlocal pseudopotential term . in consideration of the fact that current hybrid functionals generally only include a fraction of exact exchange ( about 25% ) ,",
    "pseudopotentials derived within semilocal formulations have often been transferred to hybrid schemes without any modification or through the only use of nonlinear core corrections.@xcite however , when core - valence interactions are sizable , these practices require particular care , and it has recently been pointed out that they might lead to inconsistencies.@xcite    in this work , we focus specifically on aspects associated with the treatment of the integrable singularity when calculating the exact exchange expresssion in electronic - structure schemes based on plane - wave basis sets . following gygi and baldereschi,@xcite",
    "we adopt a formulation in which the divergence is treated analytically .",
    "this scheme can be recast in such a way that the treatment of the divergence results in a correction term formally corresponding to the fourier component of the exchange potential at vanishing wavevector in the brillouin zone.@xcite we first address the degree of convergence that can be achieved with a @xmath0-point sampling of finite density for both the total energy and the energy eigenvalues , in comparison with a similar calculation that does not include exact exchange .",
    "this aspect is particularly important to validate calculations based on large simulations cells with the brillouin zone sampled only at the @xmath1 point , a configuration which is often used in surface , interface , and defect calculations or in _ ab initio _ molecular dynamics simulations .",
    "we also consider exchange interactions based on screened coulomb potentials .",
    "while this case formally does not show a singularity , there are specific circumstances in which the same convergence deficiency occurs as for the bare coulomb potential .",
    "we then study the effect of the singularity correction on the total energy of _ charged _ systems .",
    "differences between total energies of systems involving a different number of electrons are relevant for determining the electron affinity , the ionization potential , the band gap , and the charge transition levels of defects .",
    "we discuss the effect of the correction on these quantities for the cases of both finite and extended systems .",
    "in particular , in the case of extended systems , we clarify the way the singularity correction affects the band edges obtained from the energy eigenvalues and those obtained through total - energy differences .",
    "this paper is organized as follows . in sec .",
    "[ divergence ] , we review the treatment of the singularity of the exact exchange operator in the case of plane - wave basis sets following the scheme of gygi and baldereschi.@xcite an extension of this method to the case of large supercells with sparse @xmath0-point sampling is described . a generalized procedure for treating the case of screened exchange is also given . in sec .",
    "[ methods ] , we describe the computational setups used in this work .",
    "section [ neutral ] presents convergence tests for total energies , energy eigenvalues , and single - particle energy gaps of neutral systems including molecules and solids .",
    "results obtained with @xmath1-point sampling are studied for increasing supercell size . in the case of extended systems ,",
    "a comparison is carried out with converged calculations achieved with small unit cells and dense @xmath0-point samplings . in secs .",
    "[ charge - loc ] and [ charge - deloc ] , we study charged systems with localized and delocalized charge states , respectively . in particular , we focus on total energies , single - electron eigenvalues , electron addition energies , electron removal energies , and charge transition levels of defects .",
    "we study the convergence of these quantities as a function of the singularity correction and emphasize the difference between localized and delocalized states .",
    "the conclusions are drawn in sec .",
    "[ conclusions ] .",
    "we note that a method related to hybrid functionals consists of including exact exchange in a local way through the use of an optimized effective potential.@xcite while this scheme is not explicitly discussed in the following , our considerations regarding the singularity correction also apply in this case .",
    "the exchange energy of a solid is a finite quantity if expressed per one unit cell.@xcite in a basis of plane waves , the matrix element of the fock exchange operator @xmath2 is given by@xcite    @xmath3    where the sum over @xmath4 runs over the occupied states and the integral is carried out over the brillouin zone ( bz ) . since the integrand diverges for @xmath5 , special numerical care is required when replacing the integral with a sum over a finite number of @xmath0-points . to treat the singularity , gygi and baldereschi used an auxiliary function , periodic in reciprocal space and showing the same @xmath6 divergence as the integrand in eq .",
    "( [ fock1 ] ) .",
    "the integral of this function is then subtracted and added to the right hand side of eq .",
    "( [ fock1 ] ) .",
    "the subtracted term eliminates the divergence of the integrand and turns it into a smooth function of @xmath7 , which can accurately be evaluated through a sampling of special @xmath0-points .",
    "the singularity is effectively transferred to the added term and is taken care of through analytical integration.@xcite    the method of gygi and baldereschi requires to be adapted in order to be applied to calculations with large supercells and sparse @xmath0-point samplings .",
    "first , it is convenient to adopt the notation @xmath8 and @xmath9 : @xmath10 where the integral is over the whole of reciprocal space . for illustration , we focus in the following on a @xmath0-point sampling based on the sole @xmath1 point , i.e.  @xmath11 .",
    "application of the procedure proposed by gygi and baldereschi transforms the right hand side of eq .",
    "( [ fockq ] ) to @xmath12 % \\nonumber \\\\ & & -\\frac{1}{2\\pi^2}\\sum_{m}c^{*}_{m}\\left(\\mathbf{g}'\\right)c_{m}\\left(\\mathbf{g}\\right ) \\int f\\left(\\mathbf{q}\\right ) d\\mathbf{q } , \\label{fock5}\\end{aligned}\\ ] ] where the auxiliary function needs to chosen in such a way that @xmath13 when @xmath14 .",
    "in addition , the function @xmath15 must be integrable in the whole of reciprocal space .",
    "the term in parentheses is now a smooth function of @xmath16 in which the divergence is cancelled .",
    "therefore , it is justified to approximate the integral over @xmath16 in the first term in eq .",
    "( [ fock5 ] ) with a discrete sum via @xmath17 where @xmath18 is the volume of the simulation cell .",
    "we here assume that the discretization in @xmath16-space corresponds to the @xmath0 points for which the wave functions are determined . the second term in eq .",
    "( [ fock5 ] ) is to be evaluated through an analytical integration .",
    "the final expression reads : @xmath19 % \\nonumber \\\\ -\\frac{1}{2\\pi^2}\\sum_{m}c^{*}_{m}\\left(\\mathbf{g}'\\right)c_{m}\\left(\\mathbf{g}\\right ) \\int f\\left(\\mathbf{q}\\right ) d\\mathbf{q } \\nonumber% .",
    "\\label{fock6}\\end{aligned}\\ ] ] in the case of @xmath1 point sampling , the sum over @xmath20 simply corresponds to a sum over the reciprocal lattice vectors @xmath21 from which @xmath22 needs to be excluded .",
    "we emphasize that the closer @xmath23 is to @xmath24 , the smoother the integrand in the parentheses , and the more accurate the approximation of the integral by a sum of discrete terms .",
    "hence , this condition should guide the choice of the optimal function @xmath15 .",
    "we note that in the formulation of gygi and baldereschi , the auxiliary function is to a certain extent arbitrary , because ultimate convergence can always be achieved by increasing the density of the @xmath0-point sampling . in the case of a fixed @xmath0-point sampling ,",
    "the converged result is achieved by considering simulation cells of increasing size . however , in practice , this limit is computationally more prohibitive .",
    "for instance , as a word of caution , we emphasize that for small band - gap materials very large supercells might be required in calculations relying only on the @xmath1-point even at the semilocal level .",
    "generally , a satisfactory target for calculations including exact exchange corresponds to the achievement of the same level of convergence as that attained for a semilocal functional under the same @xmath0-point sampling conditions .",
    "for this reason , it is important to chose a function @xmath15 which yields the best convergence properties for the chosen @xmath0-point sampling .    by reorganizing the order of the terms in eq .",
    "( [ fock6 ] ) , we obtain the following appealing form : @xmath25 where @xmath26 represents a suitable generalization of the fourier transform of the exchange potential and is given by : @xmath27 with @xmath28 this form is particularly convenient since it implies that only the @xmath29 term needs to be modified in practical implementations .",
    "we note that standard numerical implementations do not experience any difficulty for treating the differences between large numbers that this reorganization of terms implies .",
    "a suitable form of the auxiliary function @xmath15 is:@xcite @xmath30 for this particular choice of auxiliary function , the @xmath31=@xmath32 term of the exchange potential becomes : @xmath33 for illustration , we show in fig .",
    "[ fig1 ] the dependence of @xmath34 on @xmath35 in the case of a cubic cell with a side of 20 bohr . as mentioned above , the approximation of replacing the integral in eq .",
    "( [ fock5 ] ) with a discrete sum is the more accurate , the closer @xmath23 is to @xmath24 .",
    "this leads to the following well - defined expression for @xmath34 : @xmath36 . \\label{beta3}\\ ] ]     [ eq .  ( [ beta2 ] ] vs the parameter @xmath35 for a cubic simulation cell with a side of 20 bohr and @xmath1-point sampling .",
    "the optimal singularity correction is achieved for @xmath37.,width=283 ]    we now analyze the effect of the singularity correction on eigenvalues and total energies . in our notation , the superscript `` @xmath38 '' indicates that the correction @xmath34 has been accounted for , whereas the superscript `` @xmath39 '' is used for quantities obtained with @xmath40=@xmath41 in the definition ( [ fourrier ] ) .",
    "the exact exchange term contributes to the eigenvalue @xmath42 of the state @xmath43 through the following expression : @xmath44 where we used the matrix element @xmath45 given in eq .",
    "( [ fock7 ] ) .",
    "the singularity correction affects the eigenvalue as follows : @xmath46 where @xmath4 runs over the occupied states and where we used the orthonormalization condition of the eigenstates .",
    "thus , all the eigenvalues of occupied states shift down by @xmath34 , whereas those of unoccupied states remain unaffected : @xmath47 in this derivation , we assumed that the ordering of the states is not affected by the application of the singularity correction .",
    "the exact exchange part of the total energy is given by @xmath48 where the contribution of the singularity correction is @xmath49 with @xmath50 corresponding to the number of electrons in the supercell .",
    "thus : @xmath51 i.e.  a correction of @xmath52 for each electron .    in the limit @xmath53 [ cf .  eq .  ( [ beta3 ] ) ]",
    ", the correction @xmath52 corresponds to the electrostatic energy of a point charge interacting with a uniform compensating background charge in the periodic cell .",
    "indeed , following the method proposed by ewald,@xcite one replaces the point charge by a gaussian charge distribution , @xmath54 the second term in eq .",
    "( [ beta2 ] ) then corresponds to the electrostatic energy of the gaussian charge distribution interacting with the background and is evaluated in fourier space . the first term in eq .",
    "( [ beta2 ] ) compensates for the selfinteraction of the gaussian charge .",
    "the complete ewald method also gives a third term , which accounts for the difference between the point charge and the gaussian charge and which is generally evaluated in real space .",
    "the absence of this term in eq .",
    "( [ beta2 ] ) accounts for the variation of @xmath34 with @xmath35 in fig .",
    ". however , in the limit @xmath53 , the latter term vanishes and the correction @xmath52 precisely corresponds to the electrostatic energy of the point charge .",
    "this connection has been pointed out earlier in the case of isolated molecules in large supercells on the basis of an intuitive reasoning.@xcite the present derivation shows that the same correction term also applies to the case of extended systems .",
    "we note that the methodology described above does not only apply in the presence of a divergence , but might also be useful when the interaction potential only shows a rapidly varying behavior .",
    "indeed , the direct treatment of such a potential in fourier space is difficult when the density of @xmath0 points can not easily be increased .",
    "for instance , this applies to screened exchange interactions .",
    "we here illustrate this point by focusing on the screened exchange interaction recently proposed in functionals developed by heyd , scuseria , and ernzerhof ( hse),@xcite but the scheme also applies analogously to other forms of screened exchange . in the hse functional , a complementary error function",
    "is used to describe the short - range exchange interaction : @xmath55 where @xmath56 is a suitable parameter defining the extent of the potential .",
    "for simplicity , let us again consider the @xmath1-point approximation .",
    "the matrix element of the screened exchange operator in a plane - wave basis set is given by an expression analogous to eq .",
    "( [ fock7 ] ) .",
    "the interaction potential is given by the fourier transform of the potential defined in eq .",
    "( [ sr ] ) , i.e.@xmath57}.\\ ] ] the @xmath31=@xmath32 component of this potential @xmath58 is not divergent , and is equal to @xmath59 .",
    "however , the latter expression can not be used for any value of @xmath56 . indeed , when the screened exchange interaction approaches the exact one ( viz .",
    "in the limit @xmath60 ) , @xmath58 diverges rather than converging to the correct value given in eq .",
    "( [ beta3 ] ) .",
    "we derive a suitable expression of @xmath58 by proceeding in the same way as in the previous section . the correction is again given by eq .",
    "( [ beta1 ] ) , where we now choose as auxiliary function : @xmath61 \\nonumber \\\\",
    "\\label{f2 } & = & \\frac{e^{-\\gamma q^2}}{q^2 } - \\frac{e^{-\\left(\\gamma+\\frac{1}{4\\omega^2}\\right ) q^2}}{q^2}.\\end{aligned}\\ ] ] using the definition given in eq .",
    "( [ beta2 ] ) and taking the limit as in eq .",
    "( [ beta3 ] ) , we find the correct expression for the @xmath31=@xmath32 component of the screened exchange potential : @xmath62 which defines the function @xmath63 .",
    "this leads us to the following form for the interaction potential : @xmath64 & \\textrm{for } \\mathbf{g } \\neq 0,\\\\ \\\\",
    "\\tilde{\\chi}(\\omega )                                                                    & \\textrm{for } \\mathbf{g } = 0 .",
    "\\end{array } \\right .",
    "\\label{fourrier2}\\end{aligned}\\ ] ]     [ eq .  ( [ beta_sr ] ) ] as a function of the screening parameter @xmath56 for a cubic simulation cell of 20 bohr ( solid line ) . at large @xmath56",
    "the singularity correction coincides with the analytical expression @xmath65 ( dashed line ) .",
    "( b ) @xmath66 vs the side @xmath67 of the cubic simulation cell at fixed @xmath68 bohr@xmath69 ( solid line ) , corresponding to the value set in the heyd - scuseria - ernzerhof functional ( ref .  ) . at large @xmath67 , @xmath66 approaches @xmath70 ( dashed line ) .",
    "the brillouin zone is sampled at the @xmath1 point.,width=283 ]    to illustrate the behavior of this correction as a function of @xmath56 , we considered a cubic simulation cell with a side of 20 bohr .",
    "figure [ fig2](a ) shows that the function @xmath63 is nearly indistinguishable from the analytical expression @xmath59 when @xmath71 bohr@xmath69 .",
    "however , for lower values of @xmath56 , the screened potential approaches the bare coulomb interaction and the analytical expression gives erroneous results .",
    "instead , the function @xmath63 correctly reproduces the coulomb limit for @xmath72 .    for comparison ,",
    "the parameter @xmath56 assumes the value of 0.106 bohr@xmath69 in the hse functional.@xcite hence , for the case illustrated in fig .",
    "[ fig2](a ) , the proposed treatment would not produce a sizable correction .",
    "however , the situation changes when smaller simulation cells are used .",
    "we show in fig .",
    "[ fig2 ] the dependence of the singularity correction on the size of the cubic cell for @xmath68 bohr@xmath69 .",
    "it is seen that the analytical expression deviates from the proper correction @xmath66 for cell sizes smaller than 18 bohr .",
    "this behavior reflects the fact that at these cell sizes the @xmath1-point sampling in reciprocal space is too sparse for properly treating the spatial varations of the screened exchange potential defined by @xmath68 bohr@xmath69 .",
    "the semilocal density - functional calculations in this work were performed within the generalized gradient approximation proposed by perdew , burke , and ernzerhof ( pbe).@xcite we considered the class of hybrid functionals which are obtained by replacing a fraction @xmath73 of the pbe exchange with exact exchange:@xcite @xmath74 in this work , we used the functional defined by @xmath75 , which is referred to as pbe0.@xcite the singularity correction then corresponds to a fraction @xmath73 of the correction pertaining to full exact exchange : @xmath76    in our electronic structure scheme based on plane - waves , only valence electrons are treated explicitly and core - valence interactions are described by normconserving pseudopotentials.@xcite pseudopotentials were generated at the pbe level and were also used in the calculations based on hybrid functionals .",
    "this is expected to be a valid approximation for the atoms considered in this work , i.e.  c , n , o , and si , in which core - valence exchange interactions are weak .",
    "we used a kinetic energy cutoff of 20 ry for systems involving only si atoms , but increased the cutoff to 70 ry when any of the other atoms occurred .",
    "these cutoffs are sufficiently high to ensure converged total energies and energy eigenvalues .",
    "for all calculations involving small supercells and dense @xmath0-point meshes , we used the code of the package,@xcite in which exact exchange and the singularity correction are implemented.@xcite all calculations involving large supercells and @xmath1-point samplings were carried out with the code . in this code , we extended the available implementation of exact exchange to account for the singularity following the scheme outlined in sec .",
    "[ exchange ] .",
    "we also performed electronic structure calculations for molecules with the suite of programs.@xcite we used the large cc - pvtz basis set .",
    "this method does not give rise to any divergence of the interaction potential and allowed us to obtain reliable benchmarks .",
    "in this section , we present calculations for total energies and energy eigenvalues of small organic molecules . for these calculations",
    ", we used the electronic structure scheme based on plane waves and pseudopotentials with large supercells of varying size and @xmath1-point sampling .",
    "we considered the molecules of naphthalene ( c@xmath77h@xmath78 ) and pyridine ( c@xmath79h@xmath79n ) , which are sufficiently small to allow us to investigate the asymptotic behavior for large simulation cells .",
    "furthermore , the eigenvalue of the lowest unoccupied molecular orbital ( lumo ) of these molecules is found below the vacuum level , both in pbe and pbe0 . in fig .",
    "[ fig3 ] , the total energies and the energy eigenvalue gaps of naphthalene calculated in pbe and pbe0 are plotted as a function of the size of the cubic simulation cell . in hybrid functional calculations , we explicitly compare results obtained with and without the singularity correction @xmath80 , i.e.obtained by turning on and off the @xmath29 component of the exact exchange potential .",
    "one notices that both the total energies and the energy eigenvalue gaps calculated in pbe0 show a convergence behavior similar to that achieved in pbe provided the singularity is accounted for .",
    "note that for the largest considered supercell ( side of 60 bohr ) the singularity correction @xmath80 is still quite sizable and amounts to about 0.2 ev .",
    "a similar behavior is observed for pyridine ( not shown ) .",
    "these results therefore indicate that in the case of isolated molecular systems , the singularity correction is crucial to achieve well - converged values of total energies and energy eigenvalues in hybrid functional calculations based on plane - wave basis sets .",
    ".energy eigenvalues of the highest occupied molecular orbitals ( @xmath81 ) and of the lowest unoccupied molecular orbitals ( @xmath82 ) , energy eigenvalue band gaps ( @xmath83 ) , and ionization potentials ( ip ) of naphthalene and pyridine calculated with the pbe0 functional through a plane - wave ( cpmd , ref .  ) and an all - electron scheme ( gaussian03 , ref .  ) .",
    "the eigenvalues are referred to the vacuum level . [ cols= \" < ,",
    "< , > , > \" , ]     [ tab1 ]    to benchmark our hybrid - functional results , we also used an all - electron electronic - structure scheme based on localized atomic orbitals and open boundary conditions.@xcite total energies can not be compared because of the different number of electrons that are treated explicitly .",
    "the energy eigenvalues and energy gaps are compared with those obtained with the plane - wave scheme in table [ tab1 ] .",
    "the eigenvalues are referred to the vacuum level corresponding to local potential far from the molecule .",
    "the agreement between the two sets of calculations is very good .",
    "this agreement further supports the validity of the singularity correction derived in sec .",
    "[ divergence ] . to the extent",
    "that basis set errors for these molecules are small , the differences also provide an estimate of the way the different treatments of core electrons affect the energy eigenvalues obtained with hybrid functionals .",
    "table [ tab1 ] also contains calculated ionization potentials , of which the discussion is deferred to sec .",
    "[ finite ] .      in this section ,",
    "we study the effect of the singularity correction in hybrid functional calculations on the total energies and energy eigenvalues of bulk systems .",
    "in particular , our purpose is _ (",
    "i ) _ to illustrate the convergence of small - cell calculations with @xmath0-point sampling ( cf .  refs . ) and _ ( ii ) _ to study the convergence of @xmath1-point calculations with supercell size . in the latter case ,",
    "one issue of interest is whether the achieved level of convergence is similar to that of corresponding calculations with semilocal functionals .",
    "we chose silicon and @xmath73-quartz sio@xmath84 to examine systems with different band gaps . to allow a comparison between pbe and pbe0 calculations of the electronic structure",
    ", we used the lattice parameters optimized in the pbe also in the hybrid functional calculations .",
    "total energies of ( a ) si and ( b ) @xmath73-quartz sio@xmath84 per formula unit versus 1/@xmath85 , where @xmath86 is the total number of @xmath0-points and @xmath87 the total number of atoms in the supercell .",
    "results obtained in the pbe and the pbe0 are reported in left and right panels , respectively . for pbe0 ,",
    "closed and open symbols indicate values obtained with the singularity correction turned on and off , respectively .",
    "arrows show data points which were also obtained with @xmath1-point sampling.,width=321 ]    we first considered the convergence of total energies .",
    "pbe and pbe0 results for silicon and @xmath73-quartz are displayed in fig .",
    "the data points illustrate how convergence is achieved with increasing density of @xmath0-point sampling .",
    "for both systems , the inclusion of the singularity correction in the hybrid functional calculations leads to a faster convergence , very similar to that achieved by the semilocal functional .",
    "it is apparent that the singularity correction is sizable and that its inclusion significantly speeds up the convergence . for comparison",
    ", we also calculated total energies employing large supercells and @xmath1-point sampling . in the respective limits of dense @xmath0-point samplings and large supercell size ,",
    "the two kinds of calculations give the same converged energies .",
    "when the energies calculated in the latter scheme are reported in fig .",
    "[ fig4 ] ( see arrows ) , they are found to correspond to energies obtained with primitive cells and dense @xmath0-point samplings .",
    "in particular , for finite supercell size , the degree of convergence achieved with hybrid functionals when the singularity is treated is comparable to that obtained with semilocal functionals .",
    "these results highlight the importance of including the singularity correction when using hybrid functionals with @xmath1-point sampling .",
    "this is particularly important when total energies obtained with supercells of different size are comparatively evaluated , such as in the optimization of lattice parameters or in constant - pressure molecular dynamics simulations .",
    "eigenvalues corresponding to the valence ( @xmath88 ) and conduction ( @xmath89 ) band edges of ( a ) si and ( b ) @xmath73-quartz sio@xmath84 vs 1/(@xmath86@xmath87 ) , where @xmath86 is the total number of @xmath0-points and @xmath87 the total number of atoms in the supercell .",
    "results obtained in the pbe and the pbe0 are reported in left and right panels , respectively . for pbe0 ,",
    "closed and open symbols indicate values obtained with the singularity correction turned on and off , respectively .",
    "arrows show data points which were also obtained with @xmath1-point sampling .",
    "the energies obtained with the two functionals are aligned through the local electrostatic potential ( cf .",
    "ref .  ) .",
    ", width=321 ]    next , we addressed the convergence of energy band edges and band gaps .",
    "the band gap is obtained from the energy eigenvalues : @xmath90 where @xmath91 and @xmath92 are the conduction band minimum and the valence band maximum , respectively . in fig .",
    "[ fig5 ] , we give the band gaps of silicon and sio@xmath84 as a function of @xmath0-point sampling or supercell size , as obtained within both the pbe and the pbe0 .",
    "the results obtained with the hybrid functional are given with and without the singularity correction .",
    "in analogy with the convergence of the total energy ( fig .  [ fig4 ] ) , the convergence of the band gap is very slow when omitting this correction .",
    "the improvement is more clear for sio@xmath84 , for which the band gap converges at a sparser @xmath0-point density .",
    "results obtained with large supercells and @xmath1-point sampling coincide with those obtained with small unit cells and dense @xmath0-point meshes .",
    "we note that in the case of sio@xmath84 a converged value of the pbe0 band gap is already achieved with a simulation cell of 72 atoms , well within current computationally accessible limits .",
    "in the case of si , the convergence is slower because of the smaller band gap , but the convergence of the hybrid functional result is similar to that achieved with the semilocal functional when the singularity correction is included . in fig .",
    "[ fig5 ] , the convergence of the respective band edges is shown .",
    "the singularity correction only affects the occupied states by introducing a constant downward shift of the energies ( cf .",
    "[ divergence ] ) .",
    "silicon band gap calculated with the pbe ( left panel ) and pbe0 ( right panel ) functionals for a cubic simulation cell containing 8 atoms vs number of @xmath0-points in the [ 001 ] direction , @xmath93 , with fixed @xmath0-point sampling in the orthogonal directions ( @xmath94=@xmath95=2 ) . for pbe0 ,",
    "closed and open symbols indicate values obtained with the singularity correction turned on and off , respectively.,width=321 ]    in many applications concerning surfaces and interfaces , the supercells have an elongated shape to describe the transition across the boundary region . for such systems ,",
    "the omission of the singularity correction in a hybrid functional calculation in which a @xmath1-point sampling is used leads to a peculiar behavior of total energies and single particle eigenvalues . to simulate these conditions , we considered a cubic 8-atom simulation for bulk silicon and increased the @xmath0-point sampling along the [ 001 ] direction , while keeping the @xmath0-point sampling in the orthogonal directions constant . this description is equivalent to that achieved with an elongated supercell calculation in which the brillouin zone is sampled at the sole @xmath1 point .",
    "figure [ fig6 ] shows the calculated band gap vs.  the number of @xmath0-points in the [ 001 ] direction . omitting the singularity correction leads in this case to a linear increase of the band gap .",
    "a similar linear increase is also found for the total energy ( not shown ) . in neither case",
    ", it is therefore possible to obtain a converged value . including the singularity correction reestablishes a converging behavior that resembles that found in semilocal density functional calculations .    from the result in fig .",
    "[ fig6 ] , we infer that the singularity corrections for elongated simulation cells may change sign in comparison with cubic unit cells and/or isotropic @xmath0-point meshes . to understand this behavior , it is useful to recall that , in the case of @xmath1-point sampling , the singularity correction is proportional to the energy per unit cell of a periodically repeated point charge immersed in a compensating background . in case of nearly cubic supercells",
    "the latter energy is negative , i.e.  the attractive interaction of the point charge with the uniform background is larger than the repulsive interactions between the point charge and its images .",
    "when the shape of the cell elongates in one or two directions , the repulsive interaction with the image charges in the orthogonal directions grows because of the reduced screening . for sufficiently elongated shapes , this repulsive interaction dominates and the sign of the point - charge energy switches .    to summarize the results of this section",
    ", we showed that the singularity correction is needed to obtain converged total energies and single - electron eigenvalues in hybrid functional calculations with small unit cell and dense @xmath0-point samplings , in accord with previous studies.@xcite furthermore , we showed that hybrid functional calculations with large supercells and @xmath1-point samplings also benefit from the singularity correction , yielding levels of convergence which are similar to those achieved with semilocal functionals . in the case of @xmath1-point samplings",
    ", the singularity correction applies to both molecular and extended systems in a qualitatively similar way .",
    "in the following , we discuss convergence issues associated to charged systems when using hybrid functional schemes based on plane wave basis sets .",
    "charged systems occur in several circumstances , such as , for example , when studying charged molecules , defects , ions in liquids , etc .",
    "we here focus on the determination of total energy differences between different charge states and the way the singularity correction affects the convergence properties .",
    "we are particularly interested in assessing how the convergence properties of hybrid functional calculations compare with those of semilocal density functional calculations . for simplicity , we consider from now on only systems in which the electronic structure is sampled through the sole @xmath1 point .",
    "the convergence is therefore studied with respect to increasing simulation cell , or equivalently with respect to decreasing singularity correction .",
    "generalization to convergence with @xmath0-point samplings is trivial . in this section",
    ", we deal with atomically localized states , either in finite systems or as defect states in solids .",
    "infinitely delocalized states are discussed in sec .",
    "[ charge - deloc ] . in this work , we do not consider states showing intermediate degrees of localization . for a discussion of the latter ,",
    "we defer the reader to refs ..      to illustrate the convergence of total energy differences between different charge states , we considered the calculation of the ionization potential ( ip ) of an isolated molecule : @xmath96 where @xmath97 is the total energy of the neutral molecule and @xmath98 the total energy of the same molecule in which one electron has been removed .",
    "the total energy calculations correspond to an isolated molecule placed in a large supercell and subject to periodic boundary conditions .",
    "this technical constraint introduces a spurious interaction between the localized charge and the neutralizing background charge , which needs to be considered in order to speed up the convergence.@xcite this correction depends on the size of the simulation cell , but applies indifferently to both hybrid functionals and semilocal density functionals . in our calculations , the dominant correction corresponding to the charge monopole has systematically been included.@xcite    , which scales like the inverse of the simulation cell size . for pbe0 ,",
    "closed and open symbols indicate values obtained with the singularity correction turned on and off , respectively.,width=321 ]    in fig .",
    "[ fig7 ] , we give the ionization potentials of naphthalene calculated within both the pbe and the pbe0 for different supercell sizes .",
    "the pbe0 results are obtained by both including and dismissing the singularity correction .",
    "the results are plotted as a function of the singularity correction , which scales like the inverse of the simulation cell size . for the simulation cells considered ( cubic cells with sides ranging between 20 and 60 bohr ) , the pbe results are already close to the converged values obtained by linear extrapolation .",
    "the same consideration applies for the pbe0 results which include the singularity correction .",
    "however , in absence of singularity correction , the error with respect to the converged values is significantly larger .",
    "the converged pbe0 values for the ionization potentials of naphthalene and pyridine are reported in table [ tab1 ] , where they are compared with results obtained with an all - electron scheme based on localized orbitals .",
    "the values calculated within the two schemes differ by less than 0.05 ev .",
    "it is of interest to extend our comparative study between pbe and pbe0 calculations to the approximate scheme based on slater s transition state.@xcite according to the integral form of janak s theorem,@xcite the total - energy difference of eq .",
    "( [ ip ] ) is given by @xmath99 where @xmath100 describes the eigenvalue of the highest occupied eigenstate @xmath43 as it varies with its fractional occupation @xmath15 .",
    "using the trapezoidal rule for the integral , we obtain slater s approximation : @xmath101/2 , \\label{janak2}\\ ] ] where we further approximated the eigenvalue at half - filling by an average at integer occupations .",
    "for the molecules investigated here , this approximation is found to give accurate results for both the semilocal and the hybrid functional ( not shown ) .",
    "note that , in the latter case , the singularity corrections of energies and eigenvalues are compatible with the relation in eq .",
    "( [ janak2 ] ) .",
    "indeed , this approximation equally holds for corrected energies and eigenvalues as for uncorrected ones .",
    "similar considerations apply to electron removal energies .",
    "the discussion pertaining to total energy differences of finite systems ( sec.[finite ] ) applies with minor modifications to the study of localized defect states in solids . in this case , the relevant physical quantities , the charge transition levels , are also expressed as total energy differences .",
    "defect formation energies are first determined for varying electron chemical potential @xmath102:@xcite @xmath103 where @xmath104 is the total energy of the defect system carrying a charge @xmath105 , @xmath106 the total energy of the unperturbed system , @xmath107 the number of extra atoms of species @xmath73 needed to create the defect , and @xmath108 the corresponding atomic chemical potential . the chemical potential @xmath102 is referred to the valence band maximum @xmath109 .",
    "@xmath110 is a correction which is applied in order to align the local potential far away from the neutral defect to that of the unperturbed bulk.@xcite the correction @xmath111 describes the spurious interaction of the added charge with the compensating background charge.@xcite as commented in sec .",
    "[ exchange ] , the leading term of this correction pertaining to the monopole can be expressed as @xmath112 where @xmath34 is defined in eq .",
    "( [ beta3 ] ) and @xmath113 is the dielectric constant of the unperturbed bulk system . in our calculations ,",
    "this correction is applied systematically in both pbe and pbe0 calculations .",
    "charge transition levels correspond to specific values of the electron chemical potential for which two charge states have equal formation energies .",
    "for example , the charge transition level @xmath114 between two charge states @xmath105 and @xmath115 is defined by the condition @xmath116 and is thus given by the following expression : @xmath117 in this expression the dependence on the atomic chemical potentials @xmath118 drops out and the defect charge transition level is basically determined by a total energy difference between different charge states of the defect . in this sense , these quantities are counterparts of the ionization potentials and electron affinities of isolated atomic and molecular systems .",
    "the charge transition levels of localized defect states can also be obtained in a very accurate way through the energy eigenvalues by the application of janak s theorem both in pbe and in pbe0 [ eq .",
    "( [ janak2])].@xcite     vertical charge transition levels @xmath119 associated to the hydrogen bridge defect in @xmath80-crystobalite as obtained with the pbe ( left panel ) and the pbe0 ( right panel ) functionals vs number of atoms @xmath120 in the simulation cell . for pbe0 ,",
    "closed and open symbols indicate values obtained with the singularity correction turned on and off , respectively .",
    "the indicated valence and conduction band edges correspond to the converged energy eigenvalues .",
    "the energies obtained with the two functionals are aligned through the local electrostatic potential ( cf .",
    "ref .  ) .,width=321 ]    we illustrate the convergence behavior of charge transition levels for the hydrogen bridge defect ( hydrogen substitutional to oxygen ) in @xmath80-crystobalite sio@xmath84 . in particular , we focused on the vertical charge transition level @xmath119 located at approximately mid gap.@xcite we considered three different supercells in which one lateral size was varied while the other dimensions were kept fixed , i.e.  we used 2@xmath1212@xmath1212 , 2@xmath1212@xmath1213 , and 2@xmath1212@xmath1214 unit cells .",
    "such elongated cells might for instance occur when slab models are adopted .",
    "charge transition levels calculated in the pbe and in the pbe0 are shown in fig .",
    "[ fig8 ] for increasing number of atoms in the simulation cell .",
    "the results obtained with the two functionals are aligned through the local electrostatic potential , as suggested by the study in ref .. it clearly appears that the pbe and pbe0 defect levels show a similar convergence behavior , provided the singularity correction is included in the pbe0 calculation .",
    "the singularity correction is crucial to achieve this level of convergence . without the singularity correction ,",
    "the charge transition levels are clearly not converged for the range of simulation cells considered .",
    "it is clearly seen that the convergence behavior of charge transition levels of defects is analogous to that of energy transitions in finite systems ( sec .",
    "[ finite ] ) .",
    "the case in which the extra charge is carried by extended delocalized states requires special attention .",
    "let us assume an infinite solid with a energy eigenvalue spectrum @xmath122 .",
    "the energy cost of adding one electron to the previously unoccupied state @xmath43 is simply given by @xmath123 where we used janak s theorem@xcite as formulated in eq.([janak1 ] ) and the fact that energy eigenvalues in infinite solids do not depend on the occupation of the state .",
    "identical considerations also apply for electron removal energies . on this basis , it is possible to express the valence and conduction band edges in terms of total energy differences between systems of different charge : @xmath124 consequently , the energy band gap can also be obtained as @xmath125 in our notation , the tilde sign signifies that the concerned quantity is obtained from a total energy difference , as opposed to a direct derivation from the spectrum of energy eigenvalues .    in practical calculations",
    ", the supercells always have _ finite _ size , by which the band edges determined by total - energy difference differ from the actual energy eigenvalues:@xcite @xmath126 where it is understood that @xmath127 where @xmath18 is the volume of the simulation cell .",
    "similarly , we define @xmath128 where @xmath129 .",
    "-quartz calculated with the pbe ( left ) and pbe0 ( right ) functionals as total energy differences vs singularity correction @xmath80 that characterizes the simulation cell , the limit of infinite simulation cell being achieved for vanishing @xmath80 . for pbe0 ,",
    "closed and open symbols indicate values obtained with the singularity correction turned on and off , respectively .",
    "the energies obtained with the functionals are aligned as in fig .",
    "[ fig5].,width=321 ]    we first focus on results obtained with the semilocal density functional . for illustration",
    ", we considered @xmath73-quartz sio@xmath84 and used simulation cells of varying size . in fig .",
    "[ fig9 ] , we report the band edges calculated using the total energy differences given in eqs .",
    "( [ janak4 ] ) and ( [ janak5 ] ) , and compare them with the converged energy eigenvalues . for the simulation cells considered here ,",
    "the band edges obtained in the two different ways are essentially identical , i.e.@xmath130 and @xmath131 .",
    "figure [ fig9 ] also shows corresponding results obtained with hybrid functionals .",
    "in contrast to the behavior found for semilocal functionals , we now encounter a much slower convergence . in other words , in hybrid functional calculations , @xmath132 and @xmath133 are significantly larger than in semilocal density functional calculations performed with the same simulation cells .",
    "therefore , we infer that this behavior should be ascribed to the singular behavior of the exchange interaction .",
    "-quartz evaluated through total energy differences ( @xmath134 , @xmath135 ) and as energy eigenvalues ( @xmath136 , @xmath137 ) in the pbe ( left panel ) , ( b ) in the pbe0 with singularity turned off ( middle panel ) , and ( c ) in the pbe0 with the singularity correction turned on ( right panel ) .",
    "the results are plotted against the singularity correction @xmath80 . in the right panel ,",
    "the dashed lines correspond to @xmath138 and @xmath139.,width=321 ]    in order to understand this behavior , we reason as follows .",
    "the relations given by eqs .",
    "( [ janak6 ] ) and ( [ janak7 ] ) follow from the janak theorem and apply to any analytical functional .",
    "therefore , they also apply to a case functional which is specific to a given simulation cell and a given basis set .",
    "we further define the case functional by setting the @xmath29 component of the exchange potential to zero , which corresponds to the label `` uncorr '' introduced earlier . for this case",
    "functional , @xmath132 and @xmath133 are expected to behave in a similar way as for a semilocal functional .",
    "hence , for simulation cells large enough to yield vanishing @xmath132 and @xmath133 with the semilocal functional , we similarly expect vanishing @xmath140 and @xmath141 .",
    "this implies @xmath142 as shown in the first two panels in fig .",
    "[ fig10 ] , this behavior is numerically confirmed for our case study of @xmath73-quartz .",
    "using the relationship between corrected and uncorrected quantities determined in eqs .",
    "( [ corr_eigen ] ) and ( [ corr_en ] ) , we then derive : @xmath143 in other words , hybrid functional calculations in finite simulation cells give @xmath144 this result is graphically illustrated for @xmath73-quartz in the third - column panels of fig .",
    "[ fig10 ] . for the band gap ,",
    "this implies : @xmath145    we note that the remaining dependence of both @xmath146 and @xmath147 on @xmath80 does not result from the integration of the singularity , since the results in the third panel in fig .",
    "[ fig10 ] already refer to `` corrected '' results .",
    "the remaining differences rather originate from the exchange selfinteraction associated to the extra charge , which vanishes slowly with increasing simulation cell .",
    "hence , this behavior is not specific to the use of plane - wave basis sets and should also manifest in implementations based on other basis functions .",
    "point sampling : as energy eigenvalues ( a ) with and ( b ) without accounting for the singularity correction and through total energy differences ( c ) with and ( d ) without singularity correction .",
    "the result in ( a ) shows the fastest convergence with simulation cell.,width=321 ]    our findings concerning the energy eigenvalues are schematically illustrated in fig .",
    "[ fig11 ] .",
    "the scheme refers to a case in which all quantities would already be converged with simulation cell size , if it were not for the occurrence of exact exchange .",
    "figure [ fig11](a ) refers to the corrected energy eigenvalues and corresponds to the converged result .",
    "figure [ fig11](b ) shows the eigenvalues in the `` uncorrected '' case .",
    "the singularity correction shifts the occupied states downwards by @xmath80 , leaving the unoccupied ones unaffected .",
    "figure [ fig11](c ) refers to the determination of band edges through the use of total - energy differences .",
    "it is seen that the band edges obtained in this way still differ from the converged levels , despite the use of `` corrected '' quantities .",
    "the valence band edge is overestimated by @xmath148 , whereas the conduction band edge is underestimated by @xmath148 .",
    "consequently , the band gap is underestimated by @xmath80 through this approach .",
    "figure [ fig11](d ) also refers to band edges obtained through total energy differences but without including the singularity correction .",
    "one obtains the same result as in fig .",
    "[ fig11](b ) , illustrating thereby that the integration of the singularity in the exchange term is responsible for the slow convergence of the band edges calculated by total - energy differences .",
    "in this work , we investigated the use of hybrid functionals in plane - wave implementations , in comparison with semilocal density functionals . the main objective consisted in determining whether a hybrid functional calculation requires a @xmath0-point sampling of increased density in order to properly integrate the singularity appearing in the exact nonlocal exchange energy .",
    "this issue is of particular importance when dealing with large simulation cells , where an excessive increase of the @xmath0-point sampling would make the calculation computationally prohibitive .",
    "typical applications include surface , interface , and defect calculations , but also molecular dynamics simulations .",
    "to treat the divergence , we adopted a formulation which consists in transforming the integrand into a regular function through the use of an auxiliary function that can be integrated analytically.@xcite through the use of an appropriate auxiliary function,@xcite this formulation can trivially be extended to calculations with large simulation cells and low - density @xmath0-point samplings . in the case of @xmath1-point sampling",
    ", the sampling of reciprocal space is achieved through the reciprocal lattice vectors , which densify as the simulation cell grows .",
    "we further used a formulation which recasts the treatment of the divergence in the form of singularity correction terms.@xcite these terms intervene in the total energy and in the energy eigenvalues of the occupied states .    in the present investigation",
    ", we found it convenient to distinguish finite and extended systems , localized and delocalized states , and neutral and charged calculations .",
    "the general conclusion is that the same @xmath0-point samplings used in semilocal density functional calculations yield a comparable level of convergence in hybrid functional calculations , provided the singularity corrections are accounted for .",
    "however , our study highlights a few points that deserve special attention .",
    "the first point concerns the treatment of screened exchange .",
    "while screened exchange does not show any singularity , it is nevertheless recommended to adopt the proposed scheme also in this case in order to achieve the same convergence properties as achieved with semilocal density functionals .",
    "the second noteworthy point concerns applications in which the sampling in reciprocal space around the divergence is anisotropic .",
    "this is for instance the case for calculations with elongated simulation cells and @xmath1-point samplings , as often occurs in the study of surfaces and interfaces . in such cases ,",
    "the singularity correction terms are critical for achieving not only well converged properties but also a qualitatively correct behavior .    the final point that deserves attention and which is unusual with respect to ordinary semilocal density functional calculations concerns the determination of band edges and band gaps of extended systems through total energy differences .",
    "our study shows that band edges determined in this way converge slower in hybrid functional calculations because of the exchange selfinteraction associated to the extra charge .",
    "this convergence problem arises for delocalized states but does not occur for localized states of point defects or of finite molecular systems .    in conclusion",
    ", the correct treatment of the singularity can be achieved without requiring any significant computational overhead .",
    "this opens the way for using hybrid functionals in very much the same way as ordinary semilocal functionals . to date , the scheme described in this work has already led to several successful applications including studies of amorphous systems,@xcite defects , and interfaces .",
    "we thank s.  de gironcoli and j.  hutter for fruitful interactions .",
    "support is acknowledged from the swiss national science foundation ( grants nos .  200020 - 111747 and 200020 - 119733 ) .",
    "calculations were performed on the bluegene computer at epfl and on computer facilities at csea - epfl and cscs .",
    "r. car and m. parrinello , phys .",
    ". lett . * 55 * , 2471 ( 1985 ) ; j. hutter and a. curioni , chemphyschem * 6 * , 1788 ( 2005 ) ; cpmd , copyright ibm corp 1990 - 2006 , copyright mpi fr festkrperforschung stuttgart 1997 - 2001 ."
  ],
  "abstract_text": [
    "<S> when described through a plane - wave basis set , the inclusion of exact nonlocal exchange in hybrid functionals gives rise to a singularity , which slows down the convergence with the density of sampled @xmath0 points in reciprocal space . in this work , we investigate to what extent the treatment of the singularity through the use of an auxiliary function is effective for @xmath0-point samplings of limited density , in comparison to analogous calculations performed with semilocal density functionals . </S>",
    "<S> our analysis applies for instance to calculations in which the brillouin zone is sampled at the sole @xmath1-point , as often occurs in the study of surfaces , interfaces , and defects or in molecular dynamics simulations . in the adopted formulation , the treatment of the singularity results in the addition of a correction term to the total energy . </S>",
    "<S> the energy eigenvalue spectrum is affected by a downwards shift of the energy eigenvalues of the occupied states , while those of the unoccupied states remain unaffected . </S>",
    "<S> analogous corrections also speed up the convergence of screened exchange interactions despite the absence of a proper singularity . </S>",
    "<S> focusing first on neutral systems , both finite and extended , we show that the account of the singularity corrections bears convergence properties which are quantitatively similar to those observed with semilocal density functionals . </S>",
    "<S> we emphasize that this is not the case for uncorrected energies , particularly for elongated simulation cells for which qualitatively different trends are found . </S>",
    "<S> we then consider differences between total energies of systems differing by their charge state . for systems involving localized electron states , such as ionization potentials and electron affinities of molecular systems or </S>",
    "<S> charge transition levels of point defects , the proper account of the singularity correction yields convergence properties which are similar to those of neutral systems . in the case of extended systems , </S>",
    "<S> such energy differences provide an alternative way to determine the band edges , but are found to converge more slowly with simulation cell than in corresponding semilocal functionals because of the exchange selfinteraction associated to the extra charge . </S>"
  ]
}