{
  "article_text": [
    "radiative transfer in three dimensional space is a seven - dimensional problem : three spatial dimensions , two angular dimensions , one frequency dimension plus the time dimension . as a result , although the basic physics involved is well understood , a direct computation of radiative transfer in three dimensional space is prohibitively costly .",
    "however , radiation field is known to play a very important role in determining the ionizational and thermodynamic state of the cosmic gas .",
    "rudimentary treatments of radiative transfer from assuming a uniform radiation field ( e.g. , cen & ostriker 1993 ) to using the somewhat improved method with local optical depth approximation ( gnedin & ostriker 1997 ; cen & ostriker 1999 ) have afforded the breakthrough computations of the optically thin regions of the ly@xmath4 forest with notable successes ( cen et al .",
    "1994 ; zhang et al .  1995 ; miralda - escud et al .  1996 ; hernquist et al .",
    "nevertheless , fluctuations in the ionizing radiation field are expected to exist even in the optically thin regions , since the radiation sources ( galaxies and quasars ) as well as density fields are known to be significantly clustered at all times . turning away from optical thin regions ,",
    "one is faced with transitional regions of optical depth of order unity and optical thick regions largely shielded from external radiation .",
    "moreover , radiation sources themselves most likely reside in dense , at least partially shielded regions often with complicated structures and geometries .",
    "for all these regions a proper treatment of radiative transfer is clearly demanded .",
    "the predictive power of any theory of galaxy and structure formation , especially with respect to the cosmological reionization , the formation and evolution of ly@xmath4 forest , damped ly@xmath4 systems and galaxies / stars , is fundamentally limited until one can accurately treat this essential process of radiative transfer .",
    "significant progress has been made in recent years in developing practical algorithms for radiative transfer in cosmological applications .",
    "most of the effort has largely been concentrated on two types of approaches : the ray tracing approach ( abel et al .",
    "1999 ; rozoumov & scott 1999 ; kessel - deynet & burkert 2000 ) and moment equations approach ( stone , mihalas & norman 1992 for two dimensional space ; norman , paschos , & abel 1998 ; gnedin & abel 2001 ) .",
    "several monte carlo methods have also been explored ( sokasian et al .",
    "2001 ; ciardi et al .",
    "the primary limitation of the ray tracing algorithm is its intrinsic high cost to follow a large number of radiation sources .",
    "the moment equations approach condenses the intrinsic difficulty of treating long range radiation propagation out as the eddington tensor .",
    "the problem then boils down to evaluating the eddington tensor accurately and efficiently .",
    "the recent suggestion by gnedin & abel ( 2001 ) of computing the eddington tensor by ignoring optical depth is novel and clearly worth being explored further .    in this paper",
    "we develop an entirely new algorithm for transferring radiation in three dimensional space .",
    "in essence , this algorithm computes the optical depth between any pair of points and the source function for each point using convolution techniques .",
    "the angular discretization is performed at the receiving site , rather than at the source site as in the normal ray tracing scheme , which guarantees coverage of all space regardless of the fineness of the angular discretization .",
    "the overall scaling of the cost with this algorithm is @xmath0 . unlike conventional ray casting schemes ,",
    "the computational cost with the present algorithm is independent of the number of sources , suitable for problems encountered in cosmological simulations where a large number of direct , ionizing sources ( e.g. , small galaxies ) as well as secondary , processed ionizing sources ( e.g. , scattered photons , recombination photons ) are present .",
    "this paper is organized as follows . in ",
    "2 we describe the basic algorithm . in ",
    "3 we present a battery of tests to show that the present algorithm is accurate .",
    "discussion and conclusions are given in  4 .",
    "in the rest frame of a bundle of photons the equation of radiation transfer for those photons ( spitzer 1980 ) is :    @xmath5    where @xmath6 is the path length and @xmath7 is the specific intensity with @xmath8 being the energy during a time interval @xmath9 passing through an area @xmath10 about a spatial point @xmath11 , within a frequency interval @xmath12 , within the solid angle @xmath13 about @xmath14 ; @xmath15 and @xmath16 are the opacity and emissivity at @xmath11 at time @xmath17",
    ". we can integrate equation ( 1 ) and write it in an integral form for the specific flux @xmath18 defined as    @xmath19    at position @xmath11 and time @xmath17 :    @xmath20    where @xmath21 is the emissivity at distance @xmath6 from position @xmath11 in the direction @xmath14 ( an unit vector ) at time @xmath17 ; the two integrals are over path length and solid angle , respectively ; @xmath22 is the optical depth from position @xmath11 to position @xmath23 at time @xmath17 :    @xmath24    where @xmath25 is the opacity at distance @xmath6 from position @xmath11 in the direction @xmath14 at time @xmath17 .",
    "the implicit principal assumption that has been made to derive equation ( 3 ) is that the speed of light is infinity , analogous to the conventional treatment of gravitational interactions .",
    "although this assumption may not be necessary , it makes implementation of this method especially simple and we adopt it .",
    "this assumption is generally excellent for cosmological simulations , where light crossing time over a simulation box is indeed much smaller than the typical hydrodynamic time step .",
    "it should , however , be noted that this assumption does not impose any practical restrictions on the propagation speed of ionization fronts .",
    "equation ( 3 ) may be discretized in the following form :    @xmath26    where the two sums are over the ray path ( assuming to be a straight line ) and the solid angle , respectively , and the source term @xmath27 is defined as    @xmath28    with @xmath29 being the discretization volume element about position @xmath23 and @xmath30 is the mean emissivity over @xmath29 .",
    "the problem now translates to the evaluation of the two terms on the right hand side in equation ( 5 ) , @xmath31 and @xmath32 .",
    "this is the core of the overall computation and how it is computed determines the effectiveness and accuracy of the algorithm .",
    "we propose to evaluate these two terms in a novel way .    to proceed further we will now choose the spherical coordinate system for the radiation field about @xmath11 , under which we will discretize the angular and radial dimensions in a spherically symmetric fashion .",
    "this is to say , one can always find a pair of equal volume elements ( of arbitrary domain shape ) one about point @xmath11 and the other point @xmath33 related by    @xmath34    where @xmath35 is the radial distance from @xmath11 along a radial direction @xmath14 or @xmath36 .",
    "for every vector @xmath37 that lies in @xmath38 , one can find an opposite vector ( about @xmath11 ) @xmath39 that lies in @xmath40 .",
    "this property will be essential in our implementation of the computation of the two terms in equation ( 5 ) .",
    "let us rewrite the source term @xmath27 in equation ( 6 ) as    @xmath41    where the integration domain is the volume element @xmath42 about position @xmath43 .",
    "it is now time to make a simple but algorithmically essential modification of equation ( 8) by inserting a window function in the integral :    @xmath44    where @xmath45 is a window function about the origin @xmath11 with the following property : @xmath46 note that the integral in equation ( 9 ) is now over the entire space about @xmath11 .",
    "the reader is then asked to make the following critical observation : for each window function @xmath45 there is another window function @xmath47 , which is spherically symmetrically paired with it , i.e. , @xmath48    as indicated by equation ( 7 ) . replacing @xmath45 with @xmath49 in equation ( 9 ) gives ,    @xmath50    changing integration variable from @xmath51 to @xmath52 equation ( 12 ) becomes    @xmath53    the integration domain is still over the entire space but the window function @xmath54 now has a moving origin @xmath11 . equation ( 13 ) is of the standard convolution form and can be efficiently evaluated for all points @xmath11 simultaneously using the fast fourier transform ( fft ) techniques , as the fourier transforms are related by    @xmath55    where @xmath56 , @xmath57 and @xmath58 are fourier transforms of @xmath27 , @xmath59 and @xmath60 , respectively .",
    "the same formulation can be constructed for the optical depth @xmath61 .",
    "here we instead compute the mean opacity of each volume element    @xmath62    using the same technique .",
    "then we integrate @xmath63 radially along @xmath14 in real space to obtain @xmath61 .",
    "@xmath64    using the fft method , @xmath65 ( equation 13 ) and @xmath66 ( equation 15 ) for all grid points of a simulation box with respect to all other points in the simulation box can be evaluated simultaneously with the total cost scaling as @xmath67 , where @xmath1 is the total number of grid points , @xmath68 is the number of radial bins along each cone and @xmath69 is the number of angular discretization elements .",
    "the choice of @xmath68 and how to discretize the radial direction may be problem dependent .",
    "it is , however , illuminating to note that both radiation flux and gravitational force follow the same inverse square law .",
    "it is also noted that the effect due to optical depth attenuation tends to relatively suppress the contribution from distant sources .",
    "thus , one may conservatively apply some of the techniques and ideas used in gravitational tree codes ( barnes & hut 1986 ) .",
    "specifically , one can more coarsely sample more distant regions to discretize the radial direction , the simplest of which would result in @xmath70 .",
    "the choice of @xmath69 requires some experiments .",
    "we note that , in the present algorithm , any coarse level of angular discretization guarantees that all sources inside the simulation box are covered .",
    "this property is in contrast with the conventional ray casting scheme , where a large number of rays from a source is necessary in order to intersect every cell in the simulation box at least once .",
    "the primary operational difference is that in the present algorithm the operation is  gathering \" flux by the receiving region under consideration , whereas in the ray casting method the operation is  broadcasting \" flux to each receiving region .",
    "testing shows that @xmath71 to cover the full solid angle @xmath72 appears adequate .",
    "combining the three scaling factors gives the total number of operations for evaluating @xmath27 or @xmath73 for all grid points at each time step :    @xmath74    where @xmath75 is the normal prefactor of the fft operation .",
    "note that the algorithm presented here has the desired property that its computational cost is independent of the number of radiation sources . as a matter of fact ,",
    "each grid point is treated as both a source and sink .",
    "this property allows us to compute problems where a large number of radiation sources are present .",
    "examples include reionization of the universe by sub - galactic galaxies and radiation field where diffuse sources such as recombination photons and scattered photons contribute significantly .",
    "we will now implement the algorithm in a three - dimensional simulation box with a uniform mesh for hydrodynamic variables and periodic boundary conditions for both hydro quantities and radiation field .",
    "two separate coordinate systems and two correspondingly separate grids are in use now : the cartesian coordinate system for the hydrodynamic quantities with a uniform cartesian grid and the spherical coordinate system for the radiation field about each hydro grid point with a spherical grid . the angular discretization about each hydro grid point is made uniformly across the solid angle @xmath72 with @xmath69 elements each having a full solid angle of @xmath76 .",
    "the radial discretization is performed using @xmath68 bins from @xmath77 to @xmath78 spaced uniformly in logarithm maximizing the shape of each volume element as a cube , where @xmath79 is the simulation box size .",
    "the @xmath80 window functions ( i.e. , @xmath60 in equations 13,15 ) for each discretized element of the radiation grid in the spherical coordinates are computed once initially and their fourier transforms are stored and used for all subsequent time steps .",
    "so far we have operated in a static coordinate system . in cosmological applications",
    "one needs to take into account the cosmological effects .",
    "we will separate the overall radiation field into two parts : 1 ) radiation flux due to sources within the simulation box , and 2 ) external radiation flux .",
    "as long as the simulation box is much smaller than the hubble radius , this division allows us to split these two kinds of sources cleanly in the simple fashion : radiation flux from ( 1 ) is treated as local , which is not affected by cosmic expansion , and radiation flux from ( 2 ) is diffuse and subject to the cosmological effects .",
    "the two kinds of radiation fields are related and computed in a self - consistent way .",
    "we keep track of radiation that leaves the simulation box and add it to the diffuse background ( see below ) and every point in the simulation box is subject to the diffuse background with self - consistently computed attenuation .",
    "thus , the total flux at any point inside the simulation box is    @xmath81    where @xmath82 is the contribution from sources inside the simulation box in equation ( 3 ) and @xmath83 is the contribution from the diffuse background related to the specific intensity of the diffuse background at time @xmath17 , @xmath84 :    @xmath85    where the integral or the sum is over the solid angle about position @xmath11 ; @xmath86 is total optical depth along the cone about @xmath14 from position @xmath11 to a distance of @xmath87 at time @xmath17 ( @xmath87 is the upper radius of that cone given the constraint that the simulation box is periodic ; @xmath87 is orientation - dependent because the hydro simulation box is not spherical about each grid point for the radiation field ; the range for @xmath87 is @xmath88 ) .",
    "the evolution of the specific intensity of the diffuse background , @xmath84 , is governed ( cen & ostriker 1993 ) by    @xmath89 + c s_{\\nu , in}(t ) + c s_{\\nu , ext}(t ) - c\\bar\\kappa_{\\nu , diff}(t ) i_{\\nu , diff}(t),\\ ] ]    where @xmath90 is the hubble constant , @xmath91 is the speed of light and the mean opacity @xmath92 at time @xmath17 is determined self - consistently by averaging the opacities in the simulation box properly taking into account optical shielding effect :    @xmath93    where the outer sum is over all @xmath1 grid points of the simulation box each having an opacity @xmath94 and inner sum is over the @xmath69 solid angles about each point .",
    "the term on the right hand side of equation ( 20 ) due to sources inside the simulation box is @xmath95 , which may be computed from emissivity @xmath96 of each hydro grid point of the simulation box :    @xmath97    this is the radiation due to internal sources that leaves the simulation box .",
    "there may be additional sources to the diffuse background .",
    "for example , one may wish to take into account rare sources such as quasars that are outside the simulation box .",
    "this can be achieved by simply adding the needed terms as @xmath98 .",
    "the formulation of equation ( 15 ) deserves more discussion .",
    "the integration over the domain @xmath99 is effectively collapsing the angular dimensions to lump together absorbing material into a radial  line \" of length @xmath100 for that volume element .",
    "this could cause an overestimate of opacity for radiation sources that are located inside the same volume element or behind the considered volume element but are spatially displaced perpendicular to the line of sight with respect to the absorbing material . in a more extreme example",
    ", a handful of cells of very high optical depth may totally block out radiation downstream , if the mean optical depth is evaluated by linearly averaging optical depth spatially .",
    "we propose to modify the original formulation ( equation 15 ) as follows .",
    "@xmath101    and @xmath102    where @xmath103 is the size of a hydro cell .",
    "this modified formulation is in some sense like averaging the flux instead of the optical depth .",
    "this physically motivated modification quite successfully circumvents the forementioned possible problems in realistic situations , as subsequent tests will show ( see  3 ) .",
    "we adopt this particular scheme to present quantitative results in the next section (  3 ) .",
    "we note that in the case of a uniform opacity equation ( 15 ) and equations ( 23,24 ) would yield identical results .",
    "let us briefly summarize the salient features of the proposed algorithm .",
    "what we have shown is that the algorithm is _ fast _ , scaling as @xmath0 , where @xmath1 is the number of grid points in a simulation box , independent of the number of radiation sources . given that computation does not involve any differentiation and all computed integrals are guaranteed to converge in all situations , the algorithm is completely _ stable and robust_. we emphasize that the proposed algorithm , by design , guarantees that flux propagates in the _ right direction _ in any situation .",
    "the tests presented in the next section will show that the amplitude of flux is also computed with very small errors , indicating that the algorithm is also _",
    "we will present a suite of tests , which are intended to have significant bearings on cosmological applications .",
    "we will show that the method performs very well in all tested situations .",
    "clearly , fine tuning of the scheme is worth exploring and is deferred for future work .    for the tests shown we use a @xmath104 cartesian grid with periodic boundary conditions .",
    "we use @xmath105 uniformly spaced angular bin and @xmath106 logarithmically spaced radial bins for all cases . for the tests shown we do not include cosmological affects ; i.e. , @xmath90 is set to zero .",
    "but the accuracy of the algorithm should not be affected by this simplification .",
    "it is guaranteed that the proposed formalism will give the correct flux distribution in the case of no optical attenuation .",
    "the simplest non - trivial test then is a source embedded in a static , uniform , non - zero opacity distribution .",
    "the flux distribution about a single source is then    @xmath107    where @xmath79 is the luminosity of the source ; @xmath35 is source - centric radius ; @xmath108 is the opacity .",
    "figure [ static ] shows the flux distribution in the x - y plane with @xmath109 , where the luminous source is located at cell @xmath110 and the opacity per cell is @xmath111",
    ". the solid contours nearly overlap with the analytic expectations ( dashed contours ) with some slight deformations from sphericity simply due to the nature of the cartesian grid .",
    "clearly , the computed flux is accurate .",
    "since the equation for the flux is linear with respect to the source luminosity , the method would obviously yield results of the same accuracy for any number of distributed sources .",
    "the next step is to test a non - spherical static opacity distribution .",
    "an axisymmetric elliptical distribution of opacity of the following form is tested :    @xmath112    where @xmath113 is the angle with respect to the positive @xmath114 direction , and @xmath91 and @xmath115 are the normalization and the ellipticity parameter of the distribution , respectively ; @xmath116 at @xmath117 and @xmath118 at @xmath119 .",
    "figure [ ellip ] shows the computed flux distribution ( solid contours ) in the x - z plane with @xmath120 compared to the analytic result ( dashed contours ) .",
    "we use @xmath121 and @xmath122 ( see equation 26 ) for this illustration .",
    "we see that the results are quite satisfactory given the cartesian grid .",
    "the agreement with the analytic result is very good except near @xmath117 where the opacity is the highest and a maximum error of 2 cells is made there .",
    "this is caused by a slight underestimate of the optical depth there , due to the averaging scheme of optical depth as indicated by equations ( 23,24 ) .",
    "we have also tested similar cases by varying either the opacity @xmath91 or ellipticity parameter @xmath115 ( see equation 26 ) and find that the results have similar accuracies .",
    "we now switch to a higher gear to test the algorithm in a situation where the distribution of opacity changes self - consistently with time due to ionization . for this and",
    "subsequent tests we monitor photon number conservation by computing    @xmath123    where @xmath124 is the number of free electrons created by time @xmath17 ( assuming 100% hydrogen ) in the simulation box and @xmath125 is the number of photons in the diffuse background in the simulation box volume at time @xmath17 and @xmath126 is the total number of photons emitted by time @xmath17 by sources in the simulation box .",
    "if photon number conservation is strictly observed , @xmath127 would be unity .",
    "in all the following tests recombination time is set to infinity to make the problem simple to track .",
    "but the accuracy of the method is unchanged by this simplification .",
    "we start with the case of a uniform neutral medium , consisting entirely of hydrogen atoms .",
    "an ionizing source of ionizing luminosity @xmath128 photon / sec is placed at cell @xmath110 .",
    "the ionizing photons from the source ionize the neutral medium outward and the radius of the ionization front , the surface that separates the interior ionized medium from the exterior neutral medium , evolves with time approximately as :    @xmath129    where @xmath130 is the number density of the neutral hydrogen and @xmath17 is the elapsed time .",
    "the reason that this formula ( 26 ) is only approximate is that some photons may penetrate further out ahead of the ionization front , if the optical depth per cell is not sufficiently high , and then the  front \" is no longer well defined ; the formula would be highly accurate for a high opacity distribution .",
    "the optical depth per cell is @xmath131 , where the hydrogen photo - ionization cross section @xmath132@xmath133 is used throughout and @xmath134 is the cell size .",
    "thus , for the present test , the optical depth per cell is very large and formula ( 26 ) should be very accurate .",
    "figure [ rhon0 ] shows the contours of the neutral hydrogen fraction in the x - y plane with @xmath109 at four epochs .",
    "we use @xmath135photon / sec , @xmath136@xmath137 and cell size of @xmath138kpc .",
    "the adopted gas density is about 15 times the mean gas density at redshift @xmath139 .",
    "we see that the agreement between the computed results and analytic expectations is excellent at all times .",
    "the discrepancy on the radius of the ionization front is evidently no larger than one cell .",
    "given the approximations that have been made in the implementation , especially with respect to the computation of mean opacity ( equations 21,22 ) , it is unclear how well the algorithm conserves photons .",
    "figure [ rhon0err ] shows the degree of conservation of photons as a function of time .",
    "it is seen that , except for the first 8 time steps , the number of photons is conserved at better than @xmath140 with the average at about @xmath141 .",
    "timesteps of @xmath142yrs are used but the results are insensitive to the timestep ; using a timestep 3 times larger yield very similar results except for the upper left corner panel at the beginning of the simulation . note that the age of the universe at @xmath139 is about @xmath143yrs .",
    "the indicated convergence of results at this relatively large size of timesteps is clearly advantageous .",
    "next , we examine a case of a source sitting in a spherical density distribution , @xmath145@xmath137 ; the central cell at @xmath77 is set to a density equal to @xmath146 , where @xmath134 is the cell size .",
    "this density profile is close to that in the central regions of dark matter halos ( navarro , frenk , & white 1997 ) and is of significant cosmological relevance .",
    "the expected evolution of the radius of the ionization front is approximately :    @xmath147    where the second ( correction ) term inside the square root is due to the non - singular core of the modified @xmath144 density distribution .",
    "the optical depth per cell as a function of source - centric radius is @xmath148 .",
    "therefore , for the adopted values of @xmath149 , @xmath150 and @xmath134 ( see below ) , the formula will be very accurate over the range of radii examined and the thickness of the ionization front should be thin and close to one cell .",
    "figure [ rhon1 ] shows the contours of the neutral hydrogen fraction in the x - y plane with @xmath109 at four epochs .",
    "we use @xmath135photon / sec , @xmath151@xmath137 , @xmath152kpc and cell size of @xmath138kpc . note that the adopted @xmath150 is approximately @xmath153 times the mean gas density at @xmath139 .",
    "timestep used is @xmath142yrs but the results are insensitive to the timestep . from figure [ rhon1 ]",
    "it is seen that the agreement between the computed results and analytic expectations is excellent at all times and the discrepancy on the radius of the ionization front is no larger than one cell .",
    "figure [ rhon1err ] presents the degree of conservation of photons as a function of time , showing that the number of photons is conserved at better than @xmath154 with the average at about @xmath141 in this case .",
    "we turn to a steeper density distribution , @xmath156@xmath137 ; the central cell at @xmath77 is set to a density equal to @xmath146 , where @xmath134 is the cell size .",
    "the density profile is close to that of halos just interior of the virial radius ( e.g. , tyson , kochanski , & dellantonio 1998 ) .",
    "the expected evolution of the radius of the ionization front is approximately : @xmath157    where the second term on the right hand side is due to the non - singular core imposed on the density profile .",
    "figure [ rhon2 ] shows the contours of the neutral hydrogen fraction in the x - y plane with @xmath109 .",
    "we use @xmath135photon / sec , @xmath151@xmath137 , @xmath152kpc and cell size of @xmath138kpc at four epochs .",
    "timestep used is @xmath142yrs but like in other cases the results are insensitive to the timestep .",
    "the computed results and analytic expectations agree very well at all times .",
    "for the adopted values of @xmath150 , @xmath149 and @xmath134 , the optical depth per cell as a function of source - centric radius is @xmath158 shown in figure [ rhon2tau ] ; we have @xmath159 for @xmath160cells .",
    "thus , the computed shell of the ionization front will be somewhat broadened at late times due to a deeper penetration of ionizing photons outward of the ionization front , clearly evident in figure [ rhon2 ] .",
    "figure [ rhon2err ] shows that the number of photons is conserved at better than @xmath161 with the average at about @xmath162 for this case .      in realistic situations a source may sit inside a gas cloud that may not be spherical .",
    "we examine an elliptical isothermal distribution with the following density distribution    @xmath163    where @xmath113 is the angle with respect to the positive @xmath114 direction , and @xmath115 indicates the ellipticity of the distribution .",
    "the central cell at @xmath77 is designed not to be singular but has a density equal to @xmath146 , where @xmath134 is the cell size .",
    "the expected , orientation - dependent evolution of the radius of the ionization front follows equation ( 30 ) .",
    "figure [ ellipn2 ] shows the contours of the neutral hydrogen fraction in the x - z plane with @xmath120 at four epochs .",
    "we use @xmath135photon / sec , @xmath151@xmath137 , @xmath152kpc and cell size of @xmath138kpc .",
    "timestep used is @xmath164yrs but the results are insensitive to the timestep .",
    "it is seen that the algorithm handles the anisotropic density distribution quite well and the agreement between the computed results and analytic expectations is very good at all times , with the computed ionization  fronts \" tracing out the analytic results quite nicely with an error no larger than about one cell .",
    "the thickening of the computed  fronts \" is real due to penetration of photons .",
    "figure [ ellipn2err ] shows the degree of conservation of photons .",
    "it is seen that the number of photons is conserved at better than @xmath161 with the average at about @xmath162 .",
    "so far we have examined several different cases with smooth density distributions .",
    "it is prudent to test the algorithm in a more challenging situation .",
    "we pick a case where there are two different density fields separated by a sharp boundary .",
    "an axisymmetric density field is prescribed as @xmath165    the source sits at cell @xmath110 .",
    "the expected evolution of the radius of the ionization front follows equation ( 28 ) for each of the two domains with different speeds of the ionization fronts .",
    "figure [ ani ] shows the contours of the neutral hydrogen fraction in the x - z plane with @xmath120 at four epochs .",
    "we use @xmath135photon / sec , @xmath152kpc and cell size of @xmath138kpc .",
    "timestep used is @xmath166yrs but the results are insensitive to the timestep .",
    "the agreement between the computed results and the analytic results are surprisingly good with the radius of the ionization front accurate to about one cell . at the boundaries separating the two regions",
    "there is a slight over - shielding on the low density side affected by the high optical depth , high density side .",
    "the width of this  affected \" region is limited by the size of the solid angle of each discretized angular element , which in the present case is about @xmath167 square degrees .",
    "figure [ anierr ] shows the degree of conservation of photons , indicating that the number of photons is conserved at better than @xmath154 with the average at about @xmath3 .      up to",
    "now we have tested cases with a single radiation source .",
    "it is important that the algorithm is capable of handling interactions of multiple radiation sources through the process of percolation , a process that is thought to occur during the cosmological reionization .",
    "we will demonstrate this by studying the situation where there are two sources of unequal luminosities .",
    "the two sources with luminosities @xmath135photon / sec , and @xmath168photon / sec , respectively , sit in a uniform neutral medium of density @xmath136@xmath137 initially .",
    "a cell size of @xmath169kpc is used for the simulation box .",
    "the two sources are located at cell ( 23,16,16 ) and cell ( 13,16,16 ) with a separation of 10 cells ( i.e. , @xmath170kpc ) .",
    "timestep used is @xmath142yrs but the results are insensitive to the size of the timestep .",
    "prior to the overlap of the two hii regions produced by the two sources separately , the evolution of each hii region is separate and the evolution of the radii of the ionization fronts follows equation ( 28 ) .",
    "subsequent to the overlap their combined hii region will continue to expand but an analytic solution is not readily available .",
    "figure [ 2gal ] shows the contours of the neutral hydrogen fraction in the x - y plane with @xmath109 at four epochs .",
    "it is clear that the algorithm nicely treats the two separate regions without any interference before the overlap , with the two separate ionization fronts traveling at the correct speeds . for the post - overlap era",
    "we only show the analytic solution as if overlap has not occurred for the sole purpose of guiding the reader s eye .",
    "the evolution of the ionization front in the post - overlap era is more complicated but the computed results appear to be quite reasonable , with the overlapped region continuing to expand and becoming rounder with time . in this case , one is more keen to check if the total number of photons is conserved",
    ". figure [ 2galerr ] shows the degree of conservation of photons .",
    "it is seen the number of photons is conserved at better than @xmath171 with the average at about @xmath172 .",
    "let us make the situation a bit more interesting .",
    "we will add two more sources to the case tested in  3.8 .",
    "the two additional sources have luminosities",
    "@xmath173photon / sec , and @xmath174photon / sec , sitting at cells ( 20,8,16 ) and ( 8,24,16 ) but turned on with lags of @xmath175yrs and @xmath176yrs ( relative to the turn - on time of the initial two sources ) , respectively .",
    "figure [ 4gal ] shows the contours of the neutral hydrogen fraction in the x - y plane with @xmath109 at four epochs . for the post - overlap era",
    "we only show the analytic solution as if overlap has not occurred for the sake of illustration .",
    "we see that the algorithm follows the separate hii regions , as expected",
    ". continuous formation of galaxies in time can evidently be properly followed .",
    "subsequent mergers of hii regions occur as expected .",
    "figure [ 4galerr ] shows the degree of conservation of photons .",
    "it is seen the number of photons is conserved at better than @xmath171 with the average at about @xmath177 .",
    "the evolution of the ionization front in the post - overlap era is very complicated but the computed results look reasonable , with the overlapped region continuing to expand in a fashion that is expected .",
    "the fact that photon number is well conserved and flux is designed to travel in the right direction ensures that the computed results should be accurate .",
    "we will now step back to a case with a single source .",
    "but we will include in the uniform density field a dense gas cloud , which is designed to be optically thick to cast a shadow in the direction of radiation propagation .",
    "it is expected that shadowing should be common in the real universe since galaxies and other dense clouds ( such as damped lyman alpha systems ) are ( at least partially ) opaque to radiation .",
    "a spherical gas cloud of radius @xmath178kpc with a density distribution of @xmath179@xmath137 is centered at cell @xmath180 .",
    "the rest of the simulation box has a uniform density of @xmath181@xmath137 .",
    "the ionizing source is located at cell ( 16,16,16 ) with a luminosity of @xmath182sec@xmath183 .",
    "a cell size of @xmath138kpc is used for the simulation .",
    "figure [ halo ] shows the neutral hydrogen fraction contours at four epochs .",
    "the analytic results are only valid before the ionization front reaches the halo ; at subsequent times regions behind the halo within the region delimited by the two dotted lines should remain neutral .",
    "we indeed see the shadow cast by the dense gas cloud .",
    "the slightly overshadowing near the edges of the shadowed region is due to the limited resolution of angular discretization , also seen in figure [ ani ] .    the relatively complicated situation here does not guarantee that photon number conservation will be obeyed .",
    "figure [ haloerr ] shows the degree of conservation of photons .",
    "quite reassuringly , we see that the number of photons is conserved at better than @xmath154 with the average at about @xmath172 .",
    "let us next examine another class of ionization processes , where external diffuse radiation ionizes isolated overdense regions .",
    "this type of ionization process is common in cosmological situations where low density regions become ionized first . in this case",
    "we check the photon number conservation in a slightly different way as :    @xmath184    where @xmath124 is the number of free electrons created by time @xmath17 in the simulation box and @xmath185 is the number of incoming photons from the diffuse background that are absorbed in the simulation box volume by time @xmath17 .",
    "if photon number conservation is strictly observed , @xmath127 would be unity .",
    "recombination time is set to infinity .",
    "the first simple example is the ionization of a spherical isothermal gas cloud of density @xmath156@xmath137 with an outer cutoff radius @xmath186 ; the central cell at @xmath77 has a density equal to @xmath146 to avoid singularity , where @xmath134 is the cell size .",
    "the expected evolution of the radius of the ionization front , which now travels inward towards the center of the gas cloud , is approximately :    @xmath187    where @xmath188 is the diffuse flux assumed to be constant with time .",
    "note that the factor @xmath189 in front of flux @xmath188 in equation ( 34 ) is due to the fact that any element on the surface is subject to radiation only at half the total solid angle .",
    "figure [ island ] shows the evolution of the ionization front in the x - y plane with @xmath109 .",
    "we use @xmath152kpc , @xmath190 , @xmath191kpc , @xmath192 and @xmath193@xmath194sec@xmath183 .",
    "we see that the analytic evolution of the ionization front is well tracked by the computed results with error on the radius no larger than one cell .",
    "the spiky surface at the earliest time shown reflects the initial condition laid out on a cartesian grid .",
    "figure [ islanderr ] shows the photon number conservation as a function of time and again indicates that the method conserves total number of photons very well at @xmath195 .",
    "the high degree of photon conservation in case is attributable to the fact that there is no obscuration for the cells on the ionization surface that receive ionizing photons .",
    "we next consider ionization of an isolated elliptical isothermal gas cloud of the following density profile by a diffuse ionizing background    @xmath196    the central cell at @xmath77 has a density equal to @xmath146 to avoid singularity , where @xmath134 is the cell size .",
    "the expected evolution of the radius of the ionization front follows equation ( 34 ) with an angle - dependent @xmath150 indicated by equation ( 35 ) .",
    "figure [ ellipisland ] shows the evolution of the ionization front in the x - z plane with @xmath120 .",
    "we use @xmath152kpc , @xmath190 , @xmath191kpc and @xmath193@xmath194sec@xmath183 .",
    "we see that the analytic evolution of the ionization front is well traced by the computed results with error on the radius no larger than one cell .",
    "figure [ ellipislanderr ] shows the photon number conservation as a function of time and again indicates that the method conserves total number of photons very well at @xmath195 .",
    "finally , we turn to the radiation propagation in a realistic density field produced by cosmological simulations . in this case , the situation is much more complicated and no analytic solution is possible .",
    "but many of the cases tested above have significant bearings on this realistic case .",
    "we take a subbox from one of our latest simulations ( cen et al .",
    "2001 ) at redshift @xmath139 .",
    "the subbox has a @xmath104 grid and a cell size of @xmath197kpc proper .",
    "we turn on by hand a galaxy of ionizing luminosity of @xmath135sec@xmath183 at cell @xmath198 corresponding to the densest cell in the box , as indicated by the solid dot in figures ( 24,25,26 ) .",
    "we assume that the gas is composed entirely of hydrogen and at the starting time hydrogen is entirely neutral . for simplicity",
    "we have set the recombination time to infinity .",
    "it is noted that the galaxy sits in a generic filament , which is embedded in a complex structure containing voids and other interesting structures . since the subbox is a small region of a large , periodic box , it is not periodic itself .",
    "but we treat it as if it were periodic .",
    "figure [ real1 ] and figure [ real2 ] show the distribution of neutral hydrogen at time @xmath199yrs ( middle columns ) , respectively , compared to that at the starting time ( @xmath200 ; left column ) .",
    "the most notable feature is that the radiation propagation is highly anisotropic .",
    "the ionizing photons quickly clear out widening tunnels towards low density ( void ) regions in the direction perpendicular to the filament , while radiation front travels at much slower speeds in other directions .",
    "although this is not at all surprising , the figures do remind us of the complex situations encountered in cosmological structures and re - iterate the need for a proper treatment of radiative transfer .",
    "we also use a high resolution ray tracing code to obtain numerically the approximate ",
    "true \" distribution , shown as the right columns .",
    "note that in the ray tracing code one just counts photons and compares to the number of hydrogen atoms along each ray cone ; photon penetration ahead of the ionization front is not taken into account and ionization front is taken to be abruptly sharp .",
    "nevertheless , the results obtained with the ray tracing method should be fairly close to the  truth \" .",
    "we see that the agreement between the result obtained with the present method and that with the ray tracing method is excellent .",
    "figure [ realflux ] shows the projected flux distributions ( volume - weighted ) at the two epochs respectively .",
    "we see that flux distributions are quite complex but consistent with the neutral hydrogen distributions .",
    "it is seen at the earlier epoch , when substantial blocking or shadowing exists , the contours of the flux distribution tend to orient perpendicular to the contours of the neutral hydrogen density .",
    "note that in the present calculations we have set the recombination time to infinity ; in a more involved calculation including recombination it is expected that fluctuations in the flux distributions would be enhanced .",
    "finally , figure [ realerr ] shows how the total number of photons is conserved .",
    "we are once again seeing satisfactory conservation of photons in this realistic simulation at about @xmath201 level with a time averaged accuracy of @xmath202 .",
    "this level of photon number conservation is quite adequate for cosmological simulations , since other uncertainties , including galaxy luminosity , radiation escape fraction from the galaxies , star formation efficiency , etc .",
    ", are usually much larger . besides , we expect that we may be able to improve the accuracy of the algorithm by more detailed experimenting and careful fine tuning , if necessary .",
    "the fact that photon number is well conserved and flux is designed under the algorithm to propagate in the right directions guarantee that the results should be reliable , as verified by the comparison with the results from a high resolution ray tracing method .",
    "we have performed a variety of tests on the proposed algorithm for transferring radiation in three dimensional space .",
    "the tests are designed to be relevant to cosmological applications .",
    "it is worthwhile to re - emphasize that the proposed algorithm , by design , guarantees that flux propagates in the right direction in any situation .",
    "thus , the tests should mainly demonstrate how accurately the amplitude of the flux is computed .    to summarize the results we find ,",
    "the flux is computed very accurately , resulting in ionization fronts that travel at the correct speed with error no larger than one cell in all cases .",
    "photon number is conserved with a maximum error of about @xmath154 and an average error of @xmath3 over hundreds of time steps for all the cases tested , with @xmath105 angular elements and @xmath106 logarithmically spaced radial bins on a @xmath104 grid .",
    "we note that in the limit of infinite values for @xmath68 and @xmath69 , the present method solves the equation of the radiative transfer exactly and the approximation would represent the truth .",
    "in other words , the tests have basically shown that with reasonable number of angular and radial discretization elements the proposed method gives quite accurate results .    finally , we find that the accuracy of the algorithm does not depend sensitively on the time step used",
    ". a time step of size comparable to the typical time step in cosmological hydrodynamic simulations appears sufficient .",
    "this feature is desirable with regard to the overall computational cost .",
    "in light of the recent observations of high redshift quasars ( e.g. , fan et al .  2001 ) , indicating that the cosmological reionization may be just ending at redshift @xmath203 ( becker et al .  2001 ;",
    "barkana 2001 ; cen & mcdonald 2001 ) , a new and exciting frontier is forming .",
    "inhomogeneous reionization of the universe is now within the observational reach and could potentially provide a great tool to test both cosmological models and astrophysics of galaxy formation ( e.g. , barkana & loeb 2001 ) .",
    "it has thus become mandatory to perform cosmological hydrodynamic simulations that tackle this problem with an adequate treatment of radiative transfer .",
    "furthermore , even in the post - reionization era , an initial inhomogeneous reionization process coupled with the significant clustering of radiation sources ( galaxies or quasars ) as well as the fluctuating density field likely produces fluctuations both in the thermodynamic properties of the cosmic gas and in the ionizing radiation field .",
    "such fluctuations may substantially alter quantitatively ( or even qualitatively ) the picture of the optically thin regions of the ly@xmath4 forest on a variety of scales , which would limit our ability of accurately extracting important cosmological information from observations of the ly@xmath4 forest .",
    "lastly ( but not the least ) , since almost all neutral gas resides and star formation occurs _ only _ in dense , optically thick regions , many questions pertaining neutral gas and star formation in the universe can be answered with confidence only when radiative transfer is properly included .    we have developed a fast , accurate and robust algorithm for radiative transfer in three - dimensional space .",
    "the core of the algorithm is based on a formulation that the summation of any quantity ( such as emissivity or opacity ) over any volume can be written in the standard convolution form , which can be computed efficiently using the fast fourier transform techniques .",
    "we will name this method  frt \" ( fast radiative transfer ) method .",
    "the overall computational time with this algorithm scales as @xmath0 , where @xmath1 is the number of grid points in a simulation box .",
    "therefore , this is a _ fast _ algorithm .",
    "we stress that the computational cost with this method is independent of the number of radiation sources , providing a natural match to cosmological simulations where a large number of sources are present .",
    "local sources and diffuse background are naturally split and the evolution of each of the two components as well as interactions between them are handled self - consistently .",
    "the devised integral form of the algorithm guarantees that the method is completely _ stable and robust_.    the algorithm is tested on a wide range of analytically tractable problems that have significant bearings on cosmological applications .",
    "we find that the algorithm performs very well in all cases , accurately tracking ionization fronts with the error no larger than one cell .",
    "conservation of photons is observed to be at a level of a few percent .",
    "the accuracy of the results depends weakly on the size of the time step in all cases ; a time step comparable to the typical size of a time step for a cosmological hydrodynamic simulation is sufficient .",
    "we also apply the algorithm to a realistic density field produced by a cosmological hydrodynamic simulation and find that conservation of photons is observed at a level of a few percent .",
    "these extensive tests indicate that the algorithm is also very _ accurate_.    the tests performed is based on a first implementation of the basic algorithm outlined in the paper .",
    "it is clear that there is significant room for further improvement over the specific implementation .",
    "the current implementation is on a uniform mesh but we think that variant approaches ( such as with adaptive mesh refinement , for example ) based on this method are possible and will be explored in the future .",
    "dum abel , t. , norman , m.l . , madau , p. 1999",
    ", apj , 523 , 66 barkana , r. , 2001 , astro - ph/0108431 barkana , r. , & loeb , a. 2001 , phys .",
    ", 349 , 125 barnes , j. , & hut , p. 1986",
    ", nature , 324 , 446 becker , r.h . , et al .",
    "2001 , astro - ph/0108097 cen , r. , miralda - escud , j. , ostriker , j.  p. , & rauch , m. 1994 , , 437 , l9 cen , r. , & mcdonald , p. 2001 , astro - ph/0110306 , apj , in press cen , r. , & ostriker , j.p .",
    "1993 , , 417 , 404 cen , r. , & ostriker , j.p .",
    "1999 , , 514 , 1 cen , r. , tripp , t.m . , ostriker , j.p . , & jenkins , e.b .",
    "2001 , , 559 .",
    "l5 ciardi , b. , ferrara , a. , marri , s. , raimondo , g. 2001 , mnras , 324 , 381 croft , r.a.c . , weinberg , d.h . ,",
    "katz , n. , & hernquist , l. 1998 , apj , 495 , 44 fan , x. , et al .",
    "2001 , astro - ph/0108063 gnedin , n.y . , &",
    "ostriker , j.p .",
    "1997 , 486 , 581 hernquist , l. , katz , n. , weinberg , d.h . , &",
    "miralda - escud 1996 , , 457 , l51 kessel - deynet , o. , & burkert , a. 2000 , mnras , 315 , 713 miralda - escud , j. , cen , r. , ostriker , j.  p. , & rauch , m. 1996 , , 471 , 582 navarro , j.f . ,",
    "frenk , c.s .",
    ", & white , s.d.m .",
    "1997 , apj , 490 , 493 norman , m.l . , paschos , p. , & abel , t. 1998 , mmsai , 69 , 455 razoumov , a.o . , scott , d. 1999 , mnras , 309 , 287 sokasian , a. , abel , t. , & hernquist , l. 2001 , newa , submitted , astro - ph/0105181 stone , j.m . , mihalas , d. , & norman , m.l .",
    "1992 , apjs , 80 , 819 tyson , j.a . ,",
    "kochanski , g.p .",
    ", & dellantonio , i.p .",
    "1998 , apj , 498 , l107 zhang , y. , anninos , p. , & norman , m.l .",
    "1995 , , 453 , l57"
  ],
  "abstract_text": [
    "<S> we have developed an algorithm for transferring radiation in three - dimensional space . </S>",
    "<S> the algorithm computes radiation source and sink terms using the fast fourier transform ( fft ) method , based on a formulation in which the integral of any quantity ( such as emissivity or opacity ) over any volume may be written in the classic convolution form . </S>",
    "<S> the algorithm is fast with the computational time scaling as @xmath0 , where @xmath1 is the number of grid points of a simulation box , independent of the number of radiation sources . </S>",
    "<S> furthermore , in this formulation one can naturally account for both local radiation sources and diffuse background as well as any extra external sources , all in a self - consistent fashion . finally , the algorithm is completely stable and robust .    while the algorithm is generally applicable , we test it on a set of problems that encompass a wide range of situations in cosmological applications , demonstrating that the algorithm is accurate . </S>",
    "<S> these tests show that the algorithm produces results that are in excellent agreement with analytic expectations in all cases . </S>",
    "<S> in particular , radiation flux is guaranteed to propagate in the right direction , with the ionization fronts traveling at the correct speed with an error no larger than one cell for all the cases tested . </S>",
    "<S> the total number of photons is conserved in the worst case at @xmath2 level and typically at @xmath3 level over hundreds of time steps . as an added advantage , </S>",
    "<S> the accuracy of the results depends weakly on the size of the time step , with a typical cosmological hydrodynamic time step being sufficient .    # </S>",
    "<S> 1[pm : _ # 1 _ ] </S>"
  ]
}