{
  "article_text": [
    "in the last few years , there has been considerable effort in obtaining accurate theoretical predictions for the mass function of collapsed dark matter haloes . by far , the most widely used prediction for the unconditional mass function ( umf ) is the ( * ? ? ?",
    "* hereafter ps ) formalism .",
    "extensions of this prescription provide a way to compute not only good approximations to the umf @xcite , but also the merging history @xcite and the spatial clustering @xcite of dark matter haloes .",
    "the two basic assumptions of the ps approach are the physics of the spherical collapse , and the fact that the initial fluctuations were drawn from a gaussian distribution .",
    "@xcite showed how to combine these two hypothesis in order to obtain the umf of dark matter haloes from the barrier crossing statistics of many independent , uncorrelated random walks ( the so - called `` excursion set formalism '' ) .",
    "the barrier shape is given by the fact that , in the spherical collapse model , a certain region collapses at time @xmath4 ( or redshift @xmath5 ) if the initial overdensity within it exceeds a critical value ( @xmath6 ) which is independent of mass .",
    "however , numerical simulations show that the ps umf as derived from this formalism , while qualitatively correct , overestimates the abundance of `` typical '' haloes and underestimates that of massive ones when compared with the results of n - body simulations ( e.g. * ? ? ? * ) . in order to understand if this discrepancy could be due to the assumption of spherical collapse made within the ps formalism , several works in the last few years extended the excursion set formalism by incorporating a treatment of the ellipsoidal collapse @xcite . in practise , this",
    "is done by using a `` moving barrier '' , i.e. a barrier whose height depends on mass .",
    "this study provides an analytic expression which describes to a good approximation the distribution of first - crossings of this `` moving '' barrier , once two free parameters are fitted by comparison with n - body simulations ( * ? ? ?",
    "the resulting mass function significantly improves the results of the ps formalism , although a small discrepancy still remains at high masses @xcite .",
    "the authors of this last paper also propose an analytic fitting formula which better reproduces the numerical results , but which can not be extrapolated in mass beyond the range of the fit .",
    "recently , ( * ? ? ?",
    "* wa ) use a large sample of simulations to provide a extremely good fitting formula for the umf at redshift zero , while @xcite provide a good fit to the umf at redshifts 10 - 30 .",
    "on the other hand , @xcite proposed an analytical procedure for deriving the umf at any redshift , which also includes the physics of the ellipsoidal collapse encoded in the st mass function . in this procedure , the `` all - mass - at - center '' problem is treated in an appropriate manner . as a consequence of this , the high mass behaviour and the redshift dependence of the umf comes out right without introducing any fudge parameter to be fitted with simulations .",
    "their expression reproduces well the @xcite fit to the simulations .",
    "summarising , there is a variety of analytical expressions which accurately reproduce the umf .",
    "however , this is not the case for the conditional mass function ( cmf ) .",
    "there are different approaches in the literature to obtain an analytic expression for the cmf of dark matter haloes , @xmath7 .",
    "the most widely used framework is again the _ excursion set formalism _",
    ", often called _ extended press - schechter _ @xcite , and denoted eps ( for a recent review , see * ? ? ?",
    "however , this approach does not compares well to n - body simulations ( see e.g. * ? ? ?",
    "* ) , being one of the reasons that it does not include the physics of the ellipsoidal collapse .",
    "@xcite propose an alternative expression of the cmf to solve this issue within the context of the ellipsoidal collapse moving barrier , which reproduces much better the results from simulations of the hierarchical assembly of dark matter haloes .    in this paper",
    ", we present our method to build the cmf of dark matter haloes . our motivation is to provide an analytical prescription to build the cmf as an extension of the umf , taking advantage of the high degree of accuracy at which we know these functions .",
    "our proposal consists in a prescription to rescale the umf , which can be applied to any of the existing fitting formula , and which takes into account a certain normalisation condition that we will describe below .",
    "our procedure differs from the standard one in two major respects .",
    "first , the scaling of the umf is implemented locally , using at each point within the conditioning region the local environment , rather than using the average ( in practise , this means that our cmf will depend on an additional variable , @xmath8 , the distance from the center of the condition to the point at which we evaluate the cmf , and over which we have to integrate in order to obtain the average cmf ) .",
    "secondly , the scaling procedure is somewhat different from the standard one , and instead of the usual value of @xmath0 , we will use a modified one .",
    "we assume throughout the paper a flat @xmath9cdm model with the following cosmological parameters : @xmath10 , @xmath11 ( i.e. @xmath12 ) , @xmath13 and no tilt of the primordial spectrum ( i.e. a scalar spectral index @xmath14 of @xmath15 ) .",
    "the cdm power spectrum ( @xmath16 ) adopted for our computations is obtained from the transfer function @xmath17 given by @xcite , @xmath18^\\nu \\big)^{-1/\\nu}\\ ] ] where @xmath19  @xmath20 , @xmath21  @xmath20 , @xmath22  @xmath20 , and @xmath23 .",
    "the ( unconditional ) mass function ( umf ) of dark matter haloes at a given redshift @xmath5 , @xmath24 , is defined such that @xmath25 is the comoving number density of haloes in the mass range @xmath26 at that redshift .",
    "the bound objects ( haloes ) are usually defined in numerical simulations using two different algorithms : the friends - of - friends finder @xcite , and the spherical overdensity finder @xcite .",
    "note that different algorithms may lead to differences of the order of 10 - 20% in the mass functions ( see the discussion in * ? ? ?",
    "the umf is related with @xmath27 , the mass fraction in collapsed objects with masses greater or equal than @xmath28 , as @xmath29 where @xmath30 is the mean matter density of the universe .",
    "it is also common to write the mass dependence in terms of @xmath31 , where @xmath32 denote the mass variance of the linear density field extrapolated to the redshift @xmath5 at which the haloes are defined , and on mass scale @xmath33 ( the precise form of the @xmath34 relation depends on the window function used ) .",
    "this variance can be obtained as @xmath35 where @xmath36 is the linear power spectrum of density fluctuations , and @xmath37 is the growth factor of linear perturbations normalised to unity at @xmath38 @xcite .",
    "the window function is usually taken to be a real - space top - hat filter , i.e. @xmath39 , and @xmath40 using @xmath41 as the mass variable , the umf is also defined in some works as @xmath42 where now @xmath43 represents the mass fraction contained in collapsed objects per unit @xmath41 , and @xmath44 is the number density of collapsed objects with masses above @xmath28 , i.e. @xmath45 the @xmath43 function is connected with the standard @xmath27 as @xmath46 the advantage of using eq .",
    "[ eq : f ] is that the majority of the analytic ( or semi - analytic ) models for the umf predict a functional form for @xmath47 with no explicit dependence on redshift . in those cases , all the dependence in mass and redshift can be absorbed into a single variable , @xmath48 , where @xmath0 is the threshold parameter usually taken to be the extrapolated linear overdensity @xmath49 of a spherical perturbation at the time it collapses .",
    "for the case of an einstein - de sitter cosmology , we have @xmath50 ( e.g * ? ? ? * ) , with a weak dependence on the cosmological parameters ( e.g * ? ? ? * ) .    in this paper",
    ", we shall consider four of the different prescriptions for the umf which were mentioned in the introduction , namely ps , st , wa and bm . however , the method described here can be applied in principle to any other prescription , in order to use the proposed normalisation condition , it is required that the mass function should have appropriate asymptotic behaviours at high and low masses . for this reason , we can not use here the @xcite umf . ] .",
    "the expressions for these umf are the following :    1 .   the press - schechter mass - function @xcite is given by @xmath51 2 .",
    "the empirical best - fit mass function of st is given by @xmath52 \\frac{\\delta_c}{\\sigma } \\exp ( - \\frac{a\\delta_c^2}{2\\sigma^2 } ) \\label{eq : f_st}\\ ] ] where @xmath53 , @xmath54 and @xmath55 .",
    "3 .   the @xcite umf uses a modified version of the functional form proposed by st which is fitted to the simulations , giving @xmath56 with @xmath57 , @xmath58 , @xmath59 and @xmath60 . this expression provides a very good fit , over a mass range of @xmath61 orders of magnitude , to the umf obtained from simulations .",
    "the @xcite mass function does not depends only on @xmath62 , but there is an additional dependence on the mass which enters through certain local spectral index , which is characterised by a parameter represented by @xmath63 . in this case , the umf is given by @xmath64 where the mass fraction @xmath65 is defined as @xmath66 @xmath67 u^2 du\\ ] ] and @xmath68 is the st mass fraction which corresponds to equation  [ eq : f_st ] but using @xmath69 .",
    "the expression for @xmath63 will be discussed in section  [ sec : rescaling ] ( equations [ eq : dq ] , [ eq : cm ] and [ eq : dcm ] ) .    given that the bm mass function is defined in terms of the mass fraction @xmath70 , we find it useful to have analytical expressions for the mass fractions of the different umf .",
    "these formulae are presented in appendix  [ app1 ] .",
    "as discussed above , one can find several analytic expressions in the literature for the conditional mass function ( cmf ) of dark matter haloes , @xmath7 .",
    "the most widely used framework is the so called _ extended press - schechter ( eps ) _ , or excursion set formalism , either in the context of spherical collapse @xcite or in a more elaborated form , in the case of a constant barrier . according to the later formalism",
    ", the cmf can be estimated by considering successive crossings of barriers of different heights . in the case of constant barriers",
    "this problem has an analytic solution , and it is possible to provide analytic expressions for both the umf and the cmf . in particular , the cmf essentially has the same form as the umf , but in the rescaled variables @xmath71 where @xmath72 and @xmath73 are the linear density and the amplitude of the condition .",
    "hereafter , we will refer to this equation as the standard re - scaling .",
    "note that this is precisely the scaling which is obtained for the conditional probability distribution of the average density field within scale @xmath74 at a randomly chosen point within a region on scale @xmath75 with inner linear density contrast @xmath76 ( see appendix a of * ? ? ?",
    "* ) . within this eps formalism",
    ", the cmf would be given by is defined as `` lagrangian '' , i.e. we explicitly use the mean density , @xmath30 , when defining the volume element , and not the actual local density in the conditional region . throughout this paper",
    ", we will always refer to lagrangian cmfs unless otherwise stated . ]",
    "@xmath77 @xmath78 however , as discussed in the last section , the eps is not the most accurate approximation to the halo abundance , being one of the reasons that it does only contains the physics of the spherical collapse .",
    "the ( * ? ? ?",
    "* hereafter st02 ) approximation for the cmf further extends this eps formalism by including the physics of the ellipsoidal collapse .",
    "this is done by using the moving barrier shape derived by @xcite , which is given by @xmath79 , \\label{eq : barrier_ec}\\ ] ] with @xmath54 , @xmath80 and @xmath81 .",
    "note that with our notation , the redshift dependence on the growth factor is contained inside @xmath82 , so the residual dependence @xmath83 is due to the considered cosmology .",
    "unfortunately , for this problem there is no analytic formulae for the first - crossing distribution .",
    "nevertheless , st02 proposed a simple analytic expression for the cmf , based on the direct replacement of the barrier shape in their generic approximate expression for the first - crossing distribution .",
    "this proposal reasonably reproduces the results from numerical simulations for the mass function of the progenitors of haloes in a given mass range today at redshift @xmath84 , given that we have a variance @xmath85 at an earlier redshift @xmath86 , their proposal for the re - scaling , to be inserted in their equation for the first - crossing distribution , is @xmath87 . ] .",
    "the st02 proposal can not be directly applied to obtain the cmf at a fixed redshift @xmath5 and for the conditioning we are considering in this paper .",
    "however , we use here a natural extension of the st02 proposal , which consists in the replacement @xmath88 . in that case , the explicit expression for this cmf is @xmath89 @xmath90 ^ 2}{2(\\sigma^2 - \\sigma_0 ^ 2 ) }   \\bigg\\ } \\label{eq : st02}\\ ] ] where @xmath91}{\\partial ( \\sigma^2)^n}\\ ] ] as we show below , this prescription provides better results than the eps for underdense regions ( @xmath92 ) , although still shows a discrepancy with the data from simulations , underestimating the number of haloes at low masses .",
    "here we present our method to build the cmf of dark matter haloes . an important formal difference with respect to the expressions discussed in the last section",
    "is _ the explicit introduction of the dependence in the @xmath8 variable _ , the distance from the center of the condition to the point at which we evaluate the cmf .",
    "thus , in order to fully describe the cmf , we have to specify three parameters , namely @xmath93 ( the radius of the condition ) , @xmath72 ( the linear density within @xmath93 ) and @xmath8 .",
    "thus , @xmath94 note that the quantities @xmath93 and @xmath8 denote the lagrangian radius ; for eulerian radius we will use @xmath95 and @xmath96 , respectively .",
    "the method proposed here is an extended version of the one presented in ( * ? ? ?",
    "* hereafter pbp06 ) , which was based on a set of assumptions similar to all other previously described cmfs in the literature . for clarity , we follow the same notation as in pbp06 .",
    "the basic idea of the method is _ to build the cmf as an analytic extension of any of the existing versions of the umf_. to this end , we make two basic assumptions :    1 .   for those scales @xmath28 which are much smaller than the scale of the condition @xmath97 , the constrained field should behave `` locally '' as an isotropic uniform gaussian field with a re - scaled mean and variance ( or power spectra ) .",
    "this assumption is implicitly done in all the existing derivations of the umf ( although for the average value of the field ) . for a discussion on its validity , see pbp06 .",
    "we assume that the umf can be derived from a `` rigid '' barrier , @xmath98 , in the sense that if we have a crossing of this barrier , then we will have collapse with probability @xmath15 ( note that for this argument @xmath98 may have some dependence in the mass ) . in the general case of ellipsoidal collapse",
    "the barrier should have certain `` width '' , connected with the fact that the evolution of an ellipsoidal perturbation is determined by three parameters ( the three eigenvalues of the deformation tensor ) .",
    "thus , for a given mass ( or equivalently , a given @xmath99 ) there is no a rigid height of the barrier , but we have a probability distribution of finite width around a certain value of @xmath49 .",
    "however , as discussed in @xcite , using an average ( rigid ) shape for the barrier for treating the ellipsoidal collapse gives good results for the umf .",
    "after these two assumptions , and neglecting any dependence of the shape of the barrier which is not captured by the ratio @xmath100 , it follows that obtaining the cmf just implies a vertical displacement of the barrier ( without changing its shape ) .",
    "this displacement is obtained as a re - scaling in which the variables @xmath101 and @xmath82 are substituted by their corresponding values in the local gaussian field .",
    "note that a more detailed treatment of the ellipticity of the collapse would require to compute the exact shape of the barrier after each re - scaling , implying an integration over the distribution function for the three eigenvalues of the deformation tensor .",
    "this basic idea of re - scaling the umf is identical to the one adopted in pbp06 .",
    "however , the overall normalisation of the resulting cmf was not treated in detail in that work , as we explain below . here , we extend the method by obtaining this normalisation as it is described in sec .  [",
    "sec : normalization ] , and we present the full explanation of the approximate treatment of the normalisation used in pbp06 .      the relevant statistical quantity is the conditional probability distribution , @xmath102 for the linear density perturbation @xmath103 , on scale @xmath104 , at a distance @xmath8 from the center of a sphere of radius @xmath93 ( the condition ) with mean inner linear density fluctuation @xmath105 . for a gaussian field , this is    @xmath106 @xmath107 where @xmath108 , @xmath109 , and @xmath110 @xmath111    if one compares the one - point statistic for @xmath103 with the unconstrained case : @xmath112 we see that the conditional case behaves in the same way , but with re - scaled variables @xmath113 and @xmath114 given by    @xmath115    and @xmath116 where we have introduced the function function is independent on redshift . ] @xmath117 in appendix  [ app2 ] we present some useful fits to this function in several asymptotic cases .",
    "one of the important properties that can be used to speed up the computations with this function is that if @xmath118 , then @xmath119 is practically independent of @xmath104 .      from the previous discussion ,",
    "it is natural to adopt the following change of variables in order to re - scale locally a given umf to obtain the corresponding cmf : @xmath120 in principle , we can use any of the aforementioned expressions for the umf to build the cmf .",
    "however , there are some details which are important to discuss .    in the first two cases considered for the umf ( ps and st )",
    ", the umf can be explicitly written in terms of the variable @xmath121 .",
    "thus , re - scaling these mass functions just implies the change of variables given in eq .",
    "[ eq : recipe ] .",
    "however , for the wa mass function only the dependence on @xmath74 is explicit shown , so to use this umf ( or any other numerical fit ) we proceed as follows .",
    "we shall assume that all the dependence on the mass can be absorbed in the variable @xmath122 , and we will re - scale this variable according to eq .",
    "[ eq : recipe ] . in practise",
    ", this implies making the following change in eq .",
    "[ eq : f_wa ] @xmath123    the bm mass function shows an additional dependence on mass apart from the standard @xmath62 dependence , which is included in the @xmath63 coefficient , defined as ( see * ? ? ?",
    "* ) @xmath124 \\label{eq : cm}\\ ] ] in order to re - scale this umf , we use the fact that @xmath125 , so the corresponding scaling for the @xmath63 term will be @xmath126 where @xmath114 is defined in equation  [ eq : recipe ] .",
    "finally , we note that by definition , all the umfs verify that @xmath127 if @xmath128 .",
    "this has to be explicitly taken into account because @xmath119 can be larger than @xmath15 for some values of @xmath8 ( for example , at @xmath129 ) , and thus , one may find @xmath130 even if @xmath131 .",
    "[ fig : example_cmf ] shows two particular examples of the cmf , built in this case from the st mass function , and using @xmath132  @xmath20 ( equivalent to @xmath133  @xmath134 ) .",
    "we consider the case of an underdense region ( @xmath135 ) , and an overdense one ( @xmath136 ) .",
    "as discussed above , our prescription provides the cmf as a function of the position within the condition , so the figure illustrates the range of variation of @xmath137 with the radial coordinate @xmath8 . for the case of @xmath138 ,",
    "the radial dependence is strong for those masses which are a significant fraction of the total mass of the conditioning region , being the number density significantly smaller at the center of the condition . for the case of @xmath139 ,",
    "the radial dependence is important practically at all masses . in particular , at low masses the number density is significantly smaller at the center of the condition than at the boundary .",
    "one can easily understand this result in this way : near the center , @xmath140 , which makes the value of the local density very close to the threshold . in that case , most of the mass will be collapsed in large objects ( with masses of the order of a significant fraction of @xmath141 , with @xmath142 ) , and low mass object will be less abundant in number when compared with the border . to compare our prescription with results existing in the literature , we need to obtain the `` volume average '' cmf over the condition ,",
    "this function is easily derived as @xmath144 for such comparison , we also show in fig .  [",
    "fig : example_cmf ] this average function , which , as a consequence of the radial dependence commented above , will be much more close in shape and amplitude to the cmf with values of @xmath8 in the vicinity of @xmath93 .    fig .",
    "[ fig : compara_cmf ] compares these two average cmfs with other existing prescriptions .",
    "in particular , we first want to answer the following question : does our averaged cmf coincides with the cmf that would be obtained using the `` standard rescaling '' ? in this context , we consider as `` standard re - scaling '' the one presented in equation  ( [ eq : standard ] ) , _ but applied to any of the aforementioned umfs and not only the ps umf_. the interesting result shown in fig .  [",
    "fig : compara_cmf ] is that , for a given umf ( e.g. the st in this case ) , the corresponding _ average cmf _ ( computed with our formalism using equation  [ eq : nc_avg ] ) , coincides with great accuracy with that cmf obtained with the `` standard re - scaling '' , but _ only for those masses much smaller than the condition_. however , and specially for the case of underdense regions , when we consider larger values of the mass ( in this particular value of the linear density , for masses @xmath145 ) , then the `` standard '' computation differs from the exact result",
    ". one can understand this result in the following way . within our approach",
    ", we are rescaling the mass function locally , according to the local gaussian field , and after that , we are averaging over the whole volume .",
    "however , in the `` standard case '' , the volume - averaged re - scaling of the density field is used as an ansatz for the prescription to rescale the umf . in principle",
    ", these two procedures could produce different results . for low masses , the dependence of the mass function on the local linear density fluctuation ( whose mean value at @xmath8 is @xmath146 ) is close to linear , and thus the processes of rescaling and averaging almost commute .",
    "however , for higher masses , non - linear terms are important and this two processes do not commute . for comparison ,",
    "[ fig : compara_cmf ] also presents the cmf obtained from eps ( eq .  [ eq : eps ] ) and st02 ( eq .  [ eq : st02 ] ) prescriptions .",
    "all the different mass functions give similar results for the overdense case , while showing significant discrepancies for the underdense case .",
    "in order to assess the quality ( and the validity ) of a given expression for the cmf , we propose here to use a `` normalisation condition '' that connects the cmf with the unconditional one . this condition _ must be satisfied by any cmf in general _ , and reads @xmath147 here @xmath148 stands for a normalised gaussian with mean @xmath149 and variance @xmath150 , and we have omitted the redshift dependence in both sides for simplicity .",
    "note that , by construction , there can not be masses larger than @xmath97 within the conditioning region .",
    "it is also important to stress that in this equation , the _ lagrangian cmf _ is the one that has to be used .",
    "equation  [ eq : norma ] quantifies the fact that when one integrates the cmf for all possible values of the linear density within the condition ( @xmath149 ) , then one should recover the umf . by definition of the cmf ,",
    "it is clear that this equation is exact in the limit @xmath151 ( in that case , @xmath152 , where @xmath153 is the dirac delta - function ) . for finite values of @xmath154 , it should also be satisfied to a good approximation for large values of @xmath93 ( i.e. in the linear regime ) , and for those masses @xmath28 much smaller than @xmath97 . the reason for this",
    "is related with the way we have set the upper limit of integration . in principle",
    ", one would recover the true umf if the integration is carried out for all possible values of @xmath149 .",
    "however , the cmf will not be defined for values of @xmath149 above the barrier , because in that case the whole conditioning region would have collapsed , and only masses larger than @xmath97 may exist ( i.e. it would be part of a larger object ) .",
    "therefore , under the assumption of a rigid barrier , the upper limit of the integral in eq .",
    "[ eq : norma ] should be given by this barrier , i.e. @xmath0 in the case of spherical collapse , or by @xmath155 ( which was defined in equation  [ eq : barrier_ec ] ) for the ellipsoidal collapse barrier @xcite .",
    "as discussed above , this abrupt way of truncating the integral is based on the assumption of rigid barrier , and it might fail for values of @xmath149 close to the boundary ( @xmath0 ) . for this reason , and in order to normalise the cmf , we will focus on large values of @xmath93 for the computations ( @xmath156 ) . in this way , the gaussian function in the rhs of eq .",
    "[ eq : norma ] is narrow , and the details of how the truncation is done are not important , while still eq .",
    "[ eq : norma ] imposes a significant constraint on the shape of @xmath157 .     for the cmf .",
    "we consider the case of @xmath158mpc / h . this percentage error is shown as a function of the mass @xmath28 for three different mass functions : st @xcite , bm @xcite and wa @xcite .",
    "it can be seen that for the st and the wa cases , the relative error is larger than 10% for high masses . for comparison , it is also shown the relative error for the case of the eps and st02 prescriptions . ]",
    "[ fig : norma ] presents the relative difference between both sides of eq .",
    "[ eq : norma ] , defined as the ratio @xmath159 of the right- to the left - hand sides of that equation , i.e. @xmath160 where @xmath161 is equal to @xmath155 for those cases in which the umf includes the physics of the ellipsoidal collapse , and @xmath162 for the ps case . for illustration , we consider three cases for the mass function to be used with the standard re - scaling procedure , namely st , wa and bm , and the condition @xmath163 ( or @xmath164 ) .",
    "the main conclusion from that figure is that none of the considered mass functions satisfy the normalisation condition , showing deviations in some cases larger than 20% , specially for high masses .",
    "if we repeat this computation for different values of the condition , we find that for a given mass , the relative error becomes larger for smaller conditions , or equivalently , for larger values of @xmath150 ( for example , for @xmath165 and the st mass function , the relative error becomes already of the order of 5% for @xmath166 ) .",
    "this fact shows that the re - scaling proposed in that case to build the cmf can not be exact . for comparison",
    ", we also present the corresponding @xmath159 function for the eps and st02 prescriptions , which can be computed because the normalization condition ( eq .",
    "[ eq : norma ] ) also applies to the averaged cmf .",
    "we note that the eps is practically normalised , although it does not includes the physics of the ellipsoidal collapse . on the other hand ,",
    "the st02 satisfies the normalization condition with high accuracy ( better than approx .",
    "5 per cent ) , although as it is shown below in section  [ sec : voids ] , it does not reproduces the numerical results in simulated voids .",
    "the incorrect normalisation of the cmfs built using the standard re - scaling as described in the last section imply that at least one of the assumptions made in the prescription for re - scaling the umf is incorrect .",
    "given that the hypothesis of a rigid barrier has provided very good results for the case of umfs , and that the hypothesis of local isotropy should be satisfied to great accuracy , the only remaining assumption seems to be the adopted expression for the re - scaling . in pbp06 , the question of the normalisation was handled in a simple manner : the re - scaled mass function was simply divided by @xmath159 .",
    "this `` first - order approximation '' procedure provided good results , but this a posteriori renormalisation can not be entirely correct . in principle , if one has a correct re - scaling procedure , the normalisation condition must follow automatically .",
    "a complete study would require a detailed derivation of the exact shape of the ellipsoidal barrier in a conditioned environment , which is beyond the scope of this work . instead of that",
    ", we propose here a simple modification of the re - scaling law in order to fulfil the normalisation condition . our choice to propose a modification of eq .",
    "[ eq : recipe ] is to assume that the linear density which has to be re - scaled is not @xmath0 , but a certain parameter @xmath1 .",
    "we stress that this is simply an ansatz to absorb possible errors implicit in the re - scaling procedure given in equations  [ eq : standard ] and [ eq : recipe ] , so as to render a modified prescription which would satisfy the normalisation condition with much higher accuracy .",
    "this means that we should not attach much meaning to the values of @xmath1 obtained .",
    "however , as we note latter , the fact that a particular umf satisfies the normalisation condition with a value of @xmath1 of the order of 1.6 , may be considered as a `` natural '' result and a strong point in favor of that umf .",
    "if the variable that has to be rescaled is @xmath1 instead of @xmath0 , then the new recipe would be @xmath167 or equivalently , the total re - scaling for the variance will be @xmath168    .values for the @xmath1 parameter that satisfy the normalisation condition ( eq .  [ eq : norma ] ) for the different umfs considered in this paper .",
    "these values have been obtained from a condition of 6  @xmath20 .",
    "for each one of the umf presented in the first column , the second column shows the interval in which the error in the normalisation condition is smaller than 5% , at the largest considered mass ( @xmath169 ) .",
    "third column shows the `` optimum '' @xmath1 which we finally adopt , obtained as the value that gives the smallest percentage error in the normalisation condition at the highest considered mass ( @xmath169 ) . [",
    "cols=\"<,^,^ \" , ]              using this new prescription ( equations  [ eq : recipe2 ] and [ eq : recipe2.v2 ] ) to build the cmf , we can solve the normalisation condition ( equation  [ eq : norma ] ) to find a solution for @xmath1 , which in principle would be a function of mass .",
    "given that the different expressions of the umf are not exact , but they have numerical uncertainties ( typically of the order of few percent ) , we decided to find , for each mass , the range of @xmath1 values that fulfil the normalisation condition within a certain accuracy .",
    "then , we look for a single value of @xmath1 which satisfies eq .",
    "[ eq : norma ] with high accuracy for all masses .",
    "figure  [ fig : deltaeffs ] presents the allowed region for @xmath1 as a function of mass , which fulfil the normalisation condition for a certain umf with an accuracy better than 10 , 5 and 3 per cent , respectively . for this figure ,",
    "the case of @xmath170 was considered , and the upper limit of the integral in equation  [ eq : norma ] was taken to be the barrier , @xmath171 . as one would expect , for a given umf the strongest constraint on @xmath1 is obtained for high masses , because at those masses the differences between the cmf and the umf become more important .",
    "if our ansatz were the correct scaling , then one should be able to find a value of @xmath1 for which the error in the normalisation would be zero for all masses .",
    "this is not the case , for example , for the ps umf , where the `` allowed region '' changes with mass .",
    "the reason for this could be that this is the only umf which does not take into account the physics of the ellipsoidal collapse .",
    "however , the important point is that in all the other cases ( st , bm and wa ) it is possible to select a value for @xmath1 which makes the error in the normalisation condition to be smaller than @xmath172% for all masses .    another important issue is the dependence of the @xmath1 with the size of the condition , @xmath93 .",
    "if our ansatz were the correct scaling , then this parameter should not depend on @xmath93 .",
    "we have checked that the @xmath1 values do not show a strong dependence on the chosen size for the condition , in the sense that the range of @xmath1 which fulfils the normalisation equation with accuracy better than 5% is always overlapping when changing the size of the condition between @xmath173 and @xmath174 .",
    "indeed , choosing a value too high for the condition does not provide a good constraint on @xmath1 , because in that limit the conditioning fluctuation is very small and it is not imposing strong constraints on the exact shape of the cmf .",
    "we illustrate this fact in figure  [ fig : deltaeffs2 ] , where we show the allowed regions for the case of the st umf , but considering now the condition @xmath175 . for this reason",
    ", we decided to adopt as reference values for this paper those obtained with the case @xmath170 .",
    "the adopted values of @xmath1 for the computations in the rest of this paper are presented in table  [ tab : alphas ] .",
    "our criteria was to take as `` adopted '' @xmath1 value the one giving the lowest relative error at the highest considered mass in each case , which in our computations was taken to be @xmath176 .",
    "however , we note that as regards to the normalisation condition , any of the values quoted in the 5 per cent range could be adopted .    , but for the case of @xmath177 .",
    "although the allowed region at the level of 5% is compatible with the one obtained for @xmath178 in fig .",
    "[ fig : deltaeffs ] , in this case it is much larger , and thus less restrictive if one is interested in constraining the value of @xmath1 . ]",
    "the values of @xmath1 obtained for different fits to the umf are somewhat different , but for each particular case , they lead to similar shapes for the cmf .",
    "we illustrate this in figure  [ fig : several_umfs ] , where we present the average cmf for the two cases considered before ( @xmath179 , with @xmath180 or @xmath181 ) , and using several umfs with their corresponding `` optimum '' @xmath1 values .",
    "given that the normalisation condition is fulfilled by all the different cmfs with a precision of @xmath182% , one would expect differences of this order between them .",
    "however , this is not the case . for the low - density case ( @xmath135 )",
    ", there are significant differences at high masses , although the agreement at low masses is very good . and for the high density one ( @xmath181 ) , the discrepancies are larger than that even at low masses .            to conclude this subsection , we revisit again the discussion about the difference between our averaged cmf , and the cmf obtained with the standard ( average ) re - scaling of the umf , but now using @xmath1 instead of @xmath0 as the variable to re - scale .",
    "we have already shown in sect .",
    "[ sec:4.4 ] that for the case of @xmath183 , the standard re - scaling provides good results for low masses ( see fig .",
    "[ fig : compara_cmf ] ) . as a example",
    ", we now consider in figure  [ fig : compara_cmf2 ] the case of @xmath184 for the st umf .",
    "the result for the under - dense region ( @xmath135 ) is qualitatively similar to the one obtained before for the case of @xmath183 .",
    "indeed , the discrepancies between the averaged cmf and the cmf with the average standard re - scaling appear approximately at the same mass scale ( @xmath185 ) .",
    "thus , the `` average '' re - scaling still provides good results for those masses much smaller than the size of the conditioning region .",
    "however , this is not the case for the over - dense ( @xmath181 ) region , in which even at low masses , there is a discrepancy with the exact result .",
    "the reason for that is that in this case , the region near the center has surpassed the critical value of @xmath1 ( note that @xmath184 for the st umf , and that @xmath186 ) , so in practice that region is not contributing to the average . as a consequence ,",
    "the cmf built with standard re - scaling slightly overestimates the number of low - mass objects .",
    "finally , it is interesting to compare these results with the eps and st02 prescriptions , which are also presented in fig .  [",
    "fig : compara_cmf2 ] . for the under - dense region ( @xmath135 )",
    ", our final version of the cmf is now in closer agreement with the st02 , although there is still a systematic offset at low masses between the two prescriptions of the order of 30 - 40% .",
    "the discrepancy with the eps is much larger .",
    "as can be seen from the numerical results presented in the next section , this later prescription significantly over - estimates the number of haloes at low masses . for the over - dense region ( @xmath181 ) , both eps and st02 are systematically above our final result .",
    "one of our main motivations for the development of an accurate prediction for the cmf is the theoretical study of the statistic of voids .",
    "pbp06 developed a general analytical procedure for computing the number density of voids with radius above a given value , which was applied successfully to the description of the statistics of voids found in numerical simulations .",
    "their formalism is based on a detailed study of the number density of non - overlapping empty spheres with radius @xmath96 .",
    "pbp06 provided an analytical expression relating this quantity with the void probability function ( vpf ) , @xmath187 ( i.e. the probability that a randomly placed sphere of radius @xmath96 is empty ) .",
    "@xmath187 can be obtained from two basic ingredients , namely the probability distribution function for the values of the density contrast , @xmath188 , within a randomly chosen sphere of radius @xmath96 ; and @xmath189 , the mean fractional fluctuation within @xmath96 of the number density of the objects defining the void as a function of the linear fractional density fluctuation within @xmath96 . in detail , the final expression is @xmath190 } p(\\delta_l|r ) d{\\delta_{\\rm l}}\\ ] ]    in this section we will focus in the @xmath189 function , because it encodes all the information about the cmf .",
    "this function can be written as @xmath191 [ 1 + \\delta({\\delta_{\\rm l}})]\\ ] ] where @xmath192 accounts for the `` statistical fluctuation '' ( i.e. the clustering of the protohaloes in the initial conditions before they move with mass ) , and @xmath193 is the actual fractional mass density fluctuation as a function of the linear value .",
    "as shown in pbp06 , the @xmath192 term can be related to the cmf in the following way @xmath194 \\label{eq : deltans}\\ ] ] where we have introduced the number density of collapsed objects with masses above @xmath28 for the conditional case , which is given by @xmath195    we can use now our proposed formalism to produce accurate computations for the @xmath196 function which can be used when applying the aforementioned formalism . as proposed in pbp06 , equation  [ eq : deltans ]",
    "can be well - described with a function of the shape @xmath197 we have checked that this fitting formulae provides a reasonable fit for those masses @xmath198 ( with @xmath142 ) .",
    "detailed computations of the @xmath199 and @xmath200 functions for the cosmology considered in this paper ( @xmath13 and @xmath201 ) are given in appendix  [ app3 ] .",
    "the dependence on cosmology of the different coefficients of the fits is presented in appendix  [ app4 ] .",
    "finally , as an illustration of our method , we compare the cmfs of haloes within voids with the results of numerical simulations presented in @xcite .",
    "figure  5 in that paper presents the mass function of haloes in five simulated voids for a cosmology with @xmath202 .",
    "two of them correspond to voids with radius @xmath203 and mean density ( in units of the critical density ) of @xmath204 ( i.e. the density contrast is @xmath205 ) ; while the other three correspond to voids of radius @xmath206 and mean density @xmath207 ( or equivalently , @xmath208 ) . in order to convert the mean density values ( @xmath188 ) into linear density ones , we use the expression given by @xcite , @xmath209 @xmath210\\ ] ] for the two considered voids , we obtain @xmath211 and @xmath212 , respectively .",
    "figures  [ fig : gott_st ] , [ fig : gott_bm ] and [ fig : gott_wa ] compare the numerical results with our prediction for the cmf , using three different choices for the umf , namely st , bm and wa . in these figures , it is represented the accumulated eulerian mass function averaged within the sphere , which in our formalism is computed as @xmath213 where we use the @xmath192 function computed as in equation  [ eq : deltans ] .",
    "all three cases are in excellent agreement with the simulations .",
    "note that considering the case of @xmath214 overestimates the mass function , specially in the high - mass tail .",
    "note also that choosing a value for @xmath1 which is 0.1 below the optimum value , already shows differences , specially in the first set of simulations ( @xmath215 ) .",
    "in addition , the st02 prescription systematically underestimates these numerical results by approximately 40% , specially at low masses where the numerical uncertainty is much smaller .",
    "the eps prescription significantly over - estimates these results ( by practically a factor of two ) , so it is not shown in these figures .",
    "finally , we stress that there are no free parameters in this approach . the value for @xmath1 is uniquely determined by the normalisation condition .",
    "we have developed a procedure to obtain from any analytical expression for the umf ( either theoretically motivated or numerical fit ) a cmf which is in very good agreement with simulations both for underdense and overdense conditioning regions .",
    "to do this , we first considered the standard re - scaling ( see eq .",
    "[ eq : standard ] ) in the theoretically motivated expressions for the umf ( those where @xmath0 appears explicitly ) , and pointed out that to improve the results the re - scaling must be implemented locally .",
    "we showed that for underdense regions , this leads to a non - negligible change for masses of the order of @xmath216 , while for overdense regions , the difference is significant only at higher masses .",
    "next , we showed how to rescale ( locally ) any umf even when @xmath0 does not appear explicitly ( equations  [ eq : recipe]-[eq : recipe.v2 ] ) .",
    "we then pointed out that those re - scalings are not fully consistent , because the umf is not exactly recovered after integrating over all possible values of the condition .",
    "that is , the `` normalisation condition '' ( eq .",
    "[ eq : norma ] ) is not satisfied .",
    "the discrepancy between both members of this equation may be above 20  % for the higher masses , and this is much larger than the precision at which we know the umf from numerical simulations ( @xmath182  % ) .    to solve this problem",
    ", we modified the rescaling procedure replacing @xmath0 by a quantity @xmath1 to be obtained for every umf by solving the normalisation condition , which now becomes an equation for @xmath1 . using these values of @xmath1 , all umfs",
    "render very similar cmfs for both overdense and underdense regions , while for the former case there is a larger scatter in the mass functions .",
    "based on these results , we also present ( see appendix  [ app4 ] ) , an accurate fit for the ( accumulated ) conditional mass function , which depends on redshift @xmath5 , and the cosmology ( @xmath2 and @xmath3 ) , which can be used in a variety of problems in large scale structure studies .    finally , we point out that based on the derived values for @xmath1 , there is a preference for the bm umf against the rest of the umfs .",
    "different fits lead to somewhat different values of @xmath1 , but all of them are incompatible with theoretically motivated values which must satisfy @xmath217 .",
    "however , if we apply locally the re - scaling procedure that follows from the approach used by @xcite , which involves re - scaling certain local spectral constant in addition to the mean and variance of the density field , the resulting cmf is also in very good agreement with the simulations but now the value of @xmath1 is theoretically `` acceptable '' ( note that the range of 5% is the only one which is compatible with @xmath218 ) .",
    "this suggests that this last rescaling is the `` correct one '' , although most of the results in this work may be equally well obtained with any other prescription .",
    "we thank stefan gottlber for kindly providing us in electronic form the statistics of voids from the simulations described in gottlber et al .",
    ".    99    betancort - rijo , j.  e. , & montero - dorta , a.  d.  2006a , apj lett , 650 , 95 .",
    "betancort - rijo , j.  e. , & montero - dorta , a.  d.  2006b , apj lett , 653 , 77 .",
    "bond , j.  r. , & efstathiou , g.  1984 , apj , 285 , l45    bond , j.  r. , cole , s. , efstathiou , g. , & kaiser , n.  1991 , apj , 379 , 440    bond , j.  r. , & myers , s.  t.  1996 , apjs , 103 , 1    bower , r.  g.  1991 , mnras , 248 , 332    carroll , s.  m. , press , w.  h. , & turner , e.  l.  1992 , ara&a , 30 , 499    davis , m. , efstathiou , g. , frenk , c.  s. , & white , s.  d.  m.  1985 , apj , 292 , 371    efstathiou , g. , frenk , c.  s. , white , s.  d.  m. , & davis , m.  1988 , mnras , 235 , 715    gottlber , s. , okas , e.  l. , klypin , a. , & hoffman , y.  2003 , mnras , 344 , 715    jenkins , a. , frenk , c.  s. , white , s.  d.  m. , colberg , j.  m. , cole , s. , evrard , a.  e. , couchman , h.  m.  p. , & yoshida , n.  2001 , mnras , 321 , 372    lacey , c. , & cole , s.   1993 , mnras , 262 , 627    lacey , c. , & cole , s.   1994 , mnras , 271 , 676    lahav , o. , lilje , p.  b. , primack , j.  r. , & rees , m.  j.  1991 , mnras , 251 , 128    mo , h.  j. , & white , s.  d.  m.  1996 , mnras , 282 , 347    navarro , j.  f. , frenk , c.  s. , & white , s.  d.  m.  1997 , apj , 490 , 493    patiri , s.  g. , betancort - rijo , j. , & prada , f.  2006 , mnras , 368 , 1132    peebles , p.  j.  e.  1980 , research supported by the national science foundation .",
    "princeton , n.j . , princeton university press .",
    "press , w.  h. , & schechter , p.  1974 , apj , 187 , 425    reed , d.  s. , bower , r. , frenk , c.  s. , jenkins , a. , & theuns , t.  2007 , mnras , 374 , 2    sheth , r.  k. , & lemson , g.  1999 , mnras , 304 , 767    sheth , r.  k. , & tormen , g.  1999 , mnras , 308 , 119    sheth , r.  k. , mo , h.  j. , & tormen , g.  2001 , mnras , 323 , 1    sheth , r.  k. , & tormen , g.  2002 , mnras , 329 , 61    tormen , g.  1998 , mnras , 297 , 648    warren , m.  s. , abazajian , k. , holz , d.  e. , & teodoro , l.  2006 , apj , 646 , 881    zentner , a.  r.  2007 , international journal of modern physics d , 16 , 763",
    "for some of the computations in this paper , we found that it is useful to have an analytical expression for the mass fraction @xmath70 .",
    "we present here these expressions for the case of @xcite , @xcite and @xcite mass functions . for the case of the ps mass function",
    ", we have the well known result of @xmath219 where @xmath220 is the complementary error function , defined as @xmath221 .    for the case of the st mass function given in equation  [ eq : f_st ]",
    ", we can integrate eq .",
    "[ eq : f_and_f ] and obtain @xmath222\\ ] ] where @xmath223 represents the incomplete gamma function , defined as @xmath224 .    finally ,",
    "for the case of the wa mass function given by equation  [ eq : f_wa ] , we obtain @xmath225\\ ] ] where @xmath226 is the exponential integral function , defined as @xmath227 .",
    "we present here some useful fits to the @xmath119 function , which was defined in equation  [ eq : dq ] .",
    "all the numbers in this appendix correspond to the transfer function and cosmological parameters presented at the end of sec .  1 ( see equation  1 ) .    in most of the cases considered in this paper",
    ", we are dealing with scales which are much smaller than the condition ( i.e. @xmath229 ) . in that limit ,",
    "the @xmath119 function is practically independent on @xmath104 , and the following fitting function reproduces well the overall shape @xmath230 note that in the limit @xmath231 , we would expect this exponential dependence to be exact .    a numerical fit in the scale range @xmath232  @xmath20  @xmath233  @xmath234  @xmath20 gives the following values : @xmath235 @xmath236 where @xmath237  @xmath20 .",
    "the typical error of this fit with respect to the exact computation is of the order of 5% .",
    "it is also interesting to provide a fit for the @xmath228 function evaluated at the center of the condition , @xmath129 . in that case , we obtain @xmath238    finally , it is also useful to fit the function @xmath239 , where @xmath240 . in this case , considering the mass range @xmath241  @xmath134 @xmath242  @xmath134 , we obtain @xmath243 with @xmath244 .",
    "in this section we provide analytic fitting formulae to the @xmath192 function , described in equation  [ eq : deltans ] . to a good approximation",
    ", this function can be parameterised in terms of two functions , @xmath199 and @xmath200 , which are defined in equation  [ eq : ab ] .",
    "all the following fits have been obtained with the st umf and using @xmath184 .",
    "we have considered values of @xmath93 within the range between 5 and 13  @xmath20 .",
    "the mass interval for all fits is taken to be @xmath245 .",
    "however , we find that the functional form proposed in equation  [ eq : ab ] only provides a reasonable fit ( i.e. with errors of few percent ) to the data for masses above @xmath246 ( where @xmath141 is defined as @xmath142 ) . for mass values outside that range",
    ", it is necessary to do the numerical integration in eq .",
    "[ eq : deltans ] .",
    "finally , all these fits have been obtained for values of the linear density within the range @xmath247 .",
    "these are the typical values we are interested in .",
    "we note that beyond this range , and in particular , for values of @xmath49 close to zero , these fits may give inaccurate results .",
    "the proposed fitting formula for @xmath248 is simply a quadratic fit in @xmath249 , i.e. @xmath250 where @xmath251 is the dimensionless mass given by @xmath252 and the coefficients are linear functions of @xmath93 , @xmath253 the results we obtain are @xmath254 , @xmath255 , and @xmath256 .",
    "the best fit for @xmath257 is obtained with the formula proposed in @xcite , @xmath258 but the coefficients are now linear functions of @xmath93 , @xmath259 using these expressions to fit the numerical results , we find @xmath260 , @xmath261 , and @xmath262 .",
    "following the approach presented in this paper , we give here a highly accurate analytical fit to the cmf , as a function of the redshift and the cosmology .",
    "the ( accumulated ) conditional mass function @xmath263 , as a function of the linear density contrast @xmath49 , within a spherical conditioning region with _ lagragian _",
    "radius @xmath93 is given , for any value of the redshift @xmath5 , and the cosmology ( @xmath2 and @xmath264 ) , by      where @xmath44 is the ( unconditional ) accumulated mass function , @xmath188 is the actual fractional mass density fluctuation , and the coeffitients @xmath266 and @xmath267 are functions of @xmath28 , @xmath93 , @xmath5 , @xmath2 and @xmath3 given by @xmath268 @xmath269 and where @xmath37 is the growth factor of linear density perturbations normalised to one at @xmath38 , and @xmath199 and @xmath200 are given by equations  [ eqapp : a ] and [ eqapp : b ] , respectively , but using this new mass definition @xmath270 it is found that the @xmath3 dependence of both @xmath266 and @xmath267 is negligible , but the dependence on @xmath2 ( and therefore on redshift @xmath5 ) is rather strong , particularly in the case of @xmath267 .",
    "these two scalings presented in equations  [ app4:eq1 ] and [ app4:eq2 ] have been obtained as a fit to the numerical results for values of the linear density in the range @xmath271 , as in the previous appendix .",
    "we have checked that changing the range of integration may produce changes on the exponent of these scalings up to the order of 10 per cent .",
    "the exponent in both cases has been fitted in the mass range @xmath272 .",
    "finally , it must be noted that the range of values of @xmath2 and @xmath3 used to obtain this fit is roughly a factor two around the reference model ( i.e. @xmath273 and @xmath274 ) .",
    "thus , it can not be safely extrapolated beyond @xmath275 .",
    "furthermore , for large redshift values ( @xmath276 ) , the considerations contained in @xcite must be taken into account ."
  ],
  "abstract_text": [
    "<S> the unconditional mass function ( umf ) of dark matter haloes has been determined accurately in the literature , showing excellent agreement with high resolution numerical simulations . however , </S>",
    "<S> this is not the case for the conditional mass function ( cmf ) . here </S>",
    "<S> , we propose a simple analytical procedure to derive the cmf by rescaling the umf to the constrained environment using the appropriate mean and variance of the density field at the constrained point . </S>",
    "<S> this method introduces two major modifications with respect to the standard re - scaling procedure . </S>",
    "<S> first of all , rather than using in the scaling procedure the properties of the environment averaged over all the conditioning region , we implement the re - scaling locally . </S>",
    "<S> we show that for high masses this modification may lead to substantially different results . </S>",
    "<S> secondly , we modify the ( local ) standard re - scaling procedure in such a manner as to force normalisation , in the sense that when one integrates the cmf over all possible values of the constraint multiplied by their corresponding probability distribution , the umf is recovered . in practise , we do this by replacing in the standard procedure the value @xmath0 ( the linear density contrast for collapse ) by certain adjustable effective parameter @xmath1 . in order to test the method </S>",
    "<S> , we compare our prescription with the results obtained from numerical simulations in voids @xcite . </S>",
    "<S> we find that when our modified re - scaling is applied locally to any existing numerical fit of the umf , and the appropriate value for @xmath1 is chosen , the resulting cmf is , in all cases , in very good agreement with the numerical results . based on these results , </S>",
    "<S> we finally present a very accurate analytical fit to the ( accumulated ) conditional mass function obtained with our procedure , as a function of the parameters that describe the conditioning region ( size and mean linear density contrast ) , the redshift and the relevant cosmological parameters ( @xmath2 and @xmath3 ) . </S>",
    "<S> this analytical fit may be useful for any theoretical treatment of the large scale structure , and has been already used successfully in regard with the statistic of voids .    </S>",
    "<S> [ firstpage ]    methods : analytical  methods : statistical  cosmology : theory  dark matter  large - scale structure of the universe </S>"
  ]
}