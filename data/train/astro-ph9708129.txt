{
  "article_text": [
    "gravitational lensing systems have relatively simple geometry and most of them are cosmological in nature because of their scale .",
    "these two facts have stimulated cosmologists in the last few decades to use gravitational lensing as a tool in physical cosmology .",
    "there are four distinct applications of gravitational lenses to cosmology .",
    "( a )  observations of lensed sources provide information about the mass and density structure of the lens ( zwicky 1937a , b ) .",
    "( b )  lensed sources are amplified , and therefore easier to detect and resolve ( zwicky 1937a , b ) .",
    "( c )  lensing of distant sources can be used to measure distances on cosmological scales ( klimov 1963 ; liebes 1964 ; refsdal 1964 ) .",
    "( d )  microlensing can be used to study the stellar composition of the lens ( chang & refsdal 1979 ) . for a review of these various applications of gravitational lensing",
    ", we refer the reader to blandford & nayaran ( 1992 ) , and references therein . in this paper",
    ", we specifically focus on the problem of determining the nature and structure of the universe , using gravitational lensing of distant sources ( quasars ) .",
    "the _ nature _ of the universe is described by friedmann- cosmological models .",
    "such models describe idealized universes which are structureless , and obey the weak cosmological principle ( homogeneity and isotropy ) .",
    "a matter - dominated friedmann- model is characterized by the present values of the density parameter @xmath7 and the hubble constant  @xmath9 .",
    "all other cosmological parameters , such as the age of the universe @xmath10 , the matter density @xmath11 , the deceleration parameter @xmath12 , or the curvature parameter @xmath13 , can be expressed in terms of @xmath7 and @xmath9 .",
    "if the universe contains additional components , such as radiation , cosmic strings , domain walls , or a nonzero cosmological constant , the model describing this universe has one additional parameter for each component , which measures the contribution of that component to the energy density of the universe .",
    "gravitational lensing of distant quasars can be used to measure ( or constrain ) the value of these cosmological parameters , in two different ways .",
    "first , the angular diameter distances between the source , the lens , and the observer enter into the lens equation ( schneider , ehlers , & falco 1992 , and references therein ) .",
    "therefore , observables such as amplification , time delays , or image splitting will depend on these distances .",
    "since the relationship between the angular diameter distance and the redshift is model - dependent ( weinberg 1972 ; fukugita et al .",
    "1992 ) , we can use observations of lensed quasars to estimate @xmath7 and @xmath9 .",
    "second , the probability that a distant quasar will be lensed increases with the distance between that quasar and the observer , since a larger distance implies a larger amount of matter along the line of sight .",
    "hence , by using the _ fraction _ of lensed quasars , we can probe the distance - redshift relation and estimate the cosmological parameters .",
    "the _ structure _ of the universe represents the deviations from homogeneity and isotropy .",
    "these deviations are usually described in terms of primordial fluctuations that grow with time as a result of gravitational instability , to eventually form the large - scale structures of the universe , galaxies , clusters , and voids ( peebles 1980 ) . for most cosmological models ,",
    "the primordial density fluctuations originate from a gaussian random process , and therefore are characterized entirely by a density power spectrum .",
    "there are numerous cosmological models describing the formation of large - scale structures in the universe ( cold dark matter , hot dark matter , mixed dark matter , @xmath14 ) , each model having its own power spectrum .",
    "since the formation and evolution of large - scale structures are responsible for forming the lenses , observations of lensed sources can be used to measure the amplitude and possibly the shape of the power spectrum , and to ultimately determine the correct cosmological model for large - scale structure formation .    to apply these methods",
    ", we need to study the propagation of light in inhomogeneous universes described by particular cosmological models .",
    "the most common approach consists of using numerical methods to simulate both the formation of large - scale structures in an expanding universe and the propagation of photons through these structures . with the existence of compact inhomogeneities in the universe",
    ", it is reasonable to suspect that a light beam from a distant source undergoes a series of perturbations while traveling to the observer .",
    "we can simulate the effect of these perturbations by dividing the space between the source and the observer into redshifts intervals , and then projecting the matter inside each interval onto a plane normal to the line of sight , called a lens plane .",
    "in this so - called _ thin - lens approximation _ , the deflection of light resulting from each lens plane can be computed using geometrical optics .",
    "we can follow the evolution of a light beam propagating through the inhomogeneities , adding successively the contributions of each lens plane to the deflection and deformation of the beam ( blandford & nayaran 1986 ; blandford & kochanek 1987 ; schneider & weiss 1988a , b ; jaroszyski et al .",
    "1990 ; jaroszyski 1991 , 1992 ; babul & lee 1991 ; bartelmann & schneider 1991 ; wambsganss , cen , & ostriker 1996 ; see also kochanek & apostolakis 1988 ; paczyski & wambsganss 1989 ) .",
    "this _ multiple lens - plane method _ is discussed in detail in schneider et al .",
    "( 1992 , chap .",
    "9 ) .    to apply the multiple lens - plane method , we need to generate the surface density on each lens plane .",
    "the simplest method consists of distributing equal - mass objects ( galaxies or dark halo ) randomly in space , schneider &  weiss ( 1988b ) , paczyski & wambsganss ( 1989 ) , and lee & paczyski ( 1990 ) have used this method to obtain statistics for shear and amplification caused by gravitational lensing .",
    "the obvious drawback of this approach is that it completely ignores the large - scale structure formation models that are responsible for the formation of inhomogeneities , as well as the observed properties of these inhomogeneities , such as the galaxy 2-point correlation function or the morphology - density relation .",
    "these simulations are useful for studying the properties of gravitational lenses , and their dependence upon cosmological parameters such as @xmath7 and @xmath9 , but do not provide any information or constraint on the large - scale structure formation scenario .",
    "furthermore , since the known properties of galaxy clustering in the universe are ignored , these randomly - generated distributions of deflectors are unrealistic , and the relevance of the results is unclear .    several authors have described analytical methods for generating mass distributions that are consistent with particular cosmological models .",
    "babul & lee ( 1991 ) have developed an analytical model in which the effect of large - scale structure enters the calculation of light propagation through the density auto - correlation function @xmath15 .",
    "since this function is the fourier transform of the density power spectrum , this method effectively distinguishes among different models of structure formation .",
    "bartelmann & schneider ( 1991 ) use the semi - analytical model of buchert ( 1989 ) to generate large - scale structure for an einstein - de  sitter model with a flat perturbation spectrum .",
    "jaroszyski ( 1991 , 1992 ) generates initial density fluctuations that reproduces a particular power spectrum , and then uses the zeldovich approximation to simulate the evolution of these density fluctuations .",
    "he then locates galaxies in each lens plane using an empirical method based on the local matter density . by combining the schechter luminosity function with a monte carlo method",
    ", he generates a luminosity for each galaxy , chooses a morphological type at random , and then model that galaxy using a non - singular isothermal profile whose parameters are related to the luminosity and morphological type of the galaxy .",
    "this constitutes a major improvement over previous work , in three different ways .",
    "( a )  the method takes into account the fact that the large - scale structures in the universe do originate from the growth of primordial fluctuations , and allows for experimentations with different power spectra .",
    "( b )  the galaxies have a spectrum of luminosity and masses that reproduce observations .",
    "( c )  the method takes into account the existence of various galaxy morphological types ( ellipticals , s0 s , and spirals ) , by ascribing different surface density profiles to galaxies of different types .",
    "there are still several weaknesses in the approach used by jaroszyski .",
    "first , the zeldovich approximation is based on linear perturbation theory , and therefore underestimates the growth of large - scale structures in overdense regions .",
    "this can be a serious problem since these overdense regions are the one most likely to affect significantly the evolution of the beam .",
    "second , while this method acknowledges the existence of various morphological types , the morphological type of each galaxy is chosen randomly .",
    "this ignores the existence of the _ morphology - density relation _ ( dressler 1980 ; postman & geller 1984 ) , which relates the likelihood of any galaxy to have a particular morphological type to the richness of the environment in which that galaxy is located .    in an earlier paper ( jaroszyski et al .",
    "1990 ) , a particle - mesh [ pm ] code was used for generating the large - scale structure of the universe .",
    "this approach constitutes a significant improvement over using the zeldovich approximation .",
    "however , that paper did not include a treatment of the galaxies similar to the one in jaroszyski ( 1991 , 1992 ) .",
    "blandford et al . (",
    "1991 ) also used a pm code for generating the large - scale structure , and also considered the alternative approach of representing galaxies by randomly distributed isothermal spheres .",
    "however , they did not take the additional step of combining the results of the pm simulations with the density profiles of galaxies , as we shall do in this paper .",
    "there is also a potential problem with some of the methods described above . in several cases , only the matter located near the beam is included in the calculation of the deflection and deformation of the beam .",
    "the influence of distant matter is neglected .",
    "neglecting the contribution of distant matter is probably correct if the galaxy distributions are generated randomly , but , as we said , these galaxy distribution are unrealistic to start with .",
    "the analytical methods and pm simulations described above allow the formation of large - scale structures such as clusters of galaxies .",
    "as blandford et al .",
    "( 1991 ) showed , the effect of distant clusters on the evolution of the beam can be important ( this is supported by the analytical work of kaiser [ 1992 ] ) .    in this paper , we present a new method which addresses all these various concerns . in designing this method ,",
    "our main goal was to generate matter distributions that take into account all the known constraints imposed by large - scale structure formations models and by observations of the actual distribution , morphological types , and structure of galaxies in the universe . to achieve this goal",
    ", we use a state - of - the - art particle - particle / particle - mesh ( @xmath16 ) code ( hockney & eastwood 1981 ) to simulate the formation and evolution of large - scale structure in the universe .",
    "for all simulations presented in this paper , we use a cold dark matter density power spectrum normalized to cobe , but the method can be used with any power spectrum and any normalization . using the particle distributions generated by the p@xmath1 m code , we locate the galaxies ( in the densest regions ) , using a monte carlo method that reproduces the observed galaxy 2-point correlation function fairly well ( within the limitation of cdm model ) .",
    "then , instead of randomly choosing the morphological type of each galaxy , a method which ignores the existence of morphological segregation , we determine the morphological type of each galaxy according to the local environment , using the observed morphology - density relation ( martel , premadi , &  matzner 1997a , hereafter mpm ) . each galaxy is given a surface density profile which is chosen according to the galaxy luminosity and morphological type , as in jaroszyski ( 1992 ) . by combining the distribution of background matter simulated by the p@xmath1 m algorithm with the distribution and surface densities of galaxies",
    ", we are effectively describing the surface density of the lens planes over 9 orders of magnitude in length , from the size of the largest superclusters and voids , @xmath17 , down to the core radii of the smallest galaxies , @xmath18 .",
    "this approach for generating the surface density on the lens planes , the key part of any multiple lens - plane algorithm , differs significantly from all the ones that have been published previously . in their early work , schneider & weiss ( 1988a , b ) distributed clumps of equal masses randomly on the lens planes , thus ignoring both the existence of large - scale structure and the mass spectrum and structure of galaxies .",
    "jaroszyski et al . (",
    "1990 ) and wambsganss et al .",
    "( 1996 ) simulated the formation of large - scale structure , but did not take galaxies into account .",
    "blandford et al . (",
    "1991 ) performed n - body simulation of large - scale structure formation , and also computed the deflection of light by randomly distributed galaxies .",
    "however , they considered these two approaches separately , and did not choose the location of the galaxies according to the results of the n - body simulations , as we do in this paper . the only algorithm which combines",
    "large - scale structure formation with galaxies is the one described by jaroszyski ( 1991 , 1992 ) .",
    "however , the evolution of the large - scale structure in that algorithm was simulated using the zeldovich approximation instead of a n - body code .",
    "furthermore , the contribution of distant matter to the evolution of the beam was ignored .",
    "our algorithm is also the first that takes the morphology - density relation into account .",
    "the reason is clear : none of the previous algorithms could have done it , either because galaxies were ignored , or the process of cluster formation was either ignored or approximated , making the morphology - density relation unapplicable .",
    "the combination of fully nonlinear large - scale structure formation , galaxy distributions that reproduce the observed 2-point correlation function , morphological type distributions that reproduce the observed morphology - density relation , and galaxy surface density profiles , gives to the matter distribution in our algorithm a level of realism that was not present in any of the previous studies .",
    "of course , the algorithms used by previous authors can be perfectly adequate , depending on the particular problem that is being studied , and have produced very interesting results .",
    "we feel , however , that for the purpose of determining the correct cosmological model of structure formation in the universe , and the value of the cosmological parameters , it is critical to generate matter distribution that are as realistic as possible , over the largest possible range of length scales .",
    "this was our goal in designing this algorithm .",
    "we briefly review the theory of gravitational lensing in  2 , mentioning only the aspects which are directly relevant to this paper . in ",
    "3 we describe the method for generating the large - scale mass distribution of the universe . the simulation of the light propagation and the resulting statistics are described in  4 .",
    "summary and conclusion are presented in  5 .",
    "with the existence of compact inhomogeneities in our universe , it is reasonable to suspect that a light bundle from a distant source undergoes a series of perturbations due to those inhomogeneities while traveling to the observer .",
    "we attempt to use a series of gravitational lensings to approximate this phenomena .",
    "first , we idealize the inhomogeneities as being distributed on thin sheets , called lens planes , which are arranged perpendicular to the line of sight .",
    "we assume that lensing only takes place on each of those planes .",
    "this way we can analyze the lensing properties of each plane separately , and let the light beam carries the effect of lensing while propagating from one plane to the next .",
    "this is known as the multiple lens - plane method ( schneider et al .",
    "1992 ) .",
    "consider @xmath19 lens planes located at redshifts @xmath20 , with @xmath21 , and ordered such that @xmath22 for @xmath23 .",
    "figure  1 shows an example with @xmath24 .",
    "all angles are greatly exaggerated . each lens plane is characterized by its respective surface mass density @xmath25 , where @xmath26 is the impact vector of the ray on the @xmath27-th lens plane .",
    "let @xmath28 denote the deflection angle the light ray experiences on the @xmath27-th plane at a position @xmath26 . from this geometry",
    ", we can derive the _ lens equation _",
    ", @xmath29    where @xmath30 is source position vector ( on the source plane ) , @xmath26 is the impact vector on the @xmath27-th plane , @xmath31 is the angular diameter distance between the @xmath32-th plane and the observer , and @xmath33 is the angular diameter distance between the @xmath27-th and @xmath32-th planes , with @xmath34 identifying the source plane . knowing the impact vector @xmath35 on the image plane , the impact vector on subsequent planes can be obtained recursively using @xmath36    the deflection angle is related to the surface density by @xmath37    where @xmath38 is the gravitational constant , @xmath39 is the speed of light , and the integral extends over the lens plane .",
    "we can rewrite this expression conveniently as @xmath40    it is useful to rewrite these equations in a dimensionless form .",
    "we define for each lens plane a critical surface density as @xmath41    and introduce the following dimensionless quantities , @xmath42    equations ( 2 ) , ( 4 ) , and ( 5 ) reduce to @xmath43    where @xmath44    and the gradient is now taken relative to @xmath45 . by using the identity @xmath46 ( where @xmath47 is the two - dimensional delta function ) ,",
    "we can invert equation  ( 11 ) , and get @xmath48    to compute the scaled position @xmath49 of the source on the source plane , we simply set @xmath50 .",
    "equation  ( 12 ) gives @xmath51 , and equation  ( 9 ) becomes @xmath52    this ray - tracing equation is a mapping from the image plane ( @xmath53 ) onto the source plane ( @xmath54 ) .      since we are using the filled - beam approximation , the relevant distances to use in the lens equations are the angular diameter distances in an homogeneous friedmann universe ( schneider & weiss 1988a ) .",
    "for the cosmological models considered in this paper , all the appropriate distance formulae are given in fukugita et al .",
    "for the einstein - de  sitter model , the angular diameter distance @xmath55 between redshifts @xmath56 and @xmath57 is @xmath58\\,,\\ ] ]    where @xmath59 is the hubble radius . for the open model with @xmath60 ,",
    "the distance is @xmath61\\,.\\ ] ]    finally , for the flat model with nonzero cosmological constant , the distance is @xmath62^{-1/2}\\,.\\ ] ]    of course , equation  ( 15 ) is a special case of both equations  ( 16 ) and  ( 17 ) . in all cases",
    ", we are assuming @xmath63 , which gives @xmath64 .",
    "figure  2 shows the angular diameter distances @xmath65 for all three cosmological models considered in this paper .",
    "the effect of each lens plane on the evolution of the beam is described by the following jacobian matrix , @xmath66    where the commas denote differentiation with respect to the components of @xmath45 . since @xmath67 , and equation  ( 13 )",
    "gives @xmath68 , we can rewrite equation  ( 18 ) as @xmath69    where @xmath70",
    "we now define @xmath71    the determinant and trace of @xmath72 can be expressed entirely in terms of @xmath73 and @xmath74 , as follows : @xmath75    the quantities @xmath76 , @xmath77 , and @xmath74 are called _ magnification _ , _ convergence _ ( or ricci focusing ) , and _ shear _ , respectively .    to compute the cumulative effect of all the lens planes , we consider the jacobian matrix of the mapping given by equation  ( 14 ) , @xmath78    where @xmath79 is the @xmath80 identity matrix , and @xmath81 and @xmath82 are defined by @xmath83    after substituting equation  ( 10 ) into equation  ( 26 ) , we get @xmath84    where @xmath72 is given by equation  ( 18 ) .",
    "hence , @xmath81 describes the effect the @xmath27-th plane would have on the beam if all the other planes were absent , and equation  ( 25 ) simply combines the effect of all the planes . to compute the matrices @xmath82 , we differentiate equation  ( 9 ) , and get @xmath85    since @xmath86",
    ", we can use equation  ( 29 ) to compute all matricies @xmath82 by recurrence .",
    "the image of a small circular source is essentially constant across the area of the source . ]",
    "is an ellipse with semi - axes @xmath87 and @xmath88 , where @xmath89 is the radius of the image in the absence of lensing .",
    "it can be shown that @xmath90    we can solve these equations for @xmath91 and @xmath92 .",
    "assuming @xmath93 , we can then compute the aspect ratio of the image .",
    "after some algebra , we get @xmath94 ^ 2 -4(\\det{\\bf b})^2\\right\\}^{1/2}\\over2\\det{\\bf b}}\\,.\\ ] ]    the magnification is given by @xmath95",
    "light rays coming from distant sources are propagating through the universe while the large - scale structure in the universe is forming and evolving .",
    "ultimately , it would be desirable to simulate the evolution of large - scale structure and the light propagation simultaneously",
    ". however , such approach would be rather difficult , and is beyond the reach of present computer capabilities .",
    "the great advantage of using the multiple lens - plane method is that it allows us to consider the large - scale structure evolution problem and the light propagation problem separately , thus effectively breaking up the problem into two steps .",
    "the first step consists of generating the large - scale structure and galaxy distribution in the universe at various redshifts , and projecting these distributions onto lens planes , normal to the optical axis .",
    "then , once these lens planes are generated , we can compute numerically the trajectory of light rays through them , using the formalism described in  2 .",
    "clearly , many different experiments can be conducted using the same set of lens planes , simply by varying the shape , size , and number of rays in the beam , or the location of the beam on the planes .    in ",
    " 3.2 and  3.3 , we describe the method we use for generating galaxy distributions .",
    "several aspects of this method were previously discussed in detail in mpm , so we only give a brief summary .",
    "the ray - shooting method is described in  3.4 .",
    "all n - body simulations presented in this paper are done using the p@xmath1 m algorithm ( hockney &  eastwood 1981 ) .",
    "the calculations evolve a system of gravitationally interacting particles in a cubic volume with triply periodic boundary conditions , comoving with hubble flow .",
    "the forces on particles are computed by solving poisson equation on a cubic grid using a fast fourier transform method .",
    "the resulting force field represents the newtonian interaction between particles down to a separation of a few mesh spacings . at shorter distances",
    "the computed force is significantly smaller than the physical force . to increase the dynamical range of the code ,",
    "the force at short distance is corrected by direct summation over pairs of particles separated by less than some cutoff distance  @xmath97 . with the addition of this so - called _ short - range correction _ , the code accurately reproduces the newtonian interaction down to the softening length  @xmath98 . in all calculations , @xmath98 and @xmath97",
    "were set equal to 0.3 and 2.7 mesh spacing , respectively , with @xmath99 particles and a @xmath100 grid . with these particular values",
    ", the code has a dynamical range of three orders of magnitude in length .",
    "the system is evolved forward in time using a second order runge - kutta time - integration scheme with a variable time step .      to implement the multiple lens - plane method",
    ", we divide the space between @xmath0 and @xmath101 into a chain of cubic boxes of equal comoving size  @xmath102 .",
    "we first need to determine the redshifts of the interfaces between these cubic boxes .",
    "let us assume that the photons that are reaching the observer at present entered a particular box at time @xmath103 , redshift @xmath104 and exited that box at time @xmath105 , redshift @xmath106 .",
    "the redshifts @xmath104 and @xmath106 are related by @xmath107c\\,dt\\,,\\ ] ]    where @xmath39 is the speed of light . using this equation , with the appropriate relation for @xmath108",
    ", we can find the redshifts of the interfaces .",
    "the front side of the box closest the the observer is , by definition , at @xmath0 . plugging this value into equation  ( 34 ) gives us the redshift @xmath104 of the back side of the box , which is also the redshift @xmath106 of the front side of the next box .",
    "then , by using equation  ( 34 ) recursively , we can compute the redshifts of all the interfaces . the derivation of the recurrence relations for the einstein - de  sitter model ( @xmath2 , @xmath109 ) , open models ( @xmath60 , @xmath109 ) , and flat models with a nonzero cosmological constant ( @xmath110 ) are presented in detail in premadi ( 1996 ) .",
    "next , we need to determine the matter distribution inside each box .",
    "however , during the time photons propagate across a particular box , the matter distribution inside that box evolves . in the thin - lens approximation",
    ", we need to choose for each box a `` snapshot redshift '' @xmath111 between the redshift @xmath104 when the photons enter the box and the redshift @xmath106 when the photons exit the box , generate the matter distribution at that redshift , and make the approximation that this distribution is valid at all redshifts between @xmath104 and @xmath106 .",
    "then , we need to choose a `` projection redshift '' @xmath112 , also between @xmath104 and @xmath106 , which is the redshift of the plane onto which we project the three - dimensional distribution of galaxies .",
    "we decided to set the projection redshift @xmath112 equal to the snapshot redshift @xmath111 , as every other author does .",
    "schneider &  weiss ( 1988b , eq .  [ 8 ] ) choose for the snapshot redshift @xmath111 the arithmetic mean @xmath113 .",
    "we decided to improve on this , by determining the snapshot redshift as follows : since the deflection angle varies linearly with the surface density of the lens plane , we choose @xmath111 to be the redshift at which the density contrast @xmath114 is equal , at each point , to the time - averaged value @xmath115 of the density contrast at that point between @xmath104 and @xmath106 ( this only makes sense in the context of linear perturbation theory , where the density contrast at any given point evolves independently of the density contrast at other points ) .",
    "for the einstein - de  sitter model , the linear density contrast @xmath116 , where @xmath10 is the present time and @xmath117 is a constant .",
    "the time - averaged linear density contrast between two epochs @xmath103 and @xmath105 is then given by @xmath118\\,.\\ ] ]    we set @xmath119 , and solve for @xmath111 as a function of @xmath104 and @xmath106 .",
    "we get @xmath120 - 1\\,.\\ ] ]    computing @xmath111 for the other models is a significantly more complicated procedure , and constitutes an overkill .",
    "equation  ( 36 ) is valid at high redshift , where all models resemble the einstein - de  sitter model . at low redshift ,",
    "linear theory is inaccurate whether we use the correct model or not .",
    "however , equation  ( 36 ) reduces to the schneider &  weiss formula @xmath121 in the low redshift limit .",
    "hence , it is correct to use equation  ( 36 ) for all cosmological models , and it constitutes an improvement over the formula used by schneider & weiss  ( 1988b )        the method we use for computing the galaxy locations was described in great detail in mpm . in this subsection",
    ", we give a brief summary of the method .",
    "it consists of three parts .",
    "first , we determine the locations of the galaxies at @xmath0 .",
    "second , we ascribe to each galaxy a morphological type ( e , s0 , or spiral ) . finally , we trace the galaxies back in time to determine their locations on each lens plane .",
    "we consider the large - scale structure at present ( @xmath0 ) resulting from the p@xmath1 m simulations , and design an empirical monte - carlo method for locating galaxies in the computational volume , based on the constraints that ( 1 ) galaxies should be predominantly located in the densest regions , and ( 2 ) the resulting distribution of galaxies should resemble the observed distribution on the sky .",
    "our method is the following : we divide the present computational volume into @xmath100 cubic cells of size @xmath122 , and compute the matter density @xmath123 at the center of each cell , using the same mass assignment scheme as in the p@xmath1 m code .",
    "we then choose a particular density threshold @xmath124 .",
    "we locate @xmath19 galaxies in each cell , where @xmath19 is given by @xmath125    the actual location of each galaxy is chosen to be the center of the cell , plus a random offset of order of the cell size .",
    "this eliminates any spurious effect introduced by the use of a grid .",
    "we then experiment with various values of the density threshold @xmath124 until the total number of galaxies comes out to be of order 40000 .",
    "this gives a number density of @xmath126 .",
    "this method bears some similarities with the one used by jaroszyski ( 1991 , 1992 ) .",
    "tests showed that the observed galaxy 2-point correlation function is fairly well reproduced ( mpm ) .",
    "there is a well - known observed relationship between the distribution of morphological types and the surface density of galaxies ( dressler 1980 ; postman & geller 1984 ) .",
    "regions of the sky with high concentration of galaxies contain on average more elliptical and s0 s and less spiral than regions with lower concentration of galaxies . by combining this relation with a monte - carlo method",
    ", we can ascribe a morphological type to each galaxy , as follows .",
    "we first compute the volume number density of galaxies @xmath127 around each galaxy , using @xmath128    where @xmath129 is a positive integer , and @xmath130 is the distance of the @xmath131 nearest neighboring galaxy . in all cases ,",
    "we choose @xmath132 .",
    "once the densities are computed , we compute the fractions @xmath133 , @xmath134 , and @xmath135 of spirals , s0 s , and ellipticals , respectively , from the morphology - density relation .",
    "we then ascribe a morphological type to each galaxy by generating a random number @xmath136 between 0 and 1 ( with uniform probability ) .",
    "the galaxy is identified as a spiral if @xmath137 , a s0 if @xmath138 , and an elliptical if @xmath139 .",
    "the p@xmath1 m algorithm provides us with the distributions of particles at various intermediate redshifts between the initial redshift and the present , and , in particular , at all snapshots redshifts @xmath140 , @xmath141 . by combining these particle distributions with our simulated galaxy distributions at present",
    ", we can trace galaxies back in time and reconstruct their trajectories . to do this",
    ", we simply find the nearest particle @xmath142 of each galaxy @xmath143 at present ( where the subscript @xmath13 identifies the galaxy ) .",
    "then we `` tie '' the galaxy @xmath143 to that nearest particle .",
    "the location of the galaxy @xmath143 at any redshift @xmath106 is then given by : @xmath144+{\\bf r}'\\,,\\ ] ]    where @xmath145 is a small random offset , which we introduce to avoid the unfortunate situation of having two galaxies located at the top of each other because they happen to by tied to the same particle .",
    "this allows us to construct galaxy distributions at any redshift .      to determine the physical parameters of each galaxy , we start by assuming that the present galaxy luminosities follow the schechter luminosity function , @xmath146    where @xmath147 is the number density of galaxies per unit luminosity .",
    "the parameters @xmath148 , @xmath149 , and @xmath150 are obtained from observation as follows : @xmath151 , @xmath152 , and @xmath153 , where @xmath154 is the luminosity in the @xmath155 band ( efstathiou , ellis , & peterson 1988 , hereafter eep ) .",
    "there is a fourth parameter , the luminosity @xmath156 of the faintest galaxies , which must be introduced to prevent the total number of galaxies from diverging .",
    "we now make the assumption that the numerical values of @xmath150 and @xmath149 given in eep are quite reliable , but the numerical values of @xmath148 and @xmath156 might be less reliable , because of the difficulty of detecting galaxies at the low - luminosity end . instead , we shall solve for the values of @xmath148 and @xmath156 .",
    "this requires two constraints .",
    "we impose that the mean density @xmath157 of galaxies matches the value of @xmath158 that we assume in our simulations , and that the mean luminosity density matches the value @xmath159 given in eep .",
    "equation  ( 40 ) allows us to directly compute the present number density @xmath157 , and luminosity density @xmath160 , @xmath161\\,,\\end{aligned}\\ ] ]    where @xmath162 and @xmath163 . the last equality in equation  ( 42 )",
    "was obtained by integrating by part , and then substituting in equation  ( 41 ) .",
    "we now substitute the numerical values of @xmath149 , @xmath164 , and @xmath150 ( with @xmath165 ) , and get , @xmath166    this system of equations can be solved numerically for @xmath167 and @xmath168 .",
    "the solution is @xmath169    since , for all calculations presented in this paper , we assume a hubble constant of @xmath170 , equation  ( 45 ) can be rewritten as @xmath171 , which is , within error bars , consistent with the value given in eep .",
    "we adopt the galaxy models described in jaroszyski ( 1991,1992 ) .",
    "the projected surface density of each galaxy is given by @xmath172    where @xmath89 is the projected distance from the center .",
    "the parameters @xmath173 , @xmath174 , and @xmath175 are the core radius , maximum radius , and velocity dispersion , respectively , and are given by @xmath176    @xmath177    @xmath178    we use a monte - carlo method to generate for each galaxy a luminosity @xmath179 , with a probability @xmath180 proportional to @xmath147 .",
    "this ensures that the ensemble of @xmath181 galaxies in the computational volume follow the luminosity function given by equation  ( 40 ) .",
    "then , we compute the galaxy parameters using equations  ( 48)(50 )",
    ".        since each plane represents a different region of the universe , the large - scale structure inside each plane should be uncorrelated with the large - scale structure inside the neighboring planes .",
    "this is clearly a problem if the lens planes originate from one single calculation , since they would then represent the same large - scale structure at various evolutionary stages . to solve this problem , we perform five independent calculations for each cosmological model , by using five different sets of initial conditions .",
    "we then choose randomly which calculation will provide each lens plane , making sure that two consecutive lens planes never come from the same calculation . to eliminate correlations even more ,",
    "we make use of the periodic boundary conditions by giving to the galaxy and background matter distributions in each lens plane a random shift .",
    "this is equivalent to choosing randomly on each lens plane the location where the beam will hit .",
    "we could eliminate correlations even more by rotating and/or reflecting the galaxy distributions before projecting them onto the lens planes , using the 48-fold symmetry of the cubic computational volume , but we consider this to be an overkill .      in this paper , we use the term `` background matter '' to refer to the total matter in the universe , if the presence of galaxies is ignored . hence , the distribution of background matter in the universe at various redshifts is what the p@xmath1 m code simulates . to compute the effect of the background matter on the propagation of the beam , we solve equation  ( 13 ) numerically on a two - dimensional grid ( a similar technique was used by blandford et al . [ 1991 ] ) .",
    "we compute the right - hand side of equation  ( 13 ) on a square grid , using the location of the particles provided by the p@xmath1 m code , and invert equation  ( 13 ) using a fast fourier transform method which is essentially the method that the p@xmath1 m algorithm itself uses for solving the three - dimensional poisson equation .",
    "the details of the calculation are given in appendix  a.    for all simulations presented in this paper , the comoving size @xmath102 of the computational volume was @xmath182 , and the grid used for solving equation  ( 13 ) was @xmath183 in size .",
    "therefore , the grid spacing at redshift @xmath106 was @xmath184 .",
    "this has the effect of smoothing out any density fluctuation in the background matter on scales below @xmath185 .",
    "this is consistent with the assumption made by jaroszyski ( 1991 ) that the actual background matter distribution in the universe at that scale should be smooth .",
    "of course , galaxies contain dark matter halos with are presumably smaller than this , but these dark matter halos are taken into account in the galaxy profiles given by equation  ( 47 ) . in this subsection , we are considering the smoother component of the background matter that has not been accumulated into galactic halos .",
    "the calculation of the background matter potential described above is sufficient for computing the effect of distant matter on the propagation of the beam .",
    "however , at distances less than a few mpc s , we can not ignore the fact that matter has collapsed to form galactic - size objects which are much smaller than the resolution of the p@xmath1 m algorithm or the algorithm used for solving equation  ( 13 ) .",
    "this is why we added galaxies to the simulations using the method described in  3.3 .",
    "each lens plane contains about 40000 galaxies , but only the ones located near the beam can have a significant effect on its evolution .",
    "this enables us to greatly reduce the computation time by only including nearby galaxies .",
    "we identify one particular ray in the beam as being the `` central ray . ''",
    "then , in each lens plane , we only compute the contribution of the galaxies which are within a projected distance @xmath186 of the central beam . in this paper , we chose @xmath187 . hence , the mean number of galaxies per lens plane included in the calculation is @xmath188 . of course",
    ", the actual number varies over a wide range because galaxies are clustered .",
    "the calculation of the background matter contribution takes the _ total _ matter in the system into account .",
    "therefore , for every galaxy we add to the calculation , we must subtract something in order to conserve mass .",
    "we make the assumption that each galaxy has formed by accumulating matter that was originally distributed over a region of comoving radius @xmath189 , which is of order the present mean spacing between galaxies .",
    "this accumulated matter should be removed from the calculation .",
    "this is done by putting on the top of each galaxy a `` hole '' with radius @xmath190 and negative density , so that the combined mass of the galaxy and hole is zero . in this model ,",
    "each galaxy has formed by accumulating matter for a region of fixed size , the more massive galaxies simply accumulating more matter from that region .",
    "this model is of course crude .",
    "one might suggest that more massive galaxies accumulate matter from a larger region .",
    "however , the relation between the galaxy mass and the size of that region is unknown at present , due to our limited understanding of the galaxy formation process .",
    "furthermore , this relation most certainly depends of the environment ( whether the galaxy forms in isolation or in a cluster ) .",
    "until better models for galaxy formation are available , it is a reasonable approximation to use a constant value for @xmath191 . to eliminate spurious edge effects , we do not use a hole with a flat negative density profile .",
    "instead , we use a gaussian density profile with a fwhm equal to @xmath191 .",
    "the calculation of the potential for the galaxies and the holes are given in appendix  b.",
    "we consider three different cosmological models : an einstein - de  sitter model with @xmath2 , @xmath109 , an open model with @xmath3 , @xmath109 , and a flat , low - density model with @xmath3 , @xmath4 , where @xmath7 and @xmath192 are the present values of the density parameter and cosmological constant , respectively .",
    "we set the present value @xmath9 of the hubble constant equal to @xmath170 to avoid conflict between the models and the measurements of globular cluster ages . with these parameters ,",
    "the age of the universe @xmath10 is 13.0  gyr , 16.6  gyr , and 21.04  gyr for the einstein - de  sitter , open , and cosmological constant models , respectively .    in all cases ,",
    "the comoving length of the computational volume is @xmath193 ( present length units ) .",
    "the total mass of the system is @xmath194 .",
    "we use @xmath195 equal mass particles .",
    "the mass per particle is therefore @xmath196 for the einstein - de  sitter model and @xmath197 for the other two models .    for all simulations , we use the cold dark matter ( cdm ) power spectrum of bardeen et al .",
    "( 1986 ) , with the normalization of bunn , scott , & white ( 1995 ) .",
    "as mentioned in mpm , we use the same power spectrum for all three models , which is inconsistent , since the cdm power spectrum depends upon @xmath7 and @xmath192 . our motivation for doing",
    "this is the following : our goal in this paper is not to find which model fits the observations of the present universe better ( we defer this to a forthcoming paper ) .",
    "instead , we want to select cosmological models that will bracket the behavior of the large - scale structure formation process .",
    "using the same power spectrum for all models allows us to investigate directly the effects of the growth rate and the age of the universe on the evolution of the beam . in the same spirit",
    ", we are considering open models and models with a cosmological constant that are somewhat too extreme to agree with recent observations , which suggests that @xmath7 is more likely to be somewhere in the range 0.250.5 ( ostriker &  steinhardt 1995 ; martel , shapiro , &  weinberg 1997 , and references therein ) .",
    "models with a larger @xmath7 and/or a smaller @xmath192 would reproduce observations better , but would resemble the einstein - de  sitter model more than the ones we are considering , thus providing less insight on the effect of the cosmological parameters on the beam evolution .",
    "the reader should therefore keep in mind that the power spectra we are using for the open and cosmological constant models are not consistent with a standard cdm model , and are chosen only for practical considerations .",
    "we ran 5 simulations for each of the three cosmological models , for a total of 15 simulations . for each model ,",
    "the 5  simulations differ only in the ensemble of random phases used for generating the initial conditions ( see mpm ) .",
    "all simulations start at an initial redshift @xmath198 , and end at @xmath0 . in all experiments ,",
    "we propagate a beam composed of several light rays backward in time , starting from the image plane , located near the observer , and ending at the source plane , located at @xmath199 .",
    "there are 55 lens planes for the einstein - de  sitter model , 73 for the open model , ant 96 for the cosmological constant model .      in this experiment ,",
    "the light beams consist of 65 rays arranged in two concentric rings of 32 rays each , plus a center ray .",
    "the rings diameters on the image plane are @xmath200 and @xmath201 , corresponding to angular sizes 1.54 and 2.30 arc seconds , respectively .",
    "we performed 500 calculations for each of the 3 cosmological models .",
    "for each calculation , we used a different seed for the random number generator that computes the random shifts of the lens planes .",
    "hence , the calculations within each model differ from one another in the location on the lens planes where the beam hits .",
    "figure  3 shows the configuration of the beam on the source plane , located at @xmath199 , was determined by using equation  ( 34 ) with @xmath202 , and @xmath203 being the redshift of the last lens plane .",
    "the actual redshifts are @xmath204 , @xmath205 , and @xmath206 , for the einstein - de  sitter , open , and cosmological constant models , respectively ] for a subset of 27  calculations , 9 for each cosmological models .",
    "the labels `` eds , '' `` o , '' and `` @xmath207 '' in this figure and all the subsequent ones identify the einstein - de  sitter model , the open model , and the cosmological constant model , respectively .",
    "the panels labeled `` null '' show for comparison the configuration of the beam in the absence of lensing , computed using equation  ( 2 ) with @xmath208 .",
    "the size of the panels is @xmath209 .",
    "the beam has a smaller diameter for the eds model than the other two , because of the dependence of the lensing equation upon the angular diameter distance .",
    "the deformation of the beam is comparable for the eds and @xmath207 models .",
    "this results from the combination of two different effects that partly cancel each other : on one hand , the large - scale structure is more developed in the eds model than in the @xmath207 model .",
    "on the other hand , there are almost twice as many lens planes between @xmath0 and @xmath101 in the @xmath207 model than in the eds model .",
    "figure 4 shows the individual contribution of each lens plane to the shear as a function of the lens - plane redshift @xmath106 for 3 particular runs , one for each model .",
    "these results were obtained by averaging the magnification matrix over all 65 rays in the beam .",
    "the sharp variations result from the absence of correlation between neighboring lens planes .",
    "the beam may experience a strong shear in one particular plane simply because the beam happens to pass near a large cluster . in order to eliminate this source of noise",
    ", we average the shear over all 500 calculations for each model .",
    "the results are shown in figure  5 .",
    "the lens planes that contribute most to the shear are located at intermediate redshifts , of order @xmath6 , for all three models .",
    "the contribution of lens planes located near the source or near the observer is significantly smaller .",
    "figure  6 , shows the individual contribution of each lens plane to the magnification , as a function of the lens - plane redshift @xmath106 for 3 particular calculations , one for each model , using again the average magnification matrix .",
    "as in figure  4 , the large fluctuations are caused by the absence of correlations between consecutive lens planes .",
    "figure  7 shows the result of averaging the magnification over all 500 calculations for each model . as for the shear , the lens planes that contribute the most to the magnification",
    "are located at intermediate redshifts .",
    "notice that the average magnification is almost always larger than unity .",
    "this is not a violation of flux conservation .",
    "if we were averaging the magnification matrix over _ sources _ , the average magnification would be exactly unity .",
    "but we are instead averaging over _ light rays_. this clearly weights in favor of sources with @xmath210 , since more light rays originate from these sources , which is why they are magnified in the first place .",
    "hence , averaging the magnification matrix over light rays instead of sources will gives @xmath211 .",
    "the shear is much larger for the einstein - de  sitter model than the other two models .",
    "even though the large - scale structure is more evolved for the einstein - de  sitter model , this can not account for the difference .",
    "in particular , the cosmological constant model resembles the einstein - de  sitter model much more than the open model at late time ( mpm ) .",
    "hence , the differences between the structure in the various models is not sufficient to explain the results shown on figure  5 .",
    "the correct explanation is quite simple : though all models contain the same mass _ in galaxies _ , the _ total mass _ is 5 times larger for the einstein - de  sitter model than for the other two models , for which @xmath3 .",
    "we will prove this affirmation below . notice that even though the contribution of individual lens planes is larger for the einstein - de  sitter model , the number of such planes between @xmath0 and @xmath101 is smaller",
    ", so we do not necessarily expect the cumulative shear and magnification for distant sources to be larger for this model .    for all 1500 calculations , and all lens planes , we computed the ratio @xmath212 , which measures the relative contributions of the shear and convergence to the magnification ( see eq .",
    "the largest value was @xmath213 , implying that the contribution of the shear to the magnification is totally negligible , for all models , all calculations , and at all redshifts .",
    "this is a well - known result ( lee & paczyski 1990 ; jaroszyski et al . 1990 ) .    the most interesting result that comes out of these calculations is the fact that the largest contribution to both shear and magnification comes from matter located at intermediate redshifts .",
    "equation  ( 6 ) shows that the critical surface density is large for lens planes located near the image plane ( @xmath214 small ) , or near the source plane ( @xmath215 small ) , resulting in a small deflection potential at small and large redshifts , and therefore `` favoring '' the lens planes located at intermediate redshifts .",
    "however , large - scale structures grow with time , an effect that favors lens planes located at small redshift . furthermore",
    ", since we assume that the physical size of galaxies does not evolve , the total cross section of the galaxies is larger in the past since galaxies are closer to one another .",
    "hence , we expect a larger number of direct hits of galaxies by the beam at larger redshift . on figure  8",
    ", we plotted the number of galaxies hit by the beam at each redshift , averaged over all 500 calculations for each model ( which explains why the numbers are not integer ) .",
    "effectively , the number of galaxies hit increases monotonically with redshift , with an average of 1 galaxy hit by the beam at @xmath101 for the einstein - de  sitter model , and 2 for the other models ( the beams diverge more in the open and cosmological models that in the einstein - de  sitter model [ see figs .  2 and  3 ] ,",
    "so more galaxies get hit in these models ) .",
    "this shows that , in spite of the fact that there are more structures at small redshift and more galaxies hit at large redshift , the geometrical factors in equation  ( 6 ) dominate , making the individual contribution of lens planes to the shear and magnification larger at intermediate redshift .",
    "notice that on figure  5 , the average shear peaks at a redshift @xmath216 for the einstein - de  sitter model , while it peaks at redshift of order @xmath217 for the other models .",
    "we interpret this result as follows : in model with @xmath60 , the linear growth of the density perturbation `` freezes out '' at redshift @xmath218 , whereas in an @xmath2 model , linear growth persists all the way to the present . hence , in the einstein - de  sitter model , there is significant growth taking place at small redshift , giving a `` boost '' to the shear for lens planes located at @xmath216 relative to the ones located near @xmath219 .",
    "this effect results in a shift of the peak toward smaller redshift in figure  5 .",
    "figures  47 show the individual effect of each lens plane on the propagation of the beam . to get the cumulative effect of all the lens planes , we need to combine them using the formalism described in  2 .",
    "figure  9 ( solid lines ) shows the distributions of cumulative aspect ratios computed using equation  ( 32 ) .",
    "these distributions are very different for the different models .",
    "the distribution is narrow for the open model and broad for the other two models .",
    "the distributions have a very similar shape for the einstein - de  sitter and cosmological constant model , but the mean value of the distribution is significantly larger for the cosmological constant model .",
    "figure  10 ( solid lines ) shows the distributions of cumulative magnifications , computed using equation  ( 33 ) . as for the distributions of aspect ratios ,",
    "the distributions of magnifications are broad and similar in shape for the einstein - de  sitter and cosmological constant model , the latter one being shifted to larger values , while the distribution is narrow for the open model .",
    "these distributions are characterized by a sharp increase on the low side and a more extended tail on the high side .",
    "they are qualitatively in agreement with the analytical and numerical results obtained by various authors ( schneider & weiss 1988a ; lee & paczyski 1990 )    we ran an additional 450 calculations , 150 for each of the three cosmological model , with the source plane located at redshift @xmath220 instead of  5 .",
    "figures  9 and  10 ( dotted lines ) show the distributions of aspect ratios and magnifications for these calculations ( we multiplied the counts in each bin by @xmath221 to allow a direct comparison ) .",
    "they are qualitatively very similar to the distributions for sources located at @xmath222 .",
    "the aspects ratios are smaller , and the magnifications are closer to unity , but the relative similarity and differences between the various models are the same .",
    "the only difference is in the aspect ratios , where the distribution for the cosmological constant model is not shifted to larger values compared with the einstein - de  sitter model .",
    "the distributions of aspect ratios peak at values of order 1.1 , which is somewhat large compared with observation of lensed quasars at that redshift .",
    "this simply indicates that the standard cdm model normalized to cobe does not reproduce observations well .",
    "returning to the 1500 calculations with @xmath222 , we plot in figure  11 the average shear versus the redshift of the lens plane , where the shear is computed by including either the contribution of the background matter only ( solid curves ) or the contribution of the galaxies only ( dashed curves ) .",
    "notice that the total shear , shown in figure  5 , is not equal to the sum of these components , since it is the matrix elements @xmath223 and @xmath224 , and not the shear @xmath225 , that add up .",
    "this figure shows that the contributions of the background matter and galaxies are nearly identical for the open and cosmological constant model , while the background matter contribution greatly exceeds the galaxies contribution for the einstein - de  sitter model .",
    "this shows the importance of including the contribution of distant background matter to the evolution of the beam , something that was overlooked in some previous studies ( schneider & weiss 1988a , b ; jaroszyski 1991 , 1992 ) . we should point out , however , than these results are obtained by averaging over 500 calculations for each model . in one individual calculation",
    ", the effect of a single massive galaxy might dominate over the effect of the background if the beam hits or nearly hits that galaxy .      in this experiment ,",
    "the beam consists of @xmath226 light rays arranged in a square lattice .",
    "the spacing between rays on the source plane is 1 arcsecond , about the size of an extended radio source .",
    "we ran 10 simulations for each cosmological model .",
    "figure  12 shows the final configuration of the beam , for 6 particular runs , two for each model .",
    "the overall deformation of the square array into an irregular , 4-side polygon is caused by the background matter .",
    "this deformation is large for the einstein - de  sitter and cosmological constant models , and small for the open model , consistent with the results shown in figure  3 . in all cases ,",
    "there are small regions on the source plane where several rays converge .",
    "this convergence results from the presence of galaxies . a source located in one of these regions",
    "has in general multiple images .",
    "we could use these results to estimate the fraction of high - redshift quasars with multiple images simply by computing the fraction of the source plane which is covered by these regions . from figure  12",
    ", we can estimate that a few percent of high - redshift quasars have multiple images , by counting the number of rays in the regions of convergence .",
    "are known . ] to get statistically significant results , however , we need to perform many more calculations . also ,",
    "in order to estimate the multiplicity ( double , triple , ... ) of each lensing event , we need to improve the resolution of these calculations , by increasing the number of rays per unit solid angle in the beam . hence , the results we are presenting in this subsection are for illustrative purpose only .",
    "a detailed study of the statistics of multiple images of quasars will be presented in a forthcoming paper .",
    "we redid the calculation shown in the middle left panel of figure  12 with twice the resolution per dimension ( @xmath227  rays ) .",
    "the results are shown in figure  13 .",
    "increasing the resolution reveals several additional regions of convergence .",
    "only two such regions are clearly visible in figure  12 , whereas there are 6 clearly visible regions of convergence in figure  13 .",
    "we have developed a numerical algorithm for studying the propagation of light in inhomogeneous universes .",
    "this is the first algorithm that combines fully nonlinear n - body simulations of large - scale structure formation with realistic distributions of galaxies , reproduces the 2-point correlation function of galaxies , and takes the morphology - density relation into account when ascribing morphological types to galaxies . as a result",
    ", this algorithm reproduces the matter distribution in the universe with a level of realism that is unprecedented .",
    "the density structure of the lens planes is simulated over 9 orders of magnitude in length , from the size of superclusters and voids down to the core radii of small galaxies .",
    "we use this new algorithm to study the propagation of light beams in inhomogeneous universes , for three different cosmological models : the einstein - de  sitter model , an open model with @xmath3 , and a flat cosmological constant model with @xmath3 , @xmath4 .",
    "we performed 1981 simulations , propagating light beams back in time , up to a redshift of @xmath228 or  5 .",
    "the average magnitude of shear and magnification amongst models are shown to be different , with the values for the cosmological constant model being significantly larger than for the other two models , for sources located at @xmath101 .",
    "the contribution of individual lens planes to the shear and magnification is larger for planes located at intermediate redshift , of order @xmath229 , even though structures are more evolved at low redshift and direct hits of galaxies are more frequent at high redshift .",
    "the lens planes providing the largest average contribution to the shear are located at lower redshift for the einstein - de  sitter model than for the other two models .",
    "the contribution of distant background matter to the shear is as important as the contribution of nearby galaxies ( see fig .",
    "11 ) for low  @xmath7 models , and significantly more important for the einstein - de  sitter model .",
    "these results , combined with observations of lensed quasars , might eventually put limits on the value of the cosmological parameters @xmath7 and @xmath192 .",
    "this paper has focussed on the description of the method .",
    "applications of this method to various problems will be presented in forthcoming papers .",
    "these include studying the statistics of multiple imaging of quasars , and their dependence upon the source redshift ( premadi , martel , & matzner 1997a ) , performing a cosmological parameter survey , for several values of the cosmological parameters @xmath9 , @xmath7 , and @xmath192 , and for various density perturbation spectra ( premadi , martel , &  matzner 1997b ) , and modifying the algorithm to include the effect of microlensing by stars inside galaxies ( martel , premadi , & matzner 1997b )    this work benefited from stimulating discussions with alan dressler , daniel holz , and inger jrgensen .",
    "we are pleased to acknowledge the support of nasa grant nag5 - 2785 , nsf grants phy93  10083 and asc  9504046 , the university of texas high performance computing facility through the office of the vice president for research , and cray research .",
    "we compute the potential of the background matter by solving equation  ( 13 ) numerically .",
    "we first rewrite this equation as @xmath230    where we have introduced the mean surface density @xmath231 to be consistent with the filled - beam approximation , which requires that the mean surface density in each lens plane vanishes ( schneider & weiss 1988a , b ) .    to solve this equation ,",
    "we first use the location of the particles provided by the p@xmath1 m code to compute the source term @xmath232 in equation  ( a1 ) on a square grid of size @xmath233 , using the _ triangular shaped cloud _ ( tsc ) assignment scheme ( hockney &  eastwood 1981 ) .",
    "the values @xmath234 of @xmath232 at each grid point @xmath235 is given by @xmath236    where @xmath237 is the particle mass , @xmath238 is the grid spacing , @xmath239 , @xmath240 are the coordinates of particle  @xmath241 , and @xmath242 , @xmath243 are the coordinates of the grid point @xmath235 . for the tsc assignment scheme , the weight function @xmath244 is given by @xmath245    once the function @xmath232 has been computed on the grid , we solve equation  ( a1 ) using a finite difference method . the finite - difference form of equation  ( a1 ) is @xmath246    where we used the standard 5-point formula for the two - dimensional laplacian .",
    "since the grid has periodic boundary conditions , we can easily invert this equation using fourier techniques .",
    "we write the potential as @xmath247    where @xmath248 is the discrete fourier transform of @xmath249 ( not to be confused with the dimensional potential ) .",
    "we use a similar expression for the source term @xmath232 .",
    "we eliminate @xmath249 and @xmath232 in equation  ( a4 ) and get , after some algebra , @xmath250    to solve for the potential , we compute @xmath251 by taking the two - dimensional fast fourier transform ( fft ) of @xmath232 on the grid .",
    "we then use equation  ( a6 ) to compute the function @xmath248 on the grid , and take the two - dimensional inverse fft on the grid to get @xmath249 .",
    "once we know the potential on the grid , we can compute its first and second derivatives using standard finite difference formulae , @xmath252    this gives us the derivatives at the grid points . to interpolate these derivatives at the location of the rays , we use again the tsc assignment scheme , @xmath253    where @xmath254 are now the coordinates of the ray , the sum is on the grid points , and @xmath255 stands for any of the derivatives given by equations  ( a7)(a11 ) .",
    "the deflection potential caused by a galaxy is given by equation  ( 5 ) , @xmath256        with @xmath262 being the angle between the two vectors @xmath263 and @xmath264 .",
    "equation  ( b2 ) then becomes @xmath265ds\\nonumber\\\\ & = & { 4\\pi g\\over c^2 } \\int_0^{r_{\\max}}\\sigma(s)s\\ln\\left({r^2+s^2+|r^2-s^2|\\over2}\\right)ds \\,,\\end{aligned}\\ ] ]    where we used the fact the @xmath266 is a function of @xmath267 only to perform the integration over  @xmath262 .",
    "if the point @xmath268 is located outside the density distribution , then @xmath269 for all @xmath270 , and equation  ( b4 ) reduces to @xmath271          where @xmath276 .",
    "the first and second derivatives are then given by @xmath277\\,,\\\\ { \\partial\\hat\\psi_{\\rm gal}\\over\\partial y}&=&{2\\pi u^2y\\over r^2 } \\bigl[(r_{\\max}^2+r_c^2)^{1/2}-r_c\\bigr]\\,,\\\\ { \\partial^2\\hat\\psi_{\\rm gal}\\over\\partial x^2}&=&{2\\pi u^2(y^2-x^2)\\over r^4 } \\bigl[(r_{\\max}^2+r_c^2)^{1/2}-r_c\\bigr]\\,,\\\\ { \\partial^2\\hat\\psi_{\\rm gal}\\over\\partial x\\partial y}&= & -{4\\pi u^2xy\\over r^4}\\bigl[(r_{\\max}^2+r_c^2)^{1/2}-r_c\\bigr]\\,,\\\\ { \\partial^2\\hat\\psi_{\\rm gal}\\over\\partial y^2}&=&{2\\pi u^2(x^2-y^2)\\over r^4 } \\bigl[(r_{\\max}^2+r_c^2)^{1/2}-r_c\\bigr]\\,,\\end{aligned}\\ ] ]    where @xmath136 and @xmath278 are the components of @xmath263 .",
    "for the case @xmath279 ( eq .  [ b6 ] ) , we get , after some algebra @xmath280\\nonumber\\\\ & + & ( r^2+r_c^2)^{1/2}-r_c\\ln\\bigl[r_c+(r^2+r_c^2)^{1/2}\\bigr]\\biggr\\ } \\,.\\end{aligned}\\ ] ]    notice that the first two terms are constant and thus do not contribute to the derivatives .",
    "the first and second derivatives are given by @xmath281\\,,\\\\ { \\partial\\hat\\psi_{\\rm gal}\\over\\partial y}&=&{2\\pi u^2y\\over r^2 } \\bigl[(r^2+r_c^2)^{1/2}-r_c\\bigr]\\,,\\\\ { \\partial^2\\hat\\psi_{\\rm gal}\\over\\partial x^2}&=&{2\\pi u^2\\over r^4 } \\biggl\\{(y^2-x^2)\\bigl[(r^2+r_c^2)^{1/2}-r_c\\bigr ] + { x^2r^2\\over(r^2+r_c^2)^{1/2}}\\biggr\\}\\,,\\\\ { \\partial^2\\hat\\psi_{\\rm gal}\\over\\partial x\\partial y}&= & -{4\\pi u^2xy\\over",
    "r^4}\\biggl[(r^2+r_c^2)^{1/2}-r_c -{r^2\\over2(r^2+r_c^2)^{1/2}}\\biggr]\\,,\\\\ { \\partial^2\\hat\\psi_{\\rm gal}\\over\\partial y^2}&=&{2\\pi u^2\\over r^4 } \\biggl\\{(x^2-y^2)\\bigl[(r^2+r_c^2)^{1/2}-r_c\\bigr ] + { y^2r^2\\over(r^2+r_c^2)^{1/2}}\\biggr\\}\\,.\\end{aligned}\\ ] ]    to conserve mass , we superpose on the top of each galaxy a `` hole '' of negative density , which represents the matter that has been used up to form the galaxy .",
    "this hole has a volume density given by @xmath282    where @xmath283 is the mass of the galaxy , and @xmath284 is the three - dimensional radial distance .",
    "the normalization constant in equation  ( b20 ) was chosen such that the total mass of the galaxy and hole vanishes .",
    "the projected surface density is given by @xmath285      the last integral can not be solved using elementary functions .",
    "this is not a problem , since we are only interested in the derivatives of the potential .",
    "after differentiation , we get @xmath288\\,,\\\\ { \\partial^2\\psi_{\\rm hole}\\over\\partial y^2}&= & -{m\\over\\pi r^4}\\left[(x^2-y^2)(1-e^{-w^2})+2y^2w^2e^{-w^2}\\right]\\,,\\\\ { \\partial^2\\psi_{\\rm hole}\\over\\partial x\\partial y}&= & { 2mxy\\over\\pi r^4}\\left[1-e^{-w^2}-w^2e^{-w^2}\\right]\\,,\\end{aligned}\\ ] ]    where @xmath289 .",
    "notice that these derivatives are well - behaved at @xmath290 . by combining equations  ( b9)(b13 ) with equation  ( b23)(b27 ) , we see that the combined potential of the galaxy and hole drops to zero as @xmath89 goes to infinity . in practice , we neglect the combined potential at distances larger than @xmath291 ."
  ],
  "abstract_text": [
    "<S> we describe a numerical algorithm which simulates the propagation of light in inhomogeneous universes . </S>",
    "<S> this algorithm computes the trajectories of light rays between the observer , located at redshift @xmath0 , and distant sources located at high redshift , using the multiple lens - plane method . </S>",
    "<S> the deformation and deflection of light beams as they interact with each lens plane are computed using the filled - beam approximation .    </S>",
    "<S> we use a particle - particle / particle - mesh ( p@xmath1 m ) n - body numerical code to simulate the formation of large scale structure in the universe . </S>",
    "<S> we extend the length resolution of the simulations to sub - megaparsec scales by using a monte - carlo method for locating galaxies inside the computational volume according to the underlying distribution of background matter . </S>",
    "<S> the observed galaxy 2-point correlation function is reproduced . </S>",
    "<S> this algorithm constitutes a major improvement over previous methods , which either neglected the presence of large - scale structure , neglected the presence of galaxies , neglected the contribution of distant matter ( matter located far from the beam ) , or used the zeldovich approximation for simulating the formation of large - scale structure . </S>",
    "<S> in addition , we take into account the observed morphology - density relation when assigning morphological types to galaxies , something that was ignored in all previous studies .    to test this algorithm , we perform 1981 simulations , for three different cosmological models : an einstein - de  sitter model with density parameter @xmath2 , an open model with @xmath3 , and a flat , low density model with @xmath3 and a cosmological constant @xmath4 . in all models , </S>",
    "<S> the initial density fluctuations correspond to a cold dark matter power spectrum normalized to cobe . in each simulation </S>",
    "<S> , we compute the shear and magnification resulting from the presence of inhomogeneities . </S>",
    "<S> our results are the following : ( 1 )  the magnification is totally dominated by the convergence , with the shear contributing less than one part in @xmath5 . </S>",
    "<S> ( 2 )  most of the cumulative shear and magnification is contributed by matter located at intermediate redshifts @xmath6 . </S>",
    "<S> ( 3 )  the actual value of the redshift where the largest contribution to shear and magnification occurs depends on the cosmological model . in particular , the lens planes contributing the most are located at larger redshift for models with smaller @xmath7 . ( 4 )  the number of galaxies directly hit by the beam increases with redshift , while the contribution of lens planes to the shear and magnification decrease with increasing lens - plane redshift for @xmath8 , indicating that the bulk of the shear and magnification does not originate from direct hits , but rather from the tidal influence of nearby and more distant galaxies , and background matter . ( 5 )  the average contributions of background matter and nearby galaxies to the shear is comparable for models with small @xmath7 . for the einstein - de  sitter model , the contribution of the background matter exceeds the one of nearby galaxies by nearly one order of magnitude . </S>"
  ]
}