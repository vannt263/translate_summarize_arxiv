{
  "article_text": [
    "cold dark matter density perturbations drive all of cosmological structure formation ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) in the current paradigm .",
    "their non - linear growth is followed with numerical simulations over an enormous range of scales . from scales of hundreds of megaparsecs",
    "( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) studying cosmological large - scale structure ; to several hundred kilo parsecs modeling the formation and evolution of galaxies including aspects of the interstellar medium , molecular cloud - formation and black - hole accretion processes ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) ; and even the formation of the first proto - stars formed at scales of a few solar radii ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) are studied in cosmic context .",
    "the fluctuations in the standard model would extend from solar system size to giga parsec scales .",
    "no single calculation would be able to capture all these scales .",
    "one may therefore strive to carry out simulations in as large volumes as possible to study a range of representative environments for the formation of particular cosmological objects . at the same time",
    ", however , high resolution is necessary to sample the underlying gravitational potential wells .",
    "a popular way to achieve large simulation boxes with as high as possible resolution for individual objects is the so - called `` zoom - in '' technique ( following versions of e.g. * ? ? ?",
    "* ; * ? ? ?",
    "in this technique , a small region encapsulating the formation history of the object of interest is studied with much higher resolution inside of a lower resolution representation of its larger - scale cosmic environment interacting with the object through long - range gravitational forces .",
    "the aim is to represent both the variance of the fluctuations on scales of the object ( sample variance ) due to the use of a large volume which provides a fair sample of cosmic environments ( cf .",
    "* ; * ? ? ?",
    "* ) , as well as the smaller scale fluctuations affecting the structure of the object directly .    typically , two approaches have been followed for initial conditions of `` zoom - in simulations '' . either , initial conditions are generated on a uniform grid at the full resolution ( which can amount to a huge need for computational resources for deeply nested grids , see e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) and subsequently degraded by either averaging over regions of @xmath1 particles , where @xmath2 is the de - refinement factor outside the high resolution region , or by fourier resampling .",
    "there are several disadvantages with this approach : first , the computational requirements are immense compared to the solution sought ; and second , the simple averaged velocity fields are neither continuous nor differentiable across coarse - fine boundaries , leading to spurious shocks in baryonic simulations .",
    "alternatively , e.g. the grafic-2 code @xcite is used which employs discrete fourier transforms to add small scales perturbations to coarser perturbations .",
    "the grafic-2 approach however requires the use of an anti - aliasing filter which damps out small - scale power and shows oscillatory errors at the few per - cent level that result from the combination of discrete fourier transforms of different resolution .",
    "furthermore , it does not incorporate the sampling of the real - space transfer function advocated by @xcite and @xcite .",
    "this latter aspect is a feature of all codes that generate initial conditions by an inverse fourier transform of a sampled power spectrum on a three - dimensional lattice and thus also plagues most applications of the previous approach .",
    "@xcite has shown conclusively that this conventional method can lead to a significant error in the real - space statistical properties , in particular for small cosmological box sizes .",
    "this paper extends on previous work by proposing a new algorithm to generate multi - scale nested initial conditions ( as * ? ? ?",
    "* ) , but using a real - space convolution kernel to represent the fourier space transfer function of density perturbations ( cf . * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) in a multi - scale convolution algorithm combined with an adaptive multi - grid algorithm to determine initial velocities , particle positions and densities compatible with lagrangian cosmological perturbation theory up to second order .",
    "more specifically , the approach uses mass conservation constraints to determine the convolution kernel from an accurate real space representation of the transfer function kernel on a hierarchy of levels , which are used in fft convolutions to obtain the density field from a hierarchical white noise field , and a two - way interface multigrid poisson solver that achieves smooth gradients across coarse - fine boundaries .",
    "the resulting errors are confined to the boundaries and at the level of a few @xmath0 in units of the standard deviation of the respective fields for the interior of the refined region .",
    "we furthermore show that using a hybrid poisson solver ( using multi - grid for the hierarchy of grids and fft for the finest grid ) , our method produces particle distributions that closely match the input power spectrum also on the smallest scales and make our approach attractive also for uni - grid simulations .",
    "all the methods discussed in this paper are implemented in the initial conditions code music ( multi - scale initial conditions ) .",
    "the code also includes an implementation of a linearized boltzmann solver based on linger @xcite that allows the calculation of cosmological density and velocity perturbations for dark matter and baryons .",
    "the paper is organised as follows . in section [ sec : densities ] , we discuss a multi - scale convolution method that produces a nested density field that is consistent with both the input correlation function and the input power spectrum , and which is then used as the source field for lagrangian perturbation theory .",
    "computing displacement and velocity fields in lagrangian perturbation theory ( lpt ) requires a numerical solution to poisson s equation . in section [ sec : dispvel ] , after briefly summarizing lpt , we describe the adaptive multi - grid algorithm that we use to obtain displacement and velocity fields .",
    "we also introduce a hybrid fourier - space / multi - grid based poisson solver which has better fourier - space properties on small scales compared to the pure multi - grid algorithm . in section [ sec : error_analysis ] , we discuss the performance of our method compared to initial conditions generated purely in fourier - space both in unigrid and nested grid set - ups .",
    "we generalize our approach to initial conditions for two - component dark - matter and baryon simulations in section [ sec : baryon_ics ] and propose the usage of the local lagrangian approximation to generate inital baryon density fields for grid codes before we summarize and conclude our results in section [ sec : summary ] .",
    "in this section , we summarize methods to generate gaussian random fields that follow a prescribed power spectrum and act as source terms for density and velocity perturbations in lagrangian perturbation theory .",
    "we give particular attention to a convolution kernel based approach which has favourable properties in a multi - scale nested grid set - up .",
    "consider an over - density field @xmath3 that is completely described by its power spectrum @xmath4 , where the tilde denotes the transformed function of a fourier transform pair .",
    "the amplitude of density fluctuations is usually expressed in terms of the transfer function @xmath5 , which is defined such that @xmath6 where @xmath7 is the ( constant ) power spectrum spectral index after inflation , and @xmath8 is a normalization constant .",
    "the first step in setting up initial conditions for cosmological simulations thus consists in generating a white noise sample of random values @xmath9 ( typically sampled from a gaussian distribution with zero mean and unit variance ) and to require that their amplitudes follow a specific power spectrum @xmath10 .",
    "this can be achieved by multiplying the fourier transformed white noise field @xmath11 with the square root of the power spectrum , i.e. for all @xmath12 representable on a grid of given resolution set @xmath13 the real space over - density field @xmath3 is then obtained by inverse fourier transformation , and we call this procedure `` @xmath14-space sampling '' .",
    "it is interesting to note that a product in fourier space simply corresponds to a convolution in real space ( cf .",
    "also * ? ? ?",
    "* ; * ? ? ?",
    "* ) , i.e. equation ( [ eq : delta_amplitude_k ] ) is equivalent to @xmath15 where @xmath16 is the real - space counterpart of @xmath17 , and `` @xmath18 '' denotes a convolution .",
    "it is thus mathematically equivalent whether equation ( [ eq : delta_amplitude_k ] ) is evaluated in fourier space , followed by an inverse transform , or whether equation ( [ eq : delta_amplitude_r ] ) is evaluated using an inverse transform of @xmath19 followed by the convolution .",
    "most cosmological initial conditions generators follow the first approach ( e.g. * ? ? ?",
    "* ) , while e.g. @xcite , @xcite and @xcite use the second or variations thereof .",
    "the discrete realizations of the density fields derived with the two approaches will have significant differences .",
    "in particular , employing eq .",
    "( [ eq : delta_amplitude_k ] ) forces periodicity of the real space transfer function on box scales that leads to an underestimation of the two - point correlation function ( see section [ sec : tf_real ] , and e.g. @xcite and @xcite for a detailed discussion ) .",
    "this is particularly relevant for small cosmological boxes ( @xmath20 ) , where the periodic contribution is non - negligible .",
    "the convolution kernel @xmath16 can be thought of as a `` propagator '' of a single gaussian white noise fluctuation @xmath21 at location @xmath22 , where @xmath23 is the dirac @xmath24-function .",
    "the time evolution of each single such perturbation is given by the time evolution of @xmath16 .",
    "instead of a variation of the traditional method of sampling fourier modes according to a given power spectrum , this real - space picture has thus an intuitive physical motivation : the convolution operation imprints the density perturbations due to the white noise @xmath25 onto space .",
    "apart from the better behaviour of the two - point correlation function , we follow the convolution approach since it allows for an easier treatment of nested grids that are separated by sharp boundaries in real space . to achieve this",
    ", a method will be developed that correctly overlaps the `` propagator '' with such coarse - fine boundaries .",
    "we give an account of how we numerically compute eq .",
    "( [ eq : delta_amplitude_r ] ) in the next section and of the multi - scale convolution approach for nested grids in section [ sec : nested_convolution ] .      the real space transfer function @xmath16 at @xmath26 for total matter density perturbations obtained using the fftlog method from a tabulated k - space transfer function @xmath27 .",
    "the transfer function is positive where the line is solid and negative where it is dotted .",
    "the inset shows the baryon oscillation peak in linear scale where the change of sign occurs.,scaledwidth=40.0% ]    since the transfer function @xmath19 is typically computed numerically using a spectral boltzmann solver ",
    "e.g. the boltzmann solver included with our code , linger @xcite , cmbfast @xcite or camb , or taken from a fitting formula ( e.g. @xcite )  its fourier transform is not available a priori .",
    "thus , in the approach we follow , an accurate real - space transfer function @xmath28 is first calculated which is subsequently applied as a convolution kernel to the gaussian white noise field using fft convolution .",
    "assuming a spherically symmetric transfer function @xmath19 , one has @xmath29 this real space transfer function , @xmath28 , can be computed using the fftlog algorithm @xcite from an input k - space transfer function @xmath27 .",
    "fftlog uses the fact that the fourier transform of a log - log function can be written as a hankel transform which can be carried out by fft .",
    "the resulting transform is highly accurate over many orders of magnitude .",
    "we kindly refer the reader to @xcite for details .",
    "the @xmath30 component needs to be computed separately .",
    "it is obtained by a three dimensional numerical integration over the range of fourier modes included in the simulation .",
    "this @xmath30 component sets the white noise level of the density perturbations .",
    "figure [ fig : transfer_real ] , shows the result of the transform from tabulated k - space transfer functions at @xmath26 for matter density perturbations generated with a 1d linear boltzmann solver ( cf . * ? ? ?",
    "* ) .    finally , the convolution in eq .",
    "( [ eq : delta_amplitude_r ] ) has to be computed numerically .",
    "to this end , we compute a discretisation @xmath31 , with @xmath32 , @xmath33 ^ 3 $ ] over the entire simulation volume of length @xmath34 .",
    "next , a white noise random field @xmath35 is created on the same discretisation .",
    "then both @xmath36 and @xmath35 are transformed by fft , multiplied element - by - element with one another and the result is inverse transformed to yield @xmath37 . note that when sampling on a finite grid , the real - space sampled transfer function is no longer spherically symmetric when transformed by fft to three dimensional fourier space . however , equivalently , the traditional @xmath14-space sampled transfer function is not spherically symmetric in real space .",
    "auto - correlation function of the transfer function ( equivalent to the two - point correlation function ) for @xmath14-space sampled ( dotted red ) and real space transfer functions that are non - periodic ( dashed green ) and periodic on the box length ( dot - dash blue ) .",
    "the gray line indicates the two - point correlation function determined from the input power spectrum at @xmath38 .",
    "all auto - correlation functions have been computed for a @xmath39 box with @xmath40 resolution .",
    ", scaledwidth=40.0% ]    the analysis performed in this paper uses a real - space transfer function periodically replicated on the box length .",
    "this abandons the favourable properties of a truncated correlation kernel discussed in detail by @xcite .",
    "however , this choice allows comparison with the classical approach that samples the k - space transfer function . for actual applications",
    "it is recommended that the truncated transfer functions should be used ( which is a simple parameter in our code ) .    in figure",
    "[ fig : corrfun_ic ] , we show the auto - correlation function of the transfer function kernels ( equivalent to the two - point correlation function ) .",
    "as demonstrated by @xcite , the non - periodic real space kernel perfectly reproduces the input two - point correlation function .",
    "the periodic correlator , for which we have not subtracted the mean in this case , underestimates the correlation function at large radii and the @xmath14-space sampled kernel shows an even stronger drop at large radii .",
    "note that the big drop in the @xmath14-space sampled correlation function is somewhat spurious .",
    "it is partly from the periodic component , as the periodic real space kernel shows a similar suppression .",
    "however , it is mainly due to an additional integral constraint . for the @xmath14-space sampled kernel , @xmath41 , so that @xmath42 where @xmath43 is the simulation volume and the latter equality holds in the case of a spherically symmetric correlation function and amounts to the usual integral constraint on the two - point correlation function .",
    "this integral constraint however holds for a finite @xmath43 in the traditional @xmath14-space sampling approach ( while @xmath44 in our case ) and the correlation function is thus offset by an additive constant which is equal to the integral over the correlation function outside the simulation volume .",
    "this additive constant leads to the additional deviation seen between the @xmath14-space sampled correlation function and the periodic real - space equivalent which is simply amplified by the multiplication with @xmath45 .",
    "any box with zero mean overdensity will therefore fulfill the integral constraint over the box instead of over an infinite volume leading to a similar discrepancy .",
    "boxes with a non - zero mean overdensity would circumvent this problem and the difference in mean overdensity can be incorporated in a change to different effective cosmological parameters .",
    "we will not investigate further the possibility of simulations with non - vanishing mean overdensity but kindly refer the reader to @xcite for a detailed discussion of this possibility .      in order to generate an accurate multi - scale representation of an initial density field",
    ", we will now describe our algorithm to perform the convolution in eq .",
    "( [ eq : delta_amplitude_r ] ) on nested grids .",
    "particular care is taken to achieve mass conservation , as violations would affect the entire domain when the density field is used to source the displacement and velocity fields ( cf .",
    "section [ sec : dispvel ] ) . as in the grafic2 approach@xcite",
    ", this amounts to linear constraints between the levels .",
    "however , unlike grafic2 , these constraints are not only top - down ( i.e. the coarse level provides constraints for the fine ) , but partially bottom - up to achieve a more conservative algorithm and high - resolution sampling of the real - space convolution kernel .",
    "the volume subdivision based nested grid structure used in the multi - scale algorithms . shown",
    "are two additional refinement levels in which a parent cell can be refined into eight children cells .",
    "note that centers of children do not coincide with the parent grid cell centres.,scaledwidth=25.0% ]    [ sec : nested_convolution ]      in order to generate initial conditions for a nested subdomain on the volume subdivision grid structure used in our approach ( figure [ fig : grid_structure ] ) , the white noise for the subgrid has to be consistent with that of the coarse grid .",
    "two separate approaches can be followed that are locally mass - conserving ( in the sense that the children cells average to the parent cell locally rather than that only the total mass in the subgrid domain is conserved ) :    the first approach uses the hofmann - ribak algorithm @xcite .",
    "first an unconstrained white noise field @xmath46 is generated for level @xmath47 which has 8 times the variance of the noise field for level @xmath48 in the case of a refinement factor of 2 .",
    "next , for each group of eight children cells on the fine grid , the mean is replaced by the respective value of the noise field on the coarser level @xmath48 ( cf . also * ? ? ?",
    "* ; * ? ? ?",
    "since this approach does not retain the fourier modes present on the coarse grid , another approach can be devised that achieves this : ( 1 ) again , an unconstrained white noise field @xmath46 is generated for level @xmath47 at 8 times the coarse level variance .",
    "( 2 ) in order to preserve fourier modes that are present in the coarse grid @xmath48 , an fft of both the fine grid and that part of the coarse grid that overlaps the fine grid is performed .",
    "then all modes @xmath49 up to the nyquist wave number of the coarse grid are replaced with the respective fourier coefficients from the coarse grid , followed by an inverse transform .",
    "( 3 ) in order to ensure conservation of mass , the hoffman - ribak algorithm is applied in reverse , i.e. the coarse grid white noise values are replaced by the average over the eight children of a coarse cell inside the refinement region . since the fourier interpolation conserves the mass of the entire subgrid ,",
    "as does the averaging over children , the global mass in the simulation domain is also conserved .",
    "further levels can be computed by repeating first step ( 2 ) for all levels at increasing resolution , followed by the correction step that replaces all coarse cells at all coarser levels with the average over the eight fine cells , starting at the finest level .",
    "thus , the hoffman - ribak constraint is fulfilled while at the same time fourier modes are preserved between grids .    in the following",
    ", we will describe how the convolution with the real - space transfer function , eq .",
    "( [ eq : delta_amplitude_r ] ) , is performed when a refinement region is present .      in figure",
    "[ fig : grid_scheme ] , we show schematically the set - up for one additional refinement level .",
    "the top grid domain @xmath50 consists of the domain @xmath51 covered by a refinement grid and the non - refined part @xmath52 .",
    "the refinement region @xmath51 at twice the resolution is given by @xmath53 .",
    "@xmath54 represents the padding around @xmath51 to twice the length per dimension that is needed to perform isolated fourier convolutions .",
    "the next step in our method is to generate convolution kernels @xmath16 for all required levels .",
    "in contrast to the grafic2-approach , we construct these kernels purely in real space , starting from the finest level . for the finest level @xmath48 ,",
    "this consists of a simple evaluation of the real - space transfer function @xmath55 on @xmath56 , i.e. @xmath57 for all @xmath58 with the origin @xmath59 placed at the centre .    as for the white noise",
    ", care has to be taken to maintain local conservation of mass .",
    "thus , rather than sampling at coarser resolution , for the next coarser level @xmath60 , the already discretized part of the convolution kernel for the fine - level grid needs to be restricted to the coarser grid in a conservative way .",
    "this can be achieved by averaging the contributions due to all eight children cells when convolved with the kernel , i.e. we compute @xmath61 for those grid points @xmath62 that correspond to the refined part of the grid .",
    "this provides the convolution kernel for a volume of the size of the refined region including the padding , i.e. for @xmath63 .",
    "the remaining cells outside that region , i.e. on @xmath64 are again sampled directly from the real - space transfer function : @xmath65 for all @xmath66 .",
    "this last step is in violation with strict mass conservation since eq .",
    "( [ eq : transfer_average ] ) does not hold outside the refined region . since most of the mass of the convolution kernel is close to the centre",
    ", this approximation produces however negligible errors and avoids the substantial computational overhead of an exact evaluation of @xmath67 over the entire domain at the finest resolution .",
    "the procedure of averaging and newly sampling uncovered volume is repeated until the coarsest level is reached .",
    "the density field on the top grid level @xmath48 is determined as in the unigrid case by computing @xmath68 on @xmath50 with periodic boundary conditions automatically satisfied by the fft .",
    "for the refined region , several contributions will be co - added :    schematic representation of a set - up with one refinement level .",
    "the left panel a ) shows the top grid @xmath50 which consists of a region @xmath51 covered by a refinement grid and the non - refined part @xmath69 .",
    "the right panel b ) shows the sub - grid domain @xmath53 which is equivalent to @xmath51 in the left panel but has twice the resolution . to this sub - grid a padding region",
    "@xmath70 will be added when performing the fft convolution with isolated boundaries and is denoted by @xmath54 on the top grid.,scaledwidth=45.0% ]    1 .",
    "the coarse grid contribution @xmath71 to the refinement region is computed by zeroing @xmath72 on @xmath51 to obtain @xmath73 , computing the convolution @xmath74 and interpolating @xmath75 from @xmath51 to @xmath71 .",
    "we use tri - cubic interpolation for this purpose .",
    "2 .   on level @xmath47",
    "isolated boundary conditions apply , so @xmath53 has to be padded to twice its size @xmath76 so that an fft - based convolution is still possible . in order to find the density @xmath77 due to the sub - grid alone , @xmath78 on @xmath79",
    "is set to zero to obtain @xmath80 , followed by computing the convolution @xmath81 .",
    "3 .   in order to reduce errors at the boundary",
    ", a correction term @xmath82 is added that accounts for the fluctuations just outside @xmath53 . to this end , the coarse grid value of the white noise field is subtracted from each of the 8 children cells , equivalent to `` unapplying '' the hoffman - ribak method .",
    "we then zero the result of this operation on @xmath53 , so that it is non - zero only on @xmath70 and obtain @xmath83 .",
    "since boundary conditions are isolated , it would be necessary to truncate the transfer function in order to have a non - periodic unconstrained white noise field .",
    "we however found that a truncation introduces larger errors than assuming periodicity ( on scales larger than the subgrid ) .",
    "finally , the fft - convolution @xmath84 is evaluated .",
    "4 .   finally",
    ", the result of the previous step is restricted also to the coarse grid , i.e. onto @xmath54 , in order to include information about fluctuations on smaller scales .",
    "finally , all three contributions are added to find the refined density field @xmath85 on @xmath53 . in order to further reduce errors due to the boundary , we allow for optional additional padding of the subregion with a few grid cells and cut out the desired region at the end .      for further refinement levels ,",
    "the same steps 1 - 4 from above are repeated at level @xmath86 , @xmath87 , with the only difference being that the coarse grid contribution @xmath88 is computed using isolated boundary conditions on @xmath89 , i.e. with a zero padded random field @xmath90 .",
    "furthermore , all coarse contributions have to be interpolated down to this level .",
    "let @xmath91 be the interpolation operator , then @xmath92,\\ ] ] where @xmath93 $ ] indicates a successive interpolation between @xmath94 levels .",
    "we use a conservative tri - cubic interpolation for this purpose , i.e. we first perform a normal tri - cubic interpolation and then correct the eight children cells with an additive constant to ensure that their average equals the coarse cell value .",
    "in this section , we briefly summarize the application of first and second order lagrangian perturbation theory to obtain the initial displacement and velocity fields which are based on solutions of poisson s equation . for details ,",
    "we kindly refer the reader to the wide field of existing literature on lagrangian perturbation theory .",
    "we then summarize the multi - grid algorithm which solves poisson s equation numerically before we discuss its extension to the adaptive multi - grid algorithm which provides solutions to poisson s equation on nested grids .",
    "finally , we examine several methods to obtain velocity and displacement fields that have the same behaviour at large wave numbers as those obtained with the traditional @xmath14-space sampling .",
    "lagrangian perturbation theory describes the evolution of density perturbations in the rest - frame of the fluid .",
    "the position @xmath95 of a fluid element at time @xmath96 with respect to its initial position @xmath97 , and the respective fluid velocity , can then be written as @xmath98 where @xmath99 we call the `` displacement field '' which is derived using perturbation theory .",
    "it can be easily shown that at first order in the perturbations , the displacement field @xmath100 can be written as the gradient of a potential @xmath101 which is proportional to the gravitational potential @xmath102 , @xmath103 where @xmath104 is the hubble constant , @xmath105 is the expansion factor at time @xmath96 , @xmath106 is the growth factor of linear density perturbations ( i.e. the time evolution of the growing mode ) and @xmath102 is the gravitational potential obeying poisson s equation @xmath107 since the velocities are given by the gradient of a potential ,",
    "velocities are irrotational , i.e. @xmath108 , in this approximation .",
    "note that the gaussian over - density field @xmath24 is the source field of the displacements .",
    "it is not the density field that is measured after displacing the fluid elements , which is non - gaussian .",
    "we give a derivation of the latter in section [ sec : icdens ] .",
    "the gaussian field @xmath24 should not be used to impose an initial density field for the baryonic component .    in order to obtain the displacement vectors from the initial over - density field @xmath24",
    ", poisson s equation has to be solved numerically .",
    "the most common approaches use an fft based poisson solver ( e.g. * ? ? ?",
    "* ) , while we chose a multi - grid based poisson solver as it can be easily extended to an adaptive multi - grid solver which is able to handle nested adaptive grids in a very natural way .",
    "several studies have shown ( see e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) that first order lagrangian perturbation theory ( cf .",
    "section [ sec : firstlpt ] ) might not be accurate enough for current simulations as it leads to e.g. significantly underestimated higher order moments of the density probability distribution functions at early times .",
    "in particular , @xcite have shown that 2lpt matches the skewness of the density field for top hat collapse , while 3lpt would in addition also match the kurtosis , and so on . at second order ,",
    "the displacement field contains not only contributions from the gravitational potential , but also from a second - order potential that is sourced by the off - trace components of the deformation tensor , i.e. @xmath109 where @xmath110 obeys the poisson equation @xmath111 , with @xmath112,\\ ] ] and @xmath106 is the growth factor of linear perturbations , and @xmath113 . adding second order perturbation theory is thus algorithmically identical to repeating the steps for first order displacements : after computing the source - field @xmath114 using finite differences , poisson s equation can be solved numerically using the ( adaptive ) multi - grid scheme .",
    "a similar adaptive approach to generate initial conditions at second order has been made by @xcite who use a tree - pm method to evaluate the second order contribution .",
    "note that while our method allows for 2lpt , we only use 1lpt in this paper to aid the comparison with the typical practice in the field .      [ cols=\">,^,^\",options=\"header \" , ]     cumulative distribution of maximum circular velocities @xmath115 of sub - haloes of the cluster for the various methods.,scaledwidth=35.0% ]    finally , using ahf , we investigate the sub - halo population of the cluster . since the finite difference approach suppresses slightly the formation of the smallest haloes ( cf .",
    "[ sec : test_halo_abundance ] ) , it is plausible that sub - haloes are affected as well , possibly even stronger . in figure",
    "[ fig : subhmf_full ] , we show the cumulative distribution of maximum circular velocity @xmath115 for all sub - haloes with at least 30 particles contained within the virial radius of the main cluster halo .",
    "we observe that the most massive substructure has a slightly lower @xmath115 for the @xmath14-space initial conditions than for the others .",
    "the following sub - haloes , at next lower @xmath115 are identical . for the lower mass sub - haloes ,",
    "the cumulative distributions agree , the simulation starting from the multi - grid initial conditions having slightly larger scatter than the one starting from hybrid initial conditions .",
    "in particular , we see no systematic deficiency of lowest mass haloes in the multi - grid case as might have been expected .",
    "we conclude that differences in halo properties between the real - space and @xmath14-space conditions are at the per cent level for gross properties and at the few per cent level for profiles and sub - halo mass functions .",
    "we do not observe any systematic bias .          in this section",
    ", we analyze the errors in nested initial conditions computed with our method compared to a full - resolution solution with no local refinement . in order to compare our results with @xcite",
    ", we decided to implement an identical set - up , where we replace white noise in cells outside the refinement region in the full - resolution set - up with the respective average value it has on the coarse grid in the `` zoom - in '' set - up .",
    "this ensures that identical white noise information is used in all cases , i.e. all the information that is in principle representable in the refined hierarchy .",
    "note that naturally errors must arise at coarse - fine boundaries since the velocity and displacement fields must transition smoothly from fine to coarse resolution .",
    "first , initial conditions are generated on a uniform @xmath116 grid for a @xmath117 box with white noise degraded to include identical information as in the `` zoom - in '' set - up to obtain the full - resolution answer .",
    "next , another set of initial conditions is generated for a region of 0.2 times the box length at an effective resolution of @xmath116 while the remaining volume is treated at a resolution of @xmath40 .",
    "the high - resolution region comprises @xmath118 grid cells . in figure",
    "[ fig : err_1level_0pad ] , we show the error for the density field and the three components of the velocity for a slice in the @xmath119  plane through the centre of the refinement region .",
    "colors correspond to the logarithm of the difference between the multi - scale solution and the full - grid solution in units of the standard deviation @xmath120 of the respective quantity @xmath121 on the full grid . in order to suppress the contribution from density convolution errors at the boundary , we padded the grids with additional @xmath122 grid cells at each boundary during the convolutions .",
    "this padding is however cut away before the potential is computed for the multi - scale hierarchy to ensure that the final velocity field is continuous and differentiable across coarse - fine boundaries .",
    "all results are shown for 1lpt initial conditions , the respective errors in the 2lpt case are qualitatively identical .",
    "we used the 6th order multi - grid for the results shown in this and the next section .",
    "for the density , almost everywhere the difference is significantly below @xmath123 .",
    "we see that some errors at a few @xmath124 resulting from the interpolation of long - range components onto the finer grid .",
    "we find an rms error of @xmath125 .",
    "for the velocity components , again , errors are significantly below @xmath126 in the interior of the refinement region , apart from a few cells surrounding the boundary .",
    "errors at the boundary are at most @xmath127 and arise due to the smooth coarse - fine transition in the refined set - up which is not present in the unigrid case .",
    "the rms error is @xmath128 for all three velocity components .",
    "since the interior errors are below @xmath129 , the rms error over the entire refinement region is clearly dominated by only the errors at the boundary .",
    "errors for the hybrid poisson solver are harder to compare since the long - range component from coarse grids is taken from the finite difference multi - grid solution so that it has no spectral leakage ( see section [ sec : aliasing ] ) , while the same long - range component in the unigrid situation will show the spectral leakage in the form of oscillations at the nyquist frequency around the smooth solution .",
    "this lack of spectral leakage in the long - range components completely dominates the error in the interior in a direct comparison of the unigrid and the multi - scale solution at a level of @xmath130 , no other errors are however introduced . since leakage is an artifact of the finite mesh used for the ffts , these differences are spurious and of no significance to our multi - scale approach to initial conditions .    in figure [ fig : err_grafic ] , we show , for comparison , the error in the density and @xmath131 velocity component obtained with grafic2 for the identical refinement set - up and identical random numbers as in figure [ fig : err_1level_0pad ] .",
    "we have used version 2.101 of the code and not removed or modified the standard antialiasing filter .",
    "errors in density are about one , errors in velocity ( and thus displacements ) are about two orders of magnitude larger .",
    "furthermore , unlike with our approach , errors are oscillatory and spread over the entire refinement domain . in addition , there is a significant vertical gradient at the level of several percent",
    ". we can only speculate about the sources of these errors .",
    "for the density field , our approach avoids the problem of aliasing and spectral leakage completely by operating purely in real - space .",
    "furthermore , it produces by definition identical results for the @xmath132 component in the refined and the unigrid case .",
    "in addition , we have ensured that mass is conserved between grids thus avoiding long - range errors in the velocity components .",
    "finally , the use of the adaptive multi - grid poisson solver to compute velocities guarantees a solution of poisson s equation that is independent of the presence of a refined region if the mass field in the unigrid case is averaged with the restriction operator and then re - injected with the respective injection operator ( averaging and straight injection in our case ) in order to reflect the resolution in the refinement hierarchy .",
    "error for the density and the @xmath131 velocity component using grafic2 for the same refinement set - up as in figure [ fig : err_1level_0pad ] .",
    "again , the base 10 logarithm of the difference in units of the standard deviation of the respective field inside the refinement region is shown .",
    "note that the colour scale for the @xmath131 error corresponds to a range one order in magnitude larger than in figure [ fig : err_1level_0pad ] .",
    "the errors in the other velocity components are comparable to that for @xmath131.,scaledwidth=25.0% ]    as mentioned before , grafic2 also uses an antialiasing filter which severely suppresses power on small scales , so that the density and velocity fields generated are very smooth .",
    "we conclude that our new approach is an improvement by about two orders of magnitude in error reduction and the additional advantage that errors are completely confined to the boundaries .    in summary , with our method ,",
    "errors in the interior are below @xmath133 with larger errors occurring at the boundary for the velocities due to the coarse - fine transition in the refinement hierarchy .",
    "it is particularly interesting to note that the velocity errors have no visible small scale components in the interior .          in this section ,",
    "we repeat the error analysis from above for a set - up of two nested refinement levels .",
    "the refinement region still has @xmath118 cells at an effective resolution of @xmath116 but is now embedded in an intermediate grid at @xmath40 effective resolution which is in turn embedded in the coarse grid with @xmath134 cells extending over the entire volume .",
    "the intermediate grid has an extent of @xmath135 cells beyond the edges of the finest grid .",
    "as before , we pad each refinement level with additional 8 boundary cells during the convolution step in order to avoid coarse - fine transition errors during the convolution .",
    "these boundary cells are again cut off before the potential is computed .    in figure",
    "[ fig : err_2level_0pad ] , we show the differences in the high - resolution region between the full - grid solution and the nested multi - scale solution .",
    "density and velocity errors in the high - resolution region are roughly identical to the one level case above and below @xmath136 in the interior .",
    "we find rms errors of @xmath137 for the overdensity field and @xmath138 for the three velocity components .    to summarize , we see no significant impact on the velocity field due to the introduction of additional refinement levels .",
    "all errors are completely localized at the coarse - fine boundaries . regarding memory consumption , using double precision variables ( 8 bytes )",
    ", we observed a peak memory usage of @xmath139  gbytes in unigrid mode ( a @xmath116 double precision array requires 1  gbyte of memory ) , @xmath140  mbytes in the case of the single refinement level set - up from above and @xmath141  mbytes in the two - level case from above , demonstrating the low memory footprint of our `` zoom - in '' approach to generate initial conditions .          in order to assess the influence of multi - scale initial conditions on the formation of a re - simulated object , we generate multi - scale initial conditions for one of the most massive clusters with mass @xmath142 in the @xmath117 box discussed before .",
    "we deliberately set the rectangular refinement region to include only the lagrangian patch of the cluster halo .",
    "this will maximize the influence of both the coarse sampling of the large - scale tidal field and boundary effects on the formation of the cluster halo and allow us to estimate these effects .",
    "the refinement volume is a rectangular region of @xmath143 and was determined by following the fof particles constituting the halo at @xmath144 back to the initial conditions and determining their bounding box rounded up / down to integer @xmath145 .",
    "note that a sphere at mean density containing the mass of the cluster would have a diameter of @xmath146 .",
    "we perform gadget-2 simulations with one level of refinement where the effective resolution in the high resolution region is @xmath116 and @xmath40 in the remainder of the box , as well as with two levels of refinement , where the high resolution region is surrounded by a layer of 16 particles thickness around each face at @xmath40 effective resolution that then drops to @xmath134 in the remainder of the box .",
    "in addition , we perform each simulation two times for both the multigrid finite - difference and the hybrid approach : once with the initial density field determined using the multi - scale convolution technique described in section [ sec : nested_convolution ] , and once with the density field determined at full resolution and then degraded ( by averaging ) to the same resolution as in the multi - scale setup followed by solving poisson s equation on the nested grid rather than the full grid .",
    "the latter produces completely negligible errors in the velocities and displacements inside the high resolution region .",
    "differences from the full - grid initial velocities occur only in 2 - 3 cells at the boundary where the fields transition smoothly from fine to coarse resolution .",
    "all simulations are run with gadget-2 and use a force softening length of @xmath147 for the high - resolution particles and @xmath148 for the other particles .    in figure",
    "[ fig : cluster_err1 ] , we show the clusters at @xmath144 for all combinations of refinement set - up , poisson solver and initial density generation method .",
    "we observe that the main halo as well as the most massive subhalos are consistent in position and size .",
    "the positions of some of the smaller halos are shifted and some smaller haloes seem to have merged in one set - up while they have not in some of the others .",
    "in general , visual differences are minimal .",
    "it is furthermore surprising that no systematic difference between the 1-level and the 2-level set - up can be seen .",
    "this is most likely a result of the padding region in the 2-level simulations at @xmath40 resolution which is identical to the 1-level simulations - the tidal influence of structures outside the padding region thus appears negligible and highlights the importance of adding padding .    comparing figure [ fig : cluster_err1 ] with figure [ fig : halo_pics ] , which shows the cluster in the unigrid simulations , we observe no obvious systematic differences apart from smaller sub - halo positions being slightly shifted .",
    "the overall shape of the cluster halo agrees very well between the re - simulations and the full box simulations .",
    "we ran the amiga halo finder ( ahf ) @xcite on the resimulated clusters and quote the same key values as in section [ sec : cluster_analysis ] to quantify the gross properties of the cluster halo in table [ tab : res_haloprop ] .",
    "as in the unigrid case , apart from @xmath149 , we find differences around 1 per cent or below for all quantities investigated .",
    "@xmath150 & @xmath151 & @xmath152 & @xmath153 & @xmath154 & @xmath155 +   + 1 level , degraded & @xmath156 & @xmath157 & @xmath158 & @xmath159 & @xmath160 & @xmath161 & @xmath162 + 1 level , multi - scale & @xmath163 & @xmath164 & @xmath165 & @xmath166 & @xmath167 & @xmath168 & @xmath162 + 2 level , degraded & @xmath169 & @xmath170 & @xmath171 & @xmath172 & @xmath173 & @xmath174 & @xmath175 + 2 level , multi - scale & @xmath163 & @xmath164 & @xmath176 & @xmath177 & @xmath178 & @xmath179 & @xmath180 +   + 1 level , degraded & @xmath181 & @xmath182 & @xmath183 & @xmath184 & @xmath185 & @xmath186 & @xmath187 + 1 level , multi - scale & @xmath188 & @xmath189 & @xmath165 & @xmath190 & @xmath191 & @xmath192 & @xmath193 + 2 level , degraded & @xmath188 & @xmath194 & @xmath195 & @xmath196 & @xmath197 & @xmath198 & @xmath199 + 2 level , multi - scale & @xmath188 & @xmath194 & @xmath200 & @xmath201 & @xmath202 & @xmath203 & @xmath204 +    overdensity profiles for the cluster at @xmath144 re - simulated with one and two refinement levels ( top ) .",
    "the lower panel shows the relative difference with respect to the profile of the cluster in the unigrid simulation . left",
    "panels show the result obtained from finite difference multi - grid initial conditions , the right panels correspond to the hybrid approach .",
    "the vertical light gray lines indicate the scale of three times the softening length.,scaledwidth=47.0% ]    cumulative histogram of sub - halo maximum circular velocities @xmath115 of the re - simulated cluster at @xmath144 .",
    "the left panel shows the result for finite difference multi - grid approach , the right panel the corresponding results for the hybrid approach.,scaledwidth=47.0% ]    in figure [ fig : cluster_profiles1 ] , we show the radial over - density profiles for the various cases .",
    "the lower panel show the relative difference with respect to the unigrid simulations .",
    "we observe no bias in either case .",
    "scatter around the unigrid profile is larger for the finite difference case than for the hybrid initial conditions . for both methods ,",
    "the scatter is slightly larger for the 2-level than for the 1-level set - up .",
    "note that all `` zoom - in '' density profiles fall below the unigrid profiles in the last bin .",
    "this is due to the too small size of our refinement region as it is also present in the simulations generated by degrading the full density field .",
    "despite the fact that it had been chosen too small , we find however not a single low resolution particle inside the virial radius , the first appearing at @xmath205 .    in figure [",
    "fig : cluster_subhmf1 ] , we show the abundances of substructure as a function of maximum circular velocity @xmath115 within the virial radius of the cluster for all of the re - simulations . differences between the 1 and 2-level results are at the level of several per cent for the finite difference case .",
    "the hybrid initial conditions show better agreement between the four runs .",
    "it is hard and beyond the scope of this paper to investigate to what degree these differences stem from simple changes of the sub - halo positions causing errors in determining their circular velocities ( or masses ) in the sub - halo finder .",
    "we observe that the errors due to our multi - scale method , particularly with the hybrid poisson solver , agree very well with the degraded initial conditions in both the one and two refinement level set - up .",
    "in particular , the scatter between the results from multi - scale density fields and degraded density fields is never larger than the difference between degraded initial conditions at one or two refinement levels itself .",
    "this leads us to conclude that the differences , apart from the introduction of an additional stochastic component , are dominated by the late - time evolution and not the initial conditions .",
    "in particular , we find no evidence that our method introduces systematic difference or bias in any of the investigated quantities .",
    "radial density profiles of the re - simulated cluster haloes at increasing resolution with a base grid of @xmath134 particles .",
    "the profile for 1 refinement level , @xmath40 effective resolution is shown as a dotted black line ; 2 levels , @xmath116 effective resolution as a dashed red line ; and 3 levels , @xmath206 effective resolution , as a solid blue line .",
    "the vertical light gray lines in the corresponding line styles indicate three times the softening length for each simulation.,scaledwidth=40.0% ]    finally , we investigate the convergence of the density profile at even higher resolution for the hybrid poisson solver case . in figure",
    "[ fig : cluster_prof_conv ] , we show the radial density profiles for a series of re - simulations that all have a base resolution of @xmath134 particles and one to three additional refinement levels .",
    "the profiles trace each other almost perfectly .",
    "in this section , we discuss the generation of initial conditions for a two - component  dark matter and baryon  fluid .",
    "linear perturbation theory predicts distinct amplitudes for baryon and cdm density fluctuations and also for their respective velocity fluctuations .",
    "we demonstrate that our approach using real - space transfer functions can be easily generalized for such a two - component fluid .      at high redshifts ,",
    "at which initial conditions for cosmological simulations are typically generated , baryon density fluctuations are not yet exactly tracing the dark matter fluctuations ( e.g. * ? ? ?",
    "furthermore , baryon fluctuations are exponentially suppressed beyond the photon diffusion scale @xcite .",
    "these effects lead to a different shape of the baryon transfer function compared to the pure dark matter transfer function , particularly on small scales below @xmath207 .",
    "@xcite demonstrated that the growth of density perturbations in the two - component fluid can only be correctly reproduced if besides the different initial amplitudes of density perturbations also the difference in initial velocities between the two components are respected .",
    "it is thus important that initial conditions for the two - component fluid reflect these important differences between baryons and dark matter and are thus able to reproduce the correct growth of fluctuations in both components consistent with the predictions from linear perturbation theories for those scales where perturbations are still small also with cosmological @xmath208-body + hydrodynamics simulation codes .",
    "we defer a more detailed comparison with non - linear perturbation theory in two - component fluids ( e.g. * ? ? ?",
    "* ) to later work .    for the two component fluid of baryons and dark matter",
    ", we determine both baryon and dark matter velocities using transfer functions , equivalent to the density perturbation transfer functions , that we construct in the following way . using a boltzmann solver , we solve the linearized equations of relativistic perturbation theory to obtain the velocity perturbations of the cdm and the baryon fluid .",
    "we adopt the notation of @xcite and kindly refer the reader to that publication for all details on the perturbation equations .",
    "we do not include the baryon temperature fluctuations as suggested by @xcite as it is mainly relevant to perturbations with wavenumbers at and above the strongly jeans damped regime . using the results of linear perturbation theory",
    ", we define the two velocity transfer functions @xmath209 where @xmath102 is the conformal newtonian potential for spatial metric perturbations and @xmath210 is the baryon velocity divergence .",
    "these transfer functions are constructed in such a way that at linear order the relation @xmath211 holds for the amplitude of velocity perturbations , i.e. they simply replace the density transfer functions in our algorithm when computing initial velocities as in section [ sec : firstlpt ] .",
    "they furthermore allow the application of 2lpt ( cf .",
    "section [ sec : seclpt ] ) , as they generate an `` effective '' source field for the velocity perturbations completely analogously to the relation between density and displacement .",
    "the respective real space transfer functions for all four fields are shown in figure [ fig : transfer_all ] .    the real space transfer function @xmath16 at @xmath212 for baryon ( red ) and cdm ( blue ) density and baryon ( green ) and cdm ( orange ) velocity perturbations .",
    "the inset shows the first baryon oscillation peak in linear scale .",
    "note the effect of the jeans scale for @xmath213 on the baryons.,scaledwidth=40.0% ]          we now analyze the evolution of distinct baryon and cdm perturbations in two - component simulations using three commonly used cosmological simulation codes : gadget-2 @xcite , ramses and enzo @xcite . in each case , the initial conditions are generated at @xmath116 resolution for a box of comoving size @xmath214 with the same cosmological parameters as before and @xmath215 .",
    "the initial redshift is set to @xmath212 . for the grid codes ( enzo and ramses )",
    ", we do not allow for adaptive mesh refinement in order to avoid multi - scale density fields when computing the matter power spectra .",
    "in the sph case ( gadet-2 ) , we use a gravitational force softening of comoving @xmath216 for both baryons and cdm .",
    "furthermore , sph particles are placed on a staggered grid with respect to the cdm particles . in all cases ,",
    "we assume a polytropic equation of state with adiabatic exponent @xmath217 , an initial temperature of @xmath218 , where @xmath219 is the mean molecular weight , and use neither cooling nor energy feedback .",
    "note that ramses , in our set - up , uses a piecewise linear method ( plm ) for the hydrodynamics and mixed 2nd and 4th order gravity ( 2nd order in the laplacian , 4th order in the gradients ) .",
    "furthermore , we use the multidimensional monotonized central slope limiter @xcite .",
    "enzo uses a piecewise parabolic method ( ppm ) for the hydro and 2nd order gravity .",
    "we stop the simulations at @xmath220 and thus probe into the mildly non - linear regime .",
    "the power spectra of the two - component perturbations are shown in figure [ fig : evol_baryon ] at the initial and three subsequent redshifts , evolved with the respective codes .",
    "these power spectra have been computed on a @xmath116 grid using fft with cic interpolation for all particles , and directly from the baryon overdensity field for the grid codes .",
    "we do not correct for the loss of power due to the interpolation scheme and also do not smooth the sph particles with their respective kernels .",
    "thus , the baryon perturbations in the sph case do not reflect the density perturbations seen by the sph scheme , resolution thus appears to be significantly higher than for the grid codes , so that our results should not be used as an argument in favour or disfavour of either method .",
    "we observe several differences between the codes .",
    "the sph run with gadget-2 shows excellent agreement with linear perturbation theory . the relative amplitude between cdm and baryon perturbations at any given mode matches very well even in the mildly non - linear regime at @xmath220 .",
    "it is not suprising that gadget performs very well in our test since hydrodynamical forces are negligible in the regime probed and we thus only observe the performance of the tree - pm gravity solver .    in the case of ramses and enzo , cdm perturbations on the smallest scales",
    "grow slower than predicted by linear pt .",
    "this is however expected and a direct comparison with the gadget results is unfair since we did not allow for refinement , and gravity forces are thus smoothed at the grid scale . for enzo , the growth of cdm perturbations is more damped at small scales than in the ramses run .",
    "this is most likely the result of the higher order of the gradient used by the ramses poisson solver .    for the baryon perturbations",
    ", small scales are growing slightly slower with ramses than with enzo .",
    "again , this is to be expected since we use enzo with ppm and ramses with plm .",
    "also the type of riemann solver and slope limiter used in ramses has a slight effect , more diffusive limiters and solvers slightly decrease the power on the smallest scales . on large scales ,",
    "all codes reproduce the correct growth of the perturbations , in very good agreement with linear pt .    to summarize , we observe that all three codes correctly evolve a baryon - cdm two - component fluid which starts with distinct density and velocity perturbations for each component . differences that we observe with respect to the results from linear perturbation theory are attributable to the various numerical methods used in the simulation codes and not to the initial conditions .      the density field sourcing the displacements and velocities in lagrangian perturbation theory  which is a gaussian random field  is inconsistent with the density field of the displaced particles  which is non - gaussian .",
    "using the gaussian perturbation field as the initial baryon density field in grid based codes is thus inconsistent with the cdm perturbations . in this section ,",
    "we describe an approach to prescribe initial gas density for the mesh cells based on the local lagrangian approximation ( lla ) that leads to consistency between the initial gas and dark matter density fields ( see also * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "furthermore , it provides a natural way to prescribe the initial gas density on a grid also for 2lpt initial conditions .",
    "the continuity equation is trivially fulfilled for a lagrangian description of the fluid and simply reads @xmath221 we can however express the continuity equation in terms of the evolving fluid coordinates @xmath95 .",
    "it then becomes @xmath222 , where @xmath223 is the unperturbed mean density and @xmath224 is the density of the fluid element . since the continuity equation is simply a volume integral , we can employ the change of variables theorem to express the left - hand - side also in terms of the initial position @xmath97 , @xmath225 then , using eq . ( [ eq : lagrangecoord ] ) , the formal evolution of the density at the initial position of the fluid elements can be simply written as @xmath226 } , \\label{eq : gasdens}\\ ] ] where @xmath227 is the unity matrix .",
    "this implies that @xmath228 assumes a non - gaussian distribution in general .",
    "in fact , @xmath228 will become singular whenever an eigenvalue of @xmath229 will become @xmath230 , corresponding to shell crossing along the respective axis .",
    "since we use a first or second order lagrangian perturbation theory approximation for the displacement field @xmath231 , eq .",
    "( [ eq : gasdens ] ) is not exact and amounts to a `` local lagrangian approximation '' .",
    "this means that , in general , mass will not be strictly conserved .",
    "we correct this by enforcing mass conservation by an a posteriori renormalization @xmath232 , where @xmath233 is the measured deviation from mean density .",
    "typically , for sufficiently high initial redshift ( as e.g. for the @xmath212 initial conditions used ) , the relative error is around 0.6 per cent and thus negligible ( note that the error amounts to no more than @xmath234 per cent at much lower redshifts ) .",
    "when computing @xmath231 for baryons , @xmath101 is sourced only by the baryon density perturbations , and so also @xmath110 contains only baryonic contributions .",
    "note that application of the lla does not change the baryon power spectrum .",
    "evolution of the probability distribution functions ( pdfs ) of the baryon overdensity fields in units of the rms overdensity . for the @xmath214 simulation box ,",
    "the pdfs are given at three redshifts : @xmath26 ( top panel ) , @xmath235 ( middle panel ) and @xmath220 ( bottom panel ) .",
    "initial conditions were generated at two starting redshifts @xmath236 ( solid lines ) and @xmath237 ( dotted lines ) with first order lagrangian perturbation theory for dark matter and an initial gaussian baryon density field following eulerian perturbation theory ( ept ; red ) , with first order lpt for dark matter and baryons ( using the lla ) ( 1lpt ; blue ) and with second order lpt for dark matter and baryons ( 2lpt ; green).,scaledwidth=45.0% ]    in figure [ fig : pdf_evol ] , we show the evolution of the probability distribution function ( pdf ) of the baryon overdensity field in an enzo simulation using the same simulation parameters as above but for two different starting redshifts @xmath236 and @xmath237 .",
    "for both starting redshifts , we generate initial conditions in three different ways :    ept : : :    first order lagrangian perturbation theory is used to initialize dark    matter displacements and velocities as well as baryon velocities .",
    "the    initial baryon density field is taken from eulerian perturbation    theory ( which is common practice in grid based simulations ) .",
    "this    baryon density field is initially gaussian .",
    "1lpt / lla : : :    again 1lpt is used , but now the initial baryon density field is    computed according to equation ( [ eq : gasdens ] ) , so that it is    consistent with 1lpt . this initial baryon density field is no longer    gaussian .",
    "2lpt / lla : : :    second order lagrangian perturbation theory ( cf .",
    "section [ sec : seclpt ] )    is used for dark matter and baryons , using equation ( [ eq : gasdens ] ) a    consistent initial baryon density field is generated .",
    "we find that a similar transient behaviour as that between 1lpt and 2lpt for pure cdm simulations ( cf .",
    "* ; * ? ? ?",
    "* ) can be observed .",
    "the skewness of the density field is underestimated when starting at @xmath236 with the initially gaussian field ( ept ) .",
    "this is somewhat improved when starting at higher redshifts .",
    "when using an initial density field that is consistent with 1lpt , the skewness is boosted so that the dependence of the pdf on the initial redshift of the simulation becomes smaller . when using 2lpt and lla , no significant dependence of the pdf on the starting redshift can be observed .",
    "note that we show the results for the baryon density field directly taken from the simulations rather than a density field that was smoothed with an aperture filter .",
    "filtering with a finite apperture however leads to almost identical results , the skewness is underestimated at high redshifts independent of scale .    in summary , eulerian perturbation theory leads to an underestimation of the skewness of the baryon density pdf at high redshifts .",
    "when using the lla for the baryons , a pdf is imposed that is consistent with lagrangian perturbation theory . in particular , as has been shown already for dark matter simulations , the density pdf becomes much less sensitive to the initial starting redshift when using 2lpt . using the local lagrangian approximation ,",
    "consistent initial baryon density fields can be construed .",
    "we have presented and implemented a method to generate real - space sampled initial conditions for nested grids , extending prior work by @xcite , @xcite and @xcite .",
    "these initial conditions are suitable for `` zoom - in '' cosmological simulations of structure formation with several levels of refinement that allow the study of single cosmological objects , such as e.g. groups and clusters of galaxies , single galaxies , or first stars , in a cosmological context at very high resolution while maintaining a small computer memory footprint .",
    "apart from the general advantage of real - space sampled initial conditions discussed by @xcite and @xcite , namely a correct reproduction of real - space statistical properties , such as the two - point correlation function and mass variance in spheres , we demonstrate that our multi - scale convolution approach for nested grids has very favourable error properties : ( 1 ) no interference of different modes between different refinement levels , and ( 2 ) errors confined to coarse - fine boundaries .",
    "we find rms errors of velocity / displacement fields in the refined region at the order of @xmath0 in units of the standard deviation of the respective fields which is an improvement of about two orders of magnitude over previous approaches .    in order to determine particle displacement and velocity fields , at first and second order lagrangian perturbation theory , we followed two approaches .",
    "first , a pure multi - grid poisson solver is used .",
    "we show that the finite volume discretization it assumes leads to a suppression of perturbations at the smallest scales that can however be corrected by a deconvolution .",
    "second , a hybrid poisson solver is developed , which uses an adaptive multi - grid algorithm for inter - level gravity and an fft - based poisson solver for the finest grid .",
    "this hybrid approach leads to no suppression of small scale perturbations . analyzing statistical properties of unigrid simulations",
    "for which initial conditions have been generated with the two different approaches , we find however that non - linear objects are not sensitive to the lack of power at these very small scales and differences are only seen in the mildly non - linear regime and at the lowest halo masses . we conclude that our real - space based approach is well suited also for initial conditions for unigrid simulations .    in order to verify the accuracy of nested initial conditions",
    "generated with our method , we investigated the properties of a galaxy cluster both in a unigrid simulation and a `` zoom - in '' simulation with one and two levels of refinement .",
    "we find that the gross properties of the cluster , such as virial mass , radius , spin , shape and velocity dispersion , are recovered at per cent level or better in the re - simulations .",
    "density profiles show no bias with scatter at the level of a few per cent , mainly attributable to slight changes in the positions of sub - structures in the re - simulations .",
    "we also find that the sub - halo mass function is recovered with an accuracy of a few per cent in all re - simulations , and observe that the hybrid poisson solver performs slightly better than the pure multi - grid approach .",
    "we thus conclude that our algorithm does not introduce bias or unreasonable scatter in observables that will be deduced from such a re - simulation and will thus provide a reliable tool to study the internal structure of cosmological observables at high resolution in large cosmological volumes .",
    "finally , we study the inclusion of a baryonic component in our approach by generalising the use of real space transfer functions also for distinct baryon and cdm density and velocity perturbations .",
    "we demonstrate that our approach reproduces the evolution expected from linear perturbation theory correctly .",
    "furthermore , we propose to set the initial baryon density field based on a local lagrangian approximation which is consistent with lagrangian perturbation theory of first or second order and which greatly reduces the dependence of the baryon density field on the starting redshift of the simulation , thus reducing transient behaviour .",
    "the authors thank hao - yi wu for help with testing the code and invaluable feedback , romain teyssier , john wise , anatoly klypin , matthew turk and adrian jenkins for comments and discussions that helped to improve both the paper and the code .",
    "finally , the authors thank the referee , simon prunet , for very valuable suggestions to improve the presentation of the paper .",
    "all simulations were run on the orange cluster at kipac / slac .",
    "this work was partially supported by nasa atfp grant nnx08ah26 g , nsf ast-0808398 and nsf ast-0807075 .",
    "ta acknowledges financial support from the baden - wrttemberg - stiftung under grant p - ls - spii/18 .",
    "brandt a. , 1973 , in cabannes h. , teman r. , eds , proceedings of the third international conference on numerical methods in fluid mechanics vol .  18 of lecture notes in physics , multi  level adaptive technique ( mlat ) for fast numerical solution to boundary value problems .",
    "verlag , berlin , pp 8289        g.  l. , norman m.  l. , 1997 , in d.  a.  clarke & m.  j.  west ed . , computational astrophysics ; 12th kingston meeting on theoretical astrophysics vol .",
    "123 of astronomical society of the pacific conference series , simulating x - ray clusters with adaptive mesh refinement .",
    "pp 363+          r.  a. , theuns t. , dalla vecchia c. , eke v.  r. , frenk c.  s. , jenkins a. , kay s.  t. , peacock j.  a. , pearce f.  r. , schaye j. , springel v. , thomas p.  a. , white s.  d.  m. , wiersma r.  p.  c. , 2009 , , 399 , 1773                                                                            v. , white s.  d.  m. , jenkins a. , frenk c.  s. , yoshida n. , gao l. , navarro j. , thacker r. , croton d. , helly j. , peacock j.  a. , cole s. , thomas p. , couchman h. , evrard a. , colberg j. , pearce f. , 2005 , , 435 , 629"
  ],
  "abstract_text": [
    "<S> we discuss a new algorithm to generate multi - scale initial conditions with multiple levels of refinements for cosmological `` zoom - in '' simulations . </S>",
    "<S> the method uses an adaptive convolution of gaussian white noise with a real space transfer function kernel together with an adaptive multi - grid poisson solver to generate displacements and velocities following first ( 1lpt ) or second order lagrangian perturbation theory ( 2lpt ) . </S>",
    "<S> the new algorithm achieves rms relative errors of order @xmath0 for displacements and velocities in the refinement region and thus improves in terms of errors by about two orders of magnitude over previous approaches . </S>",
    "<S> in addition , errors are localized at coarse - fine boundaries and do not suffer from fourier - space induced interference ringing . an optional hybrid multi - grid and </S>",
    "<S> fast fourier transform ( fft ) based scheme is introduced which has identical fourier space behaviour as traditional approaches . using a suite of re - simulations of a galaxy cluster halo our real space based approach is found to reproduce correlation functions , density profiles , key halo properties and subhalo abundances with per cent level accuracy . </S>",
    "<S> finally , we generalize our approach for two - component baryon and dark - matter simulations and demonstrate that the power spectrum evolution is in excellent agreement with linear perturbation theory . for initial baryon density fields , it is suggested to use the local lagrangian approximation in order to generate a density field for mesh based codes that is consistent with lagrangian perturbation theory instead of the current practice of using the eulerian linearly scaled densities .    </S>",
    "<S> = 1    [ firstpage ]    cosmology : theory , large - scale structure of universe  galaxies : formation  methods : numerical </S>"
  ]
}