{
  "article_text": [
    "the basic forward problem of proton radiotherapy physics is finding the dose distribution in a known heterogeneous terrain exposed to known proton beams .",
    "we present a deterministic solution from first principles which differs in many respects from current pencil beam ( pb ) algorithms .",
    "we will use the acronym pba ( pencil beam algorithm ) for our algorithm and for the fortran program written to test it ..",
    "we use the term ` ur - beam ' for an actual physical beam impinging on the terrain whereas ` pencil beam ' covers both ur - beams and the virtual beams generated in the calculation .",
    "mathematically , they are identical . ]",
    "if the heterogeneity of the terrain is merely longitudinal , that is , if the terrain comprises successive uniform slabs of whatever material and thickness , a solution is already provided by fermi - eyges transport theory @xcite",
    ". then , however , all distributions up to and including the final dose are gaussian , which fits few practical cases .    in practice",
    "non - uniform slabs are present and a fundamental difficulty arises . consider a brass collimator as a single slab , partly brass and partly air .",
    "suppose a pb entering it overlaps both materials . which one governs transport through the slab ?",
    "given the very different stopping and scattering powers of brass and air , that matters a great deal .",
    "the obvious choice is the material through which the pb centroid passes , the so - called ` central axis ' ( cax ) approximation .",
    "however , that can lead to huge errors . if the cax is just inside brass , the _ entire _ bundle of protons stops ; if just outside , the _ entire _ bundle passes through with little scatter or energy loss .",
    "the usual solution is to replace the ur - beam by an equivalent set of smaller pbs .",
    "that removes or mitigates the brass / air ambiguity for most of them .",
    "the dose at any point of interest ( poi ) in the terrain is the sum of doses from each of the new pbs , depending on its proximity to the poi . now those pbs for which the cax approximation is poor represent fewer protons , and the error is diluted by the other pbs .",
    "one method fitting the general description just given is pb _ redefinition _",
    ", described some years ago by shiu and hogstrom @xcite ( among others ) in the context of electron beam dosimetry . at preselected intervals in @xmath0 ( the beam direction )",
    "each pb is replaced by numerous smaller ones , while conserving the total number of incident particles and their phase space distribution .",
    "more recently , kanematsu et al .",
    "@xcite have proposed _",
    "dynamic splitting_. here the daughter pbs are fewer and generated in a different manner , and the mother pb is split only when necessary , that is , when ambiguity of materials actually occurs .",
    "we will retain that ` only when necessary ' feature , but depart from @xcite almost every other way , particularly recursion , which we permit and @xcite suppresses .",
    "redefinition and dynamic splitting nominally address the same problem , but _ we need both_. that essential point is best explained by looking ahead to our first example ( sec.[sec : hcldata ] ) .",
    "a proton beam passes through a pb scatterer and a large air gap and hits a brass collimator , where the single scattered gaussian beam is purposely broad ( @xmath9 mm ) so as to illuminate the 20 mm hole more or less uniformly .",
    "we wish to compute the dose downstream including collimator scatter ( dose from protons that interact with the brass without stopping in it ) .    that is dominated by a critical zone around the bore , @xmath10 mm thick for brass , where protons have a comparable chance of staying in the brass or scattering out ( fig.[fig : gmctr2 ] ) . probing that zone",
    "requires pbs of comparable size , say @xmath11 mm , or @xmath12 smaller than the incident pb . as we will see , our splitting method reduces size by roughly @xmath13 per split .",
    "it therefore requires some 15 splits .",
    "however , each split also replaces one pb by seven , yielding @xmath14 pbs , an intractable number .",
    "protons per treatment , so our smallest pb would represent a single proton ! ]    suppose instead that , just before the collimator , we fill a region a bit larger than the bore with overlapping 0.5 mm pbs faithfully derived from the ur - beam , redefining it .",
    "that gets us within striking distance of the required size and generates only a few thousand pbs .",
    "most will either stop in brass or pass through air without further division . in the example",
    "425k pbs are generated in all .",
    "of these , 117k cross a plane at the downstream face of the brass , combining into the six transverse dose distributions shown ( fig.[fig : hclx0258 ] ) .",
    "the calculation takes a mere 1.4min .",
    "we have explained why dynamic splitting alone ( at least , as we implement it ) is insufficient . on the other hand , redefinition alone generates many unneeded pbs , again yielding long computation times @xcite .",
    "fig.[fig : pbtracks ] , generated by pba , shows the combined effect of redefinition ( collimator entrance ) and subsequent recursive splitting .",
    "note the qualitative resemblance to fig.[fig : gmctr2 ] , though the assumed incident beam is less divergent . in both figures , straight - through tracks are suppressed .",
    "besides combining redefinition with a recursive variant of dynamic splitting , pba departs from current pb algorithms in other ways .",
    "we have already mentioned the _ terrain _ which comprises not just the patient or water tank but also ( as desired ) the scattering beam line and beam modifying devices such as range shifters , collimators , range compensators and air gaps . in other words ,",
    "our algorithm solves ( or can solve ) the entire problem .",
    "effective source distance and size are not required input .",
    "they emerge from the mechanical description of the beam line as we will demonstrate .",
    "another feature is _ parity of objects_. all items in the terrain are represented by stacks of slabs , heterogeneous or not as appropriate , and all such stacks are processed in exactly the same way .",
    "a collimator is simply a stack of heterogeneous slabs , thick enough to stop unlucky protons .",
    "there are no fictitious ` beam defining planes ' which either pass or totally stop protons .",
    "fig.[fig : ss2 ] illustrates how a compensated contoured scatterer , surrounded by its collimator , is handled by pba .",
    "yet another feature is _ parity of materials_. fig.[fig : hizloz ] shows that energy loss and multiple coulomb scattering ( mcs ) behave quite differently as we traverse the periodic table . for water - like materials",
    ", one does sufficiently well by adjusting electron density , but for materials as disparate as pb and be we must use correct stopping and mcs theories . therefore we do not single out any material ( such as water ) for special handling , or as a reference .",
    "each material has its proper stopping power , using the vers approximation to fit standard tables @xcite , and its proper scattering power using @xmath15 @xcite as a proxy for molire theory @xcite .",
    "our longitudinal or energy - like variable , rather than kinetic energy or residual range in water , is the kinematic quantity @xmath4 ( proton momentum times speed ) .",
    "@xmath4 serves well for both the range - energy relation and mcs . using it , rather than residual range in water , respects parity of materials .",
    "the computational heart of pba is a stack processor to handle splitting , nested in a loop over ur - beams , nested in a loop over states of the terrain ( for instance , range modulator steps ) .",
    "that structure favors neither scattering nor pencil beam scanning ( pbs ) . either is handled with equal ease .",
    "we developed and tested our algorithm with a fortran program also called pba .",
    "as usual at this stage of development , it treats simple geometric situations rather than being a dose engine for general use , but the code should be adaptable .",
    "source code , a windowsxp executable and working files are in bgware at    http://users.physics.harvard.edu/gottschalk    we will use fragments of pba or its input file to illustrate a number of points . a statement such as @xmath16\\;\\sigma_x\\ ] ] means that @xmath17 is replaced by its original value times a pba parameter ( usually from the input file ) having a typical value of @xmath18 .",
    "that is to say , @xmath19 acts like @xmath20 in fortran .",
    "fig.[fig : haloreactions ] shows schematically the dose distribution around a beam stopping in water .",
    "it illustrates the fact that the _ core _ , dominated by multiple electromagnetic ( em ) processes , is surrounded by a far larger _ halo _ ( charged secondaries ) and a still larger _ aura _ ( neutral secondaries ) .",
    "those are due to hard single scatters either by the em or the nuclear force , off free protons or the @xmath21o nucleus as a whole ( coherent scatter ) or its constituent particles ( incoherent scatter ) .    at 180mev , a typical radiotherapy energy , the core retains some 80% of the primary protons and some 85% of the primary energy ( integrated dose ) . in common with all other pb algorithms ,",
    "it is only the core whose evolution we calculate . that , however , dominates the high - dose region and therefore dominates the conformity of the dose to the target .",
    "pedroni et al .",
    "@xcite first showed that the halo must eventually be taken into account for accurate absolute dosimetry .",
    "how that is best done is a still unsolved problem in our view @xcite and beyond the scope of this work .",
    "we shall say a bit more about it when discussing the appropriate mass stopping power @xmath22 to use when computing dose ( sec.[sec : dose ] ) .",
    "collimator scatter is a minor issue in proton radiotherapy , but it is the acid test of deterministic dose algorithms . the heterogeneity is extreme , and the zone of interest is @xmath10 mm depending on material .",
    "moreover , experimental data are easily obtained with no more than a broad beam , a collimator , a small scanned dosimeter and perhaps a water tank .",
    "all this explains our seeming preoccupation with collimator scatter .",
    "let us now describe the terrain in more detail .",
    "everything is divided into slabs perpendicular to the nominal beam direction @xmath23 .",
    "the description corresponding to fig.[fig : hclx0258 ] is    .... terrain : mtl or file , # slabs , thickness ( mm ) - - - - - - - - - - - - - - - lead           1        .5    material , # slabs , total mm air            5    5853 .",
    "redef1 hcl.cir       40      36.5    file , # slabs , total mm , xbb min mm histograms air            1        .6     air            4      40 .",
    "air            1     134.8     end          999     999      = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = ....    the string `` terrain : ` ' identifies the block .",
    "the first line specifies 0.5 mm thickness of lead ( pb ) divided into 1 slab ; the next , 5853.mm of air in 5 slabs .",
    "the next line is an instruction to transport the pb to the next slab , then redefine it .",
    "parameters for the redefinition are elsewhere in the input file .",
    "the collimator itself is a bit too complicated to describe fully in the next line , so it refers to a file ` hcl.cir ` ( ` .cir ` being our standard extension for a circular inhomogeneity ) which reads    .... brass         outer material air           inner material 0   0   9.88    xc , yc , radius ( mm ) ....    note , however , that the total thickness and number of slabs are always defined outside the file .",
    "the instruction `` histograms ` ' appears just prior to the @xmath0-plane at which histograms are to be incremented , and the list continues in the same vein .",
    "`` end ` ' designates the end of the terrain .",
    "a pb that has not ranged out is transported one last time to this plane , the dose is scored , and the pb is deleted .",
    "a slab is identified with its entrance face .",
    "thus @xmath24 designates the value of @xmath4 at the entrance to the fifth slab .",
    "certain @xmath0-planes are designated as ` measuring planes ' , at which the dose is evaluated . in pba the measuring planes are contiguous and grow forward from ` end ` ( they need not be equally spaced ) . in the example , if we specify ( elsewhere ) six measuring planes , the last is at @xmath25 and the first at the entrance to the 40 mm air gap .    to demonstrate that pba is a calculation from first principles , suppose we wish to improve the penumbra at 175.4 mm by replacing the 5.8 m air gap by a helium bag .",
    "a conventional pb algorithm @xcite would require new measurements of effective source distance and size . with pba",
    "we need only replace ` air ` in the terrain description by ` helium ` to obtain the equivalent of fig.[fig : hclx0258 ] under the new conditions .",
    "there are eleven essential parameters plus two which are convenient in program development .",
    "pb parameters are only defined at a @xmath0 plane .",
    "the calculation starts by placing the parameters of an ur - beam at @xmath26 on a stack . in pba",
    "the stack is implemented thus :    _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ ....   parameter ( k1=1,k4=20000 )   integer*8 snbu   common / bunpars / k2,k3,snbu(k4),igbu(k4),xbu(k4),ybu(k4),jzbu(k4 ) , 1   pvbu(k4),xpbu(k4),ypbu(k4),a0(k4),a1(k4),a2(k4),jzsp(k4 ) , 2   bnc(k4 ) .... _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _    ` k4 ` is the stack size which is large because thousands of pbs from redefinition may be placed on the stack before they are processed . `",
    "k3 ` is no longer used , ` k1 ` is trivial , and ` k2 ` is the stack pointer .      to maintain accuracy over a large number of binary splits",
    "we define an integral ` generation index ' ( in the genealogical sense ) ` igbu`@xmath27 .",
    "the charge carried by a given pb is proportional to @xmath28 .",
    "an ur - beam has @xmath29 . when it is split one daughter has @xmath30 and the remaining six have @xmath31 .",
    "thus charge is conserved in a split ( @xmath32 ) .",
    "however , in implementing weighted beams ( as in range modulation ) or pb redefinition it becomes necessary to depart from binary arithmetic and we introduce a second charge - governing parameter ` bnc`@xmath33 ( ` base nanocoulombs ' ) .",
    "the charge carried by a pb is therefore @xmath34      these are the usual @xmath35 ( mm ) and @xmath36 ( mrad ) .",
    "the small - angle approximation is always valid for protons because the maximum mcs angle ( for near - stopping pb ) is @xmath37@xmath38 and typical angles in a calculation are much smaller .",
    "however , because we slice the terrain into @xmath0-planes normal to the nominal beam direction , ur - beam inclinations are also limited by the small - angle approximation .",
    "for instance , if the gantry angle is changed significantly , that would call for a new calculation .",
    "because @xmath0 is quantized , the longitudinal coordinate is represented by an index ` jzbu ` .",
    "we use the kinematic quantity @xmath4 ( proton momentum times speed ) which is convenient for the range - energy relation ( section [ sec : re ] ) and for multiple coulomb scattering ( section [ sec : mcs ] ) . as a symbol for a _ single _ kinematic variable . ] for a particle of rest energy @xmath39 it is related to kinetic energy @xmath40 by @xmath41 where @xmath42 is the reduced kinetic energy . for radiotherapy protons ( @xmath43mev ) the coefficient of @xmath40 in eq.[eqn : pv ]",
    "ranges from 2 to 1.76 so one can think of @xmath4 as being roughly twice the kinetic energy .",
    "the fermi - eyges moments @xcite @xmath44 represent the spread in projected angle and transverse position and the correlation between angle and position at the entrance to each slab . in a system of isotropic scatterers",
    "a pb has a circular cross section and its @xmath45s in the @xmath46 and @xmath47 projections are equal . in pencil beam scanning",
    ", incident beam characteristics may differ in the two transverse planes though we usually try to minimize that difference . if the algorithm were extended to magnets",
    ", we would definitely need two sets of as .",
    "in short , pba assumes @xmath48 but in some situations we might need two sets of @xmath45s .",
    "pba uses the @xmath45s internally but they are a bit abstract for i / o so we use proxies .",
    "two choices are obvious : the gross transverse spread @xmath49 and the gross angular spread @xmath50 . these define the bounding box of the ellipse ( fig.[fig : ellipsethetac ] ) .    a good candidate for the third is the angular confusion @xmath51 where @xmath52 .",
    "it is an angle , which makes it easy to visualize , and it must lie between @xmath53 ( a degenerate ellipse , emittance @xmath54 , position and direction perfectly correlated ) and @xmath55 ( an erect ellipse , emittance @xmath56 ) .",
    "physically , @xmath57 is the rms spread in direction of protons emerging from a slit at @xmath58 or any other @xmath46 @xcite .",
    "it determines the sharpness of the dose distribution behind an edge illuminated by the pb in question .",
    "the distance to the virtual point source @xmath59 also plays an important role in pba , and one may wish to choose @xmath60 so as to obtain a desired @xmath61 .",
    "given @xmath17 , @xmath62 and @xmath60 we find @xmath63 so the desired value is @xmath64 the desired @xmath61 can be arbitrarily large but it can not be smaller than @xmath65 corresponding to the corner of the bounding box .",
    "eq.[eqn : thetac ] illustrates a pitfall associated with expressing angles in mrad as pba does ( a choice which is otherwise convenient ) .",
    "we must convert @xmath66 to mrad before using it .      in program development",
    "it is convenient to assign a serial number ` snbu ` to each pb .",
    "its largest value is then the total number of pbs generated in the calculation .",
    "( some vanish and are never transported . )",
    "it may also be convenient to know where a given pb was created by setting a parameter ` jzsp ` @xmath67 at split time and leaving it constant during transport .",
    "redefinition is the replacement of the mother pb by many daughters , much smaller and evenly spaced in the @xmath68 plane .",
    "we usually use it at the entrance to a collimator and edit out daughters that are certain to stop .",
    "four parameters govern redefinition .",
    "they are @xmath69 ( mm ) the @xmath70 of the daughters , @xmath71 ( mm ) their spacing , @xmath72 ( mm ) the margin allowed around the hole in a collimator and @xmath73 ( dimensionless ) , the fraction of the mother to be used , in the scale of her @xmath17 .",
    "the last is needed when ( for instance ) the mother is much smaller than the hole in the collimator ; thus @xmath74 means the mother pb will be ` copied ' out to @xmath75 .",
    "fig.[fig : redxy ] shows daughters in the @xmath68 plane at the entrance to a square collimator given a 1 mm margin .",
    "fig.[fig : redps ] shows mother and daughters in phase space .",
    "each daughter is an erect ellipse with @xmath49 dictated by @xmath69 and height @xmath76 equal to the angular confusion @xmath77 of the mother . since @xmath77 is independent of @xmath46 that would , if we plotted the daughters in the normal way , give ellipses outside the mother ellipse , which looks wrong .",
    "therefore we have instead adjusted the daughter ellipses for equal phase space density to the mother at their point of tangency .      here and elsewhere in this document ,",
    "square brackets identify parameters of the mother .",
    "auxiliary quantities we will need are @xmath78}&=&[a_0][a_2]-[a_1]^2\\\\ { [ s_\\mathrm{vir}]}&=&1000\\ ; [ a_2]/[a_1]\\\\ { [",
    "\\,\\theta_\\mathrm{c}^2\\,]}&=&[b]/[a_2]\\\\ r_{ij}^2&=&(x_i-[x])^2+(y_j-[y])^2\\\\ p(r_{ij}^2)&=&\\frac{1}{2\\,\\pi\\;\\sigma_x^2}\\;e^{\\displaystyle{-\\frac{1}{2}\\frac{r_{ij}^2}{\\sigma_x^2}}}\\\\ \\noalign{\\noindent quantities governing spacing in $ x$ and $ x'$ ( index $ i$ , columns ) are\\vspace{5pt } } { [ r_\\mathrm{max}]}&=&p_4\\;\\sqrt{[a_2]}\\\\ \\delta x&=&p_2\\\\ n_\\mathrm{c}&=&\\mathrm{max}\\,(\\,\\mathrm{nint}\\,(2\\,[r_\\mathrm{max}]/\\delta x),1)\\\\ \\delta x&=&(n_\\mathrm{c}-1)\\;\\delta x\\\\ \\delta x'&=&1000\\ ; \\delta x/[s_\\mathrm{vir}]\\\\ f_i&=&-\\,0.5+(i-1)/(n_\\mathrm{c}-1)\\quad,\\quad i=1\\ldots n_\\mathrm{c}\\\\ \\noalign{\\noindent quantities governing spacing in $ y$ and $ y'$ ( index $ j$ , rows ) are \\vspace{5pt } } \\delta y&=&\\sin(\\pi/3)\\;\\delta x\\\\ n_\\mathrm{r}&=&\\mathrm{max}\\,(\\,\\mathrm{nint}\\,(2\\,[r_\\mathrm{max}]/\\delta y),1)\\\\ \\delta y&=&(n_\\mathrm{r}-1)\\;\\delta y\\\\ \\delta y'&=&1000\\ ; \\delta y/[s_\\mathrm{vir}]\\\\ f_j&=&-\\,0.5+(j-1)/(n_\\mathrm{r}-1)\\quad,\\quad j=1\\ldots n_\\mathrm{r}\\\\ \\noalign{\\noindent finally\\vspace{3pt } } q_{ij}&=&[q]\\ ; 0.5^{\\;\\displaystyle{[i_g]}}\\times f(\\delta x)\\times p(r_{ij}^2)\\label{eqn : qij}\\\\ i_g&=&0\\label{eqn : ig}\\\\ x_{ij}&=&[x]\\;+\\;f_i\\,\\delta x\\;+\\;0.5\\times\\mathrm{mod}\\,(j+1,2)\\times\\delta x\\\\ x_{ij}'&=&[x']\\;+\\;f_i\\,\\delta x'\\;+\\;0.5\\times\\mathrm{mod}\\,(j+1,2)\\times\\delta x'\\\\ y_j&=&[y]\\;+\\;f_j\\,\\delta y\\\\ y_j'&=&[y']\\;+\\;f_j\\,\\delta y'\\\\ \\noalign{~ } j_z&=&[j_z]\\\\ pv&=&[pv]\\\\ a_0&=&[\\theta_\\mathrm{c}^2]\\\\ a_1&=&0\\\\ a_2&=&p_1 ^ 2\\end{aligned}\\ ] ]    eq.[eqn : qij ] apportions the electric charge of the mother ( first factor on the rhs ) .",
    "@xmath79 corrects for the increase in the sum of daughters as they are brought closer together .",
    "( we tabulate the sum over a range of @xmath80 values and fit that with a fourth degree polynomial , whose inverse is @xmath79 . ) @xmath81 confers , on the sum of daughters , the cylindrical gaussian shape of the mother .",
    "charge is conserved to the extent that @xmath73 is sufficiently large .",
    "the generation index is cleared on redefinition ( eq.[eqn : ig ] ) so that daughters get a fresh start vis - a - vis splitting .",
    "fig.[fig : redcomp ] demonstrates the gaussian compliance of the sum of daughters to a mother partly passing through a centered collimator , with the mother offset in the @xmath47 direction .",
    "pba triggers redefinition manually .",
    "one places ` redef1 ' or ` redef2 ' just before a collimator in the terrain description .",
    "parameters for redef1 and redef2 may be the same or different .",
    "splitting a pb , in our sense of the term , replaces the mother pb by seven daughters . except for the fact that our daughters , too , radiate from the virtual point source @xcite defined by the mother ,",
    "our scheme is entirely different from that described by kanematsu et al .",
    "we attempt to preserve , as well as possible , the cylindrical symmetry characteristic of mcs in ordinary materials .",
    "that is , our scheme is inherently 2d .",
    "moreover , we conserve emittance @xmath82 rather than the local angular spread or ` angular confusion ' @xmath77 .",
    "fig.[fig : splitxy ] shows mother and daughters in the @xmath68 plane at the @xmath0-plane where the split occurs .",
    "circle radii are proportional to @xmath83 of each",
    "two dimensionless parameters govern the split : @xmath84 the change in @xmath85 and @xmath86 , and @xmath87 the spread in @xmath68 space .",
    "thus daughters have @xmath88 $ ] and @xmath17 only decreases by @xmath89 per split .",
    "trying for more worsens the gaussian compliance discussed later .",
    "line weights in fig.[fig : splitxy ] are proportional to the relative charge carried by each pb : 8 units for the mother , 2 for the central daughter and 1 for the six outboard daughters corresponding to generation indices @xmath90 .",
    "thus splitting skips a generation , and charge is rigorously conserved in a split .",
    "fig.[fig : splitps ] shows the split in phase space , with four daughters that would otherwise overlap slightly displaced .",
    "vector notation is convenient . defining auxiliary unit , generation ( @xmath1 ) , cosine and sine vectors by @xmath91 and , as usual @xcite @xmath92&=&[a_2]/[a_1]\\\\ { [ b]}&\\equiv&[a_0]\\,[a_2]-[a_1]^2\\\\ \\noalign{\\vspace{3pt}\\noindent",
    "then , with   daughters indexed per fig.\\,\\ref{fig : splitxy } , we have\\vspace{5pt } }",
    "\\mathbf{i_g}&=&[i_g]\\,\\mathbf{u}\\;+\\;\\mathbf{g}\\\\ \\mathbf{q}&=&[q]\\;\\mathbf{u}\\\\ \\mathbf{x}&=&[x]\\,\\mathbf{u}\\;+\\;p_2\\,[\\sigma_x]\\,\\mathbf{c}\\\\ \\mathbf{x'}&=&[x']\\,\\mathbf{u}\\;+\\;(p_2\\;[\\sigma_x]\\,/[s_\\mathrm{vir}])\\,\\mathbf{c}\\\\ \\mathbf{y}&=&[y]\\,\\mathbf{u}\\;+\\;p_2\\,[\\sigma_y]\\,\\mathbf{s}\\\\ \\mathbf{y'}&=&[y']\\,\\mathbf{u}\\;+\\;(p_2\\,[\\sigma_y]\\,/[s_\\mathrm{vir}])\\;\\mathbf{s}\\\\ \\mathbf{j_z}&=&[j_z]\\;\\mathbf{u}\\\\ \\mathbf{pv}&=&[pv]\\;\\mathbf{u}\\\\ \\mathbf{a_0}&=&p_1\\,[a_0]\\;\\mathbf{u}\\\\ \\mathbf{a_1}&=&(\\,p_1 ^ 2\\;[a_0]\\,[a_2]\\,-\\,(1/7)^2\\;[b]\\,)^{1/2}\\;\\;\\mathbf{u}\\\\ \\mathbf{a_2}&=&p_1\\,[a_2]\\;\\mathbf{u}\\end{aligned}\\ ] ]      how well does the sum of split daughter pbs match the original gaussian ?",
    "we apply an ur - beam to mp @xmath26 , which automatically records the dose distribution there .",
    "we then split the pb recursively into 751 daughters ( arbitrary number ) , transport them through 0.1 mm air , and record their summed dose distribution at @xmath93 .",
    "the two dose distributions agree closely along the @xmath46 axis ( fig.[fig : splitx ] ) as well as the @xmath47 axis ( not shown ) .",
    "next , we directed a 158.6mev ur - beam at a water tank and transported it unsplit to 50 , 100 and 150 mm ( near stopping ) depth . in a second run",
    "we split the ur - beam into 1219 daughters ( arbitrary number ) before transporting them . in this case , transport involves transverse spreading in the water as well as the increase of stopping power with depth .",
    "again , the two dose distributions agree in @xmath46 ( fig.[fig : hmlutest ] ) and @xmath47 ( not shown ) .",
    "agreement in both @xmath46 and @xmath47 is non trivial since they correspond to different planes of symmetry cf .",
    "fig.[fig : splitxy ] .",
    "we have verified , in numerous cases where cylindrical symmetry is expected , that dose distributions along an axis inclined at an arbitrary angle agree closely with those along the @xmath46 axis .      to split or not to split",
    "is governed by three parameters @xmath94 , @xmath95 and @xmath96 .",
    "their numerical values vary widely depending on the problem and the degree of convergence required .",
    "each pb is examined at each @xmath0-plane and split if @xmath97 the first condition tests the generation index , limiting the depth of recursion . depending on the problem ,",
    "execution time depends strongly on @xmath72 , often doubling or worse per unit increase in @xmath72 .",
    "the second condition requires the pb to have some fixed size before it splits .",
    "the third is the most obvious , @xmath98 being the distance to a boundary between two materials .",
    "it requires the pb axis to be near a boundary , in the scale of the pb s @xmath17 .",
    "we do not , at present , test the _ degree _ of heterogeneity , that is , how different the two materials are .",
    "virtual heterogeneities such as an air / air boundary are permitted , and are useful for such tests as described in the previous section .    at present the splitting trigger eq.[eqn : splittrigger ]",
    "is the least satisfactory aspect of the algorithm .",
    "although it is possible to find combinations of @xmath99 that give solutions reasonably stable with respect to these and other parameters , we do not understand the interaction between @xmath99 very well , and have so far been unable to find one single parameter that governs convergence smoothly . furthermore , though some absolute condition such as @xmath100 appears to be necessary , it introduces non - physical discontinuities into the @xmath4 distribution and sometimes into final dose distributions .",
    "more work on the trigger is needed .",
    "to ` transport ' a pb from @xmath101 to @xmath102 is to replace its parameters at @xmath101 by those at @xmath103 .",
    "the equations , where ` @xmath19 ' reads ` is replaced by ' ( same as fortran ` = ' ) , are @xmath104 for instance , eq.[eqn : re ] tells us to find the range corresponding to @xmath4 in material @xmath105 , subtract @xmath106 , the step thickness , to get the residual range , convert back to @xmath4 and replace the current @xmath4 by that smaller value .",
    "pursuant to these formulas charge is conserved , @xmath46 and @xmath47 propagate as straight lines , slopes are conserved , and the @xmath0-plane index increases by 1 .",
    "material properties enter through the range - energy relation ( transport of @xmath4 ) and the @xmath45s ( mcs ) .",
    "the new value of @xmath4 is computed by manipulating the range - energy relation which ( unlike using stopping power ) is correct for any @xmath106 .",
    "we use the vers approximation @xcite @xmath107 where @xmath108 is the geometric range ( mm ) and @xmath109 are parameters characteristic of the stopping material . at initialization pba",
    "assigns an index to each new material and finds its @xmath110 and @xmath111 using two kinetic energies ( input parameters ) and the corresponding ranges from standard tables e.g. @xcite .",
    "fig.[fig : testrover ] compares eq.[eqn : overas ] to the more common @xmath112 .",
    "they have comparable accuracy ( 1 - 2% ) but are seen to be complementary , vers being better for light materials and @xmath112 for heavy materials .",
    "details depend on the fiducial energies ( here 32 and 160mev ) , and it is possible to make one approximation look considerably better than the other in particular cases .",
    "eqs.[eqn : a2k ] through [ eqn : a0k ] , from kanematsu @xcite , are equivalent to standard transport equations for the @xmath45s @xcite integrated by the midpoint method .",
    "@xmath113 is the value at mid - step of the scattering power @xmath114 ( expressed in mrad@xmath115/mm ) for which a number of formulas have been proposed @xcite . with letter subscripts",
    "denotes a scattering power rather than kinetic energy .",
    "] we use @xmath116 where @xmath117mev .",
    "the correction factor , which measures nonlocality by the decrease in @xmath4 , is @xmath118 @xmath119 is the initial value and @xmath4 is the value at the point of interest .",
    "the scattering length @xmath120 ( cm ) is @xmath121 where @xmath122 is density , @xmath123 is the fine structure constant , @xmath124 is avogadro s number , @xmath125 is the classical electron radius and @xmath126 are the atomic weight and atomic number of the scattering material . for compounds and mixtures",
    "@xmath120 obeys a bragg rule @xmath127 where @xmath128 is the fraction by weight of the @xmath129 constituent .",
    "@xmath120 is a material property very similar to the radiation length @xmath130 but it improves the material dependence of the scattering power particularly for light materials . for details see @xcite and for a table of @xmath120 values for common materials see @xcite .",
    "figs.[fig : exptfigpoly ] and [ fig : exptfiglead ] compare @xmath15 for polystyrene ( nearly water equivalent ) and lead with theory , with experiment , and with other formulas @xmath131 .",
    "if the proton ranges out in @xmath106 ( residual range @xmath132 ) the transport subroutine sets a logical variable ` rangeout ` which will cause the main program to go to the next pb .",
    "if , alternatively , @xmath103 corresponds to the last plane in the problem , ` reachend ` is set with the same result .",
    "fig.[fig : basicprogram ] is a heavily edited version of the basic program , which consists of three nested loops .",
    "the outermost runs over states of the terrain ( here exemplified by ` np1 ` and ` np2 ` , the indices of the first and last range modulator steps ) .",
    "since every state of the terrain is different and may be exposed to different ur - beams , ` whatshere ` ( explained later ) and the array of ur - beams are initialized .",
    "the next loop pushes the state of the next ur - beam at @xmath26 onto the computer stack and scores its dose at @xmath26 if @xmath26 is a measuring plane .    in the innermost loop ,",
    "the state of the current pb is examined at the current @xmath0-plane by a subroutine ` whatshere ` . given @xmath46 and @xmath47 of the pb centroid as well as the @xmath0-plane index @xmath133 , ` whatshere ` returns ` kml ` , the material index at that position on that @xmath0-plane , ` dzz ` , the thickness of the next slab , the density and scattering length of the material and above all , ` dsqnh ` , the squared distance to the nearest heterogeneity boundary .",
    "( in a homogeneous slab ` dsqnh ` is set to some very large number . )",
    "depending on ` whatshere ` one of three things happens .",
    "the pb state is    * redefined ( replaced by many new pbs ) or * split ( replaced by seven new pbs ) or * transported through the next slab ( pb state including ` jz ` is replaced ) .    as detailed in previous sections .",
    "if during transport a pb ranges out it is deleted ( the stack pointer ` k2 ` is decremented ) .",
    "if it reaches the last plane in the problem its dose is scored there and the pb is deleted .",
    "when the stack is empty ( ` k2 = 0 ` ) control passes out to the ur - beam loop which places the state of the next ur - beam ( at @xmath26 ) onto the stack . when the ur - beams for the current state of the terrain are exhausted control passes to the terrain loop and the next state of the terrain .",
    "when all states of the terrain are exhausted the computation is done .",
    "so far , no useful information has been saved from all this activity .",
    "after each exit from ` transport ` , if the @xmath0-plane just reached is a measuring plane , ` addtodose ` updates a dose matrix by adding to appropriate elements the dose from the pb just transported .",
    "the dose matrix ( defined to suit the problem under study ) is the permanent record of what was accomplished and , along with the input file ( a record of what was undertaken ) is available to pba and other programs for post - processing ( ` analysis ' ) .",
    "note that the program makes no distinction between scattered and scanned ( pbs ) beams .",
    "ins scattered beams the terrain will be more complicated and usually have more states ( range modulator steps ) , while there will only be one ur - beam per step . in pbs",
    "the reverse is true , but the program is the same in either case .",
    "the program described thus far is basically a fluence calculation . at the current measuring plane we know the centroid @xmath134 and rms width @xmath17 of a cylindrical gaussian describing the fluence of the current pb , as well as its energy - like variable @xmath4 .",
    "we score the dose deposited by that pb at selected measuring points in the plane and @xmath47 axes , perpendicular to the @xmath0 axis . ] using the fundamental equation @xmath135 where @xmath136 is dose , @xmath137 is fluence and we will deduce the mass stopping power @xmath22 from the value of @xmath4 .    here a problem mentioned in sec.[sec : hard ] arises , namely the dose from hard single scatters ( or ` nuclear interactions ' ) . that dose forms a broad halo around the em core ( cf .",
    "fig.[fig : haloreactions ] ) . accounting for it properly in arbitrary geometries is complicated , and is an open question . here",
    ", we will assume one of two limiting cases :    * the poi is in the middle of a broad beam where em and ` nuclear ' equilibrium obtain , or * the poi is in a region where there are few secondaries from hard scatters .",
    "in the first case an effective stopping power @xmath138 , mixing em dose with nuclear secondary dose , is appropriate ; in the second , a purely em stopping power @xmath139 @xcite .",
    "@xmath138 is appropriate near the middle of a broad field in ( say ) a water tank .",
    "it can not be calculated from first principles because there is no convenient theory describing hard scatters .",
    "it can , however , be measured by creating a broad beam , measuring the depth - dose distribution along its central axis , and dividing the dose by the fluence in air at the time of measurement , applying eq.[eqn : d ] .",
    "the effective source distance must be known . ]    in pba the depth - dose is retrieved from a text file , extension .bpk , containing a cubic spline fit to the measured data . at initialization",
    "this file is read , corrected for @xmath140 , normalized to absolute gray/(@xmath141p / cm@xmath115 ) ) using the tabulated @xmath22 at the incident energy , and used to populate a linear interpolation lookup table .    in current practice ( @xmath143 )",
    "is known as integral depth dose ( idd ) and is used ( wrongly , we believe ) to parameterize the core / halo and commission pbs treatment planning systems @xcite .",
    "@xmath139 , unlike @xmath138 , can not be measured because we can not turn off hard scatters .",
    "however , it can be computed from first principles by convolving a tabulated @xmath144 with a gaussian of rms width @xmath145 which combines range straggling with the energy spread ( if any ) of the incident beam .",
    "thus @xmath146 where @xmath147 is a 1d gaussian normalized to unit area .",
    "the limits of integration are arbitrary and are adjustable in pba .",
    "integration may be performed numerically by simpson s rule @xcite , but requires a cutoff procedure because @xmath148 is singular at end - of - range .",
    "we break the integral at @xmath149 into two terms , one nonsingular and the other susceptible to approximation : @xmath150 the second integrand is dominated by the singularity of @xmath148 at @xmath151 .",
    "we approximate that integral by setting @xmath152 and find @xmath153 @xmath154 is the residual kinetic energy , which we obtain from a range - energy table , at @xmath155 .",
    "the overall result is insensitive to @xmath155 .",
    "a minor problem arises in that the mean projected range of a proton beam equals the distal 80% point of the bragg peak or effective stopping power : @xmath156 .",
    "if range - energy tables are used the normal way , the calculation terminates ( ` rangeout ` is set ) at @xmath157 .",
    "sometimes is is desirable to see the dose distribution beyond that point . in pba that is accomplished by setting the ` bp toe level ' to ( say ) 0.2 rather than 0.8",
    ". then incident @xmath40 ( and therefore incident @xmath4 ) are increased slightly to postpone ` rangeout ` .",
    "that results , of course , in a slight error , but we have not thought of a better workaround . the problem may stem from approximating , by a deterministic algorithm , what is fundamentally a stochastic process ( slowing down of protons ) .      using eq.[eqn : d ] we add the appropriate dose to all measuring points in the current measuring plane within range of the current pb .",
    "we begin with the point nearest the pb centroid and work outwards in each direction until the fluence vanishes .",
    "the fluence is given by a 2d ( cylindrical ) gaussian of rms width @xmath17 centered at @xmath158 , the coordinates of the centroid .",
    "the appropriate effective mass stopping power in the ` dose - to ' material , either measured or computed as just described , has previously been tabulated as a function of residual range .",
    "( for instance , if we are concerned with diode measurements , the ` dose - to ' material would be silicon . )",
    "the residual range is computed from @xmath4 using the vers approximation .",
    "obviously we can accumulate fluence ( instead of dose ) distributions by setting the stopping power to an appropriate constant .",
    "a pba software switch selects fluence , @xmath159 , instead of dose , @xmath160 .",
    "around 1993 , while investigating off - energy protons in dosimeter calibration beams @xcite , we measured collimator scatter at the harvard cyclotron laboratory ( hcl ) . these data , presented at conferences @xcite but never published , were invaluable in developing pba , and we now discuss them at considerable length .",
    "unfortunately , original tapes and notes are long gone .",
    "we re - constituted the data from old graphs , which may partly account for the problem noted below",
    ".    we will discuss ( 1 ) the experiment , ( 2 ) the systematics of collimator scatter , ( 3 ) a monte - carlo ( topas ) study of hard scatters , ( 4 ) where to normalize pba to the experimental data , ( 5 ) the @xmath140 dependence of fluence , ( 6 ) pba convergence , ( 7 ) pristine and degraded protons studied separately and ( 8) anomalies in certain frequency distributions .",
    "finally ( 9 ) we will summarize what we have learned and what needs to be re - done .",
    "we use the notation @xmath161 ; thus @xmath162 denotes the dose at measuring plane 1 ( 0.6 mm from the downstream collimator face ) at a radius near 0 mm .",
    "protons reaching mp1 with only the nominal energy loss to pb and air in the beamline are ` pristine ' .",
    "those that , in addition , lose energy to brass are ` degraded ' .",
    "the former have @xmath163mev ; the latter , @xmath164mev .      a single scattered 158.6mev",
    "proton beam was directed at a brass collimator having a cylindrical bore of 9.88 mm radius .",
    "( for exact dimensions see sec.[sec : terrain ] . )",
    "full transverse scans in air were taken with a small diode at six distances ( mp1 - 6 ) from the downstream face of the collimator .",
    "right and left half - scans were averaged to yield six virtual radial scans .",
    "the experimental data are shown , for instance , in fig.[fig : hclx0258 ] , along with a 1.4min pba computation ( line ) already mentioned ( sec.[sec : pbredefinition ] ) .",
    "a single constant , derived from @xmath162 and shown in all panels for reference , normalizes the pba results . the rms deviation of pba from experiment hovers around 6 - 7% for all mps .",
    "the choice of @xmath162 rather than @xmath165 is deliberate and will be discussed .",
    "the latter choice yields a far better fit , @xmath166 , to mp6 .",
    "the systematics of collimator scatter @xcite can be inferred from fig.[fig : gmctr2 ] .",
    "protons that interact with brass but survive fall into two categories .",
    "those entering just outside the bore ( ` outers ' ) converge towards the axis with broad angle and energy distributions : for brass , the mean angle is @xmath167@xmath38  and the critical zone around the bore is @xmath10 mm @xcite .",
    "those entering via the bore either scatter back out or emerge from the downstream face with a broad distribution of angles peaked outwards and energies peaked at the high end , from protons grazing the distal corner .",
    "these ` inners ' are , however , scarce in our data because the incident beam was nearly parallel .",
    "thus , near the collimator , we see a sharp spike just inside the physical radius : protons heading towards the axis but still far from it .",
    "dose on axis near the collimator @xmath162 is almost all from pristines , if the dose from hard scatters is small .",
    "moving downstream the spike broadens until , far from the collimator at mp6 , most degraded protons have crossed the axis and are thinly spread , though not negligible as we will see .",
    "since pba ignores hard scatters ( sec.[sec : hard ] ) it was important to estimate their contribution to the experiment .",
    "david hall of the massachusetts general hospital ( mgh ) kindly ran two monte carlo topas simulations , the first including all processes , the second omitting those involving the nuclear force .",
    "appendix [ sec : topas ] gives details .",
    "fig.[fig : topas ] shows the experimental data along with the topas ` all ' and ` em only ' results normalized in this case to @xmath165 , using a single constant for both runs and all mps .",
    "general agreement is excellent , bolstering our confidence in both topas and the experiment .",
    "the ` all ' and ` em only ' runs are barely distinguishable , justifying the view that hard scatters play a minor role .      the choice of @xmath162 vs. @xmath165 as the normalization point is more important than might appear . in normalizing one set of curves to",
    "another one usually seeks to give the best overall impression . here that favors @xmath165 ( cf .",
    "fig.[fig : hclx0258 ] ) which would yield excellent agreement at mp5 - 6 but a pba shortfall of some 6% at @xmath162 .",
    "the conundrum is this : the obvious choice suggests a pba shortfall on axis near the collimator , the other a pba excess distant from the collimator . in trouble - shooting pba",
    ", it matters a great deal which of the two we are looking for .",
    "let us take a closer look at what we expect at mp6 relative to mp1 .",
    "we expect a diminution of dose from @xmath140 but an increase in dose from degraded protons , spread out but still there .",
    "the virtual point source @xcite of a gaussian beam is used by pba during redefinition ( sec.[sec : redefinition ] ) .",
    "we choose the point source for simplicity if nothing else : it would be difficult to populate an extended source in a deterministic algorithm .",
    "now the virtual point and effective extended sources @xcite are at different distances @xmath168 from mp1 . under our conditions",
    "@xmath169 mm and @xmath170 mm , whereas the physical distance from the pb foil to mp1 is 5890 mm .",
    "could this somehow be responsible for the 6% tension between @xmath162 and @xmath165 ?",
    "put more precisely , how much does the actual fluence @xmath171 on axis differ from the @xmath140 dependence of a point source ? analysis ( appendix [ sec : inversersq ] , fig.[fig : fluencecorr ] ) shows the effect is small and constant over the applicable range of @xmath0 .",
    "therefore this explanation of the inconsistency can be ruled out .",
    "a simple cut at @xmath172mev separates pristine from degraded protons allowing us to study them separately .",
    "fig.[fig : hclx0261 ] is a normal run with dose accumulated only for pristine protons .",
    "the pba results are normalized at @xmath173 and the defect at @xmath165 is exactly that expected from @xmath140 .",
    "fig.[fig : hcl0264 ] displays degraded protons at the six measuring planes .",
    "the data points are absolute dose from a home - made monte carlo gmc .",
    "they ( and the pba lines ) show a rather considerable contribution from degraded protons at mp6 , though quite spread out by then as expected .",
    "incidentally , this is also a good test of the cylindrical symmetry expected in this experiment .",
    "there is a considerable difference between the dose on the @xmath46 and @xmath47 axes at mp5 at the geometric radius of the hole .",
    "elsewhere the agreement is fair .",
    "the hcl data afford us a simple way of studying pba convergence . on general principles",
    "we expect that reproducing very sharp features in the dose distribution requires superposing very small pbs , with a steep increase in computation time .",
    "that is confirmed by figs.[fig : hclx0258 ] and [ fig : hclx0262 ] .",
    "the former corresponds 0.53 m pbs traversing the region of interest mp1  -  mp6 ; it took 1.4min .",
    "the latter ( recursion cutoff raised from 10 to 18 ) corresponds to 40 m pbs @xmath174 in the roi , and took 93min @xmath175 .",
    "compliance at mp1 indeed improved from 7.8% to 6% but elsewhere it was worse and overall , the same .",
    "thus , execution time depends exponentially on the sharpest features to be reproduced , and broader features may actually suffer . the submillimeter edge at mp1 is a very stringent test .",
    "pba includes a histogrammer to study frequency distributions of selected variables .",
    "semilog fig.[fig : logh0262 ] corresponds to the fig.[fig : hclx0262 ] run with histograms populated at mp6 .",
    "variables shown ( cw from upper left ) are @xmath4 , @xmath4 with coarser bins , @xmath17 ( ` xbb ` ) , @xmath62 ( ` ybb ` ) , ` jzsp ` the @xmath0-plane index where the pb was born , and @xmath1 the generation index ( @xmath176 of the charge ) .",
    "for instance , at mp6 the most likely pb size is @xmath177 mm .",
    "non - physical spikes are evident in the continuous variables @xmath4 , @xmath17 and @xmath62 , apparently a beat effect between the absolute size cut in the splitting trigger ( sec.[sec : splittrigger ] ) and the number of slabs representing the collimator .",
    "this is not as serious as might appear from the frequency distribution , the absolute @xmath4 difference between ` popular ' and ` normal ' values being small .",
    "nevertheless we may be seeing traces of it in a depth - dose studied later ( cf .",
    "fig.[fig : hong11 ] ) .",
    "this pathology of pba may be another consequence of computing deterministically a process which is fundamentally stochastic , dose deposition by protons .",
    "we have discussed the hcl data at length , dwelling on the discrepancy between experiment and pba at mp6 where the agreement should be good ( and is , if we normalize there ) . that preoccupation should not detract from the fact that pba computes most of the key features of the dose , quickly solving from first principles a problem that no other deterministic algorithm even attempts .",
    "we focused on the mp6 anomaly , and where to normalize , because that determines whether we look for a pba excess in one place or a defect in another , a distinction critical to trouble - shooting . in the end",
    ", we reject both hypotheses , concluding there is a problem with the experimental data .",
    "the distribution at mp6 should be some 6% higher and the tail beyond the edge , from degraded proton crossovers , should be more pronounced . whether the problem is due to reconstructing data from graphs ,",
    "a faulty drift correction at the time of the experiment , or some other cause , is impossible to say .",
    "ideally this simple experiment , or one very like it , should be repeated .",
    "in 2006 slopsema and kooy @xcite and independently , kanematsu et al . @xcite studied and parameterized the effect of finite collimator thickness .",
    "they model a half - beam block as a pair of ideal absorbing planes separated by the actual thickness . in a scattered beam line ,",
    "the angular confusion is the same on- and off - axis @xcite but the mean proton angle is not . in consequence",
    "the two fictitious on - axis edges intercept roughly equal numbers of proton trajectories , whereas off - axis the downstream edge intercepts far more than the upstream edge , defining the spatial distribution more cleanly . therefore the on - axis penumbra of a half - beam block in a double scattered beam was predicted , and confirmed by related measurements , to be slightly greater than the off - axis penumbra .    in 2002 kooy , while commissioning gantry1 at the mgh burr center @xcite , had obtained data also relevant to this problem . to determine effective source distances and sizes for each of the seven range options , and for zero and full range modulation",
    ", he took transverse scans in air with a ptw 31006 @xcite thimble chamber ( inner diameter 2 mm ) at 200 and 700 mm from the downstream face of a @xmath178 mm half - beam block : 28 scans in all . here",
    "we will consider just one : option a7 ( range 22 cm h@xmath179o ) , no range modulation , 200 mm air gap .",
    "fig.[fig : hbb0280 ] shows the measurement and the pba prediction while fig.[fig : hbbfiles ] shows the entire pba input file , including the terrain .",
    "the computation took 14.6min .",
    "86 m pbs were generated of which 46 m reached the measuring plane , combining to form the dose distribution shown .",
    "since the pbs carry very different charges , a better throughput measure is that , of 1043pc , 100 reach the mp while 943 range out in the collimator around the contoured scatterer or in the half - beam block itself .",
    "we start with an ideal monoenergetic beam because the scatterers in the beam line swamp any reasonable initial spread , divergence and emittance , and the machine energy spread is negligible compared with @xmath180 expected @xcite from range straggling and used in computing @xmath139 .",
    "the on - axis and off - axis ( l and r ) @xmath181 penumbras ( fig.[fig : hbb0280 ] ) are 5.11 , 4.65 mm ( pba ) and 5.26 , 4.86 mm ( measured ) , corresponding to -0.15 mm and -0.21 mm , or -2.8% and -4.3% , deviations of pba from measurement .",
    "some of this is attributable to detector size , correction for which would lower the measured values by roughly @xmath182 .",
    "the excess of the on - axis over the off - axis penumbra is 0.46 mm ( pba ) , 0.40 mm ( measured ) .",
    "in addition to accurately predicting the penumbra , pba gives a reasonable account of collimator scattered dose .",
    "the long tails of the dose distribution in fig.[fig : hbb0280 ] come from protons that interact with the opposite face of the collimator , emerge , and cross the beam axis during the 200 mm drift .",
    "these , too , are asymmetric",
    ". those originating in the on - axis face are more plentiful , and pba reproduces this feature as well .",
    "we can do a rough check of the pba absolute dose prediction .",
    "the fundamental relation @xmath183 leads to @xmath184 where @xmath136 ( gy ) is dose , @xmath185 is the efficiency of the double scattering system ( fraction of incident protons reaching the useful field ) , @xmath2 ( nc ) is the incident proton charge , @xmath45 ( cm@xmath115 ) is the area of the useful field and @xmath22 ( mev/(g / cm@xmath115 ) ) is the mass stopping power . using the mass stopping power of air at 186mev ( the energy of pristine protons reaching the mp ) and estimating the efficiency and useful field radius we find @xmath186 per incident nc where pba finds 4.82mgy .",
    "much of that excess is likely genuine , because the seemingly flat central dose includes collimator scattered protons with their considerably higher @xmath22 .",
    "in proton radiotherapy practice , the dose to the patient ultimately relies on an adcl calibrated dosimeter placed in a standard field .",
    "the dose predicted by pba should be a good backup check .",
    "unfortunately , there is a problem with the current example . to obtain the excellent results shown , the 60 mm thick half - beam block",
    "was divided into just three 20 mm slabs .",
    "increasing that to ( say ) five or ten increases execution time , of course , but also somewhat _ degrades _ agreement with measurement for both the penumbra values and the collimator scattered tails .",
    "a well behaved algorithm should improve or level off with increased segmentation : here , three seems to be a magic number .",
    "we suspect some sort of interaction between collimator segmentation and the splitting trigger , most likely the @xmath187 requirement .",
    "whatever the explanation , this property of the algorithm is unacceptable and needs work .",
    "consider fig.11 ( our fig.[fig : urhong11 ] ) of hong et al .",
    "@xcite , the algorithm currently used at the mgh proton radiotherapy center .",
    "this test used the 158.6mev contoured scatterer beam at hcl with no range modulation . the terrain    .... terrain : mtl or file , # slabs , thickness ( mm ) - - - - - - - - - - - - - - - lead             1      0.42 air              1     32 .",
    "small.mod        1      1      1 step only , 0.495 mm pb air              5   1162 .",
    "redef1 02nov89.con     32     38.1    hcl contoured scatterer ( fig.5 ) air              5   4317 .",
    "redef2 hong.cir        40     38.1    brass / air , 2.4 mm radius hole histograms air              1     10 .",
    "water          100    180 .",
    "end            999    999      = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = ....    is very inefficient for pba because the open beam has a useful diameter of 240 mm but only the beam through a 5 mm diameter hole ( ratio of areas @xmath188 ) is used .",
    "the pba calculation for the 1 cm air gap with two redefinitions , at the collimator surrounding the contoured scatterer and at the collimator under study , takes 2.4 hours .",
    "pba finds only a small fraction of the observed collimator scattered dose ( fig.[fig : hong11 ] )",
    ". however , pba outperforms hong on the measured difference between the two air gaps .",
    "fig.[fig : hong11 ] shows non - physical fluctuations in collimator scatter , probably linked to non - physical spikes in the @xmath4 spectrum ( not shown ) caused by our convergence criterion eq.[eqn : splittrigger ] .    in a subsidiary study",
    "( not shown ) we studied the same collimator exposed to a single scattered beam . that requires only one redefinition and",
    "is far faster .",
    "we were able to match the observed depth - dose quite well by tuning the ellipse parameters of the incident beam , to which collimator scatter appears to be quite sensitive .",
    "in another test hong et al .",
    "put a 5 cm lucite half - beam block in front of a water tank , with a 5.3 cm air gap between the lucite and the tank , and performed transverse scans at four depths , with no range modulation .",
    "our fig.[fig : urhong14 ] reproduces their fig.14 .",
    "our fig.[fig : hong14 ] is from a pba run that took 11 hours , a long time .",
    "however , this was a drastic test .",
    "the double scattering system was modeled in full , with redefinitions at the contoured scatterer collimator and at the patient collimator .",
    "the ` water tank ' was divided into one hundred 1.5 mm slabs with the dose at each evaluated on two axes , 20.4k points in all . starting with one ideal pb",
    ", 155 m pbs were generated of which 35 m entered the water forming the dose distributions shown .",
    "alternatively , of 966pc total ( ideally 1000 ) , 26pc entered the water , 13pc left , and 953pc ranged out in a collimator or in water .",
    "computed entirely from first principles ( no source distance or source size , no assumption of constant fluence ) , our results are somewhat better thsn those of @xcite .",
    "excesses on the lhs in panels ( a ) and ( b ) , attributed in @xcite to hard scatters ( nuclear interactions ) , are smaller .",
    "they are in fact probably related to stopping power .",
    "panel ( c ) , very sensitive to depth , is reproduced by pba at a single depth , whereas @xcite requires three adjacent depths to account for all the features .",
    "thus , pba handles range mixing better .",
    "panel ( d ) shows a bump in the dose which @xcite attributes to ` slit scattering from the thick edge of the lucite ' and which , in consequence , we expected to see in pba . when we did not , we performed a subsidiary study using a much simpler terrain with pencil - beam scanning to bring out the essence of the interaction with lucite .",
    "( this run , with 80.2k pbs evaluated at 20.4k points , took 2.2min . ) a contour plot ( fig.[fig : contlucite ] ) shows edge scattering very clearly , but the transverse distribution in water on the unblocked side , 1 cm downstream of where the blocked protons stop , shows no perturbation whatsoever",
    ". that agrees with both algorithms , and we now believe that the dose glitch in frame ( d ) is an experimental artifact .",
    "we have described a deterministic algorithm implemented by a proof - of - principle fortran program . it is a calculation from first principles , requiring only physical descriptions of the terrain ( including the beam line ) and of the incident proton beams .",
    "it ignores hard scatters , as do other pb algorithms . to that approximation , computed",
    "fluence and dose per incident nc are absolute .",
    "the terrain is discretized into homogeneous or heterogeneous slabs normal to the nominal beam direction .",
    "heterogeneities are handled by pb redefinition and/or recursive dynamic splitting .",
    "all objects in the terrain are discretized and handled the same way .",
    "there are no special beam limiting structures .",
    "collimator scatter emerges as a natural consequence , and is a good test of the algorithm .",
    "incident ` ur - beams ' and virtual pbs generated during execution have the same mathematical form and are processed the same way .",
    "they are described by eleven parameters : a ` generation ' index @xmath1 and a continuous quantity @xmath2 for total charge @xmath3nc , five quantities @xmath46 , @xmath189 , @xmath47 , @xmath190 and @xmath133 for position and direction , @xmath4 for energy , and three fermi - eyges moments ( ellipse parameters ) for transverse size , divergence and emittance .",
    "cylindrically asymmetric ur - beams would require three additional ellipse parameters .",
    "two ancillary parameters , a serial number and the index of the @xmath0-plane where the pb was created , are useful in program development .",
    "each material in the terrain is handled on its own merits , and not referred to water . thus concepts such as water equivalent depth , radiological path length and residual range in water , are not used .",
    "parameters of the vers approximation @xmath5 are found from standard range - energy tables for each material encountered , and thereafter characterize that material for energy loss purposes .",
    "a scattering power @xmath15 , also a function of @xmath4 and atomic composition , represents mcs .",
    "the heart of the algorithm is a computer stack onto which pbs are placed . at each step",
    "the current pb is examined relative to the upcoming terrain slice and , depending on the result , either redefined , split , or transported to the next slice .",
    "if during transport the pb ranges out , it is deleted from the stack .",
    "otherwise , the contribution of that pb is added to the points of interest in a dose matrix .",
    "if the next plane marks the end of the terrain , the pb is then deleted .",
    "otherwise , the loop repeats .",
    "when the stack is empty , the next ur - beam is placed on it .",
    "after the last ur - beam for that state of the terrain is processed , the next state of the terrain , along with its ur - beams , is loaded .",
    "this computational structure is equally suited to scattered beams or to pencil beam scanning .",
    "pb redefinition is more or less conventional and , in the present implementation , is triggered ( if desired ) only at a collimator .",
    "the mother pb is replaced by a swarm of daughters , uniformly spaced in an hexagonal array , radiating from the mother s virtual point source , having the same @xmath62 as the mother s angular confusion @xmath191 , and individual charges that reproduce the mother s gaussian spatial distribution .",
    "pbs that have no chance of emerging from the collimator may be dropped .",
    "redefinition parameters are daughter @xmath17 , spacing , margin around collimator bore , and the fraction of the mother pb to be redefined if not otherwise limited .",
    "pb splitting replaces the mother by seven daughters .",
    "one is centered , continues along the mother s trajectory , and has 1/4 of the mother s charge .",
    "six are arranged in a hexagonal array and radiate from the mother s virtual point source , each with 1/8 of the mother s charge .",
    "that scheme is inherently 2d and respects , apparently to a sufficiently good approximation , the cylindrical symmetry of mcs in ordinary ( non - oriented ) materials . as well as charge",
    ", the mother s emittance is conserved .",
    "there are only two parameters : the ratio @xmath192 of @xmath17 ( any daughter ) to @xmath17 ( mother ) , and the ratio @xmath193 ( spatial spread , daughters ) to @xmath17 ( mother ) .",
    "the splitting trigger is governed by three parameters : the proximity , in the scale of @xmath17 ( mother ) of the mother s central axis to a heterogeneity , the absolute value of @xmath17 ( mother ) , and the depth of recursion , that is , @xmath1 ( mother ) .",
    "the _ severity _ of the heterogeneity is not considered .",
    "that admits virtual heterogeneities ( such as an air - to - air boundary ) , which are useful in program development .",
    "the splitting trigger is , at present , the least satisfactory aspect of the algorithm .",
    "in particular , the absolute size requirement seems to have a discontinuous effect on convergence , and interacts with the degree of segmentation into slabs .",
    "we are experimenting with dithering the @xmath17 cut as a possible solution .",
    "then the algorithm is no longer strictly deterministic , but the indeterminacy is very small compared to a monte carlo .",
    "transport of pb parameters from one @xmath0-plane to the next is conventional .",
    "charge is conserved , @xmath46 and @xmath47 trajectories are straight lines , @xmath189 and @xmath190 are unchanged , @xmath133 is increased by 1 , @xmath4 is diminished according to the vers parameters of the current material , and the fermi - eyges ellipse parameters @xmath194 obey the usual transport equations with @xmath6 as the scattering power .",
    "note that there is no transverse discretization or ` voxelizing ' of the problem .",
    "pb quantities such as @xmath46 and @xmath47 can assume any value .",
    "only @xmath0 is discrete .",
    "dose accumulation occurs after transport if the new @xmath0-plane coincides with a measuring plane ( mp ) , that is , a @xmath0-plane on which we wish to know the fluence or dose .",
    "in that case all points of interest in the mp , starting with the one nearest the pb axis and working outwards , are incremented with either the fluence @xmath137 or the dose @xmath195 at the appropriate distance from the pb under consideration .",
    "@xmath22 is an _ effective _ mass stopping power representing the energy loss per g / cm@xmath115 of a large cohort of protons , not a single proton .",
    "graphically , it resembles a bragg peak .",
    "pba offers two options :    @xmath7 , a purely em mass stopping power , is calculated from first principles in the ` dose - to ' material ( air , water , si @xmath196 ) by numerical convolution of its stopping power table with a gaussian representing range straggling and beam energy spread .",
    "@xmath7 is appropriate if conditions are such that secondaries from hard scatters can be neglected e.g. collimator scatter in air .",
    "@xmath8 , a mixed mass stopping power , is appropriate in the middle of a large field where hard scatters as well as mcs obey transverse equilibrium .",
    "if @xmath8 is specified , it is obtained from a measurement , either using a small dosimeter on the axis of a large field ( conventional bragg peak measurement ) or using a large ` pancake ' ic to measure a single pb ( a so - called integral depth dose or idd measurement ) .",
    "usually , the ` dose - to ' material will be water in this case .",
    "we began this work some years ago to address aesthetic shortcomings of the hong algorithm .",
    "protons , of all radiotherapy particles , are the most amenable to dose calculation from first principles .",
    "hard scatters are relatively rare",
    ". good theories of multiple em interactions ( stopping and scattering ) are available , and respect the small - angle approximation .",
    "range straggling is modest , so the relation between depth and energy holds up well , as does fermi - eyges theory . at our energies",
    ", protons are elementary particles with no internal states or fragmentation .",
    "proton radiotherapy is gaining in popularity , providing some motivation .",
    "the hong algorithm , good performance notwithstanding , is not a solution from first principles .",
    "it demands an effective source distance and size , even though these must follow from the scattering system .",
    "in other words , it does not solve the whole problem .",
    "the fluence in the area of interest is _ assumed _ uniform though that , too , must follow from the scattering system .",
    "collimators are modeled unrealistically .",
    "patient heterogeneities are smeared out in @xmath0 .",
    "their depth acts only via the fraction of rays intercepted . their stopping and mcs",
    "are derived from hounsfield numbers ; thus , they are basically assumed to be water - like .",
    "the sixty - four dollar question ' . ] is this : given the widespread use of the hong algorithm , its generally acceptable performance , and the thousands of person - hours expended implementing and testing it , is pba worth trying to put into practice ?",
    "it is hard to say , and it will take considerable work to find out .",
    "we offer a few comments , in no particular order .",
    "the hong algorithm is poi - centric .",
    "the dose at a particular point can be found very rapidly .",
    "that depends on choosing , in advance , pbs headed towards the general vicinity of the poi .",
    "however , as we have seen ( collimator scatter being an extreme case ) it is possible for protons to reach a poi from very different directions with very different stopping powers .",
    "therefore it is hard to see how a more rigorous algorithm can be poi - centric .",
    "however , pba has a countervailing advantage . by lowering the recursion limit",
    ", one can get a low - resolution dose image of the entire field very quickly .",
    "that may turn out to be useful .",
    "dose accumulation is an expensive step , and execution time increases with the number of pois .",
    "for instance , in sec.[sec : hong14 ] only four mps ( 808 pois ) were actually necessary , and execution time could have been far shorter . in pba",
    "the association of mps with @xmath0-planes ( slabs ) is fundamental since pbs are only ` known ' on @xmath0-planes .",
    "however the requirement that mps correspond to _ contiguous _ @xmath0-planes could easily be lifted , decoupling them from @xmath0-segmentation ( that is , transport accuracy ) .",
    "it goes without saying that pba already makes extensive use of lookup tables , packaged as functions with initialization and execution entries .",
    "for instance ,    _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ .... i = initspwrtabl(t1,pv1 ) .... _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _    sets up , for each listed material , a table of @xmath15 ( mrad@xmath115/mm ) for incident energy @xmath197 corresponding to @xmath119 .",
    "subsequently    _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ .... spwr = spwrtabl(r , k ) .... _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _    returns @xmath15 corresponding to residual range @xmath198 in material number @xmath199 .",
    "we often use linear interpolation with constant spacing .",
    "that may be inefficient memory - wise , but is very fast because finding the table position only requires one floating - point multiply .",
    "the major task still required ( after rewriting pba in a more fashionable language ) is bringing in patient information from ct .",
    "the hounsfield map must be re - sliced perpendicular to the nominal beam direction for each field .",
    "structures must be contoured , and their atomic composition defined by feeding in anatomical information .",
    "presumably that is all within the reach of modern image processing techniques .    once the atomic composition",
    ", however complicated , is known , the formula @xmath200 yields a very good approximation to the mass range @xmath201 ( g / cm@xmath115 ) at any energy @xcite .",
    "@xmath128 is the fraction by weight of the @xmath129 atomic constituent and @xmath202 its mass range at the same energy .",
    "this avoids having to compute and integrate the stopping power of the compound or mixture , and janni82 @xcite gives the range - energy relation for all atomic elements .",
    "one need only apply eq.[eqn : rasouli ] at two fiducial energies to obtain the two vers parameters .",
    "( conceivably a more direct connection between hounsfield numbers and vers parameters will be found . )    as sec.[sec : hcldata ] makes clear , speed depends critically on the sharpest dose feature that needs to be reproduced .",
    "if , instead of requiring the dose 0.6 mm from the edge , we are content with 10 mm , pba is enormously faster .",
    "immediately behind ( say ) a titanium surgical implant in the patient , the dose may have a large gradient , but this is very rapidly washed out by angular confusion , and may not be clinically important .    in closing",
    ", we note that pencil - beam scanning is of greater interest nowadays than the passively scattered examples we used ( in order to exploit existing data ) .",
    "our algorithm solves , in either mode , heretofore neglected problems such as collimator scatter and surgical implants .",
    "in addition , in scanned beams it may well be faster , more accurate , and easier to commission than algorithms in current use .",
    "it would be interesting to find out .",
    "we are indebted to harvard university , the physics department , and the laboratory for particle physics and cosmology for continuing support .",
    "the papers of nobuyuki kanematsu provided the seminal idea and many other insights .",
    "we thank david hall for the topas simulation .",
    "we thank hanne kooy for sharing the burr center commissioning data , and damien prieels , victor breev , bob brett , ethan cascio , martijn engelsman and hsiao - ming lu for helping us determine dimensions of the mgh beam spreading system as built .",
    "this is david hall s description , slightly edited , of the topas monte carlo run in connection with our first example , sec.[sec : hcldata ] .    _",
    "_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ ` the mc simulation was performed using topas version 1.3 @xcite , which is based on geant4 version 9.6.p04 @xcite .",
    "@xmath203 proton histories were simulated , originating 1 mm upstream of the lead scatterer .",
    "topas default physics settings , as validated by testa et al .",
    "@xcite were used , which correspond to a physics list containing the geant4 modules : g4em - standard_opt3 , g4h - phy_qgsp_bic_hp , g4decay , g4ion - binarycascade , g4h - elastic_hp , g4q - stopping and g4radioactivedecay .",
    "the range threshold for secondary particle production was 0.05 mm . at each measurement plane in the air following the collimator ,",
    "dose - to - silicon was scored in a set of concentric tubes centered on the beam axis .",
    "each tube had length 0.2 mm and radial width 0.4 mm .",
    "the scored dose in each tube was ascribed to a radial distance according to the following formula , which accounts for the bias towards larger radii due to the expanding volumes involved : @xmath204 where @xmath205 and @xmath206 are the inner and outer radii of the tube in question . '    ` my simulated brass is 70/30 cu / zn with density 8.550 g/@xmath207 , with mean excitation energy 324.4 ev . '",
    " your questions about which physics processes are included in which geant4 physics modules are answered in the physics reference manual .",
    "the document is huge , but i think that i have an answer now .",
    "it is as you guessed , with the molire tail being included in my ` em only ' results .",
    "in fact , in geant4 versions before 10.2 , these interactions are handled by the mcs process .",
    "after version 10.2 , they are handled by a separate single scattering process .",
    "anything involving the nuclear strong force is going to be handled by nuclear processes and is not included in my  em only ` results . '    ` i ran 200 parallel simulations of 10 m histories on rhel6 nodes .",
    "each takes around 20 hours ( topas 1.3 runs single - threaded only ) . ' _",
    "_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",
    "_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",
    "we inquire here whether the inconsistency between @xmath208 and @xmath209 could possibly result from assuming a virtual point source , rather than an extended source , when redefining a pb .",
    "put more precisely , what is the ratio between the actual fluence on axis to that from a virtual point source ? that can be found in closed form for a beam line consisting ( as ours does ) of uniform slabs .",
    "see @xcite for notation and further discussion of the formulas used below .",
    "consider an arbitrary stack of homogeneous slabs upstream of a _ defining plane _",
    "mp@xmath210 , at which we take @xmath211 . we need not specify the stack or the gaussian beam entering it other than to say that the fe moments @xmath212 , @xmath213 and @xmath214 are known , as ( therefore ) are related quantities such as @xmath61 , @xmath215 and @xmath216 .",
    "we locate mp@xmath210 at the _ upstream _ collimator face because that is where the incident pb is redefined .",
    "now let us compute the on - axis fluence @xmath171 at a second mp at @xmath217 .",
    "the 1d fluence per proton is found by integrating @xmath218 over @xmath219 with the result @xmath220 multiplying this by a similar expression for the orthogonal coordinate @xmath47 , assuming the @xmath221 to be equal for @xmath46 and @xmath47 , and setting @xmath222 we find the on - axis 2d fluence ( 1/cm@xmath115 ) per proton @xmath223 using the usual transport relation for @xmath86 and ignoring scattering in air downstream of mp@xmath210 @xmath224 the same formula , if @xmath225 , gives the fluence from a virtual point source a distance @xmath61 upstream of mp@xmath210 @xmath226 taking the ratio and simplifying we have finally @xmath227 where all quantities on the rhs except @xmath0 itself are evaluated at mp@xmath210 .",
    "the ratio correctly equals 1 for @xmath0 very large or in the trivial case where the emittance at the defining plane is 0 .",
    "its deviation from 1 is plotted in fig.[fig : fluencecorr ] using the parameters of sec.[sec : hcldata ] .",
    "the maximum effect is only @xmath228 and is the same at mp1 and mp6 , so it can not account for the inconsistency in dose at those locations .",
    "n. kanematsu , m. komori , s. yonai and a. ishizaki ,  ` dynamic splitting of gaussian pencil beams in heterogeneity - correction algorithms for radiotherapy with heavy charged particles , ' phys .",
    "* 54 * ( 2009 ) 2015 2027 .",
    "berger , m. inokuti , h.h .",
    "andersen , h. bichsel , d. powers , s.m .",
    "seltzer , d. thwaites , d.e .",
    "watt , h. paul and r.m .",
    "sternheimer , ` stopping powers and ranges for protons and alpha particles , ' icru report 49 ( 1993 ) .",
    "b. gottschalk , a.m. koehler , r.j .",
    "schneider , j.m .",
    "sisterson and m.s .",
    "wagner , ` multiple coulomb scattering of 160 mev protons , ' nucl .",
    "b74 * ( 1993 ) 467 - 490 .",
    "we have discovered the following errors : eq.(2 ) should read @xmath229 and in table 1 the heading @xmath123 should read @xmath230 and @xmath231 under @xmath232 should read @xmath233 .",
    "bernard gottschalk , ethan w. cascio , juliane daartz and miles s. wagner , ` on the nuclear halo of a proton pencil beam stopping in water , ' arxiv:1412.0045v2 ( 2015 ) and phys .",
    "( 2015 ) 5627 - 5654 .",
    "e. pedroni , s. scheib , t. bhringer , a. coray , m. grossmann , s. lin and a. lomax , ` experimental characterization and physical modeling of the dose distribution of scanned proton pencil beams , ' phys .",
    "med . biol .",
    "* 50 * ( 2005 ) 541 - 561 .",
    "linda hong , michael goitein , marta bucciolini , robert comiskey , bernard gottschalk , skip rosenthal , chris serago and marcia urie , ` a pencil beam algorithm for proton dose calculations , ' phys",
    "biol . * 41 * ( 1996 ) 1305 - 1330",
    ".              lynn j. verhey , andreas m. koehler , joseph c. mcdonald , michael goitein , i - chang ma , robert j. schneider and miles wagner , ` the determination of absorbed dose in a proton beam for purposes of charged - particle radiation therapy , ' radiation research * 79 * ( 1979 ) 34 - 54 .",
    "b. gottschalk : lectures ( bgtalks.zip ) and a draft textbook ( pbs.pdf in bgdocs.zip ) , free download at http://users.physics.harvard.edu/gottschalk  or the particle therapy co - operative group ( ptcog ) website http://ptcog.web.psi.ch/.        nobuyuki kanematsu , takashi akagi , yasuyuki takatani , shunsuke yonai , hidenobu sakamoto and haruo yamashita , ` extended collimator model for pencil - beam dose calculation in proton radiotherapy , ' phys",
    "* 51 * ( 2006 ) 4807 - 4817 .",
    "m. testa , j. schumann , h .-",
    "lu , j. shin , b. faddegon , j. perl , and h. paganetti ,  experimental validation of the topas monte carlo system for passive scattering proton therapy,med .",
    "phys . * 40 * , ( 2013 ) 121719 .       of the charge carried by that",
    "pb . from left",
    ": ur - beam ; regular array of pbs from redefinition at collimator face ; daughters of dynamically split pbs . for visual effect , many tracks are suppressed.,width=448,height=336 ]          h(p , p)p , @xmath21o(p,2p)@xmath234n , @xmath21o(p , pn)@xmath234o and @xmath21o(p , p)@xmath21o .",
    "recoil nuclei ranges are exaggerated .",
    "the dashed lines are 10% and 0.01% isodoses drawn to scale.,width=475,height=336 ]                 axis , of the original beam is compared with the sum of 751 pbs ( produced by recursive splitting ) transported through 0.1 mm of air .",
    "a comparison along the @xmath47 axis is similar.,width=448,height=336 ]     axis , of the original beam is compared with the sum of 1219 pbs ( produced by recursive splitting ) transported through 50 , 100 and 150 mm ( near stopping thickness ) of water .",
    "a comparison along the @xmath47 axis is similar.,width=435,height=336 ]     ( dashed lines ) .",
    "materials in order of increasing line weight are be , water , al , cu , pb . parameters in this example are computed from exact fits at 32 and 160mev .",
    "the mixed range - energy table corresponds to icru49 @xcite except for water which uses janni82 @xcite.,width=432,height=336 ]     from @xmath236 , according to various formulas , at @xmath237mev ( experimental points from @xcite ) .",
    "each @xmath219 is the integral of the corresponding @xmath131 except @xmath238 which is from the generalized highland formula.,width=435,height=336 ]      ....           do jterr = np1,np2",
    "!   states of terrain c         call initwhatshere(inpfile,'terrain:',jterr , wgt , jzhist , jzred )         call initurbeams(nrows , pvex , scanhw , zsource , urp , sigt , thtc , sigx ) c             do jurb = 1,nurb   !",
    "ur - beams         call pushurbeam(jurb )         rangeout = .false .         if ( wantdose(rangeout ) ) call addtodose(iddoseto , jterr , bpf ) c               do               !   stack         call whatshere(xbu(k2),ybu(k2),jzbu(k2),kml , dzz , rho , scl , dsqnh ) c                 if ( red(1 ) ) then          call redefine(showred(1),redp(1,1),ml(jzred(1)),stopnc )                 else if ( red(2 ) ) then         call redefine(showred(2),redp(1,2),ml(jzred(2)),stopnc )                 else if ( wantsplit(dsqnh , jzred ) ) then         call split(snum )                 else         call transport(kty(jzbu(k2)),kml , dzz , dsqnh , rho , rangeout , reachend )         if ( wantdose(rangeout ) ) call addtodose(iddoseto , jterr , bpf )                   if ( reachend.or.rangeout ) then         k2 = k2 - 1                   end if                 end if   !   redefine , split or transport c         if ( k2.le.0 ) exit c               end do           !   stack c             end do             !   ur - beams c           end do",
    "!   states of terrain ....       below , but dose accumulated only for pristine protons ( @xmath163mev ) . a single normalization constant for all pba results",
    "is calculated to fit the first few points @xmath162 in mp1 , @xmath239mm.,width=448,height=336 ]     with dose accumulated only for degraded protons , @xmath164mev .",
    "solid lines : dose along @xmath46 axis ; dashed lines , dose along @xmath47 axis .",
    "vertical line : geometric edge of collimator .",
    "points : simulation with a home - made monte carlo program gmc , 100 m events .",
    "all doses are absolute ( no normalization).,width=435,height=336 ]         except @xmath72 ( eq.[eqn : splittrigger ] ) was increased from 10 to 18 .",
    "the calculation took 93min .",
    "71 m pbs were generated of which 40 m traversed mp1 - 6 .",
    "agreement at mp1 - 2 is significantly better than fig.[fig : hclx0258 ] but other mps are the same or worse.,width=448,height=336 ]    .",
    "the vertical scale is logarithmic by decades ; the lowest horizontal line is at @xmath240 . from top left :",
    "@xmath4 ( mev ) , @xmath4 ( coarser bins ) , @xmath17 ( mm ) , generation index @xmath1 , index @xmath133 of plane where split took place , @xmath62 ( mrad )",
    ". the full range of each variable is indicated .",
    "note non - physical spikes , particularly obvious in the @xmath4 plots.,width=448,height=336 ]    mm half - beam block in a 218mev double - scattered beam .",
    "the line is the pba calculation .",
    "the measurement ( squares ) is normalized and shifted but the @xmath46 scale , 1mm / point , is absolute .",
    "the l and r @xmath181 penumbras are 5.11 , 4.65 mm ( pba ) and 5.26 , 4.86 mm ( measured).,width=435,height=336 ]      run parameters : mixed   .01    1    0          range - energy ; ztol , dpcprint , ireseed 218   42   218                incident mev ; mev range for overas fit dose        0    999   .8      fluence / dose ; dose pv range ; bp toe level air         0    1.1   .5      s_em dosetomatl , % /(g / cm2 ) , % strag / r , % span 1000   3    0   1.15           s_em nz , ns , za , zb / range n    5    1    1               s_em show , r / sig , zstep ( mm ) , cut / r ( % ) 2.0   1.0    0     2    2       split if d < p1*sx & xbb > p2dbp3 & igbu < iglim(1,2 ) vir   .55   1.15              split source vir , esp , eff ; split sigx ; spread n   .5    1.15   0.00    3      redef1 show , sigx , spc , margin ( mm ) ; ruse / sigma n   .5    1.15   2.00    3      redef2 ditto nb .5 < = spc",
    "< = 1.15 mm 1     15   -9999              urbeam nrows , scanhw ( mm ) , zsource ( mm ) 0    0     0     0             urbeam x0,y0,xp0,yp0 ( mm , mrad ) 0    0     0                  urbeam sigt , thtc , sigx ( mr , mr , signed mm ) 1   -40   80   101             dose # mps , scan range , # pts 0   0   0   20   0   90          dose ( x0,y0,phi)_1 , ( ditto)_2   ( mm , mm , degr ) 50   .05   .95                contours # , low , high level ( relative ) 0    0                       z1,z2 ( mm ) for terrain picture terrain : mtl or file , # slabs , thickness ( mm ) - - - - - - - - - - - - - - - lead          1        .875   ( .9931/11.35 = .875 ) air           1      18.747",
    "( 19.52 - .773 ) carbld        1        .773   rm7 step1 lead          1       4.254   ditto air           3     871.582   ( 917 - 4.254 ) redef1 ss2.con      48      56 .",
    "air           5    1412.164 redef2 hbb40.rec     3      60 .",
    "air           1     200 .",
    "downstr coll to isocenter histograms end          999     999      = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = - - - - - - - - - - - - - -   histogram requests   - - - - - - - - - - - - - 10   5   50000   50   3/   ndown , nacr , maxbuf , max # requests , max # cuts ' xco '    2    1 -100 200 1 1 1/ ' igbu '   7    1 -.5   20   1/ ' yco '    3    2 -200 200 1 1 3/ ' igbu '   7    1 -.5   20   1/ ' pv '     6    2   0   200   1   1 5   340   200/ ' pv '     6    8   0    50   1   2 5   340   200/ ' xbb '   10    1   0   100   1   3 5/ ' igbu '   7    1 -.5   20   1   4 5/ ' jzsp '   8    1   50   50   1   5 5/ ' ybb '   11    2   0   100   1   6 5/   ' end'/"
  ],
  "abstract_text": [
    "<S> we describe a new pencil beam ( pb ) algorithm that computes , from first principles , absolute fluence or dose per incident proton charge in a known heterogeneous terrain irradiated by known proton beams . </S>",
    "<S> pb transport is by standard fermi - eyges theory . </S>",
    "<S> heterogeneites are handled by breaking up pbs using redefinition and recursive dynamic splitting .    </S>",
    "<S> the terrain is discretized into uniform or heterogeneous slabs by @xmath0-planes perpendicular to the nominal beam direction . in each slab , </S>",
    "<S> heterogeneity boundaries ( if any ) are either simple geometric shapes or , more generally , polygons . </S>",
    "<S> all objects in the terrain , including collimators , are represented in that fashion . </S>",
    "<S> there are no special ` beam limiting devices ' .    </S>",
    "<S> the charge carried by a pb is represented by an integer @xmath1 ( how many generations the pb is removed from the parent ) and a continuous variable @xmath2 , such that total charge @xmath3nc . </S>",
    "<S> the longitudinal variable , rather than kinetic energy or residual range in water , is @xmath4 ( proton momentum times speed ) . </S>",
    "<S> other pb parameters are conventional : central axis position and direction and three fermi - eyges moments representing pb size , divergence and emittance . </S>",
    "<S> ( non cylindrical incident beams would require three more . )    </S>",
    "<S> pb parameters are defined only on @xmath0-planes . </S>",
    "<S> the actual ` ur - beams ' irradiating the terrain , and the virtual pbs generated during execution , are parameterized and processed identically .    </S>",
    "<S> each material in the terrain is treated on its own merits . </S>",
    "<S> there is no reference material ( e.g. water ) and concepts such as ` radiological path length ' are not used . </S>",
    "<S> the vers approximation @xmath5 , fitted to standard range - energy tables , is used to compute the diminution of @xmath4 , and an accurate scattering power @xmath6 represents multiple coulomb scattering . </S>",
    "<S> thus , non water - like materials ( e.g. beam line components , surgical implants ) are handled accurately .    </S>",
    "<S> the basic program , a pb stack processor , nested in a loop over ur - beams , nested in a loop over states of the terrain , is equally suited to scattered beams or pencil beam scanning . in a scattered beam , the terrain is more complicated and has more states ( e.g. modulator steps ) and there are far fewer ur - beams ( typically one per state ) . in pencil beam scanning , </S>",
    "<S> the reverse is true .    </S>",
    "<S> the pb stack processor examines a pb at a @xmath0-plane . depending on various factors ( e.g. proximity to a heterogeneity ) </S>",
    "<S> the pb may be redefined ( replaced on the stack by a horde of new , smaller pbs ) or split ( replaced by seven new pbs ) or transported to the next @xmath0-plane ( pb parameters replaced by new values ) . </S>",
    "<S> after transport , if the new @xmath0-plane is a designated measuring plane ( mp ) , the dose from the current pb at each point of interest is added in , and the loop repeats . when a pb ranges out or reaches the last @xmath0-plane in the problem , it is deleted and the next pb is examined at the first @xmath0-plane . when the last pb is deleted , control passes out and the next ur - beam is placed on the stack . after the last ur - beam is processed , control passes to the next state of the terrain .    </S>",
    "<S> pb redefinition is more or less conventional : a pb is replaced by many smaller pbs arranged in a hexagonal array in such a way that the phase space parameters and charge of the mother pb are conserved . pb splitting , by contrast , replaces the mother by a central daughter carrying one quarter of the charge and traveling in the same direction , and six daughters arranged in hexagonal array , radiating from the virtual point source of the mother , each with one eighth of the charge , the whole conserving emittance .    in common with other pb algorithms </S>",
    "<S> we ignore secondaries from hard scatters , covering only those protons ( typically 80% ) that stop by multiple em interactions with atomic electrons . </S>",
    "<S> two extremes are covered , however , in choosing the effective mass stopping power used in converting fluence to dose . </S>",
    "<S> if the contribution of secondaries in a particular problem is thought to be negligible , an electromagnetic mass stopping power @xmath7 in the ` dose - to ' material may be computed from first principles . </S>",
    "<S> if , by contrast , the region of interest is within a broad beam where transverse equilibrium ( including secondaries ) prevails , a mixed mass stopping power @xmath8 may be derived from an experimental broad - beam bragg peak or an integral depth - dose ( idd ) measurement . in that case the ` dose - to ' material will probably be water .    </S>",
    "<S> after describing the algorithm , with intermediate tests , in great detail , we present three examples . the first two involve collimator scatter , solved for the first time ( excepting monte carlo ) by this work , and a stringent test of the algorithm . the third compares this work with the widely used hong algorithm . </S>",
    "<S> we conclude by discussing how the present work might be put into practice .    </S>",
    "<S> = 1    * for andy koehler ( 19302015 ) , friend and mentor . </S>"
  ]
}