{
  "article_text": [
    "the ideal spectral extraction algorithm for point - like sources yields the maximum signal - to - noise ratio ( s / n ) while at the same time preserving the spectrophotometric fidelity .",
    "the standard extraction method is based on co - adding the flux in the cross - dispersion direction within a window large enough to contain ( most of ) the source flux .",
    "this method is known as  tapered - column \" in the  spectroscopy modeling analysis and reduction tool \" ( ` smart ` , higdon et al .",
    "2004 ) and is equivalent to the  regular extraction \" of the _ spitzer _ irs custom extractor ( ` spice ` ) , provided by the _ spitzer science center _",
    "( _ ssc _ ) .",
    "although this generally produces satisfactory results , the inclusion of noisy pixels which do not contain a significant fraction of the flux inevitably tends to degrade the quality of the extracted spectrum .",
    "this is because every pixel in the extraction window is given the same weight .",
    "moreover , the extraction window is part of a pseudo - rectangle which is defined as a zone in the detector array where the wavelength is uniform ( figure[fig : pseudo ] ) . when a quadrilateral boundary crosses a pixel , the signal is assumed to be evenly distributed within that pixel , which can lead to artificial flux variations in the extracted spectrum . because of the interplay of the angled spectral trace and the widening extraction aperture , this error oscillates with wavelength with an amplitude which decreases toward longer wavelengths .",
    "knowledge of the point spread function ( psf ) of the instrument can solve these problems , as it enables the so - called optimal extraction technique which weights the extracted data by the s / n of each pixel ( horne 1986 ) .",
    "optimal extraction therefore significantly reduces the statistical noise in the final spectrum compared to more typical extraction algorithms , which weight all the data within the window equally .",
    "so far , efforts on optimal extraction for the _ irs _ have made use of template psfs or analytical psfs to fit the cross - dispersion profile of the data :    * virtually any spectrophotometric standard star can be used to derive a template psf , which then allows an empirical estimate of the psf at the reference positions ( referred to as  _ nod _ \" positions ) .",
    "this method is currently used by the software ` spice ` ( see narron et al .  2007 ) .",
    "the resulting extraction undeniably provides better s / n as compared to a tapered column extraction , although the corresponding algorithm is sensitive to cross - dispersion offsets between a source position and the nod position .",
    "a simple shift of the psf is not sufficient to acquire the best s / n possible , and in some cases , low - frequency oscillations can appear in the spectrum due to the misalignment .",
    "the reasons are inherent to the data used to compute the psf template since the latter is created in a specific observational mode ( default positions along the slit , default data sampling ) .",
    "* analytical psfs allow estimating the instrumental profile for any position along the slits .",
    "the independent effort from the  core to disks \" legacy program ( evans et al .",
    "2003 ) uses such psfs along with an extended emission background which is determined on - the - fly ( see lahuis et al .  2007 ) .",
    "analytical psfs can bear some uncertainties due to the lack of knowledge of the exact instrumental profile .",
    "we have developed a new optimal extraction algorithm to be used with either of the low - resolution modules of the _ infrared spectrograph _",
    "( _ irs _ , houck et al .",
    "2004 ) onboard the _ spitzer space telescope _",
    "( werner et al .  2004 ) .",
    "the new extraction algorithm is available _ via _ the plugin ` adopt ` , part of the new release of ` smart ` . in a nutshell , an empirical super - sampled psf has been constructed for each row of the detector array and a multi - linear regression algorithm is used to weight the pixels and derive the flux from the source .",
    "the optimal extraction is based on detector rows rather than pseudo - rectangles to treat each pixel as indivisible and thus avoid uncertainties due to the lack of knowledge on the pixel response function .",
    "the algorithm presented in this paper produces a considerably higher s / n , up to a factor of @xmath0 for faint sources , than the current extraction method available in ` smart ` for point - like sources (  tapered column \" ) .",
    "an additional advantage of using a super - sampled psf is that it remains valid anywhere along the aperture in the cross - dispersion direction .",
    "we found that the optimal extraction method is extremely sensitive to offsets between a source position and the nominal position .",
    "for this reason a new algorithm to locate the source in the slit has been implemented , with a precision of better than a twentieth of a pixel .",
    "it is also now possible to extract spectra of spatially blended sources , which is crucial when dealing with crowded regions , such as stellar clusters or nearby galaxies . such as what can be achieved using iterative techniques ( lucy & walsh 2003 ) , the cross - dispersion profile of the data is decomposed into its components , including the spatial profiles of any number of sources in the slit and the extended background emission",
    "finally , it is also possible to extract sources with significant offset in the dispersion direction by calculating a modified psf on - the - fly .    in the following section the basic steps to construct the psf are given .",
    "section[sec : method ] details the mathematical description of the method and its application for extracting multiple sources are detailed .",
    "section[sec : applications ] briefly explains some specific applications .",
    "[ cols=\"^,^,^,^,^\",options=\"header \" , ]     we have constructed super - sampled psfs for the two low - resolution modules ( short - low , sl and long - low , ll , see table[tab : modules ] ) of the irs on _ spitzer_. the optimal extraction for the high - resolution modules will be considered in the future since these modules do not allow the full sampling of the psf profile .    in order to build the super - sampled psf , we considered observations of calibration stars scanned around reference positions in the cross - dispersion direction .",
    "we used the basic - calibrated data ( bcd ) product .",
    "after cleaning the bad pixels using _ _ irsclean _ _",
    ", individual exposures ( dces ) were combined , after verifying that the pointing remained stable .",
    "the source in each image was then found _ via _ the source finder algorithm ( sect.[sec : sf ] ) which makes use of previous iterations of the psf profile .",
    "finally , the positions of the source along the slit were used as inputs in an iterative reconstruction of the high - resolution spatial profile from the under - sampled data .",
    "we used a simplified version of the regularized image reconstruction explained in detail by pinheiro da silva et al .",
    "in short , considering a series of @xmath1-undersampled spectra @xmath2 and the desired high - resolution profile @xmath3 , the observed spectra take the form : @xmath4 where @xmath5 is the downsampling matrix , @xmath6 is the geometric transformation matrix , i.e. , in our case the relative shift with respect to a reference position , and @xmath7 represents the noise .",
    "@xmath6 is easily calculated from the source positions , while @xmath5 is the matrix corresponding to a simple re - scale with no interpolation .",
    "we used the same algorithm described by pinheiro da silva et al .",
    "( 2006 ) , with the following iterative step : @xmath8 where @xmath9 controls the convergence speed , @xmath10 controls the regularization , and @xmath11 is a reference spectrum , which can be either the theoretical psf , or an initial guess based on a simple co - addition of the aligned data images .     +    in practice , we calculated the sl psf on a reference grid with 10 sub - pixels per pixel per actual pixel , while the ll grid contains five sub - pixels .",
    "the number of sub - pixels was chosen to maximize the signal in each sub - pixel while allowing the best resolution possible on the psf profile .",
    "the shape of the psf is the same within the uncertainties for the two nod positions .",
    "table  [ tab : nods ] gives the coordinates for the _ nod _ positions and the equations defining the spectral trace in each module .",
    "the spectral trace quantifies how the position of the centroid of the psf shifts with wavelength ( i.e. , up and down the array ) .",
    "its shape differs slightly in the two nod positions because the nod positions are at different distances from the center of the focal plane .",
    "the extraction algorithm interpolates or extrapolates the trace polynomial coefficients depending on the source position .",
    "figure[fig : psfimage ] presents the psf for each module .",
    "our reconstruction of the psf is good enough to reveal multiple airy rings .",
    "figure[fig : psfcut ] displays cuts along various wavelength rows .",
    "c c c sl1 nod 1 & 9.26 & @xmath12 + sl1 nod 2 & 19.85 & @xmath12 + sl2 nod 1 & 55.53 & @xmath13 + sl2 nod 2 & 65.52 & @xmath13 + sl3 nod 1 & 52.34 & @xmath14 + sl3 nod 2 & 62.46 & @xmath14 + ll1 nod 1 & 36.29 & @xmath15 + ll1 nod 2 & 47.00 & @xmath16 + ll2 nod 1 & 74.02 & @xmath17 + ll2 nod 2 & 85.00 & @xmath18 + ll3 nod 1 & 74.09 & @xmath17 + ll3 nod 2 & 85.20 & @xmath18 +",
    "when performing the spectral extraction , the algorithm considers each row independently .",
    "the wavelength actually varies along a given row so that a different location in the spatial direction corresponds to a slightly different wavelength . in theory",
    "the use of pseudo - rectangles is adequate to consider windows with uniform wavelength but the practical implementation is limited by the lack of precise knowledge of the response function within a pixel ( see introduction ) .",
    "furthermore , a slight loss of spectral resolution occurs due to the artificial splitting of information in individual pixels between wavelength elements .",
    "regardless of these side - effects , considering rows instead of pseudo - rectangles provides a valuable means to better sample the resulting spectrum by using the exact wavelength at the nod positions .",
    "figure[fig : ngc6240 ] shows an example of a spectrum resulting from the combination of two nod spectra in which the wavelength is determined directly at the source location in the cross - dispersion direction .",
    "the slight wavelength shift between the two nod positions provides a better spectral sampling at the expense of a lower s / n ratio because the nod spectra are not combined in the same wavelength scale .",
    "narrow spectral lines benefit greatly from the full sampling as their profiles are better determined , implying a better detection level , and a more accurate line flux measurement .",
    "it is necessary that the two nod spectra align fairly well for them to be combined .",
    "for this reason , we implemented an automatic algorithm which , provided two nod spectra , fits the error function ( difference between the spectra ) with a @xmath19-spline .",
    "the interpolated difference is then split evenly to the individual spectra which can then be combined .",
    "this algorithm preserves the spectral resolution .",
    "practically , the ` smart ` software can regrid _ a posteriori _ the data on the reference wavelength grid or keep instead the wavelength determination at the source position ( see online documentation ) .      before the psf can be used to perform the optimal extraction",
    ", it has to be downsampled and shifted to the source position .",
    "this important process consists of three steps : ( 1 ) the data grid ( sub - array of the original 128-pixel row where the spectral order is the one requested ) is stretched to match the ( super - sampled ) psf grid and is shifted to align the psf and the source .",
    "( 2 ) the psf is interpolated in the new grid . ( 3 ) the psf flux of a given pixel in the data grid is determined by integrating the flux of the subpixels .    to find the flux from the source in each row , we use a multiple linear regression algorithm . the scaling factor",
    "@xmath20 gives the flux for a given row , and is thus constant along the row .",
    "each pixel can thus be used to determine @xmath20 independently : @xmath21,\\ ] ] where @xmath22 is the column element of the slit spatial profile , @xmath23 is the source profile , and @xmath3 is the psf profile .",
    "the scaling factor @xmath20 provides the source flux in e@xmath24/sec , which eventually leads to the source flux density in jy after calibration . the flux calibration performed by ` adopt ` uses the calibration files ` b{0 2}\\_aploss\\_fluxcon.tbl ` provided by the _ ssc_.",
    "these files provide a calibration which does not include extraction aperture - loss light corrections due to the size of the regular extraction window .",
    "it is thus well suited for the purpose of optimal extraction which does not involve a regular aperture .",
    "an additional relative spectral response function ( rsrf ) is used to correct for the small ( @xmath2510% ) residual flux offsets .",
    "the rsrf used in ` smart ` is calculated by performing optimal extraction on the calibrator star hr7341 which is then compared to its stellar theoretical template provided by the _ _ ssc _ _ ( see also decin et al .  2004 ) .",
    "the flux calibration may be subject to slight modifications in the future as new versions of calibration files will be provided by the _",
    "ssc_.        the use of optimal extraction increases the overall quality of the spectra , with the most significant improvements for observations with low s / n .",
    "quantitatively , the s / n ratio increases by a factor @xmath26 for sources as faint as 1mjy compared to normal tapered column extraction . in addition , while tapered column extraction is sensitive to bad pixels , optimal extraction is mostly unaffected , except when the bad pixels are precisely located at the peak of the spatial flux distribution .",
    "one of the most interesting applications enabled by the knowledge of the super - sampled psf is the possibility of extracting spatially - blended sources . in the case of multiple sources ,",
    "the estimated spatial profile is given by @xmath27 where @xmath28 is the number of sources , @xmath29 is the fit parameter , and @xmath30 is the psf aligned with the @xmath1-th spectrum . as explained by collins , gull , bowers & lindler ( 2002 ) and bevington & robinson ( 1992 ) , the coefficients @xmath29 can be found by solving the multiple linear regression using the least - square method : @xmath31 where @xmath23 is the vector @xmath32 and @xmath3 is the matrix @xmath33 .",
    "the system is characterized by @xmath34 equations ( number of columns where the order is as requested ) for @xmath28 unknowns .",
    "the system thus remains overdetermined for a large number of sources .",
    "we find that it is possible to extract spectra of sources separated by two pixels or more along the spatial axis .",
    "sources separated by one pixel can be extracted , with recognizable spectral features , but the measurement of the features ( integrated flux , equivalent width ) should be regarded with caution . as a result of the minimum separation between two source and of the system overdetermination ,",
    "the algorithm can extract a number of sources which is less than half the number of pixels in the row ( minus the number of degrees of freedom for the background , see sect.[sec : bg ] ) .",
    "thus , theoretically the maximum number of sources that can be extracted is @xmath35 for sl to @xmath36 for ll .",
    "figure[fig : ms1 ] gives an example of a real - case scenario in the small magellanic cloud , while figure[fig : ms2 ] represents an artificial case for which the recovered spectra are similar to the original spectra used to construct the artificial test image .",
    "there are generally two main scenarios adapted to source deblending .",
    "* sources can be known _ a priori _ in which case their position on the sky can be used to extract their spectra .",
    "sources can be also identified in the detector image when spatial structure is evident .",
    "note however that the multi - source extraction is originally meant only for point - like sources .",
    "* sources can be discovered with the help of the source finder ( residual minimization , see sect.[sec : sf ] ) .    because the multi - source extraction is an interesting tool for analysis of crowded regions , the ` adopt ` software allows the user to display the slit projected on the sky along with the field of view position and the requested coordinates . `",
    "simbad ` and ` ned ` sources in the field can also be displayed for easy source identification .",
    "finally , any fits image can be overplotted , including automatic queries from the sdss , 2mass , spitzer / irac , and spitzer / mips catalogs .",
    "no calibration currently exists for offsets in the dispersion direction .",
    "such offsets can result in significant light loss in the sl module when sources are more than @xmath37 from the slit center ( see _ irs _ reports by sloan 2004 ; sloan , nerenberg & russell 2003 ; nerenberg & sloan 2003 ) .",
    "this effect is known as the spectral - pointing induced throughput error ( spite ) . since the ll aperture is much wider than the sl one ( table [ tab : modules ] ) , the effect is unimportant for ll except for significant offsets .",
    "accounting for offsets in the dispersion direction keeps the optimal extraction valid for sources located anywhere in the aperture .",
    "it provides a reliable flux calibration which is useful in the case of a mispointing , and it is also adapted to the case of multiple sources as it is likely that at least one source is not near the slit center . while a regular tapered extraction would require only the knowledge of the flux fraction that is lost outside the slit ( provided by the ` b{0 2}\\_slitloss\\_convert.tbl ` tables from the _ ssc _ ) , optimal extraction requires the knowledge of the psf profile at the exact source position .",
    "available data could not be used to derive the psf profile at various positions in the dispersion direction .",
    "we used instead a theoretical psf and calculated the function transforming the  nominal psf \" ( i.e. , integrated psf across the slit for a source at the slit center ) to the effective psf ( source anywhere across the slit ) .",
    "the function is then applied to the empirical super - sampled psf derived ( sect[sec : psf ] ) . finally , the effective psf is normalized to the total area of the nominal psf so that the scaling factor provides the correct flux value without any further calibration required other than the one already applied .",
    "with the throughput error corrected , it becomes possible to extract sources anywhere in the slit with a reliable flux calibration . ` smart ` allows the user to extract sources at specific celestial coordinates , but can also find the source in the dispersion direction .",
    "this is possible because as the source moves away from the slit center , the effective psf becomes wider so that the quality of the fit varies .",
    "figure[fig : hr6348 ] shows an example on an actual mispointing of @xmath381.6@xmath39 in the dispersion direction of the calibration star hr6348 .",
    "the offset is about half the sl aperture height , providing an adequate illustration of the algorithm explained above . by using an on - the - fly psf",
    ", the flux level agrees with the true spectrum while providing smaller residuals ( by 20% ) .",
    "there are usually several ways to remove the background .",
    "the background contribution can be inferred by interpolating the columns on each side of the source , which requires good knowledge of the source position .",
    "another way to remove the sky relies on the subtraction of dedicated background observations or differencing the image by _ nod _ or by order ( e.g. sl nod 1 minus sl nod 2 , or sl1 nod 1 minus sl2 nod 1 ) .",
    "the disadvantage of these methods is that they assume that the background at the position where it is measured is the same to where the source is located .",
    "the new algorithm can calculate the underlying extended emission together with the psf scaling factor ( see also geers et al .",
    "2006 , lahuis 2007 ) .",
    "therefore , even the pixels where the source emits are taken into account for constraining the background shape and level .",
    "the ` adopt ` algorithm assumes that every column in a given spatial row should follow the same background equation .",
    "any background shape can be considered which is a function of the column index @xmath22 , i.e. , with @xmath40 with the coefficients @xmath41 being the unknowns and @xmath42 represents any function that describes the background .",
    "we thus have again @xmath34 linear equations : @xmath43 the system is solved using the multi - linear regression algorithm , which estimates simultaneously the unknowns @xmath29 and @xmath41 . for practical reasons , the algorithm ` adopt ` makes use of a polynomial background , i.e. , @xmath44 .",
    "the system remains overdetermined if the sum of the number of sources and the background parameters does not exceed @xmath35 for sl to @xmath36 for ll .",
    "an example of an optimal extraction of a source within a complex background is shown in fig.[fig : bg ] .",
    "the particularity of this method is that the background profile is estimated for each row independently , which can lead to undesirable small - scale variations along the wavelength axis .",
    "hence for noisy images , it is advised to perform a first extraction to estimate the row - by - row background and then smooth the reconstructed background image along the wavelength axis ( see online documentation ) .",
    "the plug - in ` adopt ` includes a new source - finding algorithm .",
    "several source finders already exist , using for instance the centroid in the collapsed spatial profile ( along the psf trace ) , or the median of the centroids in each row .",
    "these methods require fitting a profile , usually using a gaussian curve , which inevitably introduces possible systematic errors and even biases .",
    "these biases can introduce negative effects in the data , such as noticeable bumps in the spectrum ( which are more abrupt the larger the discrepancy between the source finder and the source actual position ) ( see example in figure[fig : bump ] ) .",
    "the dip at short wavelengths observed is typical of the artifacts introduced by slight uncertainties in the source position coupled with a normally sampled psf .",
    "_ bottom _ @xmath45 the artifact could be exactly reproduced by using the super - sampled psf of ` smart ` and a forced shift of 0.1 pixel . ]",
    "the new source finder uses the super - sampled psf .",
    "the psf is aligned at varying positions along the slit . for each position , the residual image ( data image minus the psf image ) is then analyzed .",
    "first , the residual image is rectified using the trace equations of table[tab : nods ] .",
    "then , a @xmath19-spline is fitted to each column , with rejection parameters such that bad pixels are identified and ignored .",
    "the median value of the fit is then calculated for each column , which results in a representative spatial row .",
    "this row is ideally zero when there is no background and when the psf has been aligned to the source .",
    "hence , by simply taking the average of this row , one has a very good leverage on the quality of the alignment psf - source .",
    "the precision reached by the source finder is better than @xmath46 of a pixel .",
    "besides the improved s / n and the multi - source extraction , the precise knowledge of the psf profile enables several valuable possibilities for the handling of point - like sources while providing interesting tools for handling extended sources .      with the knowledge of the super - sampled psf , the spatial extent of a given source can be determined fairly accurately by comparing its spatial profile to the psf for the same wavelength or wavelength range .",
    "the plugin ` adopt ` allows the user to check the extent of any source within the slit , by providing three meaningful quantities : the percentage of the extent with respect to the psf , the extent in pixels , and the extent in arcseconds . among the most useful applications to check the source extent is to identify the possible presence of another source or the presence of extended emission associated with the point - like source ( see [ sec : pls_ext ] ) .",
    "the complex case of point - like sources embedded within an extended emission can be approached in various ways depending on the background nature .    * _ large - scale background with spectral features_. a low - grade polynomial background can be estimated in every wavelength row ( sect.[sec : bg ] ) .",
    "the image quality should however be better than some threshold .",
    "* _ large - scale background with no spectral features_. the same procedure as above is applied , but the final background image is calculated by smoothing the  row - by - row \" background . * _ small - scale background ( e.g. , disk , extended region , ... ) _ .",
    "a polynomial of high degree should be used , implying that less constraints will be possible .",
    "in fact , a polynomial might not suffice to adequatly represent the background , but it will still allow a first order approximation ( see next section ) .      in the case of a point - like source embedded in an extended source , it is possible to extract the spectrum of the extended source alone by extracting first the point - like source ( no background subtraction in this case ) .",
    "the reconstructed image ( which in the case of images with normal point sources contains the residuals ) includes only the extended source .",
    "note that the spectrum of the point - like source includes a fraction of the extended emission and should be regarded with caution , especially for flux calibration and spectral features measurements . the extended emission in the reconstructed image",
    "can then be extracted using either a full slit or a tapered column .",
    "it is important to bear in mind that there is no flux calibration available for the extended emission , except if the source fills uniformly the aperture .",
    "we have presented the optimal extraction algorithm adapted to the _ infrared spectrograph _ onboard _",
    "spitzer_. besides providing a significant increase in the signal - to - noise ratio as compared to the regular  tapered \" extraction , the new algorithm allows extraction of multiple sources at any location within the aperture .",
    "the optimal extraction is also implemented for sources shifted in the dispersion direction .",
    "finally , it is possible to perform an optimal extraction with a complex extended background emission .",
    "the ` adopt ` plugin is released with the ` smart ` package ( versions equal or later than 8.0 ) .",
    "the code is available at the infrared science center website , along with extensive documentation . `",
    "smart ` and the optimal extraction will be maintained in the future , with a possible inclusion of the optimal extraction for the high - resolution modules .",
    "we thank especially n.  chitrakar , d.  g.  whelan , d.  levitan , and m.  devost for previous iterations of the optimal extraction code on which the present one is partly based .",
    "we also thank c.  tayrien and the disk team at rochester for discussions on the spectral traces .",
    "finally , we are grateful to d.  devost and j.  r.  houck who initiated the idea of developing an optimal extraction for the irs , and to the isc team at cornell for testing and support .",
    "we appreciate the help and comments of fred lahuis on this paper ."
  ],
  "abstract_text": [
    "<S> we present new advances in the spectral extraction of point - like sources adapted to the _ infrared spectrograph _ onboard the _ </S>",
    "<S> spitzer space telescope_. for the first time , we created a super - sampled point spread function of the low - resolution modules . </S>",
    "<S> we describe how to use the point spread function to perform optimal extraction of a single source and of multiple sources within the slit . </S>",
    "<S> we also examine the case of the optimal extraction of one or several sources with a complex background . </S>",
    "<S> the new algorithms are gathered in a plugin called ` adopt ` which is part of the ` smart ` data analysis software . </S>"
  ]
}