{
  "article_text": [
    "modern radiotherapy is a mainstay of cancer treatment today , and in the developed world around half of cancer patients will receive radiotherapy as part of their treatment .",
    "the bulk of radiotherapy treatments are given by using x - rays from a low - energy linac ( c. 10 - 20  mev kinetic energy ) , where the method of intensity - modulated radiotherapy ( imrt ) utilises numerous treatment field directions and a moveable set of multi - leaf collimators that may obtain a highly - conformal dose to a prescribed treatment volume  @xcite .",
    "whilst accurate pre - treatment patient imaging ( such as computed tomography ) are of course crucial to creating and delivering the planned treatment , the inherent near - exponential reduction of x - ray intensity with depth makes x - ray treatment comparatively less sensitive to errors in the patient density that is inferred from the patient imaging process .",
    "proton therapy is an alternative method of delivering a radiotherapeutic treatment to a patient , already known since 1947  @xcite to potentially offer an inherently more precise delivered dose since the proton stopping transfers those particles kinetic energy to deposited dose according to the bethe - bloch equation  @xcite .",
    "a well - known initial proton energy coupled with a well - known tissue density allows one to place the maximum dose - at the bragg peak at the end of the particle range - at a desired position within the patient .",
    "the overlap of numerous bragg peaks from protons with differing initial energy allows a conformal dose in the treatment volume whilst potentially better sparing the surrounding tissue from unwanted dose , particularly important for nearby organs at risk .",
    "that said , proton therapy is not thought to be advantageous over x - ray therapy for all radiotherapy treatments , and is often prescribed for particular complex or paediatric treatments where the unwanted ancillary dose may cause a later induction of secondary cancers as a treatment side - effect .",
    "the potential treatment advantages of proton therapy have led to the creation of the more than fifty operating centres around the world today  @xcite . supplanting early facilities at research laboratories , today s hospital - based centres predominantly utilise cyclotrons ( although synchrotrons are also used ) .",
    "modern cyclotrons - particularly superconducting ones - offer a number of advantages in terms of simplicity , capital cost and possible dose rate at the patient ; 1  gy may be accurately delivered to a patient by such a source in less than a minute using a current of @xmath01  na  @xcite .",
    "however , higher - intensity cyclotrons are typically limited to around 230 - 250  mev kinetic energy due to relativistic effects , and their fixed - energy extraction requires the use of a mechanical degrader ( typically carbon ) to lower the proton energy for shallower proton dose delivery .",
    "230  mev protons are fine for treating adult patients ( this energy corresponds to about a 33  cm proton range in water ) , but some treatments would benefit from more rapid ( and therefore finer ) variation of the energy .",
    "the latter benefit has led to the proposal of both linacs and ffags ( fixed - field alternating gradient accelerators ) for particle therapy ; each offers the possibility of obtaining a rapid change of the delivered proton energy at rates up to 1  khz .",
    "various ffag designs have therefore been put forward , a notable example being the french raccam study that showed how such an accelerator could operate with multiple treatment rooms  @xcite .",
    "irrespective of the accelerator technology used to deliver the particles , the benefits of proton therapy are today limited by inadequacies in the patient imaging used to estimate the patient tissue density  @xcite .",
    "this determination is crucial to deriving a suitable treatment plan , and is further complicated by the complex scattering effect around inhomogeneities that demands monte - carlo dose estimation  @xcite .",
    "x - ray computed tomography is seen as somewhat inadequate as the patient density and composition derived from the hounsfield measurement can lead to several millimetres of error in the resulting proton range  @xcite .",
    "proton tomography is a better , more direct , measure of the desired proton stopping power and therefore several groups are developing clinical proton tomography instruments that typically track millions of individual protons to assemble a three - dimensional image with a resolution approaching a millimetre  @xcite .",
    "but , proton tomography requires protons of sufficient energy to pass through the part of the patient to be imaged , implying significantly - higher incident energies than those that would be used to deliver a ( stopped beam ) treatment in that same volume .",
    "a proton source of 250  mev could be used for imaging through smaller depths , but patients requiring treatment with 230  mev protons of course require imaging with much higher proton energies - perhaps as high as 330  mev or more depending on the image resolution required .",
    "no commercial cyclotron today offers this higher energy , and whilst linacs and synchrotrons both in principle could offer such an energy only protom has offered a 330  mev system commercially  @xcite . this lack has previously motivated both the pamela design study  @xcite - which examined a combined accelerator system offering both protons and carbon ions - and our norma study  @xcite . both designs aimed at providing proton energies suitable for tomography , but in the latter proton - only norma",
    "study the additional goal has been to offer a simple , robust design .      in our previous work on norma we concluded that an ffag design utilising an fdf ( focusing - defocusing - focusing ) arrangement of normal - conducting gradient dipoles was the best way to achieve our desired 350  mev",
    ". the lower maximum field of around 1.6  t necessitates a somewhat larger circumference than could be obtained with superconducting magnets , but allows for an easier control of the tune during proton bunch acceleration via the higher - order field components in the magnets .",
    "injection of a single proton bunch would be obtained from a cyclotron at an energy greater than 30  mev , and both injection and extraction would be via a conventional pulsed kicker / septum combination that may benefit from lengthening two of the straight sections between the 10 fdf cells to give a racetrack layout ; the acceleration cycle of around 1  khz per extracted single bunch would enable rapid bunch - by - bunch variation of the delivered energy at the patient . a more detailed discussion of the accelerator magnet lattice design is given in garland et al .",
    "@xcite , and is summarised in section  [ sec : norma_lattice ] . in this previous article both the round and racetrack configurations of norma",
    "are considered ; however , here we focus on just the round variant .",
    "the optics design of norma presented in  @xcite was performed with idealised magnet models , to enable the overall beam dynamics to be studied and optimised .",
    "this is a common approach that allows optimisation using a reduced number of variables , and gives a tractable simulation time .",
    "our idealised magnet models use analytic expressions for the magnetic field within the body of the magnet , and a simple analytic expression for the fringe field fall - off ; this is a compromise between simplicity and realism .",
    "however , once a design has been obtained with idealised magnets it is of course important to check that the approximations used do not have a significant effect on the dynamics of the accelerator .",
    "for example , the presence , size and shape of the realistic fringe fields will affect the focusing of a magnet and the fields from the physical magnets will not completely match analytic models .",
    "their shape can introduce higher - order effects that are not expressed in their ideal analytic form and manufacturing tolerances will cause deviations from the ideal field .",
    "this is an issue that must in particular be addressed in ffag design - where the the magnets are large in aperture and inherently nonlinear in nature - before one can be confident that a realistic and therefore buildable design has been obtained .    in this article",
    "we build on our previous work  @xcite , and discuss the detailed 2d and 3d magnet modelling carried out to improve the realism of the norma design .",
    "realistic magnet fields introduce perturbations on the idealised dynamics such as tune shift and a reduction in the dynamic aperture .",
    "we show how this can be mitigated - by re - matching and re - optimising - in order to recover acceptable dynamical properties ; we demonstrate the recovery of a sufficiently flat tune profile and sufficient dynamic aperture for injection and acceleration .",
    "we introduce the magnet models in three stages , so as to methodically understand the importance of different effects ; the result is a realistic design of the round norma ffag lattice .",
    "the layout of this paper is as follows . in section",
    "[ sec : norma_lattice ] we describe the original norma lattice and the methods used for modelling complex elements and performing long - term stability studies .",
    "this is followed in section  [ sec : magnet_design_simulations ] by the magnet design process . in section  [ sec:2d_magnets ] norma",
    "is modelled using the radial profile from the 2d magnet simulations , with realistic transverse fields but with a simplified fringe model ; the effects on the dynamical properties are shown to be small .",
    "then in section  [ sec : fringe_fields ] we show the effects of changing the parameters used for the fringe fields , and how these can be mitigated by rematching the overall lattice ; the results show that all realistic likely fringe field perturbations to the dynamical properties can be absorbed by retuning the strength and field index of the magnets .",
    "finally , in section  [ sec:3d_magnets ] we model norma with a full set of 3d magnet models . here",
    "the effects on the dynamics are more significant , and so we show the necessary corrections to the field profile to restore the dynamical properties and crucially of the dynamic aperture .",
    "the overall result is , for the first time , a realistic design for a medical ffag capable of delivering 350  mev protons for imaging .",
    "in this section we introduce the nominal norma design , as described in detail in  @xcite , as well as the code zgoubi  @xcite which is used for tracking particles through the lattice .",
    "the round norma lattice design variant is a ffag consisting of 10 identical fdf triplets .",
    "it accelerates proton bunches to 350  mev , with injection from a cyclotron with at least 30  mev kinetic energy .",
    "norma utilises normal - conducting sector magnets with a scaling ffag field achieved by pole - face shaping . within the 36  cell",
    ", each magnet has a sector angle of 6 ; within the fdf triplet the magnets are spaced by 1.8 .",
    "the scaling ffag magnets result in a flat tune ( tune shift below ) over the full energy range from 30 to 350  mev .",
    "the magnet field fall - off is modelled using enge - like fringe fields with a 6  cm extent  @xcite .",
    "a norma triplet cell is shown in fig .  [",
    "fig : norma_cell ] . the full ring composed of 10 cells",
    "is shown in fig .",
    "[ fig : norma_ring ] . between each triplet is 2.4  m of magnet - free drift space .",
    "the parameters for the round norma lattice are given in table  [ tab : norma_ringparams ] .",
    "in this article we refer to this lattice as the nominal norma design and use it as the baseline for further study .",
    ".the main parameters of the nominal norma lattice . [ cols= \" < , > \" , ]     [ tab : norma_ringparams ]",
    "zgoubi which was used for tracking simulations is a charged - particle tracking code widely used for designing and studying ffags .",
    "it uses a stepwise ray - tracing method ; the particle is propagated in small steps and at each of these the magnetic field and its derivatives are evaluated .",
    "this gives accurate results for particles with a wide range of momenta and trajectories when moving through large - aperture magnets .",
    "zgoubi features a range of magnet descriptions that together are capable of simulating the complex magnets which are typical of ffags .",
    "we use the pyzgoubi  @xcite framework around zgoubi to expand its capability , allowing advanced scripting and optimisation .",
    "zgoubi features both analytic and field - map - based magnet descriptions . in each",
    ", the magnet description is used to calculate the field and its derivatives at each integration step along the charged - particle s trajectory . in our studies",
    "we have used several magnet models : ` ffag ` , an analytic model of a sector scaling ffag magnet ; ` dipoles ` , a sector dipole with optional higher multipole fields ; ` polarmesh ` , a 2d polar mid - plane field map with an out - of - plane expansion .",
    "zgoubi offers an idealised scaling ffag sector magnet , which we use as the reference model for the nominal error - free lattice .",
    "the field is composed of the product of the radial scaling law @xmath1 where @xmath2 is the reference radius and @xmath3 is the field index , and a longitudinal fringe function @xmath4 where @xmath5 is the distance from the effective field boundary , @xmath6 is the fringe field extent and @xmath7 are the well - known enge coefficients  @xcite . in the nominal design we use @xmath8  0 , @xmath9  2.24 and @xmath10  4  cm .",
    "zgoubi allows any field overlap between magnets to be modelled by assuming linear superposition .",
    "we use the ` ffag ` element for initial optimisation of the lattice ; however it is limited in its flexibility for error studies as only the position and strength can be adjusted .",
    "zgoubi s ` dipoles ` element can be used to model a sector dipole , but also allows additional multipole components in the field .",
    "this can be used for combined - function magnets , but also to approximate more complex fields such as a scaling ffag .",
    "it allows the radial field profile to be expressed as @xmath11 where @xmath12 are the multipole components .",
    "again this is multiplied by the longitudinal fringe field given in eq .",
    "[ eq : enge_fringe ] to give the mid - plane field .",
    "note that we use the ` dipoles ` element as an approximation of a scaling ffag magnet , not to represent a combined function ffag magnet as used in pamela  @xcite .",
    "there are two methods to find the multipole coefficients to use with the dipoles element .",
    "the ideal ffag scaling field can be taylor expanded about a given radius , usually halfway between the minimum and maximum orbits .",
    "alternatively a multipole expansion can be fitted to the required good field region .",
    "a taylor expansion of @xmath13 around @xmath14 gives @xmath15 which can be equated with eq .",
    "[ eq : dipoles_field ] to give the coefficients . whilst the taylor expansion gives the correct field and derivatives about the expansion point , using a fit gives a lower maximum deviation in field for any given expansion order , as illustrated in fig .",
    "[ fig : multipole_expansion ] . use of ` dipoles ` up to order gives a very good agreement to the dynamics of the ` ffag ` element : the mean closed orbit deviation is below @xmath16  cm and the mean fractional deviation of the tune is below @xmath17 horizontally and below @xmath18 vertically .",
    "zgoubi s ` polarmesh ` allows a magnet to be defined in terms of a 2d polar field map in the mid - plane , with field maps generated in external magnet simulation codes such as opera  @xcite .",
    "this allows simulation of the deviations from an ideal field that are likely to occur in a real magnet .",
    "it is also possible to generate field maps representing the ideal field by evaluating the analytic equations for a scaling ffag magnet at the grid points .",
    "this can be used to distinguish simulation effects due to the interpolation step from actual effects due to the imperfections of a realistic magnet .",
    "it also allows investigation into the resolution requirements for the field map .",
    "we find that for the nominal norma lattice a 1000@xmath191000 grid of mesh points per half cell , from the start to the centre of the triplet , is sufficient to give a mean closed orbit deviation of @xmath20  cm and mean fractional tune deviations of @xmath21 horizontally and @xmath22 vertically .",
    "increasing the mesh density to 2000@xmath192000 does not significantly improve agreement with the analytic models .",
    "dynamic aperture ( da ) is a measure of the stable area of phase space for particles circulating in an accelerator .",
    "a particle within the stable area will survive a large number of turns though the accelerator lattice , while a particle outside this region will be lost after a small number of turns . in practice",
    "a finite number of turns must be simulated in order to predict the stability . for norma",
    "we consider a coordinate stable if a particle starting there will survive 1000 turns , as this is representative of the length of the acceleration cycle of around 1  ms .",
    "we use a strict definition for dynamic aperture where - for any given amplitude - a set of particles with a range of phase space angles are tested and must all be stable , as described in  @xcite .    a large dynamic aperture is required to transport the injected bunches through the accelerator with a low loss . a large dynamic aperture increases",
    "overall transmission efficiency ( from injection to extraction ) and reduces radiation and activation . the injected bunches from a the cyclotron will have a typical emittance of around 10  mmmrad .",
    "we therefore require that the dynamic aperture is kept around 50  mmmrad or greater , a specification considered sufficient for this application  @xcite .",
    "it is useful to see the effect on the dynamic aperture of the nominal lattice design from using the differing tracking methods , before studying modifications to the lattice .",
    "this allows us to distinguish da changes that are due to using a different field from those due to the choice of tracking method .",
    "figure  [ fig : compare_da ] shows the dynamic aperture over a range of real space angles in @xmath23 and @xmath24 , using ` ffag ` , ` dipoles ` and ` polarmesh ` elements . as before , the ` dipoles ` shows good agreement to the ` ffag ` element .",
    "however , with the ` polarmesh ` we see a significant reduction in da . increasing the number of mesh points used in",
    "the ` polarmesh ` does not improve agreement with the analytic models .",
    "therefore , we consider only ` ffag ` and ` dipoles ` elements to be suitable for da calculations .",
    "deviations of a given field from an ideal field can be measured in a number of ways , and it is common to specify maximum deviations from the ideal field or gradient . in general the deviation of each multipole component from the ideal field can be measured . in a synchrotron",
    "a multipole expansion about the magnet centre can be used , but for a magnet that accepts a wide range of orbits one needs to be careful about where the multipole components are measured .",
    "this is important because introducing a multipole error of a given order at one location will change the lower - order multipole values everywhere else ; for example a sextupole error at a given orbit radius causes a quadrupole and dipole shift across the magnet . for a field map defined by field strengths on a regular grid",
    ", the multipole components can be found either by fitting a polynomial to the whole map or a subsection of it , or by repeated numerical differentiation ( i.e. the quadrupole component is proportional to the derivative of the field with respect to the radius ) .",
    "this section describes the cad ( computer - aided design ) models of the lattice magnets , the strategy chosen for their optimization and the main steps of implementation .      the required nominal radial field profile @xmath25 is given by eq .",
    "[ eq : scaling_law ] .",
    "the values of the parameters @xmath26 , @xmath27 , @xmath3 and the extent of the good - field region required are specified for each magnet .",
    "the first step of the magnet design and optimization process is to fit eq .",
    "[ eq : scaling_law ] to a polynomial within the good field region . by following the standard procedure ( see e.g.  @xcite ) the coefficients of the fitting polynomial can be used to obtain the two - dimensional scalar potential @xmath28 such that @xmath29 in the air gap of the two magnets .",
    "figure  [ fig : fig1kiril ] shows the result .",
    "note , that the 2d magnet modelling and optimization is performed in a coordinate system with an origin located at the centre of the good - field region of each magnet and the @xmath23-axis points along the machine radius .        if the permeability of the magnet yoke material is infinitely high the lines of constant scalar potential in fig .  [ fig : fig1kiril ]",
    "coincide with the faces of the magnet poles that generate the required field .",
    "the good - field region ( plus any reasonable contingencies ) must fit within the air gap of the magnet and this determines uniquely the actual magnet pole shapes and the nominal value of the scalar potential that the magnet will be operated at . indeed , as fig .",
    "[ fig : fig1kiril ] shows , each pole configuration is uniquely determined by the absolute value of its scalar potential @xmath30 .",
    "finally , the nominal magnet current @xmath31 ( ampere - turns ) can be obtained from ampre s law as usual , where @xmath32 is the vacuum permeability .",
    "however , in reality the permeability of ferromagnetic steel normally employed in accelerator magnet construction is finite .",
    "therefore , strictly speaking the magnet pole shape obtained by means of the multipole expansion technique described in the preceding paragraph is an approximation only .",
    "in addition , the onset of magnetic steel saturation lowers the permeability even further and this leads to field errors that can not be neglected , particularly in the high - field regions of the magnets .",
    "if the field error @xmath33 , where @xmath34 is the actual field generated by the magnet , is too high then the pole shape @xmath35 must be replaced with a new pole shape @xmath36 such that the magnitude of the field error @xmath37 it generates is acceptable .",
    "the approximate relationship between @xmath38 and @xmath39 can be obtained as follows . since both @xmath40 and @xmath41 are functions of @xmath23 i.e. @xmath42 and @xmath43 one can substitute @xmath44 in the two expressions by inverting the known expression for the pole profile @xmath45 and obtain the new expressions @xmath46 and @xmath47 .",
    "naturally , this is only possible under the assumption that the inverse pole profile function exists .",
    "the next step is to express @xmath40 in the form @xmath48 where @xmath49 is the correction to the pole profile . in eq .",
    "[ eq2 ] terms of the order of @xmath50 and higher have been neglected .",
    "an approximate solution to eq .",
    "[ eq2 ] is easy to obtain and the result is @xmath51 where @xmath52 and @xmath53.\\ ] ] in eq .",
    "[ eq3 ] terms of the order of @xmath54 and higher have been neglected .",
    "equivalently eq .  [ eq3 ] can be derived by formally inverting the function @xmath47 and taylor - expanding the result @xmath55 .",
    "it is clear that @xmath56 must not be zero as it is present in the denominators of both the expressions for @xmath57 and @xmath58 .",
    "however , in deriving eq .",
    "[ eq3 ] it has been assumed that the term of the order of @xmath59 is a small perturbation compared to the term of the order of @xmath60 , ( or equivalently , the term proportional to @xmath61 in eq .",
    "[ eq3 ] is much smaller than one ) and so the series can be truncated without any significant loss of accuracy .",
    "this assumption may not be valid if the value of @xmath62 is sufficiently small .",
    "this means that in the vicinity of local extrema of @xmath63 eq .  [ eq3 ] becomes inaccurate .",
    "in addition @xmath64 must be non - zero in order to ensure the existence of the inverse pole profile function @xmath65 . if however , @xmath66 ( i.e. @xmath67 has a pole ( see fig .  [",
    "fig : fig1kiril ] ) then in the vicinity of that pole @xmath68 and the term proportional to @xmath61 in eq .",
    "[ eq3 ] may no longer be small compared to one .",
    "hence , the applicability of eq .",
    "[ eq3 ] relies upon the following two conditions : ( i ) @xmath69 is non - zero and not too large and ( ii ) @xmath62 is not too small .",
    "a magnet pole optimization procedure based on eq .",
    "[ eq3 ] must be applied iteratively as eq .",
    "[ eq3 ] itself is an approximation .",
    "the zeroth - order approximation to the pole profile @xmath70 is obtained by means of the multipole expansion technique and the field distribution @xmath71 it generates is obtained from finite - element ( opera 2d  @xcite ) simulations . @xmath71 and @xmath70 are then substituted into the right - hand side of eq .",
    "[ eq3 ] to obtain the corrected pole profile @xmath72 which is in turn used to obtain the field distribution @xmath73 and so on .",
    "the implementation of this scheme on a computer uses matlab  @xcite to calculate the pole profile correction according to eq .  [ eq3 ] from field distribution data generated by opera 2d and the result is then fed to opera 2d , which in turn calculates the updated field distribution .",
    "this process is repeated until the desired maximum field error is reached .",
    "figure  [ fig : fig2kiril ] shows the result from a test run .",
    "the initial ( zeroth - order ) pole profile and the current strength were obtained with the multipole expansion technique . in order to test the optimization algorithm the coil current",
    "was intentionally increased so that the field in the main part of the magnet ( which operates far from saturation ) is 2% higher than the nominal field . within 7 iterations",
    "the peak relative field error was reduced by a factor of over 200 : from 2% to less than @xmath74 .",
    "figure  [ fig:2d_profile_map_ideal ] shows the good match for the dipole , quadrupole and sextupole components between the 2d field profiles and the ideal nominal magnet field .",
    "0.49     0.49     0.49     0.49     0.49     0.49     the first four iterations were performed in the region @xmath75 and the remaining three in the region @xmath76 while the specified good field region for this test was @xmath77 .",
    "it was noted that the convergence in the central region of the magnet was faster than in the low - field and high - field regions .",
    "indeed , as fig .",
    "[ fig : fig2kiril ] shows , the extent to which the error is reduced by the first iteration is greater in the central part of the magnet than towards the magnet ends .",
    "a possible explanation for this is that in the low - field region @xmath64 gradually increases towards the pole roll - off area whilst in the high - field region @xmath78 approaches zero near the peak of the magnetic field . as pointed out",
    "earlier these are precisely the conditions when eq .",
    "[ eq3 ] is no longer accurate .",
    "figure  [ fig : fig3kiril ] shows the correction to the pole profile obtained after 7 iterations . as can be seen , @xmath79 in the region @xmath80 , which corresponds to increasing the magnet gap and decreasing the field strength in full accordance with fig .",
    "[ fig : fig2kiril ] . the notch formed near",
    "@xmath81 is most a likely a result of eq .",
    "[ eq3 ] becoming less accurate close to the region where @xmath82 .",
    "the 3d magnet models were created by extruding the 2d magnet shapes , fig .",
    "[ fig : fig4kiril ] shows the opera 3d model of the focusing ( f ) magnet .",
    "two clamping plates were added on each side of the magnets to restrict the extent of their fringe fields . in order to save time the overall height of each magnet , the size of its back leg , the thickness of the clamping plates and the geometry of its roll - off in the high - field region were not optimized .",
    "the optimization in 3d was performed on the integrated field strength only and no attempt was made to adjust the main field ( generated in the air gap of the magnet ) and the fringe field ( generated outside the air gap ) separately .",
    "the integrated field strength @xmath83 is defined as @xmath84 where the origin of the cylindrical co - ordinate system is located in the machine centre , and @xmath85 , @xmath86 and @xmath24 are the radial , azimuthal and axial coordinates , respectively , and @xmath87 is the vertical ( axial ) magnetic field component .",
    "the integration limit @xmath88 was chosen such that @xmath89 .",
    "both magnets were specified as six - degree sector magnets .",
    "it was found that the integrated field strength distribution generated by the 3d six - degree sector magnet models deviates considerably from the ideal , `` hard - edge '' , six - degree sector magnetic field distribution given by eq .",
    "[ eq : scaling_law ] ( see fig .  [",
    "fig : fig5kiril ] ) .",
    "this means that pole edges of the magnets need to be adjusted accordingly .",
    "-sector model , @xmath90-sector model and a model with an optimized edge .",
    ", width=8 ]    to achieve this the new pole edge shape @xmath91 in the polar coordinate system employed is calculated from newton - raphson s formula @xmath92 where @xmath93 is the initial approximation to the magnet edge profile and @xmath94 is the specified value of the integrated field strength obtained from eqs .",
    "[ eq : scaling_law ] and  [ eq4 ] .",
    "the ratio @xmath95 was obtained by creating another magnet model with @xmath96 sector angle and subtracting the integrated field strengths obtained from both models . to simplify the task a discrete version of the good - field region of each magnet",
    "was considered .",
    "the radial coordinates @xmath97 split the good - field region into four intervals of equal length and the corresponding azimuthal coordinates @xmath98 were obtained from eq .",
    "the corrected pole edge shape was recovered by fitting a polynomial to the calculated nodes @xmath99 , @xmath100 . as fig .",
    "[ fig : fig5kiril ] shows this procedure reduces the peak relative integrated field error by an order of magnitude .",
    "further improvement can be obtained by `` tweaking '' the nodes individually until the desired accuracy goal has been reached .",
    "figure  [ fig : fig6kiril ] shows the pole edge profile of the f - magnet obtained from eq .  [ eq5 ] compared to a @xmath101-edge and a @xmath90-edge .",
    "compared to a @xmath101-edge and a @xmath90-edge.,width=8 ]    whilst the radial profile in the final 3d magnets deviates from that of the nominal design , the integrated field along each arc of constant radius is well matched by this adjustment of the edge geometry .",
    "figure  [ fig : norma_3d_d_midplane_peak_int ] show the peak and integrated fields for the focusing and defocusing magnets .",
    "the peak field is different from the nominal values by up to 7.3  % in the f magnet and 1.5  % in the d magnet , whereas the greatest deviation from nominal for the integrated field is 1.7  % in the f and 1.5  % in the d.    0.48     0.48     0.48     0.48     the 2d and 3d magnet models can now be used to obtain field maps for particle tracking . in following sections",
    "we analyse the beam dynamics with these realistic magnets models .",
    "in this section we model norma using the field profiles from the 2d magnet models , to compare the dynamics with the nominal fields .      the 2d magnet design is output from opera as a table of the vertical component of the field , @xmath102 , along a radial line through the magnet .",
    "the @xmath103 and @xmath104 are zero by symmetry .",
    "these radial profiles can be used in zgoubi with either the ` polarmesh ` or ` dipoles ` elements .    to track the 2d model with ` polarmesh ` a midplane field map must be generated . for each magnet",
    "the radial profile is combined with a longitudinal enge fringe function ( eq .  [ eq : enge_fringe ] ) , to give the field at each point on a 2d mesh .",
    "we use the same enge parameters as in the nominal model .",
    "these are summed to give the whole cell midplane field map . the process is shown in fig .",
    "[ fig:2d_polarmesh ] .",
    "= [ rectangle , draw , fill = green!20,text width=5em , text centered , minimum height=3em , node distance=1em ] = [ rectangle , draw , fill = blue!20,text width=5em , text centered , rounded corners , minimum height=3em , node distance=1em ] = [ rectangle , draw , fill = red!20,text width=6.5em , text centered , minimum height=3em , node distance=1em ]        to use the ` dipoles ` element , a set of multipole coefficients are found by fitting a polynomial to the radial profile .",
    "these coefficients are used along with parameters of the fringe fields and geometry , as shown in fig .",
    "[ fig:2d_dipoles ] .",
    "the multipole fit for ` dipoles ` can be a global fit across the whole magnet giving a single model that can be used at every energy .",
    "alternatively , a region around each orbit can be selected and fitted .",
    "this gives a higher accuracy , avoiding any smoothing from the fit , but means that the magnet description must be refitted for every energy . for simulations , we used -order local fits about each energy .",
    "the 2d model gives good agreement to the nominal design .",
    "figure  [ fig : norma_2d_da_energy_tune ] shows the horizontal and vertical tunes for the 2d models against the nominal design .",
    "the mean tune is within in both planes and the tune excursion grows from and to and between the nominal and the ` polarmesh ` model .",
    "agreement between the ` polarmesh ` and ` dipoles ` simulations methods are very good , demonstrating that the multipole expansion is an effective method to use for tracking .        an increased tune excursion may cause accelerated particles to cross resonances that reduce their stability . in order to confirm that this is not the case for the 2d magnets we determine the 1000-turn da . using ` dipoles ` with fits to the 2d radial field profile at each orbit , we find a 45   da that is very close to the nominal lattice over the full range of energies ; this is shown in fig .",
    "[ fig : norma_da_energy_2d_dipoles ] .",
    "the figure shows that deviations from the ideal field in the 2d model do not cause a significant drop in da . as with the nominal design ,",
    "the da is kept above 50  mmmrad over the full range of energies in the accelerator .",
    "we can also add random multipole errors to the magnets . by using errors of a similar magnitude to those seen in the 2d field",
    "we can get some understanding of how the worst - case errors might affect the da . however , applied multipole errors tend to cause big field changes away from the point that they are applied , which would not be seen in a well - designed realistic magnet . for a given error size , the ideal field",
    "is expanded around the mean position of a given orbit ; gaussian - distributed errors are then applied to a given multipole component .",
    "figure  [ fig : da_30_errors ] shows how the da is reduced as quadrupole and sextupole errors around 30  mev orbit increase , using 20 seeds per error size ; the dotted vertical lines represent the actual size of the errors in the 2d magnet model .",
    "we can see that quadrupole and sextupole errors of magnitudes similar to those in the 2d opera model do not cause the da to drop significantly below 50  mmmrad .",
    "[ fig : da_30_quad_errors ]    overall , the deviations of the 2d profile from the nominal design do not affect the dynamics enough to cause problems .",
    "we find that the increased tune shift as a function of energy are tolerable .",
    "random quadrupole and sextupole errors of similar magnitudes can also be added without causing the da to drop significantly below our requirements .",
    "whilst the 2d simulations are a good indicator that it is feasible to produce the magnetic field profile specified in the nominal lattice design , the following sections show that the longitudinal and full 3d fields are needed for a complete understanding .",
    "2d modelling is however a useful step in the design and optimisation stage , as it can be performed more rapidly than with full 3d models .",
    "in this section the effect of the fringe extent and radial dependence is investigated . for the initial lattice design an enge fringe field was used , with a 4  cm extent constant with respect to radius . in the real magnet ,",
    "the fringe extent depends on the pole shapes .",
    "it should be expected that adjustments to the magnet strengths and/or field profile will be needed to account for the realistic fringe fields .",
    "the fringe - field extent has a significant effect on the edge focusing of the magnets and therefore contributes to the tune of the cell .",
    "changes in the fringe - field extent as a function of radius will therefore have an effect on the tune as a function of energy .    to show the effect on the tune , the fringe extent was varied while all other lattice and magnet parameters were held fixed and no rematching was performed .",
    "figure  [ fig : fringe_sensitivity_nu ] shows the change in tunes as a function of fringe extent ; the original value of 4  cm in the nominal lattice is highlighted . as the tune shifts , the working point moves and approaches resonances . at an extent of around 10  cm",
    "the vertical tune approaches 0.25 ; the black points in fig .",
    "[ fig : fringe_sensitivity_da_kappa0_rematch ] show how this causes a large drop in da as the working point approaches the fourth - order resonance .",
    "the fringe - field extent can be varied by extending the fringe - field description from eq .",
    "[ eq : enge_fringe ] with the variable @xmath105 and making @xmath6 a function of @xmath85 , so that @xmath106 a positive @xmath105 gives a fringe field with a larger extent at smaller radii , as expected due to the larger pole gap .",
    "figure  [ fig : fringe_compare_nu_kappa ] shows the tune as a function of energy for a range of @xmath105 values .",
    "these tune shifts with energy can cause problems as the beam will cross resonances during acceleration , so it is important that they can be corrected .",
    "[ fig : fringe_compare_nu_y_kappa ]    the tune shift due to a change in the fringe field can be compensated by changing the magnet body fields . for a given fringe extent",
    "the working point of the lattice can be rematched to recover the original tunes by adjusting the magnet strengths @xmath107 of the f and d magnets , and the field index @xmath3 shared by both f and d magnets .",
    "the match is constrained to keep the outer closed - orbit position constant .",
    "da is most critical at injection energy before the emittance is reduced somewhat by adiabatic damping , so the rematching was performed at 30  mev .",
    "pyzgoubi s optimisation feature , making use of the nelder - mead downhill simplex method , was used for the rematching .",
    "figure  [ fig : fringe_sensitivity_da_kappa0_rematch ] shows how the rematch recovers some of the lost da for lattices where the change in fringe field caused the tune to approach a resonance .",
    "we find that the original working point is not necessarily optimal for maximising da , as the shape of the fringe field can affect the relative strength of the resonances .",
    "it is therefore important to re - optimise the working point to find the largest da region .",
    "re - optimisation is performed by scanning the lattice through a range of working points and calculating the dynamic aperture at each point .",
    "figure  [ fig : norma_fringe_rematch_scan_6 ] shows how the working point is rematched for a fringe extent of 6  cm .",
    "rematching the tune to the original values recovers some da , but the scan is required to recover a da above 50  mmmrad .",
    "the extent and shape of the fringe fields play a large role in the dynamics of an accelerator",
    ". the lattice must be re - optimised to account for their effects .",
    "this shows that 3d magnet simulation , which will give the fringe field , is a necessary step for realistic lattice design .",
    "in this section we model norma using fields maps from 3d magnet simulations . these contain not just the radial field profile but also how the field falls off outside the magnet body .",
    "3d magnets are output from the opera simulation as midplane field maps , i.e. the @xmath102 component at grid points on a horizontal midplane ; the @xmath103 and @xmath104 are zero by symmetry .",
    "the midplane is sufficient to fully define the field over the vacuum region of the magnet including the fringe field , while significantly reducing the computational resources required to generate and store the field map .",
    "figure  [ fig:3d_midplane ] shows the midplane fields for each magnet .",
    "0.49     0.49     the dynamics in the full magnet design will be strongly influenced by both the body field and the fringe fields .",
    "for example , the reduced peak field in the f magnet is compensated by an extended field length such that the integrated field is close to the nominal design .",
    "the 3d field maps must therefore be used as a whole , as the radial and fringe parts can not be independently combined with the nominal field .",
    "the midplane maps from the 3d magnet simulation can be used in zgoubi with either the ` polarmesh ` or ` dipoles ` elements .",
    "the f and d magnets are designed independently , as this allows simple boundary conditions and reduction in computation time due to symmetry .",
    "the midplane maps for the magnets are combined assuming a linear superposition to create the map for the full cell , which is then read into the ` polarmesh ` element as shown in fig .",
    "[ fig:3d_polarmesh ] . at the field",
    "crossover point in the overlap between the f and the d magnets , the residual field from the magnets is about 5 - 10% of the body field , greatest at the low - energy orbits .",
    "figure  [ fig : overlap_50 ] shows the overlap at 50  mev",
    ". a further step would be to combine the magnets within the fem simulations so that the overlap region is fully calculated .",
    "if this is found to cause a significant effect , then either clamp plates can be used to reduce the fringe extent or rematching as described below can be used to account for it .",
    "alternatively , the 3d magnet can be modelled with a ` dipoles ` , as shown in fig .",
    "[ fig:3d_dipoles ] .",
    "this makes rematching simpler by reducing the description to a small set of variables , gives more reliable long - term tracking and improves performance compared to tracking in the map directly . in order to accurately reproduce the shape of the magnet and fringe , the analytic function used in",
    "` dipoles ` is fitted to the field map , allowing the multipole components , sector angle , wedge angle , fringe extent , and fringe dependence on radius , to vary .",
    "the fit minimises the overall difference between the ` dipoles ` and the map , as well as the integrated field and gradient along the closed orbits .",
    "this results in an analytic field description that gives the same particle dynamics as using the field map directly .",
    "= [ rectangle , draw , fill = green!20,text width=5em , text centered , minimum height=3em , node distance=1em ] = [ rectangle , draw , fill = blue!20,text width=5em , text centered , rounded corners , minimum height=3em , node distance=1em ] = [ rectangle , draw , fill = red!20,text width=6.5em , text centered , minimum height=3em , node distance=1em ]                  the difference between the nominal fields and the 3d maps cause significant changes to the tune of the lattice . figures  [ fig:3d_norma_da_energy_nu_y ] and  [ fig:3d_norma_da_energy_nu_z ] show the tune for ` polarmesh ` in green and fitted ` dipoles ` in red , compared to the nominal ` ffag ` in blue . it can be seen that the fit does a good job of reproducing the dynamics of the field map . at low energies the vertical tune with the 3d magnets crosses the quarter - integer resonance",
    "so we expect a large drop in da below 100  mev .",
    "we simulate the 1000-turn da in the 3d magnet using both the ` polarmesh ` and fitted ` dipoles ` magnet elements .",
    "figure  [ fig:3d_norma_da_energy_da ] shows a significant reduction compared to the nominal ffag design , especially for energies below 100  mev where the vertical tune crosses below the quarter - integer resonance .",
    "it is clear that the uncorrected map does not result in a sufficiently large stable region .        in order to improve the da the magnets",
    "must be rematched so that the tune no longer crosses the harmful resonances .",
    "ideally the tune can be flattened such that the dynamics are similar to the nominal ffag design .",
    "this rematching is carried out by varying the multipole components of the fitted analytic field , and optimising to obtain the nominal tune at all energies .",
    "the shape of the fringe falloff is held fixed as it is expected that a small change to the body field will not have a dramatic effect on the fringe , so that after another iteration of the magnet design the tune flatness will be retained .",
    "we found that a rematch varying multipole coefficients up to decapole in the bodies of the magnets was sufficient to flatten the tune such that it no longer crossed harmful resonances .",
    "the light blue lines in fig .",
    "[ fig:3d_norma_da_energy_nu_y ] and  [ fig:3d_norma_da_energy_nu_z ] show the large improvement in tune flatness when the magnets are rematched up to decapole order .",
    "figure  [ fig:3d_norma_da_energy_da ] shows the da for the rematched magnets in light blue .",
    "the rematched tune is sufficient to increase the da to around 50  mmmrad in the critical region below 100  mev and for it to remain above 50  mmmrad at higher energies .    below 50  mev",
    "the da is still below our specification , even after rematching .",
    "it is expected that further magnet design work will improve the field quality in this region .",
    "otherwise , the injection energy could be raised above 30  mev , which is still reasonable as commercial cyclotrons can still be used as the injector .",
    "figures  [ fig : rematched_profile_f ] and  [ fig : rematched_profile_d ] show the fitted and rematched field profiles . in the f magnet",
    "the difference between the fitted field and the rematched field is less than 5% . in the d , at small radius",
    "there is a 20% reduction in the field , falling to 1% at large radius .",
    "these small changes to the body field are sufficient to rematch the magnets that would otherwise give significantly altered dynamics to the original design .",
    "these field profile adjustments can now be fed back into the magnet design , to produce magnet that gives dynamics and stability that meets the original requirements .",
    "the norma design for a medical proton accelerator has been previously demonstrated with idealised magnet modelling .",
    "more detailed modelling using realistic magnet designs is important to show that the design is robust , and to understand the retuning needed to maintain the required dynamics and stability , of the original design . in this paper",
    "we have shown that the norma lattice can be modelled with magnet designs from 2d and 3d fem simulations , taking the design from an idealised lattice to a detailed study with realistic magnets .",
    "this is therefore the first realistic design of a single proton ffag capable of delivering the 350  mev protons required for patient imaging .",
    "the f and d magnets were designed in 2d and 3d using opera .",
    "the field maps from the these models were imported into the pyzgoubi tracking code so that dynamics of the proton bunches could be compared to the idealised lattice .",
    "for the 2d models - which give a radial profile - no significant effect on the dynamics was found .",
    "random multipole errors , with similar - sized deviations as between the 2d profile and the analytic field , were found to have only a small effect on the stability of the lattice .",
    "this gives confidence in the feasibility of the original magnet specifications ; however it is clear that a realistic fringe fall - off and 3d field must also be considered .    to see the importance of the fringe fields , simulations with altered fringe extents",
    "were carried out .",
    "it was found that changing the fringe length had a significant effect on the focusing of the lattice , and that for any given fringe extent the lattice must be retuned . by rematching the field strength and index in the magnets",
    "the working point could be re - optimised and sufficient da recovered .",
    "3d magnet models predict greater shifts from the nominal fields .",
    "however , we show that it still possible to make small adjustments to the body fields that recover a sufficient da over the energy range from injection to extraction ; further iterations of the 3d design are needed to demonstrate this corrected magnet .",
    "more detailed modelling of the overlap region between the magnets is also needed , though it is expected that any changes to the dynamics can be accounted for by similar re - optimisation . with the current work we do not fully recover the da below 50  mev but believe it is possible based on the presented results .",
    "if not , then a raised injection energy could be used .",
    "this work shows how important it is to use 3d magnet simulations to model an ffag accelerator , in order to understand how the real magnets will affect the dynamics .",
    "it also demonstrates methods of retuning an accelerator design to account for these effects , and to recover the original dynamic properties and beam stability .",
    "we wish to thank franois mot for all his help with the zgoubi code , and jean - baptiste lagrange and jaroslaw pasternak for discussions and advice .",
    "research supported by stfc grant number st / k002503/1 `` racetrack ffags for medical , prism and energy applications '' . the work undertaken in this paper was funded by the cockcroft institute core grant ( stfc grant reference st / g008248/1 ) .",
    "url # 1`#1`urlprefixhref # 1#2#2 # 1#1          a.  garden , w.  h. morrison , d.  i. rosenthal , k.  chao , k.  k. ang , target coverage for head and neck cancers treated with imrt : review of clinical experiences , seminars in radiation oncology 14  ( 2 ) ( 2004 ) 103109 .",
    "a.  j. lomax , intensity modulated proton therapy and its sensitivity to treatment uncertainties 1 : the potential effects of calculational uncertainties , physics in medicine and biology 53  ( 4 ) ( 2008 ) 10271042 .",
    "k.  j. peach , et  al , http://link.aps.org/doi/10.1103/physrevstab.16.030101[conceptual design of a nonscaling fixed field alternating gradient accelerator for protons and carbon ions for charged particle therapy ] , phys . rev .",
    "beams 16 ( 2013 ) 030101 .",
    "http://dx.doi.org/10.1103/physrevstab.16.030101 [ ] .",
    "j.  m. garland , r.  b. appleby , h.  owen , s.  tygier , normal - conducting scaling fixed field alternating gradient accelerator for proton therapy , physical review special topics - accelerators and beams 18  ( 9 ) ( 2015 ) 094701 .",
    "s.  tygier , r.  b. appleby , j.  m. garland , k.  hock , h.  owen , d.  j. kelliher , s.  l. sheehy , the pyzgoubi framework and the simulation of dynamic aperture in fixed - field alternating - gradient accelerators , nuclear instruments and methods in physics research section a : accelerators , spectrometers , detectors and associated equipment 775 ( 2015 ) 1526 .      h.  a. enge , http://dx.doi.org/10.1063/1.1718806[effect of extended fringing fields on ion - focusing properties of deflecting magnets ] , rev . of sci .",
    "35 ( 1964 ) 278287 . http://dx.doi.org/10.1063/1.1718806 [ ] . http://dx.doi.org/10.1063/1.1718806    b.  muratori , j.  jones , a.  wolski , https://journals.aps.org/prab/abstract/10.1103/physrevstab.18.064001[analytical expressions for fringe fields in multipole magnets ] , phys . rev .",
    "beams 18 ( 2015 ) 064001 . http://dx.doi.org/10.1103/physrevstab.18.064001 [ ] . https://journals.aps.org/prab/abstract/10.1103/physrevstab.18.064001"
  ],
  "abstract_text": [
    "<S> norma is a design for a normal - conducting race track fixed - field alternating - gradient accelerator ( ffag ) for protons from 30 to 350 mev . in this article </S>",
    "<S> we show the development from the nominal lattice design to a model implemented with field maps from 2d and 3d fem magnet designs . </S>",
    "<S> we show that while the fields from the 2d model are sufficient , adjustments must be made lattice to account for differences in the fringe - field and full 3d models . with the corrections </S>",
    "<S> implemented we recover the required properties of small tune shift with energy and sufficiently - large dynamic aperture . </S>",
    "<S> the result is the first realistic design for a proton therapy accelerator that can rapidly deliver protons for treatment and for imaging at up to 350  mev . </S>"
  ]
}