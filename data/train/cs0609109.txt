{
  "article_text": [
    "the notion of a recognizable language is a fundamental concept in formal language theory , which has been clearly identified since the 1950 s .",
    "it is important because of its numerous applications , in particular for the construction of compilers , and also for the development of the theory : indeed , these languages can be specified in several very different ways , by means of _ automata _ , _ congruences _ , _ regular expressions _ and _ logical formulas_. this multiplicity of quite different definitions is a clear indication that the notion is central since one arrives at it in a natural way from different approaches .",
    "the equivalence of definitions is proved in fundamental results by kleene , myhill and nerode , elgot and bchi .",
    "the notion of a recognizable set has been extended in the 1960 s to trees ( actually to trees representing finite algebraic terms ) , to infinite words and to infinite trees . in the present article",
    "we discuss its extension to sets of finite graphs .",
    "the recognizability of a set of finite words or trees can be defined in several ways , as mentioned above , and in particular by finite _",
    "deterministic _ automata .",
    "this definition ( together with the related effective translations from other definitions ) provides linear - time recognition algorithms , which are essential for compiler construction , coding , text processing , and in other situations .",
    "recognizable sets of words can also be defined in an algebraic way by finite saturating congruences relative to the monoid structure .",
    "these definitions , by automata and congruences , extend smoothly to the case of finite trees ( i.e. , algebraic terms ) , using the natural algebra structure .",
    "the notion of recognizability in a general algebra is due to mezei and wright @xcite .",
    "we will not discuss here the extensions to infinite words and trees , which raise specific problems surveyed by thomas @xcite and perrin and pin @xcite .",
    "our aim will be to consider sets of finite graphs .    for finite graphs",
    ", there is no automaton model , except in very special cases , and in particular in the case of graphs representing certain _ labelled partially ordered sets _ and _ traces _",
    "( a trace is a directed acyclic graph , representing the equivalence class of a word w.r.t .",
    "a partial commutation relation ) , see the volume edited by diekert @xcite and the papers by lodaya and weil @xcite and sik and nmeth @xcite .",
    "algebraic definitions via finite congruences can be given because the set of finite graphs can be equipped with an algebraic structure , based on graph operations like the concatenation of words .",
    "however , many operations on graphs can be defined , and there is no prominent choice for a standard algebraic structure like in the case of words where a unique associative binary operation is sufficient .",
    "several algebraic structures on graphs can be defined , and distinct notions of recognizability follow from these possible choices .",
    "it appears nevertheless that two graph algebras , called the _ @xmath0-algebra _ and the _",
    "@xmath1-algebra _ for reasons explained below , emerge and provide robust notions of recognizability .",
    "the main purpose of this paper is to demonstrate the robustness of these notions . by robustness ,",
    "we mean that taking variants of the basic definitions does not modify the corresponding classes of recognizable sets of graphs .    in any algebra ,",
    "one can define two family of sets , the recognizable sets and the equational sets .",
    "the equational sets are defined as the components of the least solutions of certain systems of recursive set equations , written with set union and the operations of the algebra , extended to sets in the standard way .",
    "equational sets can be considered as the natural extension of context - free languages in a general algebraic framework ( mezei and wright @xcite , courcelle @xcite for a thorough development ) .",
    "the two graph algebras introduced above , the @xmath0- and the @xmath1__-algebra _ _ , are familiar to readers interested in graph grammars , because their equational sets are the ( context - free ) _ hyperedge replacement _ ( @xmath0 )",
    "sets of graphs on the one hand , and the ( context - free ) _ vertex replacement _ ( @xmath1 ) sets on the other .",
    "both classes of context - free sets of graphs can be defined in alternative , more complicated ways in terms of graph rewritings , and are robust in the sense that they are closed under certain transformations expressible in monadic second - order logic ( courcelle @xcite ) .",
    "the main results of this paper , described below in more detail , are :    \\1 ) the robustness of the classes of @xmath1- and @xmath0-recognizable sets of graphs ,    \\2 ) the robustness of the class of recognizable sets of finite relational structures ( equivalently of simple directed ranked hypergraphs ) , which extends the two previous classes ,    \\3 ) the exhibition of structural conditions on sets of graphs implying that @xmath0-recognizability and @xmath1-recognizability coincide ,    \\4 ) the comparison of the recognizable sets of the @xmath1-algebra and those of a closely related algebra representing _ modular decompositions _",
    "( modular decomposition is another useful notion for graph algorithms ) .",
    "the notion of recognizability of a set of finite graphs is important for several reasons .",
    "first , because recognizability yields linear - time algorithms for the verification of a wide class of graph properties on graphs belonging to certain finitely generated graph algebras .",
    "these classes consist of graphs of bounded tree - width and of bounded clique - width .",
    "these two notions of graph complexity are important for constructions of polynomial graph algorithms , see downey and fellows @xcite and courcelle et al .",
    "furthermore , these graph properties are not very difficult to identify because monadic second - order ( ms ) logic can specify them in a formalized and uniform way .",
    "( in many cases , an ms formula can be obtained from the graph theoretical expression of a property ) .",
    "more precisely , a central result @xcite says that every set of graphs ( or graph property ) definable by an ms formula is recognizable ( respectively admits such algorithms ) , for appropriate graph algebras .",
    "this general statement covers actually several distinct situations .",
    "another reason comes from the theory of graph grammars .",
    "the intersection of a context - free set of graphs and of a recognizable set is context - free ( in the appropriate algebraic framework ) .",
    "this gives immediately many closure properties for context - free sets of graphs , via the use of ms logic as a specification language for graph properties .",
    "recognizability also makes it possible to construct terminating and ( in a certain sense ) confluent graph rewriting rules by which one can recognize sets of graphs of bounded tree - width by graph reduction in linear time , see arnborg _",
    "_ @xcite .",
    "finally , recognizability is a basic notion for dealing with languages and sets of terms , and on this ground , its extension to sets of graphs is worth investigating .",
    "logical characterizations of recognizability can be given using ms logic , extending many results in language theory @xcite .",
    "several questions remain open in this research field .",
    "we have noted above that defining recognizability for sets of graphs can not be done in terms of finite automata , so that the algebraic definition in terms of finite congruences has no alternative .",
    "another advantage of the algebraic definition is that it is given at the level of universal algebra ( mezei and wright @xcite ) , and thus applies to objects other than graphs .",
    "however , even in the case of graphs , the algebraic setting is useful because it hides ( temporarily ) the complexities of operations on graphs and makes it possible to understand what is going on at a structural level .",
    "we now present the main results of this article more in detail .",
    "the two main algebraic structures on graphs called @xmath1 and @xmath0 , originate from algebraic descriptions of context - free graph grammars .",
    "definitions will be given in the body of the text .",
    "it is enough for this introduction to retain that the operations of @xmath1 are more powerful than those of @xmath0 .",
    "hence every @xmath0-context - free set of graphs ( i.e. , defined by a grammar based on the operations of @xmath0 ) is @xmath1-context - free , but not vice - versa . for recognizability",
    ", the inclusion goes in the opposite direction : every @xmath1-recognizable set is @xmath0-recognizable but the converse is not true .",
    "however , if the graphs of a set @xmath2 have no subgraph of the form @xmath3 ( the complete bipartite graph on @xmath4 vertices ) for some @xmath5 , then @xmath2 is @xmath0-recognizable if and only if it is @xmath1-recognizable ( this is the main theorem of section  [ sec knn ] ) . a similar statement",
    "is known to hold under the same hypothesis for context - free sets : if @xmath2 is without @xmath3 ( _ i.e. _ , no graph in @xmath2 contains a subgraph isomorphic to @xmath3 ) , then it is @xmath0-context - free if and only if it is @xmath1-context - free ( courcelle , @xcite ) .",
    "the proofs of the two statements are however different ( and both difficult ) .    up to now we have only discussed graphs , but our approach , which extends the approach developped by courcelle in @xcite , also works for hypergraphs and for relational structures .",
    "the operations on graphs , hypergraphs and structures are basically of three types defined in section  [ sec : algrelstr ] : we use only one binary operation , the disjoint union ; we use unary operations defined by quantifier - free first - order formulas ; and basic graphs and structures corresponding to nullary operations . in this way we can generate graphs and structures by finite algebraic terms .",
    "the quantifier - free definable operations can modify vertex and edge labels , add or delete edges .",
    "this notion is thus quite flexible .",
    "what is remarkable is that these numerous operations can be added without altering the notion of recognizability .",
    "the main result of section [ sec gp ] states that the same recognizable sets of graphs are obtained if one uses the basic @xmath1-algebra ( closely connected to the definition of _ clique - width _ ) , the same algebra enriched with quantifier - free definable operations , and even the larger algebra dealing with relational structures .",
    "variants of the @xmath1-algebra which are useful , in particular for algorithmic applications , are also considered , and they are proved to yield the same class of recognizable sets .    in section [ sec gs",
    "] , we discuss similarly the @xmath0-algebra which is very important because of its relation with _ tree - width _ and with context - free graph grammars .",
    "we prove a robustness result relative to the subclass such that the distinguished vertices denoted by distinct labels ( nullary operations ) are different .",
    "the @xmath0-operations are appropriate to handle graphs and hypergraphs with multiple edges and hyperedges ( whereas the @xmath1-operations are not ) .",
    "the original definitions ( see courcelle @xcite ) were given for graphs with multiple edges and hyperedges .",
    "in section [ sec simple multiple ] , we prove that for a set of simple graphs , @xmath0-recognizability is the same in the @xmath0-algebra of simple graphs and in the larger @xmath0-algebra of graphs with multiple edges . without being extremely difficult ,",
    "the proof is not just a routine verification .    in section [ sec :",
    "modular ] , we consider an algebra arising from the theory of modular decomposition of graphs . we show that under a natural finiteness condition , the corresponding class of recognizable sets is equal to that of @xmath1-recognizable ones .    in an appendix , we clarify the definitions of certain equivalences of logical formulas , focusing on cases where they are decidable , and we give upper bounds to the cardinalities of the quotient sets for these equivalences .",
    "these results yield upper bounds to the number of equivalence classes in logically based congruences .",
    "they are thus useful for the investigation of recognizability in view of the cases where the sets under consideration are defined by logical formulas .",
    "they also provide elements to appreciate ( an upper bound of ) the complexity of the algorithms underlying a number of the effective proofs in the main body of the paper .",
    "this work has been presented in invited lectures by b. courcelle @xcite and p. weil @xcite .",
    "the notion of a recognizable set is due to mezei and wright @xcite .",
    "it was originally defined for one - sort structures , and we adapt it to many - sorted ones with infinitely many sorts .",
    "we begin with definitions concerning many - sorted algebras .",
    "we follow essentially the notation and definitions from @xcite , see also @xcite .",
    "let @xmath6 be a set called the set of _ sorts_. an @xmath6-_signature _ is a set @xmath7 given with two mappings @xmath8 ( the set of finite sequences of elements of @xmath6 ) , called the _",
    "arity _ mapping , and @xmath9 , called the _ sort _ mapping .",
    "we denote by @xmath10 the length of the sequence @xmath11 , which we call also _ arity_. the _ type _ of @xmath12 in @xmath7 is the pair @xmath13 that we shall rather write @xmath14 , or @xmath15 if @xmath16 and @xmath17",
    ". the sequence @xmath11 may be empty ( that is , @xmath18 ) , in which case @xmath12 is called a _",
    "constant of type @xmath17_.    an _",
    "@xmath7-algebra _ is an object @xmath19 , where for each @xmath20 , @xmath21 is a non - empty set , called the _ domain of sort @xmath22 _ of @xmath23 . for a nonempty sequence of sorts @xmath24 ,",
    "we denote by @xmath25 the product @xmath26 . if @xmath27 , then @xmath28 is a total mapping from @xmath29 to @xmath30 .",
    "if @xmath12 is a constant of type @xmath22 , then @xmath28 is an element of @xmath31 .",
    "the objects @xmath28 are called the _ operations _ of @xmath23 .",
    "we assume that @xmath32 for @xmath33 .",
    "we also let @xmath23 denote the union of the @xmath21 ( @xmath34 ) . for @xmath35 ,",
    "we let @xmath36 denote the unique @xmath37 such that @xmath38 .",
    "a mapping @xmath39 between @xmath7-algebras is a _",
    "homomorphism _ ( or _ @xmath7-homomorphism _ if it is useful to specify the signature ) if it maps @xmath21 into @xmath40 for each sort @xmath22 and it commutes with the operations of @xmath7 .",
    "we denote by @xmath41 the set of finite well - formed terms built with @xmath42 ( we will call them _ @xmath7-terms",
    "_ ) , and by @xmath43 the set of those terms of sort @xmath22 ( the sort of a term is that of its leading symbol ) . if @xmath7 has no constant the set @xmath44 is empty .",
    "there is a standard structure of @xmath7-algebra on @xmath44 .",
    "its domain of sort @xmath22 is @xmath43 , and @xmath44 can be characterized as the _ initial @xmath7-algebra_.  this means that for every @xmath7-algebra @xmath23 , there is a unique homomorphism @xmath45 . if @xmath46 , the image of @xmath47 under @xmath48 is an element of @xmath21 , also denoted by @xmath49 .",
    "it is nothing but the evaluation of @xmath47 in @xmath23 , where the function symbols are interpreted by the corresponding functions of @xmath23 .",
    "one can consider @xmath47 as a term _ denoting _ @xmath49 , and @xmath49 as the _ value _ of @xmath47 in @xmath23 .",
    "the set of values in @xmath23 of the terms in @xmath50 is called the _ subset generated _ by @xmath7 .",
    "we say that a subset of @xmath23 is _ finitely generated _ if it is the set of values of terms in @xmath51 for some finite subset @xmath52 of @xmath7 .",
    "let @xmath7 be an @xmath53-signature , @xmath54 be an @xmath55-signature where @xmath56 .",
    "we say that @xmath57 is a _ subsignature _ of @xmath7 , written @xmath58 , if @xmath57 is a subset of @xmath7 and the types of every @xmath12 in @xmath57 are the same with respect to @xmath7 and to @xmath57 .",
    "we say then that an @xmath57-algebra @xmath59 is a _",
    "subalgebra _ of an @xmath7-algebra @xmath23 if @xmath60 for every @xmath61 , and every operation of @xmath59 coincides with the restriction to the domains of @xmath59 of the corresponding operation of @xmath23",
    ".    we will often encounter the case where an @xmath7-algebra @xmath23 is also the carrier of a @xmath62-algebra , and the @xmath62-operations of @xmath23 can be expressed as @xmath7-terms : in that case , we say that the @xmath62-operations of @xmath23 are _",
    "@xmath7-derived _ , and the @xmath62-algebra @xmath23 is an _",
    "@xmath7-derived algebra _",
    "( or it is _ derived from _",
    "@xmath23 ) .",
    "more formally , an @xmath6-_sorted set of variables _ is a pair @xmath63 consisting of a set @xmath64 and a _ sort mapping _ @xmath65 ( usually denoted simply by @xmath64 ) .",
    "we let @xmath66 be the set of @xmath67-terms written with @xmath68 , where it is understood that the variables are among the nullary symbols ( constants ) of @xmath68 .",
    "@xmath69 denotes the subset of those terms of sort @xmath22 .",
    "now if @xmath70 is a finite sequence of pairwise distinct variables from @xmath64 and @xmath71 , we denote by @xmath72 the mapping from @xmath73 to @xmath21 associated with @xmath47 in the obvious way ( @xmath74 denotes the sequence of sorts of the elements of @xmath70 ) .",
    "we call @xmath72 a _ derived operation of the algebra _ @xmath23 . if @xmath70 is known from the context , we write @xmath49 instead of @xmath72 .",
    "this is the case in particular if @xmath47 is defined as a member of @xmath75 : the sequence @xmath70 is implicitly @xmath76 .",
    "let @xmath7 be an @xmath6-signature .",
    "an @xmath7-algebra @xmath23 is _ locally finite _ if each domain @xmath21 is finite .",
    "if @xmath23 is an @xmath7-algebra and @xmath34 is a sort , a subset @xmath2 of @xmath21 is @xmath23-_recognizable _ if there exists a locally finite @xmath42-algebra @xmath77 , a homomorphism @xmath78 , and a ( finite ) subset @xmath79 of @xmath80 such that @xmath81 .",
    "we denote by @xmath82 the family of @xmath23-recognizable subsets of @xmath21 . in some cases it will be useful to stress the relevant signature and we will talk of @xmath7-recognizable sets instead of @xmath23-recognizable sets .",
    "an equivalent definition can be given in terms of finite congruences .",
    "a _ congruence _ on @xmath23 is an equivalence relation @xmath83 on @xmath84 , such that each set @xmath31 is a union of equivalence classes , and which is stable under the operations of @xmath23 .",
    "it is _ locally finite _ if for each sort @xmath85 , the restriction @xmath86 of @xmath83 to @xmath21 has finite index . a congruence _ saturates a set _ if this set is a union of classes .",
    "a subset @xmath2 of @xmath21 is @xmath23-recognizable if and only if it is saturated by a locally finite congruence on @xmath23 .",
    "the following facts are easily verified from the definition of recognizability or its characterization in terms of congruences ( see @xcite ) , and will be used freely in the sequel .",
    "[ easy recog facts ] let @xmath23 be an @xmath7-algebra .    * for each sort @xmath22 , the family @xmath82 contains @xmath21 and the empty set , and it is closed under union , intersection and difference . *",
    "if @xmath87 is a unary derived operation of @xmath23 or a homomorphism of @xmath59 into @xmath23 , ( where @xmath59 is another @xmath7-algebra ) , then the inverse image under @xmath87 of an @xmath23-recognizable set is recognizable . *",
    "if @xmath88 is a @xmath62-algebra with the same domain as @xmath23 , and if every @xmath62-congruence of @xmath88 is an @xmath7-congruence of @xmath23 ( e.g. @xmath88 is derived from @xmath23 , or @xmath62 is obtained from @xmath7 by adding constants ) , then every @xmath23-recognizable set is @xmath88-recognizable .",
    "if in addition @xmath62 contains @xmath7 , then @xmath23 and @xmath88 have the same recognizable subsets . *",
    "if @xmath59 is a subalgebra of @xmath23 and @xmath2 is an @xmath23-recognizable set , then @xmath89 is @xmath59-recognizable .",
    "this includes the case where @xmath59 has the same domain as @xmath23 , and is an @xmath57-algebra for some subsignature @xmath57 of @xmath7 . *",
    "suppose that @xmath23 is generated by @xmath7 and let @xmath48 be the evaluation homomorphism from @xmath44 onto @xmath23 .",
    "a subset @xmath2 of @xmath21 is @xmath7-recognizable if and only if @xmath90 is a recognizable subset of @xmath44 . if in addition @xmath7 is finite , then this is equivalent to the existence of a finite tree - automaton recognizing @xmath90 .    on the set of all words over a finite alphabet @xmath77 ,",
    "let us consider the binary operation of the concatenation product , and the unary operation @xmath91 , which is derived from the concatenation product .",
    "then the 3rd statement in proposition  [ easy recog facts ] shows that we have the same recognizable subsets as if we considered only the concatenation product .",
    "it is interesting to note that , in contrast , adding the operation @xmath91 to the signature adds new equational languages , _",
    "e.g. _ the set of all squares .",
    "we will see more technical conditions that guarantee the transfer of recognizability between algebras in section  [ sec technical lemmas ] below .",
    "we gather here some observations on the significance of recognizability .",
    "first , we note that if @xmath12 is an operation of an @xmath7-algebra @xmath23 , with arity @xmath92 , and if @xmath93 are @xmath23-recognizable , then @xmath94 is not necessarily recognizable .",
    "this is discussed for instance in @xcite , where sufficient conditions are given to ensure that @xmath94 is recognizable .",
    "it is well - known for instance that the product of two recognizable subsets of the free monoid ( word languages ) or of the trace monoid is recognizable ; a similar result holds for recognizable sets of trees .",
    "now , let @xmath23 be an @xmath7-algebra and let @xmath57 be a signature which differs from @xmath7 only by the choice of constants and their values .",
    "in particular , @xmath57 may be obtained from @xmath7 by the addition of countably many new constants .",
    "then the congruences on @xmath23 are the same with respect to @xmath7 and to @xmath57 and it follows that a subset of @xmath23 is @xmath7-recognizable if and only if it is @xmath57-recognizable .",
    "it is customary to assume that the @xmath7-algebra @xmath23 is generated by the signature @xmath7 .",
    "if @xmath23 is a countable @xmath7-algebra that is not generated by @xmath7 , we can enrich @xmath7 to @xmath57 by adding to @xmath7 one constant of the appropriate sort for each element of @xmath23",
    ". then @xmath57 generates @xmath23 ( in a trivial way ) . as noted above , @xmath23 has the same @xmath7- and @xmath57-recognizable subsets .",
    "if @xmath2 is one of these subsets , the set @xmath90 of @xmath57-terms is recognizable but we can not do much with it , because we lack the notion of a finite tree - automaton .",
    "see the conclusion of the paper for a further discussion of this point .",
    "finally , we can question the interest of the notion of a recognizable set .",
    "is it interesting in every algebra ?",
    "the answer is clearly no .",
    "let us explain why .    if the algebraic structure over the considered set @xmath23 is poor , for example in the absence of non - nullary functions , then every set @xmath2 is recognizable , by a congruence with two classes , namely @xmath2 and its complement .",
    "the notion of recognizability becomes void .",
    "another extreme case is when the algebraic structure is so rich that there are very few recognizable sets . for an example , consider the set @xmath95 of natural integers equipped with the successor and the predecessor functions ( predecessor is defined by @xmath96 , @xmath97 ) .",
    "the only recognizable sets are @xmath95 and the empty set . indeed , if @xmath98 is a congruence and if @xmath99 for some @xmath100 , @xmath101 , then by using the function @xmath102 times , we find that @xmath103 .",
    "it follows ( using the successor function repeatedly ) that any two integers are equivalent .",
    "intuitively , if one enriches an algebraic structure by adding new operations , one gets fewer recognizable sets .    for another example , let us consider the monoid @xmath104 of words over two letters .",
    "let us add a unary operation , the _ circular shift _ , defined by : @xmath105 and @xmath106 , @xmath107 , for every word @xmath108 .",
    "the language @xmath109 is no longer recognizable w.r.t .",
    "this new structure , however recognizability does not degenerate completely since every commutative language that is recognizable in the usual sense remains recognizable in the enriched algebraic structure .",
    "it is not completely clear yet which algebraic condition makes recognizability `` interesting '' .",
    "the statements in this section explain how to transfer a locally finite congruence from one algebra to another , possibly with a different signature , and hence how to transfer recognizability properties between algebras .",
    "proposition  [ easy recog facts ] above contains examples of such results .",
    "the statements that follow will be used in the proof of some of our main results , in section  [ sec gp ] .",
    "they are , unfortunately , heavily technical in their statements ( but not in their proofs  )    [ fgh - congruence ] let @xmath7 be an @xmath53-signature and let @xmath62 be a @xmath110-signature .",
    "let @xmath111 be an @xmath7-algebra and let @xmath112 be a @xmath62-algebra .",
    "let also @xmath113 be a collection @xmath114 such that , for each @xmath115 and @xmath116 , @xmath117 consists of mappings from @xmath118 into @xmath119 with the following property :    for each operation @xmath120 of type @xmath121 and for each @xmath122 , there exist sorts @xmath123 , mappings @xmath124 ( @xmath125 ) and an @xmath7-derived operation @xmath12 of type @xmath126 such that , for every @xmath127 , ",
    ", @xmath128 , @xmath129 .",
    "finally , let @xmath130 be an @xmath7-congruence on @xmath111 and let @xmath83 be the equivalence relation defined , on each @xmath118 , by @xmath131 then @xmath83 is a @xmath62-congruence on @xmath112 .",
    "let @xmath132 be an operation in @xmath62 , of type @xmath121 , and let @xmath133 such that @xmath134 for each @xmath135 .",
    "let also @xmath136 with @xmath116 .    by hypothesis , there exist sorts @xmath123 , mappings @xmath124 ( for @xmath137 ) and an @xmath7-derived operation @xmath12 of type @xmath126 such that @xmath138 since @xmath134 for each @xmath139 , we have @xmath140 ; and since @xmath130 is an @xmath7-congruence , it follows that @xmath141 .",
    "thus we have @xmath142 , which concludes the proof .    with the notation of lemma  [ fgh - congruence ] , for each sort @xmath115 ,",
    "let @xmath143 be the quasi - order relation defined on @xmath144 by @xmath145    [ fgh - finiteness ] with the notation of lemma  [ fgh - congruence ] , if for each @xmath146 the order relation associated with @xmath143 has a finite number of minimal elements , and if the @xmath7-congruence @xmath130 on @xmath111 is locally finite , then the @xmath62-congruence @xmath83 on @xmath112 is locally finite .",
    "let @xmath147 .",
    "we want to show that there are only finitely many @xmath83-classes in @xmath148 . by assumption ,",
    "there exist elements @xmath149 such that every mapping of @xmath150 is of the form @xmath151 for some @xmath152 and some @xmath7-derived operation @xmath12 .    for each @xmath139 ,",
    "let @xmath153 be the range of @xmath154 and let @xmath155 be the number of @xmath130-classes in @xmath153 .",
    "it is immediately verified from the definition of @xmath143 that if @xmath156 , then @xmath157 if and only if @xmath158 for each @xmath152 . in particular , @xmath118 has at most @xmath159 @xmath83-classes , which concludes the proof .",
    "we will actually need even more technical versions of these lemmas .",
    "[ fgh - congruence+zeta(t ) ] let @xmath111 , @xmath112 , @xmath7 , @xmath62 and @xmath113 be as in lemma  [ fgh - congruence ] , and let @xmath160 be a @xmath62-congruence on @xmath112 such that :    for each operation @xmath120 of type @xmath121 , for each @xmath122 and for each @xmath161 where each @xmath162 is a @xmath160-class of @xmath163 , there exist sorts @xmath164 , mappings @xmath165 ( @xmath125 ) and an @xmath7-derived operation @xmath166 of type @xmath167 such that , in @xmath112 , @xmath168 if each @xmath169 is in @xmath162 .",
    "finally , let @xmath130 be an @xmath7-congruence on @xmath111 and let @xmath83 be the equivalence relation defined , on each @xmath118 , by @xmath170 then @xmath83 is a @xmath62-congruence on @xmath112 .",
    "moreover , if @xmath113 satisfies the hypothesis of lemma  [ fgh - finiteness ] and @xmath130 and @xmath160 are locally finite , then @xmath83 is locally finite as well .",
    "the proof is the same as for lemmas  [ fgh - congruence ] and [ fgh - finiteness ] .",
    "even though we are ultimately interested in studying sets of graphs , it will be convenient to handle the more general case of relational structures .",
    "furthermore , relational structures can be identified with simple directed hypergraphs . such hypergraphs form a natural representation of terms .",
    "see for instance the chapter on hypergraphs in @xcite for applications",
    ".    in this paper , all graphs and structures are finite or countable .",
    "our proofs will not usually depend on cardinality assumptions on the graphs or structures , and hence our results will hold for finite as well as for infinite graphs or structures .",
    "however , recognizability in the algebraic sense we defined , is really interesting only for dealing with finitely generated objects , and hence for finite graphs and structures . for dealing with infinite words , trees and graphs , other tools are necessary , see for instance @xcite .",
    "let @xmath171 be a finite set of relation symbols , and @xmath79 be a finite set of nullary symbols .",
    "each symbol @xmath172 has an associated positive integer called its _ rank _ , denoted by @xmath173 .",
    "an @xmath174-structure is a tuple @xmath175 such that @xmath176 is a ( possibly empty ) set called the _",
    "domain _ of @xmath111 , each @xmath177 is a @xmath173-ary relation on @xmath176 , i.e. , a subset of @xmath178 , and each @xmath179 is an element of @xmath176 , called the _",
    "@xmath180-source _ of @xmath111 .",
    "we denote by @xmath181 the class of ( finite or countable ) @xmath174-structures , and we sometimes write @xmath182 for @xmath183 . by convention , isomorphic structures will be considered as equal . in the notation @xmath184 , @xmath185 stands for _ structures _ , while the second @xmath186 stands for _",
    "sources_.    a structure @xmath187 is _ source - separated _ if @xmath188 for @xmath189 .",
    "we will denote by @xmath190 the class of source - separated structures in @xmath181 .",
    "see corollary  [ stssep recognizable ] and section  [ sec source separation ] below .    in order to handle graphs",
    ", we will consider particular kinds of structures in the sequel .",
    "we let @xmath191 be the set of relation symbols consisting of a single binary relation @xmath192 , intended to represent directed edges .",
    "thus graphs can be seen as the elements of @xmath193 , also written @xmath194 .",
    "clearly these graphs are directed , simple ( we can not represent multiple edges ) and they may have loops . for a discussion of graphs with multiple edges , see section  [ sec simple multiple ] .",
    "we let @xmath195 denote the set @xmath196 .",
    "these structures are called _ graphs with sources_. we let @xmath197 denote the intersection @xmath198 .",
    "we will discuss also _ graphs with ports _",
    "( section  [ sec gp ] ) : if @xmath199 is a finite set of unary relation symbols called _ port labels _ , then we denote by @xmath200 the set of relational symbols @xmath201 and by @xmath202 the class @xmath203 .",
    "port labels are useful for studying the clique - width of graphs , see @xcite and remark  [ rk clique - width ] below .",
    "we first define some operations on structures .",
    "[ [ disjoint - union ] ] disjoint union + + + + + + + + + + + + + +    let @xmath79 and @xmath204 be disjoint sets of constants and let @xmath187 and @xmath205 .",
    "let us also assume that @xmath111 and @xmath206 have disjoint domains .",
    "we denote by @xmath207 the union of @xmath111 and @xmath206 , which is naturally a structure in @xmath208 .",
    "if @xmath111 and @xmath206 are not disjoint , we replace @xmath206 by a disjoint copy .",
    "we need not be very precise on how to choose this copy because different choices will yield isomorphic @xmath209-sums , and we are interested in structures up to isomorphism .",
    "it is also possible to define a similar operation , without the restriction that @xmath79 and @xmath204 are disjoint ( as in , say , @xcite ) .",
    "see section  [ sec sts - parallel ] below for a discussion .",
    "[ [ quantifier - free - definable - operations ] ] quantifier - free definable operations + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    our purpose is now to define functions from @xmath181 to @xmath210 by quantifier - free formulas .",
    "we denote by @xmath211 the set of quantifier - free formulas on @xmath174-structures with variables in @xmath212 .    a _ qfd operation scheme _ from @xmath181 to @xmath210 is a tuple @xmath213 where @xmath214 , @xmath215 if @xmath216 is a @xmath173-ary relation symbol , @xmath217 , such that the following formulas are valid in every structure in @xmath181 , for all @xmath218 , @xmath219 and @xmath220 of arity @xmath173 :    * @xmath221 ; * @xmath222 ; * @xmath223 ; * @xmath224 .",
    "the reason for these conditions becomes apparent with the following definition of the _ qfd operation _",
    "@xmath225 defined by such a scheme .",
    "let @xmath187 .",
    "the domain of the structure @xmath226 is the subset of the domain of @xmath111 defined by formula @xmath227 and the relation @xmath216 ( @xmath220 ) on @xmath226 is described by formula @xmath228 . finally , if @xmath219 , then @xmath229 if @xmath230 and @xmath111 satisfies @xmath231 .",
    "the first two conditions imposed above assert that relative to @xmath111 , @xmath180 is uniquely defined for each @xmath232 , the third condition asserts that @xmath233 always lies in the domain of @xmath226 , and the fourth condition asserts that the relation @xmath228 ( @xmath234 ) can only relate elements of the domain of @xmath226",
    ".    note that in the first condition , @xmath235 does not mean that @xmath180 and @xmath236 are the same constant , but that they have the same value in the considered structure .",
    "the conditions to be verified by a qfd operation scheme are decidable .",
    "it follows that the notion of a qfd operation scheme is effective .",
    "see the appendix ( remark [ remark a4 ] in particular ) for a discussion of this decidability result .",
    "[ def hr ops ] let @xmath171 be a finite set of relational symbols , @xmath79 be a finite set of source labels and let @xmath237 be source labels .",
    "we define the following operations .    * if @xmath238 and @xmath239 , @xmath240 is the unary operation of type @xmath241 which renames the @xmath242-source of a structure to a @xmath243-source ; * if @xmath238 , @xmath244 is the unary operation of type @xmath245 which forgets the @xmath242-source of a structure ; * if @xmath246 , @xmath247 is the unary operation of type @xmath248 which identifies the @xmath242-source and the @xmath243-source of a structure ( so the resulting domain element is both the @xmath242-source and the @xmath243-source ) , and reorganizes the tuples of the relational structure accordingly .",
    "note that the operation names @xmath240 , @xmath244 and @xmath247 are overloaded : they denote different operations when the sets @xmath171 and @xmath79 are allowed to vary .",
    "a completely formal definition would use operation names such as @xmath249 , which would be inconvenient .",
    "it is immediately verified that the operations of the form @xmath240 and @xmath244 are qfd .",
    "it is probably worth showing explicitly a qfd operation scheme defining the operation @xmath247 .",
    "let @xmath250 be the formula @xmath251 .",
    "if @xmath172 has arity @xmath252 , let @xmath253 be the formula @xmath254 where for each @xmath255 , @xmath256 if @xmath257 and @xmath258 otherwise . for each @xmath259",
    "such that @xmath260 and for each @xmath261 , let @xmath231 be the formula @xmath262 ; let @xmath263 be the formula @xmath264 , and let @xmath265 be the formula @xmath266 for each @xmath267 .",
    "it is now routine to verify that the scheme @xmath268 defines @xmath247 .",
    "there is no qfd operation from @xmath182 into @xmath269 if @xmath270 , because in the absence of constants in the input structure , we can not define constants in the output structure .",
    "[ example silent ] the natural inclusion of @xmath181 into @xmath271 when @xmath272 contains @xmath171 is a qfd operation in natural way : the formulas intended to define relations in @xmath273 are taken to be identically @xmath274 .",
    "[ [ the - signature - cals ] ] the signature @xmath275 + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    we define the algebra @xmath184 of _ structures with sources _ as follows .",
    "first , let us fix once and for all a countable set of relation symbols containing @xmath192 and countably many relation symbols of each arity , and a countable set of constants . in the sequel",
    ", finite sets of relation symbols @xmath171 and finite sets of constants @xmath79 will be taken in these fixed sets .",
    "the set of sorts consists of all such pairs @xmath174 .",
    "the set of elements of @xmath184 of sort @xmath174 is @xmath181 .",
    "the signature @xmath275 consists of the following operations ( interpreted in @xmath184 ) .",
    "first , for each pair of sorts @xmath174 and @xmath276 such that @xmath277 , the disjoint union @xmath209 is an operation of type @xmath278 . note that we overload the symbol @xmath209 , that is , we denote in the same way an infinite number of operations on @xmath184 .",
    "next , every qfd operation is a ( unary ) operation in @xmath275 .",
    "finally , we observe that the signature @xmath275 contains the natural inclusions of @xmath181 into @xmath271 when @xmath272 contains @xmath171 , which are qfd ( example  [ example silent ] ) .    as for constants in @xmath275 , one can pick a single source label @xmath242 , and consider a single constant @xmath279 , denoting the structure with a single element , which is an @xmath242-source , and no relations .",
    "together with the operations in @xmath275 , this constant suffices to generate all finite relational structures . as noted in section  [ significance ] , the choice of constants does not affect recognizability .",
    "it only affects the generating power of the signature , but this is not our point in this paper .",
    "we first consider the composition of qfd operations .",
    "[ composition of qfd ] qfd operations in @xmath184 are closed under composition ( whenever types fit for defining meaningful composition ) .",
    "let @xmath280 and @xmath281 be qfd operations , given respectively by the schemes @xmath282 and @xmath283 .",
    "the composite @xmath284 turns an @xmath174-structure into an @xmath285-structure .",
    "let @xmath286 , @xmath287 ( @xmath288 ) and @xmath289 ( @xmath290 , @xmath291 ) be obtained from @xmath292 , @xmath293 and @xmath294 by replacing every occurrence of @xmath295 ( @xmath220 ) by @xmath296 ; our formulas are now in the language of @xmath297-structures and we need to `` translate '' the constants @xmath219 into elements of @xmath79 . however , this translation , a mapping from @xmath204 to @xmath79 , depends on the structure in which we operate .    to reflect this observation , for each mapping @xmath298 , we let @xmath299 be the conjunction of the formulas @xmath300 ( @xmath219 ) and the formula obtained from @xmath286 by replacing each occurrence of @xmath232 ( @xmath219 ) by @xmath301 .",
    "finally , we let @xmath302 be the disjunction of the @xmath303 when @xmath87 runs over all mappings from @xmath204 to @xmath79 .    we proceed in the same fashion to define @xmath304 and @xmath305 for each @xmath288 and each @xmath306 , @xmath291 .",
    "finally , if @xmath307 and @xmath291 , we let @xmath308 .",
    "it is a routine verification that @xmath309 is a qfd operation scheme , which defines the composite operation @xmath284 .",
    "this completes the proof .    for each @xmath187",
    ", we define the _ type of @xmath111 _ , written @xmath310 , to be the restriction of @xmath111 to its set of sources .",
    "that is : the domain of @xmath310 is the set of @xmath79-sources of @xmath111 , and the relations of @xmath310 are those tuples of @xmath79-sources that are relations in @xmath111 . in order to simplify notation",
    ", we also denote by @xmath160 the equivalence relation on @xmath184 given by @xmath311    [ type equivalence ] let @xmath312 .",
    "then @xmath313 if and only if @xmath111 and @xmath112 satisfy the same formulas in @xmath314 .",
    "a formula in @xmath314 is a boolean combination of atoms of the form @xmath262 where @xmath315 , or @xmath316 where @xmath172 has arity @xmath5 and the @xmath169 are in @xmath79 .",
    "it is immediate that such an atom is true in @xmath111 if and only if it is true in @xmath310 .",
    "thus @xmath111 and @xmath310 satisfy the same formulas in @xmath314 : in particular , @xmath160-equivalent structures satisfy the same formulas in @xmath314 .",
    "thus , if we denote by @xmath317 the set of formulas in @xmath314 that are satisfied by @xmath111 ( see section  [ sec ffvv ] ) , we find that @xmath318 .",
    "conversely , we observe that if @xmath111 is a structure in @xmath181 , which consists only of its @xmath79-sources ( that is , @xmath319 ) , then @xmath111 is entirely described by some formula in @xmath314 .",
    "thus , if @xmath320 , then @xmath321 .",
    "this suffices to conclude the proof .",
    "the type relation @xmath160 has the following important property .",
    "[ ffvv light ] the type relation @xmath160 is a locally finite congruence on @xmath184 .",
    "the verification that @xmath322 ( @xmath187 , @xmath205 and @xmath277 ) is immediate .",
    "let us now consider a qfd operation @xmath280 , specified by the qfd operation scheme @xmath323 .",
    "by lemma [ type equivalence ] , @xmath111 and @xmath310 satisfy the same formulas of @xmath314 .",
    "in particular , for each @xmath230 and @xmath219 , @xmath111 and @xmath310 both satisfy @xmath231 , or both satisfy its negation . thus @xmath226 and @xmath324 have the same sources , and hence @xmath325 .",
    "we have just shown that the type relation is a congruence . to complete the proof",
    ", it suffices to show that for each sort @xmath174 , the set of types of sort @xmath174 , that is , the set @xmath326 is finite .",
    "note that if @xmath187 , then @xmath310 has cardinality at most @xmath327 ( and also at most @xmath328 ) .",
    "it follows that @xmath329 .",
    "proposition  [ ffvv light ] can be seen as a particular case of a result of feferman and vaught @xcite , theorem  [ ffvv ] below , which will be used in section [ sec knn ] .",
    "the simple formulation above will be very useful .",
    "note that the knowledge of @xmath310 is sufficient to determine whether @xmath111 is a source - separated structure .",
    "this observation is used to prove the following corollary .",
    "[ stssep recognizable ] let @xmath174 be a sort in @xmath184 .",
    "then @xmath190 is a recognizable subset of @xmath181 .",
    "whether a structure @xmath111 is source - separated depends only on its type @xmath310 : in particular , the type congruence @xmath160 saturates @xmath190 . by proposition  [ ffvv light ] , this relation is a locally finite congruence , and hence @xmath190 is recognizable .",
    "if @xmath330 is a sort of @xmath184 , we denote by @xmath331 the set of closed first - order formulas over @xmath171 and @xmath79 . for each integer @xmath232 , we denote by @xmath332 the set of those formulas of quantifier - depth at most @xmath232 . up to a decidable syntactic equivalence ( taking into account boolean laws , properties of equality , renaming of quantified variables , see appendix  [ appendix ] ) , there are only finitely many formulas in each set @xmath332 .",
    "thus , we can reason as if @xmath332 was actually finite .",
    "for an @xmath174-structure @xmath111 , we let its _",
    "@xmath333-theory _ be the set @xmath334 of formulas in @xmath332 that are valid in @xmath111 .",
    "it is finite since it is a subset of the finite set @xmath332 .",
    "[ ffvv ] let @xmath335 .    * for every qfd operation @xmath12 of type @xmath336 , there exists a mapping @xmath337 such that , for every @xmath174-structure @xmath111 @xmath338 * for every @xmath174 and @xmath276 , where @xmath79 and @xmath204 are disjoint , there exists a binary function @xmath339 such that , for every @xmath174-structure @xmath111 , and every @xmath276-structure @xmath206 , @xmath340    the second assertion was proved in @xcite for first - order logic , and extended by shelah to monadic second - order logic @xcite .",
    "the importance of this result is discussed by makowsky in @xcite .",
    "the functions @xmath337 and @xmath339 have finite domains and codomains .",
    "however these sets are quite large",
    ". these functions can be ( at least in principle ) effectively determined for given @xmath174 , @xmath276 , and @xmath232 .      in the literature on recognizable and equational graph languages ,",
    "several variants of the signature @xmath275 and the algebra @xmath184 are considered , notably a variant where the definition of the disjoint union is replaced by a more general parallel product , and a variant where all structures are assumed to be source - separated .",
    "we verify in this section that these variants do not yield different notions of recognizability .      in the literature ( e.g. @xcite )",
    ", the operation of disjoint union @xmath209 is sometimes replaced by the so - called _ parallel composition _ ( or _ product _ ) , written @xmath341 , an operation of type @xmath342 for which we do not assume that @xmath79 and @xmath204 are disjoint . if @xmath343 and @xmath205 , the parallel composition @xmath344 is obtained by taking the ( set - theoretic ) disjoint union of @xmath111 and @xmath206 and then identifying the @xmath180-sources of @xmath111 and @xmath206 for each @xmath345 .",
    "let @xmath346 denote the signature obtained from @xmath275 by substituting @xmath341 for @xmath209 .",
    "[ prop sts - parallel ] let @xmath2 be a subset of @xmath184",
    ". then @xmath2 is @xmath275-recognizable if and only if it is @xmath346-recognizable .",
    "we first observe that the operation @xmath209 is a particular case of @xmath341 .",
    "therefore @xmath275 is a sub - signature of @xmath346 and hence , every @xmath346-recognizable set is @xmath275-recognizable .    to prove the converse",
    ", it suffices to verify that @xmath341 is an @xmath275-derived operation by proposition  [ easy recog facts ] .",
    "indeed , if @xmath187 and @xmath205 , the parallel composition @xmath344 can be obtained by the following sequence of @xmath275-operations ( see example  [ def hr ops ] for their definition ) :    - for each @xmath345 , apply the qfd operation @xmath347 which renames the @xmath180-source in @xmath206 with a new source label , say @xmath348 , not in @xmath79 ; let @xmath349 be the resulting structure ;    - take the disjoint union @xmath350 ;    - for each @xmath345 , apply the operation @xmath351 which identifies the @xmath180-source and the @xmath348-source in @xmath352 ;    - apply the source - forgetting operation @xmath353 for each @xmath345 .",
    "the property that @xmath354 for @xmath355 is called _ source separation_. this property makes it easier to work with operations on structures and graphs , and hence we discuss a variant of the @xmath275-algebra @xmath184 , which handles source - separated structures .",
    "we will also use it in section  [ sec knn ] .",
    "recall that @xmath190 denotes the set of source - separated structures in @xmath181 .",
    "we now define a subsignature @xmath356 of @xmath275 such that @xmath357 is a sub - algebra of @xmath184 .",
    "disjoint union @xmath209 clearly preserves source separation , and is part of @xmath356 .",
    "next we include in @xmath356 the operations specified by qfd operation schemes such that , for each @xmath230 and @xmath358 ( see the notation in section  [ sec algebra sts ] ) , @xmath359 which guarantees that the operation preserves source separation .",
    "[ exemple hrsep ] the operations @xmath240 and @xmath244 defined in example  [ def hr ops ] are in @xmath356 .",
    "the operation @xmath247 defined in the same example is not .",
    "in contrast , the operation written @xmath360 , which identifies the @xmath242-source and the @xmath243-source of a structure as in @xmath247 , and makes the resulting element of the domain a @xmath243-source but not an @xmath242-source , preserves source separation .",
    "it can be written as @xmath361 .",
    "the operation which , given a graph with source labels @xmath242 and @xmath243 , exchanges the source labels @xmath242 and @xmath243 if the corresponding vertices are linked by an edge and does nothing otherwise , is another example of a qfd operation in @xmath356 .    regarding the effectiveness of the definition of @xmath356 , we observe the following .    given a qfd operation scheme",
    ", one can decide whether the corresponding qfd operation preserves source separation .",
    "let @xmath132 be the qfd operation specified by the given qfd operation scheme , and let @xmath181 be the domain of @xmath132 .",
    "one can effectively construct the images under @xmath132 of every type in @xmath181 , since there are only finitely many of them , and they can all be enumerated .",
    "one can then verify whether the operation preserves souce - separation on types .",
    "now it follows from the proof of proposition  [ ffvv light ] that for each @xmath187 , we have @xmath362 .",
    "in particular , @xmath132 preserves source separation if and only if it preserves it for the structures of the form @xmath310 .",
    "thus one can effectively decide whether @xmath363 .",
    "we now show that the restriction to source - separated structures does not change the notion of recognizability .",
    "[ thm ssep - recognizable ] let @xmath2 be a subset of @xmath357",
    ". then @xmath2 is @xmath275-recognizable if and only if it is @xmath356-recognizable .    by definition",
    ", @xmath356 is a subsignature of @xmath275 , so every @xmath275-recognizable set is @xmath356-recognizable .    to prove the converse ,",
    "we first define a mapping @xmath87 , which maps a structure @xmath343 to a source - separated structure @xmath364 by splitting sources that were identified in @xmath111 .",
    "we assume that the countable set of constant symbols ( from which @xmath79 is taken , see section  [ sec algebra sts ] ) is linearly ordered .",
    "let @xmath365 be given by @xmath366 we let @xmath367 and @xmath368 .",
    "the structure @xmath369 has domain set the disjoint union of @xmath111 and @xmath370 . for each @xmath371 ,",
    "the @xmath180-source of @xmath369 is the @xmath180-source of @xmath111 , and for each @xmath372 , the @xmath180-source of @xmath369 is the element @xmath372 .",
    "finally , for each @xmath172 , the relation @xmath373 equals the relation @xmath177 ( so it does not involve the elements of @xmath370 ) .",
    "observe that @xmath87 is not a qfd operation , and that @xmath374 , @xmath375 and @xmath370 depend only on @xmath310 .",
    "now let @xmath2 be an @xmath356-recognizable subset of @xmath357 and let @xmath130 be a locally finite @xmath356-congruence recognizing it .",
    "we need to construct a locally finite @xmath275-congruence @xmath98 on @xmath184 which recognizes @xmath2 .",
    "the relation @xmath98 on @xmath184 is defined as follows .",
    "if @xmath312 , we say that @xmath376 if @xmath377 and @xmath378 .",
    "it is immediately verified that @xmath98 is an equivalence relation . moreover ,",
    "the @xmath98-class of a structure @xmath111 is determined by its @xmath160-class , and by the @xmath130-class of @xmath369 .",
    "since both @xmath160 and @xmath130 are locally finite , @xmath98 also is locally finite .",
    "let us now prove that @xmath98 is an @xmath275-congruence .",
    "let @xmath379 and @xmath380 , with @xmath381 . by proposition  [ ffvv light ] , @xmath382 .",
    "it is not difficult to verify that @xmath383 it follows that @xmath384 since @xmath209 is an operation in @xmath356 .",
    "thus @xmath385 .",
    "next let @xmath132 be a qfd operation from @xmath181 to @xmath386 , given by the qfd operation scheme @xmath387 .",
    "let @xmath111 and @xmath112 be @xmath98-equivalent elements of @xmath181 , which will remain fixed for the rest of this proof .",
    "we need to show that @xmath388 .",
    "we already know from proposition  [ ffvv light ] that if @xmath389 , then @xmath390 , and we want to show that @xmath391 .    since @xmath390 , the mappings @xmath392 and @xmath393 , from @xmath394 to @xmath394 , coincide .",
    "let @xmath395 and @xmath396 .",
    "without loss of generality , we may assume that @xmath397 .",
    "the domain set of @xmath398 ( resp .",
    "@xmath399 ) is the disjoint union of the domain of @xmath226 ( resp .",
    "@xmath400 ) and @xmath401 .",
    "it suffices to show that there exists a qfd operation @xmath402 , depending on @xmath132 and @xmath310 , such that @xmath403 and @xmath404 ( where @xmath401 is the source - only element of @xmath405 ) .",
    "indeed , the fact that @xmath130 is an @xmath356-congruence will then imply that @xmath406 .",
    "let @xmath292 be obtained from @xmath227 by replacing every occurrence of @xmath230 by @xmath407 .",
    "for each @xmath408 , @xmath230 and @xmath409 , let @xmath410 be obtained from @xmath411 and @xmath412 be obtained from @xmath413 in the same fashion .",
    "let now @xmath414 be defined by the scheme @xmath415 it is now a routine verification that ( for our fixed structure @xmath111 ) @xmath416 .",
    "since all our definitions depend only on @xmath310 , we also have @xmath417 .",
    "one last step is required in this proof as the qfd operation @xmath418 may not preserve source separation for all structures , that is , @xmath418 may not lie in @xmath356 .",
    "it does for the particular structures @xmath419 and @xmath420 , but perhaps not for others .",
    "actually , structures @xmath421 such that @xmath422 do not matter in this context , so we can replace @xmath418 by the operation @xmath92 , with the same domain and range as @xmath418 , which maps a structure @xmath421 to @xmath423 if @xmath424 , and to the source - only source - separated structure @xmath425 where all relations are empty .",
    "this new operation @xmath92 preserves source separation by construction , and it is easily verified to be qfd .",
    "this completes ( at last ) the proof .",
    "graphs with ports were introduced in section  [ sec rel structures ] . recall that if @xmath199 is a set of unary relation symbols , then @xmath200 denotes the set @xmath427 and the class of graphs with ports in @xmath199 , written @xmath202 can be identified with @xmath203 .",
    "we observe that a vertex of a graph with ports in @xmath199 can be a @xmath428-port for one or several port labels @xmath429 , or for none at all .    for convenience",
    ", we will consider that @xmath199 is a finite subset of the set  of natural integers .",
    "we define the set of sorts of the algebra @xmath426 to be the set of finite subsets of . for each such subset @xmath199 ,",
    "the set of elements of @xmath426 of sort @xmath199 is the set @xmath202 of graphs with ports in @xmath199 .",
    "the signature @xmath1 consists of constants , unary operations and binary operations .",
    "these operations ( interpreted in @xmath426 ) are as follows .",
    "first , if @xmath430 are finite subsets of , then @xmath209 is as in @xmath184 , and is thus a binary operation of type @xmath431 . in @xmath426 ,",
    "we consider @xmath209 as an operation of type @xmath432 .",
    "next , the unary operations of @xmath1 are the following ( clearly qfd ) operations :    * if @xmath433 are distinct integers , @xmath434 is an operation of type @xmath435 for each sort @xmath199 such that @xmath436 : it modifies neither the domain ( the set of vertices ) nor the unary relations @xmath428 ( @xmath429 ) ; the new edge relation has the existing edges , _ plus _ every edge from a @xmath428-port to a @xmath437-port : it is given by @xmath438 * if @xmath439 is a finite subset of @xmath440 , @xmath441 is an operation of type @xmath442 where @xmath199 is any finite set containing the domain of the relation @xmath439 and @xmath443 is any finite set containing the range of @xmath439 ; it modifies neither the domain ( set of vertices ) nor the edge relation ; for each @xmath408 , the @xmath437-ports of the output structure are the vertices of the input structure that are @xmath428-ports for some @xmath428 such that @xmath444 ; that is , @xmath445 is given by @xmath446 .    finally , for each integer @xmath428 , we let @xmath447 be the constant of type @xmath448 denoting the graph with a single vertex , no edges , and whose vertex is a @xmath428-port . we also let @xmath449 be the same graph , with a single loop .    [ rename , forget ] the following operations on graphs with ports occur in the literature , and are particular cases of @xmath1-operations .",
    "let @xmath450 be integers , @xmath199 be a subset of  containing @xmath428 and @xmath451 .",
    "the operation @xmath452 , of type @xmath442 which _ renames _ every @xmath428-port to a @xmath437-port , is an operation of @xmath1 : it is equal to @xmath441 where @xmath453 .",
    "observe that this operation fuses the sets of vertices defined by @xmath428 and @xmath437 .",
    "let @xmath428 be an integer , and let @xmath199 be a subset of  containing @xmath428 .",
    "the operation @xmath454 , of type @xmath455 , which _ forgets _",
    "@xmath428-ports is an operation of @xmath1 : it is equal to @xmath441 where @xmath456 .    in our definition of graph with ports ,",
    "an element of @xmath457 does not need to have @xmath437-ports for each @xmath408 .",
    "thus , if @xmath458 , every graph with ports in @xmath199 can also be viewed as a graph with ports in @xmath443 .",
    "the natural inclusion of @xmath202 into @xmath457 is part of the signature @xmath1 : it is equal to @xmath441 where @xmath459 .    again ( as in example [ def hr ops ] ) , the operations introduced in this section are denoted by overloaded symbols .",
    "a formal definition should specify the type of the operation , and would read something like @xmath460 or @xmath461 .",
    "we prefer the more concise notation introduced here .",
    "the following result describes the action of a qfd operation on a disjoint union of structures .",
    "it is the key to the main results of this section , described in section [ vr equivalence ] below .",
    "[ unary - parallel ] let @xmath160 be the type congruence ( see section  [ sec elementary properties ] ) .",
    "let @xmath87 be a unary qfd operation on @xmath184 , from @xmath181 to @xmath462 , let @xmath463 and @xmath464 be sorts of @xmath184 such that @xmath465 , @xmath466 and @xmath467 , and let @xmath468 with @xmath469 a @xmath160-class in @xmath470 and @xmath471 a @xmath160-class in @xmath472 .",
    "then there exist quantifier - free definable operations @xmath473 , @xmath474 , and @xmath475 , such that    * @xmath166 is a composition of unary operations in @xmath1 ; * for each @xmath476 in class @xmath469 and each @xmath477 in class @xmath471 , @xmath478 .",
    "let @xmath479 be the qfd operation scheme defining the operation @xmath87 : here @xmath480 defines the @xmath192 relation , @xmath411 defines the @xmath437-ports ( @xmath408 ) , and there is no formula of the form @xmath231 since the range of @xmath87 is in @xmath481 .",
    "the formulas @xmath227 , @xmath480 and @xmath411 , for @xmath408 , are in the language of @xmath174-structures .",
    "the atoms of @xmath482 are either of the form @xmath295 ( @xmath172 ) , or @xmath483 , or @xmath484 ( @xmath485 ) .",
    "let @xmath486 be the formula obtained from @xmath482 by substituting the boolean value @xmath487 ( false ) for the following atoms , which are certainly false in a disjoint sum @xmath488 , with @xmath476 , @xmath477 and the variable @xmath489 interpreted in @xmath490 :    * each @xmath216-atom such that @xmath491 and an argument of @xmath216 is @xmath489 or a constant in @xmath492 ; * each @xmath216-atom such that @xmath493 and an argument of @xmath216 is a constant in @xmath494 ; * each @xmath216-atom such that @xmath495 , an argument of @xmath216 is a constant in @xmath494 , and another argument of @xmath216 is @xmath489 or a constant in @xmath492 ; * each atom of the form @xmath496 such that @xmath497 and @xmath498 is equal to @xmath489 or to a constant in @xmath492 .",
    "the remaining atoms in @xmath499 are either in @xmath500 or in @xmath501 .",
    "note that the @xmath160-class of an element of @xmath472 determines entirely which formulas in @xmath501 it satisfies . for each @xmath502 as in the statement of the proposition ,",
    "we let @xmath503 be the formula in @xmath500 obtained from @xmath486 by replacing each atom in @xmath501 by the boolean value 0 or 1 according to the @xmath160-class @xmath471 .",
    "we observe that if @xmath489 is a vertex of @xmath488 which happens to be in @xmath490 , then @xmath504 for each @xmath408 , let @xmath505 be defined similarly .",
    "then we also have , if @xmath489 is a vertex of @xmath488 in @xmath490 , @xmath506 let also @xmath507 and @xmath508 be defined dually . and again , if @xmath509 , we let @xmath510 be the formula obtained from @xmath480 by substituting the boolean value @xmath487 for the atoms that are certainly false in a disjoint sum @xmath488 for the variable @xmath489 interpreted in @xmath169 and the variable @xmath511 interpreted in @xmath512 :    * each @xmath216-atom such that @xmath513 and @xmath489 is an argument of @xmath216 ; * each @xmath216-atom such that @xmath514 and @xmath511 is an argument of @xmath216 ; * each @xmath216-atom such that @xmath491 and a constant in @xmath492 is an argument of @xmath216 ; * each @xmath216-atom such that @xmath493 and a constant in @xmath494 is an argument of @xmath216 ; * each @xmath216-atom such that @xmath495 , an argument of @xmath216 is a constant in @xmath494 , and another argument of @xmath216 is a constant in @xmath492 ; * each @xmath216-atom such that @xmath495 , an argument of @xmath216 is @xmath489 ( resp .",
    "@xmath511 ) and another argument of @xmath216 is a constant in @xmath515 ( resp .",
    "@xmath516 ) ; * each atom of the form @xmath483 with @xmath517 , @xmath518 with @xmath519 , or @xmath520 with @xmath521 and @xmath522 ; * if @xmath523 , each @xmath216-atom such that @xmath495 , and @xmath489 and @xmath511 are arguments of @xmath216 .    as above , the remaining atoms in @xmath524 are in @xmath525 , and for each @xmath502 , we let @xmath526 be obtained from @xmath524 by substituting the boolean values 0 or 1 for the atoms in @xmath501 according to the @xmath160-class @xmath471 . if @xmath527 are vertices of @xmath488 in @xmath490 , and if the @xmath160-class of @xmath528 is @xmath471 , then @xmath529 we define @xmath530 similarly , and get the analogous equivalence .    if @xmath523 , the atoms of @xmath531 are in @xmath532 and in @xmath533  which may include atoms in @xmath534 and in @xmath501 .",
    "again , we let @xmath535 be obtained from @xmath531 by substituting the boolean values 0 or 1 for the atoms without free variables according to the @xmath160-classes @xmath469 and @xmath471 . and we observe that if @xmath527 are vertices of @xmath488 , @xmath489 is in @xmath169 and in the @xmath160-class @xmath162 , @xmath511 is in @xmath512 and in the @xmath160-class @xmath536 , then @xmath537 now let @xmath538 , let @xmath539 be an enumeration of the subsets of @xmath540 , and let @xmath541 be an enumeration of the subsets of @xmath542 .",
    "let us denote by @xmath543 the set @xmath544 and by @xmath545 the set @xmath546 .",
    "we define the qfd operation @xmath547 defined by the following operation scheme : @xmath548 where for each @xmath549 , @xmath550 holds if the set of quantifier - free formulas in @xmath540 satisfied by @xmath489 is exactly @xmath551 .",
    "similarly , the qfd operation @xmath552 is defined by the operation scheme @xmath553 where for each @xmath554 , @xmath550 holds if the set of quantifier - free formulas in @xmath542 satisfied by @xmath489 is exactly @xmath551 .",
    "finally , we consider structures @xmath476 and @xmath477 , with @xmath160-classes respectively @xmath469 and @xmath471 , and we compare the graphs with ports @xmath555 and @xmath556 .",
    "the above remarks show that these two graphs have the same set of vertices , the same @xmath437-ports ( @xmath408 ) , and the same edges between two vertices of @xmath490 or two vertices of @xmath528 . on the other hand",
    ", @xmath555 misses the edges of @xmath557 that connect a vertex of @xmath490 with a vertex of @xmath528 .",
    "these edges are captured by the formulas @xmath558 and @xmath559 .",
    "now , if @xmath489 is a vertex of @xmath490 and @xmath511 is a vertex of @xmath528 , we already observed that the truth values of @xmath560 and @xmath561 are entirely determined by the quantifier - free formulas with one free variable satisfied by @xmath489 in @xmath490 and by @xmath511 in @xmath528 : that is , they are entirely determined by the ( unique ) index @xmath562 such that @xmath550 and by the ( unique ) index @xmath554 such that @xmath563 . in other words ,",
    "@xmath564 and @xmath565 are equivalent to disjunctions of conjunctions of the form @xmath566 thus the edges in @xmath556 from a vertex of @xmath490 to a vertex of @xmath528 can be created from @xmath567 by applying repeatedly the operations ( in @xmath1 ) of the form @xmath568 such that @xmath569 $ ] , @xmath570 is a disjunct of @xmath558 .",
    "similarly , the edges in @xmath556 from a vertex of @xmath528 to a vertex of @xmath490 can be created from @xmath567 by applying the appropriate operations of the form @xmath571 .",
    "the last operation consists in forgetting the auxiliary ports numbered @xmath572 to @xmath573 , that is , in applying the operation @xmath441 , with @xmath574 .      in this section ,",
    "we consider different notions of recognizability that can be used for sets of graphs with ports .",
    "let @xmath575 .",
    "then @xmath2 can be @xmath1-recognizable , as a subset of the @xmath1-algebra @xmath426 .",
    "it can also be @xmath275-recognizable , as a subset of the @xmath275-algebra @xmath184 since @xmath576 .",
    "finally , we introduce another signature , written @xmath577 , on @xmath426 : it is obtained from @xmath1 by adding all the qfd operations between the sorts of @xmath426 .",
    "[ thm vr equivalence ] let @xmath199 be a finite subset of @xmath578 and let @xmath2 be a subset of @xmath202 .",
    "the following properties are equivalent :    1 : :    @xmath2 is @xmath275-recognizable ; 2 : :    @xmath2 is @xmath577-recognizable ; 3 : :    @xmath2 is @xmath1-recognizable ;    since the operations of @xmath1 are operations of @xmath577 , and the operations of @xmath577 are operations of @xmath275 , it follows from proposition  [ easy recog facts ] that ( 1 ) implies ( 2 ) , and ( 2 ) implies ( 3 ) .",
    "thus , we only need to verify that ( 3 ) implies ( 1 ) .",
    "we use lemma  [ fgh - congruence+zeta(t ) ] , with @xmath579 , @xmath580 , @xmath581 , @xmath582 , and @xmath160 the type congruence ( see section  [ sec elementary properties ] ) , which relates structures with sources of the same sort , provided they satisfy the same quantifier - free formulas .",
    "we use the collection @xmath113 of sets @xmath583 of unary qfd operations from @xmath181 to @xmath202 .",
    "let @xmath2 be a @xmath1-recognizable subset of @xmath202 and let @xmath130 be a locally finite @xmath1-congruence on @xmath426 such that @xmath2 is a union of @xmath130-classes .",
    "since @xmath160 is a locally finite @xmath275-congruence on @xmath184 ( proposition  [ ffvv light ] ) , its restriction to @xmath426 is also a locally finite @xmath1-congruence ; and the intersection of @xmath130 and @xmath160 is a locally finite @xmath1-congruence on @xmath426 which saturates @xmath2 .",
    "thus we can assume , without loss of generality , that @xmath130-equivalent elements of @xmath426 are also @xmath160-equivalent .",
    "next we consider the equivalence relation @xmath83 on @xmath184 defined as in lemma  [ fgh - congruence+zeta(t ) ] .",
    "note that the identity of @xmath202 belongs to @xmath584 , so that @xmath83-equivalent elements of @xmath585 are also @xmath130-equivalent .",
    "in particular , @xmath83 saturates @xmath2 and it suffices to show that @xmath83 is locally finite and is a @xmath275-congruence . in view of lemma  [ fgh - congruence+zeta(t ) ] , it is enough to verify that @xmath113 satisfies the assumptions of lemma  [ fgh - congruence ] and [ fgh - finiteness ] .",
    "we first verify the hypothesis of lemma  [ fgh - congruence ] .",
    "let @xmath132 be an operation of @xmath275 : either @xmath132 is a unary qfd operation or @xmath586 . in the latter case ,",
    "proposition  [ unary - parallel ] states precisely that the required property holds .",
    "if @xmath132 is a qfd operation of type @xmath587 , and @xmath588 , then @xmath589 is a qfd operation ( lemma  [ composition of qfd ] ) and hence , @xmath590 . now letting @xmath12 be the identity mapping of @xmath202",
    ", we find that @xmath591 as required . in this case ,",
    "@xmath592 and @xmath12 do not depend on the @xmath160-class of @xmath593 .",
    "next , we turn to the verification of the hypothesis of lemma  [ fgh - finiteness ] .",
    "let @xmath594 ,  , @xmath595 be an enumeration of the elements of @xmath596 and let @xmath597 , ",
    ", @xmath598 be an enumeration of the elements of @xmath599 .",
    "thus , a qfd operation scheme from @xmath181 into @xmath457 consists in the choice of a formula @xmath600 ( @xmath601 ) , a formula @xmath602 ( @xmath603 ) , a sequence of formulas @xmath604 ( @xmath605 ) , and a partition of @xmath443 as @xmath606 : if @xmath607 , then @xmath608 . ( if @xmath609 , then @xmath610 . )",
    "let us now consider two unary qfd operations @xmath611 and @xmath612 , associated with the same choice of values @xmath613 , @xmath614 and @xmath615 .",
    "let @xmath616 and @xmath617 be the corresponding partitions of @xmath443 and @xmath618 .",
    "finally let @xmath619 be the following operations in the signature @xmath1 .",
    "these operations have the common particularity to not alter the graph structure , and to modify only the port predicates .",
    "the mapping @xmath620 shifts every port index of an element of @xmath457 by @xmath621 , to yield a graph with ports in @xmath622 , whose port names do not intersect @xmath618 .",
    "we let @xmath623 for @xmath624 .    for @xmath625 , @xmath626 where @xmath627 thus @xmath628 turns a graph with ports in @xmath629 into a graph with ports in @xmath630 , with the same vertex set , the same edge relation , the same @xmath437-ports for each @xmath631 , and with each @xmath216-port ( @xmath632 ) turned into a @xmath437-port for each @xmath633 .",
    "it is now an easy verification that , if @xmath634 , then @xmath635 for each @xmath636 .",
    "thus the quasi - order @xmath637 defined in lemma  [ fgh - finiteness ] is in fact a finite index equivalence relation , and this concludes the proof .",
    "this actually proves also that we get the same recognizable sets of graphs with ports , if we consider @xmath457 as a domain of sort @xmath443 in the algebra of structures _ without _ sources  which consists of the domains @xmath183 equipped with the operations of @xmath275 between them .",
    "if we were only interested in the equivalence of this recognizability with @xmath1- and @xmath577-recognizability ( or just the equivalence between @xmath1- and @xmath577-recognizability ) , we could do with lemmas  [ fgh - congruence ] and [ fgh - finiteness ] instead of lemma  [ fgh - congruence+zeta(t ) ] , and with a simpler version of proposition  [ unary - parallel ] , making no reference to @xmath160 .",
    "the first variant considered here replaces the signature @xmath1 by a smaller signature , which we will see is equivalent to @xmath1 in terms of recognizability .",
    "the second one concerns a certain class of graphs with ports , and is central in the definition of the clique - width of a finite graph .      in section  [",
    "vr equivalence ] , we exhibited signatures larger than @xmath1 , for which all the @xmath1-recognizable sets of graphs with ports are recognizable : namely the signature @xmath577 on @xmath426 and the signature @xmath275 on the wider algebra @xmath184 .",
    "in contrast , we exhibit in this section a smaller signature ( in fact , a signature consisting of @xmath1-derived operations ) which does not create new recognizable subsets .    the basic idea behind",
    "the definition of this new signature is the following : when we evaluate a @xmath1-term @xmath47 of the form @xmath638 , then we add edges from each @xmath428-port of @xmath639 , the value of @xmath640 , to each of its @xmath437-ports .",
    "it may happen that some edges from a @xmath428-port to a @xmath437-port already exist in @xmath639 . in this case",
    ", we do not add a parallel edge since we are dealing with simple graphs .",
    "thus the term @xmath47 presents a form of redundancy , since some of its edges may be , in some sense , defined twice .    for disjoint sets of port labels @xmath199 and @xmath443 ,",
    "we denote by @xmath641 the set of @xmath1-derived unary operations defined by terms of the form @xmath642 , where the @xmath643 are of the forms @xmath434 or @xmath644 for @xmath428 in @xmath199 and @xmath437 in @xmath443 .",
    "since the operations @xmath434 are idempotent and commute with one another , an operation in @xmath641 is completely described by a subset of @xmath645 .",
    "thus @xmath641 is finite , although one can write infinitely many terms specifying its elements . for each element @xmath646 ,",
    "we let @xmath647 denote the binary operation defined , for @xmath648 and @xmath649 , by @xmath650 .",
    "we observe that in the evaluation of a term of the form @xmath651 , the application of @xmath647 does not recreate edges that already exist in @xmath652 , the value of @xmath47 , or in @xmath639 , the value of @xmath640 since the @xmath434 operations forming @xmath647 add edges between the disjoint graphs @xmath652 and @xmath639 ( because @xmath428 and @xmath437 are not port labels of the same argument graphs ) .    now",
    "the signature @xmath653 consists of the operations @xmath647 as above , the unary qfd operations of the form @xmath454 and @xmath654 as defined in remark  [ rename , forget ] , and the constants @xmath447 and @xmath449 as in @xmath1 .",
    "we denote by @xmath655 the @xmath653-algebra of graphs with ports .",
    "the notation @xmath653 refers to a very similar algebra used by wanke @xcite .",
    "[ important example nlc ] we have in fact already encountered @xmath653-operations and @xmath653-derived operations .    the @xmath1-derived operation @xmath166 whose existence is proved in proposition  [ unary - parallel ] is actually @xmath653-derived .",
    "consider indeed the last paragraphs of the proof of that proposition : the operation @xmath166 is obtained by first composing operations of the form @xmath568 and @xmath571 , where the pairs @xmath656 lie in a certain subset of @xmath657      \\times [ \\ell+1,m]$ ] and the pairs @xmath658 lie in another subset of @xmath659 \\times [ k+1,\\ell]$ ] , and then composing operations of the form @xmath454 .    one can also check that the operations @xmath660 at the end of the proof of theorem  [ thm vr equivalence ] are @xmath653-derived .",
    "[ prop nlc ] let @xmath199 be a finite subset of @xmath578 and let @xmath2 be a subset of @xmath202",
    ". then @xmath2 is @xmath1-recognizable if and only if @xmath2 is @xmath653-recognizable .",
    "the proof is a simple extension of the proof of theorem  [ thm vr equivalence ] .",
    "since the operations of @xmath653 are @xmath1-derived , every @xmath1-recognizable subset of @xmath426 is @xmath653-recognizable . for the converse ,",
    "we observe that the proof that ( 1 ) implies ( 3 ) in theorem  [ thm vr equivalence ] can be modified to show that an @xmath653-recognizable set of @xmath426 is @xmath275-recognizable .    again",
    ", we rely on lemma  [ fgh - congruence+zeta(t ) ] , but now with @xmath661 , @xmath662 , and @xmath62 , @xmath112 , @xmath160 and @xmath113 as in theorem  [ thm vr equivalence ] .    in order to justify the fact that the arguments used in the proof of theorem  [ thm vr equivalence ] are also valid with these assumptions ,",
    "we refer to example  [ important example nlc ] .",
    "indeed this example shows two things : on one hand , the operation @xmath166 in proposition  [ unary - parallel ] is in fact @xmath653-derived , so that the first hypothesis of lemma  [ fgh - congruence+zeta(t ) ] is satisfied by this new choice of @xmath7 and @xmath111 . on the other hand",
    "the finiteness hypothesis of lemma  [ fgh - finiteness ] is also satisfied with this new value of @xmath661 .",
    "this completes the proof .      in certain contexts , and in particular in the definition of the clique - width of a graph ( see remark  [ rk clique - width ] below )",
    ", one needs to consider graphs with ports where port labels partition the vertex set .",
    "more precisely , for each set of port labels @xmath199 , let @xmath663 be the set of elements of @xmath202 such that each vertex is a port , and no vertex is both a @xmath428-port and a @xmath437-port for @xmath664 .",
    "let also @xmath665 .",
    "note that @xmath666 is preserved by the operations of the form @xmath209 , @xmath434 and @xmath654 .",
    "these operations form the signature @xmath667 , and @xmath666 is a @xmath667-algebra .    the operation @xmath434 is written @xmath668 in @xcite .",
    "[ rk clique - width ] the _ clique - width _ of a finite graph @xmath652 , denoted by @xmath669 , is defined as the smallest cardinality of a set @xmath199 such that @xmath652 is the value of a ( finite ) @xmath667-term using a set @xmath199 of port labels , see @xcite .    for algorithmic applications @xcite ,",
    "it is useful to have efficient recognition algorithms for classes of graphs of clique - width at most @xmath92 . at the moment",
    "we only know that this problem is @xmath670 .",
    "it is polynomial for @xmath671 , see @xcite .",
    "let @xmath2 be a subset of @xmath663",
    ". then @xmath2 is @xmath667-recognizable if and only if @xmath2 is @xmath1-recognizable .",
    "since @xmath667 consists of operations in @xmath1 , every locally finite @xmath1-congruence on @xmath426 induces a locally finite @xmath667-congruence on @xmath666 .",
    "in particular , if @xmath2 is @xmath1-recognizable , and hence is saturated by a locally finite @xmath1-congruence on @xmath426 , then @xmath2 is saturated by a locally finite @xmath667-congruence on @xmath666 , and hence @xmath2 is @xmath667-recognizable .    to prove the converse",
    ", we first introduce the mapping @xmath672 defined as follows .",
    "if @xmath648 , then @xmath673 is the graph in @xmath674 with the same set of vertices and the same edge relation as @xmath652 , and such that for each vertex @xmath489 and each @xmath675 , @xmath489 is an @xmath64-port in @xmath673 if and only if @xmath64 is the set of @xmath429 such that @xmath489 is a @xmath428-port in @xmath652 .",
    "we say that a port label @xmath428 is _ void in @xmath652 _ if there are no @xmath428-ports in @xmath652 .",
    "now let us assume that @xmath2 is @xmath667-recognizable , and let @xmath130 be a locally finite congruence on @xmath666 saturating it . if @xmath676 , we let @xmath677 if @xmath673 and @xmath678 have the same non - void port labels , and @xmath679 .",
    "it is immediately verified that @xmath98 is a locally finite equivalence relation .",
    "we now verify that @xmath98 is a @xmath1-congruence .",
    "if @xmath680 and @xmath649 , it is easily seen that @xmath681 . if @xmath436 ,",
    "then @xmath682 where @xmath12 is the composition of the operations @xmath683 for each @xmath684 such that @xmath685 and @xmath686 .",
    "finally , one can verify that if @xmath687 , then @xmath688 where @xmath132 is the composition of the operations @xmath689 , where @xmath675 , @xmath690 and @xmath691 .",
    "it is a routine task to derive from these observations the fact that @xmath98 is a @xmath1-congruence .",
    "we now need to verify that @xmath98 saturates @xmath2 .",
    "let @xmath692 and @xmath677 .",
    "in particular , @xmath693 , so that the non - void port labels of @xmath673 are exactly the sets @xmath448 where @xmath428 is a non - void port label of @xmath652 . since @xmath673 and @xmath678 have the same non - void port labels , @xmath694 is also in @xmath666 .",
    "moreover , if @xmath87 is the composition of the operations @xmath695 ( @xmath428 non - void in @xmath652 ) , then @xmath696 and @xmath697 .",
    "since @xmath87 is @xmath667-derived , it follows that @xmath698 , and hence @xmath699 .",
    "this concludes the proof .",
    "recall that we call _ graphs with sources _ the elements of @xmath184 of sort @xmath700 , where @xmath191 and @xmath79 is some finite set of source labels , and that we write @xmath195 for @xmath196 ( see section  [ sec rel structures ] ) .",
    "the disjoint union @xmath209 and the operations of the form @xmath240 , @xmath244 and @xmath247 ( defined in example  [ def hr ops ] ) preserve graphs with sources .",
    "we denote by @xmath0 the signature consisting of all these operations , so @xmath701 is an @xmath0-algebra .",
    "we note the following properties of @xmath0-recognizability .",
    "[ s2hr ] let @xmath79 be a finite set of source labels .",
    "every @xmath275-recognizable subset of @xmath196 is @xmath0-recognizable .",
    "this is a simple consequence of proposition  [ easy recog facts ] and of the observation given above that the operations of @xmath0 are also operations of @xmath275 .    note that the class @xmath194 of graphs , defined in section  [ sec rel structures ] , is equal to @xmath702 as well as to @xmath703 .",
    "thus @xmath1-recognizability and @xmath0-recognizability are properties of subsets of @xmath194 .",
    "[ vr2hr ] let @xmath2 be a set of graphs ( a subset of @xmath194 ) .",
    "if @xmath2 is @xmath1-recognizable , then it is @xmath0-recognizable .",
    "this follows immediately from proposition  [ s2hr ] and theorem  [ thm vr equivalence ] .    intuitively , the @xmath1-operations are more powerful than the @xmath0-operations ( every @xmath0-context - free set of simple graphs is @xmath1-context - free but the converse is not true , courcelle @xcite ) , but the @xmath0-operations are not among the @xmath1-operations , nor are they derived from them",
    ".    we will see in sections  [ proof no kmm ] and [ other finiteness ] sufficient conditions for @xmath0-recognizable sets to be @xmath1-recognizable , and in section  [ hr not vr ] , examples of @xmath0-recognizable sets which are not @xmath1-recognizable .",
    "we find in the literature a number of variants of the signature @xmath0 or of the algebra @xmath701 .",
    "we now discuss these different variants , to verify that they do not introduce artefacts from the point of view of recognizability .",
    "let @xmath704 denote the signature on @xmath701 obtained by substituting the parallel composition @xmath341 for @xmath209 ( see section  [ sec sts - parallel ] ) . with the same proof as proposition [ prop sts - parallel ] , we get the following result .    [ prop hr - parallel ] let @xmath2 be a subset of @xmath701",
    ". then @xmath2 is @xmath0-recognizable if and only if it is @xmath704-recognizable .      as in section  [ sec source separation ] , we now discuss the class @xmath705 of source separated graphs .",
    "the operations of @xmath0 all preserve source separation , except for @xmath247 , but we defined in example  [ exemple hrsep ] the operation @xmath706 which does .",
    "let @xmath707 be the signature on @xmath705 consisting of @xmath209 and the qfd unary operations of the form @xmath240 , @xmath244 and @xmath360 .",
    "[ prop hrsep ] let @xmath2 be a subset of @xmath705",
    ". then @xmath2 is @xmath0-recognizable if and only if it is @xmath707-recognizable .",
    "since @xmath707 consists only of @xmath0-derived operations , every @xmath0-recognizable set subset of @xmath705 is also @xmath707-recognizable .",
    "the proof of the converse is a variant of the proof of theorem  [ thm ssep - recognizable ] .",
    "first we note that the type relation @xmath160 ( see section  [ sec elementary properties ] ) is also an @xmath0-congruence on @xmath701 .",
    "we use the same mapping @xmath87 defined in the proof of theorem  [ thm ssep - recognizable ] , that maps a graph with sources @xmath708 to a source - separated graph @xmath709 by splitting sources that were identified in @xmath111 .",
    "we refer to that proof for notation used here .",
    "if @xmath2 is an @xmath707-recognizable subset of @xmath705 and @xmath130 is a locally finite @xmath707-congruence recognizing it , we define a relation @xmath98 on @xmath701 as follows .",
    "if @xmath710 , we say that @xmath376 if @xmath377 and @xmath378 . as in the proof of theorem  [ thm ssep - recognizable ] ,",
    "@xmath98 is easily seen to be a locally finite equivalence relation .",
    "it is also easily seen that @xmath98 is preserved under the @xmath707-operation @xmath209 .",
    "we now need to verify that if @xmath711 and @xmath132 is one of the unary operations of @xmath707 defined on @xmath712 , then @xmath713 .",
    "again , proposition  [ ffvv light ] shows that @xmath714 and we want to show that @xmath406 .",
    "the graphs @xmath111 and @xmath112 are fixed for the rest of this proof .",
    "we write @xmath715 , @xmath716 and @xmath492 for @xmath374 , @xmath375 and @xmath370 .    as in the proof of theorem",
    "[ thm ssep - recognizable ] , it suffices to construct an @xmath707-derived operation @xmath92 , depending on @xmath132 and @xmath310 , such that @xmath717 and @xmath718 .",
    "there is no reason why the operation @xmath92 constructed in the proof of theorem  [ thm ssep - recognizable ] should be @xmath707-derived , but the operations @xmath132 considered here , namely @xmath240 , @xmath244 and @xmath360 are simple enough that we can directly construct a suitable @xmath92 in each case .    [ [ if - g - srcren_arightarrow - b ] ] if @xmath719 + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    then @xmath132 is defined on @xmath195 ( where @xmath238 and @xmath239 ) and its range is @xmath720 .",
    "one verifies that @xmath721 is equal to :    * @xmath722 if @xmath723 and @xmath724 ; * @xmath725 if @xmath723 and @xmath726 ; * @xmath722 if @xmath727 and @xmath728 for every @xmath729 such that @xmath730 ; * @xmath731 if @xmath727 and @xmath732 .",
    "[ [ if - g - srcfg_a ] ] if @xmath733 + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    then @xmath132 is defined on @xmath195 ( where @xmath238 ) and its range is @xmath734 .",
    "one verifies that @xmath735 is equal to :    * @xmath736 if @xmath723 ; * @xmath737 if @xmath727 , @xmath738 and @xmath739 ; * @xmath740 if @xmath727 and @xmath741 .",
    "[ [ if - g - fus_arightarrow - b ] ] if @xmath742 + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    then @xmath132 is defined on @xmath195 ( where @xmath246 ) and its range is @xmath734 .",
    "one verifies that @xmath743 is equal to :    * @xmath744 if @xmath723 and @xmath745 ; * @xmath746 if @xmath723 and @xmath747 ; * @xmath748 if @xmath723 and @xmath749 ; * @xmath750 if @xmath727 and @xmath751 ; * @xmath752 if @xmath727 , and @xmath753 , and @xmath754 ; * @xmath755 if @xmath727 , @xmath756 and @xmath757 .",
    "this concludes the proof .",
    "again with the same proof as for proposition [ prop sts - parallel ] , we can show that the operation @xmath209 can be replaced by @xmath341 in the signature @xmath707  yielding the signature @xmath758 .",
    "[ prop hr - sep - parallel ] let @xmath2 be a subset of @xmath705",
    ". then @xmath2 is @xmath707-recognizable if and only if it is @xmath758-recognizable .",
    "the equivalence between @xmath758- and @xmath704-recognizability for a set of source - separated graphs  a consequence of propositions  [ prop hr - parallel ] , [ prop hrsep ] and [ prop hr - sep - parallel ]  was already established by courcelle in @xcite for graphs with multi - edges ( see section  [ sec simple multiple ] ) . in the same paper ,",
    "courcelle established the equivalence between @xmath707- and @xmath759-recognizability for several variants @xmath759 of the signature @xmath0 , which we now describe .",
    "we refer to @xcite for the proofs .    for each finite set @xmath79 of source labels ,",
    "let @xmath760 be the composition of the operations @xmath761 for each @xmath230 ( in any order ) .",
    "let also @xmath762 be the following binary operation on @xmath705 , of type @xmath763 : if @xmath764 , then @xmath765 : @xmath766 is obtained by first taking the parallel composition @xmath767 , and then forgetting all source labels .",
    "let @xmath768 be the signature on @xmath705 , which consists only of the @xmath762 operations .",
    "let @xmath769 be the derived signature of @xmath704 , which consists of the operations @xmath760 and @xmath341 .",
    "let @xmath770 be the subsignature of @xmath704 , which consists of the operations @xmath771 and @xmath341 .",
    "let @xmath772 be the subsignature of @xmath758 , which consists of the operations @xmath341 and those operations @xmath771 which preserve source separation .",
    "the following result is a compilation of ( * ? ? ?",
    "* section 4 ) .",
    "[ prop : other variants ] if @xmath773 , then @xmath2 is @xmath0-recognizable if and only if @xmath2 is @xmath770-recognizable .    if @xmath774 , then @xmath2 is @xmath707-recognizable if and only if @xmath2 is @xmath772-recognizable .    if @xmath775 , the following are equivalent :    * @xmath2 is @xmath0-recognizable ; * @xmath2 is @xmath768-recognizable ; * @xmath2 is @xmath769-recognizable .",
    "the notation @xmath768 refers to the notion of _ fully cutset - regular _ sets of graphs , introduced by abrahamson and fellows @xcite .",
    "full cutset - regularity is equivalent to @xmath768-recognizability .    in @xcite",
    ", courcelle also shows a number of closure properties of the class of @xmath707-recognizable sets of source - separated graphs with sources .",
    "in particular , it is shown that this class contains all singletons and it is closed under the operations of @xmath707 ( * ? ? ?",
    "* section 6 ) .",
    "finally courcelle shows the following result ( * ? ? ?",
    "* theorem 6.7 ) .",
    ". then @xmath2 is @xmath0-recognizable if and only if @xmath777 is @xmath0-recognizable .",
    "we saw that a @xmath1-recognizable set of graphs is always @xmath0-recognizable ( corollary  [ vr2hr ] ) .",
    "the converse does not hold in general , as we discuss in section [ hr not vr ] .",
    "we first explore structural conditions on graphs , which are sufficient to guarantee that an @xmath0-recognizable set of graphs is also @xmath1-recognizable .",
    "let @xmath778 be the directed complete bipartite graph with @xmath4 vertices .",
    "a directed graph @xmath779 is _ without @xmath778 _ if it has no subgraph isomorphic to @xmath778 .",
    "the main result in this section is the following .",
    "[ no kmm ] let @xmath5 be an integer .",
    "an @xmath0-recognizable set of graphs without @xmath778 is @xmath1-recognizable .",
    "this theorem is proved in section [ proof no kmm ] , and some of its corollaries are discussed in section  [ other finiteness ] .",
    "note that results similar to corollary  [ vr2hr ] and theorem  [ no kmm ] hold for @xmath1- and @xmath0-equational sets of graphs .",
    "as explained in the introduction , such sets are exactly the context - free sets of graphs , formally specified in terms of recursive sets of equations using the operations of @xmath1 and @xmath0 respectively .",
    "specifically , the following results are known to hold :    * every @xmath0-equational set of simple directed graphs is @xmath1-equational ( courcelle @xcite ) ; * if a @xmath1-equational set of directed graphs is without @xmath780 for some @xmath5 , then it is @xmath0-equational ( by the main theorem in courcelle @xcite and lemma  [ no kpp ] below ) .",
    "thus the same combinatorial condition is sufficient to guarantee the equivalence between @xmath1- and @xmath0-recognizability , as well as between @xmath1- and @xmath0-equationality .",
    "a further similar result concerning monadic second - order definability and using a stronger combinatorial property will be discussed in section  [ sparse mso ] .",
    "we first record the following observation .",
    "[ lemma yyy ] let @xmath652 be a directed graph and let @xmath781 be two vertices of @xmath652 that are not adjacent , and such that there is no vertex @xmath782 such that both @xmath783 and @xmath784 ( resp .",
    "both @xmath785 and @xmath786 ) are edges .",
    "let @xmath694 be obtained from @xmath652 by identifying @xmath593 and @xmath498 . if @xmath652 contains @xmath787 as a subgraph , then so does @xmath694 .",
    "let @xmath788 be a subgraph of @xmath652 isomorphic to @xmath787 . from the hypothesis , the vertices @xmath593 and @xmath498 are not both in @xmath788 .",
    "it follows that @xmath788 is still isomorphic to a subgraph of @xmath694 .",
    "the proof of theorem  [ no kmm ] will proceed as follows .",
    "we consider an @xmath0-recognizable set @xmath2 of finite graphs without @xmath778 and we denote by @xmath573 the largest integer such that @xmath787 is a subgraph of a graph in @xmath2 .",
    "such an integer exists by hypothesis .",
    "since we are talking about source - less graphs , the set @xmath2 is @xmath707-recognizable by proposition  [ prop hrsep ] , and we consider a locally finite @xmath707-congruence @xmath130 saturating @xmath2 .",
    "we will define a locally finite @xmath653-congruence @xmath98 on @xmath426 that also saturates @xmath2 . by proposition  [ prop nlc ] , this suffices to show that @xmath2 is @xmath1-recognizable .",
    "the definition of @xmath98 makes use of the notion of expansion of a graph , defined below .",
    "note that the following definitions depend on the integer @xmath573 , even though terminology and notation do not make this dependence explicit .",
    "[ [ small - and - large - port - labels - and - formulas ] ] small and large port labels and formulas + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    let @xmath680 be a graph with ports . if @xmath429 , we denote by @xmath789 the set of @xmath428-ports of @xmath652 .",
    "we say that a port label @xmath428 is _ void in @xmath652 _ if @xmath789 is empty , we say that @xmath428 is _ small in @xmath652 _ if @xmath790 and that @xmath428 is _ large in @xmath652 _ if @xmath791 .",
    "observe that if the port labels @xmath428 and @xmath437 are both large in @xmath652 , then @xmath792 contains @xmath793 as a subgraph .",
    "moreover , if @xmath428 is large in @xmath652 , if @xmath794 are small in @xmath652 , let @xmath795 for @xmath796 , let @xmath797 . if @xmath694 does not contain @xmath793 , then we must have @xmath798 .",
    "if @xmath652 already contains edges from the @xmath428-ports to other vertices , then @xmath799 . the notion of expansion below will make it possible to handle this sort of complicated situation ( see example  [ ex : expansion ] below ) .",
    "let us say that a closed first - order formula is _ small _ if it has quantifier - depth at most @xmath800 .",
    "note that the existence of a subgraph isomorphic to @xmath793 can be expressed by a first - order formula of quantifier - depth @xmath800 .",
    "[ [ expansions ] ] expansions + + + + + + + + + +    we will define supergraphs of @xmath680 called _ expansions _ , that contain information relevant to the distribution of small and large port labels , and where ports are represented by sources .",
    "furthermore , it will be possible to simulate an @xmath653-operation on @xmath652 that does not create @xmath793 subgraphs by @xmath0-operations on expansions of @xmath652 .",
    "these expansions will then be used to transform the @xmath707-congruence @xmath130 into an @xmath653-congruence @xmath98 .",
    "furthermore , we will define @xmath98 in such a way that two equivalent graphs satisfy the same small first - order formulas .",
    "we now give formal definitions .",
    "for each port label @xmath428 , we define a set @xmath801 of source labels , @xmath802 if @xmath199 is a set of port labels , @xmath803 denotes the union of the @xmath801 , for @xmath428 in @xmath199 .",
    "let @xmath648 be a graph with ports , let @xmath804 , and let @xmath805 be a graph in @xmath197 .",
    "we say that @xmath805 is an _ expansion _ of @xmath652 if the following conditions hold :    * @xmath806 has no subgraph isomorphic to @xmath793 .",
    "* except for the labeling of ports and sources , @xmath652 is a subgraph of @xmath805 .",
    "the sources of @xmath806 , and its vertices and edges not in @xmath652 , are specified by conditions ( 3 ) and ( 4 ) . *",
    "if @xmath428 is small in @xmath652 , then each @xmath428-port of @xmath652 is an @xmath807-source of @xmath805 for some integer @xmath808 .",
    "different @xmath428-ports are of course labelled by different source labels .",
    "there are no @xmath809- or @xmath810-sources . *",
    "if @xmath428 is large in @xmath652 , then there may be vertices of @xmath806 that are not in @xmath652 , with source labels of the form @xmath811 or @xmath812 for some @xmath813 .",
    "moreover , there is an edge in @xmath806 from each vertex of @xmath789 to each @xmath811-source , and from each @xmath812-source to each vertex in @xmath789 .",
    "there are no @xmath814-sources .",
    "in particular , @xmath652 may have several different expansions , but it has only a finite number of expansions ( up to isomorphism ) .",
    "this number is bounded by a function depending on @xmath573 and the cardinality of @xmath199 .",
    "indeed , for each small port label @xmath428 , there is only a bounded number of ways to make @xmath428-ports into @xmath807-sources ( see ( 3 ) ) , and for each large port label @xmath428 , there is a bounded number of ways to create @xmath811- and @xmath812-sources ( see ( 4 ) ) .",
    "[ ex : expansion ] let @xmath815 , and let @xmath652 be a graph with port labels @xmath816 .",
    "suppose that @xmath652 has 4 @xmath428-ports , 2 @xmath437-ports and 1 @xmath216-port , so that @xmath428 is large , and @xmath437 , @xmath216 are small in @xmath652 , see figure  [ fig : example expansion ] .",
    "then in any expansion of @xmath652 , every @xmath437- and @xmath216-port will be a source , say labeled by @xmath817 , @xmath818 and @xmath819 ( there is only one @xmath820-source , but it is not required that these sources should be labeled with consecutive numbers starting at 1 ) .",
    "( 70,55)(0,-50 ) ( 10,-47)(60,35 ) ( 2,-45 ) ( 12,-45 )    ( n0)(12.0,-12.0)@xmath428 ( n1)(22.0,-12.0)@xmath428 ( n2)(32.0,-12.0)@xmath428 ( n3)(42.0,-12.0)@xmath428 ( n4)(70.0,-17.0)@xmath437 ( n5)(70.0,-23.0)@xmath437 ( n6)(70.0,-35.0)@xmath216 ( n4)(70.0,-17.0)@xmath817 ( n5)(70.0,-23.0)@xmath818 ( n6)(70.0,-35.0)@xmath819 ( n7)(7.0,0.0)@xmath821 ( n8)(27.0,0.0)@xmath822 ( n9)(43.0,0.0)@xmath823 ( n10)(37.0,-30.0)@xmath593    ( n10,n0 ) ( n10,n1 ) ( n10,n2 ) ( n10,n3 )    ( n7,n0 ) ( n7,n1 ) ( n7,n2 ) ( n7,n3 )    ( n0,n8 ) ( n1,n8 ) ( n2,n8 ) ( n3,n8 )    ( n0,n9 ) ( n1,n9 ) ( n2,n9 ) ( n3,n9 )    moreover , an expansion of @xmath652 may have up to two new vertices that are @xmath809-sources , and at most one @xmath810-source .",
    "say , an expansion @xmath694 could have new vertices as @xmath822- and @xmath823-sources , with edges from each of the 4 @xmath428-ports to each @xmath809-source ; and it could have a new vertex as a , say , @xmath821-source , with edges from that vertex to each of the @xmath428-ports .    note that if @xmath652 has a vertex @xmath593 with an edge from @xmath593 to at least 3 @xmath428-sources , then an expansion can not have 2 @xmath810-sources : otherwise it would contain a copy of @xmath824 , which is not allowed for an expansion .",
    "it is not always the case that @xmath652 is determined by each of its expansions @xmath806 .",
    "if @xmath428 is large in @xmath652 but @xmath806 has no @xmath811- or @xmath812-sources , then it is not possible to determine which of its vertices are @xmath428-ports .    [",
    "[ construction - of - an - nlc - congruence - from - an - hr_sep - congruence ] ] construction of an @xmath653-congruence from an @xmath707-congruence + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    let @xmath130 be a locally finite @xmath707-congruence saturating @xmath2 .",
    "we define a relation @xmath98 on @xmath426 as follows . for @xmath652 and @xmath639 in @xmath202",
    "we let @xmath825 if and only if    * either @xmath652 and @xmath639 both contain @xmath793 as a subgraph , or neither does and in that case , the following two conditions hold : * @xmath652 and @xmath639 satisfy the same small first - order formulas ( _ i.e. _ , with quantifier - depth at most @xmath800 ) on graphs with ports . * for every expansion @xmath805 of @xmath652 , there exists an expansion @xmath826 of @xmath639 such that @xmath827 and @xmath805 and @xmath828 satisfy the same small first - order formulas on graphs with sources ( we say that @xmath806 and @xmath828 are _ equivalent expansions _ ) ; and conversely , for every expansion @xmath828 of @xmath639 there exists an expansion @xmath805 of @xmath652 equivalent to @xmath828 .",
    "note that condition ( b ) implies that @xmath652 and @xmath639 have the same void , small and large port labels , and condition ( c ) implies that @xmath805 and @xmath826 have the same source labels .",
    "the relation @xmath98 is clearly an equivalence relation on each set @xmath202 .",
    "it has finitely many classes on each @xmath202 since a finite graph has a uniformly bounded number of expansions ( up to isomorphism ) , the @xmath707-congruence @xmath130 is locally finite , and there are finitely many first - order formulas of each quantifier - depth on graphs with sources in a subset of @xmath803 .",
    "now a graph without ports and without @xmath829 has a unique expansion : itself .",
    "it follows that , for graphs without ports and without @xmath829 , the equivalences @xmath130and @xmath98 coincide .",
    "in particular , @xmath98 saturates @xmath2 since @xmath130 does .",
    "it remains to prove that @xmath98 is an @xmath653-congruence .",
    "recall that the signature @xmath653 consists of the operations of the form @xmath454 , @xmath654 and @xmath647 .",
    "[ [ the - port - forgetting - operation ] ] the port forgetting operation + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    we first consider the operation @xmath454 .",
    "we consider @xmath830 with @xmath831 and we want to prove that @xmath832 , where @xmath833 and @xmath834 .",
    "first of all , the underlying graphs of @xmath652 and @xmath694 ( resp . @xmath639 and @xmath835 ) are identical , so that @xmath652 and @xmath639 contain @xmath793 if and only if so do @xmath694 and @xmath835 .",
    "if this is the case , then @xmath831 and @xmath832 .",
    "we now exclude this case and assume that @xmath652 and @xmath639 are without @xmath793 .",
    "note also that if @xmath428 is void in @xmath652 , then it is in @xmath639 as well , and we have @xmath836 , @xmath837 , so that @xmath832 .",
    "we now assume that @xmath428 is not void in @xmath652 .",
    "it is an immediate consequence of theorem  [ ffvv ] that @xmath694 and @xmath835 satisfy the same small first - order formulas on graphs with ports , so condition ( b ) is verified .",
    "we now consider condition ( c ) .",
    "let @xmath838 be an expansion of @xmath694 .",
    "we will show that there exists an expansion @xmath805  of @xmath652 and a unary @xmath707-term @xmath47 such that @xmath839 = @xmath840 .",
    "since @xmath841 , there exists an equivalent expansion @xmath842 of @xmath639 , and @xmath843 will be the desired expansion of @xmath835 .",
    "using the fact that @xmath130 is an @xmath707-congruence and theorem  [ ffvv ] , we will have @xmath832 as expected .",
    "if @xmath428 is large in @xmath652 , the situation is particularly simple : @xmath838 is also an expansion of @xmath652 , so we can choose @xmath47 to represent the identity . if @xmath828 is an expansion of @xmath639 , equivalent to @xmath838 , then @xmath828 does not use source labels of the form @xmath807 , @xmath811 or @xmath812 , so @xmath828 is also an expansion of @xmath835 .",
    "if @xmath428 is small in @xmath652 , let @xmath806 be a graph with source obtained from @xmath838 by letting each @xmath428-port of @xmath652 be an @xmath807-source ( where distinct source labels are used for distinct @xmath428-ports ) .",
    "then @xmath806 is an expansion of @xmath652 , and @xmath844 where @xmath47 is the composition of the operations @xmath845 ( @xmath846 ) . using the definition of @xmath98",
    ", there exists an expansion @xmath828 of @xmath639 which is equivalent to @xmath806 , and we only need to verify that @xmath847 is an expansion of @xmath835 . the only point to check here is the fact that @xmath835 is a subgraph of @xmath848 : this follows from the facts that @xmath652 is a subgraph of @xmath806 and the operations @xmath47 and @xmath454 do not change the underlying graph structures .    [ [ the - renaming - operation ] ] the renaming operation + + + + + + + + + + + + + + + + + + + + + +    we now consider the operation @xmath654 .",
    "let @xmath830 with @xmath831 : as with the port forgetting operation , we want to prove that @xmath832 where @xmath849 and @xmath850 . as above , we can reduce the proof to the case where neither @xmath652 nor @xmath639 contains @xmath793 , and where @xmath428 is not void in @xmath652 ( if @xmath428 is void in @xmath652 , then @xmath836 and @xmath837 ) .",
    "moreover , condition ( b ) follows from theorem  [ ffvv ] .",
    "we consider condition ( c ) , following the same strategy as above .",
    "let @xmath838 be an expansion of @xmath694 .",
    "if @xmath437 is void in @xmath652 , then the transformation @xmath654 is a reversible renaming , that is , @xmath851 .",
    "moreover , if @xmath47 is the composition of the operations of the form @xmath852 , @xmath853 and @xmath854 , and if @xmath640 is the composition of the operations @xmath855 , @xmath856 and @xmath857 , then @xmath858 is an expansion of @xmath652 , @xmath844 .",
    "moreover , if @xmath828 is an expansion of @xmath639 , equivalent to @xmath806 , then @xmath847 is an expansion of @xmath835 .",
    "we now assume that @xmath437 is not void in @xmath652 .",
    "we need to consider several cases .",
    "* case 1*. @xmath428 and @xmath437 are both large in @xmath652 .",
    "then @xmath428 is void and @xmath437 is large in @xmath694 .    in order to build the desired @xmath805 , we split each @xmath859-source of @xmath839  into an @xmath811-source and an @xmath859-source .",
    "the @xmath811-source is linked by incoming edges to all @xmath428-ports of @xmath652 , and the @xmath859-source is linked similarly to all @xmath437-ports . in the same fashion , we split each @xmath860-source of @xmath839 into an @xmath812-source and an @xmath860-source linked by ougoing edges to all @xmath428-ports of @xmath652 and to all @xmath437-ports respectively .",
    "the term @xmath47 such that @xmath844 is the composition of the operations @xmath861 and @xmath862 .",
    "the graph @xmath805 does not contain @xmath793 , since @xmath839 does not ( by lemma  [ lemma yyy ] ) .",
    "hence @xmath805 is an expansion of @xmath652 .",
    "let now @xmath842 be an expansion of @xmath639 equivalent to @xmath805 , and let @xmath863 .",
    "it is easily verified that @xmath848 is an expansion of @xmath835 , and as above , it follows that @xmath864 .",
    "* case 2*. @xmath428 is small and @xmath437 is large in @xmath652 .    in order to build @xmath806 from @xmath839",
    ", we make the @xmath428-ports of @xmath652 into @xmath807-sources , we delete the edges between the @xmath859- and the @xmath860-sources and the @xmath428-ports of @xmath652 .",
    "the term @xmath47 which must do the opposite ( that is , construct @xmath839 from @xmath805 ) is a composition of source forgetting operations and of additions of new edges .",
    "more precisely , for each @xmath865 such that @xmath807 and @xmath866 are source labels in @xmath806 , we use the operation @xmath867 , where @xmath868 is the 2-vertex , 2-source , 1-edge graph , followed by the operations @xmath869 and @xmath870 .",
    "we then apply similar operations to create edges from the @xmath871- to the @xmath807-sources .",
    "and we finally apply the operations @xmath845 .",
    "the graph @xmath806 is a subgraph of @xmath838 ( up to source labels ) , so @xmath806 does not contain @xmath793 , and hence it is an expansion of @xmath652 .",
    "the proof continues as in the previous case .    *",
    "case 3*. @xmath437 is small and @xmath428 is large in @xmath652 .    to build @xmath806 from @xmath838",
    ", we make the @xmath437-ports of @xmath652 into @xmath872-sources , we delete the edges between the @xmath811-sources or the @xmath812-sources and the @xmath437-ports of @xmath652 .",
    "in addition we rename each @xmath811-source to an @xmath859-source , and each @xmath812-source to an @xmath860-source .",
    "we can use the same reasoning as in case 2 to conclude in this case .",
    "* case 4*. @xmath428 and @xmath437 are small in @xmath652 , and @xmath873 .    to build @xmath806 from @xmath838",
    ", we rename @xmath872 into @xmath807 whenever the @xmath872-source of @xmath839 is a @xmath428-port in @xmath652 .",
    "the term @xmath47 which does the opposite is a composition of source renamings",
    ". the graph @xmath805 does not contain @xmath793 , otherwise @xmath839 would do , since @xmath805 is equal to @xmath839 up to source labels , and hence @xmath806 is an expansion of @xmath652 .",
    "the other parts of the proof are the same .",
    "* case 5*. @xmath428 and @xmath437 are small in @xmath652 , and @xmath874 .    to build @xmath806 from @xmath838",
    ", we make the @xmath428-ports ( resp .",
    "@xmath437-ports ) of @xmath652 into @xmath807-sources ( resp .",
    "@xmath872-sources ) , we delete the edges between the @xmath859- and @xmath860-sources and the @xmath428- and @xmath437-ports of @xmath652 , and we delete the @xmath859- and @xmath860-sources .",
    "the term @xmath47 which does the opposite is a composition of additions of new edges and of @xmath875 operations , as in case 2 , see figure  [ fig : figure 2 ]",
    ". the graph @xmath805 does not contain @xmath876 , otherwise @xmath839 would too , since @xmath805 is a subgraph of @xmath839 ( up to source labels ) , and hence @xmath806 is an expansion of @xmath652 .",
    "the proof continues as in the previous cases .",
    "( 88,75)(0,-75 ) ( n0)(20.0,-16.0)@xmath652    ( n1)(66.0,-16.0)@xmath694    ( n2)(7.0,-10.0)@xmath428    ( n3)(16.0,-10.0)@xmath428    ( n4)(25.0,-10.0)@xmath437    ( n5)(34.0,-10.0)@xmath437    ( n6)(52.0,-10.0)@xmath437    ( n7)(61.0,-10.0)@xmath437    ( n8)(70.0,-10.0)@xmath437    ( n9)(79.0,-10.0)@xmath437    ( n10)(20.0,-48.0)@xmath806    ( n11)(66.0,-48.0)@xmath838    ( n12)(7.0,-42.0)@xmath877    ( n13)(16.0,-42.0)@xmath878    ( n14)(25.0,-42.0)@xmath879    ( n15)(34.0,-42.0)@xmath880    ( n16)(52.0,-42.0 )    ( n17)(61.0,-42.0 )    ( n18)(70.0,-42.0 )    ( n19)(79.0,-42.0 )    ( n20)(55.0,-28.0)@xmath881    ( n21)(73.0,-28.0)@xmath882    ( n20,n16 )    ( n20,n17 )    ( n20,n18 )    ( n20,n19 )    ( n16,n21 )    ( n17,n21 )    ( n18,n21 )    ( n19,n21 )    ( n22)(52.0,-74.0)@xmath877    ( n23)(61.0,-74.0)@xmath878    ( n24)(70.0,-74.0)@xmath879    ( n25)(79.0,-74.0)@xmath880    ( n26)(55.0,-60.0)@xmath881    ( n27)(73.0,-60.0)@xmath882    ( n26,n22 )    ( n26,n23 )    ( n26,n24 )    ( n26,n25 )    ( n22,n27 )    ( n23,n27 )    ( n24,n27 )    ( n25,n27 )    ( 38,-67 )    this concludes the proof that @xmath831 implies @xmath883 .    [ [ the - operation - otimes_j ] ] the operation @xmath647 + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    we now consider the operation @xmath647 where @xmath884 , @xmath199 and @xmath443 are disjoint .",
    "let @xmath825 in @xmath202 , @xmath885 in @xmath457 , @xmath886 and @xmath887 .",
    "we want to prove that @xmath864 .",
    "we first consider the very special case where @xmath888 , and the operation @xmath647 is simply the disjoint union .",
    "then @xmath694 contains @xmath793 if and only if @xmath652 or @xmath788 does , if and only if @xmath639 or @xmath889 does , if and only if @xmath835 does .    asuming that @xmath694 does not contain @xmath793 , an application of theorem  [ ffvv ] ensures , as for the operations of port forgetting or renaming that @xmath694 and @xmath835 satisfy the same small first - order formulas .",
    "we now consider an expansion @xmath838 of @xmath694 .",
    "it is necessarily of the form @xmath890 where @xmath805 and @xmath891 are expansions of @xmath652 and @xmath788 respectively .",
    "then there exist expansions @xmath826 and @xmath892 of @xmath639 and @xmath889 respectively , which are equivalent to @xmath805 and @xmath891 .",
    "one then verifies that @xmath893 is an expansion of @xmath835 , which is equivalent to @xmath839 .",
    "next we assume that @xmath894 is a singleton , @xmath895 , that is , @xmath896 with @xmath429 and @xmath408 .",
    "since @xmath652 and @xmath639 on one hand , and @xmath788 and @xmath889 on the other satisfy the same small first - order formulas , theorem  [ ffvv ] shows that @xmath897 contains @xmath898 if and only if @xmath899 does .",
    "assume now this is not the case and consider an expansion @xmath839 of @xmath694 .",
    "again there are several cases .",
    "note that @xmath428 and @xmath437 can not both be large in @xmath652 and @xmath788 respectively . we claim that @xmath839 can defined as @xmath900 where @xmath47 is an @xmath707-term , @xmath805 is an expansion of @xmath652 and @xmath891 is an expansion of @xmath788 . as for the other operations , we consider expansions @xmath828 and @xmath901 of @xmath639 and @xmath889 , equivalent to @xmath806 and @xmath902 .",
    "although it is a bit tedious , we verify formally that @xmath903 is an expansion of @xmath835 .",
    "it follows that @xmath848 is equivalent to @xmath838 , and hence @xmath864 .",
    "* case 1*. @xmath428 is large in @xmath652 and @xmath437 is small in @xmath788 .",
    "then @xmath694 has edges from all @xmath428-ports of @xmath652 to all @xmath437-ports of @xmath788 , which are actually @xmath872-sources in @xmath839 .",
    "for each of these @xmath872-sources , say @xmath593 , we create a new vertex @xmath904 , and each edge coming from @xmath652 to @xmath593 is redirected towards @xmath904 .",
    "we make @xmath904 into an @xmath809-source ( for some appropriate @xmath614 ) of the expansion @xmath805 of @xmath652 we are constructing .",
    "the desired expansion @xmath891 of @xmath788 is just the subgraph of @xmath839 induced by the set of vertices of @xmath788 .",
    "and @xmath805 consists of the subgraph of @xmath839 induced by the vertices of @xmath652 together with @xmath904 and all these redirected edges .",
    "then the @xmath707-term @xmath47 needs only to fuse in @xmath905 the above described @xmath809-sources with the corresponding @xmath906-sources .",
    "this can be done by a combination of the operation @xmath209 and those of the form @xmath907 .",
    "the only point to check is that @xmath805 does not contain @xmath793 .",
    "we can apply lemma  [ lemma yyy ] because @xmath839 is obtained from @xmath908 by fusions of pairs of vertices which are not adjacent and have no incoming edges with the same source ( because @xmath652 and @xmath788 are disjoint ) and no outgoing edge at all .    then there",
    "exist expansions @xmath826 and @xmath892 of @xmath639 and @xmath889 respectively , equivalent to @xmath805 and @xmath891 . by letting @xmath909",
    ", we get the desired expansion of @xmath835 , equivalent to @xmath839 .",
    "this case is illustrated in figure  [ fig : figure 3 ] , where @xmath910 and @xmath88 is the constructed expansion of @xmath911 .",
    "( 90,80)(0,-80 ) ( n0)(12.0,-24.0)@xmath652    ( n1)(34.0,-16.0)@xmath788    ( n2)(62.0,-24.0)@xmath652    ( n3)(84.0,-16.0)@xmath788    ( 53,-35)@xmath912    ( n4)(5.0,-18.0)@xmath428    ( n5)(12.0,-18.0)@xmath428    ( n6)(19.0,-18.0)@xmath428    ( n7)(28.0,-6.0)@xmath437    ( n8)(28.0,-12.0)@xmath437    ( n9)(55.0,-18.0)@xmath428    ( n10)(62.0,-18.0)@xmath428    ( n11)(69.0,-18.0)@xmath428    ( n12)(78.0,-6.0)@xmath437    ( n13)(78.0,-12.0)@xmath437    ( n9,n12 ) ( n9,n13 ) ( n10,n12 ) ( n10,n13 ) ( n11,n12 ) ( n11,n13 )    ( n14)(12.0,-72.0)@xmath806    ( n15)(34.0,-64.0)@xmath902    ( n16)(62.0,-72.0 )    ( n17)(84.0,-64.0 )    ( 70,-83)@xmath88    ( n18)(5.0,-66.0 )    ( n19)(12.0,-66.0 )    ( n20)(19.0,-66.0 )    ( n21)(2.0,-50.0)@xmath913    ( n22)(12.0,-50.0)@xmath914    ( n23)(22.0,-50.0)@xmath915    ( n24)(28.0,-54.0)@xmath916    ( n25)(28.0,-60.0)@xmath917    ( n18,n21 ) ( n18,n22 ) ( n18,n23 ) ( n19,n21 ) ( n19,n22 ) ( n19,n23 ) ( n20,n21 ) ( n20,n22 ) ( n20,n23 )    ( n26)(55.0,-66.0 )    ( n27)(62.0,-66.0 )    ( n28)(69.0,-66.0 )    ( n29)(52.0,-50.0 )    ( n30)(78.0,-54.0 )    ( n31)(78.0,-60.0 )    ( n26,n30 ) ( n26,n31 ) ( n27,n30 ) ( n27,n31 ) ( n28,n30 ) ( n28,n31 )    ( n26,n29 ) ( n27,n29 ) ( n28,n29 )    * case 2*. @xmath428 is small in @xmath652 and @xmath437 is large in @xmath788 .",
    "it is fully similar to the first case , creating new @xmath871-sources instead of @xmath809-sources .",
    "we omit the details .",
    "* case 3*. @xmath428 is small in @xmath652  and @xmath437 is small in @xmath788 .",
    "let @xmath806 be the subgraph with sources of @xmath838 consisting of the vertices of @xmath652 , and let @xmath902 be defined similarly in terms of @xmath788",
    ". then @xmath839 is obtained from @xmath908 by the addition of edges from each @xmath807-source of @xmath805 to each @xmath918-source of @xmath891 , which can be done by an @xmath707-term ( see case 2 of the discussion of the renaming operation ) .",
    "since @xmath805 and @xmath891 are subgraphs of @xmath839 , they can not contain @xmath793 and hence , they are in fact expansions of @xmath652 and @xmath788 as desired .",
    "the proof continues as above .",
    "* case 4*. @xmath428 is void in @xmath652 or @xmath437 is void in @xmath788 .",
    "then @xmath919 acts as the identity on @xmath920 , so @xmath647 acts as @xmath209 on @xmath921 and we are back to a previously studied case . recall that if @xmath428 ( resp .",
    "@xmath437 ) is void in @xmath652 ( resp .",
    "@xmath788 ) , then it is void in every @xmath98-equivalent graph with source .",
    "this concludes the study of the case where @xmath894 is a singleton in @xmath922 .",
    "the case where @xmath894 is a singleton in @xmath923 is of course similar .",
    "the proof is actually the same in the general case where @xmath894 is not a singleton .",
    "we need only do the same constructions for all elements @xmath924 in @xmath894 .",
    "the only possible difficulty could arise from the use of lemma [ lemma yyy ] to verify that the graphs @xmath805 and @xmath891 obtained from @xmath839 by the creation of vertices ( like @xmath904 in case 1 above ) and the redirection of edges do not contain @xmath793 , and hence are expansions .",
    "thus let us consider the transformation of @xmath925 into @xmath839 .",
    "it consists in a sequence of fusions of pairs of vertices .",
    "whenever we fuse an @xmath811-source of @xmath805 , say @xmath593 , with an @xmath918-source of @xmath891 , say @xmath498 , we must verify that the fusions performed previously keep the hypothesis of lemma [ lemma yyy ] valid .",
    "it is clear that @xmath593 and @xmath498 are not adjacent , since @xmath593 is adjacent with vertices of @xmath652 only . because of previous fusions",
    ", there may exist an edge from some @xmath782 in @xmath652 to @xmath498 .",
    "however , this edge comes from a previously applied operation @xmath926 with @xmath927 .",
    "it follows that there is no edge from @xmath782 to @xmath593 .",
    "an analogous argument also applies to fusions between an @xmath812-source of @xmath652 and an @xmath918-source of @xmath788 , and also when we exchange the roles of @xmath652 and @xmath788 .",
    "hence , finally , we can apply lemma  [ lemma yyy ] to deduce that @xmath805 and @xmath891 do not contain @xmath793 because @xmath839 does not .",
    "hence , they are expansions of @xmath652 and @xmath788 , as we needed to check .",
    "this concludes the proof of theorem  [ no kmm ] .",
    "we now consider some consequences of theorem  [ no kmm ] .",
    "let @xmath3 be the undirected complete bipartite graph with @xmath4 vertices , that is , @xmath3 is the undirected graph underlying @xmath780 .",
    "we say that a ( directed ) graph is _ without @xmath3 _ if its undirected underlying graph has no subgraph isomorphic to @xmath3 .",
    "we say that a graph @xmath652 is uniformly _",
    "@xmath92-sparse _ if @xmath928 for every finite subgraph @xmath694 of @xmath652 , where @xmath929 and @xmath930 are the sets of vertices and edges of @xmath694 . a set of graphs is _ uniformly @xmath92-sparse _ if each of its elements is .",
    "[ prop k - sparse ] let @xmath775 be a set of graphs , satisfying one of the following properties :    * @xmath2 is without @xmath780 for some @xmath5 * @xmath2 is without @xmath3 for some @xmath5 * @xmath2 consists only of planar graphs * @xmath2 is uniformly @xmath92-sparse for some @xmath92 * @xmath2 consists only of graphs of tree - width at most @xmath92 for some @xmath92",
    ".    then @xmath2 is @xmath0-recognizable if and only if @xmath2 is @xmath1-recognizable .    by corollary [ vr2hr ] ,",
    "it is always the case that a @xmath1-recognizable set of graphs is @xmath0-recognizable .",
    "if @xmath2 is without @xmath780 for some @xmath5 , the converse implication was proved in theorem  [ no kmm ] .",
    "lemma [ no kpp ] below shows that @xmath2 is without @xmath931 for some @xmath428 if and only if it is without @xmath780 for some @xmath5 .",
    "it is well - known that planar graphs are without @xmath932 ( planarity is a property of the underlying undirected graph , and @xmath932 is the undirected graph underlying @xmath824 ) .",
    "it follows that planar graphs are also without @xmath824 , and the result follows from theorem  [ no kmm ] .",
    "it is easily seen that @xmath933 is not @xmath92-sparse .",
    "so if @xmath2 is uniformly @xmath92-sparse , then it is without @xmath933 .",
    "finally , it is known that graphs of tree - width at most @xmath92 are uniformly @xmath934-sparse ( see for instance @xcite ) , which yields the last assertion .",
    "[ no kpp ] let @xmath428 be an integer .",
    "there exists an integer @xmath5 such that a directed graph without @xmath935 , is without @xmath3 .",
    "we use the particular case of ramsey s theorem for bipartite graphs , given as theorem 1 in @xcite .",
    "it states that for each @xmath428 , there exists an integer @xmath5 such that , if the edges of @xmath3 are partitioned into two sets @xmath77 and @xmath394 , then either @xmath77 or @xmath394 contains the edges of a subgraph isomorphic to @xmath931 .",
    "so let us assume that @xmath936 , where @xmath421 and @xmath937 are disjoint sets of @xmath5 elements and there is an edge between @xmath108 and @xmath511 ( in one or both directions ) for each @xmath938 .",
    "let @xmath77 be the set of pairs @xmath938 such that the edge is from @xmath108 to @xmath511 , and let @xmath939 .",
    "then there exist sets @xmath940 and @xmath941 , with cardinality @xmath428 , such that @xmath942 or @xmath943 . in either case",
    ", we get a subgraph of @xmath652 isomorphic to @xmath935 .",
    "note hat a quick and direct proof can be given with @xmath944 , but we do not know the minimal @xmath5 yielding the result .",
    "the statement relative to bounded tree - width sets of graphs in proposition  [ prop k - sparse ] is also a consequence ( in the case of finite graphs ) of lapoire s result @xcite , which states that , in a graph of tree - width at most @xmath92 , one can construct a width-@xmath92 tree - decomposition by monadic second - order ( mso ) formulas .",
    "this can be used to show that every @xmath0-recognizable set of graphs of bounded tree - width is definable in counting monadic second - order ( cmso ) logic , using edge set quantifications .",
    "courcelle showed @xcite that , for finite graphs of bounded tree - width , edge set quantifications can be replaced by vertex set quantifications .",
    "the considered set is therefore definable in cmso logic with vertex set quantifications only , and hence is @xmath1-recognizable by another of courcelle s results @xcite .",
    "it is proved in @xcite that every set of square grids is @xmath0-recognizable .",
    "it follows from theorem  [ no kmm ] that every such set is also @xmath1-recognizable . hence , there are uncountably many @xmath1-recognizable sets of graphs , so we can not hope for an automata - theoretic or a logical characterization of @xmath1-recognizability  in contrast with the situation prevailing for words , trees and some special classes of graphs , see @xcite .",
    "the aim of this short section is to establish the existence of @xmath0-recognizable sets which are not @xmath1-recognizable .",
    "we first establish a lemma .",
    "[ cliques hr - rec ] every set of cliques ( of the form @xmath945 , @xmath946 ) is @xmath0-recognizable .",
    "let @xmath2 be a set of undirected cliques ( recall that an undirected graph is a graph where the edge relation is symmetric ) .",
    "we provide a locally finite @xmath768-congruence on @xmath705 which saturates @xmath2 ( see section  [ sec : other variants ] ) . by proposition  [ prop : other variants ] , this establishes that @xmath2 is @xmath0-recognizable .    for each finite set @xmath79 of source labels ,",
    "let @xmath947 be the set of graphs in @xmath197 having at least one internal vertex ( i.e. , a vertex which is not a source ) , and let @xmath948 be the set of graphs in @xmath197 , in which every vertex is a source .",
    "in particular , @xmath948 is finite .",
    "let @xmath130 be the following equivalence relation on @xmath705 .",
    "we use the operation @xmath762 , as in section  [ sec : other variants ] .",
    "if @xmath949 , we let @xmath950 if and only if either @xmath951 , or @xmath952 and for every @xmath953 , @xmath954 iff @xmath955 .",
    "note that for each @xmath79 , there are only finitely many @xmath130-classes in @xmath197 ,  namely at most @xmath956 , where @xmath428 is the cardinality of @xmath948 .",
    "moreover , @xmath130 saturates @xmath2 . indeed , suppose that @xmath957 , @xmath958 and @xmath692 .",
    "let @xmath694 be the graph in @xmath197 consisting of distinct @xmath180-sources ( @xmath230 ) and no edges .",
    "then we have @xmath959 and @xmath960 .",
    "it follows from the definition of @xmath130 that @xmath961 .    finally , we check that @xmath130 is a @xmath768-congruence .",
    "let @xmath962 , with @xmath958 and @xmath963 : we want to show that @xmath964 .",
    "we observe that if both @xmath652 and @xmath694 have internal vertices , then @xmath766 is not a clique ( by definition of operation @xmath762 ) , and hence can not be in @xmath2 . the rest of the proof is a straightforward verification .",
    "we can now prove the following .",
    "there is an @xmath0-recognizable set of graphs which is not @xmath1-recognizable .",
    "let @xmath77 be a set of integers which is not recognizable in @xmath965 , for instance the set of prime numbers , and let @xmath2 be the set of cliques @xmath945 for @xmath966",
    ". then @xmath2 is @xmath0-recognizable by lemma  [ cliques hr - rec ] .",
    "we now consider a set of @xmath1-terms describing @xmath2 and using exactly 2 port labels , @xmath428 and @xmath437 .",
    "recall that @xmath447 denotes the @xmath1-constant of type @xmath448 , that is , the graph with a single vertex that is a @xmath428-port and no edges .",
    "the constant @xmath967 is defined similarly .",
    "now let @xmath968 , and @xmath969 .",
    "it is not difficult to verify that @xmath970 denotes the clique @xmath945 where all the vertices are @xmath428-ports , @xmath945 itself is denoted by the term @xmath971 , and the set @xmath788 of all @xmath1-terms of the form @xmath970 is recognizable ( as a set of terms , or trees ) .",
    "if @xmath2 is @xmath1-recognizable , then the set of @xmath1-terms in @xmath788 that denote graphs in @xmath2 is recognizable .",
    "this set consists of all the terms of the form @xmath971 with @xmath966 , and it can be shown by standard methods that it is not recognizable .",
    "it follows that @xmath2 is not @xmath1-recognizable .",
    "since graphs are relational structures , logical formulas can be used to specify sets of graphs .",
    "monadic second - order logic is especially interesting because    _ every monadic second - order definable set of finite graphs is @xmath1-recognizable ( courcelle @xcite ) .",
    "_    there is actually a version of monadic second - order logic allowing quantifications on edges and sets of edges ( one replaces the graph under consideration by its incidence graph ; we omit details ) .",
    "we say that a set is @xmath972-definable if it is definable by a monadic second - order formula with edge and edge set quantifications , and that we use the phrase @xmath973-definable to refer to the first notion .",
    "it is immediately verified ( from the definition ) that    _ every @xmath973-definable set is @xmath972-definable . _",
    "the two following statements are more difficult .    _",
    "every @xmath972-definable set of simple graphs is @xmath0-recognizable ( courcelle @xcite ) . _    _ if a set of simple graphs is uniformly @xmath92-sparse for some @xmath92 and @xmath972-definable , then it is @xmath973-definable ( courcelle @xcite ) .",
    "_    this is somewhat analogous to the situation of theorem  [ no kmm ] ( see proposition  [ prop k - sparse ] ) .",
    "however the combinatorial conditions are different : if a set of graphs is uniformly @xmath92-sparse for some @xmath92 , it is without @xmath974 for some @xmath47 , but the converse does not hold .",
    "it is proved in the book by bollobas @xcite that , for each @xmath975 , there is a number @xmath242 such that for each @xmath5 , there is a graph with @xmath5 vertices and @xmath976 edges that does not contain @xmath974 , where @xmath977 . for these graphs ,",
    "the number of edges is not linearly bounded in terms of the number of vertices , so they are not uniformly @xmath92-sparse for any @xmath92 .",
    "it is not clear how to extend courcelle s proof in @xcite , to use the condition _ without @xmath974 _ instead of _ uniformly @xmath92-sparse_.",
    "the formal setting of relational structures is very convenient to deal with simple graphs , as we have seen already .",
    "it can also be used to formalize multi - graphs ( i.e. , graphs with multiple edges ) , if we consider two - sorted relational structures .    formally , a _",
    "multi - graph with sources _ in @xmath79 is a structure of the form @xmath978 where @xmath979 is the set of vertices , @xmath980 is the set of edges , each @xmath981 is an element of @xmath979 , and @xmath982 is a ternary relation of type @xmath983 .",
    "we interpret the relation @xmath984 to mean that @xmath985 is an edge from vertex @xmath593 to vertex @xmath498 .",
    "we denote by @xmath986 the set of multi - graphs with sources in @xmath79 . as in the study of @xmath184 or @xmath701 , we assume that the finite sets of source labels @xmath79 are taken in a fixed countable set .",
    "we let @xmath987 be the union of the @xmath986 for all finite sets @xmath79 of source labels .",
    "graphs and hypergraphs with multiple edges and hyperedges are often used , see the volume edited by rozenberg @xcite . in this context , it is in fact frequent to consider operations on multi - graphs that are very similar to the @xmath0-operations on @xmath701 .",
    "more precisely , the operations of disjoint union , source renaming , source forgetting and source fusion can be defined naturally on multigraphs with sources : thus @xmath987 can be seen naturally as an @xmath0-algebra .",
    "it is clear that each simple graph in @xmath195 can be considered as an element in @xmath986 .",
    "it is important to note however that the @xmath0-operations on @xmath988 , when applied to such simple graphs , do not necessarily yield the same result as in @xmath701 .",
    "for instance , let @xmath237 be distinct elements of @xmath79 , and let @xmath989 be a simple graph .",
    "the action of fusing the @xmath242-source and the @xmath243-source of @xmath652 may now result in multiple edges : if there were arrows in both directions between @xmath990 and @xmath991 , or if there were arrows to ( resp . from ) a vertex of @xmath652 from ( resp .",
    "to ) both @xmath990 and @xmath991 .",
    "in contrast , the same operation in @xmath195 yields @xmath992 , an element of @xmath195 by definition . to avoid confusion , we will denote by @xmath993 this operation when used in @xmath987 .",
    "fortunately , we do not have this sort of problem with the other operations : applying the operations of disjoint union , source renaming or source forgetting to simple graphs considered as elements of @xmath987 yields the same result as applying the same operations within the algebra @xmath701 .",
    "we let @xmath994 be the signature on @xmath987 consisting of the operations of the form @xmath209 , @xmath244 , @xmath995 and @xmath993 .",
    "thus , @xmath987 is an @xmath994-algebra .",
    "we observe that , as a signature ( that is , as a set of symbols denoting operations ) , @xmath994 is in natural bijection with @xmath0 .",
    "so we do nt really need to introduce the new notation @xmath994 , and we could very well say that @xmath987 is an @xmath0-algebra .",
    "we simply hope , by introducing this notation , to clarify our comparative study of recognizable subsets in the algebras @xmath701 and @xmath987 .",
    "this distinction will be useful in the proofs of theorems [ l vs i(l ) rec ] and [ l vs u(l ) rec ] .    to summarize and amplify the above remarks , let us introduce the following notation .",
    "we denote by @xmath996 the natural injection . for each multi - graph @xmath652 , we denote by @xmath997 the simple graph obtained from @xmath652 by fusing multiple edges ( with identical origin and end ) : that is , @xmath108 is a mapping from @xmath987 onto @xmath701",
    ". elementary properties of @xmath998 and @xmath108 are listed in the next proposition .",
    "[ i , u morphisms ] the mapping @xmath999 is a homomorphism of @xmath0-algebras . the mapping @xmath1000 is not a homomorphism , but it commutes with the operations of the form @xmath209 , @xmath244 and @xmath240 .",
    "@xmath998 does not commutes with the operations of the form @xmath247 , but if @xmath1001 , then @xmath1002 .    finally , if @xmath1001 , then @xmath1003 and @xmath1004 .",
    "we now prove the following theorems , which describe the interaction between @xmath994-recognizability of sets of multi - graphs and @xmath0-recognizability of sets of simple graphs .",
    "[ simple graphs rec ] the set of simple graphs is @xmath994-recognizable .",
    "more precisely , for each finite set of source labels @xmath79 , @xmath1005 is @xmath994-recognizable .    [",
    "l vs i(l ) rec ] let @xmath79 be a finite set of source labels and let @xmath1006",
    ". then @xmath2 is @xmath0-recognizable if and only if @xmath1007 is @xmath994-recognizable .",
    "[ l vs u(l ) rec ]",
    "let @xmath79 be a finite set of source labels and let @xmath1008 .",
    "if @xmath2 is @xmath994-recognizable , then @xmath1009 is @xmath0-recognizable .",
    "we first introduce the notion of the type of a multi - graph : as for the elements of @xmath184 , if @xmath1010 , we let @xmath1011 be the restriction of @xmath652 to its @xmath79-sources and to the edges between them . we also denote by @xmath160 the relation on @xmath987 induced by this type mapping : two multi - graphs @xmath1012 are @xmath160-equivalent if @xmath1013 .",
    "[ zeta for multi ] the type relation @xmath160 is an @xmath994-congruence on @xmath987 .",
    "moreover , for each finite set of source labels @xmath79 , the elements of @xmath1005 can be found in only a finite number of @xmath160-classes .",
    "the result follows from the following , easily verifiable identities , where the multi - graphs @xmath652 , @xmath694 are assumed to have the appropriate sets of sources . @xmath1014",
    "the finiteness of the number of @xmath160-classes containing elements of @xmath1005 follows from the fact that there are only finitely many source - only simple graphs with sources in @xmath79 .",
    "we also introduce the following finite invariant for a simple graph @xmath989 .",
    "we define @xmath1015 to be the set of all pairs @xmath1016 of elements of @xmath79 such that @xmath1017 , @xmath1018 and there exists a vertex @xmath593 of @xmath652 with either edges from @xmath593 to both @xmath990 and @xmath991 , or edges to @xmath593 from both @xmath1019 and @xmath991 .",
    "the set @xmath1015 can be viewed as a symmetric anti - reflexive relation on @xmath79 .",
    "[ charact multi ] let @xmath652 be a simple graph in @xmath195 and let @xmath1017 be elements of @xmath79 .",
    "then @xmath1020 has multiple edges if and only if @xmath1021 or @xmath1022 has multiple edges .",
    "we first observe that @xmath1020 has multiple edges if and only if @xmath1018 and at least one of the following situations occurs : there are edges in both directions between @xmath990 and @xmath991 , or there is a vertex @xmath593 of @xmath652 with edges from ( resp . to ) both @xmath990 and @xmath991 ( this includes the case where there is a loop at @xmath990 or @xmath991 and an edge in either direction between @xmath990 and @xmath991 ) .",
    "that is , @xmath1020 has multiple edges if and only @xmath1023 or there are edges in both directions between @xmath990 and @xmath991 .",
    "we also observe that @xmath1022 is a subgraph of @xmath1020 , so the former is simple if the latter is .",
    "finally , the existence of edges in both directions between @xmath990 and @xmath991 is sufficient to ensure that @xmath1022 has multiple edges .",
    "these observations put together suffice to prove the lemma .",
    "we are now ready to prove theorem  [ simple graphs rec ] .",
    "let @xmath1024 be the following relation , defined on each @xmath986 .",
    "we let @xmath1025 if both @xmath652 and @xmath639 have multiple edges , or both @xmath652 and @xmath639 are simple graphs , @xmath1026 and @xmath1027 .",
    "it is immediate that @xmath1024 is an equivalence relation , saturating @xmath1005 .",
    "it follows from lemma  [ zeta for multi ] and from the fact that @xmath1015 is a subset of the finite set @xmath1028 , that @xmath1024 is locally finite .",
    "so we only need to show that @xmath1024 is an @xmath994-congruence .",
    "we need to describe the interaction between the mapping @xmath1029 and the @xmath994-operations .",
    "as observed in proposition [ i , u morphisms ] , all @xmath994-operations preserve simple graphs except for the operations of the form @xmath993 .",
    "assuming that @xmath1030 are simple graphs with the appropriate sets of sources , we easily verify the following :    @xmath1031    moreover , if @xmath1032 and @xmath1020 is simple ( if it is nt , its @xmath1029-image is not defined ) , then @xmath1033 consists of :    ( 1)all pairs in @xmath1015 ,    ( 2)all pairs @xmath1034 such that there are edges in @xmath1011 from @xmath242 to @xmath180 and from @xmath243 to @xmath232 , or from @xmath180 to @xmath242 and from @xmath232 to @xmath243 ,    ( 3)all pairs @xmath1035 ( resp .",
    "@xmath1036 ) such that @xmath1037 ( resp .",
    "@xmath1038 ) ,    ( 4)all pairs @xmath1035 and @xmath1036 such that there are edges in @xmath1011 between @xmath242 and @xmath243 ( in either direction ) and between @xmath242 or @xmath243 and @xmath180 ( in any direction ) .",
    "let us justify this statement : it is easy to see that all these pairs belong to @xmath1033 .",
    "in particular , @xmath1039 since , as @xmath1020 is assumed to be simple , there is no @xmath1040 such that @xmath1041 and @xmath1042 .",
    "conversely , let us consider distinct edges in @xmath1043 , from @xmath498 to @xmath593 and from @xmath782 to @xmath593 , as in figure  [ fig : distinct edges ] ( note that @xmath593 and @xmath498 may be equal ) , such that @xmath1044 and @xmath1045 for @xmath1046 .",
    "( 90,25)(0,-22 ) ( n0)(0.0,0.0)@xmath498    ( n1)(0.0,-20.0)@xmath782    ( n2)(24.0,-8.0)@xmath593    ( n3)(50.0,-8.0)@xmath782    ( n4)(78.0,-8.0)@xmath1047    ( n0,n2 )    ( n1,n2 )    ( n3,n4 )    ( n4 )    if neither @xmath593 , nor @xmath498 nor @xmath782 is the @xmath242- and @xmath243-source in @xmath639 , then we are in case ( 1 ) , _ i.e. _ , @xmath1048 . if @xmath593 is the @xmath242- and @xmath243-source in @xmath639 but neither @xmath498 nor @xmath782 is , then @xmath1049 satisfies case ( 1 ) or ( 2 ) . if @xmath498 is the @xmath242- and @xmath243-source in @xmath639 but neither @xmath593 nor @xmath782 is , then @xmath1049 satisfies case ( 3 ) .",
    "the same holds by symmetry if @xmath782 is the only one of these three vertices to be the @xmath242- and @xmath243-source in @xmath639 . finally if @xmath1050 ( resp .",
    "@xmath1051 ) and is the @xmath242- and @xmath243-source , in @xmath639 then there is an edge between the @xmath242- and the @xmath243-source in @xmath652 and @xmath1049 satisfies case ( 4 ) .",
    "the case of edges from @xmath593 to @xmath498 and to @xmath782 is symmetrical .",
    "in particular , @xmath1052 , @xmath1053 , @xmath1054 and @xmath1033 are entirely determined by @xmath1015 , @xmath1011 and @xmath1055 .",
    "let us now consider @xmath1056 in @xmath987 ( with the appropriate sets of sources ) such that @xmath1025 and @xmath1057 .",
    "if @xmath652 is not simple , then neither are @xmath639 , @xmath1058 , @xmath1059 , @xmath1060 and @xmath1020 .",
    "in particular , we have @xmath1061 , @xmath1062 , @xmath1063 and @xmath1064 .",
    "assume now that @xmath652 and @xmath694 are simple .",
    "then so are @xmath1058 , @xmath1059 and @xmath1060 , and we have seen that their @xmath1029-images are determined by @xmath1015 and @xmath1055 .",
    "since @xmath160 is an @xmath994-congruence ( lemma  [ zeta for multi ] ) , it follows that @xmath1024 is preserved by the operations @xmath209 , @xmath244 and @xmath240 .    by lemma [ charact multi ] , whether @xmath1020 is simple , is determined by @xmath1011 and @xmath1015 , and hence @xmath1020 and @xmath1065 are both non - simple ( and then @xmath1024-equivalent ) or both simple . in the latter case ,",
    "their @xmath1029-images are equal since they are both determined by @xmath1066 and @xmath1067 .",
    "thus @xmath1024 is preserved by the operation @xmath993 .",
    "this concludes the proof of theorem  [ simple graphs rec ] .",
    "recall that we want to show that for each @xmath776 , @xmath2 is @xmath0-recognizable if and only if @xmath1007 is @xmath994-recognizable .",
    "one direction is quickly established : we know from proposition  [ i , u morphisms ] that @xmath1068 .",
    "if @xmath2 is @xmath0-recognizable , then @xmath1069 is @xmath994-recognizable since @xmath108 is a homomorphism . in view of theorem  [ simple graphs rec ] , it follows that @xmath1007 is @xmath994-recognizable as well .",
    "conversely , let us assume that @xmath1007 is @xmath994-recognizable and let @xmath130 be a locally finite @xmath994-congruence on @xmath987 saturating @xmath1007 .",
    "we want to define a locally finite @xmath0-congruence @xmath98 on @xmath701 saturating @xmath2 .    for each symmetric anti - reflexive relation @xmath77 on a finite set of source labels @xmath439 and for each graph @xmath1070 ,",
    "let @xmath1071 be the graph obtained from @xmath652 by deleting the edges between the @xmath242-source and the @xmath243-source for each pair @xmath1016 in @xmath439 .",
    "let also @xmath1072 be the composition of the operations @xmath247 for all @xmath1073 , in any order .    for @xmath1074 , we let @xmath825 if @xmath1075 , @xmath1026 and , for each symmetric anti - reflexive relation @xmath77 on @xmath439 , @xmath1076 the relation @xmath98 is clearly an equivalence relation , and it is locally finite since @xmath130 and @xmath160 are .",
    "moreover , it saturates @xmath2 since @xmath692 if and only if @xmath1077 , and @xmath130 saturates @xmath1007 . the rest of the proof consists in showing that @xmath98 is an @xmath0-congruence .    [ [ the - source - renaming - operation ] ] the source renaming operation + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    let @xmath831 in @xmath1078 . then @xmath1079 . since @xmath130 is a congruence and in view of proposition  [ i , u morphisms ] , @xmath1080 .",
    "it also follows from lemma [ ffvv light ] that @xmath1081 .",
    "let us now consider a symmetric anti - reflexive relation @xmath77 on the set of source labels of @xmath1060 .",
    "it is easily verified that @xmath1082 where @xmath1083 .",
    "we also note that if @xmath1084 , then @xmath1085 and @xmath240 commute .",
    "moreover @xmath1086 and @xmath1087 . thus @xmath1088 .",
    "now , using the fact that @xmath998 commutes with @xmath995 we have @xmath1089 since @xmath130 is an @xmath994-congruence , it follows that @xmath1090 and , finally , that @xmath1091 .",
    "[ [ the - source - forgetting - operation ] ] the source forgetting operation + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    the proof is the same as for the source renaming operation , with this simplifying circumstance that @xmath1092 and @xmath1093 ( since @xmath242 is not a source label of @xmath1059 , and hence does not occur in @xmath77 ) .    [ [ the - source - fusion - operation ] ] the source fusion operation + + + + + + + + + + + + + + + + + + + + + + + + + + +    let @xmath831 in @xmath1078 .",
    "here it is not immediate that @xmath1094 .",
    "however , if we let @xmath1095 , we know that @xmath1096 we note that @xmath1097 is equal to @xmath992 if @xmath652 has no edge between its @xmath242- or @xmath243-source , or if it has a loop at either .",
    "otherwise , @xmath992 is equal to @xmath1097 with a loop added to its @xmath242-source , that is : @xmath1098 where @xmath1099 and @xmath1100 are source labels not in @xmath439 and @xmath980 is the graph in @xmath1101 with 2 vertices and a single edge from its @xmath1099-source to its @xmath1100-source .    observe also that the existence of loops at , or edges between the @xmath242- and @xmath243-source of @xmath652 is a condition that depends only on @xmath1011 , so it will be satisfied by both @xmath652 and @xmath639 or by neither .",
    "in the first case , where @xmath1102 , we find immediately that @xmath1103 . in the second case ,",
    "the same @xmath130-equivalence is derived from proposition  [ i , u morphisms ] and equation ( @xmath1104 ) above .    by lemma [ ffvv light ] ,",
    "@xmath160-equivalence is preserved by the operation @xmath247 .",
    "now let @xmath77 be a symmetric anti - reflexive relation on @xmath439 : we consider the graph @xmath1105 .",
    "our first observation is that @xmath1106 where @xmath1107 next , we observe that @xmath1108 .",
    "thus we have @xmath1109 and hence @xmath1110 .",
    "it follows that @xmath1111 .",
    "[ [ the - disjoint - union - operation ] ] the disjoint union operation + + + + + + + + + + + + + + + + + + + + + + + + + + + +    let @xmath831 in @xmath195 and @xmath832 in @xmath1078 ( where @xmath79 and @xmath439 are disjoint ) .",
    "since @xmath998 and @xmath160 preserve @xmath209 , we have @xmath1112 and @xmath1113 .",
    "now let @xmath77 be a symmetric anti - reflexive relation on @xmath1114 .",
    "let @xmath443 ( resp .",
    "@xmath171 ) be the restriction of @xmath77 to @xmath79 ( resp .",
    "@xmath439 ) and let @xmath1115 .",
    "it is easily verified that @xmath1116 it now follows from proposition  [ i , u morphisms ] that @xmath1117 thus @xmath1118 , and hence @xmath1119 .",
    "this concludes the proof of theorem  [ l vs i(l ) rec ] .",
    "let @xmath1120 be @xmath994-recognizable , and let @xmath130 be a locally finite @xmath994-congruence saturating @xmath2 .",
    "we want to show that @xmath1009 ( a subset of @xmath195 ) is @xmath0-recognizable .",
    "let @xmath1121 .",
    "we let @xmath1122 if , for each @xmath1123 , there exists @xmath1124 such that @xmath1125 , and symmetrically , for each @xmath1124 , there exists @xmath1123 such that @xmath1125 .",
    "the relation @xmath98 is easily seen to be a locally finite equivalence relation on @xmath701 , saturating @xmath1009 . there remains to see that @xmath98 is an @xmath0-congruence .",
    "we first establish the following lemma .",
    "[ for 6.4 ] let @xmath1126 and let @xmath1127 .",
    "* @xmath1128 if and only if there exist multi - graphs @xmath1129 such that @xmath1130 , @xmath1131 and @xmath1132 . * @xmath1133 if and only if there exists a multi - graph @xmath835 such that @xmath1134 and @xmath1131 . * @xmath1135 if and only if there exists a multi - graph @xmath835 such that @xmath1136 and @xmath1131 . * @xmath1137 if and only if there exists a multi - graph @xmath835 such that @xmath1138 and @xmath1139 .",
    "recall that @xmath652 and @xmath997 have the same set of vertices , and each edge @xmath985 of @xmath997 arises from the identification @xmath1140 edges of @xmath652 between the same vertices .",
    "if @xmath1128 , each edge of @xmath997 is in exactly one of @xmath694 and @xmath788 .",
    "let @xmath835 ( resp .",
    "@xmath889 ) be the graph obtained from @xmath694 ( resp .",
    "@xmath788 ) by replacing each edge @xmath985 by @xmath1141 parallel edges",
    ". then @xmath1142 , @xmath1131 and @xmath1132 , as required .",
    "the proof of the statements relative to the operations @xmath244 and @xmath240 is done in the same fashion .",
    "let us finally consider the case where @xmath1137 .",
    "if @xmath1143 , that is , @xmath1144 , then @xmath1145 and we can let @xmath1146 .    if @xmath1147 , we let @xmath835 be obtained from @xmath694 be obtained from @xmath694 as follows : for each vertex @xmath593 , each edge @xmath985 from @xmath593 to @xmath498 ( @xmath1148 ) is replaced by @xmath1141 parallel edges , and the edges from @xmath593 to @xmath242 and @xmath243 are duplicated to a total of @xmath1141 edges .",
    "we can now conclude the proof of theorem  [ l vs u(l ) rec ] , by proving that @xmath98 is an @xmath0-congruence .",
    "let @xmath831 and @xmath1149 .",
    "let @xmath1150 .",
    "by lemma  [ for 6.4 ] , @xmath1151 for some @xmath1152 and @xmath1153 . since @xmath831 and @xmath832 , there exist @xmath1154 and @xmath1155 such that @xmath1156 and @xmath1157 .",
    ". then @xmath1159 and @xmath1160 .",
    "by symmetry , this shows that @xmath1161 .",
    "the verification that @xmath98 is preserved by the other @xmath0-operations proceeds along the same lines .",
    "this concludes the proof of theorem  [ l vs u(l ) rec ] .",
    "the class @xmath194 , defined in section  [ sec rel structures ] , has already been discussed in terms of the signatures @xmath275 , @xmath1 and @xmath0 since it is a domain in each of the three algebras @xmath184 , @xmath426 and @xmath701 . in this section ,",
    "we consider a different set of operations on @xmath194 , arising from the theory of the modular decomposition of graphs , which makes @xmath194 an algebra ( one - sorted for a change ! ) .",
    "this algebraic framework was considered by the authors , in @xcite and @xcite .",
    "we first recall the definition of the composition operation on graphs .",
    "let @xmath694 be a graph with vertex set @xmath1162 = \\{1,\\ldots , n\\}$ ] ( @xmath1163 ) .",
    "if @xmath1164 are graphs , then the composite @xmath1165 is obtained by taking the disjoint union of the graphs @xmath1166 , and by adding , for each edge @xmath1167 of @xmath694 where @xmath523 , an edge from every vertex of @xmath1168 to every vertex of @xmath1169 .",
    "we say that a graph is _ indecomposable _ , or _ prime _ ,",
    "if it can not be written non - trivially as a composition ( a composition is trivial if each of its arguments is a singleton ) .",
    "it is easily verified that if @xmath694 and @xmath835 are isomorphic graphs , then the corresponding composition operations yield isomorphic graphs .",
    "so we fix a set @xmath1170 of representatives of the isomorphism classes of indecomposable graphs .",
    "in particular , we may assume that every graph in @xmath1170 has a vertex set of the form @xmath1162 $ ] for some @xmath1163 .",
    "we also denote by @xmath1170 the resulting _ modular signature _ , consisting of the composition operations defined by these graphs .",
    "the @xmath1170-algebra of graphs is denoted by @xmath1171 .",
    "it turns out that every finite graph admits a _ modular decomposition _",
    ", that is , it can be expressed from the single - vertex graph using only operations from @xmath1170 .",
    "this fact has been rediscovered a number of times in the context of graph theory and of other fields using graph - theoretic representations .",
    "we refer to @xcite for a historical survey , and to @xcite for a concise presentation .",
    "in other words , @xmath194 is generated by the signature @xmath1170 augmented with the constants @xmath1172 and @xmath1173 , which denote a single vertex graph , respectively with and without a single loop edge .",
    "the modular decomposition of a graph is unique up to certain simple ( equational ) rules , see for instance @xcite .",
    "moreover , the modular decomposition of a graph can be computed in linear time @xcite .",
    "our first results connect @xmath1-recognizability and @xmath1170-recognizability .",
    "[ vr - f ] every @xmath1-recognizable set of graphs is @xmath1170-recognizable .    in view of proposition  [ easy recog facts ] and theorem  [ thm vr equivalence ] , it suffices to show that every operation in @xmath1170 is @xmath1174-derived .    for each integer @xmath139 ,",
    "let @xmath1175 be the unary operation on @xmath426 , of type @xmath1176 , defined as follows : given a graph without ports , it simply marks every vertex with port label @xmath139 ( leaving the set of vertices and the edge relation unchanged ) .",
    "note that @xmath1175 is a qfd unary operation , and hence a @xmath1174-operation .",
    "let @xmath694 be an @xmath5-ary operation , that is , a graph in @xmath1170 with vertex set @xmath1162 $ ] , and let @xmath1177 be its edge relation . if @xmath1166 are finite graphs , the construction of @xmath1165 can be described as follows :    - construct the disjoint union , @xmath1178 , an element of @xmath1179)$ ] ;    - apply ( in any order ) to this disjoint union the operations @xmath1180 for all @xmath1181 $ ] such that @xmath1167 is an edge of @xmath694 and @xmath523 ;    - forget all ports , that is , apply the operation @xmath1182 .",
    "this completes the verification that the operation defined by @xmath694 can be expressed as a @xmath1174-term , and hence the proof .",
    "the following result shows that the converse of proposition  [ vr - f ] does not hold .",
    "every set of prime graphs is @xmath1170-recognizable , and there is a set of prime graphs which is not @xmath1-recognizable .    let @xmath2 be a set of prime graphs , and let @xmath130 be the relation on @xmath194 defined as follows . we let @xmath1183 if one of the following holds :    * neither @xmath652 nor @xmath694 is prime ; * @xmath652 and @xmath694 are both ( the graph with one vertex and no edge ) ; * @xmath652 and @xmath694 are both not , prime and in @xmath2 ; * @xmath652 and @xmath694 are both not , prime and not in @xmath2 .",
    "this is clearly an equivalence relation with four classes , which saturates @xmath2 .",
    "moreover , @xmath130 is an @xmath1170-congruence .",
    "indeed , let @xmath788 be a graph with @xmath5 vertices ; for @xmath1184 , let @xmath1185 for each @xmath139 .",
    "if for some @xmath139 , @xmath1186 , then @xmath1187 , and neither @xmath1188 nor @xmath1189 is prime : therefore they are equivalent .",
    "otherwise , @xmath1190 for each @xmath139 , @xmath1191 and @xmath1192 are both equal to @xmath788 , and hence they are equivalent .",
    "this concludes the proof that every set of prime graphs is @xmath1170-recognizable .",
    "before we exhibit a set of prime graphs which is not @xmath1-recognizable , we define inductively a sequence of @xmath1-terms written with three port labels @xmath1193 .",
    "we let @xmath1194 the term @xmath1195 ( forgetting all port labels in @xmath1196 ) denotes the string graph @xmath1197 , with @xmath1198 vertices , say @xmath1199 and edges from @xmath139 to @xmath1200 for each @xmath1201 .",
    "each of these graphs is prime .",
    "now let @xmath77 be a set of positive integers that is not recognizable in @xmath965 and let @xmath2 be the set of all terms @xmath1202 with @xmath966 . from the above discussion , we know that @xmath2 is @xmath1170-recognizable . if @xmath2 was @xmath1-recognizable , standard arguments would show that the set of @xmath1-terms @xmath1196 ( @xmath966 ) would be recognizable as well , and it would follow that @xmath77 is recognizable , contradicting its choice .",
    "now let @xmath7 be a finite subsignature of the modular signature @xmath1170 .",
    "a graph which can be constructed from one - vertex graphs using only operations from @xmath7 is called an @xmath7-graph . the next result deals with sets of @xmath7-graphs .",
    "this finiteness condition ( the elements of @xmath2 are built by repeated composition of a finite number of graph - based operations ) is non - trivial .",
    "in fact , for many natural classes of graphs such as rectangular grids , it is not satisfied : since grids are indecomposable , a set of graphs containing infinitely many grids can not satisfy our finiteness condition .",
    "but that condition is satisfied by other classical classes ( e.g. cographs , series - parallel posets ) , see @xcite .",
    "using results of courcelle @xcite , we can show the following result , which yields in particular a weak converse of proposition  [ vr - f ] .    [ fsvr ]",
    "let @xmath7 be a finite subsignature of @xmath1170 and let @xmath2 be a set of @xmath7-graphs .",
    "the following properties are equivalent :    1 .",
    "@xmath2 is @xmath275-recognizable ; 2 .",
    "@xmath2 is @xmath1-recognizable .",
    "@xmath2 is @xmath1170-recognizable .",
    "@xmath2 is @xmath7-recognizable .",
    "the equivalence of ( 1 ) and ( 2 ) can be found in theorem  [ thm vr equivalence ] .",
    "proposition  [ vr - f ] shows that ( 2 ) implies ( 3 ) . and ( 3 ) implies ( 4 ) as an immediate consequence of proposition  [ easy recog facts ] since @xmath7 is a subsignature of @xmath1170 . the fact that ( 4 ) implies ( 1 ) is a consequence of two results of courcelle : ( * ?",
    "* theorem 4.1 ) , which states that if a set of @xmath7-graphs is @xmath7-recognizable , then it is definable in a certain extension of @xmath1203-logic ; and ( * ? ? ?",
    "* theorem 6.11 ) , which states that all sets definable in this logical language are @xmath275-recognizable .",
    "theorem  [ fsvr ] states that for sets of graphs with only finitely many prime subgraphs , all four notions of recognizability are equivalent .",
    "presented in this fashion , the statement is somewhat similar to that of theorem  [ no kmm ] .",
    "in this article , we have investigated the recognizability of sets of graphs quite in detail , focusing on the robustness of the notion , which was not immediate since many signatures on graphs can be defined .",
    "although we had in mind sets of graphs , we have proved that embedding graphs in the more general class of relational structures does not alter recognizability .",
    "we have proved that the very same structural conditions that equate @xmath1-equational and @xmath0-equational sets of graphs , also equates @xmath0-recognizability and @xmath1-recognizability .",
    "summing up , we have defined a number of tools for handling recognizability .",
    "some questions remain to investigate .",
    "@xmath1204when is it true that a quantifier - free operation preserves recognizability ?",
    "results in this direction have been established in courcelle @xcite .",
    "are they applicable to quantifier - free definable operations ?",
    "in particular , is it true that the set of disjoint unions of two graphs , one from each of two @xmath1-recognizable sets is @xmath1-recognizable ?",
    "@xmath1204which quantifier - free definable operations can be added to the signature @xmath0 , in such a way that the class of @xmath0-recognizable sets is preserved ( as is the case when we extend @xmath1 to @xmath1174 ) ?",
    "the paper by blumensath and courcelle @xcite , which continues the present research , considers unary non qfd operations that can be added to @xmath577 and to @xmath184 while preserving the classes of equational and recognizable sets .",
    "@xmath1204our example of an @xmath0-recognizable , not @xmath1-recognizable set of cliques , is based on the weakness of the parallel composition of graphs with sources , i.e. , the fact that this operation is not able to split large cliques . can one find another example , based on a different argument ?",
    "if one can not , what does this mean ?",
    "we conclude with an observation concerning the finiteness of signatures . whereas all finite words on a finite alphabet can be generated by this alphabet and only one operation , dealing with finite graphs ( by means of grammars , automata and related tools )",
    "requires infinite signatures .",
    "more precisely , one needs infinitely many operations to generate all finite unlabelled graphs ( see remark  [ economical ] below ) . on the other hand , applications to testing graph properties require the consideration of algebras generated by a finite signature .",
    "here is the reason .",
    "let @xmath23 be an @xmath7-algebra of graphs . if the unique valuation homomorphism @xmath1205 ( which evaluates a term into an element of @xmath23 ) is surjective , i.e. , if @xmath7 generates @xmath23 , then a subset @xmath2 of @xmath23 is recognizable if and only if @xmath90 is a recognizable set of terms ( see proposition  [ easy recog facts ] and section  [ significance ] ) . and the membership of a term in a recognizable set can be verified in linear time by a finite deterministic ( tree ) automaton .",
    "hence the membership of a graph @xmath652 in @xmath2 can be checked as follows :    \\(1 ) one must first find some term @xmath47 such that @xmath1206 ,    \\(2 ) then one checks whether @xmath47 belongs to @xmath90 .    the latter step can be done in time proportional to the size of @xmath47 , usually no larger than the number of vertices of @xmath652 .",
    "although any term @xmath47 with value @xmath652 gives the correct answer , it may be difficult to find at least one ( graph parsing problems may be @xmath670-complete ) .    because of this fact many hard problems ( in particular if they are expressed in monadic second - order logic ) can be solved in linear time on sets of graphs of bounded tree - width , and also on sets of graphs of bounded clique - width , provided the graphs are given with appropriate decompositions , see courcelle @xcite , courcelle and olariu @xcite or downey and fellows @xcite .",
    "if the decompositions are not given , one can achieve linear time for graphs of bounded tree - width and @xmath972 problems using a result by bodlaender @xcite , and polynomial time for graphs of bounded clique - width and @xmath973 problems using a result by oum and seymour @xcite .",
    "however , even if @xmath7 is infinite or is finite without generating the set @xmath23 , recognizability remains interesting as an algebraic concept , and for every restriction to a finitely generated subset of @xmath23 , we are back to the `` good '' case of a finitely generated algebra .",
    "finally , we think that infinite signatures can be used for checking graph properties defining recognizable sets .",
    "this will not be possible by _ finite _ tree - automata if the graph algebra is not finitely generated , but it can perhaps be done with automata using `` oracles '' .",
    "an oracle would be a subroutine handling some verifications for big subgraphs that can not be decomposed by the operations under consideration .",
    "this idea needs of course further elaboration .",
    "[ economical ] we asserted above that finite unlabelled graphs can not be generated with a finite signature .",
    "this is not entirely correct , and we briefly describe here a signature with 6 operations on a 2-sorted algebra which generates , somewhat artificially , all finite graphs ( undirected and without loops ) .",
    "these operations have no good behaviour with respect to automata and verification questions , and such an `` economical '' generation of graphs is useless .",
    "the 2 sorts are @xmath1207 , the set of finite graphs equipped with a linear order of their vertex set , and @xmath1208 , the set of ordinary , unordered graphs .",
    "there is one unary operation of type @xmath1209 , which forgets the order on the vertex set .",
    "all other operations are unary , of type @xmath1210 : one consists in adding one new vertex , to be the new least element ; one adds an ( undirected ) edge between the two least vertices ; one performs a circular shift of the vertices ; and one swaps the two least vertices .",
    "the three last operations leave the graph unchanged if it has less than 2 vertices .",
    "finally , one adds a 6th , nullary operation , of type @xmath1207 : the constant @xmath487 , standing for the empty graph with no vertices .",
    "in this appendix , we discuss some equivalences and transformations of logical formulas which can be used to give upper bounds for the index of congruences considered in this paper , and to complete the proof of the effectiveness of certain notions ( e.g. quantifier - free definition schemes ) .    more specifically , we make precise in what sense we can state , as we do in the body of the paper , that the set of first - order ( resp .",
    "monadic second - order ) formulas over finite sets of relations , constants and free variables , and with a bounded quantification depth , can be considered as finite . moreover ,",
    "explicit upper bounds on the size of these finite sets are derived , which can be used to justify the termination of some of our algorithms , and in evaluating their complexity . that these upper bounds have unbounded levels of exponentiation is not unexpected , and even unavoidable by frick and grohe @xcite .",
    "let @xmath1211 be boolean variables and let @xmath1212 be the set of boolean formulas written with these variables .",
    "it is well known that @xmath1212 is finite up to logical equivalence .",
    "for further reference , we record the following more precise statement .",
    "we let @xmath1213 be the set of boolean formulas in disjunctive normal form , where in each disjunct , variables occur at most once and in increasing order , no two disjuncts are equal , and disjuncts are ordered lexicographically .",
    "these constraints guarantee the announced cardinality of @xmath1213 ; the rest of the proof is classical .",
    "let us consider finite sets @xmath171 and @xmath79 , of relational symbols and of constants ( nullary relations , source labels ) as in section  [ sec rel structures ] . recall that , if @xmath64 is a finite set , @xmath1215 denotes the set of first - order formulas in the language of @xmath174-structures , with free variables in @xmath64 .",
    "for unproved results in this section , we refer the reader to @xcite .",
    "several notions of semantic equivalence of formulas can be defined . if @xmath1216 , say that @xmath1217 if for every @xmath174-structure @xmath111 and for every assignment of values in @xmath111 to the elements of @xmath64 , @xmath1218 and @xmath1219 are both true or both false .",
    "say also that @xmath1220 if the same holds for every finite or countable @xmath174-structure @xmath111 , and @xmath1221 if @xmath111 is restricted to being finite .",
    "the equivalences @xmath130 and @xmath1222 coincide by the lwenheim - skolem theorem . indeed this theorem states that if a closed formula has an infinite model , then it has one of each infinite cardinality : to prove our claim , it suffices to apply it to the formula @xmath1223 .",
    "we note that this equivalence can not be extended to monadic second - order formulas : there exists an ms formula with a unique model , isomorphic to the set of integers @xmath1224 with its order .",
    "the equivalence @xmath130 ( or @xmath1222 since we consider only first - order formulas ) is semi - decidable : by gdel s completeness theorem , @xmath1225 if and only if the formula @xmath1226 has a proof , which is a recursively enumerable property .",
    "trakhtenbrot proved that one can not decide whether a first - order formula is true in every finite structure , thus proving that @xmath1227 is not decidable .",
    "however , the negation of @xmath1227 is semi - decidable : if @xmath1228 , a counter - example can be produced by exploring systematically all finite @xmath174-structures .",
    "this is a proof also that @xmath130 and @xmath1227 do not coincide .",
    "if @xmath1230 , and if @xmath1231 , we denote by @xmath1232 the formula in @xmath1215 obtained by replacing each occurrence of @xmath1233 in @xmath243 by @xmath1234 .",
    "it is clear that if @xmath243 and @xmath1235 are equivalent boolean formulas , then @xmath1236 .",
    "a _ boolean transformation step _ consists in replacing in a first - order formula , a sub - formula of the form @xmath1232 by the equivalent formula @xmath1237 , where @xmath1238 are equivalent",
    ". then we let @xmath1229 if @xmath1218 can be transformed into @xmath1219 by a sequence of boolean transformation steps and of renaming of bound variables .",
    "it is clear that if @xmath1229 , then @xmath1239 . we want to show that each first - order formula is effectively equivalent to an @xmath83-equivalent formula of the same quantifier height , and to give an upper bound on the number of @xmath83-equivalence classes of formulas of a given height .",
    "let @xmath1240 be the set of quantifier - free formulas in @xmath1215 .",
    "such formulas are boolean combinations of atomic formulas .",
    "let @xmath1241 be the set of these atomic formulas .",
    "note that each atomic formula is either of the form @xmath1050 , where @xmath593 and @xmath498 are in @xmath1242 , or @xmath1243 where @xmath216 is a @xmath173-ary relation in @xmath171 and the @xmath169 are in @xmath1244 . letting @xmath1245 and @xmath1246",
    ", it is easily verified that    @xmath1247 we let @xmath1248 be this function .",
    "note that if we allow for the ( effective ) syntactic simplifications of identifying the formulas of the form @xmath1249 with the constant @xmath264 , and of identifying the formulas @xmath1050 and @xmath1250 , we can lower the value of @xmath1248 to @xmath1251 .",
    "[ red qf ] there exists a subset @xmath1252 of @xmath1240 , of cardinality @xmath1253 , such that every formula in @xmath1240 can be effectively transformed to an @xmath83-equivalent formula in @xmath1252 .    by definition of quantifier - free formulas",
    ", @xmath1240 is the set of all formulas of the form @xmath1232 , where @xmath243 is a boolean formula and the @xmath1234 are atomic formulas .",
    "now let @xmath1252 be the set of all formulas of the form @xmath1232 , where @xmath1254 and the @xmath1234 are pairwise distinct atomic formulas .",
    "the proof of the precise statement is now immediate , using proposition  [ red bool ] .",
    "let us consider graphs with sources , so that @xmath171 consists of a single , binary edge relation",
    ". then @xmath1255 and @xmath1256 .",
    "thus the type equivalence @xmath160 ( see section  [ sec elementary properties ] and lemma [ type equivalence ] ) has at most @xmath1257 classes in @xmath195 .",
    "[ remark a4 ] again , we are not claiming that the set @xmath1252 is as small as possible .",
    "on quantifier - free formulas , the equivalence @xmath130 is decidable , because @xmath1239 is false if and only if the closed formula @xmath1258 is satisfiable , and the satisfiability problem for existential formulas in prenex normal form is decidable ( see @xcite ) . thus one can modify proposition  [ red qf ] by letting @xmath1252 be the set of lexicographically minimal formulas in each @xmath130-class : the same statement of proposition  [ red qf ] would then hold with @xmath130 instead of @xmath83 .",
    "in particular , the transformation would still be effective , although very inefficient .",
    "it is not clear whether the cardinality of the new set of reduced quantifier - free formulas would be significantly smaller .",
    "recall that the quantifier depth of a first - order formula is the maximal number of nested quantifiers .",
    "if we let @xmath1259 be the set of formulas in @xmath1215 of quantifier depth at most @xmath92 , a formal definition is as follows : @xmath1260 and , for each @xmath1261 , @xmath1262 is the set of boolean combinations of formulas in @xmath1263 using the same recursion , let us define sets of `` reduced '' formulas of every quantifier depth .",
    "first we fix an enumeration of the countable set of variables .",
    "next , we let @xmath1264 . for each @xmath1265",
    ", we then let @xmath1266 be the set of formulas of the form @xmath1232 where @xmath1267 and the @xmath1234 s are in @xmath1268      let @xmath1270 and @xmath1246 , let @xmath1271 be the cardinality of @xmath1269 , and let @xmath1272 be the cardinality of @xmath1273 .",
    "it is elementary to verify that these functions can be bounded as follows : @xmath1274      since there is a procedure to transform each first - order formula into an @xmath83-equivalent formula in `` reduced form '' , we can consider a new equivalence relation on first - order formulas : to yield the same reduced formula .",
    "this equivalence is decidable and it refines @xmath83 ( and hence @xmath130 ) .    in proposition [ red fo ] , we can still consider replacing each formula by the lexicographically least equivalent formula , but this method is not effective , since the equivalence of first - order formulas is not decidable .",
    "a very similar analysis can be conducted for monadic second - order formulas of bounded quantifier depth .",
    "one difference is that the lwenheim - skolem theorem does not hold for these formulas , so the semantic equivalence of formulas based on coincidence on all finite or countable models does not imply coincidence on all models .",
    "moreover , since there is no complete proof systems for such formulas , the equivalences @xmath130 and @xmath1222 are not semi - decidable .    for the rest , one can follow the same techniques as above , to prove the following result .",
    "we denote by @xmath1275 the set of monadic second - order formulas of quantification depth @xmath92 in the language of @xmath174-structures , with their first- and second - order free variables in @xmath937 .    for every finite @xmath1276 , one can construct a finite subset @xmath1277 of @xmath1275 such that , for every formula in @xmath1275 , one can construct effectively an @xmath130-equivalent formula in @xmath1277 .                                  , the expression of graph properties and graph transformations in monadic second order logic . in : g. rozenberg ( ed . ) _ handbook of graph grammars and computing by graph transformations _",
    "1 , chapter 5 . world scientific , 1997 , 313 - 400 ."
  ],
  "abstract_text": [
    "<S> once the set of finite graphs is equipped with an algebra structure ( arising from the definition of operations that generalize the concatenation of words ) , one can define the notion of a recognizable set of graphs in terms of finite congruences . </S>",
    "<S> applications to the construction of efficient algorithms and to the theory of context - free sets of graphs follow naturally . </S>",
    "<S> the class of recognizable sets depends on the signature of graph operations . </S>",
    "<S> we consider three signatures related respectively to hyperedge replacement ( @xmath0 ) context - free graph grammars , to vertex replacement ( @xmath1 ) context - free graph grammars , and to modular decompositions of graphs . </S>",
    "<S> we compare the corresponding classes of recognizable sets . </S>",
    "<S> we show that they are robust in the sense that many variants of each signature ( where in particular operations are defined by quantifier - free formulas , a quite flexible framework ) yield the same notions of recognizability . </S>",
    "<S> we prove that for graphs without large complete bipartite subgraphs , @xmath0-recognizability and @xmath1-recognizability coincide . </S>",
    "<S> the same combinatorial condition equates @xmath0-context - free and @xmath1-context - free sets of graphs . </S>",
    "<S> inasmuch as possible , results are formulated in the more general framework of relational structures .    </S>",
    "<S> the recognizability of sets of graphs    .5 cm    is a robust property    .5 cm    bruno courcelle , pascal weil </S>"
  ]
}