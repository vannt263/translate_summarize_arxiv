{
  "article_text": [
    "the extraction of expectation values and properties of quantum systems whose operator does not commute with the hamiltonian has been a significant hurdle in the widespread adoption of projector quantum monte carlo methods for many years@xcite .",
    "these include important physical properties such as the dipole or higher electrical moments , as well as particle distribution functions , forces and higher derivatives of nuclei position , static correlation functions , quantum entropy estimators and various order parameters in the condensed phase .",
    "as such , their reliable and unbiased computation within the projector quantum monte carlo ( qmc ) framework is an active and important research area@xcite . within continuum diffusion monte carlo and its variants , there exist techniques to unbias these quantities such as ` forward - walking ' and its variants@xcite , reptation quantum monte carlo@xcite , and hellmann ",
    "feynman sampling@xcite , all of which have drawbacks regarding the additional computational effort they require .",
    "recently , the full configuration interaction quantum monte carlo method ( fciqmc ) has been introduced as a projector qmc technique formulated within the second quantized algebra of arbitrary ( antisymmetrized ) hilbert spaces .",
    "this method relies on the fact that , as opposed to continuum approaches , the space is finite ( although exponentially large ) and therefore can employ annihilation ( cancellation ) processes between walkers of different signs in order to overcome the fermion sign problem@xcite .",
    "additional systematically improvable approximations have also been introduced to the method to allow for a large reduction in computational effort , while nevertheless converging in the limit of large sampling to exact results within the basis employed@xcite .",
    "furthermore , there is significant empirical evidence that the computational effort required for the sampling of many systems scales sub - linearly with the size of the hilbert space as systems grow in size and complexity@xcite .",
    "this has allowed for near - exact results to be obtained within systematically improvable random error bars with substantially less computational effort than an iterative diagonalization approach to the problem .",
    "this has allowed for large molecular@xcite , solid state@xcite and model hamiltonians@xcite to be investigated with the technique .",
    "however , studies to date have primarily focused on properties of systems related to total energy differences , such as ionization potentials , electron affinities , potential energy surfaces and equations of state , all of which can be computed in an unbiased fashion through calculation of a _ projected _ energy expression .",
    "this relies on the fact that for an eigenstate @xmath0 , with energy @xmath1 , this energy can be reproduced from @xmath2 for any function @xmath3 with a non - zero overlap with @xmath0 . however , to extend the scope of the method , it is necessary to be able to extract unbiased properties from the sampled wavefunctions , for operators which do not commute with the hamiltonian , such as those which are a function of position .",
    "in these cases , eq .",
    "[ eqn : proje ] will not be sufficient if the operator of interest has a different set of eigenstates@xcite .",
    "formally , these properties can be derived from the presence of a perturbing operator to the hamiltonian , @xmath4 , as @xmath5 where @xmath6 is the strength of the perturbation . the relevant expectation value associated with @xmath4",
    "can then be obtained by calculating the analytical ( or numerical ) gradient of the energy with respect to the perturbation strength , at zero perturbation  @xcite , @xmath7 in the case of stationary wavefunctions , which is the case ( on average ) in fciqmc , the hellmann ",
    "feynman theorem@xcite reduces this to the calculation of a _ pure _ expectation value of the operator , @xmath4 , as @xmath8 equivalently , this can be written as the trace of @xmath4 with the appropriate rank reduced density matrix for the number of coupled particles in @xmath4 . in continuum approaches ,",
    "the sampled distribution consists of the desired wavefunction multiplied by a trial wavefunction@xcite , whereas in fciqmc , a single ( pure ) wavefunction distribution is sampled @xcite .",
    "however , this does not remove an inherent bias from these expectation values , which fundamentally arises from the difficulty in evaluating quadratic functionals of stochastically sampled wavefunctions@xcite , as found in eq .",
    "[ eqn : pureex ] .",
    "strictly , a similar bias arises even in naive accumulations of the projected energy estimator of eq .  .",
    "this is because the ratio of the sampled wavefunction distributions has a finite covariance which needs to be properly accounted for when calculating the quantity@xcite .    in this paper , we describe the source of this bias for quadratic functionals , before demonstrating a way to sample one- and two - body reduced density matrices ( rdms ) of the sampled wavefunction within the fciqmc dynamic in an unbiased fashion , with only small additional computational overheads .",
    "this allows for calculation of _ pure _ expectation values and quantities of interest via a trace of the resultant @xmath9-representable reduced density matrices with the appropriate operator@xcite .",
    "the accumulation of the one- and two - body rdms therefore allows for access to one- and two - body expectation values of the wavefunction , assuming that the appropriate operator can be projected into the space .    indeed , the energy is also a two - body expectation value ( of the hamiltonian ) , and therefore an alternative , variational estimate of the energy is also accessible from the two - body rdm .",
    "there may be significant advantages to an accurate computation of this quantity , despite the availability of the projected estimate ( eq .",
    "1 ) , since the pure estimate does not rely on a good quality trial wavefunction in order to obtain a large overlap with the true wavefunction and minimize stochastic fluctuations of the energy .",
    "this is likely to be important in multiconfigurational systems with significant static correlation , whilst the variationality of the estimator may also offer a more rigorous extrapolation procedure for systematic errors compared to the non - variational projected estimate .",
    "furthermore , as a quadratic functional of the wavefunction , errors in the energy given by the pure expectation value of eq .",
    "[ eqn : pureex ] will scale quadratically with the error in the wavefunction , rather than linearly in the case of eq .",
    "[ eqn : proje ] , again potentially leading to an improved estimator .",
    "section  [ sec : fciqmcrecap ] will briefly recap the stochastic fciqmc algorithm , before detailing an adaptation to allow for non - integer walker weights to reduce the random errorbars in the approach .",
    "section  [ sec : samplingrdms ] will then detail a naive approach to sampling density matrices , which was implemented in ref .  , but which was known to be biased , the origin of which is pinpointed and discussed .",
    "an updated approach is then formulated and presented in section  [ sec : newrdmmethod_algo ] , which rigorously removes this bias , and the convergence and unbiased nature of the resulting properties are demonstrated .",
    "the computational overhead of the approach is analysed in detail , and strategies to minimize its impact without introducing further approximations illustrated .",
    "finally , rigorous benchmarking of a range of properties are shown , including the quasi - variational energy estimate , all of which show encouraging accuracy and convergence properties with both imaginary time , and walker number .",
    "full configuration interaction quantum monte carlo can be considered as a stochastic minimization of the energy with respect to a sampled full configuration interaction wavefunction expansion .",
    "this wavefunction is a simple linear combination of all slater determinants that can be constructed from distributing the available electrons within the ( orthonormalized ) single - particle orbitals spanning the space , as @xmath10 where @xmath11 represents a slater determinant , labeled by the orbital occupation string @xmath12 .",
    "the linear coefficients of this expansion are the objects that are stochastically sampled , such that the average sampled determinant weights @xmath13 are proportional to @xmath14 .",
    "their optimization to the variational ground state of the ansatz is simulated via a stochastic , iterative application of the equations : @xmath15- \\tau ( h_{\\bfi \\bfi } - e_s ) n_{\\bfi}(\\beta )        \\label{eqn : master}\\ ] ] where @xmath16 represents the change in ` walker ' population / weight on determinant @xmath11 in the time step @xmath17 .",
    "this leads to population dynamics of a set of walkers which occupy determinants connected to each other in this many - electron hilbert space .",
    "this dynamic consists of a set of stochastically realized processes .",
    "the first is a ` spawning ' step , which is performed for each occupied determinant , and a number of times proportional to the walker weight at that determinant ( @xmath18 ) . a single or double excitation is randomly chosen , with normalized probability @xmath19 for the excitation from @xmath20 to @xmath21 .",
    "the walker amplitude on @xmath21 is then augmented with a signed probability given by @xmath22 finally , a ` death ' step is performed , by which the amplitude on each determinant , @xmath23 , is ( generally ) reduced with probability @xmath24 . taken together ,",
    "these two steps simulate the dynamic in eq .",
    "[ eqn : master ] .",
    "however , an additional ` annihilation ' step is essential in order to overcome an exponential increase in noise and other features associated with the fermion sign problem@xcite . in this step , walkers of opposite signs on the same determinant are removed from the simulation .",
    "as mentioned in the introduction , the energy of the wavefunction can be extracted from a projected estimator ( eq .  [ eqn : proje ] ) , which in this paper is simply obtained from a projection onto the hartree ",
    "fock determinant ( @xmath25 ) .",
    "in addition , the value of @xmath26 is varied throughout the simulation in order to maintain a constant , desired weight of walkers . at convergence",
    ", this value should fluctuate about the energy of the system , providing an alternative estimator for the energy based on the total growth rate of all the walkers in the system .",
    "more details on the specific implementation of these steps , and the derivation of this dynamic from the imaginary - time equation can be found in refs .  .",
    "furthermore , the systematically improvable _ initiator _ approximation is used exclusively throughout this work ( sometimes denoted @xmath27-fciqmc to distinguish it from the full method ) .",
    "this involves a dynamically truncated hamiltonian operator , where spawning events to unoccupied determinants are constrained to be only allowed if they come from a determinant with a walker weight greater than @xmath28 .",
    "this approximation can be systematically improved as the number of walkers increases , as increasing numbers of determinants fulfil the criteria , and the sampled hamiltonian therefore approaches the exact hamiltonian .",
    "more details and benchmarking of this approximation can be found in refs .  .",
    "recent advances in the methodology were introduced by petruzielo _ et .",
    "al._@xcite , where among other things , non - integer walker weights were introduced .",
    "this non - integer extension to fciqmc requires a realization of eq .",
    "[ eqn : master ] which allows walkers with non - integer weights to be spawned .",
    "this is done by applying the spawning and death processes continuously rather than discretely . by ` continuous ' in this context , we mean that weights are assigned in a spawning / death process in a continuous framework , without the additional stochastic process to convert the resultant weight into an integer value for @xmath29 . applying both of these steps",
    "continuously removes the need for much of the random number generation in the code , and reduces the instantaneous fluctuations on any given determinant by allowing modification of its population by small fractions of a walker , rather than by whole walkers at a time .",
    "it should also be noted that when determining the number of _ attempted _ spawning events from a determinant with a non - integer number of walkers , the fractional part of the amplitude is used as a stochastic test for whether to perform an additional spawning step on top of @xmath30 , to ensure the overall number of spawning attempts is still proportional to @xmath18 , where @xmath31 and @xmath32 represent rounding down or up to the next integer value of a real number respectively .",
    "however , with continuous spawning events automatically accepted ( unless @xmath33 is exactly zero ) , the number of successful spawning events is substantially increased .",
    "this requires more memory to store the increase in spawned walkers , but also slows the simulation down , as each spawning event must be put through some combination of communication and annihilation steps in order to transfer this information .",
    "it is therefore necessary to have some level of stochastic compression of the low - weighted walkers , to avoid storage costs for walkers which would quickly span much of the space .    in this work ,",
    "the overhead of dealing with the additional low weighted walkers is controlled by two parameters .",
    "first , a subspace over which the non - integer walker weights are allowed is imposed .",
    "this is most simply done via a restriction of non - integer weights to only be allowed within a subspace defined by a given number of particle - hole excitations from the reference determinant ( generally hartree ",
    "fock ) , determined by the cutoff parameter @xmath34 .",
    "this greatly minimizes the fluctuations in @xmath35 , since any value of @xmath36 will ensure that all determinants which contribute to @xmath37 ( with the hartree",
    " fock trial wavefunction ) are included in the non - integer space , which is finely resolved . any spawning event out of this space requires an additional stochastic step to discretize the walker amplitude to an integer quantity .",
    "in addition , a minimum occupation threshold ( @xmath38 ) is defined , in order to ensure that low - weighted determinants do not proliferate , as was initially introduced in ref .  .",
    "after all annihilation events are complete , the instantaneous population of each determinant , @xmath18 , is assessed in comparison to this threshold . if @xmath39 , its population is rediscretised to either @xmath38 ( with probability @xmath40 ) or @xmath41 ( with probability @xmath42 ) .",
    "larger values of @xmath38 will therefore reduce the occupied space of determinants by depopulating more determinants with @xmath39 .",
    "of course , values in excess of @xmath43 correspond to a _ coarser _",
    "representation of the wavefunction than the original integer algorithm in certain regions of the space , making such a choice inadvisable .",
    "conversely , setting @xmath44 has no effect at all and returns us to the untenable scenario where a very large number of instantaneously occupied determinants with low weight must be simultaneously stored .",
    "an alternative strategy is to restrict the total number of successful spawning events , which is known to be much higher in the non - integer algorithm .",
    "many of these events may be propagating only small fractions of a walker at a time . for spawning events in particular ,",
    "the cost of treating these low weight progeny in terms of storage and communication , can be substantial compared to their negligible impact on the progress of the simulation .",
    "the death events do not bear the same cost , as the populations are directly updated in the main list of determinants .",
    "therefore , a minimum threshold value , @xmath45 , can be introduced for a continuous spawning event , with the advantage over @xmath38 that additional communication costs are avoided ( these strategies can of course be used together ) . if @xmath46 ( as given in eq .",
    "[ eqn : accprob ] ) is _ greater _ than @xmath45 , @xmath46 walkers are spawned as a continuous event .",
    "if @xmath46 is _ less _ than @xmath45 ( i.e. a low weight event ) @xmath45 walkers are spawned with probability @xmath47 , otherwise @xmath41 walkers are spawned . by doing this , the disproportionate cost of treating progeny smaller than @xmath45 is saved .",
    "it was found that the description of at least some parts of the space in this continuous fashion , allowing for finer resolution of these wavefunction amplitudes , was universally beneficial , with efficiency gains of up to 120 times over full use of integer walker weights .",
    "this was due to the reduction in stochastic noise , although the precise efficiency gain was significantly system - dependent .",
    "the change was also not found to have any negative effect on equilibration or serial correlation times .",
    "the gain in efficiency was found to be fairly consistent across values for @xmath34 , @xmath38 and @xmath45 , however , an approach with @xmath48 ( for a cisdtq non - integer subspace ) and a minimum occupation of 1 walker ( @xmath49 ) was found to be advisable due to its more modest memory demands compared to a more complete non - integer walker space .",
    "this recommended approach typically resulted in 50% increased computational effort , and approximately twice as much memory than the integer method , which is more than offset by the gains in efficiency .",
    "these parameters will be used throughout this work unless otherwise specified , with @xmath50 .",
    "a more detailed analysis of this efficiency gain can be found in ref .  .",
    "the second - order reduced density matrix ( 2-rdm ) can be expressed in second quantization within a basis of spin orbitals as a rank-4 tensor , @xmath51 , @xmath52 where @xmath53 and @xmath54 are creation and annihilation operators respectively  @xcite .",
    "as the @xmath9-electron hamiltonian is constructed only from 1- and 2-body operators , the 2-rdm representation contains sufficient information to exactly reproduce the total energy , as @xmath55 where the 1-rdm is represented as @xmath56 .",
    "in addition to accessing the total energy , the 2-rdm can also be used to compute other 1- and 2-body static properties of the system , provided that the appropriate operator can be projected into the space .",
    "this is achieved by computing the trace of the relevant 1- or 2-electron operator @xmath57 with the rdm @xmath58\\ ] ] where @xmath57 is expressed in the same one - particle basis as @xmath51 ( ref .  ) . as such",
    ", the reduced density matrices are a powerful construct , allowing the calculation of a variety of _ pure _ expectation values with a highly compact representation of the relevant information in the @xmath9-electron wavefunction , without introducing any approximation into the total energy or other observable quantities@xcite .",
    "the reduced density matrices also form the basis of various measures of quantum entanglement  @xcite , can be used to compute multireference explicit correlation corrections to reduce finite basis error@xcite , as well as provide the information for self - consistent optimisations of orbital spaces , as required for the complete active space self - consistent field ( casscf ) approach@xcite , and the density matrix embedding theory ( dmet)@xcite .    for a fci wavefunction expansion in a determinant basis with coefficients @xmath59 ,",
    "the 2-rdm can be written as @xmath60 where the matrix element is non - zero only when @xmath61 is connected to @xmath62 by an @xmath63 excitation , giving a value of @xmath64 ( repeated indices are also allowed ) .",
    "diagonal terms in the rdms can therefore be found as @xmath65 therefore , within the fciqmc dynamic , each determinant , @xmath62 , contributes to the 2-rdm via @xmath66 summed into each of the @xmath67 elements where orbitals @xmath68 and @xmath69 are occupied in @xmath62 , to generate the diagonal elements of the 2-rdm in a relatively simple fashion .    however , the explicit generation of all relevant determinant pairs in eq .  [ eqn:2rdmterms ] for the off - diagonal contributions is prohibitively expensive ( @xmath70 $ ] per occupied determinant ) , and so we seek an algorithm which avoids this naive approach .",
    "this was considered in ref .  .",
    "as the 2-rdm involves contributions from pairs of determinants that are ( at most ) double excitations of one another , the existing spawning events that occur throughout the simulation to propagate the walker distribution in imaginary time already generate the required excitations , through the application of the hamiltonian operator .    for each walker on determinant @xmath62 , the spawning step generates a target determinant , @xmath61 , which is always a single or double excitation of @xmath62 .",
    "if the spawning attempt is successful , the child walker is communicated to the parallel process that hosts @xmath61 , allowing its weight to be updated .",
    "the stochastic rdm method exploits this existing computational effort and communication to sample the rdm off - diagonal elements . to calculate the contribution to the unnormalized rdm from this determinant pair , the signed amplitude information of both determinants",
    "is required , which can be achieved by passing a small amount of additional information through the existing communication step with newly spawned walkers ( an amplitude and the identity of the parent determinant , @xmath62 ) .",
    "after the communication step , the identity and signed weight of both determinants are then available on the same process .",
    "the identity of the orbitals that differ between them can then be easily calculated , and the contribution added to the relevant off - diagonal rdm element(s ) .",
    "therefore , contributions to the off - diagonal rdm terms are only included when there is a successful spawning attempt between two determinants .",
    "as the rdm contribution corresponding to @xmath71 is only added in when there is a successful spawning event between the determinants , it must be rescaled to take into account the probability of this event occurring .",
    "the contribution added into these terms will therefore take the form @xmath72 where @xmath73 is the normalized probability of spawning at least one child ( of any weight ) onto @xmath61 from @xmath62 during the current iteration .",
    "this depends on factors such as the number of walkers on @xmath62 , and whether it is a stochastic or continuous spawning event .",
    "this can be calculated for non - integer weighted determinants as @xmath74 and for determinants populated by integer numbers of walkers as @xmath75 where @xmath76 denotes the instantaneous walker weight on determinant @xmath62 for the iteration in consideration , and @xmath6 is the probability of _ not _ spawning a walker ( of any weight ) from @xmath77 to @xmath78 in a single attempt .",
    "this value varies depending on what ` type ' of spawning event is being attempted .",
    "specifically , @xmath79 where @xmath80 ( eq .  [ eqn : stochunbias ] ) is to be used in the case of a stochastically realized integer spawning event , @xmath81 ( eq .  [ eqn : contunbias ] ) is to be used for a continuous spawning event , and @xmath82 ( eq .  [ eqn : spawncutunbias ] ) is to be used if the continuous spawning truncation parameter , @xmath45 , is being used ( see section  [ sec : reals ] ) and @xmath83 , otherwise @xmath81 should be used .",
    "it should be noted that the unbiasing factor @xmath84 is not a constant , and is an implicit function of @xmath85 since it depends on the instantaneous walker weight @xmath18 , for the iteration under consideration .",
    "if multiple successful spawning events are registered between a specific \\ { , } pair in a single iteration , then it is necessary to only consider this to be a single contribution to the density matrix . in principle , if a pair of determinants contributes to the off - diagonal rdm element @xmath86 , it will also contribute to the element @xmath87 .",
    "however , in practice , we choose to only update one of these terms for a spawning event , with the other sampled by events @xmath88 .",
    "the difference between the two terms , related by the required hermiticity property of the sampled matrix , can then be used as a metric of the quality of off - diagonal sampling of the rdm , before it is averaged to become strictly hermitian at the end of the calculation ( numerically equivalent to including both contributions at the accumulation stage ) .",
    "these stochastic reduced density matrices do not satisfy the trace relation , given ( for the 2-rdm ) by @xmath89 where @xmath9 is the number of active electrons .",
    "this is because the @xmath18 values are not normalized determinant coefficients .",
    "this is more difficult to account for directly , as normalising the full wavefunction requires average sign values for all determinants , not just those instantaneously occupied .",
    "instead , the 2-rdm is normalised directly at the end of the simulation to enforce the trace relationship in eq .  , which we are free to do as this normalization is a freedom in the sampling of the wavefunction .",
    "further n - representability constraints would be hard to apply , since these generally correspond either to structural relationships between higher - ranked rdms ( which we do not have access to in this scheme ) and lower ranked ones , or constraints on the spectrum of the reduced density matrices which would be difficult to constrain at the sampling stage@xcite .",
    "furthermore , we believe in this scheme that the rdms obtained should as faithfully as possible reflect the wavefunction which is sampled , rather than imposing additional constraints , which would result in derived properties not directly corresponding to expectation values of the sampled wavefunction .",
    "it should be stressed that if the walker distribution is sampling the correct wavefunction , then all n - representability conditions will be exactly satisfied upon appropriate averaging in imaginary time .",
    "the technique outlined above allows for an accumulation of an approximate rdm , alongside the stochastic dynamic of the fciqmc wavefunction . however , there are a couple of subtleties which need to be considered .",
    "the first concerns the fact that off - diagonal contributions to the rdm arising from determinant pair @xmath90 , @xmath91 are only included in the event of a successful spawning event from one to the other .",
    "the probability of this occurring is proportional to the hamiltonian matrix element connecting the two determinants ( in the case of a stochastic spawning event ) , which means that determinant pairs whose spawning events are discretised and connected via large hamiltonian matrix elements will be sampled more frequently than weakly coupled determinants .",
    "this can result in sampling difficulties if two significantly weighted determinants are _ not _ in the non - integer walker space , and are connected via very small matrix elements , since a contribution to the rdm may be poorly sampled , or even entirely omitted .",
    "it should be stressed that continuous spawning connections are not sampled proportionally to the hamiltonian matrix element , and so are not affected .",
    "a specific example where issues can arise concerns the connections to single excitations of the hartree  fock determinant ( @xmath92 ) in a canonical basis , whose connecting matrix elements are therefore numerically zero by brillouin s theorem . to account for this ,",
    "connections between the reference ( generally hartree  fock ) determinant and its excitations ( both single and double excitations ) are taken into account explicitly .",
    "this is simple to do since the weight on the reference determinant is known to all parallel processes , as it is used for the calculation of the projected energy estimate , @xmath35 .",
    "since the contribution from these pairs of determinants is performed exactly ( which are likely to be the main contribution , especially in relatively weakly correlated systems ) , their contributions are not dependent on a successful spawning event between the two",
    ".    however , it is still possible that other very small hamiltonian matrix elements connect substantially weighted determinants , and a sampling error could then arise .",
    "this was investigated by including additional spawning events between determinants .",
    "these events would spawn walkers between determinants proportionally to a function of the _ inverse _ of the hamiltonian matrix element between them , or a specific lower - bound cutoff .",
    "these spawned walkers would not adjust the walker amplitude on determinants they were spawned to , or affect the simulation trajectory , but rather would simply confer information about the respective determinant parent and its amplitude ( with appropriately adjusted @xmath93 ) in order to include the contribution to the off - diagonal elements of the rdms when the hamiltonian matrix element between the two determinants was small .",
    "this was found to provide negligible improvement across a range of systems as this sampling error was small , and therefore we consider this unnecessary and do not pursue it further here .    despite this ,",
    "the quality of the sampled density matrices remains poor , and convergence to the exact density matrix and derived properties with increasing walker number is slower than for properties such as the projected energy of the system ( see results in ref .  ) .",
    "this is due to a remaining significant error beyond simply a manifestation of insufficient sampling time or initiator error of the wavefunction .",
    "this remaining bias can be summarized by the observation that the appropriate contribution to the density matrix elements , @xmath94 , is in fact approximated by @xmath95 .",
    "this ignores the non - zero ( co)variance between the two amplitudes , which ( especially for diagonal contributions ) can be significant , and results in a biased sampling , even if the averaged walker amplitudes themselves are unbiased .",
    "the root cause is therefore the fact that the two amplitudes which contribute to the density matrix element are correlated , with the dominant error unsurprisingly coming from the diagonal elements where the instantaneous amplitudes are perfectly correlated , and where the error is of a single sign , removing the possibility of error cancellation in the neglected ( co)variance .",
    "computing appropriately averaged values of the determinant coefficients over the simulation , @xmath96 , which would remove the instantaneous correlation between the walker populations , has prohibitive memory demands as it involves storage of determinants that are occupied at _ any _ stage of the simulation , even if their instantaneous population is zero . a simple approach to reduce the bias is to average the walker populations during the period over which the determinant is occupied and use this as an approximate value for the @xmath96 determinant amplitude for the density matrix contribution ( as was performed for ref .",
    "@xcite and the ` biased ' comparison results in section  [ sec : newrdmmethod_algo ] ) .",
    "however , since this contribution is not averaged over periods while the determinant is unoccupied , the density matrix is still a biased expectation value of the sampled wavefunction .",
    "numerical results suggest that although this approach will tend to the exact density matrix and associated properties in the large walker limit , the convergence to the exact result requires far more walkers compared to the projected energy estimate .    in a recent article@xcite blunt _",
    "_ introduced the ` density matrix quantum monte carlo ' ( dmqmc ) method . in this , the _ full _",
    "@xmath9-electron density matrix is sampled stochastically . from this quantity ,",
    "lower - rank reduced density matrices can be obtained via ` tracing out ' of additional degrees of freedom .",
    "however , this approach contrasts with the approach taken here , where only the wavefunction is sampled , and we seek to directly find the reduced density matrix which corresponds to this sampled wavefunction . however , we draw inspiration from the dmqmc approach , since they considered the use of a replica trick to overcome a similar difficulty relating to the evaluation of a quadratic function of a stochastically sampled distribution ( this time of the density matrix rather than wavefunction )  the renyi @xmath97 entanglement entropy . in this , two uncorrelated walker samples were propagated independently , thus rigorously removing any covariance between the sampled distributions .",
    "they further suggest that this approach might be useful for sampling expectation values , such as in eq .",
    "[ eqn : pureex ] , directly within fciqmc .",
    "this approach was subsequently used in ref .",
    ", in order to compute _ dynamical _ expectation values , including the green s functions and arbitrary spectra . in the rest of this article",
    "we take up this idea to calculate rdms within fciqmc and demonstrate that an unbiased sampling can indeed be achieved , dramatically improving the convergence over the biased approach .",
    "an unbiased rdm sampling can be achieved via two independent walker populations ( replicas ) , whose instantaneous weights on a determinant @xmath77 will be denoted @xmath98 and @xmath99 for the first and second walker replicas respectively . in this implementation ,",
    "the replicas are propagated with independent random number strings , and each determinant with a walker weight in either of the two replicas is stored in the data structures outlined in ref .  , in the same fashion as handling complex walker amplitudes in ref .  .",
    "this allows for the weight on a given determinant over both replicas to be extracted without any additional computational overhead .",
    "spawning , death and annihilation events are then applied to each population independently and two sets of statistics gathered , including measures of @xmath35 and @xmath26 , with @xmath100 and @xmath101 used in the respective death probabilities for the replicas .",
    "the two simulations are therefore completely uncorrelated , apart from sharing the same initial conditions , from which they quickly decorrelate after equilibration .",
    "although this effectively doubles the computational resources required per iteration , there are two independent estimates of all quantities of interest , and so by using this additional information , the random errors in these quantities are reduced by a factor of @xmath102 .",
    "this results in the calculation requiring only half the time .",
    "computational overheads therefore only effectively result from increased memory requirements from the additional replica population .",
    "uncorrelated and unbiased contributions to elements of the reduced density matrices can then be found by ensuring that any product of determinant populations is computed from the amplitudes over both replicas .",
    "contributions to the diagonal elements of the rdms can be gathered each iteration from all instantaneously occupied determinants , by accumulation of @xmath103 to the @xmath67 relevant diagonal elements .",
    "off - diagonal elements are accumulated through successful spawning events , as detailed in section  [ sec : samplingrdms ] , ensuring that the two determinant weights @xmath76 and @xmath104 come from different populations to ensure an unbiased sampling .",
    "however , there are two possibilities with this .    from consideration of a determinant transition from replica 1 , @xmath105 , which occurs with probability @xmath106 ,",
    "two possible contributions could be considered ; @xmath107 it is important that only the _ ` forwards ' _ contribution is considered for the spawning events from replica 1 ( eq .",
    "[ eqn : forwards ] ) , since including the latter ` backwards ' contribution ( eq .",
    "[ eqn : backwards ] ) introduces a bias into the sampling .",
    "this can be rationalized from consideration of an iteration where @xmath108 and @xmath109 . in this case",
    ", there would be non - zero @xmath110 contributions which would never be sampled , because there are no walkers on site @xmath12 in the first replica to spawn from .",
    "instead the ` backwards ' contribution should be sampled only from transitions within replica 2 , with the denominator changed to @xmath111 , and appropriately averaged with the forwards contribution .",
    "however , for the results presented in this paper , the contributions from only one replica were considered , indicating that a further reduction of the error bars in the density matrix elements by a factor of @xmath102 is trivially possible without additional cost .        finally , as described in section  [ sec : samplingrdms ] , the off - diagonal contributions that involve direct connections to the reference determinant ( generally @xmath92 ) can be included explicitly , with the knowledge of @xmath112 for both replicas known to all processes each iteration .",
    "this will ensure the best quality sampling for these generally important contributions , and avoid any sampling issues arising from brillouins theorem .",
    "again , the sampled density matrices are normalized to fulfil the appropriate trace relations , as well as made hermitian at the end of the simulation ( which is only exactly achieved without this in the limit of long sampling time ) , which ensures that @xmath113 for the 2-rdm .",
    "a simple comparison between the original , biased approach , and the replica sampling of the density matrices in fig .  [ fig : c2_f12paper_new ] shows the striking improvement in the quality of the properties .",
    "it can be seen that the convergence of the quasi - variational energy expectation value , @xmath114 , is now comparable to that of the non - variational estimate , @xmath35 ( or faster in some instances ) .",
    "the @xmath114 estimate is denoted ` quasi - variational ' , since it is only rigorously variational in the long sampling limit . for short sampling times , it is possible that the replicas have sampled different wavefunctions within their stochastic errors , and therefore the @xmath9-representability conditions of the rdms will not be strictly satisfied",
    ". non - variational energies are therefore possible within the random errors of the sampling .    in the limit of sufficient sampling of imaginary time , but where the number of walkers is not sufficient to entirely converge the initiator error of the fciqmc method , @xmath114 will be variational , but is not in general the same as @xmath35 .",
    "these two energy estimates will only rigorously be the same where the sampled wavefunction represents an eigenstate .",
    "therefore , this quasi - variational estimate of the energy may have a different convergence profile with @xmath115 compared to the standard energy estimates .",
    "this might provide a clearer measure of decay of the initiator error , as well as potentially being more amenable to variational extrapolation of this energy to the infinite walker limit to remove the effects of the initiator error .",
    "this will be investigated in future work .",
    "the convergence to this large walker limit of the @xmath114 expression can be assessed via comparison to fci results , as shown in fig .",
    "[ fig : choosingnw ] , where a smaller system than that of fig .",
    "[ fig : c2_f12paper_new ] allows the exact 2-rdm to be calculated .",
    "this indicates that the @xmath114 expression appears to provide a more rapid convergence to the large walker limit in the case of more multiconfigurational wavefunctions , simulated by the stretching of the triply - bonded nitrogen molecule to 4.2  a@xmath116 .",
    "this is unsurprising , since the projected energy expression used a trial wavefunction which was simply the hartree ",
    "fock determinant , whose weight in the fci expansion diminishes rapidly as the bond is stretched@xcite .",
    "the use of a multiconfigurational trial wavefunction would improve the projected energy estimate in these cases .",
    "however , it is clear that in these cases , @xmath114 provides a good estimate of the energy , with a far larger number of spawning events in the space directly contributing to the energy ( all to a determinant with a non - zero population in the other replica ) , rather than just the distribution of a small fraction of walkers on the reference determinant and its direct excitations .",
    "this improvement of the @xmath114 energy estimator over the @xmath35 value is again borne out for multiconfigurational problems when considering not the number of walkers required , but the sampling time required for the random errors associated with the energy estimate to fall to an acceptable value .",
    "this can be observed in fig .",
    "[ fig : simulationtime ] , where the convergence of the energy for a given number of iterations is in general faster than the corresponding projected energy estimate . the convergence of other properties derived from the sampled density matrices will be investigated in section  [ sec : properties ] , after a consideration of the computational costs associated with sampling of the density matrices .",
    "the replica - sampled rdm method achieves an unbiased sampling of the 2-rdm by adding in instantaneous contributions @xmath117 throughout the simulation .",
    "although there is an associated computational cost for running another independent replica of the walker population , this cost is largely offset by the improvement in the statistics that result compared to running twice as long . therefore , the dominant additional overhead for propagation of the additional replica comes from the associated memory requirements .",
    "the accumulation of the 2-rdm also has associated costs , since the memory required is of size @xmath118 $ ] . since this is of the same size as the storage of the two - electron integrals required for the calculation and",
    "also stored in memory , it is currently not a bottleneck .",
    "however , eventually these memory costs may be required to be distributed among the computational nodes@xcite .",
    "the dominant computational cost in sampling the density matrix comes from the accumulation of the diagonal matrix elements , as each occupied determinant requires an @xmath119 $ ] operation to identify and update all the necessary 2-rdm elements each iteration .",
    "therefore , any approach that reduces the frequency at which these contributions need to be added in will reduce the computational cost associated with accumulating the rdm , with increasing returns at large @xmath9 .",
    "this can be achieved with an approach whereby we store and calculate a running average of a determinant s weight within a defined block of iterations , and only add in its diagonal rdm contributions ( and connections to reference determinant , if applicable ) once at the end of these blocks , weighted by the number of iterations in that block .",
    "in so doing , contributions to the diagonal elements and @xmath92 connections can be summed in much less frequently without any loss of information .",
    "however , the implementation of such an averaging technique requires careful thought to ensure that no systematic bias is introduced into the rdm contributions , whilst making the best use of the available data in the simulation .",
    "this dictates that ` blocks ' of iterations over which the weight on a determinant is averaged should start whenever a determinant has a change in occupation status ( i.e. becomes newly unoccupied or newly occupied ) _ in either replica population_. this ensures that the only blocks with a non - zero contribution to the rdm exactly correspond with the set of iterations that would have produced a non - zero contribution when adding in snapshots instantaneously every iteration .",
    "this averaging approach retains the unbiased nature of the rdm sampling , but has a significant advantage in terms of simulation time , as contributions to the diagonal elements and @xmath92 connections are only required at block boundaries ( and for the diagonal contribution , only when both replicas have been occupied in the block ) , rather than every iteration .",
    "therefore , for a given determinant , its contributions to the rdm diagonal elements , which are added in only at the end of each averaging block , now take the form @xmath120 where @xmath121 is the average weight on @xmath62 in population 1 within averaging block @xmath122 , and @xmath123 is the number of iterations within that averaging block .",
    "this removes what rapidly becomes the dominant cost as the number of electrons in the system increases .",
    "similarly , if the given determinant is a single or double excitation of @xmath92 , the off - diagonal contributions from this connection are added in at the same time as the diagonal contributions , taking the form : @xmath124 where @xmath125 is the measure of the average population on @xmath92 up to the iteration where the contribution is included . although this averaging approach can also be shown to achieve an unbiased sampling of the diagonal elements and the explicitly included @xmath92 connections , the presence of serial correlation in determinant amplitudes creates a problem for the remaining stochastically sampled off - diagonal contributions if these averaged coefficients are used .",
    "therefore , off - diagonal elements must continue to be accumulated using instantaneous determinant weights as detailed previously",
    ". however , this is not a particular burden since for the off - diagonal elements there is only one contribution ( for sampled double excitations ) , or @xmath126 $ ] ( if a single excitation is sampled ) .",
    "it is important not to simply consider the density matrix energy estimator when benchmarking the quality of the rdms , since the action of contracting the density matrices with the hamiltonian will place emphasis on parts of the rdm matrix , while being relatively insensitive to others .",
    "indeed , the algorithm dictates that it preferentially samples those elements whose contribution to the variational energy estimator is largest .",
    "in addition , the primary motivation for the sampling of the density matrices is for the computation of unbiased molecular properties derived from the density matrices , whose value could not be computed in an unbiased fashion from a projected estimator .",
    "figures  [ fig : properties_eqm_cheaper ] and [ fig : properties_str_cheaper ] show various properties derived from the one- and two - body sampled density matrices , compared to exact results from density matrices computed from a fci diagonalization of the system .",
    "both an equilibrium ( relatively single reference ) , and stretched triple bond ( strongly multiconfigurational ) are shown , to highlight any potential differences arising from the sampling of the rdms within different wavefunction characteristics .",
    "also , both the instantaneous replica rdm sampling , as well as the cheaper but still unbiased sampling of averaged determinantal weights for diagonal rdm elements are shown .",
    "these are all within random errorbars of each other , confirming the equivalence of these two approaches , and the fact that the averaging of determinant weights should always be performed .",
    "the properties sampled in these results include the spin quantum number of the sampled wavefunction@xcite , and two differing corrections to the wavefunction ameliorating the basis set incompleteness in the representation , proposed by valeev _ et al._@xcite .",
    "the first ( @xmath127_{r12}$ ] ) approximately corrects for the incompleteness in the two - electron form of the correlation hole around each coalescence point@xcite , while @xmath127_{s}$ ] corrects for the incompleteness relating to the single - particle orbital representation@xcite .",
    "although the @xmath127_{s}$ ] correction was originally proposed in the context of accelerating convergence with respect to the external space within casscf calculations , in this context it is used without orbital optimization , with the entire orbital space considered as occupied .",
    "this can cause convergence difficulties and intruder states as @xmath128 does not necessarily separate between the orbital and cabs spaces .",
    "however , whether this quantity is a robust correction for single - particle basis incompleteness without combining it with orbital optimization is separate to the use of it as a metric for analysis of the convergence of the parent density matrix , for which it is primarily used in this study .",
    "these quantities , as well as other explicit correlation corrections , have been applied to fciqmc wavefunctions previously@xcite .",
    "it was found that these two properties were far more sensitive than @xmath114 on the quality of the sampled off - diagonal 2-rdm elements , and so provided a complementary test of the sampling quality .",
    "nevertheless , the errors in these quantities is an order of magnitude smaller than @xmath114 , and converges at least as rapidly to the exact result .",
    "the error in these quantities is expected to solely result from initiator error in the sampled wavefunction , which decreases as observed as the number of walkers increases , as all other sources of systematic error from the density matrices have been removed@xcite .",
    "the random error in the calculations is also very small , having been estimated from independent calculations .",
    ", for equilibrium ( 1.094 ) n@xmath129 cc - pvdz .",
    "both approaches are unbiased , and are shown to be equivalent within their random errorbars ( most are entirely overlaid ) . plotted",
    "is @xmath114 , as well as @xmath127_{r12}$ ] and @xmath127_s$ ] explicit correlation energy corrections ( see refs .  ) and the value of the spin quantum number , @xmath130 , of the sampled wavefunction@xcite .",
    "these errorbars are calculated from five independent calculations , but are often too small to be seen .",
    "dotted lines give the exact fci value for each quantity , while stochastic rdms were accumulated over @xmath131 iterations .",
    "8 electrons are frozen , with @xmath132a.u.@xmath133    , but for the more multiconfigurational , stretched n@xmath129 molecule ( @xmath134 ) .",
    "note the reduction in the error in @xmath114 as the bond is stretched .",
    "this contrasts in general with @xmath35 , which degrades as the wavefunctions become less compact and more difficult to sample in these multiconfigurational cases@xcite . ]",
    "in summary , we propose the replica - sampled rdm method for computing one- and two - body reduced density matrices from a stochastic fciqmc sampling of the wavefunction .",
    "the replica sampling allows for the elimination of systematic errors due to the quadratic dependence of the density matrix elements on the sampled wavefunction , from which a previous implementation suffered badly . the resultant reduced density matrices have no systematic error besides the initiator error present in the inherent sampling of the wavefunction itself , which can be systematically improved by increasing overall walker number .",
    "the accumulation of the rdms runs alongside the sampling of the wavefunction , making use of the two - body operator moves of fciqmc , therefore adding only modest additional computational overheads for the calculation of the density matrices .",
    "averaged determinant weights are used for the contributions to the rdm diagonal elements and @xmath92 connections , therefore avoiding a potentially costly @xmath119 $ ] step for each occupied determinant each iteration , without additional errors being incurred . however",
    ", instantaneous weights are used for the stochastic sampling of the remaining off - diagonal contributions , retaining the unbiased qualities of the original all - instantaneous replica sampling approach .",
    "the properties derived from these density matrices are shown to converge with increasing walker number to exact results at a comparable rate to the standard projected energy estimators , as the initiator error is reduced .",
    "this is also true for the quasi - variational energy estimator derived from the density matrices ( strictly variational in the large imaginary - time limit ) .",
    "this estimate is found to be an accurate alternative to the projected estimate , especially powerful in strongly correlated , multiconfigurational wavefunctions , where the absence of a large weighted wavefunction space to project onto can result in large random errors in this approach .",
    "furthermore , the quasi - variational nature of the value may lend itself to extrapolation techniques for the systematic initiator error .    on the face of it",
    ", it would appear that the scaling of the replica - sampled reduced density matrix will be poor with respect to increasing system size , as it requires spawning events onto a determinant occupied in the other replica in order to accumulate off - diagonal contributions .",
    "however , it is precisely this type of event which is required for the annihilation part of the algorithm , crucial for the suppression of the sign - problem in the space ( aided by the initiator conditions ) . because of this , we do not anticipate the scaling to be particularly worse than that of the fundamental ability of the algorithm to resolve the correct wavefunction . this precise scaling",
    "is expected to be dependent on the expectation values being probed , as well as the system under investigation , and further studies are underway to observe the accuracy of the properties as the system sizes increase .",
    "finally , it should be noted that it is straightforward to combine this approach with more recent developments and extensions of fciqmc , such as the semi - stochastic sampling of the space@xcite , extraction of excited states@xcite , and additional symmetries such as time - reversal symmetry and ( angular ) momentum symmetries which have been constrained in the walker dynamics@xcite .",
    "we now plan on turning our attention to larger systems , and an assessment of the accuracy of other properties , including nuclear forces and electrical moments of molecules .",
    "ghb would like to gratefully acknowledge financial support from the royal society via a university research fellowship .",
    "this work has been supported by epsrc grant number ep / j003867/1 .",
    "60ifxundefined [ 1 ] ifx#1 ifnum [ 1 ] # 1firstoftwo secondoftwo ifx [ 1 ] # 1firstoftwo secondoftwo `` `` # 1''''@noop [ 0]secondoftwosanitize@url [ 0 ] ",
    "+ 12$12  & 12#1212_12%12@startlink[1]@endlink[0]@bib@innerbibempty link:\\doibase 10.1139/cjc-2012 - 0539 [ * * , ( ) ] @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) link:\\doibase 10.1103/physrevb.90.155130 [ * * ,   ( ) ] @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) link:\\doibase 10.1002/wcms.1171 [ * * ,   ( ) ] @noop * * ,   ( ) link:\\doibase 10.1103/revmodphys.73.33 [ * * ,   ( ) ]",
    "@noop \\doibase http://dx.doi.org/10.1063/1.3681396 [ * * , ( ) ] @noop * * ,   ( ) in  @noop _ _ ,  , vol .",
    ",  ( ,  , ) in  @noop _ _ ,  , vol .  ,  ( ,  , ) @noop _ _  ( ,  ,  ) @noop * * ,   ( ) \\doibase http://dx.doi.org/10.1063/1.4773819 [ * * , ( ) ] @noop * * ,   ( ) link:\\doibase 10.1103/physrevlett.109.230201 [ * * ,   ( ) ] _ _ ,  @noop ph.d . thesis ,   ( ) @noop _ _  ( ,  ) @noop * * ,   ( ) @noop * * ,   ( ) link:\\doibase 10.1063/1.3254836 [ * * , ( ) ] @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) link:\\doibase 10.1021/ct301044e [ * * , ( ) ] @noop * * ,   ( ) link:\\doibase 10.1103/revmodphys.35.668 [ * * ,   ( ) ] @noop * * ,   ( ) \\doibase    http://dx.doi.org/10.1063/1.1636721 [ * * ,   ( ) ] @noop * * ,   ( ) @noop   ( ) ,   \\doibase http://dx.doi.org/10.1063/1.1783212 [ * * ,   ( ) ] @noop * * ,   ( ) link:\\doibase 10.1063/1.3664729 [ * * , ( ) ] link:\\doibase 10.1063/1.3499600 [ * * , ( ) ] @noop * * ,   ( ) @noop @noop   ( ) ,   @noop * * ,   ( ) \\doibase http://dx.doi.org/10.1063/1.4766327 [ * * ,   ( ) ] @noop * * ,   ( )"
  ],
  "abstract_text": [
    "<S> properties that are necessarily formulated within pure ( symmetric ) expectation values are difficult to calculate for projector quantum monte carlo approaches , but are critical in order to compute many of the important observable properties of electronic systems . here </S>",
    "<S> , we investigate an approach for the sampling of unbiased reduced density matrices within the full configuration interaction quantum monte carlo dynamic , which requires only small computational overheads . </S>",
    "<S> this is achieved via an independent replica population of walkers in the dynamic , sampled alongside the original population . </S>",
    "<S> the resulting reduced density matrices are free from systematic error ( beyond those present via constraints on the dynamic itself ) , and can be used to compute a variety of expectation values and properties , with rapid convergence to an exact limit . </S>",
    "<S> a quasi - variational energy estimate derived from these density matrices is proposed as an accurate alternative to the projected estimator for multiconfigurational wavefunctions , while its variational property could potentially lend itself to accurate extrapolation approaches in larger systems . </S>"
  ]
}