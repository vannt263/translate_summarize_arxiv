{
  "article_text": [
    "short electron bunches are generated at photoinjectors such as the a0 photoinjector at fermilab @xcite , at x - ray free electron lasers such as the linac coherent light source ( lcls ) at slac @xcite and will be a key requirement for high luminosity in the proposed international linear collider ( ilc ) @xcite . at the new asta photoinjector at fermilab , now being commissioned , bunches shorter than a picosecond will be created using a two stage compression scheme @xcite .",
    "streak cameras are used to measure bunch lengths down to the picosecond scale but shorter bunches require either electro - optical methods @xcite , transversely deflecting rf cavities @xcite or methods which use the coherent radiation at infrared wavelengths emitted by the bunch .",
    "such radiation can have different sources such as synchrotron radiation , transition radiation , and diffraction radiation to name a few .",
    "the radiation is coherent when the wavelength is comparable or longer than the bunch length . at the a0 photoinjector",
    "the coherent transition radiation ( ctr ) emitted when the electron beam traverses a thin metallic foil has been used to determine the longitudinal distribution of the electron beam .",
    "the distribution is reconstructed from the measured amplitude and calculated phase of the intensity spectrum .",
    "the phase calculation uses the kramers - kronig ( kk ) method which relates the real and imaginary parts of the spectrum via a hilbert transform .",
    "while the kk method is relatively straightforward and has been used extensively , see e.g. @xcite , it has a few drawbacks which will be discussed below .",
    "it is therefore useful to develop an alternative technique to reconstruct the longitudinal distributions of short electron bunches .",
    "very recently a different approach was proposed @xcite .",
    "it is based on the _ iterative _ retrieval of the phase from the knowledge of the measured amplitude and imposing suitable constraints which must be satisfied by the longitudinal bunch profile .",
    "this approach belongs to a much wider class of iterative methods that aim to indirectly measure a signal from the magnitude of its fourier transform @xcite . by retrieving the missing phase in fourier space",
    ", the signal can be reconstructed unambiguously . in @xcite",
    "such a procedure was employed to retrieve the longitudinal profile of simulated and measured ctr spectra and a heuristic approach to optimize the iterative reconstruction was given .",
    "we note that a phase retrieval method was also used in reconstructing the two - dimensional transverse density of an electron bunch from its coherent transition radiation @xcite .",
    "a fundamental issue with these iterative algorithms is that the underlying mathematical problem is inherently ill - posed @xcite meaning that a number 2n of unknown quantities ( for instance amplitude and phase of the target function ) must be reconstructed starting from only n measured values ( i.e. the amplitude of the spectrum ) . in practice",
    "though , under reasonable assumptions on the object function to be retrieved , the problem can be uniquely solved in two or more dimensions @xcite while fundamental ambiguities are still present in the one - dimensional case @xcite .",
    "this aspect was briefly discussed in @xcite , showing that in some cases of experimental significance , the solution is in fact unique .",
    "nevertheless a more general approach , able to deal with the ambiguities is desirable .",
    "this is the subject of this paper , which aims to extend the results obtained in @xcite , discussing in greater detail the problem of uniqueness of the solution .",
    "we shall show that this is extremely relevant when the longitudinal bunch distribution has more than a single peak . in this case",
    "the fundamental ambiguities inherent to the 1d problem can play a non - trivial role .",
    "we proposed an approach inspired from a similar procedure derived for x - ray optics @xcite .",
    "this method is based on the _ a posteriori _ selection of the results of the reconstruction of different algorithm runs , starting from independent random estimates .",
    "the selection is made on the basis of the cross - correlation that each reconstruction displays with a reference one .",
    "the paper is organized as follows : in sec .",
    "2 the basis of the kk method is reviewed and the limitations associated with it are discussed .",
    "3 deals with the problem of the ambiguities in iterative phase retrieval , while sec .",
    "4 is devoted to the detailed description of our method .",
    "5 reports the results obtained with our method applied to simulated bunch profiles of characteristic shape : gaussian , lorentzian , combinations of the two and a profile expected in a bunch compressor .",
    "the effect of noise is also discussed here .",
    "the results related to measured bunch profiles at the a0 photoinjector are shown in sec .",
    "6 and discussed in sec . 7 .",
    "conclusions are drawn in sec .",
    "we briefly discuss the kk method here , more complete discussions can be found in @xcite .",
    "let @xmath0 denote the longitudinal distribution of an electron bunch , then its fourier transform ( ft ) is s ( ) ( ) e^i ( ) = s(z ) z. here @xmath1 and @xmath2 are the amplitude and phase respectively of the complex function @xmath3 .",
    "the bunch form factor @xmath4 is defined as f ( ) ^2 ( ) = s ( ) s^ * ( ) .",
    "the form factor is related to the bunch intensity spectrum @xmath5 via i ( ) = i_1 ( ) [ n + n(n-1 ) f ( ) ] , where @xmath6 is the spectrum of a single particle and @xmath7 is the number of particles in the bunch . in the limit of a large bunch population , the intensity spectrum of coherent radiation @xmath8 or equivalently the amplitude @xmath9 .",
    "since @xmath0 is a causal function , the real and imaginary parts of its ft are related by the hilbert transform . using this relation ,",
    "the phase can be written as the sum of two terms @xmath10 where @xmath11 is known as the minimal phase and @xmath12 is known as the blaschke phase .",
    "they can be written as : _",
    "m ( ) = -_0^x , _ b ( ) = _ j ( ) . in the expression for @xmath11 , @xmath13 denotes the cauchy principal value while in the formula for @xmath14 , @xmath15 is the @xmath16th zero of @xmath3 in the upper half of the complex plane .",
    "only the zeros nearby to the real axis have a meaningful impact on the phase .",
    "when the zeros are far away , the blaschke phase is linear in the frequency but a linear frequency shift corresponds to a spatial translation of the profile and does not affect the shape of the bunch .",
    "if there are no nearby zeros , then the minimal phase is a useful approximation to the total phase .",
    "it can be written in a form without the apparent pole - like singularity _",
    "m ( ) = - _ 0^ x .",
    "[ minphase ] the bunch profile can be obtained from the minimal phase by an inverse cosine transform , s(z ) = _ 0^ ( ) . for a gaussian bunch , the minimal phase is linear in @xmath17 while for a general asymmetric bunch profile , @xmath11 is nonlinear in @xmath17 .",
    "the kk method suffers from two main limitations : ( i ) the modulus of the spectrum must be known in principle for all frequencies and ( ii ) the minimal phase must be a good approximation to the total phase @xcite . in practice",
    "one needs to extrapolate the measured spectrum to very low frequencies @xcite and calculate the phase from eq .",
    "( [ minphase ] ) .",
    "the assumption of no nearby zeros is valid for gaussian functions and combinations of gaussians but it is not valid for other shapes with long tails such as lorentzians . for these shapes the blaschke phase can not be ignored and approximating the phase by the minimal phase does not result in an accurate reconstruction , as will be seen later . in a photoinjector with a bunch compressor ,",
    "the longitudinal profile is far from gaussian and it not clear _ a priori _ that the minimal phase approximation will be accurate . from the description above ,",
    "the need for an alternative method is clear .",
    "the iterative phase retrieval approach can offer such an alternative : it is valid even in the presence of nearby zeros of @xmath18 and can be more robust against missing data . nonetheless the iterative method also suffers from limitations , which will be discussed in the next section .",
    "iterative phase retrieval methods have been applied to numerous 2d problems in optics and crystallography @xcite , electron microscopy @xcite and x - ray imaging @xcite .",
    "they are well suited when the direct imaging of a sample is not possible due to the lack of a suitable objective lens .",
    "for example , aberrations of the objective may prevent imaging at the diffraction limit or the efficiency of the objective lens makes a direct imaging procedure impractical .",
    "the iterative method , in its original form is based on the fast fourier transform ( fft ) routine to numerically propagate the wave front from the sample plane to the detector plane and _ vice versa_. the algorithm is constrained by the measured data in the fourier space , and by any available _ a priori _ information in real space .",
    "typically one imposes a `` support '' constraint in real space , namely imposing that the solution must be zero outside a certain region .",
    "support information is in many cases sufficient to retrieve the phase and the algorithm is very robust against noise and also missing information @xcite . in most applications ,",
    "phase retrieval algorithms aim at solving some imaging problem and therefore are naturally implemented with 2d data .",
    "when a 1d problem is to be treated , fundamental ambiguities in the solution do exist @xcite , which we will briefly describe in the following .",
    "let @xmath19 denote the bunch distribution in the time domain .",
    "it is straightforward to prove that for any given real numbers @xmath20 and @xmath21 , the amplitudes of the ft of the functions @xmath22 , @xmath23 , @xmath24 and @xmath25 are the same ( the symbol @xmath26 denotes complex conjugation ) . in other words",
    "if the distribution is changed with any of the above transformations , the measured spectrum @xmath27 will be unchanged . while a constant shift and a constant phase are actually trivial ambiguities , the ambiguity between @xmath22 and @xmath25 is more complicated to handle . in imaging it represents the so called `` twin - image '' problem ( see @xcite for a recent review ) .",
    "this problem corresponds to the stagnation of the iterative algorithm which is unable to converge on either @xmath22 or @xmath25 and keeps bouncing between a combination of the two .",
    "fienup @xcite reported iterative retrieval of 1d functions pointing out that depending on the constraints applied , the 1d iterative procedure can have a unique solution or multiple yet correlated solutions .",
    "the presence of correlated solutions and the poor convergence due to the presence of twins is very significant for the reconstruction of longitudinal bunch profiles , as the set of possible solutions becomes very large .",
    "for instance when the distribution is asymmetric and composed of multiple , partially overlapping peaks , the relative heights and widths of the peaks can be incorrectly reconstructed due to the presence of twins of possible solutions .",
    "recently , a method was proposed to improve the reconstruction of a 1d signal from a single measurement of the magnitude of its ft @xcite .",
    "the method works in two steps .",
    "the first step is an iterative phase retrieval algorithm employing known numerical strategies such as hybrid input - output or error reduction @xcite .",
    "this procedure is repeated many times with different independent random choices of the initial phase @xmath28 and the corresponding set of independent reconstructions is stored . at this point",
    "the second step is taken , consisting in a post - selection of the reconstructions on the basis of their cross - correlations with a reference reconstruction .",
    "the selected profiles are then averaged to produce the final result .",
    "therefore , while ambiguities and poor reconstructions can still affect each individual solution , the post - selection ensures that only the significant reconstructions are considered . in the next section",
    "we describe in detail both steps of the method .",
    "in this section we describe the strategies to implement the iterative phase retrieval procedure optimized for the measurement of an electron bunch profile .",
    "as anticipated , the method is divided in two steps , the first consisting of many independent runs of a suitable iterative phase retrieval algorithm , followed by result post - selection .",
    "the aim is to reconstruct the electron bunch longitudinal distribution @xmath22 from the knowledge of the measured spectrum amplitude @xmath29 .",
    "the flow chart of the algorithm is depicted in fig .",
    "[ fig : scheme ] . in practice",
    "we deal with discrete arrays of data , therefore in the following we shall use the discrete notation @xmath30 to denote the @xmath16-th element of the array @xmath31 .",
    "lower - case symbols will denote arrays in real space ( time domain ) while capital letters will indicate arrays in fourier space ( frequency domain ) the iterations start by defining a random array @xmath32 and assign it as phase to the measured amplitude , thus building the complex - valued spectrum at the zero - th iterate : @xmath33 . then the following sequence is iterated :    1 .",
    "inverse ft the function @xmath34 to get the zero - th estimate of the bunch longitudinal distribution @xmath35 ; 2 .",
    "impose the time domain constraints , by applying any _ a priori _ information on the distribution , to get an updated time domain function @xmath36 ; 3 .",
    "calculate its ft , to get a subsequent estimate in the frequency domain @xmath37 and calculate its phase @xmath38 ; 4 .",
    "update the frequency domain iterate by imposing the frequency domain constraint ( i.e. the measured data ) , @xmath39 ;    the procedure is iterated until convergence is attained , i.e. the solution does not appreciably change with further iterates . to monitor the quality of the convergence two different figures of merit ( foms )",
    "the first accounts for the variation of the time domain function between subsequent iterates @xmath40 where @xmath41 is the iteration index .",
    "we assume that the convergence is reached whenever @xmath42 becomes less than some threshold value .",
    "in addition , a second figure of merit is employed defined as @xmath43 @xmath44 is used to monitor how close the @xmath45 estimate of the amplitude of the frequency domain function  before applying the frequency domain constraint  is to the measured data . by minimizing both figures of merit",
    "we ensure that the algorithm is both converging and the solution is close to the actual measured data .",
    "the constraint in the time domain is imposed by using all types of _ a priori _ information that are available for the problem under study . for the results reported here we used a geometrical constraint , that means imposing",
    "the bunch length can not exceed a certain duration .",
    "such duration  which we call `` support ''  is especially important to guarantee the convergence of the algorithm . if it is too small the algorithm fails to converge because it can not find a suitable solution fitting within the support size .",
    "if the support is too large it is likely that two or more ambiguous solutions are present at the same time , resulting in a poor convergence @xcite .",
    "the support can be approximately estimated by the auto - correlation function associated with the measured spectrum @xcite but care must be used if the longitudinal bunch distribution has multiple adjacent peaks or long tails , as we shall discuss in the next section .",
    "an additional simplification ( that may be included as support ) comes from the nature of the function to be retrieved .",
    "the longitudinal profile of the electron bunch has to be necessarily described by a real and positive function .",
    "this fact reduces the ambiguity of hermitian conjugation to a simpler time reversal . to update the solution at each step using the time domain constraints",
    ", we used several cycles , each composed of a combination of hybrid input - output ( hio ) followed by error reduction ( er ) algorithms @xcite . the hio is known to ensure a faster convergence , being less prone to stagnations , while the er steps are beneficial in reducing the reconstruction errors .",
    "a last remark concerns the possibility of dynamically updating the support to closely follow the object reconstruction .",
    "this corresponds to the so - called `` shrink - wrap '' algorithm @xcite and it has been successfully adapted to the phase retrieval applied to ctr @xcite where the authors were able to reduce the effects of ambiguities using this feature .",
    "this is indeed very beneficial when the distribution is composed of a single pulse with short tails ( such as a gaussian ) or multiple well separated pulses . in this case",
    "the procedure will reduce the support size to the approximate size of the pulse ( or the multiple pulses ) and the algorithm will converge easily to the right shape . as we will discuss in the following ,",
    "problems arise when the profile has long tails ( as in a lorentzian profile ) or it is composed of partially overlapping pulses . in this case",
    "the support constraint can not be very strict and the convergence of the iterative procedure is generally poorer .",
    "therefore in this study we did not adopt a shrink - wrap option but introduced a solution - sorting procedure as a second step .",
    "this procedure closely follows the one described in @xcite which we shall summarize here . from the first step of the method we obtain a set of @xmath7 independent results , each result being contained in an array with size @xmath46 .",
    "let us denote by @xmath47 the pixel @xmath16 of the @xmath48-th result , where @xmath49 and @xmath50 .",
    "we shall denote with @xmath51 the array @xmath48 .",
    "the aim of the post - selection procedure is to select the best results and average them , considering the figures of merit defined in the previous sub - section .",
    "associated with each result are the values @xmath52 and @xmath53 calculated with eqs .",
    "( [ delta ] ) and ( [ epsilon ] ) respectively at the last step of each iteration run .",
    "the specific values of these foms vary depending on the profile to be reconstructed , typically values of @xmath54 indicate an acceptable convergence .",
    "if the values of the foms fail to meet this criterion the results are discarded , so that the set of @xmath7 results obtained at the end will meet the required level of convergence .",
    "the @xmath7 results will be affected by ambiguities described above , the most important in our case being translation shift , time reversal or a mild problem related to the presence of twins.the key step at this point is to select the best solution obtained , seeking the lowest value of @xmath55 , indicating that the modulus of the reconstructed function in fourier space is very close to the measured data .",
    "we then check that , associated with this solution , also that @xmath52 has a low value , indicating that the algorithm did effectively converge . typically when @xmath55 is small , @xmath52 is also small , while the converse is not always true , i.e. it is possible for the algorithm to converge to the wrong solution .",
    "the solution having the smallest value of @xmath55 is chosen as the reference reconstruction , denoted by @xmath56 in the following .",
    "every other solution is quantitatively compared to the reference by calculating the cross - correlation : @xmath57 the cross correlation is calculated for each solution as a function of the relative shift @xmath58 .",
    "this procedure is necessary to account for any shift ambiguity that might be present . in practice",
    "@xmath58 is a cyclic shift , i.e. one always considers @xmath59 . to account for the time reversal ambiguity a second cross correlation array",
    "is also computed : @xmath60 in eq .",
    "( [ cc2 ] ) each array is reversed before computing the cross correlation . in order to choose between ambiguous solutions one",
    "compares the cross correlations in eqs .",
    "( [ cc1 ] ) and ( [ cc2 ] ) . in practice , denoting with @xmath61 and @xmath62 the values of the shift that maximize eqs .",
    "( [ cc1 ] ) and ( [ cc2 ] ) respectively , this corresponds to seeking the maximum between @xmath63 and @xmath64 : @xmath65 the value of @xmath66 indicates how well a solution is correlated with the reference . therefore only solutions that after this procedure have a high correlation ( say @xmath67 ) are averaged .",
    "figure [ fig : scheme ] shows the algorithmic flow of the method .",
    "we performed the phase retrieval with the procedure described in the previous section using simulated spectra of four representative distributions : gaussian , lorentzian , different superpositions of the two and a profile modeling that in a bunch compressor .",
    "the gaussian case is the easiest and very good reconstructions can be obtained both with the kk method @xcite and with the phase retrieval method @xcite , as shown in fig .",
    "the gaussian has been simulated using rms width @xmath6870 and its maximum amplitude value was set to unity . on the contrary , the reconstruction of a lorentzian pulse is non - trivial in both scenarios , but for different reasons .",
    "the complex spectrum associated with a lorentzian distribution has zeroes in the upper half complex plane close to the real axis , therefore the kk method ( based on the minimal phase ) is not able to reconstruct the pulse shape properly . at the same time",
    "a lorentzian curve has long tails , comparatively longer than a gaussian .",
    "this fact makes the phase retrieval reconstruction based on geometrical support constraint also problematic , as the approximation of time - limited ( bound ) signal is not completely met .",
    "a satisfactory reconstruction is attained by increasing the size of the support ( compared to the fwhm of the pulse ) .",
    "this improves the convergence even though some distortion is still present in the pulse tails , as evident from fig .",
    "the fwhm of the simulated lorentzian was @xmath6950 .",
    "when random noise is added to the pulse , the performance of the iterative algorithm is still robust .",
    "[ fig2]c shows the gaussian case with noise .",
    "it is worth noting that the kk reconstruction , which works well for a noiseless gaussian , has some issues when noise is added .",
    "this is not surprising considering that the spectrum amplitude is no longer a smooth analytic function , so the hilbert transform relation between the amplitude and phase can only be approximately true . using the iterative procedure ,",
    "the retrieved profile with noise always appear smoother due to the averaging during the post - selection process .",
    "these observations are confirmed when a lorentzian pulse with noise is simulated ( fig .",
    "[ fig2]d ) .",
    "the iterative algorithm is still capable of reproducing the tails of the pulse correctly , while displaying a slightly larger width .             in fig .",
    "[ fig3 ] the retrieved shapes from simulated spectra related to double pulses are shown .",
    "the simulated bunches contain different superpositions of a gaussian and a lorentzian shape with different degree of overlap , which can be typical of many experimental situations . in all cases we considered a gaussian with @xmath6870 and a lorentzian with width @xmath6950 .",
    "the maximum value of the gaussian was set to 60@xmath70 of the corresponding value for the lorentzian and the maximum height of the whole profile has been normalized to unity .",
    "we studied the effect of varying the separation between the pulses and compared the results from the iterative reconstruction to those with the kk method .     and a lorentzian with width @xmath71 ( see text ) .",
    "the distance @xmath72 between the peak centers is varied ( a ) @xmath73 .",
    "( b ) @xmath74 .",
    "( c ) @xmath75 .",
    "( d ) @xmath75 with noise added.,title=\"fig : \" ]   and a lorentzian with width @xmath71 ( see text ) .",
    "the distance @xmath72 between the peak centers is varied ( a ) @xmath73 .",
    "( b ) @xmath74 .",
    "( c ) @xmath75 .",
    "( d ) @xmath75 with noise added.,title=\"fig : \" ]   and a lorentzian with width @xmath71 ( see text ) .",
    "the distance @xmath72 between the peak centers is varied ( a ) @xmath73 .",
    "( b ) @xmath74 .",
    "( c ) @xmath75 .",
    "( d ) @xmath75 with noise added.,title=\"fig : \" ]   and a lorentzian with width @xmath71 ( see text ) .",
    "the distance @xmath72 between the peak centers is varied ( a ) @xmath73 .",
    "( b ) @xmath74 .",
    "( c ) @xmath75 .",
    "( d ) @xmath75 with noise added.,title=\"fig : \" ]    fig .",
    "[ fig3]a shows the reconstruction obtained when the distance between the centers of the peaks is 40 . in this case",
    "the profile appears rather asymmetric with different tails .",
    "the iterative reconstruction is very close to the input profile , while an evident discrepancy appears for the kk reconstruction .",
    "a similar conclusion can be drawn from fig .",
    "[ fig3]b where the separation between the peak centers is 100 but the two peaks are still partially overlapping .",
    "a value of 200 for the peak separation has been chosen for the results shown in fig .",
    "[ fig3]c , without noise , and in fig .",
    "[ fig3]d , with noise , respectively . in this case",
    "the overlap between the pulses is much reduced and detrimental effects of time reversal ambiguities appear to be stronger .",
    "in particular the relative heights of the peaks is not correctly reproduced and , when noise is present , distortions in the tails do appear .    we have also tested the reconstruction with a theoretical model of the profile expected in a bunch compressor @xcite .",
    "the profile is given by the convolution s[z,_1,_2 ] = _ -^dt ( -(z - t ) ) [ eq : bc_prof ] where @xmath76 is the heaviside theta function and @xmath77 .",
    "the input profile with @xmath78 , the reconstructed iterative and kk profiles are shown in fig .",
    "[ fig : bcprof ] .    ) , with the iterative ( red ) and kk ( blue ) methods . ]    as with the lorentzian , the iterative reconstruction requires that the support be large enough to accommodate the long tails . when that is done , the reconstructed iterative profile here is very close to the input profile . by comparison ,",
    "the kk method yields a much narrower profile , falls off more quickly at both the head and the tail and is not as accurate as the iterative profile .",
    "this last result in particular shows that the iterative method is well suited for reconstructing bunch profiles in a photoinjector .",
    "the data used here were taken at fermilab s a0 photoinjector during 2011 .",
    "this was during a period when the tevatron collider was operational and liquid helium was available for a 9-cell superconducting cavity in the beamline .",
    "we describe the experimental setup briefly here , more complete descriptions can be found in @xcite .",
    "electron pulses are generated with a cste photo - cathode within a 1.3 ghz rf gun and then accelerated with a 1.3ghz superconducting rf cavity to an energy of about 15 mev .",
    "bunch charge could be varied over the range 250pc - 1nc . a transverse to longitudinal emittance exchange ( eex ) section consisting of a transverse deflecting mode cavity placed between two doglegs",
    "could be used to vary the bunch length by changing quadrupole settings upstream of the eex @xcite .",
    "in addition , the bunch length could also be controlled by varying the off - crest rf phase ( aka energy chirp ) in the 9-cell accelerating superconducting cavity which was upstream of the eex section .",
    "downstream of the eex , the beam passed through a thin metallic foil ( al coating on si substrate ) generating coherent transition radiation ( ctr ) in the process .",
    "the radiation entered a martin - puplett interferometer which uses a polarizing splitter to send the radiation along two orthogonal arms with mirrors at the ends .",
    "the mirrors change the polarizations and the beams after reflection are recombined using the same splitter and then sent to two pyroelectric detectors after being split again with another polarizing splitter .",
    "one of the arms is movable so the path length between the interfering beams can be varied .",
    "an interferogram or auto - correlation function @xmath79 is obtained from the intensity in the detectors ; measured as a function of @xmath80 where @xmath81 is the path length difference from the central beam splitter to the two mirrors .",
    "the real part of the fourier transform of the auto - correlation function yields the intensity spectrum @xmath82 .",
    "the detector s response is frequency dependent and is limited at low frequencies by the thickness of the pyroelectric crystal .",
    "consequently the measured response drops to zero at frequencies below about 0.1 thz .",
    "this is corrected during post - processing with a parabolic fit which smoothly extends the response to zero frequency @xcite .",
    "we use the corrected intensity curves in the following .",
    "figure [ fig5 ] shows the reconstructed profiles from measurements taken over four different days . in these measurements",
    ", the bunch length was varied only by changing quadrupole settings upstream of the eex and no energy chirp was applied .",
    "both the kk and the iterative profiles are shown in fig .",
    "[ fig5 ] and they are scaled to the same peak height for ease of comparison .",
    "a simple analysis shows that when the finite length of the rf cavity is included , the longitudinal position of particles and therefore bunch profile after the emittance exchange is affected by the relative energy deviation prior to the exchange @xcite .",
    "this was tested on another day when the effect of an energy chirp on the bunch length was measured by varying the off - crest rf phase .",
    "the coherent synchrotron radiation ( csr ) emitted in the second dogleg was monitored and at the maximum compression ( 17@xmath83 off - crest ) the csr power reached its peak value .",
    "a discussion of this measurement and the csr emitted by these bunches can be found in @xcite .",
    "the auto - correlation function was measured with the chirp set at maximum compression and also without any chirp and are shown in fig .",
    "[ fig6 ] . as expected , the auto - correlation with the chirp has a significantly smaller full width at half maximum ( fwhm ) .",
    "figure [ fig7 ] shows the reconstructed profiles of these two cases , both with the iterative and the kk method .",
    "again , the profiles have been scaled to the same peak height .",
    "figure [ fig : fig8 ] shows a comparison of the minimal phase used in the kk method with the nonlinear ( in frequency ) part of the phase obtained with the iterative reconstruction for the compressed profile .",
    "the difference may be attributed to the blaschke contribution to the minimal phase .",
    "we note that both reconstructions will have the same autocorrelation function , since this function is obtained from the fourier transform of the intensity , which by construction is the same for both methods .",
    "it is instructive to compare the quality of the reconstructions of simulated profiles to understand the merits and limitations of the iterative algorithm plus post - selection , over the kk method . both the new method and the kk method",
    "perform very well for the reconstruction of the gaussian profile alone  fig .",
    "the fwhms from the two methods are shown in table 1 .",
    "the new method presented here tends to overestimate the fwhm while a slight under - estimate result from the kk .",
    "the reason for the over - estimate lies in the post - selection procedure . while averaging the best correlated solutions , a residual translation shift between them will result in an overall larger average .",
    "nevertheless the effect is relatively small ( @xmath84 ) and of little importance under normal circumstances .",
    "the same effect is more significant in the reconstruction of the lorentzian bunch , shown in fig .",
    "the overestimation of the peak width is comparatively larger here because , in order to correctly reproduce the long tails typical of the lorentzian , the geometrical support constraint must be loosened , and this in turn produces a poorer localization of the peak .",
    "therefore when averaging the results the presence of this residual shift ambiguity is more significant and yields a larger overestimation of the width .",
    "nevertheless the profile shape closely follows the correct profile .",
    "the kk method on the other hand produces a steep vertical slope on one side and a more slowly falling slope on the other side .",
    "these effects , arising from ignoring the blaschke phase , seems to be characteristic of the kk method when reconstructing profiles with long tails , like lorentzians . from this discussion",
    "we conclude that the support size is an extremely critical parameter , when reconstructing a bunch with long tails .",
    "we chose the optimal support size by seeking the best reconstruction in preliminary runs of the algorithm .",
    "if the support is too small compared to the profile width , the algorithm fails to converge and secondary small peaks may appear .",
    "quantitatively this is manifested by both foms @xmath85 and @xmath86 failing to decrease .",
    "therefore the procedure is to increase the support size , which automatically produces smaller value of @xmath86 ( i.e. increasing the support size makes the time domain constraint less and less effective ) .",
    "therefore the optimal support size , on average , guarantees a low value of @xmath85 while avoiding stagnation of the algorithm .",
    "profile type & fwhm input & fwhm kk & fwhm iterative + gaussian & 165 & 163 & 170 + lorentzian & 50 & 64 & 68 + gaussian w noise & 165 & 160 & 170 + lorentzian w noise & 50 & 68 & 64 + bunch compressor profile & 114 & 57 & 100 + [ table1 ]    the case of a double pulse is more convoluted . when two or more peaks are present , the time reversal ambiguity plays a much more critical role .",
    "incorrect reconstructions often contain twins resulting in a larger number of peaks or in an incorrect estimation of the peak heights and widths . in this case",
    "the solution sorting procedure is a key factor in filtering out incorrect reconstructions .",
    "the comparison in fig .",
    "[ fig3 ] , between the iterative reconstruction and the kk method shows that the former always produces a result much closer to the input profile .",
    "specifically , the peak positions are always correctly estimated .",
    "nonetheless the quality of the reconstruction critically depends on the peak separation .",
    "the iterative reconstructions are extremely close to the simulated profiles for small peak separation ( see fig .",
    "[ fig3 ] a and b ) while becoming worse when the separation increases .",
    "notably the relative peak height is not faithfully reproduced .",
    "the dip between the peaks is more correctly reproduced with the iterative reconstruction .",
    "the same differences persist between the two methods in the reconstruction of the theoretical profile in a bunch compressor given by eq.([eq : bc_prof ] ) .",
    "the kk method produces a steeper vertical slope at the head and a fwhm half that of the input profile .",
    "the iterative method profile matches the profile closely both at the head and the tail and a fwhm close to that of the input .",
    "it is worth noting that the cases studied here  either the lorentzian profile , the bunch compressor profile or the partially overlapping peaks  are generally hard to tackle with algorithms of the kind of `` shrink - wrap '' .",
    "the double peak case is especially complicated as the shrink - wrap is able to restrict the support to the total extent of the profile , but ambiguities can still be present in reconstructing the position / width of each individual pulse .",
    "profile date & fwhm kk [ ps ] & fwhm iterative [ ps ] + may9 & 1.2 & 1.2 + aug 24 & 0.8 & 1.1 + aug 25 & 0.6 & 0.8 + oct 5 & 0.6 & 1.2 + jul 1 , with chirp & 0.8 & 0.5 + jul 1 , no chirp & 1.4 & 1.5 + [ table : fwhm ]    the comparison of the experimental profiles in fig .",
    "[ fig5 ] shows similarities and differences that are consistent over the measured profiles .",
    "table [ table : fwhm ] shows the fwhms from the two methods for the experimental profiles .",
    "profile ( a ) from may 9 is seen to have only a single peak in both reconstructions .",
    "as before , the kk profile shows a very steep slope at the head of the pulse while the iterative profile builds up more gradually .",
    "this feature is repeated in all the measured profiles and was also seen in the simulated profiles of figs .",
    "[ fig2 ] , [ fig3 ] and [ fig : bcprof ] .",
    "the iterative profiles have higher secondary peaks in cases ( b),(c),(d ) in fig . [ fig5 ] and do not have the multiple small peaks in the tail when compared to the kk profiles .",
    "if real , these small peaks in the profile tails would indicate high frequency micro - structure these are unlikely to be present in the a0 photoinjector bunches given the relatively low charge and the lack of external excitations .",
    "it is therefore possible that the iterative reconstruction avoids the appearance of unphysical micro - structure , but this needs to be verified with detailed studies in the asta photoinjector . comparing the profiles in fig .",
    "[ fig7 ] , we find that both methods show that the chirp reduced the pulse width relative to the unchirped case but the iterative profile is narrower",
    ". the kk profile does not show that the additional compression with the chirp reduced the fwhm compared to profiles obtained without chirp on other days , e.g. compared to the profiles seen in figs [ fig5]c and [ fig5]d .",
    "the iterative profile on the other hand shows that the chirp results in the smallest fwhm among all profiles .",
    "this corresponds nicely to the auto - correlation function ( seen in fig [ fig6 ] ) of the chirped pulse which also had the the smallest fwhm amongst all auto - correlations considered here .",
    "this is again suggestive , but not definitive evidence , that the iterative reconstruction may be more accurate . in concluding the section",
    ", it is worth commenting on the run time for the algorithm s execution .",
    "clearly the number of steps required to perform the method implies a larger run time when compared to the kk method . in our case",
    "the iterative algorithm was found to generally converge within 3000 iterations for the experimental data , with running time of about 635 ms on 1024 data points on a single - cpu 3.3 ghz processor .",
    "the total time is then increased by the number of independent runs that are performed leading to a total run time of few minutes for 22 iterations including data i / o . in comparison the kk method , which involves a simple fft operation , completes in about 1 ms on the same machine . despite being longer , the run time of the iterative algorithm is still compatible with the use of the technique for on - line analysis of the longitudinal properties of electron bunches .",
    "we have described a two - step iterative phase retrieval method to reconstruct the phase of the spectrum from the measured spectrum amplitude . in the first step ,",
    "multiple reconstructions are performed with different initial random phases . during each reconstruction ,",
    "constraints in frequency space and real space are applied successively . only those solutions are kept which are both sufficiently close to measured spectrum amplitude and have a high rate of convergence . in the second step ,",
    "a post selection method using cross - correlations is employed to remove ambiguities related to translation and reversal in real space .",
    "the final solution is obtained by averaging over the solutions surviving the post - selection step .",
    "the post - selection is crucial in removing these troublesome ambiguities that are common with complicated profiles such as those with multiple peaks .    in applying this procedure to gaussians , lorentzians ,",
    "sums of lorentzians and gaussians and a profile expected from a bunch compressor , we found that this iterative method is able to retrieve the profiles with reasonable accuracy and much more faithfully than the kramers - kronig method based on the minimal phase .",
    "the latter method is known to be inaccurate for profiles with long - tails . when applied to experimental data taken at the a0 photoinjector , the iterative method yielded profiles without some of the unphysical features in the profiles of the minimal phase kk method .",
    "the major drawback of the iterative method at present is its iterative nature , so it takes longer and requires some trial and error before the optimal solution is found . with some additional work , this procedure could be automated and made available in control room applications .",
    "* acknowledgments * d.p . acknowledges the support of the australian research council . t.s",
    "thanks charles thangaraj and randy thurman - keup for generously sharing their data and useful discussions .",
    "fermilab is operated by fermi research alliance , llc under contract no .",
    "de - ac02 - 07ch11359 with the united states department of energy .",
    "carneiro et al , phys . rev .",
    "st accel beams , * 8 * , 040101 ( 2005 ) a. lumpkin and j. ruan , proceedings of the beam instrumentation workshop 08 , p 258 ( 2008 ) . z. huang et al , proceedings of the 2011 particle accelerator conference , p 2459 ( 2011 ) ilc technical design report , arxiv:1306.6328 p. piot et al , proceedings of the 2013 particle accelerator conference , p 67 ( 2013 ) i. wilke et al , phys .",
    "rev . lett,*88 * , 124801 ( 2002 ) r. akre et al , proceedings of the 2001 particle accelerator conference , p 2353 ( 2001 ) r. lai , u. happek and a.j .",
    "sievers , phys .",
    "e 50 , r4294-r4297 ( 1994 ) .",
    "r. lai and a.j .",
    "sievers , phys .",
    "e 50 , r3342-r3344 ( 1994 ) .",
    "r. lai and a.j .",
    "sievers , phys .",
    "e 52 , 4576 - 4579 ( 1995 ) r. lai and a.j .",
    "sievers , nucl .",
    "instrum . meth .",
    "a 397 , 221 - 231 ( 1997 ) .",
    "g. schneider , r. lai , w. walecki and a.j .",
    "sievers , nucl .",
    "instrum . meth .",
    "a 396 , 283 - 292 ( 1997 ) .",
    "d. mihalcea , c.l .",
    "bohn , u. happek , and p. piot , phys .",
    "beams 9 , 082801 ( 2006 ) .",
    "_ , phys . rev .",
    "st accel . beams 16 , 040701 ( 2013 ) .",
    "gerchberg and w.o .",
    "saxton , optik ( stuttgart ) 35 , 237 - 250 ( 1972 ) .",
    "fienup , opt .",
    "lett . 3 , 27 - 29 ( 1978 ) .",
    "fienup , appl .",
    "21 , 2758 - 2769 ( 1982 ) .",
    "a. marinelli et al , phys .",
    "lett . , * 110 * , 094802 ( 2010 ) d.m .",
    "paganin , coherent x - ray optics , clarendon press , oxford , 2006 .",
    "bates , optik 61 , 247 - 262 ( 1982 ) .",
    "d. pelliccia , d.m .",
    "paganin , a. sorrentino , i. bukreeva , a. cedola , s. lagomarsino , opt .",
    "37 , 262 - 264 ( 2012 ) .",
    "millane , j. opt .",
    "am . a 7 , 394 - 411 ( 1990 )",
    "humphry , b. kraus , a.c .",
    "hurst , a.m. maiden , j.m .",
    "rodenburg , nature comm . 3 , 730 ( 2012 ) .",
    "nugent , adv .",
    "59 , 1 - 99 ( 2010 ) .",
    "j. c. h. spence , u. weierstall , and m. howells .",
    "a * 360 * , 875 - 895 ( 2002 ) .",
    "m. guizar - sicairos and j.r .",
    "fienup , j. opt .",
    "a 29 , 2367 - 2375 ( 2012 ) .",
    "fienup , t.r .",
    "crimmins , and w. holsztynski , j. opt .",
    "72 , 610 - 624 ( 1982 ) .",
    "s. marchesini _",
    "et al . _ ,",
    "phys . rev .",
    "b 68 , 140101r ( 2003 ) .",
    "r. li , proc xx international linac conf . ,",
    "p 262 ( 2000 ) l. frohlich , desy - thesis-2005 - 011 ( 2005 ) r. thurman - keup et al , proceedings of the beam instrumentation workshop 08 , p 153 ( 2008 ) .",
    "j. ruan et al , phys .",
    "lett , * 106 * , 244801 ( 2011 ) j.c.t .",
    "thangaraj et al , phys .",
    "rev.st-ab , * 15 * , 110702 ( 2012 )"
  ],
  "abstract_text": [
    "<S> the coherent radiation emitted by an electron bunch provides a diagnostic signal that can be used to estimate its longitudinal distribution . </S>",
    "<S> commonly only the amplitude of the intensity spectrum can be measured and the associated phase must be calculated to obtain the bunch profile . </S>",
    "<S> very recently an iterative method was proposed to retrieve this phase . </S>",
    "<S> however ambiguities associated with non - uniqueness of the solution are always present in the phase retrieval procedure . here </S>",
    "<S> we present a method to overcome the ambiguity problem by first performing multiple independent runs of the phase retrieval procedure and then second , sorting the good solutions by mean of cross - correlation analysis . </S>",
    "<S> results obtained with simulated bunches of various shapes and experimental measured spectra are presented , discussed and compared with the established kramers - kronig method . </S>",
    "<S> it is shown that even when the effect of the ambiguities is strong , as is the case for a double peak in the profile , the cross - correlation post - processing is able to filter out unwanted solutions . </S>",
    "<S> we show that , unlike the kramers - kronig method , the combined approach presented is able to faithfully reconstruct complicated bunch profiles .    phase retrieval , electron bunch longitudinal profile , kramers - kronig , iterative method , coherent transition radiation , photoinjector </S>"
  ]
}