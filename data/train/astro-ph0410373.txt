{
  "article_text": [
    "large scale structures like galaxies and clusters of galaxies are believed to have formed by gravitational amplification of small perturbations @xcite .",
    "observations suggest that the initial density perturbations were present at all scales that have been probed by observations .",
    "an essential part of the study of formation of galaxies and other large scale structures is thus the evolution of density perturbations for such initial conditions .",
    "the basic equations for this have been known for a long time and these equations are easy to solve when the amplitude of perturbations is small .",
    "once the amplitude of perturbations at relevant scales becomes large , i.e. , @xmath1 , the perturbation becomes non - linear and the coupling with perturbations at other scales can not be ignored . the equation for evolution of density perturbations can not be solved for generic perturbations in the non - linear regime .",
    "n - body simulations are often used to study the evolution in this regime , unless one requires only a limited amount of information and quasi - linear approximation schemes or scaling relations @xcite suffice .    in n - body simulations",
    ", we simulate a representative region of the universe .",
    "this representative region is a large but finite volume and periodic boundary conditions are often used ",
    "this is necessary considering the the universe does not have a boundary .",
    "typically the simulation volume is taken to be a cube .",
    "effect of perturbations at scales smaller than the mass resolution of the simulation , and of perturbations at scales larger than the box is ignored .",
    "indeed , even perturbations at scales comparable to the box are under sampled .",
    "it has been shown that for gravitational dynamics in an expanding universe , perturbations at small scales do not influence collapse of large scale perturbations in a significant manner as far as the correlation function or power spectrum at large scales are concerned .",
    "therefore we may assume that ignoring perturbations at scales much smaller than the scales of interest does not affect results of n - body simulations .",
    "however , there may be other effects that are not completely understood at the quantitative level @xcite .",
    "perturbations at scales much larger than the simulation volume can affect the results of n - body simulations .",
    "use of periodic boundary conditions implies that the average density in the simulation box is same as the average density in the universe , in other words we are assuming that there are no perturbations at the scale of the simulation volume ( or at larger scales ) .",
    "therefore the size of the simulation volume should be chosen so that the amplitude of fluctuations at that scale ( and at larger scales ) is ignorable .",
    "if the amplitude of perturbations at larger scales is not ignorable and the simulations do not take the contribution of these scales into account then clearly the simulation will not be a faithful representation of the model being simulated .",
    "it is not obvious as to when fluctuations at larger scales can be considered ignorable . in this paper",
    "we will propose one method of quantifying this concept .    if the amplitude of density perturbations at the box scale is small but not ignorable",
    ", simulations underestimate the correlation function though the number density of small mass haloes does not change by much @xcite . in other words ,",
    "the formation of small haloes is not disturbed but their distribution is affected by non - inclusion of long wave modes . the mass function of massive haloes changes significantly @xcite . the void spectrum is also affected by finite size of the simulation volume if perturbations at large scales are not ignorable @xcite .",
    "significance of perturbations at large scales has been discussed in detail and a method ( map ) has been devised for incorporating the effects of these perturbations @xcite .",
    "these methods make use of the fact that if the box size is chosen to be large enough then the contribution of larger scales can be incorporated by adding displacements due to the larger scales independently of the evolution of the system in an n - body simulation . but",
    "this again brings up the issue of what is a large enough scale in any given model such that these methods can be used to add the effect of larger scales without introducing errors .",
    "large scales contribute to displacements and velocities , and variations in density due to these scales modify the rate of growth for small scales perturbations @xcite .",
    "the map algorithm @xcite can be improved by adding corrections for this effect @xcite .",
    "the motivation for developing these tools was to enlarge the dynamic range over which results of n - body simulations are valid by adding corrections that change the distribution of matter and velocities at scales comparable to the simulation volume .",
    ".this table lists parameters of n - body simulations we have used .",
    "all the simulations were done using the treepm code , configuration described in bagla and ray ( 2003 ) .",
    "we simulated the @xmath0cdm model with @xmath2 , @xmath3 , @xmath4 , @xmath5 and @xmath6 .",
    "the first column lists name of the simulation , second column lists the number of particles in the simulation , the third column is the size of the box in physical units , fourth column lists the softening length for force and the last column lists the cutoff used in units of the fundamental mode of the box @xmath7 .",
    "phases were kept the same for the simulations listed here in order to make the comparison meaningful . [ cols=\"<,<,<,<,<\",options=\"header \" , ]     our motivation in this work is to understand the effect of large scales on scales that are much smaller than the simulation volume .",
    "we run a series of numerical experiments , these are described in  2 .",
    "we discuss the proposed method of quantifying the effect of large scales in  3 . here",
    ", we propose a measure based on mass functions .",
    "the minimum size of simulation volume for @xmath0cdm model as a function of redshift is presented here .",
    "we carried out two series of n - body experiments in order to study the effect of perturbations at large scales on perturbations at small scales .",
    "the simulations were carried out using the treepm method @xcite and its parallel version @xcite .",
    "we simulated the @xmath0cdm model with @xmath2 , @xmath3 , @xmath8 , @xmath5 and @xmath6 . in each of these series of simulations we ran a simulation without any truncation of the power spectrum ,",
    "save those imposed by the finite size and resolution of the simulation box .",
    "these simulations served as a reference for other simulations where we truncated the power spectrum at small wave numbers .",
    "we used a sharp cutoff such that the power spectrum at @xmath9 was taken to be zero .",
    "a comparison of these simulations allows us to estimate the effect of density perturbations at large scales on growth of perturbations at small scales .",
    "detailed specifications of these simulations are listed in table  1 where the cutoff wave number is listed in the units of the fundamental mode @xmath10 of the simulation box .     as a function of @xmath11 for the models listed in table  1 .",
    "the amplitude of the correlation function decreases as cutoff becomes smaller .",
    "the lower panel shows the deviation of @xmath12 for models with an explicit cutoff from the simulation t_300_c_0 .",
    "the correlation function is underestimated by about @xmath13 at @xmath14h@xmath15mpc for a cutoff of @xmath16h@xmath15mpc.,title=\"fig:\",width=316 ]   as a function of @xmath11 for the models listed in table  1 .",
    "the amplitude of the correlation function decreases as cutoff becomes smaller .",
    "the lower panel shows the deviation of @xmath12 for models with an explicit cutoff from the simulation t_300_c_0 .",
    "the correlation function is underestimated by about @xmath13 at @xmath14h@xmath15mpc for a cutoff of @xmath16h@xmath15mpc.,title=\"fig:\",width=316 ]     as a function of @xmath11 for the models listed in table  1 .",
    "the skewness decreases sharply as cutoff becomes smaller.,width=316 ]    we compare the output of these simulations to see whether retaining or dropping long wave modes affects quantities of interest at smaller scales .",
    "nearly all the comparisons we carry out will concentrate on scales smaller than @xmath17h@xmath15mpc whereas the smallest cutoff we use is @xmath18h@xmath15mpc , so the two sets of scales are well separated in most cases we consider here .",
    "the amplitude of root mean square fluctuations in mass at @xmath19h@xmath15mpc and @xmath20 is @xmath21 in the model considered here and we can certainly consider this to be small .    figure  [ figcorr_cutoff ] shows the averaged correlation function @xmath12 as a function of @xmath11 at @xmath20 for the models listed in table  1 .",
    "the amplitude of the correlation function decreases as cutoff becomes smaller .",
    "the shape of the correlation function does not change at small scales .",
    "this result follows expectations and is indeed similar to figure  2 in @xcite .",
    "thus the overall effect of perturbations at very large scales is to enhance the amplitude of fluctuations at smaller scales .",
    "ignoring larger scales leads to an underestimate of correlation function at small scales .",
    "the correlation function is underestimated by @xmath13 at @xmath14h@xmath15mpc for a cutoff of @xmath16h@xmath15mpc . at this scale ,",
    "@xmath22 for @xmath20 in the model we have simulated .",
    "if we were to compute the linearly extrapolated @xmath12 then the difference between the model with and without cutoff is much smaller than @xmath13 .",
    "we have plotted the skewness @xmath23 as a function of scale in figure  [ figs3_cutoff ] for the same set of models .",
    "the difference in models here is significant .",
    "it is clear from these two figures that fairly large scales ( @xmath24h@xmath15mpc ) make a significant contribution to clustering at small scales ( @xmath25h@xmath15mpc ) .",
    "it is possible to correct for the contribution of larger scales for moments of particle distribution .",
    "thus if we are interested only in the moments then we can circumvent this problem and compute the correct answer .",
    "there are many quantities of interest other than the moments of distribution and there is no generic method for computing the corrections and take the effect of large scales into account .",
    "a method has been devised to incorporate the effect of displacements and velocities contributed by large scales @xcite . here ,",
    "displacements and velocities contributed by larger scales are computed using the zeldovich approximation and added to the numbers computed in the n - body simulations .",
    "essentially this assumes that there is no coupling in velocity contributed by modes within the box and modes larger than the box . with this assumption , other methods for computing the displacement due to modes outside the box",
    "can also be used in place of the zeldovich approximation .",
    "the assumption of no mode coupling is true only in the linear regime and hence we still require the amplitude of perturbations at the scale of the simulation box to be much smaller than unity .",
    "how small the amplitude should be can only be determined by trial and error .",
    "it has been pointed out that the effect of mode coupling can be emulated by enhancing the displacements without modifying the velocities @xcite .",
    "the amount of enhancement needed can not be derived from first principles .",
    "these tools essentially enhance the dynamic range on an n - body simulation by making these corrections , displacements due to large scales correct the velocity fields at scales comparable to the simulation volume .",
    "corrections to displacements and velocities can be made without worrying about mode coupling if their effect is small in some absolute sense .",
    "an important fact to keep in mind is that none of these methods can be effective if the displacements contributed by large scale modes move two collapsed objects to the same location , or move matter that has fallen into a collapsed structure out of it .",
    "if the contribution of modes that can affect collapsed structures is not taken into account then the properties of these objects , e.g. mass , angular momentum , density profile , etc .",
    ", may differ significantly from their asymptotic values .",
    "this is illustrated in figure  [ fig_part ] .",
    "this figure shows the projected particle distribution in the neighbourhood of a massive cluster from simulations of the @xmath0cdm model .",
    "four panels correspond to the models listed in table  1 .",
    "the total mass in the central massive halo decreases as the large scale cutoff is introduced and then decreased .",
    "the number , masses and the distribution of smaller clumps around the central clump also change significantly as the cutoff is reduced below @xmath26h@xmath15mpc .",
    "figure  [ fig_massfn ] shows the fraction of mass in collapsed structures with mass greater than @xmath27 for the models listed in table  1 .",
    "this fraction is plotted as a function of mass @xmath27 .",
    "the solid curve shows @xmath28 for the simulation without an explicit cutoff , of course there is an implicit cutoff at the box size ( @xmath29h@xmath15mpc ) .",
    "other curves mark the function for different values of the cutoff and as the cutoff scale becomes smaller @xmath28 decreases at large @xmath27 . at smaller masses ( @xmath30m@xmath31 ) , the difference in models is negligible .",
    "difference between different curves at the high mass ( @xmath32m@xmath31 ) end is significant , more than a factor two between the extreme curves . thus ignoring large scale modes results in an underestimate of the number of massive haloes .",
    "@xmath28 varies rapidly up to a cutoff of @xmath26h@xmath15mpc and changes very little as the cutoff moves to larger scales .",
    "we may conclude from here that scales larger than @xmath26h@xmath15mpc do not contribute significantly to collapsed structures in the currently favoured @xmath0cdm models .",
    "in the previous section we have argued that the non - trivial contribution of large scale modes is the one that leads to collapse of haloes , other effects like displacements can be incorporated , in principle , using algorithms like map @xcite .",
    "we can use this to devise a criterion to decide whether the box size of a simulation is sufficiently large or not .    the collapsed mass fraction in haloes of mass @xmath27 or larger is given by @xcite @xmath33   \\label{coll_mass}\\ ] ] the parameter @xmath34 indicates the linearly extrapolated density contrast at which the perturbation is expected to collapse and virialise in non - linear spherical collapse , its value is taken to be @xmath35 here .",
    "the precise value of this parameter is not very relevant here . here",
    "@xmath36 is the root mean square ( rms ) amplitude of fluctuations at the mass scale @xmath27 and redshift @xmath37 .",
    "@xmath38 ^ 2     \\nonumber \\\\ m & = & \\frac{4 \\pi}{3 } { \\bar\\rho } r^3   \\label{sig_int}\\end{aligned}\\ ] ] here @xmath39 is the power spectrum of density fluctuations , linearly extrapolated to @xmath20 and @xmath40 is the growing mode in the linear perturbation theory normalised so that @xmath41 . the average matter density in the universe is denoted by @xmath42 .",
    "in an n - body simulation , the initial conditions sample a range of values of wave number @xmath43 .",
    "the amplitude of _ rms _ fluctuations in the simulation will be different due to partial sampling of modes .",
    "the periodic boundary conditions restrict us to a discrete set of wave numbers in the range of scales studied and sampling is partial due to sparse sampling of @xmath44space at scales comparable to the size of the simulation volume .",
    "wave numbers smaller than the fundamental mode of the simulation volume are not sampled , nor are wave numbers larger than the nyquist frequency of the mesh used for generating initial conditions . from the form of the integral",
    "it is clear that at a given scale @xmath11 , wave modes with @xmath45 contribute more significantly than the rest . given this and the fact that most modern n - body simulations have sufficient dynamic range , we can concentrate on the lower limit of the range of wave numbers sampled in an n - body simulation as modes with @xmath46 do not influence scales resolved in the simulation in any significant manner .",
    "we can then estimate the _ rms _ fluctuations in n - body simulations by changing the lower limit of the integral in eqn.([sig_int ] ) from @xmath47 to @xmath48 while leaving the upper limit unchanged .",
    "the fluctuations will now be a function of the cutoff as well : @xmath49 ^ 2 \\end{aligned}\\ ] ] we can use this in eqn.([coll_mass ] ) and obtain @xmath50 , the expected collapsed mass fraction in an n - body simulation . here",
    "we have approximated the sum over the discrete set of @xmath44modes by an integral and assumed that the upper limit on the wave numbers sampled is less relevant for estimating the mass function at scales of interest .    in the previous section we found that in n - body simulations the collapsed mass fraction does not change much if the cutoff is larger than @xmath26h@xmath15mpc .",
    "this conclusion is reaffirmed by the theoretical calculation of the mass function and collapsed mass fraction .",
    "figure  [ fig_psmassfn ] shows @xmath51 as a function of mass @xmath27 for different values of the cutoff scale @xmath52 .",
    "the mass in the most massive collapsed structures changes rapidly with the cutoff , implying that the number density of most massive structures depends strongly on the large scale modes .",
    "comparison with figure  [ fig_massfn ] shows that the theoretical calculation and simulations give comparable results .",
    "the criterion we propose here is this : the physical scale @xmath52 corresponding to the size of the simulation volume can be considered to be large enough if the expected fraction of mass in haloes @xmath50 is comparable to @xmath53 , the fraction of mass in haloes when the full spectrum is taken into account . in other words , we require convergence of expected mass in haloes for the simulation volume to be considered large enough so that all the relevant scales are contained within it . as before , we are interested in the effect of large scales on scales much smaller than @xmath52 . therefore we wish to see this convergence at mass scales of typical haloes .",
    "we define the mass scale of non - linearity as @xmath54 and study the convergence of mass function at this scale and at neighbouring mass scales .",
    "we study two masses for the @xmath0cdm model : @xmath55 and @xmath56 .",
    "as we shall see , these are more relevant than smaller mass scales in most situations .",
    "we require @xmath57 to find the threshold length scale @xmath52 , with @xmath58 and a less conservative limit of @xmath59 .",
    "these criteria allow us to develop a feel for this approach .",
    "we certainly require a reasonable convergence at the scale of non - linearity in simulations . for some applications , as",
    "when studying rich clusters of galaxies , we require good convergence for very massive haloes .",
    "figure  [ fig_lcdm ] shows @xmath52 as a function of redshift @xmath37 according to these criteria for the @xmath0cdm model ( see  2 for the values of cosmological parameters ) .",
    "the solid curve ( @xmath59 ) and the dot - dashed curve ( @xmath58 ) are for @xmath60 , the dashed curve ( @xmath59 ) and the dotted curve ( @xmath58 ) are for @xmath61 . for",
    "the @xmath0cdm model , @xmath62m@xmath31 therefore the criteria used here refer to mass scales of typical clusters of galaxies and rich clusters of galaxies , respectively , at redshift @xmath20 . at @xmath20 ,",
    "it is clear that a box larger than @xmath16h@xmath15mpc is required even if we are interested in haloes with mass @xmath55 and can tolerate an offset of @xmath13 in collapsed mass . using a smaller box size leads to a greater underestimate of the collapsed mass in haloes .",
    "the requirement becomes more stringent if we wish to study rich clusters of galaxies or use a tolerance level of @xmath63 ( @xmath58 ) .",
    "for the models listed in table  1 .",
    "while the change in cutoff does not change the collapsed mass fraction for @xmath64m@xmath31 , the collapsed fraction is underestimated at larger masses when we remove the large scale modes .",
    "suppression of mass function around @xmath65m@xmath31 is significant when the cutoff is at scales smaller than @xmath26h@xmath15mpc.,width=316 ]     for the @xmath0cdm model used here .",
    "this was computed using the press - schechter mass function ( press & schechter , 1974 ) .",
    "a cutoff was used to remove contributions from large scales ( see  3 for details ) . note that these values of cutoff coincide with those used in simulations of models listed in table  1 and plotted in figure  4.,width=316 ]     as a function of redshift @xmath37 for the @xmath0cdm model ( see  2 for the values of cosmological parameters ) .",
    "using a smaller box size than outlined here leads to a greater underestimate of the collapsed mass in haloes than given by conditions used for these curves.,width=316 ]    at @xmath66 , @xmath67m@xmath31 .",
    "this is the mass of a typical galaxy halo at that redshift and to get the statistics of these objects right we should have a box size of at least @xmath68h@xmath15mpc ( @xmath59 ) , the required box size increases to @xmath69h@xmath15mpc if we require @xmath58 instead .",
    "this , or an even larger simulation box should be used if we wish to study the inter - galactic medium as there will be more matter left in uncollapsed regions if we use a smaller simulation box .",
    "bright lyman break galaxies are likely to be in more massive than typical haloes and a box size of @xmath70h@xmath15mpc or larger is needed to study these in an n - body simulation .    at higher",
    "redshifts , simulations are often used for studying reionisation of the universe . at @xmath71 , @xmath72m@xmath31 .",
    "sources of ionising radiation are likely to reside in much more massive haloes and hence we should use a simulation box that is at least @xmath17h@xmath15mpc across ( @xmath61 and @xmath58 ) . if we relax the requirement to @xmath59 then the simulation volume should be more than @xmath73h@xmath15mpc across .",
    "of course , very high peaks that may be the first sources of ionising radiation are rare and a very large simulation box is required to study patchiness in ionising radiation and hence reionisation @xcite .    clearly , the requirement that the mass in collapsed haloes should not depend significantly on scales larger than the simulation box is fairly stringent and in some cases it may make it difficult to address the physical problem of interest .",
    "this restriction is less stringent than requiring that the correlation function of haloes converge as it has been shown that the mass function converges well before the correlation function of haloes @xcite .",
    "however , if the mass function has converged then tools like map @xcite can be used to obtain the correct distribution of haloes .",
    "of course , curves can be drawn with different requirements on the convergence of collapsed mass as long as these requirements are in consonance with the physical application for which the simulation is being run .",
    "is shown as a function of the index of power spectrum for power law models , @xmath74 .",
    "the power spectrum is normalised such that @xmath75 .",
    "we have assumed an einstein - de sitter background for these models .",
    "it is clear from this figure that it is difficult to explore the highly non - linear regime for smaller values of @xmath76.,width=316 ]    the curves for @xmath59 are not parallel to the curves for @xmath58 , this is due to a dependence on the shape of the power spectrum .",
    "this dependence is brought out very clearly in figure  [ fig_index ] . here",
    "we show @xmath52 as a function of the index of power spectrum for power law models , @xmath74 .",
    "the power spectrum is normalised such that @xmath75 .",
    "we have assumed an einstein - de sitter background for these models .",
    "the solid curve ( @xmath59 ) and the dot - dashed curve ( @xmath58 ) are for @xmath60 , the dashed curve ( @xmath59 ) and the dotted curve ( @xmath58 ) are for @xmath77 .",
    "it is clear from this figure that it is difficult to explore the highly non - linear regime for smaller values of @xmath76 , required box size increases rapidly as @xmath78 .",
    "these figures show that the convergence of collapsed mass in haloes happens slowly for most models of interest .",
    "the offset in collapsed mass for the the simulated model ( with a finite sampling of scales ) from the collapsed mass for the model that we wish to simulate is a useful indicator of the relevance of large scales .",
    "this feature allows us to use the criterion to decide the size of the simulation volume ; the criterion supplies the lower bound on the size .",
    "we have studied the influence of long wave modes on gravitational clustering at small scales .",
    "we find that for the @xmath0cdm model , scales larger than @xmath16h@xmath15mpc affect the mass function of haloes and the distribution of matter at scales as small as a few mpc .",
    "the effect of long wave modes not present in an n - body simulation can be incorporated independently of the evolution at small scales for some quantities but making such corrections is not possible in general . in particular , it is not possible to make corrections if the contribution of large scales changes the mass of collapsed haloes by a significant amount .",
    "we can turn this argument around and check whether a given size of the simulation volume will give ( close to ) correct results for total collapsed mass in haloes or not .",
    "this can be done using simple analytical formulae outlined in  3 .",
    "the fractional deviation of collapsed mass from its expected value if density fluctuations at all scales are taken into account is a good indicator of the influence of large scales . the fractional deviation ( @xmath79 )",
    "can be checked at a given mass scale @xmath27 of physical interest .",
    "given a choice of @xmath27 , @xmath79 and the redshift @xmath37 at which output of the simulation is to be studied , we can compute the recommended minimum size for the simulation volume .",
    "it is important to note that this scale is the minimum required and a larger simulation may be warranted by other requirements .",
    "the mass in collapsed haloes converges faster than the correlation function of haloes , implying that an even larger simulation volume may be required .",
    "corrections to positions and velocities due to large scales can be made using tools such as map @xcite .",
    "thus we can choose the box size by requiring convergence of mass in haloes and then use map to get the correct distribution and velocity field at all scales .",
    "of course , if map is not being used then a larger box size than the minimum indicated by convergence of mass function may be required .",
    "of course , using a large box size can make it difficult to address interesting questions using n - body simulations .",
    "we believe that it is better to be cautious rather than obtain unreliable answers , unless one can make a convincing case that the relevant physical quantities are not as sensitive as mass in collapsed haloes to the size of the simulation box .",
    "numerical experiments for this study were carried out at cluster computing facility in the harish - chandra research institute ( http://cluster.mri.ernet.in ) . this research has made use of nasa s astrophysics data system .",
    "we thank the anonymous referee for comments and useful suggestions ."
  ],
  "abstract_text": [
    "<S> n - body simulations are a very important tool in the study of formation of large scale structures . </S>",
    "<S> much of the progress in understanding the physics of high redshift universe and comparison with observations would not have been possible without n - body simulations . given the importance of this tool , it is essential to understand its limitations as ignoring the limitations can easily lead to interesting but unreliable results . in this paper </S>",
    "<S> we study the limitations arising out of the finite size of simulation volume . </S>",
    "<S> this finite size implies that modes larger than the size of the simulation volume are ignored and a truncated power spectrum is simulated . </S>",
    "<S> if the simulation volume is large enough then the mass in collapsed haloes expected from the full power spectrum and from the truncated power spectrum should match . </S>",
    "<S> we propose a quantitative measure based on this approach that allows us to compute the minimum box size for an n - body simulation . </S>",
    "<S> we find that the required box size for simulations of @xmath0cdm model at high redshifts is much larger than is typically used . </S>",
    "<S> we can also use this approach to quantify the effect of perturbations at large scales for power law models and we find that if we fix the scale of non - linearity , the required box size becomes very large as the index becomes small . </S>",
    "<S> the appropriate box size computed using this approach is also an appropriate choice for the transition scale when tools like _ map _ @xcite that add the contribution of the missing power are used .    </S>",
    "<S> methods : n - body simulations , numerical  </S>",
    "<S> gravitation  </S>",
    "<S> cosmology : theory , dark matter , large scale structure of the universe </S>"
  ]
}