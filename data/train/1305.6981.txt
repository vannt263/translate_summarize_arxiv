{
  "article_text": [
    "post hartree ",
    "fock methods encompass a range of tools to account for electronic correlations within quantum chemical calculations .",
    "such methods are required to progress from a ( generally ) qualitative description of a system at the hartree ",
    "fock level and approach quantitative agreement with experimental results@xcite .",
    "recently , three of the most commonly - used methods have been recast in a formalism amenable to stochastic evaluation .",
    "each of these has been found to have a number of advantages over their deterministic counterparts , underlining the potential of these methods .",
    "stochastic versions of configuration interaction ( fciqmc)@xcite , coupled - cluster ( ccmc)@xcite , and mller  plesset perturbation theory@xcite can benefit from reduced computational effort compared to their deterministic counterparts , while faithfully reproducing the same results , albeit with small and systematically controllable random errors , thus maintaining the hallmark of reproducibility in quantum chemical methods .",
    "the stochastic methods discussed here differ from other recent quantum chemical monte carlo schemes based on direct energy evaluation@xcite , as here the wavefunctions are sampled and optimized in the space of orthogonal slater determinants .",
    "it may seem counter - intuitive that improvements can be found by removing the large linear algebra routines that are so suited to fast computation , but the return comes from the fact that while quantum chemical hilbert spaces are so large , their internal connectivity is relatively small , and there is generally significant sparsity in both the hamiltonian and the wavefunction@xcite . in traditional formulations , deterministic evaluation results in equal computational effort in realizing each determinant and transition in the space , regardless of amplitude@xcite . in stochastic analogues low - weighted functions in the space , with few ` walkers ' residing on them and small transition probabilites leading to them , consume little computation effort .",
    "since the low - weighted amplitudes are rarely sampled , each instantaneous snapshot of the walker ensemble represents a coarse - grained , and highly compressed representation of the wavefunction , with only small parts of the space instantaneously occupied@xcite .",
    "therefore , the sparsity in the wavefunction can be reflected in the size of the instantaneous walker distribution , lifting the burden of wavefunction storage which is generally the bottleneck in exact diagonalization ( fci ) methods@xcite .",
    "nevertheless , time averaging over these instantaneous snapshots within an appropriate dynamic can correctly reproduce the wavefunction and energy estimators .",
    "it should be noted that deterministic schemes to exploit the sparsity in both the many- and one - electron spaces is a source of much research in wavefunction - based electronic structure theory .",
    "for example , where the orbitals can be localized , cutoffs and local domains are providing a route to take advantage of the generally short - range nature of correlation and to minimize the redundancy in the space@xcite . additionally , tensor factorizations of the wavefunction amplitudes aim for an alternative compression of the wavefunction complexity@xcite .",
    "it is an unresolved and interesting question as to whether the stochastic methods could similarly benefit from such localization of the fock space or tensor network structure imposed on the amplitudes .    within these stochastic methods , close control over the sampled hamiltonian gives rise to additional possibilities .",
    "since hamiltonian matrix elements are sampled individually , small dynamic modifications and additional criteria on the many - body space can give rise to a number of systematically improvable approximations , which can be difficult or impossible to impose in deterministic methods@xcite .",
    "this approach can again dramatically reduce the computational effort needed to converge to the solution .",
    "in addition to this , stochastic methods can also benefit from improved parallelization over distributed memory machines , an important trait on modern computer architecture , and one which high - level quantum chemical algorithms can particularly struggle with@xcite .",
    "the efficiency of this parallelism will be explored in this paper .    in this paper , we focus on the original ` initiator ' algorithm .",
    "this method has proven successful in providing exact basis - set energies of systems well outside the limit of what can be achieved within iterative diagonalization schemes in a variety of different systems@xcite . by reformulating the underlying dynamic of the walker distribution , advances in the scope of the method have also been achieved .",
    "complex wavefunctions@xcite , excited states@xcite , multi - state solutions@xcite and finite temperature@xcite , as well as other techniques to reduce the random error or scaling with system size@xcite have been developed .",
    "in addition , advances in parent deterministic methods can often be transferred to their stochastic counterparts , with explicitly correlated versions of the theory and density matrices able to be sampled@xcite .",
    "many of these methods can be considered as modifications to the underlying walker dynamics of the fciqmc algorithm from an implementational point of view , and so will hopefully also benefit from the careful consideration of this algorithm here .",
    "we shall analyze the performance and implementation of the algorithms which are so critical to the method , before resolving the electronic effects of the chromium dimer , a molecular system exhibiting non - trivial strongly correlated wavefunction structure .",
    "the key dynamical equations of fciqmc that are essential to describe the algorithm are detailed here , but a more complete motivation and derivation can be found elsewhere@xcite . the master equation which governs the evolution of the walker population",
    "is given by @xmath0 c_{\\bvec{i}}^{(n ) } - \\tau \\sum_{\\bvec{j } \\ne \\bvec{i } } h_{\\bvec{ij } } c_{\\bvec{j}}^{(n ) } .",
    "\\label{eqn : master}\\ ] ] this equation can be derived from a finite - difference formulation of the imaginary - time equation , where the hamiltonian , @xmath1 , is projected into a discrete , orthonormal @xmath2-electron basis @xmath3 , constructed from a set of @xmath4 one - electron orbitals .",
    "the ground - state wavefunction in this basis is spanned by the coefficients @xmath5 after the master equation is iterated until convergence at large @xmath6 .",
    "the timestep , @xmath7 , represents the discretization of imaginary time , and @xmath8 is a diagonal ` shift ' which is adjusted to maintain a constant number of walkers ( @xmath9-norm ) . at convergence ,",
    "this can then be used as an estimate of the energy .",
    "an alternative single - reference ` projected ' energy estimator can be obtained from @xmath10 where @xmath11 defines a reference determinant .",
    "this equation is exact for the correct wavefunction distribution over the functions coupled to the reference , @xmath12 , but the random errors associated with this estimator are sensitive to the weight on this reference function",
    ". a multireference reference function can be used , and allows for systematic improvement over the single reference case@xcite .    in the standard fciqmc algorithm , the wavefunction coefficients , @xmath5 ,",
    "are now discretized to an integer representation , where the value of this coefficient on a function is denoted by the number of signed ` walkers ' residing there .",
    "this is not a unique representation of the wavefunction coefficients .",
    "while some degree of discretization is essential for the compression of the low - weighted amplitudes , a multi - scale real / integer representation , where a small region of importance is represented in a finer , continuous , and deterministic fashion@xcite , has been found to provide orders of magnitude saving in the random errors in many circumstances .",
    "this will not be considered here . in this paper , we will focus on the algorithm where the wavefunction representation , imaginary time , and off - diagonal dynamic are sampled and fully discretized , consistent with the majority of the literature to date .",
    "the dynamics of these walkers now follows a set of steps designed to simulate the evolution of eq .  .",
    "first , for each walker on each determinant , @xmath3 , a symmetry - allowed connected determinant , @xmath13 , is selected at random with a normalized and calculable probability , @xmath14 .",
    "the _ spawning _ step of the algorithm then proceeds by creating a new signed walker on @xmath13 with a stochastically realized probability@xcite of @xmath15 where this probability is negative , a particle with a negative sign is created with probability @xmath16 .",
    "if this probability has magnitude larger than @xmath17 then the corresponding integer number of particles are created deterministically , and the fractional part stochastically . after all walkers residing on determinant @xmath3 have been through a spawning step , a local , diagonal death",
    "/ cloning step occurs .",
    "this step is applied to all walkers on the determinant at once , and reduces the population on the local function with another stochastically realized probability of @xmath18 where @xmath19 anti - particles are spawned which grow the population . as",
    "generally @xmath20 anti - particles are only spawned for large , positive values of @xmath8 .",
    "it should be noted that walkers spawned , cloned or killed within an iteration do not contribute to the subsequent steps of the same iteration .",
    "taken together , these two steps simulate the dynamics of eq .  .",
    "however , for general fermionic wavefunctions , it is impossible to find a representation of the wavefunction such that all @xmath5 amplitudes are of the same sign@xcite .",
    "this results in a propagation of both positive and negative walkers , and a manifestation of the fermion sign problem within this algorithm .",
    "although this has been shown in general to be less severe than the analogous problem within real - space qmc approaches@xcite , the fciqmc algorithm can exactly overcome this exponential reduction in signal to noise ratio via local annihilation events between oppositely signed walkers on the same determinant@xcite .",
    "an important consequence for this is that the walkers on each determinant at the beginning of an iteration are all of the same sign .",
    "it is also at this annihilation stage that additional approximations such as the successful ` initiator ' adaptation of the method can be applied .",
    "the annihilation algorithm will be detailed in section  [ sec : annihilation ] .",
    "a flow diagram detailing the main loop and logic structure of the overall algorithm is given in fig .  [",
    "fig : fciqmc - algo ] .",
    "= [ draw , on chain , on grid , align = center , minimum height=4ex ] = [ base , rectangle , text width=10em ] = [ base , diamond , aspect=2 , text width=7em ] = [ - > , draw , black ] = [ < - , draw , black ] = [ - , draw , black ] = [ coordinate , on chain , on grid ] = [ coord , node distance = 6 mm and 25 mm ] = [ coord , node distance = 6 mm and 30 mm ] = [ coord , node distance = 6 mm and 52 mm ] = [ coord , node distance = 6 mm and 55 mm ]        the innermost loops of the fciqmc algorithm ( the spawning steps ) involve random generation of symmetry - allowed connected determinants , and the calculation of the hamiltonian matrix elements which connect the two .",
    "the generation of excitations is considered in section  [ sec : excitgen ] , while the generation of matrix elements follows standard slater  condon rules ( for a determinant basis)@xcite .",
    "a substantial cost in the algorithm , when using large basis sets , is memory latency in the one- and two  electron integral lookup between arbitrary orbitals required for these matrix elements .",
    "since integrals are required in a random order , a pre - fetching algorithm to obtain multiple integrals at once is difficult to implement , while the @xmath21 $ ] number of the integrals is likely to provide the memory bottleneck in larger studies .",
    "this is somewhat ameliorated by a shared memory implementation ( via either posix or system v shared memory@xcite ) , but for large number of orbitals ( @xmath22 ) , either a density - fitted / cholesky decomposed integral engine@xcite ( to reduce integral storage to @xmath23 $ ] or lower ) , on - the - fly calculation , distribution and communication of integrals between computational nodes or other compressed representation will likely be necessary . however , this will serve to increase the integral lookup cost and is not considered further here . in all applications to date , the integrals have either been stored in memory on all computational nodes , or calculated on - the - fly .",
    "the other algorithmically and computationally non - trivial step required , which will be unfamiliar to standard deterministic quantum chemistry packages and is key to the performance of the method , is an efficient and scalable annihilation algorithm between walkers on the same function with opposite sign .",
    "much of the implementation of the algorithm is with this in mind , since naive approaches can be very costly .",
    "this is also the only step which involves communication between mpi threads other than occasional aggregation of statistics , and is key to the parallel performance of the algorithm .",
    "it is important , therefore , to perform the mpi part of this step in a single , collective operation to reduce communication latency .",
    "the implementation of this step will be considered in section  [ sec : annihilation ] .",
    "unless such large numbers of parallel processes are used that communication becomes the bottleneck , we have found that excitation generation is the most costly part of the algorithm .",
    "this is dependent on the number of irreducible representations in the symmetry group being used within the system ( @xmath24 ) , as the cost increases with additional symmetry elements .",
    "however , we have found it always worthwhile to make use of symmetry where possible , as this generally has a quadratic saving , since both the size and the internal connectivity of the space are reduced by a factor of the number of symmetry elements , resulting in an increase in the @xmath25 values obtained in the spawning step and a corresponding increase in the timestep that can be used .",
    "abelian subgroups of d@xmath26 are available , as are full l@xmath27 symmetries , translational point groups , total spin eigenfunctions and time - reversal symmetries@xcite .",
    "other factors such as the number of walkers , orbitals , electrons and computational cores run on , as well as effects such as the sparsity of the wavefunction will all influence the efficiency of the algorithm and may change the limiting step . the algorithm will generally become increasingly parallelizable with increasing walker number , as needed to converge the energy for larger systems . because of this , we will focus on the computational efficiency in the large walker limit of the algorithm , by outlining a scheme for linear scaling with respect to the number of walkers , @xmath28 , where availability of memory is not a bottleneck .",
    "derivatives of this scheme can be employed in other computational regimes , where speed can be sacrificed for memory saving , although these schemes will not be discussed here as memory availability is generally not the bottleneck of this algorithm on modern computational resources ( as opposed to deterministic fci ) .",
    "the most simple @xmath2-electron space of the fciqmc dynamic is the complete set of slater determinants , however there are other function spaces which can span the same hilbert space , while being more compact .",
    "these include fixed combinations of determinants which obey spin - reversal symmetry ( see section  [ sec : hphf ] ) , momentum - reversal symmetry , or total spin eigenfunctions ( configuration state functions@xcite ) .",
    "working in these other spaces involves a trade - off between the complexity of the excitation generation algorithms and matrix element evaluation , and the advantages provided by reductions in the total size and connectivity of the spaces , or when aiming separately for ground and excited states which were previously of the same symmetry . when ` determinants ' are mentioned here",
    ", it should be implicit that any of these function spaces can be used in its place .",
    "indeed , more complicated function spaces , including non - orthogonal or geminal spaces may also provide interesting research directions in the future .",
    "it is important for the fciqmc algorithm that all of these functions can be uniquely and compactly represented by bit strings indicating the occupations of the @xmath4 orbitals ( or @xmath29 spin - orbitals ) in the space . for determinants ,",
    "this is straightforward and has been in use in previous ` string'-based schemes@xcite . for spin - coupled spaces ,",
    "one unique determinant from the coupled pair is chosen to denote the function , so that the representation is always the same .",
    "many operations on determinants are then reduced to bit operations .",
    "for instance , finding the number of orbitals differing between two determinants can be computed via an ` exclusive or ' operation ( xor ) , followed by counting the set bits of the result@xcite .",
    "additionally , checking whether two functions are the same is equivalent to testing the equality of the bit - representations .    in our implementation , the bit - string is formulated from an integer representation , and multiple integers are used when the number of spin - orbitals exceeds the number of bits in the integer type .",
    "in addition , another single integer is used to store the signed number of walkers occupying the determinant , and any single bit ` flags ' which may be required , such as whether a walker has been spawned from a function which is deemed an ` initiator ' ( which confers special properties to the walker regarding its survival if spawned to an unoccupied determinant@xcite ) . to isolate the number of walkers on a determinant , their sign , or the associated flag ,",
    "separate masking integers are used to isolate the component bits of this integer when desired via and operations .",
    "this compression of multiple data into a single integer is done primarily to minimize the amount of data for communication purposes , rather than to save on memory usage .",
    "for complex wavefunctions for use with complex irreducible representations such as translational group symmetry and crystal momentum for solid - state systems , or for other complex wavefunctions found in e.g. systems with spin - orbit coupling , two integers are used for the walker population to denote separately the real and imaginary parts of the wavefunction coefficient .",
    "this representation of the walkers as a set of integers uniquely denoting the determinant , signed number of walkers , and any flags conferring special attributes is the standard representation for all walkers in both the main list , and the list for newly - spawned walkers each iteration .",
    "the total number of 64-bit integers required to store an occupied determinant in the main list therefore scales with number of orbitals as @xmath30 . by way of illustration , in a system with 128 spin - orbitals , 100 mb of memory will therefore store over four million occupied determinants , and assuming an optimal load - balancing ( see section  [ sec : annihilation ] ) , this number of distinct occupied determinants can be stored on each computational process on distributed memory architecture .",
    "it should be stressed that the storage of the determinants is only ever performed over the instantaneously occupied determinants , and as such , no memory requirements which explicitly scale with the size of the full hilbert space are ever required .",
    "finally , it can be useful to store the diagonal hamiltonian matrix elements for the occupied determinants in the main list , along with the standard ( integer ) determinant representation .",
    "this is not essential , but saves on regeneration of these matrix elements , which involves an @xmath31 $ ] operation , at each death step if a determinant remains occupied over multiple iterations .",
    "crucially , this data does not need to be communicated in the annihilation step , and therefore involves only a memory cost rather than increasing the quantity of data to communicate .",
    "encoding of a newly occupied determinant bit - string representation from scratch is rarely required .",
    "since determinants are generated through excitations of already occupied determinants , the bit representation of the new determinants may be calculated from the old in an @xmath32 $ ] step by clearing the bits representing the source orbitals and setting those representing the targets .",
    "however , in the excitation generation step , and for certain operations such as hamiltonian matrix element calculation for single excitations and hashing ( see section  [ sec : annihilation ] ) , an alternative determinant representation is preferable . in this ` electron occupation ' representation , an ordered set of @xmath2 integers are used to specify the spin - orbitals occupied by each of the electrons in the function .",
    "this representation is generated for each occupied determinant from its bit representation via a 1-to-1 ` decoding ' function when it is considered in each iteration .",
    "decoding can be performed naively by looping over all the bits in the bit representation , and appending each set bit to a list .",
    "however this is unnecessarily costly . in a similar way to one method of counting the number of bits set in an integer@xcite ,",
    "this may be approached through subdividing the bit representation into individual bytes , and creating a lookup table for the available 256 possibilities .",
    "each possible byte has an entry containing    the number of orbitals contained in this byte , and    a list of these orbitals ( with the first bit in the byte being orbital zero ) .",
    "looping over all non - zero bytes , until the correct number of orbitals are found , is substantially more efficient than looping over each of the bits .",
    "the annihilation of walkers of different signs on the same determinant is of crucial importance to the emergence of the sign structure of the wavefunction@xcite .",
    "since only the instantaneously occupied determinants are stored , rather than a histogram of the whole determinant space , this annihilation step has to be performed explicitly .",
    "a dual hashing procedure is a key feature of this fciqmc algorithm , on which rests the load - balancing and parallelism of the algorithm over the available computational processes , as well as the linear scaling with respect to walker number .",
    "a hash function is a many - to - one mapping from a data set to a ( in this case ) single integer within a predetermined range .",
    "generally , it is simple to map from the data to the hash value , but very difficult to perform the reverse and is hence used for encryption , although this is not a feature of the hash function which will be exploited here . instead",
    ", this algorithm is dependent on a uniform distribution of hash values across the full range desired , with emphasis on low - order bits changing rapidly and fast evaluation . to this end , a simple merkle - damgrd type hash outlined in algorithm  1 has proved useful in mapping a determinant in electron occupation representation to a single integer@xcite .",
    "it is possible to directly hash the bit - string determinant representation , although this compressed form leaves less data on which to perform the hash , producing less uniformly distributed results .",
    "therefore it was found to be preferable to use the electron occupation representation in cases of small orbital basis sizes .",
    "common orbital orderings will order the orbital indices by energy , or by symmetry .",
    "either way , there is likely to be significant common structure in the representation of the dominant determinants in the wavefunction , including structure from the global m@xmath33 , and the generally occupied core orbital configurations . to somewhat mitigate these effects in the resulting hash",
    ", an additional simple 1-to-1 mapping is made from the spin - orbital indices to another set of random integers , whose range can be much larger than the original number of spin - orbitals .",
    "this additional random lookup table increases the entropy in the data set and results in more uniform hash values .",
    "@xmath34 @xmath35 @xmath36    [ code : hash ]      on each parallel process , a main list stores the list of occupied determinants on that particular process , with their signs and flags , disjoint to all determinants stored on other processes .",
    "the process a determinant is assigned to is determined from the hash value across the range of the number of processes .",
    "the occupied determinants ( not individual walkers ) are therefore distributed across the different mpi processes ( which generally correspond to the computational processing cores ) .",
    "each determinant is found on the same process at all stages of the calculation .",
    "it is crucial to be able to deterministically compute which process this is , such that newly spawned walkers can be communicated to the correct process for the annihilation step .    during the iteration ,",
    "each determinant in the main walker array is considered ( see section  [ sec : walkerlisthash ] ) , and attempts spawning and death steps . each time a new walker is spawned , its hash value is computed between the range of available computational processes , giving its target process , and the bit - representation stored in a non - contiguous ` spawned ' array , separate to the main walker array , on the process on which it was created .",
    "this additional spawned array of walkers only needs to store the maximum number of successful spawning events on each process per iteration ( @xmath37 ) , and so can be much smaller than the main array , by a factor of 10 - 1000 ( @xmath38 ) .",
    "the position in the array is determined by the hash , and therefore non - contiguously orders the newly spawned walkers by the process on which the determinant should be located after communication , as shown on the left figure in fig .",
    "[ fig : annihil ] . local death / cloning events are however updated directly in the main array .    , and that the annihilation routine is only of cost @xmath39 $ ] . ]    at the end of the main iteration loop , the newly spawned walkers are sent to their designated processes via a single , synchronized , collective operation ( within the mpi library , an mpi_alltoallv operation ) . as illustrated in fig .",
    "[ fig : annihil ] , due to the way that the newly spawned walkers were ordered , this takes the form of a non - contiguous matrix transpose .",
    "after this , each process list of newly spawned walkers only includes walkers assigned to that process . as a consequence , all walkers on any given determinant",
    "will now reside on the same process .",
    "this allows annihilation to occur fully without any further communication .",
    "after the movement of walkers , the small , now contiguous newly spawned walker list on each process is ordered and compressed so that there are no multiply specified determinants in the list$ ] , which strictly violates the linear scaling with respect to @xmath28 .",
    "however , since @xmath38 , this cost can be considered small , and it is practically favorable to perform it . ] .",
    "this combines newly spawned walkers of the same sign into one entry in the list , and locally annihilates walkers of different sign between those spawned in the current iteration .",
    "the mechanism of further annihilation with entries from the main list on the process will be described in section  [ sec : walkerlisthash ] .",
    "the load - balancing of the algorithm across processes is therefore tied to the uniformity of the hashing function .",
    "a beneficial property of the algorithm is the fact that the larger the system ( @xmath2 ) , the more entropy that is available to the hashing function , and therefore the more uniform the hashing should become . in practice ,",
    "the load balancing of the hash values is rather uniform and is not the bottleneck of the parallelism .",
    "however , this is not the only consideration , as this algorithm balances the number of occupied determinants across the available processes rather than the number of walkers , and the equal balancing of computational effort will depend on both of these quantities , as can be seen in fig .",
    "[ fig : loadbalance ] .",
    "it is not clear which it would be better to balance , since some operations such as the death step , diagonal matrix element evaluation and annihilation take place on the level of occupied determinants , while others such as the spawning attempts and the majority of the excitation generation take place on an individual walker level .",
    "the optimal load balancing would include some of both characters , but this algorithm is limited to only consider balancing of occupied determinants only across computational processes .",
    "therefore , if a walker distribution is heavily skewed towards , say , the hartree  fock determinant , then this will result in a load - imbalance on the level of walker distribution across computational processes .    despite this limitation ,",
    "an upside of this is that for a given number of processing threads , increasing the number of walkers will lead to an increased parallel performance as a larger fraction of the space is simultaneously occupied and the load is more evenly balanced as can be seen in fig .",
    "[ fig : scaling ] .",
    "this means that as systems become larger and more walkers are required for convergence to the correct energy , the parallelism of the algorithm increases , allowing it to be run more efficiently on larger computational resources .",
    "however , it is possible within the algorithm to isolate subsets of determinants ( which need to be readily identifiable ) which can be separately considered on a dedicated process if they are particularly computationally intensive , while the remainder of the determinants are placed based on their hash over a now reduced range of available processes .",
    "the simplest of these schemes involves placing just the largest weighted determinant on a dedicated computational processes , while distributing the others accross the remaining processes .",
    "the effects of this can be seen in fig .",
    "[ fig : scaling ] , where the hartree  fock determinant has a seperate process , and no dynamic load - balancing is performed .",
    "as can be seen , this greatly improves the parallelism of the algorithm .",
    "schemes to improve this further will be considered in the future , where the true computational load is balanced as evenly as possible .",
    "the second hashing is not for the purposes of parallelism and involves the explicit construction of a hash table for the storage of the main walker list on each process .",
    "the idea is for the hash value of a determinant to return a position in a hash table , which will in turn provide the array index for the determinant in the main walker list on the local process .",
    "the reason for the hash table construction is that the time taken to search for a determinant in the main list , insert a new determinant or delete an old determinant is @xmath32 $ ] .",
    "two integer arrays in memory are required in addition to the main walker list .",
    "the first is the hash table , which can be of variable length , but should optimally scale with the size of the main determinant array to minimize hash collisions .",
    "the other is a circular array indexing the vacant positions in the main determinant list into which new determinants can be placed .",
    "this latter list has a maximum size given by the length of the main determinant list , but can be shorter.$ ] ( rather than @xmath39 $ ] ) where @xmath40 is the number of occupied determinants .",
    "it also requires more costly insertion / removal steps for changing determinant lists . ]    in the main loop , the occupied determinant list is sequentially accessed .",
    "each time an empty entry in the list is found , the position index is saved in the circular list .",
    "spawning and death steps are performed as normal for entries corresponding to occupied determinants in the list . if all walkers on a determinant are killed during the death step , then its walker count is set to zero , and its index is added to the circular list and removed from the hash table .",
    "once all walkers on the process have been considered , there is no need to continue iterating through the main walker array , and all further ( vacant ) entries in the main determinant list can be considered available for possible walker insertion . in this way ,",
    "the first entries filled from determinant insertion are the earliest vacant entries , meaning that the main determinant list remains as contiguous as possible , minimizing the number of empty array entries which are searched through .    during annihilation ,",
    "when the contiguous newly spawned walker list is compared to the existing determinants in the main walker list , the hash value of each determinant is computed , and the index of the determinant in the array looked up from the hash table .",
    "if there are hash collisions ( two determinants with the same hash ) , then multiple entries in the main list may need to be considered before the correct determinant is found . if the determinant is found , then annihilation or addition to the existing entries can be achieved simply by modification of the number of walkers in the corresponding entry in the main list . if the resultant number of walkers is zero , the entry should be removed from the hash table , and the associated index added to the circular list of free slots available for determinant insertion , in the same way as for the death of all walkers on a determinant .",
    "alternatively , if no corresponding determinant is found , the newly spawned walker can be transferred to the main list in the next free position indicated in the circular list . in this way",
    ", the entire annihilation step can be efficiently performed in only @xmath39 $ ] computational cost .",
    "the reason for the intermediary hash table step to provide an index is due to the added simplicity when dealing with hash collisions .",
    "this is not essential and could be removed to provide memory savings . assuming uniformity of the hash values , the probability of a hash collision between two determinants on the same process is given by @xmath41 where @xmath42 is the size of the hash table , and @xmath40 denotes the number of occupied determinants on the process .",
    "it can be seen in this way that increasing the size of the hash table is advantageous for minimizing the risk of hash collisions . in the case of a hash collision ,",
    "the additional distinct determinant index is included in the same entry in the hash table , resulting in multiple entries potentially being searched at the annihilation stage .",
    "further hash collisions are possible , but become scarcer .",
    "it is also worth mentioning that different random mapping arrays are used in the hashing functions for the distribution over processes and over the main determinant array ( as well as different ranges ) , in order to avoid any unwanted correlations being introduced between the two hashes .",
    "it is during this annihilation stage that the initiator criterion on newly spawned walkers can be imposed with virtually no overhead . for any walker in the spawned list ,",
    "if no corresponding determinant is found in the main list when searched for , the walker s flag is tested to determine if it was spawned from a determinant deemed to be an ` initiator ' .",
    "if so , the insertion into the main determinant list proceeds as normal .",
    "otherwise , the spawned walker is discarded from the simulation . similarly , it is also at this stage where the diagonal hamiltonian matrix elements are calculated ( if they are being explicitly stored ) , if a new determinant is being occupied .",
    "another advantage of this algorithm is that for the lifetime of a particular determinant , it can always be found in the same position in the main walker array .",
    "if the weight on particular determinants , such as the hartree  fock or @xmath43 amplitudes in ccmc , need to be accessed frequently then it is not necessary to search the array to locate them , but rather their indices can be stored over their lifetime .",
    "this also eliminates memory ` churn ' incurred from moving walkers around the main list to maintain contiguousness .",
    "a non - trivial part of these stochastic quantum chemical methods is concerned with the random selection of connected determinants , within the symmetry constraints imposed upon the space .",
    "the primary difficulty associated with the construction of the excitation algorithm is that the generation probability for each excitation must be computable , with the sum of all possible outcomes for each source determinant correctly normalised , and all possible routes for generating each resultant determinant included in any calculated probability .",
    "this is so that the overall spawning probability ( eq .  [ eqn : pspawn ] multiplied by the probability of selecting the excitation ) for any transition is independent of the specifics of the random excitation process , and purely a linear function of the connecting hamiltonian matrix element .",
    "it is this normalization criterion which affects the efficiency of the excitation generation , since explicit normalization by full or even partial enumeration of all excitations is too costly as system sizes increase .",
    "the generation of normalized probabilities does not mean that excitations must be generated in a uniform manner .",
    "in addition , in this algorithm , it is possible to return a ` null ' or aborted determinant from the excitation routines .",
    "if a null excitation is generated , the hamiltonian matrix element to this excitation is considered zero , and no spawning can occur .",
    "additional restrictions can be imposed on the allowed space to search , by returning null determinants when determinants outside the allowed space are generated .",
    "this trivially allows for truncated or active space ci calculations , or truncations according to other criteria such as seniority number@xcite .    a flow diagram , giving the main steps in our excitation generation algorithm is shown in fig .",
    "[ fig : excit - gen ] .",
    "overall , the aim is to return a singly or doubly excited determinant of an initial determinant , @xmath44 .",
    "a singly excited determinant involves finding an occupied orbital @xmath45 and unoccupied orbital @xmath46 , while a double excitation requires an occupied orbital pair @xmath47 and unoccupied pair @xmath48 to be selected .",
    "an initial step creates two integer lists , detailing the number of occupied and unoccupied spin - orbitals of each symmetry in the determinant @xmath44 .",
    "these lists can be trivially computed in @xmath49 $ ] time , and since they are the same for all excitations from @xmath44 , the operation is performed once , and then saved between multiple excitations from walkers on the same determinant .",
    "symmetry in this sense refers to all one - electron symmetry labels on the orbitals , including potentially a spin label , point group irreducible representation , @xmath50 quantum number ( if conserving @xmath51 symmetry@xcite ) , and @xmath52-point labels in systems with translational invariance@xcite .    upon attempting to generate an excitation ,",
    "the first choice is which type of excitation ( single or double ) to generate , as shown in fig .",
    "[ fig : excit - gen ] as ( 1 ) .",
    "this choice does not need to reflect the exact ratio in the number of each type , though it always helps to be as close as possible to encourage uniformity in the generation probabilities and improve sampling .",
    "the choice however does need to maintain the normalization , requiring @xmath53 by assuming the ratio of double to single excitations should be roughly constant across the determinant space , @xmath54 and @xmath55 are fixed throughout the run , after choosing them initially by explicitly calculating the ratio of excitation types from a hartree  fock or other reference determinant .",
    "the quality of this assumption is dependent on the uniformity in the number of irreducible representations .",
    "the first stochastically realized choice in the excitation generation is therefore based on the probability @xmath54 .",
    "note that in some model hamiltonians ( e.g. the hubbard model or uniform electron gas in direct or reciprocal space ) , only double or single excitations are allowed , and this initial selection can be avoided .          in small systems , or systems with a high degree of symmetry",
    ", it is possible to choose an electron to excite , which has _ no _ symmetry allowed excitations from it . for a single excitation to be symmetry allowed , it requires @xmath56 where @xmath57 and @xmath58 represent the irreducible representations of orbital @xmath59 and @xmath60 , and @xmath61 is the totally symmetric representation , which generalizes to spin and other symmetries .",
    "if no @xmath60 orbitals match this criterion for a randomly chosen @xmath59 , then it would be possible to return a null determinant , rejecting the excitation and attempting again in the next iteration .",
    "however , in many cases , this is a common enough occurrence that it is worth renormalizing the allowed choices of @xmath59 at the beginning of each single excitation attempt .",
    "consequently , _ either _ an @xmath62 $ ] or @xmath49 $ ] operation can be performed , whichever is smaller , to calculate the number of electrons in @xmath44 which have no allowed single excitations , @xmath63 .",
    "this is most easily calculated from the precalculated symmetry lists , or the electron occupation representation of the determinant respectively , and is shown in ( 2 ) of fig .",
    "[ fig : excit - gen ] , but can be omitted in cases with large @xmath64 , or no symmetry . in rare cases where no single excitations are available from any electron ,",
    "a null excitation is returned ( 3 ) .",
    "an electron is then chosen at random ( 4 ) , with uniform probability of @xmath65 generally , choosing electrons is done on the electron occupation representation of the determinant , while testing whether orbitals are occupied or unoccupied is performed on the bit - string representation . in this way , both tasks can be done in @xmath32 $ ] time .",
    "therefore , having both representations available is advantageous .",
    "it is then simple to calculate the number of unoccupied orbitals of the correct symmetry which can be excited to , @xmath66 , via the precomputed symmetry lists .",
    "if no excitations are available from this electron , i.e. @xmath67 , another electron can be selected at random if @xmath63 has been computed previously ( 5 ) , otherwise a null excitation is returned .",
    "renormalization to account for this would be possible but inefficient for such an edge case , and so a null excitation should be returned .",
    "this issue highlights a common theme in these excitation generators , where the algorithm attempts to balance the time needed to renormalize the probabilities to allow redrawing if there are no available excitations of a stochastically chosen type , against the probability of this redrawing needing to occur in the first place . from a quality of sampling per iteration perspective",
    ", it would be optimal if we could always return an allowed excitation , but the structure of the algorithm means that it is not always worthwhile to do so . ] .",
    "once orbital @xmath59 is chosen and @xmath66 computed , orbital @xmath60 can be chosen with probability @xmath68 ( 6 ) . since it is unknown which orbitals these @xmath66 possibilities refer to , and we must ensure that the condition @xmath46 is met , we simply draw orbitals randomly from all allowed orbitals in the desired symmetry , and test whether they are occupied from the bit - string representation ( 7 )",
    ". it would alternatively be possible to loop through all orbitals until the desired @xmath60 from the range @xmath66 allowed orbitals is found , but this would only be worthwhile for very small @xmath64 ratios , since it would introduce an @xmath69 $ ] operation . finally ,",
    "once @xmath59 and @xmath60 are chosen , the new determinant can be created from the old bit - string representation , the parity change calculated between the determinants in the standard way , and the orbitals returned to facilitate subsequent calculation of the matrix element between them ( 8) .",
    "the overall probability of generating the new determinant can also be calculated ( 9 ) , as @xmath70 where the last term in eq .",
    "[ eqn : p_sing ] is the renormalization factor to account for the number of electrons with no single excitations .",
    "the logic behind double excitation generation is very similar to that for single excitations , but is a little more involved .",
    "first , a unique @xmath71 pair is picked uniformly in @xmath32 $ ] time , with uniform probability @xmath72 using an inverse triangular indexing ( 10 ) .",
    "unlike for single excitations , it was not deemed worth renormalizing in general for the case of no excitations from a given pair .",
    "the point group , angular or linear momentum symmetry of the second unoccupied orbital , @xmath73 , is uniquely determined by the symmetries of the @xmath71 pair and @xmath60 , from the requirement to satisfy @xmath74 when picking the first unoccupied orbital , @xmath60 , the choice of spin must be considered . if both electrons in the @xmath71 pair have the same spin , the choice of @xmath60 must also be constrained to that spin .",
    "otherwise , there are no constraints .",
    "this gives the number of possible @xmath60 orbitals to select , @xmath75 , which is @xmath76 for a mixed spin @xmath71 pair , or @xmath77 for a pair of same spin @xmath78 .",
    "similarly to the single excitation case , an @xmath79 $ ] operation is performed to count the number of unoccupied @xmath60 orbitals , @xmath80 , that if picked , would have no symmetry and spin allowed @xmath73 orbitals with which it could be paired .",
    "this allows for analytic renormalization of the probabilities , such that multiple attempts at picking @xmath60 orbitals are allowed if no corresponding @xmath73 orbitals are symmetry allowed ( 11 ) . in the rare case",
    "that this number encompasses all unoccupied orbitals of the required spin , i.e. @xmath81 , a null excitation is returned ( 12 ) .    from within the spin constraints , a random selection of",
    "the first unoccupied orbital can occur .",
    "redrawing of @xmath60 orbitals from within the @xmath75 set is allowed if no unoccupied symmetry - allowed @xmath73 orbital can follow , i.e. @xmath82 . for small or highly symmetric systems , where there are fewer than four possible @xmath60 orbitals to successfully pick , the random selection of @xmath60 is made directly from within the @xmath83 range , and then an @xmath69 $ ] operation performed to search for them ( 13 - 14 ) .",
    "this ensures that only one random number is required to be drawn to locate an @xmath60 orbital , rather than potentially drawing many .",
    "this should not be an issue for larger systems with more unoccupied orbitals and less symmetry , where an @xmath32 $ ] operation with infrequent redrawing is used , as the inadvertent selection of a forbidden or occupied orbital is rarely encountered ( 15 - 16 ) .    finally , from the conditions in eq .",
    "[ eqn : sym1 ] , as well as any other symmetry or spin constraints , a random selection of the @xmath73 orbital can be made uniformly from the @xmath84 possibilities ( 17 - 19 ) . from the final @xmath85 pair",
    ", the number of available @xmath60 orbitals if orbital @xmath73 had been chosen first from the @xmath85 pair must be calculated , since the pair could have been chosen in either order , and in general @xmath86 .",
    "the changing orbitals , resultant doubly excited determinant and parity change can then be returned for the calculation of the matrix element ( 8) , while the probabilities follow from ,    @xmath87 \\frac{m_{\\allow}^a}{m_{\\allow}^a - \\delta_d } \\\\                                        & = & \\frac{2 p_{\\textrm{double}}}{n(n-1 ) } \\left [ \\frac{1}{m_{\\allow}^a } \\frac{1}{m_{\\allow}^{(b|a ) } } + \\frac{1}{m_{\\allow}^a } \\frac{1}{m_{\\allow}^{(a|b ) } } \\right ] \\frac{m_{\\allow}^a}{m_{\\allow}^a - \\delta_d }     \\\\                                        & = & \\frac{2 p_{\\textrm{double}}}{n(n-1)(m_{\\allow}^a-\\delta_d ) } \\left ( \\frac{1}{m_{\\allow}^{(b|a ) } } + \\frac{1}{m_{\\allow}^{(a|b ) } } \\right ) .\\end{aligned}\\ ] ]    the overall computational scaling for the calculation of a general excitation is therefore @xmath79 $ ] , after an initial @xmath49 $ ] cost per determinant to set up symmetry lists .    as an aside",
    ", a more flexible excitation generation was also investigated to preferentially sample more important transition probabilities , via partial enumeration of excitation subsets , weighting of excitations by magnitude of the connecting hamiltonian matrix elements , a renormalization and subsequent random selection within this subset .",
    "although this improves the quality of the sampling with respect to important transitions , the overall acceptance ratios , random errors and scaling of the method remained relatively unchanged , and the partial enumeration and generation of the matrix elements was not seen as cost - effective to the algorithm .",
    "the reason for the relative small improvement in the algorithm is due to the fact that any bias in the generation probabilities must necessarily be unbiased for in the spawning acceptance criterion ( eq .  [ eqn : pspawn ] ) , and so overall spawning rates are not significantly affected .",
    "importance sampling may still be important to the algorithm in other guises , but this is likely to involve a transformation in the form of the underlying sampled wavefunction@xcite .      for systems with an even number of electrons , every spin state , @xmath8 ,",
    "contains an eigenfunction ( in the absence of fields or relativistic effects ) with an @xmath88 value of zero onto which the wavefunction can be projected . in this @xmath89 sector",
    ", there is an additional time - reversal symmetry which can be imposed on the hamiltonian matrix , as detailed in ref .  .",
    "spin - coupled pairs of determinants can be generated by flipping the spin of all electrons , to create pairs of determinants whose coefficients differ only by a sign - change based on the desired total spin of the system and number of unpaired electrons in the determinant pair , @xmath90 where @xmath91 represents the second quantized string corresponding to the alpha electrons .",
    "these pairs of functions are therefore constructed as @xmath92 & \\quad \\mbox{if $ i > j$ }     \\\\",
    "\\end{array }   \\right.\\ ] ] which constitutes an orthonormal space with the same particle exchange antisymmetry properties as the underlying slater determinant space , but with the symmetry given in eq .   imposed .",
    "these time - reversal symmetry functions can be considered an intermediary between determinants and configuration state functions , and constitute spin eigenfunctions for functions of two unpaired electrons@xcite .",
    "the performance of fciqmc in a fully spin - adapted configuration state function space will be considered in a forthcoming paper .    both the size and internal connectivity of the space of functions shown in eq .",
    "are roughly half of those in the underlying determinant space .",
    "this allows for fewer walkers to be used to sample the space , and a larger timestep to be used to converge to the solution using less imaginary time .",
    "this results in an overall approximate 3 - 4 fold saving in computational effort after consideration of the additional overhead for excitation generation and matrix element evaluation , as shown in figs .  [",
    "fig : hphf1 ] and [ fig : hphf2 ] .",
    "additionally , the instantaneous walker distribution is a more spin - pure representation than in the determinant basis , where the condition of eq .",
    "is only fulfilled in a time - averaged sense .",
    "separate convergence to the lowest energy states in both odd and even spin sectors of the hamiltonian is also possible , as the parity of the spin - coupled functions will be reversed in each case .    within the determinantal excitation scheme outlined in section  [ sec : excitgen ] ,",
    "excitations between these spin - coupled functions can be easily computed .",
    "although there are up to four possible primitive determinantal couplings between two spin - coupled functions , due to the symmetry we only need to consider excitations from one of the constituent determinants in the function , and _ define _ the excitation probability from the other to be zero .",
    "this is possible since all coupled functions are connected from both constituent determinants .",
    "the fact that the excitation from the chosen primitive determinant may be coupled to both primitive determinants in the excited spin - coupled function results in the general halving of the the generation probabilities .",
    "however , as with the matrix element evaluation , a small overhead is required for the calculation of this one extra primitive generation probability to correctly modify the overall excitation probability .",
    "cheaper in the spin - coupled space , due to the reduction in walker count somewhat offset by the larger spawning rate due to the increased timestep and slightly increased computational overheads . ]",
    "we present here an initial study into the chromium dimer , demonstrating the ability of the method to scale to large system sizes and walker numbers , as well as the ability to be run on many computing cores .",
    "this system has been heralded as one of the most challenging in the quantum chemical community , with practically all methods struggling with its mix of important dynamical and static correlation effects owing to bonding character between both low - lying 3d and more diffuse 4s orbitals , as well as its weak and unusual hextuple bond . also of importance",
    "are the correlation effects of the 3p electrons , which have been shown to be crucial to a quantitative description of the binding@xcite .",
    "this suggests that a multireference , correlated treatment of 24 electrons is required to correctly capture the physics of the bond .",
    "one method which has had some success in treating the system is the density matrix renormalization group ( dmrg ) approach@xcite , and it is against this which we benchmark our results here .    for consistency with the large - scale dmrg study of kurashige",
    "et al.@xcite , as well as a spin - adapted dmrg study of sharma et al.@xcite , we performed a single - point calculation of the chromium dimer , at a bond length of 1.5 , correlating 24 electrons in an orbital space of 30 hartree ",
    "fock orbitals , formed from an underlying sv basis@xcite .",
    "although this small basis will be insufficient to capture the dynamical correlation effects , it should be a sufficient model of the valence space to include the strong static correlation effects of the d - d binding which dominates this bond length .",
    "this space is well outside what could be achieved with fci , as a single vector of the size of the space would require around 60,000 terabytes of memory .",
    "by contrast , the @xmath59-fciqmc calculation shown in fig .",
    "[ fig : cr2 ] was performed with 200 million walkers ( @xmath93  gigabytes of distributed memory ) .",
    "after an initial walker growth stage performed on small - scale resources , the calculation was run for on 576 cores for 34 hours while statistics were accumulated .",
    "the resultant energy of hartrees is in almost exact agreement with the dmrg results extrapolated to infinite bond dimension ( hartrees from ref .   and hartrees from ref .  ) , and gives strong confidence in the value .",
    "it is hoped that this accuracy can be maintained while pushing to a correct description of the dynamic correlation , and an extension to the rest of the potential surface in the future .",
    "200 million walkers were used .",
    "dmrg results , as well as those of ccsdtq and mrci ( from casscf(12,12 ) active space ) are obtained from kurashige et al.@xcite , while dmrg in the spin - adapted basis is obtained from sharma et al.@xcite the extent of the @xmath59-fciqmc errors bars are given by the dotted lines . ]",
    "in this paper , we have detailed the algorithmic aspects of the fciqmc method as implemented in molpro and the freely - available standalone neci code , focusing on the parallelism / annihilation scheme and the random excitation generation for large - scale calculations .",
    "it is hoped that this will be useful to others aiming to implement fciqmc or related methods and those in the lattice dmc and connected communities , as well as beginning a discussion on alternative and optimal algorithms .",
    "other aspects of the algorithm that were largely omitted , such as error analysis of correlated ratios as required in eq .   or calculation of parity changes and matrix elements between determinants are largely covered in other materials@xcite .",
    "in addition , the algorithm describes only the bare discrete walker dynamics . moving to a hybrid real - integer representation of the wavefunction",
    "has been shown to provide substantial reductions in the size of the random errors for equivalent computational effort@xcite , and can be easily incorporated into this algorithmic structure .",
    "the algorithm was also applied to the paradigmatic correlation problem of the chromium dimer , where an @xmath59-fciqmc calculation was converged to close agreement with large - scale dmrg calculations , and is expected to be at the fci limit .",
    "this provides the confidence to apply the method to larger challenging metallic systems where other methods struggle , and combine it with complementary approaches for dynamic correlation .",
    "we would like to sincerely thank andy may and peter knowles for their help and support with the integration of fciqmc into the molpro codebase .",
    "in addition , we thank alex thom and james spencer for useful discussions , and jennifer mohr , nick blunt , michael morkle , adam holmes and cyrus umrigar for helpful comments on the manuscript .",
    "we gratefully acknowledge funding from trinity college , cambridge , and an epsrc grant ep / j003867/1 ."
  ],
  "abstract_text": [
    "<S> for many decades , quantum chemical method development has been dominated by algorithms which involve increasingly complex series of tensor contractions over one - electron orbital spaces . </S>",
    "<S> procedures for their derivation and implementation have evolved to require the minimum amount of logic and rely heavily on computationally efficient library - based matrix algebra and optimized paging schemes . in this regard , </S>",
    "<S> the recent development of exact stochastic quantum chemical algorithms to reduce computational scaling and memory overhead requires a contrasting algorithmic philosophy , but one which when implemented efficiently can often achieve higher accuracy / cost ratios with small random errors . </S>",
    "<S> additionally , they can exploit the continuing trend for massive parallelization which hinders the progress of deterministic high - level quantum chemical algorithms . in the quantum monte carlo community , stochastic algorithms are ubiquitous but </S>",
    "<S> the discrete fock space of quantum chemical methods is often unfamiliar , and the methods introduce new concepts required for algorithmic efficiency . in this paper , we explore these concepts and detail an algorithm used for full configuration interaction quantum monte carlo ( fciqmc ) , which is implemented and available in molpro and as a standalone code , and is designed for high - level parallelism and linear - scaling with walker number . </S>",
    "<S> many of the algorithms are also in use in , or can be transferred to , other stochastic quantum chemical methods and implementations . </S>",
    "<S> we apply these algorithms to the strongly correlated chromium dimer , to demonstrate their efficiency and parallelism . </S>"
  ]
}