{
  "article_text": [
    "gamma - ray bursts ( grbs ) are the most electromagnetically luminous explosions in the universe .",
    "their non - thermal and highly variable gamma - ray emission implies that the emitting region must be ultra - relativistic  moving with a very large lorentz factor , typically @xmath1 and sometimes as high as @xmath2 , in order to avoid excessive pair production at the source ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) . at sufficiently large distances from the source the grb outflow decelerates",
    "as it drives a strong relativistic shock into the surrounding medium ( for reviews see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "synchrotron emission from this long lived external shock powers the grb afterglow , which is observed in the x - rays , optical or radio , typically over days to months after the prompt gamma - ray emission .",
    "the peak frequency of the afterglow emission shifts to lower energies as the afterglow shock decelerates by sweeping up the external medium @xcite .",
    "this picture of a decelerating relativistic expansion of the emitting region during the afterglow phase is supported by direct measurements of the afterglow image size at late times in the radio , using very long base - line interferometric techniques , for grb  030329 at @xmath3 @xcite .",
    "grb activity manifests itself over a dynamical range of @xmath4 13 decades in radius .",
    "the phenomena involves different stages , which are usually modeled separately because of their complexity .",
    "let us consider these stages in turn , working from the small scales to the large scales .",
    "grbs divide into two classes according to their duration and spectral hardness  @xcite . long duration grbs ( lasting @xmath5s ) are associated with type ic core collapse sne , and thus to the death of massive stars  @xcite , while the nature of short duration grb ( lasting @xmath6s ) progenitors is still debated  @xcite , the most popular model involving the binary merger of two compact stars  @xcite .    in the collapsar model for long grbs",
    "@xcite , during the collapse of a massive wolf - rayet progenitor star a black hole is formed , which rapidly accretes stellar envelope material , launching a relativistic jet that penetrates the star and eventually powers the grb @xcite .",
    "it has been modeled using numerical simulations , where a jet is usually injected as an inner boundary condition at the center of a collapsing massive star , and bores its way out of the progenitor star s envelope  @xcite .",
    "some simulations include a magnetic field ( in an ideal magnetohydrodynamical framework ) and recently added a general relativistic framework  @xcite .",
    "the alternative model for the central engine of long grbs featuring the formation of a millisecond magnetar ( i.e. a very rapidly rotating highly magnetized neutron star ; * ? ? ?",
    "* ) has also been studied numerically  @xcite .",
    "binary merger simulations of two neutron stars or a neutron star and a black hole were performed in the context of short grbs  @xcite .",
    "recent general relativistic magnetohydrodynamics ( mhd ) simulations show that a relativistic jet can naturally form in such a scenario , which may indeed power short grbs  @xcite .",
    "similar simulations of relativistic jet formation from accretion onto a black hole are routinely performed also in the context of active galactic nuclei or micro - quasars  ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "different processes have been suggested to accelerate and collimate the jet : ( i ) thermal energy injected into the jet by annihilation of neutrinos and anti - neutrinos from an accretion disk  ( e.g. , * ? ? ?",
    "? * ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) ; ( ii ) rotational energy extracted from the central black hole through the blandford - znajek effect  @xcite ; ( iii ) rotational energy extracted from the accretion disk , coupled with a dynamically important magnetic field  @xcite .",
    "once the grb outflow transfers most of its energy to the shocked external medium it becomes dynamically sub - dominant and the flow becomes insensitive to the exact composition or initial radial structure of the original outflow . at this stage a spherical flow approaches the  @xcite self - similar solution ( hereafter bmk ) , losing memory of the initial conditions and retaining memory only of the total energy .",
    "the complete evolution of a spherical relativistic fireball , including the acceleration , coasting and deceleration phases , has been studied numerically by @xcite by using one dimensional ( 1d ) spherical simulations .",
    "when a non - spherical relativistic outflow ( or jet ) decelerates , to zeroth order it locally resembles a section of the spherical bmk solution characterized by the local value of the energy per solid angle or isotropic equivalent kinetic energy , @xmath7 .",
    "once the lorentz factor @xmath8 drops to @xmath9 , where @xmath10 is the initial half - opening angle of an initially uniform jet with sharp edges , the jet becomes causally connected in the lateral direction and can in principal start spreading sideways significantly .",
    "simple analytic models argue that it should indeed quickly spread sideways  @xcite , while numerical simulations show that the lateral spreading is much more modest , and the flow retains memory of @xmath10 for a long time , which for typical values of @xmath10 in grbs lasts up to the non - relativistic transition time  @xcite .",
    "the numerical simulations of jet dynamics during the afterglow stage are usually done separately from the earlier stages ( of the jet formation , acceleration and collimation ) , in order to simplify these challenging numerical computations , which involve a very large dynamical range .",
    "the most common initial conditions for simulations of the grb jet during the afterglow stage are a conical wedge of half - opening angle @xmath10 taken out of the spherical bmk solution ( though in some cases a relativistic cold shell or blob is used instead ) .",
    "since the angular size of regions that are casually connected in the lateral direction is @xmath11 , such a bmk wedge should not evolve significantly while its lorentz factor is @xmath12 , suggesting that the subsequent evolution should be insensitive to the exact choice of initial lorentz factor @xmath13 in the limit where @xmath14 .",
    "for an ultra - relativistic blast wave most of the energy in the shocked ( downstream ) region is within a thin layer behind the shock transition , whose width is @xmath15 in the lab frame ( i.e. the rest frame of the external or upstream medium , which in our case is also that of the central source ) , which is hard to resolve properly for large initial lorentz factors  ( see , e.g. , * ? ? ?",
    "therefore , most simulations use @xmath16 rather than the ideal choice of @xmath17 , along with values of @xmath10 that are not very small ( usually @xmath18 and @xmath19 ) , despite the actual initial lorentz factors at the onset of the afterglow are estimated to be at least a few hundred  ( e.g. , * ? ? ?",
    "* ) , while the values of @xmath10 inferred from afterglow observations  ( e.g. , * ?",
    "* ) can be as low as @xmath20 ( or a high as @xmath21 ) .",
    "since afterglow emission is thought to be predominantly synchrotron radiation from the shocked external medium , then accurately inferring the properties of the original relativistic outflow and the external medium from afterglow observations requires an accurate modeling of the dynamics .",
    "the jet numerical simulations and calculations of the corresponding afterglow emission  @xcite have recently been extended to well within the non - relativistic stage  ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "following the dynamics from a highly ultra - relativistic initial lorentz factor ( @xmath22 , for which @xmath23 ) down to highly newtonian velocities ( @xmath24 ) requires a very large range of spatial scales , for which an adaptive mesh refinement ( amr ) code is necessary in order to properly calculate the multi - dimensional flow dynamics .",
    "@xcite were the first to study this problem numerically by using multi - dimension numerical simulations and found that the grb jet sideways expansion is slower than expected from analytical models .",
    "these results were later confirmed by @xcite , who followed the evolution of the grb jet up to the non - relativistic phase by running high resolution two - dimensional ( 2d ) simulations .",
    "simulations using similar initial conditions were also run by who found that the shock front becomes unstable at high values of the lorentz factor , @xmath25 , but the instabilities quickly decay when the jet decelerate to @xmath26 .",
    "all the multi - dimensional numerical simulations of afterglow jets have so far assumed a uniform external medium , even though a stratified external medium is expected for the stellar wind of a massive star long grb progenitor  @xcite .",
    "this was partly motivated by the faster deceleration of the afterglow shock with radius in a uniform external medium compared to a stratified one , which reduces the required dynamical range of the simulations .",
    "moreover , magnetic fields may also affect the jet dynamics ( in addition to their effect on the afterglow synchrotron radiation )",
    ".   have used 1d simulations to study the deceleration of magnetized grb ejecta propagating into a uniform ambient medium , and showed that while the late evolution of strongly magnetized shells resembles that of hydrodynamic shells , the magnetization plays an important role into the onset of the forward shock emission .",
    "@xcite computed the afterglow emission produced by a grb ejecta decelerating into a realistic external medium by running 1d spherical simulations .",
    "however , multi - dimensional simulations are necessary in order to fully capture the magnetic field dynamics , as for instance the generation of turbulence by the magnetohydrodynamics kelvin - helmholtz  @xcite or richtmyer - meshkov  @xcite instabilities , and the consequent magnetic field amplification  @xcite .",
    "actually ,  @xcite have recently shown that even in 1d one can not realistically model the deceleration stage separately from the acceleration stage if the outflow is initially highly magnetized and accelerates under its own magnetic pressure . instead",
    ", a full simulation of the acceleration and deceleration is needed , requiring a very large dynamical range that is numerically challenging .    with the aim of addressing these questions , and perhaps also possible applicability to earlier stages of the jet dynamics ( such as its acceleration or propagation within the progenitor star ) ,",
    "we have developed a new amr , relativistic hydrodynamic code . while the code developed",
    "is similar in several aspects to previous srhd - amr codes  ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) we consider it important to present a detailed , self - contained description of the hydrodynamic code as well as the matching radiation code , along with detailed tests .",
    "the paper is organized as follows . ",
    "[ sec2 ] and  [ sec3 ] describe in detail , respectively , the srhd code and the radiation code used to calculate the observed afterglow emission ( by post - processing the outcome of the srhd simulation ) .",
    "standard tests used to verify the srhd code are presented in the appendix , while the correct implementation of the radiation code is discussed in  [ sec4 ] . ",
    "[ sec4 ] presents a detailed study of the propagation of a relativistic , purely hydrodynamic ejecta into a one - dimensional stratified medium as well in a multi - dimensional homogeneous medium together with the resulting lightcurves .",
    "finally ,  [ sec5 ] presents our conclusions .",
    "simulations of the propagation of jets into a stratified medium and the inclusion of magnetized flows will be addressed in future work .",
    "the special relativistic hydrodynamics ( srhd ) equations in conservative form  ( e.g. , * ? ? ?",
    "* ) can be written as follows : @xmath27 where @xmath28 is the thermal pressure , @xmath29 is the flow velocity ( @xmath30 being the speed of light ) , and @xmath31 is the identity matrix .",
    "these equations represent the conservation of rest mass ( [ rhd1:eq ] ) , momentum ( [ rhd2:eq ] ) , and energy ( [ rhd3:eq ] ) . the conserved variables ( @xmath32 ) correspond to the lab frame rest mass , momentum , and energy ( excluding rest mass ) densities , respectively .",
    "they are related to the primitive variables ( @xmath33 ) by the following relations : @xmath34 where @xmath35 is the lorentz factor , @xmath36 is the proper rest mass density , and @xmath37 is the specific enthalpy .",
    "the srhd system of equations is closed by the equation of state , relating @xmath37 to @xmath28 and @xmath36 .",
    "note that by explicitly subtracting the rest mass in the definition of the lab frame energy density @xmath38 in equation  ( [ eq : tau ] ) , the non - relativistic hydrodynamic equations are properly recovered when @xmath39 .",
    "the srhd equations  ( [ rhd1:eq])-([rhd3:eq ] ) form an hyperbolic system of equations and can be solved by using methods similar to those developed for classical non - relativistic gas dynamics ( for a review see , e.g. , * ? ? ?",
    "without loss of generality , the solution of the hyperbolic system of equations @xmath40 is given in 1d ( the generalization to multi - dimensions is straightforward ) by : @xmath41 where @xmath42 represent the position of the center of the cell @xmath43 with volume @xmath44 , @xmath45 are the positions of the interfaces between the cells @xmath42 and @xmath46 , and @xmath47 @xmath48 are the volume average of the conservative variables and their time - averaged fluxes .",
    "while equation  ( [ eq : cons ] ) represents an exact solution of the corresponding partial differential equation , an approximation is introduced when the fluxes ( equation  [ eq : flux ] ) are computed .",
    "because an exact solver is in general very expensive , in the current version of the code we have implemented the simple and computationally efficient relativistic extension @xcite of the hll method @xcite .",
    "it is well - known that the hll method does not resolve properly the contact discontinuity , and it has an intrinsic high level of numerical diffusivity , while for instance other methods ( e.g. the hllc method , @xcite ) properly reconstructs the contact discontinuity , producing results with significantly lower dissipation .",
    "on the other hand , being more diffusive , the hll method is also more `` robust '' , very rarely producing unphysical results such as negative pressures or imaginary lorentz factors .",
    "in addition , a low dissipation method may produce undesirable effects , such as a `` carbuncle '' artifact along the axis of propagation of strong shocks ( see the discussion by * ? ? ? * ) .",
    "second order accuracy in time and space are obtained by employing a runge - kutta integrator and by a spatial reconstruction of the primitive variables @xcite , except in shocks where the methods drops to first order ( in space ) by a limiter .",
    "different limiters are implemented , including the `` minmod '' ( being the most diffusive ) , umist , superbee and the less diffusive `` monotonized central difference '' limiter .",
    "the extension to cylindrical and spherical coordinates is treated very carefully in the code .",
    "for instance , in two - dimensional ( @xmath49 , @xmath50 ) spherical coordinates , the equations read : @xmath51 where @xmath52 , @xmath53 , @xmath54 , @xmath55 can be easily derived from equations  ( [ rhd1:eq])-([rhd3:eq ] ) .",
    "we note that a simple cell - center discretization of this system of equations introduces large numerical errors when differencing .",
    "in particular , it does not preserve stationary initial conditions to machine accuracy . as an example , if one assumes static initial conditions , as @xmath56 , @xmath36 constant and @xmath57 , these are preserved in the code if , e.g. , the relation ( easily derived from the @xmath58component of the momentum equation ) @xmath59 is held to machine accuracy .",
    "a simple centered discretization gives @xmath60 where @xmath61 is evaluated at the center of the cell , while @xmath62 at the interface between different cells , and it does not preserve the initial conditions .    a way to minimize numerical errors when differencing equation  ( [ eq : sph ] ) , especially near coordinate singularities , is by a finite volume discretization ( e.g. ,",
    "* ; * ? ? ?",
    "* ) , that is by averaging the variables over the cell volume .",
    "given for instance the cell centered in @xmath63 and with nodes located at @xmath64 , the value of of the quantity @xmath65 averaged over the cell volume is given by @xmath66 with this definition , radial and polar derivatives are approximated by ( taking @xmath67 and @xmath68 respectively ) : @xmath69 where @xmath70 , while the source terms are discretized by assuming ( taking @xmath71 and @xmath72 respectively ) : @xmath73 it is easy to verify that , written in this form , equation  ( [ eq : he ] ) preserves static initial conditions to machine accuracy .",
    "the equation of state relates the enthalpy to the pressure and density . in the case of a relativistic perfect gas it takes the form @xcite @xmath74 where @xmath75 , and @xmath76 is the @xmath77-order of the modified bessel functions of the second kind .",
    "as the evaluation of the enthalpy from equation  ( [ eos : synge ] ) is computationally expensive ( see e.g. @xcite ) , simplified relations have been used , the simplest being the @xmath78-law equation of state ( eos ) @xmath79 with a constant value of the adiabatic index @xmath78 fixed and equal to @xmath80 or @xmath81 , valid only in the limit of ultra - relativistic or sub - relativistic fluids , respectively .",
    "@xcite proposed the eos ( see also @xcite ) @xmath82 which in addition to approximating equation  ( [ eos : synge ] ) within 2% , also satisfies the @xcite inequality @xmath83 in accordance with relativistic kinetic theory .",
    "more recently , @xcite proposed a simpler and better approximation to the synge eos ( accurate to within 0.5% ) , which also satisfies the taub inequality ( equation  [ eos : taub ] ) , given by @xmath84 the implementation of these eos is straightforward , and unless stated otherwise , in this paper we use the one derived by @xcite .",
    "the increased level of complexity in solving the srhd equations when compared to the corresponding non - relativistic hydrodynamics equations arises mainly from the lack of simple closed expressions relating conserved ( @xmath38 , @xmath85 , @xmath86 ) and primitive ( @xmath28 , @xmath87 , @xmath36 ) variables .",
    "this requires the primitive variables to be computed from the conserved variables by a non - linear iteration .    among others",
    ", @xcite studied several algorithms to convert conserved to primitive variables for the case of a @xmath78-law eos .",
    "@xcite , for the eos defined in equation  ( [ eos : ryu ] ) , applied a newton - raphson method to an 8-th order equation dependent on @xmath8 .",
    "@xcite , for the case of relativistic mhd with a general equation of state , derived an equation for @xmath88 , and evaluate @xmath89 by a newton - raphson iterative scheme , with the derivative @xmath90 given by using thermodynamics relations . here , we present a different implementation . taking advantage of the existence of a relation between the specific enthalpy @xmath37 and @xmath75 , we solve the system of equations ( [ eq : d]-[eq : tau ] ) as a function of @xmath91 by using a standard newton - raphson method , and we then determine the other variables .",
    "first , squaring the momentum equation ( @xmath92 ) we get : @xmath93 with @xmath94 . from the definition of specific enthalpy",
    "it follows that @xmath95 .",
    "therefore , equation  ( [ eq : gam ] ) leads to the following inequality ( e.g. schneider et al . 1993 ) @xmath96 by using the relation @xmath97 , we can then derive from the definition of energy density ( excluding rest mass , i.e. @xmath98 ) the following identity @xmath99 equations  ( [ eq : gam ] ) and ( [ eq : fth ] ) are then used , together with a standard newton - raphson method , to determine @xmath91 , with @xmath100 given by @xmath101 where the relation @xmath102 has been used ( derived from equation  [ eq : gam ] ) , and @xmath103 .",
    "the derivative @xmath104 depends on the particular eos used , and can be determined both analytically or numerically . in the case of the @xcite eos ( equation  [ eos : ryu ] ) , @xmath105 .",
    "we also note that @xmath106 for every value of @xmath91 ( for the eos considered here ) . therefore , as @xmath107 , a solution for the equation @xmath108 exists if @xmath109 , which implies the relation @xmath110 must hold in order to allow a solution with physically acceptable values of @xmath8 and @xmath28 ( that is , real values of @xmath111 and @xmath112 ) .",
    "as we have shown , this method can be easily applied to any equation of state of the form @xmath94 .",
    "furthermore , the guess used by the newton - raphson method ( nrm ) is provided by simply assuming @xmath113 . in this case , setting a tolerance of 10@xmath114 into the newton - raphson solver , the method converges typically within @xmath115 iterations . in very rare cases when the nrm fails to converge ,",
    "a bisection method is used instead .",
    "we have implemented the srhd equations in the framework of the adaptive mesh refinement code mezcal . in the code , a basic cartesian grid is built at the beginning of the simulation , and it is refined based on the initial conditions and the subsequent evolution of the flow . the uniform version of the code has been used in the past to simulate mhd jets .    in the mezcal code ,",
    "the computational grid is divided in `` octs '' ( or blocks ) of 2@xmath116 cells , where @xmath117 is the number of dimensions of the problem .",
    "each block has a series of pointers to its vertexes , and each vertex has pointers to the octs sharing that particular vertex . in this way , neighbor octs ( both along the axes and the diagonal direction ) can be easily located in the grid , facilitating the computation of the mhd solver ( that , in staggered mesh methods , is based on determining electric fields at the cell vertexes ) . at a given time , each position on the grid is covered by only one cell , i.e. there are no pointers between `` parent '' and `` sibling '' usually present in other tree - amr codes ( e.g. * ? ? ?",
    "* ) . furthermore , there are no ghost cells in any of the blocks .",
    "although the use of pointers causes a small memory overload ( corresponding to 4 integers per cell in 3 dimensions ) , that is largely compensated by the fact that , due to the small block size , the grid covers only regions that effectively need to be refined .    at every timestep ,",
    "all blocks are swept , and they are refined / coarsened if a user defined criterion is fulfilled .",
    "typically , this criterion is based on the first or second derivative of some variable , but more complex criteria can be easily implemented .",
    "once a list of blocks flagged for refinement has been formed , the grid is checked for consistency . as the code maintains a maximum ratio of 2 in the size of neighbor cells , all coarser neighbors of blocks",
    "are flagged for refinement .",
    "when a block is refined , 2@xmath116 new blocks are created , and the parent block is eliminated . to avoid excessive memory fragmentation , the block lists are periodically reordered .",
    "coarsening is allowed only when the 2@xmath116 neighbor blocks ( previously produced by refining the same parent block ) are marked for derefinement during the same timestep .",
    "we use zeroth - order interpolation when refining , and we integrate the conserved variables over the volume when coarsening , following the strategy presented by @xcite .    to evolve the hyperbolic equations , the code employs a timestep common to all grid levels . while the use of a global timestep may potentially produce an important computational overload with respect to using a local timestep , the local time step method can represent an important bottle - neck for parallelization , as blocks on different levels must to be evolved sequentially ( and not in parallel ) . the fluxes are computed by locating the neighbor blocks , and considering the cells sharing the same faces . when two blocks with different levels of refinement share the same face , @xmath118 fluxes are computed between the 2@xmath119 cells located on the higher level block and the cell part of the block at the lower level of refinement .",
    "the fluxes are then added to the conserved variables of the cells sharing the common boundary .",
    "the mezcal code is parallelized by using the _ message passing interphase _ ( mpi ) library .",
    "the communication time is minimized by scheduling it in parallel with the calculation of the fluxes .",
    "this is done by first computing the fluxes between blocks located in each process , and then , once the communication phase is completed , computing the rest of the fluxes ( between blocks `` inside '' each process and ghost blocks ) . the load balancing is achieved by ordering the blocks by a space - filling curve @xcite , dividing the total number of blocks between the different processes , and moving blocks between unbalanced processes . in the code , the morton and",
    "the hilbert space - filling curves @xcite are implemented .",
    "the load balancing is typically applied every @xmath410 timestep , and represents an overload of @xmath41% of the total computational time .",
    "the parallel scaling of the amr code is under evaluation and will be presented elsewhere .",
    "here we provide a detailed derivation of the procedure required to calculate the radiation emitted from a relativistic source , following @xcite , which is based on previous work @xcite .     to the flux observed by a distant observer",
    "is @xmath120 , where @xmath121 is the angle between the direction opposite to that at which the detector is pointing ( @xmath122 in the figure ) and the local direction from a small emitting region within the source ( of volume @xmath123 ) to the detector . since the observer is far away , the direction of emission in the observer frame is almost parallel to the z - axis.,scaledwidth=45.0% ]    0.5 cm    the geometry of the problem is shown in figure  [ fig1 ] .",
    "we denote with @xmath121 the angle subtended by the direction @xmath124 of the observer ( perpendicular to the differential area @xmath125 at the detector , and opposite to the direction at which the detector is pointing ) and the local direction @xmath126 from the relevant ( contributing ) part of the source to the observer . in practice almost always @xmath127 , as the source size is much smaller than the distance from the source to the observer , so that @xmath128 .",
    "we also define @xmath129 as the differential solid angle subtended by the contributing portion of the source as viewed by the observer .",
    "our aim is to calculate the observed flux density , @xmath130 , which is the energy per unit area , frequency and time in the direction @xmath131 normal to @xmath125 . from the definition of the angular distance to the source , @xmath132 , where @xmath133 is the cosmological redshift",
    ", we have @xmath134 , where @xmath135 is the differential area in the plane of the sky ( normal to @xmath126 ) sustained by the source .",
    "the angular distance to the source is related to the luminosity distance : @xmath136 , by @xmath137 .",
    "the differential contribution to the flux can be written as @xmath138 . here",
    "@xmath139 is the specific intensity ( the energy per unit area , time and frequency of radiation directed within a small solid angle @xmath140 , which is centered on the direction @xmath126 ) , and should be evaluated at the location of the observer . for an optically thin source @xmath141 , where @xmath142 is the emitted energy per unit volume , solid angle , frequency and time , while @xmath143 is the differential path length along the trajectory of a photon that reaches the observer at the time @xmath144 when @xmath145 is measured ( the subscript @xmath133 here denotes quantities measured in the cosmological frame of the source ) . since @xmath146 , @xmath147 and @xmath148",
    "are lorentz invariant @xcite , we have @xmath149 .",
    "therefore , @xmath150 , where @xmath151 is the volume element in the source cosmological frame . here",
    "@xmath152^{-2}\\,j'_{\\nu'}$ ] is measured in the source ( cosmological ) frame , while @xmath153 is measured in the ( comoving ) rest frame of the emitting material , which expands at a velocity @xmath154 in the source frame .",
    "altogether , this gives we make the approximation that @xmath155 , and replace @xmath156 with @xmath157 , for simplicity .",
    "as long as @xmath158 ( which is also typically the case , in particular for cosmological grbs ) one can also neglect the change in @xmath126 between the different parts of the source , and replace @xmath126 with the constant @xmath131 . ]",
    "@xmath159 where @xmath160 is the coordinate time at the source s cosmological frame , @xmath161 and @xmath162 corresponds to a photon emitted at the origin ( @xmath163 ) at @xmath164 . since @xmath165 and @xmath166 is the differential of the isotropic equivalent spectral luminosity in the comoving frame , equation  ( [ f_nu1 ] )",
    "can be rewritten as @xmath167 there are two main approaches to calculate @xmath145 from the results of a numerical simulation .",
    "the first one relies on numerically calculating @xmath168 along different lines of sight ( i.e. trajectories or world lines of photons that reach the observer ) , and then computing @xmath169 .",
    "this was applied both in analytical @xcite and in numerical  @xcite calculations .",
    "its main advantages are that it can properly handle the optically thick regime , where the radiative transfer equation is solved ( analytically or numerically ) along each line of sight , and that it provides the observed image of the source ( i.e. @xmath168 on the plane of the sky ) as a by - product , since it is used when calculating @xmath145 .",
    "its main disadvantage for numerical simulations is that it requires accessing many different `` snapshots '' of the simulation results , corresponding to different lab frame times @xmath160 , for calculating each value of @xmath168 , as it requires integration along the trajectories ( or world - lines ) of photons that reach the observer .",
    "the second approach , we adopt here , avoids this difficulty , and was already used in several previous studies @xcite . in this approach",
    "the range of observed times , @xmath144 , is divided into a finite number ( @xmath170 ) of time bins of width @xmath171 centered on @xmath172 ( for @xmath173 ) .",
    "that is , the @xmath77 bin corresponds to @xmath174 , and there are no overlaps or gaps , so that @xmath175 for @xmath176 . for many physical systems ( such as the ones we simulate ) it is convenient to choose logarithmically spaced bins , with a constant @xmath177 .",
    "if the time bins are sufficiently densely spaced , such that the second time derivative ( with respect to @xmath144 ) of @xmath145 is correspondingly small , then @xmath178 can be approximated by its average value within the @xmath77 time bin , @xmath179 now given that @xmath180 = \\delta(x - x_0)/|f'(x_0)|$ ] when @xmath181 has a single root at @xmath182 , we obtain    @xmath183    where @xmath184 is the heaviside step function and @xmath185 .",
    "the results of a simulation that models the dynamics of a physical system are naturally given at a finite number ( @xmath186 ) of time steps ( @xmath187 , where @xmath188 ) , i.e. `` snapshots '' of the dynamics .",
    "at each snapshot the values of the hydrodynamic variables are provided at a finite number of points , each at the center of a computational cell , which represents a finite three dimensional volume @xmath189 ( generally different from that of other cells for an amr code ) .",
    "for this reason , we assign to each snapshot time @xmath187 a finite time interval : @xmath190 and @xmath191 for @xmath192 , @xmath193 and @xmath194 for @xmath195 , and @xmath196 and @xmath197 for @xmath198 . sufficiently dense and",
    "well distributed snapshot times are key to the flux calculations .",
    "thus , the simulation provides a finite number of 4-dimensional space - time cells , which together cover the finite simulated 4-volume ( the time and three dimensional volume covered by the simulation ) .",
    "the 4-volume of the @xmath199 3d cell of the @xmath200 snapshot time is @xmath201 .",
    "given the physical conditions in each such 4d space - time cell we can then calculate its local ( comoving ) emissivity , @xmath153 ( under appropriate assumptions ) and use equation  ( [ eq : f_nu ] ) in order to calculate its contribution to the observed flux density , @xmath145 .",
    "the proper way of doing this is to calculate the fraction @xmath202 of its 4-volume @xmath203 that falls within each observer time bin centered on @xmath172 , resulting in the following discretized version of equation  ( [ eq : f_nu ] ) , @xmath204 where the subscript `` @xmath205 '' indicates that the relevant quantities are evaluated at the appropriate cell , centered on @xmath206 .",
    "since the order of the summation is not important , it is much more convenient to evaluate the contributions of each 4d cell according to the order at which it is stored .",
    "since it is not always convenient and may cost additional computational time to calculate all of the coefficients @xmath202 , one might further simplify equation  ( [ eq : f_nu - dis ] ) by attributing all of the contribution from any given 4d cell to a single observer time interval , corresponding to that of the cell s center :    @xmath207    finally , one could simplify things even further by assuming an isotropic emission in the fluid ( comoving ) rest frame , and then @xmath208 can be replaced by @xmath209 where @xmath210 .",
    "we currently make this simplifying assumption .    for 2d jet simulations , which assume an axisymmetric flow , the jet symmetry axis is the @xmath133-axis and it is convenient to choose the @xmath211-axis along the @xmath126-@xmath212 plane , so that @xmath126 may be easily expressed in terms of the viewing angle @xmath213 ( where @xmath214 ) , @xmath215 thus , in spherical @xmath216 or cylindrical @xmath217 coordinates ( with @xmath218 ) , we have @xmath219      the observed image can be calculated by dividing the plane of the sky ( i.e. the plane normal to @xmath126 ) into bins or 2d `` pixels '' and assigning the contribution @xmath220 from each computational 4d cell to the appropriate pixels ( or pixel ) , where the conversion from flux to specific intensity ( which is relevant for the image calculation ) is done by using the relation @xmath221 , so that the intensity contribution to the @xmath222 pixel whose area is @xmath223 would be @xmath224 the assignment of the contribution to the appropriate pixel requires a parameterization of the plane of the sky . for this purpose",
    "we use a rotated reference frame denoted by a twiddle , where @xmath225 and the @xmath226-axis points to the observer ( in the direction of @xmath126 ) , @xmath227 @xmath228 @xmath229 for an axisymmetric flow the image is invariant to @xmath230 or equivalently to @xmath231 , i.e. @xmath232 and @xmath233 . ) , where the dependence on @xmath234 is only through @xmath235 , which is invariant to @xmath236 that according to equation  ( [ eq : twiddle ] ) corresponds to @xmath230 or @xmath231 . ]",
    "a 2d simulation ( whether in spherical or cylindrical coordinates ) provides 2d snapshots of the dynamics , and each 2d computational cell ( not counting the time dimension ) needs to be transformed into one or more 3d cells . for the special case of an observer along the jet ( or flow ) symmetry axis , corresponding to @xmath237 , the contribution to the observed emission ( i.e. to @xmath168 or @xmath145 ) becomes independent of @xmath238 , which in this case is equal to @xmath234 , so that the image has circular symmetry ( @xmath168 becomes independent of @xmath238 ) and a single bin in @xmath234 becomes sufficient for the calculation . for @xmath239",
    ", however , one needs to artificially produce a large number of bins in @xmath234 , each corresponding to a 3d cell , which together represent a single 2d computational region .",
    "the choice of binning should be done wisely , such that the doppler factor does not vary by a large factor between neighboring bins ( in order to calculate the observed radiation accurately enough ) and the bin size should not be too coarse ( as to cause excessive graininess in the calculated images or lightcurves ) , while having a reasonable number of bins ( in order for the computational time not to be too large , especially for high - resolution simulations ) .",
    "please note that since the contribution to the flux is invariant to @xmath236 , it is enough to choose values in the range @xmath240 and give each resulting 3d or 4d cell a double weight when calculating @xmath145 ( since @xmath241 also represents @xmath242 .",
    "the main purpose of the current radiation calculations is to check the effect of the dynamics on the afterglow lightcurves . because of this",
    ", we intentionally use a very simple model for the radiation mechanism ( following * ? ? ?",
    "* ) , which features synchrotron emission and ignores inverse compton scattering or its effects on the synchrotron emission through the additional electron cooling that it causes .",
    "it also ignores self - absorption , and the local emission spectrum is approximated by a broken power - law .",
    "the magnetic field is assumed to hold everywhere a fraction @xmath243 of the proper internal energy density , @xmath244 , i.e. @xmath245 . just behind the shock all electrons are assumed to be accelerated into a power - law energy distribution , @xmath246 the local emissivity @xmath247 is taken to be a broken power - law , @xmath248 with the following flux normalization and break frequencies , @xmath249 electron cooling is treated in an approximate manner , by assuming that everywhere the electrons have cooled at their current local cooling rate over the dynamical time , which is in turn approximated as @xmath250 , so that the expression in equation  ( [ eq : nu_c ] ) is simply derived from @xmath251 a more proper treatment of the electron cooling would require following each fluid element from the point where it crosses the shock and the electrons are accelerated , and solving the equation for the subsequent evolution of their energy distribution , accounting for their radiative losses and adiabatic gains or losses .",
    "this has been done analytically for the bmk self - similar solution @xcite and numerically using a 1d lagrangian code @xcite .",
    "it has also been implemented in an eulerian code @xcite , in a somewhat approximate fashion due to the difficulty in accurately tracking the electron energy distribution in each fluid element .",
    "the differences between our treatment of the electron cooling and the results presented by @xcite are shown in detail in the appendix .",
    "it is also possible to use an even simpler emission model that ignores electron cooling altogether by assuming @xmath252 in the broken power - laws of equation ( [ eq : nupl ] ) . in this paper electron cooling",
    "is always implemented in our calculations . in an accompanying paper @xcite , however , in some cases",
    "we also use an even simpler emission model that ignores electron cooling altogether , @xmath253",
    "in this section , we use our amr+radiation code to study the evolution of impulsive relativistic blast waves both in one - dimension ( 1d )  a spherical blast wave propagating into either a uniform or a stratified medium , bridging from the blandford - mckee to the sedov - taylor ( st ) self - similar solutions  and in two dimensions ( 2d )  an axi - symmetric jet propagating into a uniform medium .",
    "@xcite studied the self - similar propagation of an ultra - relativistic spherical impulsive blast wave in a medium with a density @xmath254 they showed that an appropriate choice of the similarity variable is @xmath255 where @xmath49 and @xmath256 are the radial position ( in polar coordinates ) of the fluid element and of the shock front respectively ; @xmath257 is the lorentz factor of the shock front , which as that of the fluid ( and all of the velocities ) here is measured in the rest frame of the upstream medium ahead of the shock , and it is related to the the lorentz factor of the shocked fluid just behind the shock front by @xmath258 .",
    "@xcite showed that the position of the shock front is given by @xmath259 and its lorentz factor can be written as @xmath260 where @xmath261 is the density of the ambient ( un - shocked ) medium at the position of the shock front , and @xmath262 is the energy in the blast wave .",
    "the lab frame time corresponding to a given lorentz factor of the shock front is therefore ( see equations ( [ eq : bmdens ] ) , ( [ eq : r ] ) and ( [ eq : gamma ] ) ) given by @xmath263^{1/(3-k ) } \\ .",
    "\\label{eq : t}\\ ] ]    the post - shock lorentz factor @xmath8 , proper rest - mass density @xmath36 , and pressure @xmath28 , are given by @xmath264}\\ ,   \\\\ \\label{eq : bm3 } p & = & \\frac{2}{3}\\rho_k(r)c^2\\gamma_{\\rm sh}^2\\chi^{-(17 - 4k)/[3(4-k)]}\\ .\\end{aligned}\\ ] ]    the relativistic blast wave typically begins to slow down when it sweeps up an amount of mass with a rest - mass energy of order of the kinetic energy of the blast wave .",
    "that corresponds to a distance ( sedov length ) of @xmath265^{1/(3-k)}\\ , \\label{eq : sedov}\\ ] ] where the jet energy @xmath262 is the energy ( excluding rest energy ) in the flow . for a non - spherical flow , or a jet , to zeroth order @xmath262 in equations ( [ eq : gamma ] ) and ( [ eq : t ] )",
    "can be replaced by the local value of the isotropic equivalent energy in the flow , @xmath266 , as long as it does not vary significantly over an angular scale of the order of the inverse of the local value of the lorentz factor of the fluid just behind the shock .",
    "in particular , for a double - sided conical wedge of half - opening angle @xmath10 taken out of the bmk solution ( or a uniform sharp - edged jet ) , which we later use as the initial conditions of our 2d simulations , we have @xmath267erg , where we have used a fiducial value of @xmath268erg , typical for long duration grbs . whether it is more appropriate to use @xmath262 or @xmath269 in equation ( [ eq : sedov ] ) for such a jet ,",
    "i.e. at which distance from the origin it becomes newtonian , is a non - trivial question , which is addressed in an accompanying paper @xcite .    in the non - relativistic limit ,",
    "the self - similar behavior of the blast wave is described by the sedov - taylor @xcite self - similar solution , with the position of the shock wave given by @xmath270^{1/(5-k)}\\ , \\label{eq : nr}\\ ] ] and the shock velocity given by @xmath271 . approximated expressions for the post - shock density ,",
    "pressure and velocity profiles in the st regime are given , e.g. , by .",
    "as there are not analytical solutions for the scaling of density , pressure and velocity in the post - shock region , it is not possible to find a simple analytical expression for @xmath272 . based on the simulations presented in ",
    "[ sec : ic ] ) , we find @xmath273 for @xmath274 respectively .      in this paper , we perform a series of 1d ( with @xmath274 ) and 2d ( with @xmath275 ) simulations of the propagation of impulsive blast waves , including the transition from the relativistic to the non - relativistic phase .",
    "all simulations employ spherical ( polar ) coordinates , and using the hll method ( see  [ sec : int ] ) for the flux calculation .",
    "the multi - dimensional simulations for the cases @xmath276 are presented in an upcoming paper @xcite .",
    "the initial conditions of the problem depend on the values of the following parameters : the isotropic energy of the blast wave , @xmath277 , the initial lorentz factor of the jet shock front , @xmath278 , the density profile of the external medium ( that is , the values of @xmath279 and of the normalization factor @xmath280 ) and the jet initial half - opening angle , @xmath10 ( in the 2d case ) .",
    "in all the simulations , the initial profiles of density , pressure and lorentz factor ( radial velocity ) in the post - shock region are set from the bmk self - similar solutions , given by equations  ( [ eq : bm1])-([eq : bm3 ] ) .",
    "we initialize the density of the ambient medium ( in the case @xmath275 ) as @xmath281 , and the pressure as @xmath282 , with @xmath283 .",
    "the value of @xmath284 does not affect the outcome of the simulation as long as the mach number remains large , i.e. @xmath285 . as the simulation continues to evolve well into the newtonian regime , this condition corresponds to @xmath286 .",
    "in a first set of simulations , we study the deceleration of mildly relativistic impulsive blast waves bridging from the bmk to the st self - similar solution . in the case",
    "@xmath275 , the initial conditions are similar to those used by @xcite .",
    "to determine the density profile in the cases @xmath276 , we fix the sedov length ( equation [ eq : sedov ] ) as @xmath287 : @xmath288^{1/(3-k ) } =           \\left[\\frac{3",
    "e}{4\\pi a_0 c^2}\\right]^{1/3 } \\ ,    \\label{eq : deck}\\ ] ] and derive an expression for @xmath280 as @xmath289 .",
    "therefore @xmath290 we further assume @xmath291  ergs , corresponding to a sedov length of @xmath292 cm , and a lorentz factor of the shock of @xmath293 . to properly cover the deceleration to non - relativistic speeds ( especially for the case @xmath294 )",
    ", we use a large spherical box of radial size @xmath295 cm ( corresponding to a size of @xmath296 ) .",
    "the simulation is stopped at @xmath297  yrs .    in the case",
    "@xmath275 , the simulations begins at @xmath298  s , with a jet shock located at @xmath299  cm .",
    "the case @xmath300 corresponds to an initial time and jet shock radius given by @xmath301 .",
    "the case @xmath294 , corresponding to a steady spherically symmetric wind , has @xmath302 .",
    "the values assumed for the spherical wind can be compared with those observed for wolf - rayet stars , which winds have large mass - loss rates of @xmath303  m@xmath304yr@xmath305 and velocities @xmath306  km  s@xmath305 , giving @xmath307 , which is very similar to the one used in the simulations .",
    "the amr code uses a basic grid of 1000 cells with a maximum of 18 levels of refinement , corresponding to a maximum resolution of @xmath308 cm . in a uniform grid code",
    ", the same resolution would be achieved by using @xmath309 cells .    in a second set of simulations",
    ", we test the radiation code by running simulations of highly relativistic decelerating blast waves ( limited to the case @xmath275 ) both in 1d and 2d . in these simulations , we assume an isotropic energy of @xmath310  ergs , corresponding to a sedov length of @xmath311 cm , and a lorentz factor of @xmath312 .",
    "the simulations begins at @xmath313  s , with the shock initially located at @xmath314  cm , and ends at @xmath315  yrs . to properly study its lateral expansion , an initial opening angle of @xmath18  rad ( in the 2d case )",
    "is assumed for the jet .",
    "the spherical box has a radial size of @xmath316 cm and angular size ( in the 2d simulation ) @xmath317 .",
    "the amr code uses a basic grid of 100 cells along the radial direction both in 1d and 2d , and 4 cells along the @xmath50 direction in the 2d simulations .",
    "we run a series of simulations varying the maximum number of refinement levels .",
    "the lowest resolution simulation uses 10 maximum levels , while the highest employs 18 levels of refinement in 1d and 15 in 2d , corresponding to a maximum resolution of @xmath318 cm in 1d and @xmath319 cm , @xmath320rad ( along @xmath49 and @xmath50 ) in 2d .",
    "the structure of the grid at the beginning of the simulation is shown in figure  [ fig2 ] for the 2d run . in a uniform grid code",
    ", the same resolution would be achieved by employing @xmath321 cells in 1d , and @xmath322 cells in 2d .        0.5 cm    to keep approximately constant the resolution of the relativistic thin shell @xmath323 , the maximum number of levels of refinement @xmath324 is decreasing with time @xcite as @xmath325 $ ] .",
    "we refine our adaptive mesh based on rest mass density and energy gradients .",
    "the 1d simulations run in at most a few hours on a normal workstation , while the 2d simulations need a few days on @xmath326 processors .      )",
    "correspond to @xmath327  days , and @xmath328  yrs . the central panel ( @xmath300 ) includes also the profile at @xmath329  days .",
    "the bottom panel ( @xmath294 ) includes also the profile at @xmath330  days .",
    "the horizontal red line indicates @xmath331.,scaledwidth=50.0% ]    0.5 cm    during its deceleration , the shock front is typically resolved with 3 - 4 cells ( figure  [ fig3 ] ) , as is the case for most modern eulerian shock capturing schemes . the normalized lab frame density behind the shock , given from the relativistic rankine - hugoniot conditions for strong shocks : @xmath332 , remains approximately constant during the transition from relativistic to non - relativistic regimes ( see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "figure  [ fig3 ] shows that in fact @xmath333 at different times and for different values of @xmath279 .",
    "the drop of the density profile in the post - shock region approximately follows the bmk self - similar solution , and is therefore less steep with larger @xmath279 ( see equation [ eq : bm2 ] ) .",
    "this figure also shows that the deceleration process is slower for a more stratified medium .",
    "( up to bottom ) along with the ultra - relativistic ( @xmath334 ) and the sedov - taylor ( @xmath335 ) regimes .",
    "the sedov - taylor curves assume @xmath273 for @xmath274 respectively .",
    "the gray curves are computed from a semi - analytical approximation based on energy conservation ( see the text for a detailed description ) . , scaledwidth=45.0% ]    0.5 cm    figure  [ fig4 ] shows the evolution of the shock front radius for different density stratifications .",
    "both the ultra - relativistic ( with @xmath336 ) and the non - relativistic ( @xmath337 ) analytical self - similar solutions are properly recovered by the simulations . as shown e.g. by @xcite for the case @xmath275 , the transition from relativistic to non - relativistic phase happens on scales much larger than @xmath338 .",
    "if for instance we estimate from figure  [ fig4 ] the time it takes for the relativistic blast wave to slow down to non - relativistic speeds based on the intersection between the relativistic and non - relativistic self - similar curves , we obtain values of @xmath339  days , @xmath340  days and @xmath341  days for @xmath274 respectively .",
    "these values are much larger than those computed by using the sedov length ( piran 2005 ) @xmath342  days .",
    "this result , together with the scaling of position , lorentz factor and the shock velocity as a function of time and shock radius , can be easily understood by a simple analytical argument involving the conservation of energy .",
    "in fact , the energy is given in the ultra - relativistic regime by @xmath343 and in the non - relativistic limit by @xmath344 as the energy has a common scaling in relation with the other physical parameters ( @xmath345,@xmath256 ) , differing only in the constant of proportionality , a simple interpolation between the two limits is given by @xmath346 this equation can be easily written as function of velocity as : @xmath347 ^ 2 + 4 c_r ( r / l_{\\rm s})^{3-k } } } \\ , \\label{eq : fit}\\ ] ] where @xmath348 and @xmath349 .",
    "this expression approximately gives the dependence of @xmath345 ( or @xmath8 ) on the shock position , for every choice of the blast wave energy and density stratification .",
    "for instance , at @xmath350 , equation ( [ eq : fit ] ) gives @xmath351 ( or @xmath352 ) for @xmath274 respectively . at this radius ( and time ) the shock is therefore still relativistic , and the st solution is not valid .",
    "the exact determination of @xmath353 depends , however , on the definition of the transition between the relativistic and the non - relativistic flow ( e.g. * ? ? ?",
    "if for instance we define @xmath353 as the time where the asymptotic bmk solution and the st power laws are equal ( i.e. @xmath354^{1/(3-k)}$ ] ) , we get @xmath355  days ( @xmath275 ) , @xmath356  yrs ( @xmath300 ) and @xmath357  yrs ( @xmath294 ) . at this time",
    "the blast wave is nonetheless still mildly relativistic ( @xmath358 ) and the st solution is not valid .",
    "if on the other hand we assume that the st solution becomes valid at a fixed ( somehow arbitrary ) speed of @xmath359 , we get @xmath360  days ( @xmath275 ) , @xmath361  yrs ( @xmath300 ) and @xmath362  yrs ( @xmath294 ) ( figure  [ fig4 ] ) .    equation ( [ eq : fit ] ) , when rewritten in the form @xmath363 , admits a complex solution @xmath364 in terms of appell hypergeometric functions .",
    "the time dependence of the shock position @xmath365 has been therefore more easily derived by numerical integrating equation ( [ eq : fit ] ) , and it approximates the position of the shock computed from the numerical simulation within a maximum difference of 1 , 2 , 5% ( for @xmath274 respectively ) .    while figures  [ fig3 ] and [ fig4 ] clearly show the validity of our implementation for mildly - relativistic and non - relativistic speeds , reproducing the correct bmk self - similar scaling during the early stages of the simulation , when @xmath366 , is much more challenging .",
    "figure  [ fig5 ] shows the initial density profile ( for the case @xmath275 ) in the region around the position of the shock .",
    "a very large number of levels of refinement must be used to properly initialize the density , pressure and lorentz factor in the post - shock region .",
    "for instance ( figure  [ fig5 ] , upper panel ) , the initial steep density profile is recovered with errors less than 10% only by using resolutions corresponding to @xmath367 levels of refinement .     at the beginning of the simulation ( @xmath368  days , upper panel ) and @xmath369  days ( bottom panel ) .",
    ", scaledwidth=50.0% ]    0.5 cm    while the bmk self - similar solution represents an exact solution of the srhd equations in the ultra - relativistic limit , the particular discretization employed may not be the exact ( numerical ) solution of the discretized equations . as a consequence ,",
    "the relaxation towards the numerical solution passes through the development ( see figure  [ fig5 ] , bottom panel ) of a spurious numerical `` precursor '' propagating in front of the bmk shock if insufficient resolution is used . while the size of the precursor shock drops effectively with resolution , it also produces a quick drop in the maximum lorentz factor behind the shock ( due to the spreading of the initial @xmath8 peak , see figure  [ fig6 ] ) .",
    "the lorentz factor eventually converges to the correct bmk solution at @xmath370 at the largest resolution used ( 18 levels of refinement ) .",
    "figure  [ fig6 ] also shows the effect of decreasing the maximum level of resolution during the evolution of the simulation @xcite .",
    "as can be appreciated from figure  [ fig6 ] , the decrease in the resolution produces a slower convergence to the bmk solution .",
    "the time evolution of @xmath8 from @xcite , included in figure  [ fig6 ] is similar to our low resolution ( 14 levels ) one - dimensional simulation , corresponding approximately to the resolution achievable in multi - dimensional simulations .",
    "the noise in the @xcite curve is due to a larger temporal sampling .",
    "a proper treatment of the tiny ultra - relativistic post - shock region would require a larger resolution or alternatively a much less diffusive method as e.g. high order ( coupled to high resolution ) or lagrangian - eulerian methods ( e.g. * ? ? ?",
    "start at @xmath371  days with a lorentz factor of 20 .",
    "the curves shown correspond to the expected bmk self - similar solution , 14 , 16 , 18 levels of refinement with a fixed maximum level of refinement , and results of the @xcite two - dimensional simulations . for 14 levels of refinement we show two curves , either with ( a ) or without ( b ) decreasing the maximum level of refinement with time .",
    "each label on the @xmath372axis corresponds to the time when the maximum resolution drops by a factor of two , so that for instance the simulation with initially 14 levels of refinement drops to 13 levels after 175  days , 12 after 209  days , and so on.,scaledwidth=45.0% ]    0.5 cm    the specific numerical resolution required is determined by the relevant structure one needs to resolve .",
    "the hardest to resolve , in our case , is the initial bmk shell ( @xmath373 ) at the initial time ( @xmath374 ) or radius ( @xmath375 ) .",
    "its effective width does not have a unique definition , but it can be parameterized as @xmath376 where the numerical factor @xmath377 can be evaluated using the bmk self similar solution . instead of @xmath378 in equation  ( [ eq : def - a ] ) then the value of the numerical coefficient @xmath377 would be smaller by a factor of 2 . ] defining @xmath379 as the width of the region behind the shock that contains a fraction @xmath380 of the total energy ( @xmath262 ) or rest mass ( @xmath381 ) , respectively , results in @xmath382 for @xmath383 , this gives @xmath384 and @xmath385 for @xmath386 .",
    "one can then similarly express the numerical resolution in terms of a parameter @xmath387 , @xmath388 where @xmath389 is the smallest resolution element in the radial direction .",
    "previous 2d jet numerical simulations with similar initial conditions used @xmath390 . in  @xcite",
    "the initial resolution was rather poor , @xmath391 , while in  @xcite it was significantly improved , @xmath392 . here",
    "we use @xmath393 for @xmath275 , which represents an order of magnitude improvement . for @xmath394 and @xmath395",
    "we have @xmath396 and @xmath397 , respectively .",
    "figure  [ fig7 ] shows that the light curve , computed by post - processing the results of the simulations with our radiation code , converges quickly except for @xmath398  days , where part of the flux , which should be generated from regions with @xmath399 , is shifted to a lower @xmath400",
    ". that can be in part compensated by adding the contribution coming from the jet decelerating with @xmath401 , computed by mapping in the radiation code a bmk self - similar solution . as shown in figure  [ fig7 ] ( right ) , the sum of the synthetic flux with @xmath402 and the flux computed from the results of the simulation with @xmath403 produces a valley ( shallower for increasing resolutions ) for @xmath404  day .",
    "this artificial feature is due to relaxation from the initial conditions to the numerical solution , and gradually disappears as the resolution is increased . a comparison between the lightcurve computed from the 1d simulation ( with @xmath275 ) and the semi - analytical calculations from @xcite is shown in the appendix .",
    "0.5 cm        0.5 cm      figure  [ fig8 ] shows snapshots representing the early evolutionary stages of the jet density . during the relativistic phase ,",
    "there is only modest lateral expansion . as portions of the jet",
    "expand laterally , a rarefaction front moves towards the jet axis .",
    "the strong shear present at the contact discontinuity drives shearing instabilities that have however a negligible effect on the shock dynamics and afterglow radiation coming from the jet . at the jet break time @xmath405",
    "yr , the lateral expansion becomes more vigorous , and at later stages ( on times @xmath406 ) the jet slowly converges to a spherical shape .",
    "although it is not possible to make a quantitative comparison , our results qualitatively resemble those of ( * ? ?",
    "* see their figure 2 for a direct comparison ) , as well as those of  @xcite .    while theoretical arguments @xcite seems to indicate that the shock front should be stable to linear perturbations for either a uniform or a wind density profile of the ambient medium , recent simulations by observe the development of instabilities in the shock front .",
    "the development of similar instabilities is also observed by @xcite relative to the case of a stratified medium with @xmath294 , while it is not observed in the simulations presented in this paper ( despite using the same hll riemann solver as and similar initial conditions ) , consistently with the results by @xcite .",
    "the different results in the simulation seems to imply a numerical origin for the instabilities observed by , although further investigation is needed to better understand the problem .",
    "the afterglow light curves computed from our 2d jet simulation assume that the observer is located along the jet symmetry axis ( @xmath407 ) . to facilitate comparison with the results of @xcite",
    ", we choose the same parameters for the afterglow calculation : @xmath408 , @xmath409 and @xmath410 , in addition to the same values for the parameters to determine the hydrodynamics ( @xmath411erg , @xmath412 and @xmath413rad ) .",
    "hz from the 2d simulation compared with a 2d wedge ( bottom panel ) and the results from @xcite ( upper panel ) .",
    "[ fig9],title=\"fig:\",scaledwidth=40.0% ] +  hz from the 2d simulation compared with a 2d wedge ( bottom panel ) and the results from @xcite ( upper panel ) .",
    "[ fig9],title=\"fig:\",scaledwidth=40.0% ]    0.5 cm    as in the 1d case , the afterglow emission ( figure  [ fig9 ] ) shows a shallow valley at @xmath414  day , due to a lack of resolution into the region immediately behind the high relativistic shock .",
    "figure  [ fig9 ] ( bottom panel ) shows a comparison with a 2d `` wedge '' ( computed by using a 1d simulation mapped on a wedge with @xmath415 ; the finite resolution of this 1d simulation is affecting the lightcurves at the earliest times as shown in figure  [ fig9 ] ) . before the jet break time",
    ", the 2d light curve from the simulation is very similar to that from a 2d wedge with the same ( initial ) isotropic energy , indicating that little sideways expansion takes place before the jet break , in agreement with previous analytical ( e.g. , * ? ? ? * ) and numerical @xcite results .",
    "after the jet break time , however , the flux from the 2d simulation becomes lower than that for the corresponding wedge , and the difference between the two gradually increases with time , as the lateral spreading of the jet gradually increases during the relativistic phase and then more rapidly during the newtonian phase ( until at very late times spherical symmetry is approached ) .",
    "our calculated afterglow emission and spectra agree very well with @xcite ( figure  [ fig9 ] , upper panel and figure  [ fig10 ] ) both in the flux before and after the jet break .",
    "days ( black , red , green , blue , purple ) [ fig10],scaledwidth=45.0% ]    0.5 cm",
    "in this paper , we have presented a detailed description of the new state - of - the - art adaptive mesh refinement , relativistic hydrodynamics code mezcal - srhd and of the radiation code used to compute the synchrotron emission from the output of the hydrodynamics simulation .",
    "the proper implementation of the srhd algorithm has been verified by running standard one- and multi - dimensional tests which are presented in the appendix .",
    "the code has been applied to the study of the propagation of ultra - relativistic impulsive blast waves both in one and two - dimensional spherical coordinates .",
    "we have studied for the first time the deceleration of relativistic impulsive blast - waves in one dimension propagating in a stratified medium and find that the deceleration to non - relativistic speeds happen on scales @xmath416 from a few ( for @xmath275 ) to several times larger than the sedov length @xmath417 .",
    "taking @xmath416 as the radius where @xmath418 gives the expression @xmath419^{1/(3-k)}$ ] , which illustrates how @xmath420 increases with the degree of stratification of the ambient medium where the shock is propagating .",
    "these results have been described in detail using a simple semi - analytical formula , derived from energy conservation , which gives the correct scaling of the position and velocity of the shock as a function of time .",
    "the results obtained by the radiation code were validated by a comparison with semi - analytical results , and with those obtained in previous numerical works .",
    "we have also shown that while the resolution is a key factor to properly recover the correct dynamical evolution of the system ( with some of the parameters not yet converging , e.g. the shock lorentz factor ) , when the contribution from the radiation produced by the jet before the onset of the simulation ( in our case @xmath421 ) is included in the calculation , the resulting light curve becomes much less sensitive to the exact resolution .    in an upcoming paper",
    ", we will extend the results of the simulations presented here to include multi - dimensional simulations in a stratified medium .",
    "the study of the contribution of the magnetic field on the jet dynamics and afterglow radiation is left for future works .",
    "this research was supported by the david and lucille packard foundation ( err and fdc ) , the nsf ( err ) ( ast- 0847563 ) , the erc advanced research grant `` grbs '' and a dgapa postdoctoral grant from unam ( dlc ) .",
    "we thank weiqun zhang to share with us data from his 2d simulations ( used in figure [ fig6 ] ) .",
    "[ appendix ]",
    "a comparison between the lightcurve computed by mapping in the radiation code a blast wave described by a bmk self - similar solution and the semi - analytical calculations from @xcite is shown in figure  [ fig11 ] . while @xcite obtained smooth spectral breaks , for simplicity we use here their broken power - law prescription ( without synchrotron self - absorption ) . in that work",
    "the afterglow emission from the bmk solution is calculated for an exact local synchrotron spectral emissivity while analytically calculating the electron energy distribution everywhere by following its evolution from the shock front ( where it is assumed to be a pure power - law ) due to radiative and and adiabatic cooling .",
    "the light curve computed by using a simplified emission model ( equation [ eq : nocool ] ) that neglects electron cooling altogether is an very good agreement with the gs02 semi - analytical results ( see figure [ fig11 ] ) .",
    "the light curve computed by using an approximated electron cooling presents three breaks at low frequencies ( corresponding to the transitions @xmath422 with the scaling @xmath423 @xmath424 @xmath425 with @xmath426 @xmath424 @xmath427 with @xmath428 @xmath424 @xmath429 with @xmath430 ) and two breaks at high frequencies ( corresponding to @xmath422 with @xmath423 @xmath424 @xmath431 with @xmath432 @xmath424 @xmath433 with @xmath430 ) . as can be noticed in figure [ fig11 ] , our estimation of the cooling break frequency @xmath434 assuming that the electrons cool at their current local cooling rate over the dynamical time ( see equations [ eq : nupl ] ) underestimate the cooling frequency determined by gs02 .",
    "for instance , an increase in @xmath434 of a factor of 4 produces a better agreement with the gs02 results ( figure [ fig11 ] , right panel ) .",
    "it is worthwhile to stress that , while the mapped bmk light curve and the gs02 results are applicable only for ( highly ) relativistic flows , the light curve computed from the numerical simulations is valid during all the deceleration of the flow to non - relativistic speeds . finally , we notice that at @xmath435  hz , self - absorption dominates and the light curves computed with our simple prescription are inaccurate .",
    "hz ) computed from a blandford - mckee self - similar blast wave with lorentz factor between 600 and 1 , and the semi - analytical results from @xcite .",
    "_ left panel _ : simple emission model excluding electron cooling ( equation [ eq : nocool ] ) .",
    "_ center _ : light curve computed by using an approximated emission model for the electron cooling ( equations [ eq : nupl ] ) .",
    "_ right _ : the same as the center panel , but with a cooling frequency four times larger . ]",
    "we present in this section a series of one - dimensional shock tubes and multi - dimensional tests .",
    "shock tube tests are used as standard tests as they are simple to implement and the exact analytical solution is known .",
    "the tests were performed using a grid with size @xmath436 , with an initial discontinuity at @xmath437 . here and",
    "in the following , we refer to the left / right hand side of the discontinuity with the suffixes @xmath438 . in all the tests",
    ", we use a grid with 50 cells at the lowest level , with 4 levels of refinement , corresponding to an effective resolution of 400 cells .",
    "we also make high resolution runs of the same tests , employing 400 cells at the lowest level , with 4 levels of refinement , corresponding to an effective resolution of 3200 cells . the courant number if fixed equal to 0.8 in all tests , with a final integration time of @xmath439 .",
    "the politropic index is fixed equal to 4/3 in the first shock tube test and 5/3 in all others tests . as described in the following , in all the tests",
    "the exact solution is properly recovered .",
    "the first test consist of a low - relativistic flow with a left state given by @xmath440 , @xmath441 , @xmath442 , corresponding to a lorentz factor of @xmath443 , and a right state given by @xmath444 , @xmath445 , @xmath446 .",
    "the evolution of this shock tube consists of two shocks and a stationary contact discontinuity .",
    "small oscillations , similar to those observed by previous authors , are present in the post - shock region .",
    "the second shock tube consists of a low - relativistic flow with a left state given by @xmath447 , @xmath441 , @xmath448 and a right state given by @xmath449 , @xmath450 , @xmath451 . in this test ,",
    "two rarefaction wave are produced , together with a left moving contact discontinuity .",
    "both rarefaction waves are properly recovered , while the contact discontinuity is smeared over @xmath452 cells .",
    "the last two tests are taken from @xcite , and refer to blast wave explosions .",
    "the third shock tube consists of of a left state given with @xmath453 , @xmath454 , and a right state given by @xmath455 , @xmath445 , while in the last test the left state is given by @xmath456 , @xmath441 , and the a right state is given by @xmath457 , @xmath445 , the large pressure gradient produces a mildly relativistic shock ( test 3 ) and a highly relativistic shock ( test 4 ) with @xmath458 . as can be seen in figure  [ fig : testst ] , the solution consists in both cases of a strong shock moving to the right and a rarefaction wave moving to the left .",
    "no oscillations are present in the solution .",
    "the shock is resolved within @xmath459 cells , while the contact discontinuity is smeared over several cells .",
    "that is expected , due to the intrinsic diffusive properties of the hll schemes . in the second blast wave problem ,",
    "the size of the thin dense shell in the post - shock region consists of only @xmath460 cells with the resolution employed . as a consequence ,",
    "the exact value of the density is not recovered at low resolution . however , this region is properly resolved in the high resolution run .    .",
    "the variables shown are : density , velocity and pressure .",
    "the initial discontinuity was set at @xmath437 , the courant number is equal to 0.8 , with a maximum resolution of 400 cells ( points ) and 3200 cells ( lines ) .",
    "the panels correspond to first ( upper left ) , second ( upper right ) , third ( bottom left ) and fourth ( bottom right ) shock tube tests ( see the text for a detailed description of the initial conditions).,title=\"fig:\",scaledwidth=45.0% ] .",
    "the variables shown are : density , velocity and pressure .",
    "the initial discontinuity was set at @xmath437 , the courant number is equal to 0.8 , with a maximum resolution of 400 cells ( points ) and 3200 cells ( lines ) .",
    "the panels correspond to first ( upper left ) , second ( upper right ) , third ( bottom left ) and fourth ( bottom right ) shock tube tests ( see the text for a detailed description of the initial conditions).,title=\"fig:\",scaledwidth=45.0% ] .",
    "the variables shown are : density , velocity and pressure .",
    "the initial discontinuity was set at @xmath437 , the courant number is equal to 0.8 , with a maximum resolution of 400 cells ( points ) and 3200 cells ( lines ) .",
    "the panels correspond to first ( upper left ) , second ( upper right ) , third ( bottom left ) and fourth ( bottom right ) shock tube tests ( see the text for a detailed description of the initial conditions).,title=\"fig:\",scaledwidth=45.0% ] .",
    "the variables shown are : density , velocity and pressure .",
    "the initial discontinuity was set at @xmath437 , the courant number is equal to 0.8 , with a maximum resolution of 400 cells ( points ) and 3200 cells ( lines ) .",
    "the panels correspond to first ( upper left ) , second ( upper right ) , third ( bottom left ) and fourth ( bottom right ) shock tube tests ( see the text for a detailed description of the initial conditions).,title=\"fig:\",scaledwidth=45.0% ]          this test has been studied in the non - relativistic case by @xcite , and extended to the srhd case by .",
    "it has been widely used recently as a test for multi - dimensional srhd codes . the computational domain ( at @xmath461 )",
    "is divided in four regions : @xmath462 we use a uniform grid with @xmath463 cells , an adiabatic equation of state with constant @xmath464 , and outflows boundary conditions .",
    "the simulations ends at @xmath465 . to better resolve the contact discontinuity ,",
    "a more compressive mc limiter is used here .",
    "the results are shown in figure  [ fig : test6 ] .",
    "the initial discontinuities across the four regions of the grid produce stationary contact discontinuity ( with jumps in transverse velocities ) between sw - nw and se - sw , and shocks between ne - nw and se - sw .",
    "these shocks produce an elongated jet - like structure on the diagonal .",
    "these features , together with the curved shock in the sw region , are qualitatively similar to those obtained by previous authors .",
    "the `` emery step '' test has become a standard test both for non - relativistic and relativistic hydrodynamics codes , and it consists of a wind moving through a tunnel . our initial conditions closely follow those by . a relativistic flow moves initially horizontally with velocity @xmath466 , corresponding to a lorentz factor of @xmath467 .",
    "the density is initially fixed at @xmath468 everywhere , with a pressure of @xmath469 and an adiabatic index of @xmath470 , corresponding to a newtonian mach number of @xmath471 .",
    "the size of the tunnel is @xmath472 and @xmath473 .",
    "a step is located in the region defined by @xmath474 .",
    "inflow boundary conditions ( with the same values used to fill the tunnel initially ) are fixed at the left boundary .",
    "outflow boundary conditions are fixed at the right boundary , while reflecting boundary conditions are fixed at the upper , lower and step boundaries .",
    "we use a uniform grid with @xmath475 cells , with the hll method coupled to the mc limiter .",
    "figure  [ fig : test6 ] shows the density stratification at @xmath476 . as the relativistic flow collides with the step , a reverse shock is formed .",
    "this shock front is reflected from the upper boundary forming a stationary mach stem .",
    "the results of this tests are similar to those of ."
  ],
  "abstract_text": [
    "<S> we report on the development of mezcal - srhd , a new adaptive mesh refinement , special relativistic hydrodynamics ( srhd ) code , developed with the aim of studying the highly relativistic flows in gamma - ray burst sources . </S>",
    "<S> the srhd equations are solved using finite volume conservative solvers , with second order interpolation in space and time . </S>",
    "<S> the correct implementation of the algorithms is verified by one - dimensional ( 1d ) shock tube and multidimensional tests . </S>",
    "<S> the code is then applied to study the propagation of 1d spherical impulsive blast waves expanding in a stratified medium with @xmath0 , bridging between the relativistic and newtonian phases ( which are described by the blandford - mckee and sedov - taylor self - similar solutions , respectively ) , as well as to a two - dimensional ( 2d ) cylindrically symmetric impulsive jet propagating in a constant density medium . </S>",
    "<S> it is shown that the deceleration to non - relativistic speeds in one - dimension occurs on scales significantly larger than the sedov length . </S>",
    "<S> this transition is further delayed with respect to the sedov length as the degree of stratification of the ambient medium is increased . </S>",
    "<S> this result , together with the scaling of position , lorentz factor and the shock velocity as a function of time and shock radius , is explained here using a simple analytical model based on energy conservation . </S>",
    "<S> the method used for calculating the afterglow radiation by post - processing the results of the simulations is described in detail . </S>",
    "<S> the light curves computed using the results of 1d numerical simulations during the relativistic stage correctly reproduce those calculated assuming the self - similar blandford - mckee solution for the evolution of the flow . </S>",
    "<S> the jet dynamics from our 2d simulations and the resulting afterglow lightcurves , including the jet break , are in good agreement with those presented in previous works . </S>",
    "<S> finally , we show how the details of the dynamics critically depend on properly resolving the structure of the relativistic flow . </S>"
  ]
}