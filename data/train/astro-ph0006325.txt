{
  "article_text": [
    "some time ago we began measuring proper motions with the wfpc2 camera of the _ hubble space telescope _ ( king et al .",
    "1998 ) , and we are now in the late stages of developing precision techniques for astrometry with that camera . our present level of accuracy has now moved almost an order of magnitude beyond the level of our previous paper , and we believe that it has reached a level that we are unlikely to improve substantially .",
    "this is the first of a series of papers that will describe our techniques .    the present paper centers on the vital role of an accurate point - spread function ( psf ) , which we find to be the touchstone of accurate astrometry . without proper attention to the psf ,",
    "astrometry in undersampled images tends to suffer from systematic errors which depend on the locations of stars with respect to pixel boundaries .",
    "we shall demonstrate this pixel - phase error , show that an accurate psf removes it , and set forth methods of determining a psf of high precision .    because of the sharpness of its imaging ,  has a unique capability for accurate astrometry .",
    "astrometry of images was initially an important selling point of  ( spitzer 1978 , jefferys 1980 , 1985 ) .",
    "it is therefore surprising that ten years after launch there are still very few papers in the literature that report significant scientific results from astrometry on  images .",
    "astrometry has concentrated on the use of the fine guidance sensors ( for one star at a time ) , but has made little use of imaging",
    ". there have in fact been several important _ displacement _ results for sn1987a , planetary nebulae , stars with outflowing jets , and gas clumps in nearby star - formation regions , but astrometry proper ( i.e. , the measurement of stars ) has been greatly neglected .",
    "it is interesting to ask why it has taken so long to tap s astrometric potential .",
    "we believe that this delay is due largely to a natural distrust of astrometry on undersampled images , combined with the fact that insufficient attention has thus far been devoted to exploring its possibilities and limitations .",
    "this paper demonstrates that accurate astrometry _ can _ be carried out on undersampled images , and that the key is to have an extremely accurate psf .",
    "differential astrometry can be divided into two distinct yet not entirely independent tasks : ( 1 ) measuring positions of individual stars in individual images and ( 2 ) comparing these positions with positions measured for the same stars in other images . in this paper",
    "we will discuss the first of these tasks .",
    "the second , which involves finding accurate coordinate transformations from one frame to another , we will take up in a subsequent paper .",
    "we will focus on measurements made with s wfpc2 camera in rich fields such as one finds in globular clusters , but many of our precepts and methods are applicable in broader contexts .",
    "we begin with a brief discussion of the impact undersampling has on astrometry . in section [ undersam ]",
    "we highlight the most significant impediment to accurate astrometry :  pixel - phase error , a systematic error that is related to the location of a star with respect to pixel boundaries .",
    "we trace the source of this systematic error to inadequate modeling of the psf .",
    "we then ( sect .",
    "[ nature ] ) show how treating the _ effective _ , rather than the instrumental , psf , allows us to arrive at an accurate model which can be used to measure unbiased positions for stars . in section [ find_psf ]",
    "we outline our procedure for obtaining such accurate psfs and using them to measure star images .",
    "we also demonstrate the accuracy of our measurements and examine the time stability of the psf . in section  [ dith ]",
    "we make recommendations for how best to dither future observations in order to facilitate an accurate psf determination .",
    "finally , in section [ epsfextend ] we show how our effective - psf treatment can be extended to other contexts .",
    "the point - spread function formed by  has a core that is about 50 milli - arcsec ( mas ) wide , the exact size depending on wavelength , of course .",
    "since the pixel sizes of the ccds in the planetary camera ( pc ) and the wide field camera ( wf ) are 45 and 100 mas respectively , it is clear that even the pc is undersampled , and the wf is badly so .",
    "adequate sampling is conventionally thought of in connection with issues of resolving power , such as the separation of two close point sources or the discernment of fine detail in extended objects . in  images of globular clusters",
    ", however , essentially all of the objects are relatively isolated point - source stars . unlike an extended object ,",
    "a point source needs only three parameters to describe it fully :  its center @xmath1 and its total flux ( @xmath2 ) .",
    "the whole task of photometry and astrometry , then , is to derive this triplet of parameters from the array of pixels that constitute the image of a star .",
    "the effects of undersampling upon this task are not as serious as one might initially suppose .",
    "for instance , we do not require nyquist sampling in order to measure precise positions for point sources .",
    "we simply require that the psf not be so sharp that _ all _ of a star s flux falls within a single pixel .",
    "as long as a reasonable amount of flux falls in the surrounding pixels , so that shifting the star s position by a small amount would redistribute light from one pixel to another , we have the basic information that we need to measure accurate positions . in the wf , when a star is centered on a pixel , that pixel receives about 40% of the star s light , while the four directly adjacent pixels each get about 8% .",
    "this spill - over of the psf core into the adjacent pixels is sufficient to enable us to pinpoint the star s location within the brightest pixel .",
    "such measurements are not without complications , however .",
    "while it is theoretically possible to obtain accurate positions in undersampled images , such measurements demand an accurate model of the psf .",
    "any inaccuracies in the psf model will induce systematic biases in the measured positions . to illustrate this basic point , in figure  [ simple_ex ] we fit the same 1-d stellar profile with two different models of the psf .",
    "the stellar profile is represented by the histogram , which gives the values of the closest three pixels to the center of this star .",
    "the two psf models ( both of which integrate to fit the pixel values exactly ) yield estimates for the `` center '' that are strikingly different , compared with our accidental error of measurement , which is about 0.02 pixel .",
    "it is obvious that the bias induced depends on the location of the star within the pixel .",
    "we refer to this bias as _ pixel - phase error_.    [ fig .  1 here ]    in conjunction with its implications for centering , fig .",
    "[ simple_ex ] also demonstrates that since the same undersampled stellar profile can be fit by drastically different psfs , it will not be easy to determine which one of the many consistent psfs is actually the `` right '' one for the image in question .",
    "if we somehow knew the position of the star , this might tie down the psf model ; however , we clearly can not know the position of the star accurately without recourse to an accurate psf .",
    "the breaking of this degeneracy is the major challenge of undersampled astrometry . in short ,",
    "we will tease apart the shape of the psf and the positions of stars by incorporating observations made of the same star at different dither positions ( different placements with respect to pixel boundaries ) .",
    "this iterative process is the major contribution of this paper .",
    "we note also , in passing , that an alternative approach might be to try to remedy the undersampling , following , for example , the fourier image - reconstruction methods of lauer ( 1999a ) .",
    "we prefer instead to aim directly at deriving a correct psf , which allows us to work with the original data without modifying the pixels in any way ; this simplifies the task of understanding the errors , which is extremely important to our objectives .",
    "it was in our early attempts at astrometry that we were led to see the crucial role of an accurate psf in the measurement of star images .",
    "these efforts concentrated on a set of 15 images of the center of the globular cluster 47 tucanae taken through the f300w filter , provided to us by georges meylan , the p.i .  of  program go-5912 .",
    "the images , rich but not crowded , have identical exposure times , have nearly identical psfs , and are well dithered .    in preparing these images for analysis",
    ", we adjusted each pixel value according to the true area of the pixel , in order to remedy the errors that are introduced by the flatfield correction made by the standard pipeline . specifically , the pixel - area correction is for optical distortion ( biretta et al .",
    "1996 ) and for the 34th - row anomaly ( anderson & king 1999 ) .",
    "( for the prescription , see biretta et al .",
    ", sec .  5.10 ; for an explanation of why the correction is needed , see the fifth paragraph of anderson & king . )",
    "we made no attempt to remove cosmic rays from the individual images .",
    "the intercomparison of the many individual photometric and astrometric measurements that we have for each star allows us easily to discard , at a later stage of the analysis , those measurements that are infected by cosmic rays .",
    "the wfpc2 detectors on board hst have become increasingly subject to charge - transfer - efficiency ( cte ) losses ( whitmore , heyer , & casertano 1999 and riess , biretta , & casertano 1999 ) . while not all the manifestations of cte are fully understood , the major symptom is that when the background is low , stars at the top of a chip ( and , to a lesser extent , those at the right ) appear fainter than those at the bottom ( and left ) .",
    "the standard remedy is to apply a simple ramp correction to the measured fluxes of stars , proportional to @xmath3 , where @xmath4 is typically between 2% and 8% , and @xmath5 is typically half that . in principle",
    "this correction should be applied to each pixel of an image before analysis , but in practice the differential correction across the image of a star is negligible , so that we can apply the cte corrections at the final stage of our photometry , while our astrometry is unaffected by it .",
    "cte losses are probably more complicated than the simple ramp model allows .",
    "losses could easily be different for each star depending on its own brightness and the specific distribution of stars downstream from it .",
    "we have examined our astrometric data for such `` shadowing '' signatures , but failed to find any significant trends .",
    "we will present the details of these tests in a subsequent paper .      with the flux - normalized images in hand",
    ", we attempted to make the most accurate positional measurements that we could on the individual stars in each image , by deriving a psf from the image itself and fitting it by least squares to each star image .",
    "we profited very much from meylan s foresight in taking a large set of well - dithered images . with multiple observations of the same star",
    ", we could find a mean position @xmath6 for each , and examine the 15 residuals @xmath7 .",
    "these residuals indicated that we were measuring positions with an accidental error of about 0.02 pixel .",
    "more important , these residuals also gave us a chance to examine our measurements for systematic errors .",
    "( note :  calculating the mean position for each star requires transforming measured positions from the frame of each image into a common frame , a process that introduces many subtle problems that will be discussed in our later papers . for our present purpose , however , it suffices to know that the mean position of a star can indeed be calculated . )",
    "knowing that inaccuracies in our adopted psf model might lead to pixel - phase error , we examined the residuals as a function of where each stellar image was located with respect to pixel boundaries ",
    "what we call its pixel phase , expressed quite simply by the fractional part of its position measurement : @xmath8 .",
    "figure [ ppe ] shows the result of this examination .",
    "the nine panels show stars in 9 sections of the image , which we examined separately because the psf is known to vary spatially in wfpc2 images .",
    "( in the present illustration , the same psf was used in all of the 9 regions , but it was determined only from stars in the central region . )    [ fig .  2 here ]",
    "the trends in the figure are so clear because the figure contains the residuals from 3000 well - exposed stars in 15 images45,000 residuals in all .",
    "we were shocked by the size of the trends , which are comparable to or larger than the accidental errors .",
    "the trends were similar in size for the @xmath9 residuals against @xmath10 , but the cross trends ( @xmath11 residuals vs.  @xmath10 and @xmath9 residuals vs.  @xmath12 ) were considerably smaller .",
    "the trends for the pc chip were similar in nature to those for the wf chips .",
    "( the apparent independence of errors in @xmath11 and in @xmath9 is probably illusory .",
    "it is likely that errors would be approximately symmetrical around the center of the pixel , and such a symmetry would produce that illusion . )    given these clear trends , a possible course would have been to use these measurements to calibrate out the systematic error empirically ; but we chose instead to look for the source of the error , with the aim of eliminating it .",
    "paradoxically , the severe undersampling of wfpc2 makes our task easier , because it makes the pixel - phase error so large that its cause is more readily evident .    from the considerations in the introduction to the present section , we know that even though stellar images appear to be well fit by a given psf , the positions measured may nevertheless be systematically biased .",
    "since we did not measure accurate positions even in the central region of the image , where the psf was determined , it is natural to suspect the psf model as the source of this error .    before setting out to find a better psf , however , we first investigated other easier - to - fix possibilities .",
    "one step was to verify that given an accurate psf , our routines could indeed measure good positions .",
    "we did this by inserting artificial stars made with our model psf , at random locations in the image , and adding a suitable amount of noise .",
    "we measured them with the ( correctly known ) psf , and found that we recovered them without pixel - phase error .",
    "we then arbitrarily adjusted our psf model and found that by making its core narrower or broader we could change the amplitude of the pixel - phase error in measurements of the actual data .",
    "it was becoming clear that the problem lay with our psfs .",
    "in addition , in the hope of a better psf - finding algorithm , we reduced the data with daophot , but found almost identical pixel - phase errors .",
    "it makes sense that astrometry should make very different demands on a psf from those of photometry .",
    "we can make a good measurement of the total flux of a relatively isolated star by simply adding up the flux within a chosen aperture and correcting that sum according to what fraction of the psf should fall within that aperture .",
    "it matters little if the psf mis - predicts the exact pixel - by - pixel distribution ; the only necessity is that the _ sum _ of the psf model over the aperture be equal to that of the true psf .",
    "astrometry , on the other hand , depends entirely on the _ differences _ in adjacent pixel values ; this means that the ability of the model to predict each individual pixel value is of paramount importance to measuring star positions .",
    "slight errors in the psf will impact astrometry directly , but photometry only indirectly .",
    "while these considerations clearly demonstrate the need for an accurate psf , they do not tell us _ how _ to obtain one . in our quest for a better psf",
    ", we found that it is worth while not only to reconsider how we measure the psf , but also to ask the more basic question of _ what _ psf we should be seeking in the first place .",
    "it is clear that if we desire to model the psf as accurately as possible , we must take full account of the pixellated nature of our image data . in this section",
    "we will examine the impact of pixellation on the psf problem , and will show that there is a very straighforward way of coping with it empirically , which leads to a representation of the psf that has great practical advantages .",
    "we will then discuss the nature and the advantages of this empirical representation , for which we reserve the name  effective psf , \" used with a very specific meaning .",
    "finally , we will contrast our treatment with other approaches to psf modeling .",
    "we wish to emphasize again that the motivation for this new approach is the need to model the images of stars more accurately than has heretofore been possible .",
    "the psf  the two - dimensional spread of light that an instrument produces when its input is a point source  is central to the art and science of image processing .",
    "each star in an astronomical image is a replica of the psf , distinguished only by its position and its flux .",
    "the intuitive nature of the psf is obvious :  it is the profile that the instrument renders when the input is a point source . in practice , however , the nature of the psf is more subtle .",
    "the telescope produces , at the focal plane , what we may call an instrumental psf ( ipsf ) .",
    "but one never directly observes this psf ; what one sees instead is the array of pixel values that results from it . even with an infinite signal - to - noise ratio and a perfect flat field , the same star will produce different arrays of numbers depending on where its center falls with respect to pixel boundaries .",
    "the astronomical image produced by a detector is indeed only a set of numbers , each of which is the number of counts registered by an individual pixel .",
    "if we examine the source of one of these pixel values , it is clear that it results from integrating the instrumental psf over the two - dimensional sensitivity profile of a pixel .",
    "one might expect the latter to resemble a square top - hat function , but in fact it does not ( lauer 1999b ) .",
    "not only does sensitivity vary within the pixel ; there is also a tendency for photoelectrons to diffuse out of the pixel ( holtzman et al .",
    "1995 , krist & hook 1999 , lauer 1999b ) .",
    "the lauer paper gives examples of intra - pixel sensitivity maps ( the function that we call @xmath13 below ) .",
    "we note that it is characteristic of many detectors that the sensitivity profile differs only inconsequentially from pixel to pixel ( see , for example , shaklan , sharman , & pravdo 1995 ) ; we confine our discussion here to detectors for which this is the case .",
    "thus every pixel value in a star image is the result of an integration over a pixel centered at some offset @xmath14 from the center of the ipsf .",
    "everything that we ever observe directly consists of such pixel values ; we never directly encounter the ipsf itself . as our initial impression was",
    "that we need to model _ that _ psf as accurately as possible , it was frustrating to realize that we can never observe it directly  until we recognized that we do not _ need _ to do so .",
    "the hidden nature of the ipsf becomes clear when we express mathematically what we _ do _ observe . if in the vicinity of pixel @xmath15 , which is centered by definition at @xmath16 , @xmath17 , there is a point source centered at @xmath18 , then the flux in that pixel will be @xmath19 where @xmath20 is a flux factor that expresses the brightness of the star , @xmath21 is the two - dimensional sensitivity profile of a pixel , @xmath22 is the instrumental psf , specifically , the fraction of light ( per unit pixel area ) that falls on the detector at a point offset by @xmath14 from the star s center @xmath23 ) , and @xmath24 is the value of the background at that pixel .    we shall show that this pixel value is the result of a convolution between the ipsf and the sensitivity profile of a pixel . to do this",
    "we note first that because the integration in eq .",
    "( [ ipsf2pix ] ) is over an infinite range , we can make a shift of zero point and write it as @xmath25 where we have written @xmath26 and @xmath27 in place of @xmath28 and @xmath29 .",
    "noting that the variables of integration @xmath11 and @xmath9 are dummy variables , we replace them by @xmath30 and @xmath31 ; the equation then becomes @xmath32 we now define the convolution @xmath33 where @xmath34 .",
    "it is easy then to see that eq .",
    "( [ ipsf2pixshr ] ) is equivalent to @xmath35 we call @xmath36 the _ effective psf _ ( epsf ) , because it gives directly , through eq .",
    "( [ epsf2pix ] ) , the fraction of a star s light that should fall in each pixel of a star image , according to where the center of that pixel lies relative to the center of the star , i.e. , the offset @xmath37 .",
    "note that @xmath38 is a continuous function and is smoother than the hidden @xmath39 .",
    "it is worth restating that , since the only data we have are the pixel values recorded by the detector , @xmath38 contains all the information we will ever need to know about @xmath39 and @xmath21 . in other words , eq .",
    "( [ epsf2pix ] ) says that we never need to know @xmath39 and @xmath21 separately .",
    "the reader should note that whereas other writers use the term `` effective psf '' in a general way to refer to a psf that has been integrated over pixels , in this paper the term always has the explicit meaning that has just been defined and described .",
    "since the effective psf plays such an irreducible role in image analysis , it is valuable to develop an intuitive understanding of what it can tell us about how point sources appear in an image . figure  [ ins2eff ] shows a graphical example of an undersampled instrumental psf ( short - axis fwhm @xmath40 0.8 pixel ) and the corresponding effective psf . at any point ( the cross ) , the epsf is equal to the integration of a pixel ( solid box ) centered at that point over the instrumental psf .",
    "both functions are quite smooth , but the epsf is , naturally , less concentrated than the ipsf .    [ fig .  3 here ]    from eq .",
    "( [ epsf2pix ] ) we see that the central point of the epsf , @xmath41 , point `` c '' in the figure , tells us directly what fraction of a star s light falls within the star s central pixel when the psf is centered on that pixel .",
    "similarly , @xmath42 , the value of the epsf at point `` r '' , tells us what fraction of a star s light falls within a pixel whose center is exactly one pixel to the right of the star s center . in general ,",
    "if the center of a star is at @xmath43 relative to the center of a pixel , then @xmath44 gives the fraction of light that should fall in the star s central pixel , and @xmath45 gives the fraction received in the first pixel to the right of the center . the gradient of @xmath38 tells us the rate at which flux is transferred into or out of a pixel as @xmath46 are varied .",
    "[ fig .  4 here ]    figure  [ coords ] shows the relation between the pixels in a stellar image and the points in the effective psf that they correspond to .",
    "we show the center of the star as the open circle .",
    "each pixel of the stellar image samples the epsf at a different location ; the array of pixels that make up a star s image sample the epsf at the array of points marked by the crosses .",
    "there are three major advantages to treating the effective psf directly , rather than working via the instrumental psf , when analyzing images .",
    "the first advantage is simplicity . in fitting the epsf to a stellar image",
    ", no integration is needed .",
    "we simply _ evaluate _ the epsf at the position of each pixel of the star image ( relative to the presumed center ) and scale it by the flux factor appropriate for the star .",
    "the fitting process , correspondingly , consists of adjusting the values of @xmath47 , @xmath48 , and @xmath20 until the sum of the squares of the residuals , @xmath49 ^ 2 \\ > , \\label{fitpix}\\ ] ] is minimized .",
    "again , this procedure involves no integrations over pixels , only evaluations at discrete points .",
    "the fitting is simply a least - squares solution for the optimal parameters in the fit of a continuous function to a given set of points .",
    "section  [ fitpsf ] describes this procedure in detail .",
    "the second advantage is that it is much easier to solve for an effective psf than for an instrumental psf .",
    "every pixel of every star image samples the effective psf at one discrete point .",
    "if we turn eq .",
    "( [ epsf2pix ] ) around , we see that the epsf can be estimated by @xmath50 so if we know @xmath47 , @xmath48 , and @xmath20 , they then tell us at which offset , @xmath51 and @xmath52 , the pixel at @xmath15 has sampled the effective psf and how this sampling has been scaled .",
    "if we know the set @xmath53 for each of @xmath54 stars , and take 5@xmath555 pixels about each of them , then we have 25@xmath56 samplings of the effective psf , each at a point in the epsf . with 3000 stars in each of 15 images ,",
    "we get well over a million estimates of @xmath36 at various offsets in this 5@xmath555-pixel area .",
    "our procedure for representing and deriving a smooth epsf from this wealth of data will be described in detail in section  [ epsf_const ] .",
    "when the psf is undersampled , it is especially useful to be able to work with such a directly observed function .",
    "by contrast , the conventional practice of trying to deduce the hidden instrumental psf ( or the major part of it , as in the underlying gaussian that daophot uses ) from observed pixel values ( essentially a deconvolution ) , and then re - integrating over @xmath21 to fit it to the same pixels , appears to be a roundabout and counter - productive procedure . as errors can arise in both of these steps",
    ", it is clear that the effective - psf approach is not only easier , but numerically preferable .",
    "the third advantage of the epsf is more subtle , and in many ways more valuable .",
    "its values result from integration over the actual pixel sensitivity profile of the detector , whatever it may be .",
    "since , as we have noted above , we have no need to untangle the contributions of @xmath39 and @xmath21 , we do not need to make any assumptions about how sensitivity varies within a pixel .",
    "our effective psf simply ( and accurately ) represents whatever results from the combination of the detector and instrumental psf , with no assumptions on our part .",
    "the concept and use of the effective psf that we have introduced here are quite new when considered as a whole , but they are related to , and in some ways build on , other treatments that have been made .",
    "the salient characteristics of our epsf are that ( 1 ) it is completely empirical , without reliance on any analytic approximation , ( 2 ) it is derived directly from observed pixel values , without any modification other than scaling , and ( 3 ) fits to pixel values follow directly from it by simple evaluation and scaling , without any integration .",
    "we were originally stimulated to the concept of the effective psf by ideas contained in lauer s discussion of how to use fourier techniques to combine multiple undersampled dithered images into a single well - sampled `` superimage '' ( lauer 1999a ) .",
    "although the concept that we have introduced here is not explicitly stated in lauer s paper , we believe that it is implicit in his discussion .",
    "but we have moved in a different direction , because our aims are different .",
    "lauer s desire is to create a finer - scale `` superimage '' that is equivalent to the one that would have been produced by a detector that is well sampled , and his method of doing this is direct , elegant , and probably the best treatment available for extended objects .",
    "such a well - sampled superimage is well suited for deconvolution , which will produce an estimate of the true scene .",
    "deconvolution is not , however , a tool that is relevant to the measurement of point sources .",
    "while it is indeed possible to measure positions of stars on such a well - sampled superimage , to create such an image in the presence of geometric distortion requires an intimate knowledge of the inter - image transformations , which can be attained only by accurately measuring stars on the images independently .",
    "furthermore , one of the major objectives of our project will be the accurate assessment of our errors , which is straightforward only if we have multiple independent measurements of each star s position , which we obtain by measuring each image separately and combining the positions afterwards .",
    "it is the intercomparison of such measurements that allows us to examine our data for systematic errors such as pixel - phase error or uncorrected distortion .",
    "we therefore find it far preferable to develop an accurate model of the effective psf , as we defined it in section [ eff_psf ] , and to use it to measure a position for each star in each image .",
    "we are by no means the first to create a psf that has been integrated over pixels .",
    "it is this very idea that is so interwoven into the lauer paper to which we have just referred . and integration over pixels is included , in one way or another , in daophot ( stetson 1987 ) , dophot ( schechter , mateo , & saha 1993 ) , and most other procedures that fit star images with a psf .",
    "it is daophot that comes closest to the idea of our effective psf .",
    "after fitting the closest gaussian , daophot creates its psf by integrating the gaussian , correctly placed , over the area of each pixel in a star , and taking the difference between this result and the observed value of that pixel .",
    "it tabulates these residuals , evaluated at half - pixel intervals starting at the center of the gaussian . to fit the psf to a star , for each pixel",
    "it integrates the gaussian and then does a cubic interpolation in its array of residuals to find the correction that needs to be added to it .",
    "thus daophot operates in a hybrid manner .",
    "it does treat its array of residuals as an adequately fine tabulation of a continuous function that is already integrated over pixels , but it still needs to integrate the gaussian over each pixel .",
    "daophot , as we have indicated , suffers from astrometric pixel - phase error .",
    "the reason is that it lacks our procedure of correcting positions by dithered averaging and iterating between psf shape and star positions , which we will describe in section [ find_psf ] .",
    "it is not surprising that daophot does not produce the best possible positions ; it was designed to do good photometry , not astrometry . to paraphrase a remark made to us by its author , peter stetson ,",
    "a tool used for the wrong purpose is not likely to be optimal .",
    "dophot ( schechter et al .  1993 ) presents an interesting contrast .",
    "it ignores the pixel - integration problem and simply evaluates its psf at the center of each pixel that is to be fitted ( saha , private communication ) . at first glance",
    "this might seem to imply the use of an ipsf , without integration over the pixel .",
    "in fact , however , dophot derives its psf from pixel values , so that its psf has indeed been integrated over pixels , by the detector itself .",
    "schechter et al .",
    "show that dophot produces quite good photometry ; we surmise that the good performance in spite of such a simplified approach to pixels is due to the fact that its psf is derived from pixel values in exactly the same way in which it will be used on them .",
    "we have no doubt , however , that the pixel - phase errors in the positions that it derives are quite serious . unlike daophot",
    ", dophot does not seem amenable to the average - and - iterate procedure ; its purely analytic psf representation lacks the necessary flexibility .",
    "we adopt here a purely empirical model , akin to using a daophot - type lookup - table without the benefit of an analytical model .",
    "stetson ( 1987 ) considers such a model , but adopts the analytical backbone in order to minimize the undersampling and interpolation concerns .",
    "our finer sampling combined with our psf - construction procedure will automatically address these concerns .",
    "such a tabular approach has the obvious advantages of flexibility and simplicity .",
    "because we observe the effective psf directly in each star image ( see eq .  [ epsfsam ] ) , and can see exactly which part of the psf needs adjusting to better fit the observations , we can directly adjust the grid to better reflect the observed stellar profiles .",
    "such a grid - representation also is particularly amenable to the modeling of `` ugly '' psfs ( such as intentionally or unintentionally trailed images ) which might not have an obvious analytical backbone .",
    "as our goals involve modeling the psf to unprecedented accuracy , the flexibility of the tabular approach is a very important factor .",
    "the effective psf is a continuous function which extends out to several hundreds of wf pixels . in the undersampled wfpc2 cameras , practically all of the information from which we can fix the position and flux of a star",
    "is contained in its central 5@xmath555 pixels , so we will seek a numerical representation of that part of the psf .",
    "as we mentioned above , we will represent the epsf by specifying its value at a grid of points . after some experimentation we found that it was adequate to tabulate it with four grid points per pixel width .",
    "( this choice is purely a matter of convenience , to represent this continuous function well enough that we can easily interpolate values at intermediate points .",
    "since the epsf does not have pixels , it should be clear that the grid spacing has nothing to do with any attempt to subsample an image . )",
    "our aim is thus to tabulate values of the epsf at an array of 21@xmath5521 points ( 21 rather than 20 because we place points on the boundaries ) . when we need to evaluate the epsf at locations between the grid points ( for example , when fitting stars ) , we will use bi - cubic spline interpolation .",
    "the extreme flexibility of such a grid - based model requires us to adopt some conventions regarding how we will center and normalize the psf .",
    "the definition of the center of any psf is of course arbitrary . if the psf is asymmetrical , one may ask if one should choose the peak , the centroid , or what ? rather than use either of these more conventional approaches , we decided to center our grid in a way that flows naturally from the pixel - integrated nature of the epsf .",
    "imagine taking a star that is centered on a pixel and moving it to the right , across the detector .",
    "the value of the `` central '' pixel goes down as that of the one to the right goes up . at the point where the two pixels are exactly equal we declare that the center is on the boundary between the two pixels , so that ( according to fig .",
    "[ coords ] ) , the central pixel is sampling @xmath57 and the one to the right is sampling @xmath58 .",
    "we adopt a similar definition for the @xmath9 center .",
    "a major benefit of this convention is that it is easy to re - center a psf , since the gradient is nearly maximal at 0.5 pixels from the center and the condition for centering is well defined , namely that @xmath59 .",
    "a peak - based centering algorithm is not so well constrained , since the gradient is zero at the center and the determination of the peak depends sensitively on the innermost grid points .",
    "we show in section  [ sam2psf ] how our centering convention is enforced .",
    "a useful consequence of this convention is that , noise considerations aside , the brightest pixel of a star will be drawn from the inner pixel - sized region of the psf , namely @xmath26 between @xmath60 and 0.5 and @xmath27 between @xmath60 and 0.5",
    ". we can now further identify ( for example ) the region between a @xmath26 of @xmath61 and @xmath60 and a @xmath27 of @xmath60 and @xmath62 to be the region of the epsf corresponding to the next pixel to the left of the brightest pixel .",
    "the behavior of the epsf at different points in this region reflects how the fraction of light falling in this left - of - center pixel varies with the pixel phase of the star .",
    "the other pixel - sized regions of the epsf ( designated by the dotted lines in fig .",
    "[ ins2eff ] and in the right panel of fig .",
    "[ coords ] ) have similar interpretations .",
    "it is easy to see that the epsf will be perfectly continuous across all `` pixel boundaries , '' as eq .",
    "( [ epsf2pix ] ) implies and fig .",
    "[ ins2eff ] demonstrates .",
    "it is standard to normalize psfs to have unit volume , so that the flux factor in eq .",
    "( [ epsf2pix ] ) will indeed correspond to the total flux of the star .",
    "lauer ( 1999b ) shows that in undersampled detectors ( such as wfpc2 or nicmos3 ) , the integrated flux recorded by a star can vary significantly as a function of where the star s core falls in the central pixel . in wfpc2 ,",
    "the top and bottom edges of pixels are about 1.5% more sensitive and the left and right edges about 1.5% less sensitive than average ( this depends somewhat on the filter ) .",
    "we therefore normalize our epsfs so that a star of unit flux that is centered on a pixel will have a volume of unity in its central 5@xmath555 pixels ( the region over which we will be tabulating the epsf , below ) ; a unit - flux star that is centered differently will then have a volume that is not unity but that correctly expresses the differences in the apparent brightness of a star that result both from the non - uniformities in the pixel - response function and from the differing fraction of total light that falls within the 5@xmath555-pixel aperture .",
    "that this is so is a natural consequence of the way in which we have defined the epsf ; notice again that we have taken the properties of the pixel - response function into account without needing to know that function explicitly .    in summary ,",
    "the epsf is a continuous function which tells us what fraction of a star s light should fall within any pixel , according to where that pixel lies with respect to the star s center .",
    "we will represent this epsf by tabulating its value at an array of points that is more finely spaced than the pixels themselves .",
    "we will use bi - cubic interpolation to evaluate the epsf at intermediate locations .",
    "we will center our grid in such a way that the brightest pixel of a star will be drawn from the central - pixel region of the epsf .",
    "finally , our representation is naturally able to account for variations of sensitivity within a pixel .",
    "the effective - psf approach illustrated above clearly leads to a more direct way to analyze images . nonetheless , modeling a psf `` effectively '' will not automatically produce a more accurate psf .",
    "the fundamental problem of undersampled star images remains : namely , the degeneracy between the shape of the psf and the position that it finds for each star image .",
    "we will describe below our procedure for determining an accurate effective psf for the wf2 chip in meylan s first - epoch set of images . as we indicated earlier",
    ", we will be tabulating values of the epsf at an array of 21@xmath5521 points .",
    "it should be noted that our discussion will refer , of course , to the derivation of the psf for a single chip ; each of the four chips must be treated separately . a final point to note",
    "is that we are tacitly assuming here that all of the exposures that we are combining have the same psf .",
    "this assumption will be justified empirically in section [ indiv_comp ] .",
    "whether the image is undersampled or not , the construction of an accurate psf is necessarily an iterative procedure : we can not derive a psf from an image without prior knowledge of star positions and fluxes , nor can we measure positions and fluxes without recourse to a psf . in practice",
    "we will alternate between deriving the psf and measuring the stars , improving both with each iteration .",
    "undersampling makes iteration all the more crucial , since we must in addition use multiple ditherings to tease apart the degenerate psf - shape and star - positioning information .    before beginning the iterative process of solving for a psf",
    ", we must first decide which stars can tell us something about its shape . we choose all those isolated stars that have a @xmath63 greater than @xmath4010 in each of their inner 5@xmath555 pixels .",
    "this amounts to all isolated stars ( i.e. , those having no brighter neighbors within a radius of 5 or so pixels ) that have more than 250 dn ( @xmath401750 detected photons ) in the 5@xmath555-pixel area . in each of our images",
    "roughly 3000 stars qualify .",
    "( we should mention , by the way , that crowding is never a problem for us . since the astrometric results toward which we are moving never require completeness , accuracy being our only aim",
    ", we can throw out any stars that suffer from crowding .",
    "this is easily done , even when the interfering neighbor is not directly detected ; we have found that a star that suffers from crowding can invariably be recognized by the fact that its measurements have larger residuals than those of a star of comparable magnitude that is uncrowded . )    for each of these stars , we require an initial estimate of its flux and position and background . for this we could use daophot with a library psf , or even aperture photometry , for fluxes , and simple centroids for positions .",
    "all that is really needed is a reasonably good set of starting values .",
    "we adopt a sky value for each star by taking the mode of the pixels in an annulus with an inner radius of 4 pixels and an outer radius of 7 pixels .",
    "each psf - finding iteration consists of three major stages : ( 1 ) we convert each pixel value in the image of each star into an estimate of the corresponding point in the effective psf , using the most recent values of the star s flux and position in eq .",
    "( [ epsfsam ] ) . in the present data set",
    "this corresponds to more than a million samplings of various points of the effective psf .",
    "we then construct a single effective psf from this multitude of point - samplings .",
    "( note that in practice we will end up dividing the image into 9 separately treated sections in order to represent the spatial variation of the psf , but even so each of the 9 psfs will be based on well over @xmath64 samplings . )",
    "( 2 ) we use this effective psf to remeasure , by least - squares fitting , a position and a flux for each star in each image .",
    "( 3 ) we average together the multiple observations we have for each star from the 15 different pointings , to obtain positions and fluxes that are more accurate ( in a random sense and now , as a result of combining the various dithers , in a systematic sense too ) than the individual measurements .",
    "we then transform each of these average positions back into the frame of each individual image so as to place each individual - pixel sampling more accurately in the epsf in step ( 1 ) .",
    "it is , in fact , this averaging step that is the key to breaking the degeneracy that leads to pixel - phase error .",
    "the three stages are explained in detail in the following subsections .",
    "the overall procedure typically converges in four or five iterations , although the need to converge 9 separate psfs at once has led us to continue as far as a 12th iteration .",
    "we pointed out in section  [ eff_psf ] that every pixel in an image of a star samples the effective psf at _ one _ point , provided we know what the star s position and flux are .",
    "( [ epsfsam ] ) gives the relationship mathematically , and fig .",
    "[ coords ] shows the geometrical relationship for the pixels of one star .",
    "what makes the derivation of an accurate epsf possible is that every reasonably bright star contributes one sampling per pixel per image .",
    "figure  [ datapts ] simulates the samplings from 500 stars in the epsf , along with the grid points at which we evaluate the epsf .",
    "( note that the geometric pattern of samplings is the same within each pixel , as a result of the displacement pattern illustrated in fig .  3 . )",
    "these samplings approximate the continuous two - dimensional psf .",
    "figure  [ datapts_slice ] shows the value of each of these estimates along two @xmath11-slices .",
    "[ fig .  5 here ]",
    "[ fig .  6 here ]    our immediate task is to distill from this multitude of samplings the values of the 21@xmath5521 effective - psf grid points which best represent them .",
    "( let us ignore , for the moment , the fact that because of the psf s spatial variability each star actually samples a slightly different psf",
    ". we will discuss in section  [ varpsf ] how to generalize the following procedure to a spatially variable psf . in the present context",
    "the only difference is that we take our samplings from stars in only a part of the chip rather than from the whole chip . )",
    "the process of determining the array of grid points from the samplings is still another iterative one .",
    "we first subtract from each sampling the most recent estimate of the epsf at that point , @xmath36 , so that each data point is now a residual between the estimate and the current model . in the first iteration ,",
    "the psf will be null , so that the residual will be the sampling itself . for each grid point",
    "we then take all the residuals within 0.25 pixel in @xmath26 and @xmath27 ( shown by the heavy square in figure  [ datapts ] ) , find the average residual , iteratively reject those that are more than 2.5 sigmas away from the mean , and adjust the grid point by this amount . the @xmath65-based rejection procedure results in a robust estimate of the average residual for each grid point , so that we are insensitive to stars with undetected neighbors or to individual star images affected by cosmic rays .",
    "once we have adjusted all the grid points , we then smooth them . for the interior points ( solid dots ) we use the following 5@xmath555 least - squares quartic kernel of smoothing coefficients :    @xmath66 . \\label{kernel}\\ ] ]    ( again , the number of points and the order of the fit are choices made after trial and error , to satisfy the criteria of faithful smoothing without creating artifacts . ) for the outer points ( open squares ) , we take the nearest 5@xmath555 grid points and perform a simple linear least - squares fit of the log of the grid - point value against the distance of the grid point from the center of the whole grid - point pattern ( the `` radius '' ) .",
    "we evaluate the linear function at the radius of the grid point , and use the antilog of this as the value of the grid point .",
    "we smooth the outer points ( open squares ) with a linear kernel based on the closest 4@xmath554 grid points .",
    "the coefficients in the three cases ( corner , edge , or next to the edge ) are easily derived .",
    "we smooth the outer points ( open squares ) with a linear kernel based on the closest 4@xmath554 grid points .",
    "the coefficients in the three cases ( corner , edge , or next to the edge ) are easily derived .    at the end of this procedure",
    "it is possible that the resulting epsf might not be centered properly .",
    "[ recall that we require the central pixel of the epsf to have the symmetries @xmath67 and @xmath68 , where @xmath69 and @xmath70 vary from @xmath710.5 to 0.5 . ] to correct the centering , we simply offset the placements of all samplings so that the subsequent epsf derivation will be properly centered .",
    "we do this by the shift @xmath72 ( and a corresponding expression for @xmath27 ) , where the derivatives are evaluated by simple differencing of straddling grid points .",
    "this shift is determined at the edges of the central pixel , but is applied to every sampling point .",
    "we iterate this adjust - and - smooth process several times , subtracting each new model and smoothing the newly adjusted points .",
    "the result is a set of grid points that vary smoothly , are centered on the brightest pixel , and are a good fit to the samplings . with the present data set , we found 5 iterations of this inner loop to be sufficient .    finally , before using the epsf in the next stage , we",
    "first re - scale it so that a unit - flux star that is centered on a pixel has a total flux of exactly 1.00 within its inner 5@xmath555 pixels ( as explained in sec.[think_epsf ] ) .",
    "thus far we have referred to `` the '' psf , as if there were one universal psf which applies everywhere on the chip . in most cameras (",
    "wfpc2 included ) , the psf varies slightly , but significantly , with location on the chip .",
    "mathematically , @xmath73 .",
    "we looked initially into allowing the psf to vary quadratically with position on the chip , analogously to the procedures in daophot or in guhathakurta et al .",
    "( 1992 ) ; however we found that such a psf did not provide an adequate fit to the stars over the entire chip simultaneously .",
    "after some experimentation , we found that the following simple procedure gives the psf the needed flexibility .",
    "we determine nine `` fiducial '' psfs as shown in figure  [ fiducial ] :   one at the center , four at the corners , and four in the middle of the edges .",
    "recall that a `` psf '' consists of an array of values for the @xmath74 grid points . to specify the psf at any specific location in the image , we use simple bi - linear interpolation among the four nearest psfs : the central one , two at the edges , and one at a corner .",
    "we investigated more complicated interpolation schemes ( radial functions with linear or quadratic dependences ) , but found that simple linear interpolation provided equally good fits to the stars .",
    "each time we create a psf for an individual star , this interpolation is done for each of the 441 grid points .",
    "[ fig .  7 here ]    we solve for each of the 9 fiducial psfs as prescribed in section  [ sam2psf ] , using for each psf only the samplings within the appropriate region ( delineated by the dotted lines in fig.[fiducial ] ) . since the psf is not constant even within a region , when subtracting the current model psf from each sampling to form a residual we subtract the properly interpolated psf for the contributing star s location , @xmath75 , using the other fiducial psfs for the interpolation , while adjusting only the one for the region in question . in this way",
    "we derive each fiducial psf only from the stars in its own region , while always comparing the samplings from each star with our current best estimate of the epsf that applies to its location .",
    "now that we have an improved estimate of the effective psf , we can use it to make improved fits to the individual star images .",
    "the fitting of the effective psf to each star image is a least - squares process .",
    "the relation between the pixel values and the the position and flux is non - linear , however ; and direct application of the non - linear least - squares algorithm requires first derivatives of the effective psf . rather than treat the least - squares solution generally , which would necessitate a different matrix inversion for each star , for computational ease we have linearized the @xmath76-minimization equations and solved them analytically ( see below ) .",
    "it is not of course necessary to adopt the following equations to fit a psf to star images ; but this method is very convenient and arrives easily at the least - squares result , which is unique .    essentially all the information about where a star is located is contained in the inner few pixels of the stellar image , where the gradient of the psf is highest .",
    "we therefore confine our fit to a fitting radius of @xmath401.5 pixels . in the interest of ( 1 ) fitting only whole pixels , ( 2 ) having a roughly symmetric aperture with respect to the star s center , and ( 3 ) having the aperture vary smoothly with the presumed center , we adopt a weighting scheme similar to that described and justified by stetson ( 1987 ) .",
    "pixels within 1.5 pixels of the star s center receive a full weight @xmath77 of 1.0 , while those beyond 2.0 receive zero weight .",
    "the weight varies linearly from 1.0 to 0.0 for distances between 1.5 and 2.0 pixels .",
    "note that this positional weight @xmath77 is independent of poisson considerations , which we will include separately in our formulation .",
    "such a procedure obviously involves some prior knowledge of the star s position , so that the aperture itself must change slightly with each iteration .",
    "the third point above assures that it will not vary chaotically as we converge upon @xmath47 and @xmath48 .    with the fitting radius just described",
    ", we do not actually need to use values of the epsf from the entire 5@xmath555-pixel region over which we have tabulated its value .",
    "we solve for it over that entire region , however , because the need to use derivatives of the epsf brings in pixels farther from the center , and the proper smoothing of our epsf grid points also requires values far out .",
    "when we set out to measure a star , we first construct a psf appropriate for its location in the chip , by means of the prescription given in section  [ varpsf ] .",
    "the value of this effective psf is tabulated at the quarter - pixel grid points that we have described .",
    "we then construct a similar 2-d table for the @xmath11 and @xmath9 derivatives of the psf ( needed below ) , by simple differencing of the smooth psf grid .",
    "this procedure requires evaluating the psf at intermediate locations within the grid , for which we use a bi - cubic spline . for the derivatives",
    ", we use simple bilinear interpolation .",
    "once we have chosen the array of pixels to be fit , we minimize the following expression for @xmath76 with respect to the parameters @xmath20 , @xmath47 , and @xmath48 : @xmath78 ^ 2 % -----------------------------------------------------------                      \\over {   g p_{ij } } } \\ , , \\label{chisqeq}\\ ] ] where the sum is over all pixels @xmath15 within the fitting aperture , @xmath79 is the value of the pixel at @xmath15 , @xmath24 is the value of the sky , @xmath36 is the value of the effective psf at that offset , and @xmath80 is the gain ratio , typically @xmath407 for wfpc2 .",
    "the denominator normalizes the residual of each pixel for the expected poisson noise in that pixel , so that what we have is a true chi - squared . in what follows ,",
    "we write @xmath81 for @xmath82 .",
    "the parameter @xmath20 appears linearly in this equation , while @xmath47 and @xmath48 enter non - linearly through @xmath38 . for a given @xmath18",
    ", we can easily solve for the flux @xmath20 that minimizes eq .",
    "( [ chisqeq ] ) : @xmath83 here , we have defined @xmath84 to be the sky - subtracted pixel value , @xmath85 , and @xmath86 is shorthand for @xmath87 . once we have solved for the flux ,",
    "we compute the residuals @xmath88 .",
    "we then solve for the position parameters @xmath11 and @xmath9 via an iterative newton ",
    "raphson method , where @xmath89 } = x_*^{[n ] } + \\delta x_*^{[n]}$ ] , and @xmath90   \\ !",
    "\\biggl [ \\sum w_{ij } q_{ij } \\ !                           \\left({\\partial\\psi_{ij}\\over{\\partial x } } \\right)^2                     \\biggr ]                  - \\biggl [ \\sum w_{ij } q_{ij } r_{ij } \\ !",
    "\\left({\\partial\\psi_{ij}\\over{\\partial y } } \\right )                     \\biggr ] \\ !",
    "\\biggl [ \\sum w_{ij } q_{ij } \\ !                           \\left({\\partial\\psi_{ij}\\over{\\partial x } } \\right ) \\ !",
    "\\left({\\partial\\psi_{ij}\\over{\\partial y } } \\right )                     \\biggr ]               \\over {             f _ * \\biggl (                    \\biggl [                       \\sum w_{ij } q_{ij } \\ !                       \\left ( { \\partial\\psi_{ij}\\over{\\partial x } }                        \\right)^2                    \\biggr ] \\ !                    \\biggl [                       \\sum w_{ij } q_{ij } \\ !                       \\left ( { \\partial\\psi_{ij}\\over{\\partial y } }                        \\right)^2                    \\biggr ]                  - \\biggl [                       \\sum w_{ij } q_{ij } \\ !                       \\left ( { \\partial\\psi_{ij}\\over{\\partial x } }                        \\right ) \\ !                       \\left ( { \\partial\\psi_{ij}\\over{\\partial y } }                        \\right )                    \\biggr]^2               \\biggr )                    } } .",
    "\\label{xadjeqn}\\ ] ] the equation for @xmath91 is analogous .",
    "we alternate between solving for @xmath20 and for @xmath18 .",
    "convergence is typically reached in very few iterations . with the psf and its derivatives",
    "already tabulated ahead of time , the center - finding procedure is very fast .",
    "typically , we can measure 2500 stars per minute on a sparc ultra 5 .",
    "the result of the second stage is an improved list of the raw positions of each star as measured in each image .",
    "we use our transformations to transfer all of these raw measurements into a common reference frame so that we can combine them and inspect the residuals .",
    "( it is of course crucial to have multiple ditherings to give residuals that can be used to test for pixel - phase error . )",
    "if the measurements are free from bias , then a plot of the residuals against pixel - phase ( as in fig .",
    "[ ppe ] ) will show only random errors .",
    "however , if any significant pixel - phase error remains , we will need to iterate again .",
    "the presence of pixel - phase error indicates systematic errors in the raw positions we just measured .",
    "if we were to take these biased positions and use them to create new psf samplings and solve once again for the psf , then we would arrive a psf that is as biased as before .",
    "thus in order to remove the bias we must introduce some new information .",
    "this new information comes from the multiple observations we have of the same star at different dither positions .",
    "the same averages that we use above to examine pixel - phase error can be used to correct it , not in a purely empirical way , but rather by going to the root of the problem and _ removing _ it , by the accurate psf determination that we are describing here .    to derive an improved placement for each psf sampling",
    ", we transform the mean position of each star from the reference frame into each of the individual frames where it has been imaged .",
    "we then have a more accurate ( i.e. , less biased ) estimate of which point in the effective psf each of the star s pixels samples .",
    "when we then solve again for the epsf it will be more accurate , and can be used to measure positions that are in turn more accurate and less biased .    in a similar way",
    ", we average the fluxes from the multiple observations to arrive at an improved value for the flux of each star in each image ( allowing of course for any differences in exposure time ) .",
    "quite in parallel with the astrometry , this enables us to allow for the variation of total detected flux with pixel phase ( lauer 1999b ) , which can be @xmath92% .",
    "this variation is handled naturally and properly with the effective - psf formalism .",
    "the flow chart in figure  [ flowchart ] shows our overall procedure for arriving at an accurate psf . stripping away the details ,",
    "we summarize here the major points of this section .",
    "[ fig .  8 here ]    \\(a ) we recognize the role of the effective psf , which will have to be evaluated at arbitrary points but will never have to be integrated .",
    "we choose to tabulate this continuous function at a well - sampled mesh of points .",
    "\\(b ) we derive the epsf by using every pixel value of every well - exposed star ; each pixel value contributes information at a particular point in the epsf .",
    "\\(c ) we allow for the spatial variation of the psf by solving for 9 fiducial psfs placed at extreme points in the image , so that we can interpolate among them to get the locally appropriate psf at any place on the chip .",
    "\\(d ) by iterating between psf determination and measurement of star positions , we improve successively the placement of the individual pixel values in the building up of the psf , and the fit of the psf to the star images .",
    "\\(e ) the crucial part of this procedure is the transformation of the mean positions back into the individual images , which allows each image to profit from the averaging of all of them .",
    "this linch - pin step removes the fundamental degeneracy caused by detector undersampling .    in this way we derive from the complete set of pixel values in the stellar images the nine sets of 441 grid points that represent the effective psf throughout the image .",
    "figure  [ psfvsit ] shows graphically the progression of epsf samplings and pixel - phase errors with iteration , for stars in the central region of the wf2 chip . in the first column",
    "the samplings come from centroid positions and 3@xmath553-pixel - aperture fluxes .",
    "these raw samplings are not well fit by a smooth model .",
    "the pixel - phase errors at the bottom show the bias in positions measured with this model . to illustrate the importance of averaging , in iteration @xmath93 we take these positions without averaging , re - sample the psf , and derive a smooth model that does seem to fit the samplings reasonably well . however , we find that the positions measured from this psf are as biased as before",
    ". the smooth fit of the model to the samplings does not guarantee a correct ( bias - free ) model .",
    "the pixel - phase bias is clearly visible even in the top panel , which shows the overall distribution of samplings .",
    "[ fig .  9 here ]    the rightmost two columns show the standard progression of our iteration . for the column labeled `` 2 '' we take the positions after the first iteration , average them with the positions for the same stars from the other dither - pointings , then use these _ average _ positions to re - sample the psf .",
    "the locations of these new samplings are shown at the top ; the removal of the bias is remarkable .",
    "these new samplings suggest a psf which is shaped quite differently from that in iteration @xmath93 .",
    "when we fit these samplings with a smooth model , we find model - residuals that seem a little inferior to those for iteration @xmath93 .",
    "however , when we use this new model to fit stars , we find that the pixel - phase error goes down by more than a factor of two . as we iterate yet again , the samplings appear even more evenly distributed , and the resulting pixel - phase errors are yet again diminished .",
    "we find that after 5 or so such iterations the bias is typically reduced to a negligible level .",
    "10 here ]    figure  [ ppe_vs_it ] shows the pixel - phase - error progression for all 9 regions of the wf2 chip .",
    "plots for the other wf and pc chips are very similar .",
    "this figure clearly demonstrates that our spatially variable effective - psf model coupled with our iterative procedure have reduced the pixel - phase bias to a negligible level ( @xmath940.002 pixel ) for _ all _ regions of the chip . to put this in perspective",
    ", we note that the random error in measurement for a typical star is @xmath400.02 pixel in each coordinate . because of our freedom from systematic error",
    ", the average positions from 15 images will be better by a factor of @xmath95 and have a typical error of only 0.005 pixel .",
    "we believe that an @xmath54 considerably larger than 15 will lead to a correspondingly improved accuracy , since , as we will show in section [ indiv_comp ] and fig .",
    "[ ppe_vs_it ] , we are able to remove pixel - phase error to a level considerably below 0.005 pixel .",
    "figure [ ppefix ] contrasts strikingly with fig .",
    "[ ppe ] , and shows how well pixel - phase error has been removed from our measurements .",
    "the small `` systematic error '' that remains is at the level that would be expected from statistical fluctuations due to the limited sample size .",
    "11 here ]    in the left half of figure  [ show_psfs ] we show contour plots of our final psfs for the pc ( shown for the @xmath96 set of regions of the image ) , and similarly , below , for the wf2 chip . in the right half of the figure",
    "we show cuts along the @xmath11 and @xmath9 axes of the psfs in the central row and column of the set at the left .",
    "it is clear that the variation of the psf has a strong radial dependence :  as we go from the center of a chip outwards , the center of the halo moves with respect to that of the core .",
    "we note that all these psfs have been rigidly centered so that @xmath59 and @xmath97 , which also facilitates interpolation among models .",
    "the smoothness of these contour plots demonstrates the effectiveness of our smoothing kernel .",
    "12 here ]      we have derived our psf by combining information from 15 images .",
    "the question arises , however , _ do _ all the images have exactly the same psf ? in principle , the answer must be negative . in actual fact , indeed , we found that the image - to - image transformations generally involved small differences of scale .",
    "the time sequence of these showed that they were clearly due to the phenomenon called `` breathing '' , in which the tube length varies around each orbit as a result of changing insolation .",
    "this must lead to small changes of focus , which will undoubtedly affect the psf .",
    "if the psf in one of the images differs from the average psf but we use the average psf to measure the stars in that image , we would expect these measurements to contain pixel - phase errors caused by the psf mismatch .",
    "figure  [ probexy ] shows the net pixel - phase errors for each of the 15 images of the 1st - epoch sample .",
    "all of these errors are well below 0.005 pixel .",
    "thus even for our demanding purposes it is safe to use the average psf when measuring each image .",
    "[ fig .  13 here ]",
    "the bottom - right plot in figure  [ probexy ] shows that we tend to measure stars slightly better ( @xmath4015% ) when a star is centered near the boundary between two pixels than when it is centered in a pixel .",
    "intuitively we would expect this to be the case , since when a core is centered on a pixel boundary any slight change in position of the star results in a maximal redistribution of light from one pixel to another .",
    "still , this is a small effect and we find that we can measure stars well wherever they fall upon the pixel grid .    since it is safe to treat the psf as constant within an epoch ( i.e. , over several orbits ) , it is appropriate to ask about the long - term stability of the psf .",
    "we reduced the 2nd - epoch ( 1997 ) images with the 1st - epoch ( 1995 ) psf and examined the measurements for pixel - phase error .",
    "figure  [ cross_psf ] shows that the psfs must be appreciably different from one another , both in overall sharpness and in spatial - variability characteristics .",
    "it is therefore crucial to obtain a separate psf from each epoch observed and to verify any assumptions of psf constancy .",
    "it is further clear that `` library '' psfs will not be adequate for high - precision astrometry .",
    "the dithering needs of astrometry are quite different from those of image reconstruction . in the latter case",
    ", we have an unknown and possibly complicated scene which we would like to sample as well as possible .",
    "simple interlacing ( as described in lauer 1999a ) is the most straightforward and complete way to create a well - sampled map of the effective scene .",
    "the situation is quite different for astrometry , where every star is merely a replica of the same psf ( spatial variations of the psf aside ) .",
    "our objective in dithering is to permit an accurate reconstruction of the psf . because each star is a differently centered representation of the same psf",
    ", we will typically have hundreds or thousands of different realizations of the psf .",
    "there is no question that the psf will be `` well - sampled '' and over - constrained .",
    "however , we still need dithering to tell us how each of the stellar images in each frame samples the psf , so that we can construct a psf that is free from bias . for this purpose",
    ", there is no `` ideal '' dither pattern .",
    "we have not yet done much experimentation on how small a number of dither pointings will suffice , but it is likely that a 2@xmath552 pattern with 0.5-pixel steps would be adequate . because stars fall at random phases , we would have in the equivalent of fig .  [ ppe ] a large number of pairs of residuals half a cycle apart , _ at all phases _ , and this is enough to construct the curves of pixel - phase error . here again , as in section [ relation ] , we emphasize that our problem is not removal of aliasing ; what matters is rather the denseness of the samplings illustrated in fig .",
    "[ datapts ] .",
    "it is this last consideration that argues for using as many different dither pointings as is reasonably possible .",
    "repeating an exposure at the same dither pointing would merely produce additional samplings at the same points in the epsf as before , and would not improve the derivation of the epsf . on the other hand , it is the science program that should dictate the number of exposures  as long as there are at least 2@xmath552 dithers .",
    "after this number is chosen , then one should specify a dither pattern that is spread out relatively evenly over the 2-d pixel - phase space , but there is no need to create a perfectly regular pattern .",
    "thus the minimal needs of astrometry , a 2@xmath552 dither , can be less than those of image reconstruction , where lauer ( 1999a ) states that for the f555w ( @xmath98 ) filter he needed 3@xmath553 in the wf chips ( and presumably even more for the sharper psfs that are formed in the uv ) . as we have argued , however , when the science program allows a larger number of exposures it is also desirable to use a large number of dithers .",
    "an additional requirement is to achieve a good dither in the wf and the pc simultaneously , given their different and incommensurable pixel sizes .",
    "we solve this problem by choosing a phase pattern that satisfies our criterion as well as possible for the wf , in which the more severe undersampling makes dithering more critical , and adding whole - wf - pixel offsets to the dithers so as to make those in the pc as close as possible to ideal .",
    "we have no set procedure for this , but choose the whole - pixel offsets by trial and error until they result in a good pattern for the pc .",
    "15 here ]    figure  [ dither15 ] shows an example of a 15-way dither , the within - pixel phases at the top and the total dither amounts at the bottom .",
    "this particular example was chosen to fit a constraint of program construction for this target :  there were to be 5 exposures in each of 3 orbits .",
    "the exposures are arranged to fit into wfpc2 s procedure of line - dithering , which is constrained to consist of equally spaced exposures along a straight line . for a different number of exposures , or different restraints on their grouping , good dither patterns are not hard to construct .",
    "one might wonder whether the considerable geometric distortion in wfpc2 might defeat any attempt to dither evenly .",
    "the answer is that because each star is shifted by a small number of pixels within the dither pattern , the _ relative _ offsets of the 15 images of each star are essentially the same everywhere on the chip .",
    "we note that while dithering clearly provides the best and most straightforward way to derive an accurate model of the psf , it is by no means the only way to do so . in the absence of a dithered set ,",
    "there are still some tricks that can be played to tease apart the position - psf degeneracy , whose removal , we have emphasized , is the major challenge to the astrometry of undersampled images .",
    "when it comes to measuring proper motions , we often have the freedom to plan the second - epoch observations , but must deal with a first epoch whose observations have already been taken . to plan and reduce the second epoch , we recommend the prescription given in the preceding section . but",
    "special care must be taken to reduce the first epoch , if it is not well dithered .",
    "we note that sometimes even though no deliberate dither exists for the first epoch , there may yet exist images of the same field taken through different filters .",
    "the different filters often have different plate scales , so that there may be an effective dither between the two images .",
    "this can be exploited by solving for different psfs for the two images , while constraining the stars to have the same relative positions ( since the images were taken at the same epoch ) .",
    "the iterative scheme described in section  [ find_psf ] could easily be modified for this situation .",
    "if the first epoch is completely undithered , there is still a possible remedy .",
    "we can make use of the fact that nature should distribute stars randomly with respect to the pixel boundaries , so that if in constructing the psf we find our pixel phases to be biased ( as in the upper left panel of fig .",
    "[ psfvsit ] ) we could introduce a general correction to flatten out this distribution .",
    "we have experimented with such adjustments and find that we can reduce the systematic pixel - phase error to less than 0.01 pixel ( from 0.03 pixel or so ) .",
    "such a correction is naturally dependent upon having a reasonably large sample of stars , so that the statistical assumptions of a flat pixel - phase distribution will be valid .",
    "it is also important to exclude _ a priori _ non - stellar objects ( galaxies , or peaks created by cosmic rays or warm pixels ) from the psf lists , since any bias in the psf - measured positions for them would be irrelevant to a construction of the psf .",
    "some amount of iteration may be necessary in both of the above schemes .",
    "we can test the accuracy of the psf model by searching for trends with first - epoch pixel phase , in the final inter - epoch displacements .",
    "such a test should at the very least allow us to put an upper limit on any remaining systematic errors .",
    "we have introduced three important ideas in this paper :  the value of using the effective psf , the incorporation of pixel values from _ all _ well - exposed star images to derive a smooth , parameter - free model of the psf , and iteration between psf shape and star positions .",
    "all of these ideas can be extended beyond the present application of wfpc2 astrometry .    whenever one must deal with intrinsically pixellated data ,",
    "an effective approach will provide for economy of computation and transparency of analysis .",
    "the epsf approach is especially useful in the case of undersampled data , where it allows one to model directly the way flux is transferred from one pixel to another as the `` center '' of a point source moves with respect to pixel boundaries . since many undersampled",
    "wide - field detectors exist in ground - based astronomy , these epsf techniques developed for  are equally relevant on the ground .",
    "use of the effective psf itself is , of course , no less appropriate for well - sampled data .",
    "our parameter - free , grid - based modeling approach is flexible enough to deal with vastly different psfs .",
    "it frequently happens that because of guiding problems , the psf is elongated in some direction , which is not necessarily along the rows or columns .",
    "standard , analytical - model - based photometry routines have difficulties measuring such images .",
    "our model is flexible enough to deal naturally with such `` ugly '' psfs .",
    "we make no assumptions about the shape of the psf , except that it is relatively smooth ( which we can accomplish by choosing an appropriate smoothing kernel ) . aside from the obvious slight degradation of resolution along the elongation direction , we find that we are able to analyze these images as easily as perfectly guided images .",
    "in fact , our flexible epsf approach would be ideal for analyzing images that are intentionally trailed .",
    "such images could in principle offer ultra - precise positioning information in a direction orthogonal to the trailing direction . without trailing , we believe that there remains some fundamental limit to our ability to determine the epsf , and therefore a limit of @xmath400.002 pixel to our systematic accuracy in an individual measurement",
    "( see fig .",
    "[ ppe_vs_it ] ) .",
    "trailing might reduce this remaining error significantly .",
    "a final recommendation for the effective approach is that it is the ideal psf to use for image reconstruction .",
    "lauer ( 1999a ) makes the point that there is no reason to treat the integration over pixels and the instrumental - psf convolution separately  mathematically the image is literally the convolution of the fully resolved scene with the effective psf , sampled at the pixel centers .",
    "thus , if one desires to reconstruct the scene accurately , the best approach is to deconvolve the observation with the effective psf .",
    "having an accurate effective psf is therefore the first step .",
    "the key to accurate astrometry , especially in undersampled images , is to derive a point - spread function of the highest accuracy possible .",
    "we demonstrate how a less - than - adequate psf leads to pixel - phase error , i.e. , systematic position errors that depend on the location of a star with respect to pixel boundaries ; and we show that an accurate psf eliminates pixel - phase error .",
    "consideration of the practical use of a psf leads to the concept of the effective psf , a continuous function that is the convolution of the psf that the telescope delivers to the focal plane with the spatial sensitivity function of an individual pixel .",
    "this epsf has the practical virtue that the expected value of any pixel in any star image is the product of the value of the epsf at the location of the center of that pixel with respect to the center of the star image times a factor that expresses the brightness of that star .",
    "once the epsf is tabulated , no integration over a pixel area ever needs to be performed .",
    "the epsf can be evaluated accurately by a suitable combining of the observed pixel values of all stars bright enough to be used in this process , which we have described in some detail .",
    "the evaluation process depends on an iteration in which the shape of the epsf and the measured positions of the individual stars in a set of dithered images are alternately improved , in a succession that converges to accurate values of both data sets .",
    "what is essential to the convergence of the iteration is the ability to average the positions of each star at various dither offsets .      after a brief discussion of strategies that will achieve good dither patterns ,",
    "we describe a modification of our methods that allows fairly complete removal of pixel - phase error in material that lacks dithering information , and we discuss ways in which our approach can also benefit the treatment of images that are well sampled .",
    "we must caution , however , that our methods rely on having a reasonably large number of stars in each field and are therefore not applicable to sparse star fields . in order to reconstruct a good psf we should have at least 100 well - measured stars in each chip . for the purposes of accurate differential astrometry , however , the number of stars needed will depend greatly on the desired precision and on the quality of distortion correction that is available .",
    "we will take up these issues in a subsequent paper , in which we will discuss the transformation of coordinates from one image to another .",
    "we are grateful to the referee , tod lauer , for a number of suggestions that considerably improved the quality of this paper .",
    "we thank adrienne cool for the daophot measurements that we used here , and we are also grateful to william van altena for discussions .",
    "this work was supported by grant ar-7993 from the space telescope science institute ."
  ],
  "abstract_text": [
    "<S> the first step toward doing high - precision astrometry is the measurement of individual stars in individual images , a step that is fraught with dangers when the images are undersampled . </S>",
    "<S> the key to avoiding systematic positional error in undersampled images is to determine an extremely accurate point - spread function ( psf ) . </S>",
    "<S> we apply the concept of the _ effective _ psf , and show that in images that consist of pixels it is the epsf , rather than the often - used instrumental psf , that embodies the information from which accurate star positions and magnitudes can be derived . </S>",
    "<S> we show how , in a rich star field , one can use the information from dithered exposures to derive an extremely accurate effective psf by iterating between the psf itself and the star positions that we measure with it . </S>",
    "<S> we also give a simple but effective procedure for representing spatial variations of the  psf . with such attention to the psf </S>",
    "<S> , we find that we are able to measure the position of a single reasonably bright star in a single image with a precision of 0.02 pixel ( 2 mas in wf frames , 1 mas in pc ) , but with a systematic accuracy better than 0.002 pixel ( 0.2 mas in wf , 0.1 mas in pc ) , so that multiple observations can reliably be combined to improve the accuracy by @xmath0 .    </S>",
    "<S> # 1_#1 </S>"
  ]
}