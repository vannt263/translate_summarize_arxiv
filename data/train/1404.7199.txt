{
  "article_text": [
    "over the last years agent - based modeling has become a powerful simulation technique for a number of applications , varying from ecology @xcite to economics and financial systems @xcite , and from traffic and supply chain networks @xcite to biological @xcite and social @xcite systems .",
    "agents are treated as unique and discrete entities , allowing a straightforward way to incorporate detailed interactions between individuals via a set of microscopic rules .",
    "modelers use the fine - scale evolution at the individual agent level to study the macroscopic , population level dynamical behavior , often referred to as _ emergent _ behavior . it would of course be desirable ( and computationally much more efficient ) to simulate this emergent behavior through a continuum macroscopic model .",
    "however , accurately accounting for the consequences of individual interactions at the macroscopic level can be highly nontrivial . as a consequence , accurate macroscopic equations are typically unavailable , even in cases when a clear separation of time scales strongly suggests that such equations _ should _ exist . in this work",
    ", we will consider a financial market agent - based model , in which a stochastic process describes the `` motion '' of an individual agent along a spatial domain representing the agent s propensity to buy or sell .",
    "this stochastic process needs to be simulated for a large number of ( interacting ) agents over long times .",
    "doing this over the entire spatiotemporal domain of interest to observe the relevant macroscopic variables ( e.g. , agent density ) incurs a prohibitive computational cost .    the recently developed _ equation - free framework _",
    "( @xcite ) can be applied to exploit the time - scale separation between the ( fine - scale ) individual dynamics and the ( coarse - scale ) population - level behavior by performing the expensive agent - based simulations in a grid of small patches , which cover only a fraction of the spatiotemporal domain . exploiting smoothness ,",
    "the solution for the entire region is approximated by repeated interpolation / extrapolation of the macroscopic variables recorded within these patches .",
    "this framework is built around the central idea of a coarse time - stepper , which advances the coarse variables over a time interval of size @xmath2 .",
    "it consists of the following steps : ( 1 ) _ lifting _ , i.e. , the creation of appropriate initial conditions for the microscopic model ; ( 2 ) fine - scale _ evolution _ ; and ( 3 ) _ restriction",
    "_ , i.e. , the estimation of macroscopic observables from the fine - scale solution .",
    "this coarse time - stepper can subsequently be used as input for time - stepper - based `` wrapper '' algorithms performing macroscopic numerical analysis tasks .",
    "these include , for example , time - stepper based bifurcation codes to perform coarse bifurcation analysis for the unavailable macroscopic equation @xcite , and other system level tasks such as rare event analysis @xcite , control @xcite and optimization @xcite .",
    "the patch dynamics scheme @xcite is a combination of two sub - schemes - the gap - tooth scheme ( interpolate macroscopic properties in space ) @xcite and the coarse projective integration scheme ( extrapolate macroscopic properties in time ) @xcite .",
    "first , in the gap - tooth scheme @xcite , microscopic simulations are only performed in a number of small subdomains of the spatial domain ( intervals for the case of one space dimension ) ; in - between these patches lie what we call gaps .",
    "we continue the discussion for the one - space - dimension paradigm that fits our application .",
    "a coarse time-@xmath2 map is then constructed as follows .",
    "we first choose a number of macroscopic grid points and a small interval (  tooth \" ) ) around each grid point ; we initialize the fine scale consistently with a macroscopic initial condition profile ; apply the microscopic solver within each interval , using appropriate boundary conditions for time @xmath2 ; and , finally , obtain macroscopic information at time @xmath2 ( e.g. , by computing the average density in each tooth ) . in @xcite , the initial conditions for each of these teeth are obtained via interpolation over neighboring teeth ; this can be seen to be equivalent to constructing a macroscopic finite difference approximation . in the gap - tooth scheme , this procedure is then repeated .",
    "we refer to @xcite for an illustration of this scheme with particle - based simulations of the viscous burgers equation .",
    "second , exploiting the smoothness of coarse variable evolution in the _ temporal _ domain , one can combine the gap - tooth scheme with a projective integration scheme @xcite . in this context",
    ", we perform a number of gap - tooth steps of size @xmath2 to obtain an estimate of the _ time derivative _ of the unavailable macroscopic equation .",
    "based on this estimate , a projective step is subsequently taken over time @xmath3 .",
    "this combination has been termed _",
    "patch dynamics _ @xcite .    in previous work",
    ", the gap - tooth and patch dynamics schemes have been applied to study a diffusion homogenization problem @xcite , as well as a biological dispersal model @xcite .",
    "for the kind of agent - based problems we study in this work , a conservation law needs to be satisfied .",
    "for this reason , instead of basing the gap - tooth scheme on a finite difference approximation , we design a finite volume - based patch dynamics scheme .",
    "we first apply this scheme to an approximate continuum model of the agent - based dynamics to illustrate the scheme , as well as to facilitate our error analysis . in this case , our `` inner '' microscopic model is a fine discretization of this continuum model , and our microscopic simulator is a classical finite volume scheme within each tooth . in general , a given microscopic code only allows us to run it with a set of predefined boundary conditions .",
    "it is highly non - trivial to impose macroscopically inspired boundary conditions on such microscopic codes , see , e.g. @xcite for a control - based strategy . as in @xcite ,",
    "the boundary conditions on the teeth are imposed _ via the use of buffer regions _ , surrounding the teeth , to ",
    "protect \" the tooth inside each simulation unit from boundary artifacts .",
    "we call  simulation unit \" the union of a tooth and its edge buffers .",
    "after several gap - tooth steps , we project the macroscopic properties forward in time for a bigger step @xmath4 . based on the projected macroscopic properties",
    ", we again construct consistent microscopic initial conditions for the simulation units and the cycle repeats .",
    "we study the performance of this patch dynamics scheme , and compute its order of accuracy both analytically and numerically .",
    "subsequently , we apply the scheme to the agent - based model , and observe that , typically , this requires the expensive microscopic simulations in only @xmath0 of the spatial domain and @xmath1 of the temporal domain",
    ".    these micro / macro ideas also form the basis of the heterogeneous multiscale method @xcite . there , a macro - scale solver is combined with an estimator for quantities that are unknown because the macroscopic equation is not available",
    ". this estimator subsequently uses appropriately constrained runs of the microscopic model . for a recent overview of results obtained in that framework",
    ", we refer to @xcite .",
    "the remainder of this paper is organized as follows : in section 2 we introduce an agent - based financial market model based on the work of @xcite and the associated continuum approximation they derive . in section 3",
    "we describe the `` inner '' finite volume scheme for the continuum model . in section 4",
    "we describe the patch dynamics scheme . in section 5",
    "we first present patch dynamics results using the discretization introduced in section 3 as the inner solver , and then analyze the order of consistency of this scheme both analytically and numerically .",
    "the main result , the agent - based patch dynamics computations , are also presented in section 5 . we conclude with a brief summary and discussion in section 6 .",
    "we consider a financial market model initially described by omurtag and sirovich @xcite .",
    "this model simulates the actions of buying and selling by a large population of @xmath5 interacting individuals in the presence of mimesis . in this model ,",
    "the @xmath6-th agent s propensity to buy or sell is indicated by its state @xmath7 which evolves according to two coupled processes .",
    "the first process is the exponential decay , at constant rate @xmath8 , of @xmath9 towards the neutral state @xmath10 .",
    "this decay implies that each agent gradually forgets its current state and tends to eventually become neutral in its preference for buying or selling .",
    "the second process is a stochastic process denoted by @xmath11 which represents the effect of incoming information to each agent s state @xmath9 .",
    "@xmath11 incorporates three factors : ( 1 ) the arrival times of incoming information ; ( 2 ) the type of this information ( i.e. , `` good '' or `` bad '' ) ; and ( 3 ) the quantitative effect of this information on @xmath9 .",
    "the arrival of incoming information is assumed to follow a poisson distribution with mean arrival frequency @xmath12 , where @xmath13 denotes the mean arrival frequency for good news and @xmath14 denotes the one for bad news .",
    "the mean arrival frequencies are given by @xmath15 where the parameters @xmath16 and @xmath17 represent the contribution of _ external _ information each individual receives from its environment ( e.g. , mass media news or opinions of stock market consultants ) and are assumed time - independent .",
    "the quantities @xmath18 and @xmath19 are the _ buy rates _ and _ sell rates _",
    ", respectively , defined as the number of buys or sells happening in the market per unit time over a small finite time horizon ( which we call _ reporting horizon _ ) normalized by the total number of agents in the market .",
    "the parameter @xmath20 is a feedback constant which quantifies the extent to which the individuals propensity to buy or sell is determined by the buy and sell rates .",
    "note that the buy and sell rates are collective properties of the population ( i.e. , all the agents in the market ) , which implies that the second term of ( [ nu : eqn ] ) , @xmath21 , embodies how each individual agent s state is affected by the collective behavior of the entire population at that moment in time .",
    "each arriving `` quantum '' of information has probability @xmath22 to be good news and @xmath23 to be bad news .",
    "when good news arrives for agent @xmath6 , the value of @xmath9 is increased instantaneously - jumps - by a fixed amount @xmath24 ; similarly , when bad news arrives , @xmath9 decreases instantaneously - jumps - changing by @xmath25 .",
    "if , after a positive jump , the value of @xmath9 exceeds the right boundary ( i.e. , @xmath26 ) , then a  buy \" is considered to have occurred and the number of buys for that time interval is increased by one .",
    "similarly , after @xmath9 crosses the left boundary ( i.e. , @xmath27 ) , the number of sells is increased by one . in either case",
    ", @xmath9 is set back to the neutral state ( i.e. , @xmath28 with a small random offset to prevent discontinuities ) after the number of buys or sells is updated . in this way , each individual agent s decision affects the population s collective behavior .",
    "this discrete jump process , combined with the previously described exponential decay , form the evolutionary rule for each agent s state @xmath9 , which can be summarized as the following stochastic differential equation @xmath29      it is possible to derive a concise approximate description of the dynamics of a large assembly of agents by keeping track of only the density @xmath30 of agents at each state @xmath31 , rather than the individual states of every agent in the population . the resulting approximate evolution equation for @xmath30 , averaged over a large number of replicas of the population ,",
    "is given by @xcite @xmath32 for small @xmath33 by expanding @xmath34 about @xmath30 in terms of @xmath33 and truncating terms higher than second order in @xmath33 , one obtains a fokker - planck - type approximation , @xmath35 where @xmath36 and @xmath37 because agents leave the domain at @xmath38 and are restored at the origin , we have @xmath39 , and a dirac @xmath40 birth term at the origin .",
    "the buy and sell rates are defined as the outgoing fluxes at the boundaries , @xmath41 .",
    "the fokker - planck - type equation  ( [ ori : eqn ] ) , with its non - local reinjection term , is the approximate continuum model in our study .",
    "we are now ready to describe a finite volume discretization of , which will serve as the first `` inner '' fine - scale simulator on which our exploratory patch dynamics scheme ( described in section 4 ) will be based .",
    "we divide the one dimensional spatial domain into equal - sized grid cells and keep track of our approximations to the average densities in these cells . at each time step",
    "we update the average cell densities using approximations of the fluxes through the edges of the cells .",
    "as shown in , we denote the @xmath42 grid cell by @xmath43    @xmath44 denotes the approximate average cell density in the @xmath6th cell at time @xmath45 , @xmath46 where @xmath47 denotes the size of the cell . except for the central grid cell , which will be treated separately because of the particle reinjection ,",
    "can be rewritten as @xmath48 define the function @xmath49 as the flux term @xmath50 so that the integral form ( in space ) of gives @xmath51 integrating in time from @xmath45 to @xmath52 and dividing by @xmath53 gives @xmath54   \\ , .",
    "\\label{complete : eqn}\\ ] ] based on , can be rewritten as @xmath55 where @xmath44 is the average density defined in eq.([q : eqn ] ) , and @xmath56 and @xmath57 denote the average fluxes ( i.e. fluxes averaged over @xmath4 ) across cell edges , that is , f_i-1^n = _",
    "t_n^t_n+1f(x_i-1,t)dt  and  f_i^n = _ t_n^t_n+1f(x_i , t)dt . based on ( [ f : eqn ] ) , the average fluxes over the time step are approximated by @xmath58 for a detailed discussion about the construction of diffusion fluxes for finite volume schemes see @xcite .",
    "the fluxes at the outer two boundaries are expressed as ( recall that @xmath59 and @xmath60 ) f_0^n = -r^- -^2  and  f_n^n = r^+ ^2 .",
    "we use an odd number of grid cells @xmath5 for this scheme .",
    "since the central grid cell centered at @xmath61 contains the source point at @xmath62 , two additional terms need to be added to for this cell , @xmath63 clearly , the above scheme is conservative by construction . in section 5",
    ", this scheme is used as the  inner \" solver to mimic the agent - based simulator . moreover , the associated patch dynamics scheme , introduced in the next section , will be inspired by this scheme , and will also be conservative at the agent level .",
    "as mentioned previously , the patch dynamics scheme combines gap - tooth and projective integration schemes .",
    "the gap - tooth scheme is illustrated in .",
    "we have divided the one dimensional space into two kinds of unequal - sized grid cells : the narrower cells , which we call teeth , and the wider cells , which we call gaps .",
    "we intend to solve the microscopic model only within the teeth ( plus some buffer regions to handle the teeth boundary conditions ) . however , we keep track of the average densities in _ both _ the teeth and the gaps to obtain a conservative scheme . as in the finite volume scheme ,",
    "we want to update the average cell densities based on the fluxes at the edges of the cells , @xmath64 where @xmath65 and @xmath66 denote the tooth and gap size respectively .",
    "however , in contrast to the finite volume scheme , the fluxes @xmath67 and @xmath68 are not computed based on a known macroscopic equation ( which is usually not available for agent - based models ) . instead , our goal is to compute these fluxes based on the  microscopic simulations \" inside a small fraction of the spatial domain - the simulation unit (  @xmath69 \" shown in fig .  [ fig : lifting_2 ] ) .",
    "these separated simulation units are the only locations where microscopic simulations take place .",
    "the numerical simulation of the microscopic model in each simulation unit provides information on the evolution of the global state at the spatial location of the simulation unit , as if we were running the microscopic simulations in the entire spatial domain .",
    "therefore , it is crucial to choose appropriate boundary conditions , so that the solutions inside the teeth evolve as if the simulations were performed over the entire domain .",
    "for some cases it is possible to implement macroscopically - inspired constraints on the microscopic model as boundary conditions @xcite . however , this is not always the case . to overcome this difficulty ,",
    "as discussed in @xcite , we use a larger box - the simulation unit - to run the microscopic simulations , but still compute the flux used to update the macroscopic state at the teeth boundaries .",
    "each simulation unit consists of one tooth and its edge buffers ; the simulation units on the outer boundaries of the spatial domain are treated slightly differently , as discussed later .",
    "the purpose of the additional computational domains , the buffers , is to `` protect '' the teeth simulations from boundary artifacts .",
    "this can be accomplished over short enough time intervals , provided the buffers are large enough .",
    "as shows , we divide the one - dimensional spatial domain into an odd number , @xmath5 , of grid cells @xmath70 .",
    "the size of each cell is @xmath71 .",
    "we then put teeth ( narrow bins ) at the edges of these cells and put gaps ( wide bins ) between the teeth .",
    "there are @xmath72 teeth and @xmath73 gaps .",
    "the average densities for the teeth at time @xmath45 are denoted as @xmath74 , and the densities for the gaps are denoted as @xmath75 .",
    "we want to update these macroscopic properties at time @xmath52 based on the microscopic simulations inside the simulation units during the time step from @xmath45 to @xmath76 .",
    "the patch dynamics algorithm to proceed from @xmath77 to @xmath78 is given below : +   + 1 .",
    "_ lifting_. at time @xmath45 create initial conditions @xmath79 inside each simulation unit for the microscopic simulator , consistent with the spatial profile of the macroscopic properties - the average densities inside the teeth and gaps @xmath80 .",
    "+   + 2 . _",
    "simulation_. based on the microscopic initial condition constructed in step 1 compute @xmath81 and @xmath82 by running the microscopic simulator inside the simulation units from time @xmath45 to @xmath83 .",
    "_ restriction_. obtain the spatially averaged densities inside the teeth and gaps @xmath84 based on eq .",
    "( [ patch1:eqn])-([patch2:eqn ] ) .",
    "_ projective step_. estimate the macroscopic time derivative at time @xmath45 , e.g. , as + @xmath85 and use it in a time integration method of choice , e.g. , forward euler , @xmath86      except for the two outer teeth that receive special treatment , we create the microscopic initial condition inside the @xmath87 simulation unit by constructing a local quadratic polynomial approximation , @xmath88 , to the density that matches the average density in a tooth and its two neighboring gaps as follows .",
    "let @xmath89 be the width of the tooth ( so @xmath90 is the width of the gap ) and require @xmath91 as shown in fig .",
    "[ fig : lifting_2]a , the microscopic initial conditions @xmath92 @xmath93 are constructed such that the averaged function values inside the tooth ( region 3 ) , and inside the neighboring gaps ( regions 1 and 5 ) equal the average densities in these regions .    at the two boundaries , as fig .",
    "[ fig : lifting_2]b and c show , there are gaps only on _ one _ side of the boundary teeth so the microscopic initial conditions are created in a slightly different manner . at the left boundary , a local quadratic polynomial @xmath94 is constructed such that @xmath95 similarly , at the right boundary a local quadratic polynomial @xmath96 is constructed such that @xmath97 note that the _ left edge _ of the leftmost tooth ( and similarly the right edge of the rightmost tooth ) is put at the two boundaries @xmath98 , instead of their respective centers .",
    "for this reason , the outermost gaps are of a slightly different size ( @xmath99 ) compared to the inner ones ( which are of equal size @xmath90 ) .",
    "as mentioned previously , for our initial experiment and its analysis a fine - grid finite volume scheme is first used as theinner \" , microscopic simulator .",
    "we emphasize again that the purpose of first using a fine discretization of as our  inner \" microscopic solver is to facilitate a numerical study of the errors involved - something we can not do when dealing directly with the agent - based simulator .",
    "we divide each simulation unit into @xmath100 fine bins , where @xmath101 denotes the number of fine bins inside the tooth while @xmath102 denotes the number of fine bins inside each buffer .",
    "all these fine bins are of equal size @xmath103 . based on the previously constructed local quadratic polynomial @xmath92 we initialize the averaged densities in the fine bins as follows : @xmath104 where @xmath105 denotes the center of each fine bin and @xmath106",
    "denotes the average densities inside the @xmath107 fine bin of the @xmath42 simulation unit ( as the red cross marks in fig .",
    "[ fig : simulation ] and [ fig : simulationbc ] denote ) .",
    "[ fig : simulation ] illustrates the simulation step in the bulk of the spatial domain .",
    "starting from the previously constructed local quadratic polynomial , we first initialized the average densities inside the fine bins using . to evolve @xmath108 for one microscopic step @xmath109 , as eq .",
    "( [ overall : eqn ] ) and ( [ flux : eqn3]-[flux : eqn2 ] ) show , it requires @xmath110 , @xmath111 and @xmath112 . because of that , we are not able to evolve the solutions for the two bins _ at the boundaries _ ( the two bins denoted in grey in the upper - left part of fig .  [ fig : simulation ] ) .",
    "therefore , after the first microscopic time step @xmath109 , these two bins are discarded .",
    "for the same reason , after another microscopic time step dt , two more ( now outer ) fine bins need to be discarded , and so on until all the bins in the buffer regions are discarded .",
    "there are @xmath102 fine bins in each buffer , so we can run the microscopic simulator for @xmath102 microscopic time steps . during the @xmath113-th step ( @xmath114 ) , we save the fluxes computed at the left ( resp .",
    "right ) edge of the @xmath6-th tooth , @xmath115 ( resp",
    ".   @xmath116 ) .",
    "the simulations in the leftmost and rightmost simulation units are performed slightly differently . as fig .",
    "[ fig : simulationbc ] shows , a buffer is only used on one side of the tooth ( the side to the interior of the spatial domain ) . on the other side , the outer boundary of the spatial domain , the boundary condition @xmath117 needs to be enforced .",
    "this is achieved using a ghost bin ( colored pink in fig .",
    "[ fig : simulationbc ] ) with density equal in magnitude but opposite in sign to the density of the leftmost ( resp .",
    "rightmost ) inner bin .",
    "( see fig .",
    "[ fig : simulationbc ] for an illustration of the left boundary ; the right boundary is treated in a similar way . )      at the end of the @xmath118 step , we update the _ total _ fluxes at the edges of each tooth for the coarse time interval @xmath119 as follows @xmath120 then , based on eqn .",
    "( [ patch1:eqn ] - [ patch2:eqn ] ) , the coarse variables - the average densities inside the teeth and gaps @xmath84 - are updated .",
    "is now used to estimate the macroscopic time derivative and is used to project the macroscopic solutions forward to obtain @xmath121 .",
    "we compare the performance of the patch - dynamics scheme with two other schemes : one is the fine grid finite volume scheme i.e. , our microscopic simulator _ applied to the entire region _ ; the other is a coarse grid finite volume scheme , which mimics the usually unavailable macroscopic solver .",
    "all three schemes are first applied to the continuum approximation of the agent - based model .",
    "[ fig : evolution ] shows several snapshots of the solutions of these three schemes along the time - path towards their steady states .",
    "starting from the same gaussian - like initial conditions ( fig .",
    "[ fig : evolution]a ) we evolve the solutions of the three systems for a long time ( fig . [ fig : evolution]b shows one snapshot of the transient solutions ) until they have reached their steady states ( fig .",
    "[ fig : evolution]d ) .",
    "as we can see from the figure , the solution of the patch - dynamics scheme agrees well with the other two schemes along the entire process .",
    "the steady state solutions of the three schemes also agree well with the analytical steady state solution of the problem ( fig .",
    "[ fig : evolution]d ) . in fig .",
    "[ fig : evolution]c and [ fig : evolution]e we plot the differences between the fine finite - volume scheme and the other two methods , patch dynamics and coarse finite volume scheme .",
    "the solution to the fine finite - volume scheme is an approximation to the true solution , so these differences can be viewed as a first approximation to the errors in the other two methods . also , since the patch dynamics uses the fine finite - volume scheme as its microscopic solver , the differences between it and patch dynamics are an indication of the error introduced by the patch dynamics scheme . as we can see from fig .",
    "[ fig : evolution]c and [ fig : evolution]e , during the transient phase the two schemes give comparable errors , while as we further evolve the system to steady state the patch dynamics scheme gives smaller errors .",
    "this is probably due to the fact that our patch dynamics scheme utilizes more microscopic level information .",
    "we now turn to the computational savings of patch dynamics . for the patch - dynamics scheme",
    ", we divide the spatial domain into @xmath122 big cells , giving 42 teeth and 41 gaps .",
    "we run  microscopic simulations \" in only @xmath123 of the spatial domain ( since the width of each simulation unit is equal to only @xmath1 of each big cell ) . inside each simulation unit",
    "we put @xmath124 equal - sized fine bins inside each tooth and each buffer to run the microscopic simulations ( mimicked here by the fine grid finite volume scheme ) .",
    "we use @xmath125 as the time step for the microscopic simulator ( @xmath103 is the width of the  fine \" bin ) . after running the microscopic simulator for @xmath126 microscopic steps ( dt ) , or equivalently one coarse time step @xmath127 , we project macroscopic variables 90 coarse steps forward in time .",
    "this means that the microscopic simulations are performed in only @xmath128 of the temporal domain . for the fine finite volume scheme ,",
    "we use @xmath129 fine bins , and use the same time step size dt as the one used in the microscopic simulator for the patch dynamics scheme . for the coarse finite volume scheme we use the same number of big cells ( @xmath122 ) as the one used for the patch - dynamics scheme .",
    "the time step size of this scheme is set to be equal to the effective time step size @xmath4 of the patch dynamics scheme ( recall that @xmath130 , with @xmath131 ) .",
    "overall , in this illustrative example the patch dynamics scheme runs the microscopic simulations in only @xmath1 of the spatial domain and @xmath128 of the temporal domain .",
    "the patch - dynamics scheme uses a microscopic integrator that is not specified ( in this paper we have used an agent - based model as well as a fine - scale finite volume method to illustrate the method and to permit better analysis ) .",
    "the purpose of the gap - tooth part of the scheme is to estimate time derivatives of the macroscopic tooth and gap densities ( more precisely , the chords of their time - dependent solutions over a small interval @xmath4 ) , and these are input to an unspecified outer integrator or other macroscopic numerical analysis procedure ( in this paper we have used projective forward euler integration , but any scheme could be used ) .",
    "the errors thus arise from three sources : the microscopic integrator itself , the patch - dynamics scheme , and the outer integrator ( or whatever other numerical procedure we apply to the chord estimates ) .",
    "the final error is a non - linear combination of the errors from all three sources that depends on details of the problem being solved and the details of each method , making it very difficult to isolate each part of the process .",
    "hence it seems advisable to consider each step from a _ backward error _ perspective . in the backward error view , the microscopic integrator integrates a _ perturbed _ equation exactly .",
    "the size of the perturbation is a function of the microscopic integrator and the equation being integrated , but for our purposes we can ignore it and assume that the microscopic integrator is _ exact _ ( it is for the perturbed equation ) .",
    "then we can examine the size of the errors introduced by the gap - tooth scheme .",
    "the equations for estimating the teeth and gap chord slopes ( for other than the center and end teeth ) are : @xmath132 and @xmath133 note that if we compute the fluxes @xmath134 and @xmath135 exactly , these equations are exact . if , for example , we ran the microscopic integrator over all space and time , these equations would give the exact values of the average teeth and gap densities over time .",
    "however , we introduced the teeth to avoid running the microscopic simulation over all of space , so that after a finite time the buffer regions fail to  protect \" the teeth from the lack of simulation information from the bulk of the gaps . at that point",
    "we have to stop the microscopic integration , and lift from the macroscopic information using the process described in to get a new microscopic description . under the assumption that the microscopic integrator is correct , the error introduced by the patch dynamics scheme is simply _ a change of initial values _ at the start of the @xmath4 integration block .    in the next subsection",
    "we will examine this error analytically and then report on some computational estimates of the errors in our finance model in the following subsection .",
    "suppose that the computed microscopic solution at @xmath45 is @xmath136 .",
    "for each tooth the lifting process creates a quadratic polynomial approximation , @xmath137 , such that the average densities of @xmath138 and @xmath139 agree in the tooth and its neighboring gaps .",
    "the microscopic integration then continues starting from the @xmath138 values rather than from @xmath139 .",
    "the effect is to add r(x ) = u(x ) - v(x ) to the initial values for the next integration interval .",
    "we analyze each tooth separately .",
    "let us set the spatial origin , @xmath140 , to be the tooth center and assume that the taylor series for @xmath136 is v(x ) = v_0 + v_1x + v_2x^2/2 + v_3x^3/6 + , i.e. , @xmath141 is the @xmath142-th spatial derivative of @xmath136",
    ". it will be convenient to define @xmath143 and @xmath144 ( so the left and right gaps are @xmath145 $ ] and @xmath146 $ ] .",
    "because of the average density condition in the tooth and its surrounding gaps we have @xmath147 where @xmath148 is given in .",
    "let us define @xmath137 as u(x ) = r_0 + v_0 + ( r_1+v_1)x + ( r_2 + v_2)x^2/2 . hence r(x )",
    "= u(x ) - v(x ) = r_0 + r_1x + r_2x^2/2 - v_3x^3/6 - v_4x^4/24 + solving for @xmath149 in terms of @xmath150 we get @xmath151 thus , over the region comprising the tooth and its neighboring gaps the largest error that can be introduced is e = _ x |[(d^2+h^2)x -4x^3]v_3/24| + o(h^4 + d^4 ) which is @xmath152 .    how does the error in eq .",
    "[ maxerr ] affect the solution of the integration problem ?",
    "unfortunately it depends on the problem , but if the problem is such that modest perturbations do not cause serious difficulties ( for example , if the system after semi - discretization in space satisfies a lipschitz condition ) the final error is equal to the sum of the errors , each multiplied by bounded amplifications .",
    "thus , if the number of steps in the outer integrator is @xmath153 , the global error will be bounded .",
    "if the average time step size is @xmath154 the global error is @xmath155 over any finite interval , and if the average time step size is @xmath155 the global error is @xmath154 .",
    "if the solution tends to a stable stationary state , then the final error may reflect only the most recent lifting errors and if many of the components are stiff , this may be true over much of the integration interval .",
    "to numerically validate that the order of consistency for the patch dynamics scheme is two , we compare solutions of the patch - dynamics scheme ( using a fine - grid finite volume scheme as the  inner \" microscopic simulator ) with the solutions of a reference scheme , which is also a fine - grid finite volume scheme ( but over the entire physical domain ) . in this reference scheme ,",
    "the spatial domain is divided into @xmath156 fine bins with bin width @xmath157 .",
    "the microscopic time step is set to be @xmath158 . as fig .",
    "[ fig : error]a shows , starting from the same gaussian - like initial condition , we evolve both the patch - dynamics scheme and the reference scheme for some time ( @xmath159 , or equivalently @xmath160 time steps in the reference scheme ) , and then compute the differences between the solutions of these two schemes in order to construct the subsequent log - log plot for the consistency order analysis .    for the patch - dynamics scheme ,",
    "two distinct limits have been numerically simulated .",
    "the first limit corresponds to cases where the tooth size becomes very small . in practice ,",
    "the tooth size in this limit is set to be equal to the fine bin size in the reference scheme ( @xmath157 ) .",
    "the size of the buffers is set to be the same as the one of the teeth . by fixing the size of the teeth and buffers , we studied cases with different sizes of big cells and therefore different sizes of gaps .",
    "recall that , as fig .",
    "[ fig : lifting_2 ] shows , each big cell is of size @xmath53 , which is equal to the sum of the sizes of a pair of tooth and gap . in the second limit , instead of fixing the teeth size to have a very small value",
    ", we keep the ratio between the sizes of the simulation unit and the big cell fixed , while varying both of them simultaneously .",
    "the second limit is closely related to the envisioned practical simulation cases , because in practice we need to use teeth with some finite size , in order to capture meaningful macroscopic properties .    for each limit",
    "we compute the differences between the average densities inside the teeth and the gaps for the patch dynamics scheme on the one hand , and the average densities inside the corresponding regions of the reference scheme on the other .",
    "we define the errors for the teeth and gaps as the l2 norm of these differences : @xmath161 where , @xmath162 and @xmath163 denote the average densities in the teeth and gaps for the patch - dynamics scheme , while @xmath164 and @xmath165 denote the average densities inside the corresponding regions of the reference scheme .",
    "the detailed results of the different cases in these two limits are shown in table [ tab : numlimits ] .    to estimate the order of consistency",
    ", we generated the log(error ) v.s .",
    "log(@xmath53 ) plot and performed linear fitting .",
    "the fitted plots for the two limits are shown in fig .",
    "[ fig : error ] ( b ) and ( c ) .",
    "the slope of the fitted lines together with their respective @xmath166 confidence interval estimates are shown in table [ tab : order ] .",
    "the numerical consistency order estimates are all close to @xmath167 ; the slight deviation is most likely due to the discontinuity at the origin and the boundary conditions .",
    ".numerical results of the consistency order analysis for the two limits .",
    "n is the number of big cells in the patch - dynamics scheme .",
    "@xmath53 denotes the size for the big cells .",
    "the error terms are defined in eq .",
    "( [ eqn : norm1]-[eqn : norm2 ] ) . [ cols=\"^,^,^,^,^,^,^ \" , ]      finally , we turn to the agent - based model ( discussed in section [ sec : agent ] ) for which the patch dynamics scheme has been designed .",
    "we divide the spatial domain into @xmath168 big cells , and set the ratio of the size of the simulation unit to the big cell ( @xmath169 ) to 0.2 .",
    "this means we are running the microscopic simulations in @xmath0 of the spatial domain .",
    "our macroscopic observables ( our coarse variables ) are the average agent densities inside the teeth and gaps . inside each simulation unit the tooth and the two buffers are of equal size , and each of them has been subdivided into 10 fine bins . based on the lifting procedure discussed in section [ sec : lifting ] , microscopic agent densities are assigned to these fine bins .",
    "we then convert these density values into numbers of agents based on the total amount of agents available in the system ; in this case the total number of agents we use is @xmath170 .",
    "once the number of agents for each fine bin is assigned we start the agent - based simulations . as illustrated in section [ sec : simulation ] , the coarse time step size @xmath2 - the time we can run the agent - based simulator before we stop for reconstruction - is closely related to the size of the buffers .",
    "this is because the buffers are gradually `` contaminated '' due to boundary artifacts ; we need to stop a little before these artifacts get propagated to the tooth .",
    "our coarse time step size @xmath2 is chosen to be @xmath171 . within this time interval ,",
    "the chance for any agent to travel a distance of the size of a buffer or more is very low . in this way",
    "agents outside each simulation unit will not affect the solution of the tooth ( although they do affect the solution of the buffers ) , and the tooth is therefore protected . along the simulation process , the fluxes of agents across the edges of the teeth are tracked . in section [ sec : simulation ] , the fluxes are updated based on equations of the artificial microscopic simulator ( a pde ) . in the agent - based case we track the fluxes by counting the number of agents going across those edges .    due to the stochastic nature of the agent - based modeling , we also need to reduce the noise for the macroscopic variables .",
    "the agent - based simulations are therefore repeated inside each simulation unit for @xmath172 copies before the restriction procedure is applied . at the end of each coarse time step , we perform the restriction procedure to compute the averaged fluxes at the edges of the teeth . based on these fluxes we update the numbers of agents inside the teeth as well as the neighboring gaps , and compute the corresponding densities based on the numbers of agents .",
    "following the same procedure discussed in section [ sec : project ] , based on the macroscopic solutions ( the densities ) at the start and the end of each coarse time step , we estimate local time derivatives of the macroscopic variables and project them forward in time .",
    "what allows us to do this is the smoothness of these coarse variables in the time domain . in this case",
    ", we run the agent - based simulations over the duration of one coarse time step , and then  jump \" nine coarse time steps ahead . in other words",
    ", we are running the agent - based simulations over @xmath1 of the temporal domain .",
    "[ fig : agent ] shows four snapshots along a patch dynamics agent - based trajectory on its way to the eventual steady state .",
    "the solutions for the agent - based patch - dynamics simulations are plotted in blue ( teeth ) and red ( gaps ) respectively . to compare the performance ,",
    "the solutions of a fine - grid finite volume scheme for the continuum model are also plotted ( in blue curve)as a reference .",
    "the analytical steady state for the continuum model is shown in fig .",
    "[ fig : agent](d ) .",
    "overall , the solutions of the agent - based patch - dynamics simulations match well ( although not perfectly ) with the solutions of the continuum model .",
    "the deviations are most likely due to the approximations made to derive the continuum model from the agent - based one . in fig .",
    "[ fig : agent](d ) we can see that the steady state of the patch - dynamics agent based simulations matches the stationary state of the full scale agent - based simulations better than the analytical steady state of the continuum model matches it .",
    "we reiterate that the patch - dynamics agent - based simulations require the  expensive \" agent - based computations to be performed in only @xmath1 of the temporal domain and @xmath0 of the spatial domain compared to the full scale agent - based simulations .",
    "we described a patch dynamics scheme for conservative agent - based problems .",
    "this scheme approximates an unavailable effective equation over macroscopic time and length scales , when only a microscopic agent - based simulator is given .",
    "it only uses appropriately initialized simulations of the agent - based model over small subsets ( patches ) of the spatiotemporal domain , thus significantly reducing the computational cost .",
    "because this scheme mimics a finite volume scheme for the underlying effective equation , it is conservative by construction .",
    "since it is often not possible to impose macroscopically inspired boundary conditions on a microscopic agent - based simulation , we have used buffer regions around the patches , which temporarily shield the internal region of the patches from boundary artifacts .",
    "we have explored numerical characteristics of the scheme based on the continuum approximation ( a fokker - planck - type evolution equation ) of the agent - based model , and demonstrated its effectiveness for agent - based computations involving a financial market agent - based model . in this paper",
    "the agent - based model was mainly used for illustration purposes , to demonstrate the effectiveness of the approach .",
    "several factors that can affect the performance of the patch dynamics scheme still need to be explored in more detail .",
    "one of the most interesting ones to study should be the effect of the noise ( in the teeth and the gaps ) on the estimation of relevant quantities , and through them to the overal performance of this scheme .",
    "a.  armaou , c.  i.  siettos , and i.  g.  kevrekidis .",
    "time - steppers and coarse control of distributed microscopic processes . _ international journal of robust and nonlinear control _ , 140 ( 2):0 89111 , 2004 .",
    "a.  bindal , m.  g.  ierapetritou , s.  balakrishnan , a.  armaou , a.  g.  makeev , and i.  g.  kevrekidis .",
    "equation - free , coarse - grained computational optimization using timesteppers . _ chemical engineering science _ , 610 ( 2):0 779793 , 2006 .",
    "e.  blanchart , n.  marilleau , j.  l.  chotte , a.  drogoul , e.  perrier , and c.  cambier .",
    "sworm : an agent - based model to simulate the effect of earthworms on soil structure .",
    "_ european journal of soil science _",
    ", 600 ( 1):0 1321 , 2009 .",
    "r.  erban , i.  g.  kevrekidis , and h.  othmer . an equation - free computational approach for extracting population - level behavior from individual - based models of biological dispersal _",
    "physica d _ , 20",
    "( 215):0 1 - 24 , 2006 .",
    "g.  gassner , f.  lorcher , and c.  munz .",
    "a contribution to the construction of diffusion fluxes for finite volume and discontinous galerkin schemes .",
    "_ journal of computational physics _ ,",
    "2240 ( 2):0 10491063 , 2007 .",
    "m.  a.  janssen , l.  n.  alessa , m.  barton , s.  bergin , and a.  lee . towards a community framework for agent - based modelling .",
    "_ jasss - the journal of artificial societies and social simulation _ , 110 ( 2 ) , 2008 .",
    "i.  g.  kevrekidis , c.  w.  gear , j.  m.  hyman , p.  g.  kevrekidis , o.  runborg , and c.  theodoropoulos .",
    "equation - free coarse - grained multiscale computation : enabling microscopic simulators to perform system - level analysis . _ comm .",
    "math . sciences _ , 10 ( 4):0 715762 , 2003 .                r.  rico - martinez , c.  w.  gear , and i.  g.  kevrekidis .",
    "coarse projective kmc integration : forward / reverse initial and boundary value problems .",
    "_ journal of computational physics _ , 1960 ( 2):0 474489 , 2004 .",
    "c.  i.  siettos , i.  g.  kevrekidis , and n.  kazantzis",
    ". an equation - free approach to nonlinear control : coarse feedback linearization with pole - placement .",
    "_ international journal of bifurcation and chaos _ , 160 ( 7):0 20292041 , 2006 .    c.  i.  siettos , r.  rico - martinez , and i.  g.  kevrekidis",
    ". a systems - based approach to multiscale computation : equation - free detection of coarse - grained bifurcations .",
    "_ computers & chemical engineering _ , 300 ( 10 - 12):0 16321642 , 2006 .    c.  theodoropoulos , y.  h.  qian , and i.  g.  kevrekidis .",
    "`` coarse '' stability and bifurcation analysis using time - steppers : a reaction - diffusion example .",
    "_ proceedings of the national academy of sciences of the united states of america _ , 970 ( 18):0 98409843 , 2000 .",
    "d.  tykhonov , c.  jonker , s.  meijer , and t.  verwaart .",
    "agent - based simulation of the trust and tracing game for supply chains and networks .",
    "_ jasss - the journal of artificial societies and social simulation _ , 110 ( 3 ) , 2008 ."
  ],
  "abstract_text": [
    "<S> in recent years , individual - based / agent - based modeling has been applied to study a wide range of applications , ranging from engineering problems to phenomena in sociology , economics and biology . </S>",
    "<S> simulating such agent - based models over extended spatiotemporal domains can be prohibitively expensive due to stochasticity and the presence of multiple scales . </S>",
    "<S> nevertheless , many agent - based problems exhibit smooth behavior in space and time on a macroscopic scale , suggesting that a useful coarse - grained continuum model could be obtained . for such problems </S>",
    "<S> , the equation - free framework @xcite can significantly reduce the computational cost . </S>",
    "<S> patch dynamics is an essential component of this framework . </S>",
    "<S> this scheme is designed to perform numerical simulations of an unavailable macroscopic equation on macroscopic time and length scales ; it uses appropriately initialized simulations of the fine - scale agent - based model in a number of small `` patches '' , which cover only a fraction of the spatiotemporal domain . in this work </S>",
    "<S> , we construct a finite - volume - inspired _ conservative _ patch dynamics scheme and apply it to a financial market agent - based model based on the work of omurtag and sirovich @xcite . </S>",
    "<S> we first apply our patch dynamics scheme to a continuum approximation of the agent - based model , to study its performance and analyze its accuracy . </S>",
    "<S> we then apply the scheme to the agent - based model itself . </S>",
    "<S> our computational experiments indicate that here , typically , the patch dynamics - based simulation requires only @xmath0 of the full agent - based simulation in space , and need occur over only @xmath1 of the temporal domain .    ,    ,    ,    ,    patch dynamics scheme , equation - free framework , agent - based modeling , mimetic market models </S>"
  ]
}