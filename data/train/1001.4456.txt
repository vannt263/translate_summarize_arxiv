{
  "article_text": [
    "molecular clouds are turbulent , magnetized , self - gravitating objects .",
    "supersonic turbulence , in particular , plays an important role in shaping the cloud structure , and in controlling star formation , because it creates the seeds for local gravitational collapse @xcite . due to the filamentary , fractal structure of the interstellar medium , and due to the large density contrasts , star formation in turbulent molecular clouds proceeds in multiple regions at the same time in parallel , reflecting the hierarchical and fractal nature of the gas density probability distribution ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "moreover , stars typically form in clusters @xcite , showing similar fractal patterns as the gas clouds from which they form @xcite .",
    "to model this complex interplay of turbulence and gravity that eventually leads to cloud fragmentation and to stellar birth with a well - defined initial mass function , it is necessary to follow the freefall collapse of each individual fragment , while keeping track of the global evolution of the entire cloud at the same time .",
    "the fundamental numerical difficulty with this approach is that the freefall timescale @xmath1 decreases with increasing density , @xmath2 following the freefall collapse from typical molecular cloud densities up to stellar densities requires the numerical scheme to cover about ten orders of magnitude in timescales . modeling each individual collapse over such an enormous dynamic range , and following",
    "the large - scale evolution over several global freefall times in a single hydrodynamical simulation is beyond the capabilities of modern numerical schemes and supercomputers .",
    "thus , if one wants to model the large - scale evolution of the molecular cloud alongside the collapse of individual regions far beyond the collapse of the first object , the individual runaway collapse must be cut - off in a controlled way , and replaced by a subgrid model .",
    "there are two different subgrid models to tackle this problem in numerical simulations .",
    "the first approach is to heat up the gas that exceeds a given density threshold , @xmath3 , which is necessarily related to the achievable numerical resolution .",
    "we call this procedure ` jeans heating ' . this relative heating of the gas is often modeled by changing the effective equation of state above the density threshold ( e.g. , by setting the adiabatic exponent to @xmath4 for @xmath5 ) .",
    "heating up the gas above a density threshold increases the sound speed locally and thus increases the jeans length , @xmath6 until the gas is stabilized against gravitational collapse .",
    "the problem with the jeans heating approach is that any parcel of gas above a given density threshold is heated artificially , although the actual gas equation of state should still be close to isothermal so long as the density threshold is below the opacity limit .",
    "this is the case for density thresholds smaller than about @xmath7 ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* and references therein )",
    ". moreover , gas can become denser than the threshold value in shocks that do not necessarily lead to the formation of a gravitationally bound structure . thus , shocked gas not going into freefall collapse will be heated up artificially .",
    "an additional problem of the jeans heating approach is that the increasing sound speed in the heated regions can reduce the courant timestep ( see    [ sec : timesteps ] ) to prohibitively small values .",
    "the second type of subgrid model is to use so called ` sink particles ' , a method invented by @xcite for smoothed particle hydrodynamics ( sph ) , and first adopted for eulerian , adaptive mesh refinement ( amr ) by @xcite . if the gas has reached a given density , a sink particle is introduced , which can accrete the gas exceeding the threshold , without altering the thermal physics .",
    "however , sink particles are supposed to represent bound objects that are / or will be going into freefall collapse , and thus , a density threshold for their creation is insufficient . as for the ` jeans heating ' , shock compression can temporarily create local densities larger than the threshold _ without _ triggering gravitational collapse in that region .",
    "previous grid - based implementations of sink particles are mostly based on a density threshold criterion .",
    "if the density threshold for sink particle creation is smaller than the opacity limit ( about @xmath7 ) , we show that spurious sink particles are created in shocks that did not create a gravitationally bound and collapsing structure . here",
    ", we present an implementation of sink particles for the eulerian , amr code flash that avoids this problem by using a series of checks for gravitational collapse similar to @xcite prior to sink particle creation , such that only gravitationally bound and collapsing gas is turned into sink particles .",
    "we show that the star formation efficiency and the number of fragments is overestimated , if additional , physical checks ( e.g. , checks for a gravitationally bound and collapsing state ) in addition to a density threshold are ignored prior to sink particle formation .",
    "we believe that it is also crucial to investigate the resulting mass distribution of the sink particles , because any successful numerical and analytical model of cloud collapse and star formation is expected to account for the observed mass distribution of cores and stars , i.e. , the clump , core and stellar initial mass functions ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "the sink particle implementation presented here enables us to address the star formation efficiency and rate , as well as the mass distribution of fragments obtained in numerical experiments in a robust and quantitative way .",
    "we test our sink particle implementation against a number of standard fragmentation and orbit integration tests . since stars typically form in dense cluster , close encounters of stars are common , and thus we dedicate significant attention to testing our scheme for its ability to capture close orbits and close encounters .",
    "moreover , in the densest existing star clusters , even merging of stars might be possible @xcite .",
    "our scheme also supports sink particle merging for such extreme cases .",
    "we compare our sink particles with the original sink particle implementation of @xcite in their sph code .",
    "it is a standard sph code , and most sph implementations of sink particles are based on their approach ( e.g. , * ? ? ?",
    "we find that flash and sph show encouraging agreement in the obtained mass distribution of sink particles .",
    "this code comparison strengthens our confidence in numerical calculations of collapse and fragmentation , using amr on the one hand and sph on the other hand . here",
    ", we primarily introduce the new sink particle module for flash and present a series of initial tests for follow - up studies using sink particles . for instance , there are various sph studies with sink particles of purely hydrodynamic collapse . our comparison with sph shows that these results are robust .",
    "however , one would also like to test the influence of magnetic fields and ambipolar diffusion on star formation as well .",
    "the first significant steps toward this were taken in sph simulations of magnetized turbulent clouds recently @xcite",
    ". however , the numerical representation of tangled and wound - up magnetic fields in sph turbulence simulations is ( still ) limited @xcite .",
    "our grid - based approach of sink particles should allow a refined modeling of collapsing , turbulent , magnetized clouds in follow - up studies , including additional physical processes like ambipolar diffusion and self - consistent jet and outflow formation .",
    "in    [ sec : numerics ] the new sink particle implementation for the amr code flash is explained in detail .",
    "a series of simple and more complex tests of the sink particle implementation is presented in    [ sec : tests ] . in    [ sec : amrvssph ] we analyze the formation of a star cluster , and compare column density images , radial profiles , and mass distributions of sink particles obtained with the flash code and with a standard sph code . in  ",
    "[ sec : conclusions ] , we summarize our results and discuss the importance of checks for gravitational instability in addition to a density threshold to avoid spurious creation of sink particles , and to avoid overestimating the star formation efficiency and rate .",
    "the flash code @xcite is an adaptive mesh refinement ( amr ) code @xcite . for purely hydrodynamic studies",
    ", it uses the piecewise parabolic method @xcite by default to integrate the equations of hydrodynamics . for magnetohydrodynamical ( mhd ) studies",
    ", flash provides an 8-wave roe solver .",
    "in addition , a new approximate riemann solver for ideal - mhd @xcite , which preserves positive states in highly supersonic mhd turbulence was recently developed for flash by @xcite .",
    "the corresponding scheme for preserving positive states in purely hydrodynamic studies has been tested successfully in @xcite .",
    "moreover , @xcite have recently developed a non - ideal mhd scheme to model ambipolar diffusion .",
    "this module is also implemented in the flash code and works ( like all other physics modules ) within the amr framework .",
    "flash is parallelized with mpi , and output files are written in the versatile hdf5 format .",
    "the self - gravity of the gas is treated with an iterative multigrid solver ( here we use the multigrid solver implemented in flash v2.5 , recently refined for v3 by * ? ? ?",
    "moreover , a tree - based gravity solver was developed for flash ( richard wnsch 2009 , priv .",
    "comm . ) , which is currently being modified to run on graphics processing units .",
    "our sink particle implementation is compatible with existing flash modules , i.e. , it can be used with the different hydrodynamical and magnetohydrodynamical schemes , including the ambipolar diffusion module , and with either the multigrid or the tree gravity solver .",
    "flash has been extensively tested against laboratory experiments @xcite and other codes @xcite .",
    "for the implementation of the new sink particle module , we made use of the @xmath0-body capabilities of flash .",
    "once created , sink particles are free to move within the cartesian computational domain , independent of the underlying grid , i.e. , they move in the lagrangian frame of reference , while the grid points are fixed in space ( eulerian frame of reference ) .",
    "the outer boundary conditions , i.e. , _ outflow _ , _ reflecting _ , or _",
    "periodic _ also apply to the sink particles in the simulation box .      prior to sink particle creation , it is necessary to perform a number of tests , since we want to avoid creating spurious sink particles in regions that are not undergoing freefall collapse .",
    "the basic idea is to first check each computational cell for whether it exceeds a given density threshold @xmath3 .",
    "if this is the case , a roughly spherical region with a given radius @xmath8 centered on that cell is temporarily created from the gas .",
    "this radius is usually the same as the accretion radius of the sink particle , so we will also call it @xmath8 in the following ( see    [ sec : accretion ] for the implementation of accretion ) .",
    "we denote the region surrounding the cell with @xmath5 the control volume @xmath9 .",
    "it is defined such that it covers all computational cells with integer indexes @xmath10 , such that @xmath11 for all @xmath12 .",
    "the central cell of each temporary control volume is at @xmath13 , and @xmath14 is the computational cell volume at spatial position @xmath10 .",
    "it is then checked whether the gas in the control volume @xmath9    * is on the highest level of refinement , * is converging , * has a central gravitational potential minimum , * is jeans - unstable , * is bound , * is not within @xmath8 of an existing sink particle .",
    "these checks are similar to the checks introduced in @xcite prior to sink particle formation in sph .",
    "only after these conditions are fulfilled altogether , a sink particle is formed from the gas within the control volume and placed in the center of mass of the gas from which the particle forms .",
    "each of the criteria for sink particle creation is discussed at more detail in the following .",
    "the order in which these checks are performed does not matter , however , during code development and tests it became clear that it is useful to do the least computationally expensive checks first to make a preselection of cells prior to the more expensive checks .",
    "we introduced sink particles in the flash code to follow collapse calculations for many dynamical times without violating the truelove criterion for the gas density @xcite .",
    "the truelove criterion states that in order to avoid spurious fragmentation in numerical collapse calculations in grid codes , the jeans length ( eq .  [ eq : lj ] ) must be resolved with at least four grid cells , @xmath15 @xcite .",
    "for mhd calculations , @xcite find that more than four cells are required .",
    "it should be emphasized that the resolution criteria by @xcite and @xcite are only meaningful in regions that are undergoing self - gravitational collapse ( further discussed in    [ sec : comparisonwithotherimplementations ] ) .",
    "usually , adaptive mesh refinement ( amr ) is used to guarantee that the resolution is always sufficient to satisfy these criteria . however , for collapse calculations involving multiple collapsing regions the pure amr approach only works for the first object going into collapse .",
    "this is because freefall collapse is a runaway process in which the first gravitationally bound over - density collapses the fastest .",
    "due to the courant condition ( see   [ sec : timesteps ] ) , this leads to smaller and smaller timesteps , which stalls the evolution of the entire simulation .",
    "introducing sink particles in regions that are going into freefall collapse on the highest level of refinement provides a way for cutting - off this runaway process in a controlled fashion .",
    "however , as discussed in the introduction , it is insufficient to form sink particles solely based on a density threshold in supersonically turbulent gas .",
    "additional checks are necessary .",
    "the jeans refinement criterion discussed in the previous subsection is also used to resolve the jeans length of the gas up to the highest level of the amr grid hierarchy .",
    "only when the jeans refinement reaches the highest amr level , sink particles are allowed to form . since the accretion radius @xmath8 of a sink particle is coupled to the grid resolution criterion ( see  ",
    "[ sec : resolutionflash ] ) , sink particles should always be located on the highest level of the amr hierarchy .",
    "this is taken care of by an additional refinement criterion for sink particles , which guarantees that any grid cell located inside the accretion radius of any existing sink particle will always be adaptively refined up to the highest amr level .      in order to guarantee that the gas supposed to form",
    "a sink particle is in freefall collapse , we introduced a check for convergence of the flow toward the center of the control volume , @xmath16 . unlike @xcite we implemented this criterion such that not just the total divergence toward the central cell must be negative , but also that the flows along each of the principal axes must be directed toward the center .",
    "the converging flow check alone is insufficient , because @xmath16 can also be fulfilled by a localized collision of multiple shocks that do not necessarily produce a gravitationally bound structure .",
    "thus , here we use the converging flow check primarily as a preselection of cells that are considered for sink particle formation , before other , more computationally expensive checks are performed below .",
    "only the combination of the converging flow check with the gravitational potential minimum , bound state and jeans - instability checks actually guarantees that the gas is in freefall collapse .",
    "we guarantee that sink particles can only be created if the central cell of the control volume @xmath9 defined in equation  ( [ eq : controlvolume ] ) is the minimum of the local gravitational potential @xmath17 inside the control volume .",
    "the central cell @xmath13 must fulfill the constraint @xmath18\\ ] ] for sink particle creation .",
    "if the converging flow check and the potential minimum criterion are fulfilled , the control volume is checked for jeans - instability .",
    "the thermal energy @xmath19 and the gravitational energy @xmath20 of the gas in the control volume are calculated as follows : @xmath21 where @xmath22 is the sound speed , @xmath23 is the gravitational potential due to the gas mass inside the control volume and @xmath24 is the mass inside each cell @xmath10 .",
    "the relation @xmath25 must hold for sink particle creation , which means that the gas exceeds the jeans mass within the control volume . in the case of magnetic fields",
    "this criterion is modified such that the magnetic pressure is taken into account as well .",
    "the magnetic energy , @xmath26 is computed and added to the right hand side of equation  ( [ eq : jeansinstability ] ) to get a modified version of the jeans criterion , which takes into account the additional pressure provided by magnetic field fluctuations .      for successful sink particle creation",
    ", the total gas energy inside the control volume must be negative , @xmath27 the gravitational , thermal , and magnetic energies are computed from equations  ( [ eq : egrav ] ) , ( [ eq : eth ] ) and  ( [ eq : emag ] ) . the kinetic energy @xmath28 is determined from the velocity dispersion of the gas , where the center of mass motion , @xmath29 is subtracted . only if equation  ( [ eq : bound ] ) holds , the gas within the control volume is a bound system .",
    "a new sink particle can not be created within the accretion radius of an already existing sink particle .",
    "gas that exceeds the density threshold within the accretion radius of an existing particle is accreted by that particle , if the gas passes the accretion checks as explained in the following section .      except for the refinement and potential minimum checks ,",
    "all checks used here are analogous to the sink particle implementation by @xcite for sph .",
    "test simulations showed that the potential minimum check prevents almost all spurious sink particles ( particles not representing bound and collapsing gas ) from forming .",
    "however , the jeans instability and bound state checks are still required in regions of large velocity dispersions , occurring in supersonic , shock - dominated flows .",
    "moreover , magnetic effects are not taken into account by the potential minimum check , but are covered with the jeans instability and bound state checks ( as in * ? ? ?",
    "* except for our inclusion of the magnetic energy ) .",
    "the eulerian , amr implementations of sink particles by @xcite and @xcite , and the eulerian , uniform grid implementation by @xcite use the density threshold check , the refinement check ( only * ? ? ?",
    "* ; * ? ? ?",
    "* ) and the converging flow check ( only the total divergence is required to be negative , which is implicitly covered by the density threshold check ) , but no check for potential minimum , jeans instability , bound state and proximity of existing sink particles .",
    "thus , a significantly larger number of sink particles is typically created , which requires subsequent merging in @xcite and @xcite .",
    "this merging of sink particles is used as an effective accretion in addition to their bondy - hoyle accretion model , while @xcite use no merging of sink particles , but direct accretion from the grid based on the density threshold .",
    "it is important to note here that our sink particle implementation ( as the implementation by * ? ? ?",
    "* ) allows the density to exceed the density threshold set by the @xcite criterion in some cases .",
    "however , this does not mean that our implementation violates the truelove criterion . by definition",
    ", the truelove criterion only applies to gravitationally bound gas in freefall collapse , for which the density reached the threshold due to gravitational collapse , but not due to purely hydrodynamical compression alone , typically occurring in supersonic turbulent flows . in such supersonic flows ,",
    "the gas can reach and exceed the density threshold in strong shocks ( e.g. , in isothermal gas the postshock density increases proportional to the square of the mach number ) . thus , supersonic turbulent density fluctuations can cause the gas to exceed the density threshold .",
    "some of those shocks are dominated by the velocity dispersion and _ not _ by self - gravity . in such cases",
    "it is important to avoid spurious creation of sink particles , because they would not represent gravitationally bound and collapsing objects .",
    "our sink particle implementation avoids spurious creation of sink particles by explicitly testing the gas for local gravitational collapse .",
    "it should be noted that the additional checks to the density threshold are only necessary , if sink particles are created at densities below the opacity limit ( about @xmath7 ) , when the gas is still in the roughly isothermal regime , as for instance in the large - scale simulations of colliding flows by @xcite and in the turbulent box calculations by @xcite , where sink particles are formed at much lower densities to represent clusters of stars rather than individual stars .",
    "as soon as a sink particle was created , it can gain further mass by accreting gas from the grid .",
    "the combined gravitational attraction of the sink particle and the gas typically lead to an increase of the gas density over the density threshold @xmath3 within the accretion radius @xmath8 of an existing particle .",
    "if a cell @xmath10 within @xmath8 exceeds @xmath3 , the mass increment @xmath30 \\delta v(i , j , k)\\ ] ] is calculated . if @xmath31 is bound to the collective mass of the central sink particle and the remaining gas within @xmath8 , @xmath31 is accreted by that particle . to verify that @xmath31 is bound to the particle , the kinetic energy of @xmath31 is calculated in the reference frame of the particle and compared to its gravitational binding energy .",
    "we furthermore check that @xmath31 is moving toward the sink particle , i.e. , the radial velocity of @xmath31 must be negative .",
    "this additional check will also allow us to model mass - loaded protostellar jets from within the control volume in follow - up studies .    if the mass increment @xmath31 is located inside a region of overlapping multiple sink accretion radii ( which can happen due to particle motion )",
    ", the gravitational binding energy of @xmath31 for each of these particles is calculated , and @xmath31 is accreted by the particle to which it is most strongly bound .",
    "gas exceeding the density threshold @xmath3 within a given inner accretion radius will always be accreted without further checks for a bound state and convergence . the inner accretion radius ,",
    "however , is always set such that accretion without further checks only applies to the single central cell in which the particle is located .",
    "this is only to avoid numerical problems like division by zero and infinite gravitational energies during the default checks .",
    "if the gas mass @xmath31 has successfully passed all the aforementioned tests for accretion , it is accreted by the central particle , such that mass , linear momentum , and angular momentum are conserved ( see appendix    [ app : conservationlaws ] for a discussion of angular momentum conservation ) .",
    "the accreting particle is moved to the center of mass of the particle  gas configuration before the accretion step .",
    "we compute four different contributions to the gravitational interactions between the gas on the grid and the sink particles :    1 .",
    "gas  gas ( g  g ) 2 .",
    "gas  sinks ( g  s ) 3 .   sinks ",
    "gas ( s  g ) 4 .   sinks  sinks ( s  s )    the modeling of these interactions is described in detail in the following sections . in the code , these interactions are computed in the order given above , so we also present them in this order below .",
    "physically , however , the order does not matter .",
    "the self - gravity of the gas is computed using the standard poisson solver in flash .",
    "it is an iterative multigrid solver that cycles over the amr hierarchy to solve poisson s equation @xmath32 for the gas distribution on the grid .",
    "a tree - based gravity solver was developed for flash recently ( richard wnsch 2009 , priv .",
    "comm . ) , which can also be used to calculate the gravitational potential instead of the multigrid solver .",
    "the poisson solver returns the gravitational potential @xmath33 in each grid cell , which is due to the whole gas distribution only ( without the sink particle contribution ) .",
    "the gravitational acceleration of the gas , @xmath34 is then computed for each grid cell as @xmath35      equation  ( [ eq : gasgas ] ) is used to calculate the gravitational acceleration for the sink particles due to the gas component only .",
    "the acceleration @xmath34 is interpolated from the grid onto the sink particles with a first - order cloud - in - cell method at each position of a sink particle @xmath36 , which yields @xmath37 .",
    "a higher - order interpolation scheme like the triangular - shaped cloud method or the tri - cubic interpolation ( e.g. , * ? ? ?",
    "* ) does not yield significantly different results , because the gravitational acceleration of the gas is relatively smooth , and a linear interpolation scheme is sufficient .",
    "due to their mass the sink particles can exert an appreciable gravitational acceleration onto the gas as well .",
    "this acceleration is computed by a direct sum involving all computational cells and all sink particles . for each computational cell center @xmath10 , the distance @xmath38 to each particle @xmath36",
    "is calculated and the acceleration that the particles with masses @xmath39 exert onto the gas in each cell is then computed as @xmath40 computing the acceleration of the gas due to the sinks thus involves a nested sum over all grid cells and all particles .",
    "this can become computationally expensive , because this operation scales as the number of grid cells times the number of particles .",
    "however , even for sink particle numbers up to @xmath41 , the nested sum hardly affected the overall computational cost , which always remained dominated by the computation of the self - gravity of the gas component ( eq .  [ eq : poisson ] ) .    for cell centers",
    "@xmath10 very close to sink particles , the acceleration computed via equation  ( [ eq : sinksgas ] ) can become very large and goes to infinity when a sink particle is exactly located in the center of a cell .",
    "it is thus necessary to use gravitational softening of the acceleration within a softening radius of each sink particle , which is discussed in ",
    "[ sec : softening ] .",
    "the acceleration of the gas due to the sink particles , @xmath42 is added to the gas  gas acceleration @xmath34 to yield the total gravitational acceleration for the gas : @xmath43      the gravitational acceleration for sink particle @xmath36 due to all other sink particles in the domain is computed as a direct sum involving all other sink particles @xmath44 with masses @xmath45 : @xmath46 where @xmath47 , is the relative distance vector between two sink particles @xmath36 and @xmath44 .    the sink  sink acceleration is added to the grid - interpolated acceleration caused by the gas ( cf .  ",
    "[ sec : gassinks ] ) to yield the total gravitational acceleration for sink particle @xmath36 : @xmath48    equation  ( [ eq : sinkssinks ] ) is also subject to gravitational softening as explained in the next section .",
    "the basic problem in computing the gravitational acceleration following equations  ( [ eq : sinksgas ] ) and  ( [ eq : sinkssinks ] ) is that it can yield extremely large values , if the distance between sink particles and cell centers or between adjacent sink particles becomes small .",
    "if the distance goes to zero , the acceleration becomes infinite .",
    "hence , the timestep given by equation  ( [ eq : timestepgravsinks ] ) goes to zero and the simulation grinds to a halt .",
    "it is therefore necessary to apply gravitational softening for distances smaller than a given softening radius @xmath49 , such that the acceleration smoothly approaches zero as the distance between particles goes to zero .",
    "there are different approaches for gravitational softening .",
    "one of the standard softening types is the plummer softening , @xmath50 . in the case of plummer softening",
    "the acceleration approaches newton s acceleration for a point mass @xmath51 in the limit @xmath52 .",
    "instead of plummer softening , we use a type of spline softening that is typically used in sph and @xmath0-body simulations to soften the gravitational forces ( e.g. , * ? ? ? * ) .",
    "the functional form of the cubic spline softening used here is provided in appendix  [ app : softening ] .",
    "figure  [ fig : softening ] shows a comparison of plummer softening and spline softening , equation  ( [ eq : spline ] ) . for plummer softening",
    ", the gravitational acceleration is modified for all distances @xmath53 .",
    "in contrast , the spline softening exactly follows the asymptotic solution @xmath54 for @xmath55 and smoothly approaches zero for @xmath56 .",
    "sink particles are evolved using a variable - timestep leapfrog integration scheme .",
    "we consider four timestep constraints to guarantee a stable numerical solution : @xmath57 with @xmath58 , and @xmath59 is the smallest linear cell size in the computational domain .",
    "the smallest of the first three timestep constraints applies to the hydrodynamic solver to guarantee a stable hydrodynamical evolution of the gas .",
    "equation  ( [ eq : timestepcfl ] ) is the courant - friedrichs - lewy condition @xcite .",
    "a modified version of this is used for magnetohydrodynamic studies , which takes into account the fastest possible magnetosonic wave . by solving equation  ( [ eq : timestepgravgrid ] )",
    ", we also consider the gravitational forces of the self - gravity of the gas , and the gravitational forces of the sink particles exerted onto the gas .",
    "equation  ( [ eq : timestepvelsinks ] ) ensures that sink particles can not cross more than half a grid cell ( @xmath60 ) within a single timestep when they move with a velocity @xmath61 .",
    "the latter two constraints guarantee that the gravitational forces exerted by the sink particles onto the gas are consistently taken into account for the evolution of the hydrodynamics .",
    "since the sink particles are always moved within a hydrodynamical timestep , the sink particle timestep can never become larger than the smallest of the hydrodynamical timesteps given by equations  ( [ eq : timestepcfl ] ) , ( [ eq : timestepgravgrid ] ) and  ( [ eq : timestepvelsinks ] ) .",
    "however , these three constraints are insufficient to guarantee a stable and accurate time integration of sink particles , because the sink particle timestep can become significantly smaller than the hydrodynamical timestep for close encounters of sink particles .",
    "one additional timestep constraint that captures closely approaching sink particles is needed .",
    "the last timestep constraint given by equation  ( [ eq : timestepgravsinks ] ) takes into account the total gravitational acceleration , @xmath62 onto each sink particle ( eq .  [ eq : gravsinks ] ) , and the minimum distance @xmath63 between all sink particles @xmath36 and @xmath44 . in the course of code development and initial tests of the scheme , it turned out that fulfilling equation  ( [ eq : timestepgravsinks ] ) is extremely important to avoid inaccurate time integration and artificial acceleration , especially in cases of closely approaching or orbiting sink particles . in test simulations and applications ,",
    "@xmath64 became up to three orders of magnitude smaller than the timestep given by any of the three constraints of equations  ( [ eq : timestepcfl ] ) , ( [ eq : timestepgravgrid ] ) and  ( [ eq : timestepvelsinks ] ) .",
    "to avoid prohibitive small timesteps for the hydrodynamical evolution , we use subcycling for the time integration of sink particles , while keeping the hydrodynamical gas distribution fixed ( similar to * ? ?",
    "during subcycling , sink particles can not change their positions by more than half a grid cell due to equation  ( [ eq : timestepvelsinks ] ) , and thus they remain almost fixed relative to the grid . however , subcycling is absolutely necessary to guarantee accurate integration of sink particle orbits as shown in a series of @xmath0-body tests in the next section .",
    "in the following sections we describe a series of test simulations to analyze the performance of our sink particle scheme . in particular , we test the accuracy of the time integration of pure particle systems and systems involving gas - sink interactions as well as dynamical sink particle creation and their accretion .      as described in    [ sec : gravity ] we modified the gravitational interactions of gas and particles compared to the standard flash implementation .",
    "therefore , we test our new approach with the following setups .      in the simplest tests we initialize two sink particles with equal masses of @xmath65 at a distance of @xmath66 , and let them orbit around their common center of mass .",
    "there are 8x8x8 grid cells in this test .",
    "however , the gas density was set small enough , so that this setup purely tests the @xmath0-body integration scheme .",
    "the results are shown in figure  [ fig : circular_orbits ] .",
    "the trajectory of the particles are plotted including all positions up to 1000 orbits around their common center of mass at @xmath67 .",
    "the orbit is maintained circular for these 1000 orbits , and it is not expected to deviate significantly for longer integration times .",
    "this is because the leapfrog time - integration scheme is symplectic for constant timesteps .",
    "the scheme thus conserves energy and preserves time - reversibility in this test , such that the symmetry of the system is maintained to machine precision .",
    "a more demanding test is the integration of an elliptical orbit . in this case",
    "the leapfrog integrator takes variable timesteps depending on the distance and gravitational acceleration according to the timestep criterion , equation  ( [ eq : timestepgravsinks ] ) . for this test",
    "we use the same initial conditions as for the circular orbit test , but rotate the initial velocity vectors by @xmath68 from the tangent of the circular orbit of the previous test .",
    "the system thus has the same total energy , but the sink particles move on elliptical orbits around their common center of mass .",
    "the results are shown in figure  [ fig : elliptical_orbits ] .",
    "the top panel shows the default time integration with subcycling , which means that equations  ( [ eq : timestepcfl ] ) , ( [ eq : timestepgravgrid ] ) , ( [ eq : timestepvelsinks ] ) and  ( [ eq : timestepgravsinks ] ) are all used in combination to determine the timestep .",
    "the bottom panel shows the same , but only taking into account the first three of these timestep constraints .",
    "it is important to note that equation  ( [ eq : timestepvelsinks ] ) was the only additional timestep constraint for simulations with particles in the flash code before our modifications .",
    "figure  [ fig : elliptical_orbits ] ( bottom panel ) shows that using equations  ( [ eq : timestepcfl ] ) , ( [ eq : timestepgravgrid ] ) and  ( [ eq : timestepvelsinks ] ) is clearly insufficient , if close orbits are to be accurately reproduced . even within a single orbit",
    ", a significant amount of artificial angular momentum is added to the particles if no subcycling is performed , and after ten orbits they have accumulated an artificial perihel shift of about @xmath69 .",
    "in contrast , ten orbits are accurately followed without a noticeable shift with our present scheme .",
    "it should be noted however that even when using subcycling , the symplectic property of the leapfrog integrator is broken , and after roughly 100 elliptical orbits , an error leading to a perihel shift of about @xmath70 shows up .",
    "this setup tests the gravitational softening introduced in    [ sec : softening ] .",
    "we use the same computational domain as in the two previous tests with two @xmath65 sink particles separated by @xmath66 .",
    "one particle is initially located at @xmath71 , and the other one is at @xmath72 .",
    "both particles have zero initial velocities in the @xmath73-direction , such that they accelerate toward each other by their mutual gravitational attraction . while approaching each other , the timestep drops according to the constraints given by equations  ( [ eq : timestepvelsinks ] ) and  ( [ eq : timestepgravsinks ] ) . due to the softening ,",
    "however , the timestep does not go to zero as the particle distance goes to zero ( cf .",
    "[ fig : softening ] ) .",
    "this allows the two particles to pass through each other smoothly . by the time they pass through the point of zero distance",
    ", they have converted their initial potential energy completely into kinetic energy .",
    "the softening affects the specific value of this energy but nevertheless , the energy must be conserved .",
    "thus , after one passage both particles have exactly exchanged their initial positions .",
    "this process then starts again and the system oscillates for an infinite time . in order to make these oscillations visible",
    ", we apply an initial constant velocity in @xmath74-direction to both particles .",
    "the result is shown in figure  [ fig : oscis ] .",
    "the top panel shows both particle trajectories after 1000 oscillations .",
    "using subcycling , the system easily conserves energy during these 1000 oscillations .",
    "in contrast , if the timestep constraint given by equation  ( [ eq : timestepgravsinks ] ) is ignored , energy conservation is broken already during the first oscillation as shown in figure  [ fig : oscis ] ( bottom panel ) .",
    "both particles gain energy artificially until they leave the domain . in the current test , this happens after about 68 oscillations .",
    "scattering experiments have shown that violating the timestep condition given by equation  ( [ eq : timestepgravsinks ] ) , i.e. , _ not _ using subcycling can lead to enormous artificial accelerations already during a single close encounter of two particles .",
    "the following setup tests the accuracy of the time integration of sink particles orbiting in the gravitational potential of a static gas distribution .",
    "we create a singular isothermal sphere with the following density profile on the amr grid : @xmath75 where @xmath76 and @xmath77 .",
    "the sphere thus has a mass of roughly @xmath78 for @xmath79 .",
    "we place three sink particles at radii of @xmath80 with masses of @xmath81 .",
    "the particles thus represent test particles in a gravitational potential caused by the gas only , such that sink particle interaction is negligible .",
    "since the singular isothermal gas distribution would immediately collapse and form a new sink particle in the center , we deliberately switch off the hydrodynamical evolution , and keep the density distribution and associated potential artificially static .",
    "however , we keep the amr scheme and the poisson solver fully operational , and adaptively refine on jeans length and sink particles as discussed in    [ sec : refinement_check ] .",
    "we use a base grid of @xmath82 grid cells plus two levels of refinement with isolated boundary conditions for the gravity .",
    "the jeans length is resolved with 6 grid cells for this test , while de - refinement is triggered as soon as the jeans length is resolved with more than 12 grid cells .",
    "the initial density and sink particle distributions are shown in figure  [ fig : orbit_sis_amr ] ( left ) .",
    "the three sink particles were given an initial velocity in the @xmath73-direction , such that they should remain on circular orbits around the center of the gas sphere .",
    "it is easy to determine this velocity analytically from the density distribution , equation  ( [ eq : sis_density_profile ] ) .",
    "the result is a keplerian velocity of @xmath83 for each sink particle , independent of the radius .",
    "however , since the sphere is not singular in the center due to the finite resolution of the grid , the actual velocities necessary to keep the sink particles on circular orbits are slightly smaller than the analytical solution ( by roughly 1 - 2% ) .",
    "figure  [ fig : orbit_sis_amr ] ( right ) shows the amr hierarchy and the sink particle positions after the innermost particle has finished roughly one orbit . at this time",
    ", the sink particle on the intermediate orbit with @xmath84 has finished almost half an orbit , and the outer sink particle has completed one third of an orbit .",
    "the grid is refined according to the position of the sink particles .",
    "the jeans refinement criterion keeps the central part at the highest level of refinement and the outer parts at a resolution such that the jeans length is refined with at least 6 grid cells .",
    "de - refinement to the base grid resolution was not triggered in the outer parts , because the jeans length was resolved with 6 - 12 grid cells there .",
    "we evolved this configuration for 100 orbits of the innermost sink particle .",
    "the trajectories of all three sink particles are shown in figure  [ fig : orbit_sis ] after 1 , 10 , and 100 orbits of the innermost sink particle ( from left to right ) .",
    "after 100 orbits of the innermost sink particle , the intermediate particle has finished 50 orbits , while the outermost sink particle has finished about 33.3 orbits .",
    "the latter orbit as well as to a smaller degree also the intermediate orbit are slightly broadened , and they are not as accurately reproduced as the innermost orbit .",
    "this is because the poisson solver introduces slight deviations from the spherical gravitational potential mainly in regions close to the boundaries of the cartesian domain at the coarse grid resolution used in this test .",
    "for such a configuration and setup that incorporates the multigrid solver and the full amr scheme , it is hard to maintain perfect spherical symmetry for more than 10 - 100 sink particle orbits .",
    "the collapse of supercritical bonnor - ebert spheres  @xcite , is a well - studied problem  ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , and thus represents a good test case for our sink particle implementation . a bonnor - ebert sphere can be described by the following dimensionless parameters for the radius , time , mass , and mass accretion , respectively : @xmath85 where @xmath86 is the sound speed and @xmath87 is the central density of the sphere . in the hydrostatic configuration of such a sphere",
    ", the dimensionless mass can be written as @xmath88 , where @xmath89 is the gravitational acceleration .",
    "the sphere becomes supercritical if its dimensionless radius exceeds the critical value @xmath90 . to trigger the collapse",
    ", we set the initial value to @xmath91 , which gives a total mass , @xmath92 in dimensionless units . we follow the collapse with two different density thresholds for sink particle creation and accretion : @xmath93 and @xmath94 .",
    "these two density thresholds correspond to accretion radii of @xmath95 and @xmath96 , respectively .    figure  [ fig : be_mdot_m_lowres ] shows the mass accretion history of the sink particle in the case of the low density threshold , @xmath93 .",
    "initially , when the sink particle starts to accrete at @xmath97 , the accretion rate increases quickly until it reaches a maximum .",
    "the accretion rate peaks at @xmath98 when about 12% of the total mass of the sphere is accreted onto the sink particle .",
    "after that , the accretion rate decreases while the envelope runs out of gas . at @xmath99 about 64% of the total gas mass has been accreted onto the sink particle .",
    "the time evolution of the accretion rate is similar in the case of a higher density threshold ( @xmath94 ) for the sink particle accretion .",
    "figure  [ fig : be_mdot_m_highres ] shows the mass evolution for this case . here",
    ", the effective accretion radius is smaller by a factor of ten compared to the @xmath93 case , and thus the peak accretion rate is reached ten times faster .",
    "the time evolution of the mass accretion is in qualitative agreement with 1d simulations by ( e.g. , * ? ? ?",
    "* ) , and with various analytical ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) and numerical models of protostellar collapse , which predict a peak in the accretion followed by a smoothly declining accretion rate ( see also * ? ? ?",
    "* and references therein ) .",
    "the collapse of a singular isothermal sphere with a @xmath100 density profile produces a constant flux of mass through spherical shells ,",
    "i.e.  a constant accretion rate ( see e.g. * ? ? ?",
    "we compute the collapse of a singular isothermal sphere to test whether our model of sink particle accretion reflects this collapse behavior .",
    "the sphere has a truncation radius of @xmath101 , a density at this radius of @xmath102 , and therefore a total mass of @xmath103 .",
    "the sphere is at a temperature of @xmath104 corresponding to a sound speed of @xmath105 . with these values",
    "the sphere has a large instability parameter of @xmath106 , where @xmath107 @xcite .",
    "figure  [ fig : sis_mass_accretion ] shows the mass and the mass accretion rate onto the sink particle during the collapse of the singular isothermal sphere .",
    "as the gas of the sphere is initially at rest , the mass accretion reaches a close to constant value of about @xmath108 , until the entire gas of the sphere is accreted onto the central sink particle at @xmath109 .    for comparison of the accretion history of the sink particle ,",
    "we show the time evolution of radial profiles of the gas sphere in figure  [ fig : sis_radius ] .",
    "as expected , the density profile of the sphere evolves from @xmath110 to @xmath111 ( see e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "the collapse proceeds highly supersonically ( @xmath112 ) with increasing infall velocities toward the collapse center ( fig .",
    "[ fig : sis_radius ] , middle panel ) . the mass accretion , i.e. the mass flux through spherical shells of radius @xmath53 is constant in time as well as independent of the radial position with a value of @xmath113 .",
    "it is the exact same amount of gas that flows through these spherical shells into the control volume of the sink particle , where it is finally accreted .",
    "a comparison of the sink particle accretion rate in figure  [ fig : sis_mass_accretion ] with the mass flux through spherical shells in figure  [ fig : sis_radius ] ( bottom panel ) shows the high accuracy of the sink particle accretion mechanism .    for comparison , we calculated the mass accretion rate predicted by @xcite .",
    "the constant accretion rate often referred to in many studies citing @xcite is @xmath114 with @xmath115 , which is the appropriate value for an instability parameter close to @xmath116 ( see * ? ? ? * tab .  1 ) .",
    "the accretion rate depends on the coefficient @xmath117 , which is controlled by @xmath118 .",
    "numerical integration of the dimensionless , one - dimensional equations of hydrodynamics gives the solutions of @xmath117 for given instability parameters @xmath118 as in ( see * ? ? ?",
    "* tab .  1 ) . there ,",
    "shu only tabulated values up to @xmath119 .",
    "since our singular isothermal sphere has a much larger instability parameter ( @xmath106 ) , we repeated the numerical analysis by @xcite to find solutions for instability parameters up to @xmath120 .",
    "the result for the coefficient @xmath117 of the shu accretion rate in equation  ( [ eq : shu ] ) is plotted as a function of the instability parameter @xmath118 in figure  [ fig : shu1977 ] .",
    "the parameter @xmath117 increases from @xmath115 for @xmath116 to @xmath121 for @xmath120 , more than two orders of magnitude higher ! for the instability parameter @xmath106 of the singular isothermal sphere studied here ,",
    "we obtain @xmath122 .",
    "the accretion rate predicted by @xcite is thus @xmath123 , which is in excellent agreement with our numerical estimate of the sink particle accretion rate ( cf .  fig .",
    "[ fig : sis_mass_accretion ] ) .",
    "we now analyze the collapse and fragmentation of a rotating cloud core , also known as the @xcite test .",
    "it is a standard test for fragmentation in hydrodynamical codes ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "in particular we use a setup similar to @xcite and @xcite .",
    "the initial parameters for the rotating cloud core are : radius @xmath124 , constant density @xmath125 , mass @xmath126 , angular velocity @xmath127 ( ratio of rotational to gravitational energy @xmath128 ) , sound speed @xmath129 ( ratio of thermal to gravitational energy @xmath130 ) , global freefall time @xmath131 , and a 10% density perturbation with an @xmath132 mode : @xmath133 $ ] , where @xmath134 is the azimuthal angle .",
    "the following polytropic equation of state , @xmath135 was used with the polytropic exponent @xmath136 the initial rotation ( @xmath128 ) forces the gas sphere to collapse to a disk with a central bar due to the @xmath132 initial density perturbation . sink particles are allowed to form at densities exceeding @xmath7 .",
    "the accretion radius was set to @xmath137 corresponding to 2.5 grid cells at the highest level of refinement .    figure  [ fig : coldens_bb ] shows a face - on column density projection of the disk at different times along the collapse of the rotating cloud core .",
    "two sink particles form at the location of the two fragments at @xmath138 . at @xmath139 a bar forms that connects the two main fragments . a third fragment forms in the center of the cloud core .",
    "after that , the two main fragments move toward the central object due to the global collapse of the cloud core . at @xmath140 two of the three fragments merge to a single particle close to the center of the rotating cloud core .",
    "note that sink particle merging was used in this test . sink particle merging is optional in our implementation in flash , and",
    "can be activated if desired .",
    "if activated , sink particles are only allowed to merge , if they are inside the accretion radii of one another , and if they are gravitationally bound and converging .",
    "the merged particle is moved to the center of mass of the merging particles , and their linear and angular momenta are assigned to the merged particle .",
    "the conservation laws during accretion and merging of sink particles are discussed in appendix  [ app : conservationlaws ] .",
    "the initial total angular momentum of the rotating cloud core computed from the analytic solution is @xmath141 .",
    "the numerical solution conserves angular momentum to within 2% for all times including the last snapshot shown in figure  [ fig : coldens_bb ] when 23% of the mass has been accreted onto sink particles .",
    "this is comparable to the typical conservation of angular momentum achieved in numerical simulations of rotating self - gravitating cloud cores ( e.g. , * ? ? ?",
    "to check our sink particle implementation for the amr code flash on a more complex physical problem , we apply it here to the formation of a star cluster .",
    "we furthermore want to compare our sink particles against an existing sink particle implementation in a typical sph code .",
    "we compare to the sph code developed by @xcite .",
    "@xcite were the first to use sink particles in an sph code , and thus , most sph implementations for sink particles are based on their approach ( e.g. , * ? ? ?",
    "* ) , as is the grid - based implementation presented here . a detailed description of the flash code and the our sink particle implementation was given in    [ sec : flashcode ] . in the following",
    "we briefly describe the sph code used for our sink particle comparison",
    ".      smoothed particle hydrodynamics ( sph , * ? ? ?",
    "* ; * ? ? ?",
    "* ) calculations presented in this study were performed using a code based on the version developed by benz @xcite , which has since been modified by bate to include individual particle timesteps @xcite and sink particles @xcite . to capture shocks",
    ", the code uses the standard artificial viscosity suggested by @xcite and @xcite , with @xmath142 and @xmath143 . to provide adaptive resolution",
    ", the code allows the sph smoothing lengths ( @xmath144 ) to vary in time and space , with the constraint that each particle maintains a roughly constant number of neighbors ( @xmath145 ) within a distance @xmath146 .",
    "gravitational forces are found using a binary tree ( * ? ? ?",
    "* ; * ? ? ?",
    "* and references therein ) , which is also used to obtain the neighbor lists required by the sph algorithm .",
    "the binary tree opening angle was set to 0.47 in this study , and so returns a more accurate calculation of the gravitational forces than the theoretical limit of 0.57 for 3d binary trees described by @xcite .",
    "gravitational forces are softened using the spline softening technique described in appendix  [ app : softening ] . in the sph code",
    "this softening is used between all particle types . between the gas - gas interactions , the softening length @xmath49 is given by the mean smoothing length of the particle pair , and",
    "so the softening is zero for particles which are not neighbors , since the distance between them is greater than @xmath146 by definition .",
    "this form of the softening assumes that the standard sph smoothing kernel @xcite describes the radial density profile of the particles , and has been shown to reduce the effects of artificial fragmentation @xcite . for the sink particles ,",
    "one is free to chose the value of @xmath49 and in our current study this is set to the sink particle accretion radius , @xmath8 , as for flash .",
    "the value of @xmath49 between gas - sink interactions is then set to @xmath147 for each pair - wise force .",
    "finally , the sph equations and sink particle trajectories are integrated using a second - order runge - kutta - fehlberg integrator .",
    "a full description of the timestepping constraints can be found in @xcite .",
    "an isolated gas sphere of radius @xmath148 with a uniform density of @xmath149 containing @xmath150 was initialized in both the flash and the sph code .",
    "the initial column density structure is shown in figure  [ fig : coldens_init ] ( top panels ) for the flash run ( left panels ) and the sph run ( right panels ) .",
    "an initial random , divergence - free turbulent velocity field was generated on a grid with @xmath151 grid cells with a velocity power spectrum @xmath152 , consistent with the observed velocity dispersion - size relation in molecular clouds ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) , and consistent with the velocity spectra usually obtained for driven supersonic turbulence ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "however , in the present study we are not driving the turbulence , i.e. , we study decaying turbulence .",
    "the velocity dispersion was scaled to @xmath153 , consistent with the observed velocity dispersions in molecular clouds of the size studied here ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) . with the isothermal sound speed of @xmath154 ( temperature @xmath155 , mean molecular weight @xmath156 )",
    ", this velocity dispersion corresponds to an initial rms mach number of about 4.5 .",
    "thus , the ratio of kinetic to gravitational energy of the gas sphere is @xmath157 .",
    "the equation of state is isothermal , and self - gravity is used throughout this code comparison .",
    "sink particles are allowed to form in both codes at densities exceeding @xmath158 with a sink particle accretion radius of @xmath159 . both codes",
    "used the same spline softening ( cf .",
    "appendix  [ app : softening ] ) for sink particle interactions , with the softening radius set equal to the accretion radius ( @xmath160 ) .",
    "the temporal evolution is followed in units of the initial freefall time @xmath161 .    for the flash run , we used a cubic computational domain with a boxsize of @xmath162 , slightly larger than the diameter of the initial gas sphere ( @xmath163 ) . to keep the mass outside of the sphere small ,",
    "the gas density was set two orders of magnitude smaller outside than the uniform density inside the sphere .",
    "the additional mass of @xmath164 outside the sphere is about 3% of the total mass , and thus the total mass in the computational domain is 3% larger in the flash run than in the sph run .",
    "pressure equilibrium is provided by keeping the gas outside the sphere at a temperature two orders of magnitude higher than inside .    for the sph run the initial velocity field was interpolated from the grid to the sph particles using the standard sph smoothing kernel @xcite .",
    "the initial density outside the isolated gas sphere is zero for the sph run since no particles were used there .",
    "however , a constant boundary pressure was applied in order to keep the sphere in pressure equilibrium with the surrounding .",
    "both codes used isolated boundary conditions for the computation of the gravitational potential .    the initial conditions used in our comparison provide a more rigorous test of the performance of our codes than those commonly used in the study of cluster formation .",
    "typically , initial conditions are set up with roughly equal kinetic and gravitational energies , @xmath165 ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "these clouds tend to evolve to form several centers of star formation , each producing a small group of fragments that feed from the gas delivered by the large - scale flows in the cloud",
    ". clouds with less kinetic energy , in contrast , have less support against global contraction , and so undergo global collapse . as a result ,",
    "such clouds tend to produce a single , dense star - forming center that also has a higher rate of star formation ( e.g. , * ? ? ?",
    "as a consequence , the cloud modeled here enters a more violent and chaotic @xmath0-body phase , in which it is more difficult to obtain convergence for different numerical methods .      in order to satisfy the resolution criterion in simulations including self - gravity ,",
    "the gas density on the grid must not exceed a critical density @xmath3 in regions of gravitational collapse @xcite .",
    "this density is related to the smallest resolvable jeans length @xmath166 on the highest level of the amr hierarchy .",
    "the density threshold @xmath3 is obtained by solving equation  ( [ eq : lj ] ) for @xmath167 , and using the jeans length and sound speed of the gas resolved with amr on the highest level of refinement : @xmath168 since the jeans length should be resolved with at least 4 grid cells in amr simulations @xcite , the sink particle accretion radius @xmath8 must not be smaller than 2 grid cells .",
    "the sink particle accretion radius is thus determined by the smallest linear cell size @xmath59 that can be resolved with pure amr .",
    "we set @xmath169 to satisfy the truelove criterion on the highest level of refinement .",
    "the jeans length @xmath170 is thus resolved with 5 grid cells on the top of the amr hierarchy .",
    "however , on all amr levels smaller than the maximum level of refinement we resolve the jeans length with at least 12 grid cells to follow features on their way to runaway collapse more accurately .",
    "we additionally apply the shock refinement criterion provided in flash @xcite , and our additional refinement on sink particles ( cf .  ",
    "[ sec : refinement_check ] ) .    for the comparison test presented here",
    ", we used a fixed base grid with @xmath151 grid cells plus two levels of amr resulting in an effective resolution of @xmath171 grid cells .",
    "@xcite have shown that at least two times the number of sph neighbors , @xmath172 particles are necessary for resolving the minimum jeans mass to avoid artificial fragmentation in sph codes .",
    "the jeans mass is defined as @xmath173 where @xmath174 , @xmath175 and @xmath176 are the boltzmann constant , the mean molecular weight and the mass of a hydrogen atom , respectively . assuming a number of sph neighbors of roughly @xmath177 , we can estimate the mass resolution limit for an sph calculation as @xmath178 . the corresponding sink particle accretion radius is @xmath179 .    since we resolve the jeans length with 5 grid cells in the flash run , we chose to use a similar number of sph smoothing lengths to resolve the jeans length in the sph run . therefore , we used a total number of 2 million sph particles for our comparison , which roughly corresponds to resolving the jeans length with 5 sph smoothing lengths .",
    "furthermore , the initial velocity field was constructed on a grid with @xmath180 grid cells .",
    "thus , to accurately sample the initial velocity field with sph particles , it was reasonable to use a similar number of resolution elements in the sph code as grid cells for the initial velocity field .",
    "figure  [ fig : coldens_init ] shows the column density distributions of the flash ( left ) and the sph run ( right ) at @xmath181 ( top ) and @xmath182 ( bottom ) . the initial supersonic turbulent velocity field has generated a complex network of shocks at @xmath182 .",
    "some of the shock - compressed gas becomes gravitationally unstable and goes into freefall collapse .",
    "this happens at roughly @xmath183 as shown in the top panels of figure  [ fig : coldens ] ( left and middle columns for flash and sph , respectively ) .",
    "five sink particles have formed in both the flash and the sph run , containing a total mass of @xmath184 and @xmath185 , respectively .",
    "they form at roughly the same locations in the gas distribution with slight differences in the exact positions .",
    "these differences are mainly due to the slightly different hydrodynamic evolution of the gas prior to sink particle formation in the flash and sph runs",
    ". there is striking agreement between the flash and sph runs at @xmath186 , indicated by the number of sink particles ( 15 versus 17 ) and their accreted mass ( @xmath187 ) .    at @xmath186 ,",
    "the gas distribution has already started to collapse globally due to the decay of the initial turbulence . at @xmath188 ,",
    "32 sink particles containing a total of @xmath189 have formed in the flash run , while the sph run has produced 48 sink particles with @xmath190 .",
    "thus , the flash and sph runs start to diverge at @xmath188 .",
    "the star cluster produced in the sph run is slightly denser than in the flash run .",
    "this trend continues to the last snapshot at @xmath191 when the flash run has produced 49 sink particles with @xmath192 , while the sph run has produced 61 with @xmath193 .",
    "the star cluster is clearly denser in the sph run at this last time .",
    "there are still new sink particles forming in the outskirts of the cluster .",
    "they from at very similar locations in both the flash and the sph runs . for example , at @xmath191 the rightmost sink particle has formed at almost exactly the same location in both codes with respect to the position of the dense core forming there .",
    "however , this particular sink particle also forms slightly closer to the center of the star cluster , reflecting the faster global collapse in the sph run .",
    "this is discussed further in the following section .",
    "to quantify the differences in the flash and sph runs we show radial profiles of the mass , density and radial velocity in figure  [ fig : rad_profiles ] for times @xmath194 , 0.5 , 0.8 , 0.9 , 1.0 and @xmath195 ( from top to bottom ) .",
    "the initial conditions are compared in the three top panels .",
    "the density is constant inside the initial gas sphere with a radius of @xmath196 .",
    "thus , the integrated mass grows with the radius @xmath53 proportional to @xmath197 inside the sphere until it reaches @xmath150 at @xmath198 . in the flash run",
    ", the mass grows slightly further for @xmath199 up to about @xmath200 , because of the remaining low - density gas outside of the sphere as discussed in    [ sec : initialconditions ] .",
    "in contrast , the density is zero for @xmath199 in the sph run .",
    "initially , the radial velocity is roughly zero , because the turbulent velocity field was constructed to be isotropic with zero mean .    at @xmath182",
    "the radial velocity indicates the onset of global infall with slightly supersonic speeds of @xmath201 at @xmath202 .",
    "both the flash and the sph run exhibit similar radial profiles at that time .",
    "when the first sink particles have formed ( @xmath183 ) the radial density profiles roughly follow @xmath203 ( see e.g. , * ? ? ?",
    "* ) for @xmath204",
    ". at @xmath186 the flash and sph run have produced 15 and 17 sink particles , respectively , which is seen as density peaks in the radial density profiles .",
    "the infall velocities have reached mach 5 at that time , and they are roughly consistent between the two codes . however , at @xmath188 the sph run shows slightly larger infall speeds than the flash run for @xmath204 .",
    "this becomes more prominent at @xmath191 , reaching down to the cluster center , when the infall speeds in the sph run are almost twice as large as in the flash run .",
    "the star cluster produced in the sph run is denser , which is shown by the mass and density profiles at @xmath191 .",
    "this is consistent with the visual inspection of column density images discussed in the previous section .",
    "thus , the global collapse of the gas cloud proceeds slightly faster in the sph run compared to the flash run .",
    "there are three explanations for this behavior , probably all contributing to the faster collapse speeds in the sph run .",
    "first , the gas mass outside the sphere may contribute to slow down the collapse slightly in the flash run .",
    "_ inflow _ boundary conditions were used for the hydrodynamics in the flash run .",
    "thus , low - density gas is streaming in from the boundaries during the global collapse , which further increases the filamentary excess mass outside of the cluster from @xmath78 to @xmath205 . secondly",
    ", both the flash and sph codes have different dissipation mechanisms .",
    "@xcite find that sph codes tend to dissipate small - scale , random , turbulent motions slightly faster than grid codes .",
    "thus , our sph run may loose turbulent support faster than our flash run , which shifts the onset of global collapse to earlier times in the sph run .",
    "finally , one must consider that the low - density gas is better resolved in the grid calculation ( e.g. , * ? ? ?",
    "this becomes even stronger at later times when the number of sph particles decreases due to accretion , and the number of grid cells in the flash run increases due to the jeans refinement and the formation of sink particles ( cf .",
    "[ sec : refinement_check ] ) .",
    "therefore , at late times , the numerical resolution of the flash run becomes increasingly superior to the sph run .",
    "for the star cluster simulation presented here , lower numerical resolution could lead to somewhat smaller collapse timescales , because small - scale turbulent pressure support is weaker at lower resolution .",
    "we conclude that all these three effects may contribute to the slightly faster global collapse in the sph run compared to the flash run .",
    "figure  [ fig : smfs ] shows a comparison of the mass distributions of sink particles obtained in the flash and sph runs at @xmath206 , 0.9 , 1.0 and @xmath195 ( from top to bottom ) .",
    "the left panels show the histograms of sink particle mass , while the right panels show the cumulative mass distributions from which the kolmogorov - smirnov probability ( p - ks ) was determined with a ks test .",
    "the ks test provides an estimate of the probability that the mass distributions obtained in the flash and in the sph run were drawn from the same basic distribution , and it thus provides an estimate of their similarity .    figure  [ fig : smfs ] shows that at @xmath183 the ks probability is about 70% , which means that the mass distributions obtained in the flash and sph run are very likely drawn from the same distribution .",
    "the similarity in the number of particles formed and in the mass accreted onto sink particles taken together with the similarity in the location of sink particles at that time is encouraging .",
    "this is an important result , because it shows that two independent implementations of sink particle formation in two fundamentally different hydrodynamic codes give almost identical results for the number , mass and location of formed fragments .    at later times ,",
    "the ks probability drops to 55% , 40% and 8% at @xmath207 , 1.0 and @xmath195 , respectively .",
    "however , the general shape of the mass distributions obtained in the flash and sph runs is similar for all times ( although the relatively small number of sink particles does not allow for a detailed comparison of the slope at the high - mass end of the distributions ) .",
    "the peaks of the mass distributions agree well for @xmath208 .",
    "however , at @xmath191 the peak of the distribution is shifted to slightly higher masses in the sph run as a result of the faster global collapse in the sph run ( cf .  ",
    "[ sec : rad_profiles ] ) .",
    "the high - mass ends of the flash and sph mass distributions are roughly consistent with the @xcite power law , @xmath209 , as also found in previous sph studies",
    ". however , our statistical samples are not large enough to draw further quantitative conclusions on the slope of the high - mass end .",
    "it should also be noted that the low - mass end is probably affected by our assumption of an isothermal equation of state .",
    "our models did not take into account the effects of radiation transfer , which is expected to suppress fragmentation @xcite .",
    "however , the fact that our sink particle radius is about @xmath210 in this simulation does not allow any fragmentation below this scale .",
    "thus , we are more likely underestimating the amount of fragmentation , because we can not follow possible fragmentation on scales smaller than about @xmath210 .",
    "the fact that the ks probability becomes smaller at later times is a result of the faster global collapse in the sph run . to quantify this further , we compare the mass distributions at the times when the total mass of sink particles is roughly the same in the flash and sph runs .",
    "figure  [ fig : smfs_sfe ] shows the mass distribution of flash at @xmath191 together with the mass distribution of sph at @xmath211 ( about 5% earlier ) when the sink particle formation efficiency is about 26% in both runs .",
    "the mass distributions agree very well for similar sink formation efficiencies , which is indicated by a ks probability of 55% .",
    "moreover , the number of fragments is almost identical in the flash and sph run ( 49 versus 50 )",
    ". there is striking agreement between the sink particle properties obtained in our flash implementation and in the @xcite implementation for sph albeit the highly complex and chaotic nature of the problem modeled in this code comparison .",
    "the fact that two fundamentally different numerical schemes with complementary strengths and weaknesses give the same overall result is very encouraging .",
    "it strengthens our confidence in simulations of the turbulent collapse of clouds with amr on the one hand and sph on the other hand .",
    "we briefly mention the computational efficiency of our flash and sph runs .",
    "both codes were run in a mode of parallel computation on the same supercomputer ( hlrb - ii : sgi altix 4700 ) at the leibniz - rechenzentrum garching .",
    "the flash run consumed about 10,300 cpu hours and was run on 128 cpus .",
    "the sph run consumed roughly 2,400 cpu hours and was run on 16 cpus , which is 4 - 5 times faster than the flash run .",
    "the sph code automatically increases resolution in high - density regions , without the necessity to increase the number of resolution elements there , because the sph particles move in the lagrangian frame .",
    "it should be noted however that due to accretion of sph particles onto sink particles , the total number of sph particles decreases from the initial 2 million to about 1.3 million at @xmath191 .",
    "in contrast , the eulerian code flash refined the grid adaptively in high - density regions .",
    "the number of resolution elements ( grid cells ) thus increases from about 32 million at @xmath212 to 56 million at @xmath213 , which is a factor of about 30 more resolution elements on average in the flash run compared to the sph run .",
    "the computational cost per resolution element was thus a factor of 6 - 8 smaller for flash than for sph .",
    "this is roughly consistent with the difference in the average computational efficiency per resolution element measured for typical grid - based and particle - based hydrodynamic codes in the case of non - selfgravitating , supersonic turbulence ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "we introduced an implementation of accreting sink particles for the adaptive mesh refinement code flash .",
    "sink particles are used as a subgrid model to cut - off local runaway collapse in a controlled way to avoid artificial fragmentation and to avoid prohibitive small timesteps in numerical simulations involving multiple collapse regions . sink particles interact gravitationally with the gas and with one another , and can accrete bound gas .",
    "the gas must pass a series of checks prior to sink particle formation as explained in detail in ",
    "[ sec : creationchecks ] .",
    "in particular , in our grid - based implementation the gas considered for sink particle creation is not only required to exceed a given density threshold , but this gas must be gravitationally bound and collapsing at the same time , similar to the original sink particle implementation of @xcite for sph .",
    "figure  [ fig : coldens ] ( right panels ) shows that spurious sink particles would be created in the star cluster formation run discussed in  ",
    "[ sec : amrvssph ] , if a _",
    "density threshold was used to determine sink particle creation .",
    "the root cause of spurious sink particle creation is that the gas density can exceed the given density threshold in shocks that do not necessarily trigger gravitational collapse .",
    "figure  [ fig : coldens ] ( right versus left panels ) shows that the number of fragments would be overestimated by more than one order of magnitude , and that the star formation efficiency ( total gas mass accreted by sink particles ) would also be overestimated by 133% , 51% , 19% and 14% at @xmath214 and 1.1 , respectively , if the additional checks described in    [ sec : creationchecks ] are switched off .",
    "some sort of sink particle merging could be used to reduce the overestimated number of sink particles , but the mass accreted onto sink particles would still be overestimated if a sole density threshold was used for sink particle creation at densities below the opacity limit ( about @xmath7 ) .",
    "we performed a series of tests of our sink particle implementation in    [ sec : tests ] , including the time integration of circular and elliptical orbits , the collapse of a bonnor - ebert sphere , and a rotating cloud core fragmentation test .",
    "the sink particle accretion rate in the collapse of a singular isothermal sphere showed excellent agreement with the theoretical predictions of the @xcite model .",
    "those tests showed that the dynamical creation , gravitational interaction , motion , timestepping and accretion of sink particles works in a way that enables us to analyze the trajectories , accretion rates and mass distributions of collapsing fragments quantitatively and reliably in follow - up studies that will also include mhd effects .    a comparison calculation of star cluster formation between the sph code by @xcite and our grid - based flash implementation showed encouraging agreement of gas and",
    "sink particle properties obtained in the sph and flash runs ( cf .  ",
    "[ sec : amrvssph ] ) . using column density images",
    ", we demonstrated that sink particles are created at roughly the same locations and times in both codes .",
    "radial velocity profiles revealed that the global collapse in the sph run was about 5% faster than in the flash run , probably due to the slightly higher numerical dissipation in sph codes @xcite .",
    "after correction for this time lag , we showed that the number of sink particles and their mass distributions in the flash and sph runs are in very good agreement .",
    "the agreement of our flash and sph runs is an encouraging result that strengthens our confidence in numerical simulations of gravoturbulent cloud fragmentation and collapse with amr and sph .",
    "cf thanks daniel price for useful discussions on the gravitational softening and time integration schemes for sink particles during his visit at monash university under the go8/daad joint research cooperation scheme .",
    "we thank the anonymous referee for an unbiased and detailed report , which helped to improve the paper .",
    "cf is grateful for financial support from the international max planck research school for astronomy and cosmic physics ( imprs - a ) and the heidelberg graduate school of fundamental physics ( hgsfp ) , which is funded by the excellence initiative of the deutsche forschungsgemeinschaft ( dfg ) gsc 129/1 .",
    "rb is grateful to the dfg , which funds his emmy noether grant ba 3607/1 - 1 .",
    "rb is also thankful for subsidies from the frontier initiative of the university of heidelberg .",
    "pcc acknowledges support from the dfg under the emmy noether grant kl 1358/1 and the priority program sfb 439 ` galaxies in the early universe ' .",
    "rsk thanks for financial resources provided by the dfg under grants no .",
    "kl 1358/1 , kl 1358/4 , kl 1359/5 .",
    "rsk furthermore thanks for subsidies from the frontier grant of heidelberg university sponsored by the german excellence initiative and for support from the landesstiftung baden - wrttemberg via their program international collaboration ii under grant p - ls - spii/18 .",
    "all authors acknowledge financial support from the german bundesministerium fr bildung und forschung via the astronet project star format ( grant 05a09vha ) .",
    "the flash and sph simulations used computational resources from the hlrb ii project grant pr32lo at the leibniz rechenzentrum garching and from the caspur project grant .",
    "the test simulations were partly run on the gpu cluster kolob at the university of heidelberg .",
    "figure  [ fig : orbit_sis_amr ] was produced with the visualization tool visit .",
    "the flash code was developed in part by the doe - supported alliances center for astrophysical thermonuclear flashes ( asc ) at the university of chicago .",
    "97 natexlab#1#1    , o. , moore , b. , stadel , j. , potter , d. , miniati , f. , read , j. , mayer , l. , gawryszczak , a. , kravtsov , a. , nordlund ,  . , pearce , f. , quilis , v. , rudd , d. , springel , v. , stone , j. , tasker , e. , teyssier , r. , wadsley , j. , & walder , r. 2007 , , 380 , 963    , y. , herbst , e. , roberts , h. , & caselli , p. 2005",
    ", , 620 , 330    , r. , pudritz , r.  e. , & holmes , l. 2004 , , 355 , 248    , r. , vzquez - semadeni , e. , hennebelle , p. , & klessen , r.  s. 2009 , , 398 , 1082    , m.  r. 2009 , , 392 , 1363    , m.  r. , bonnell , i.  a. , & bromm , v. 2003 , , 339 , 577    , m.  r. , bonnell , i.  a. , & price , n.  m. 1995 , , 277 , 362    , m.  r. , & burkert , a. 1997 , , 288 , 1060    , w. 1988 , computer physics communications , 48 , 97    , w. 1990 , in numerical modelling of nonlinear stellar pulsations problems and prospects , ed . j.  r. buchler , 269    , w. , cameron , a.  g.  w. , press , w.  h. , & bowers , r.  l. 1990 , , 348 , 647    , m.  j. , & colella , p. 1989",
    ", journal of computational physics , 82 , 64    , p. , & boss , a.  p. 1981",
    ", , 197 , 477    , i.  a. , & bate , m.  r. 2006 , , 370 , 488    , i.  a. , bate , m.  r. , & vine , s.  g. 2003 , , 343 , 413    , w.  b. 1956 , , 116 , 351    , a.  p. , & bodenheimer , p. 1979",
    ", , 234 , 289    , f. , klingenberg , c. , & waagan , k. 2007 , numerische mathematik , 108 , 7    . 2009 , numerische mathematik , accepted    , a. 2010 , , 401 , 347    , a. , bate , m.  r. , & bodenheimer , p. 1997",
    ", , 289 , 497    , a. , & bodenheimer , p. 1993",
    ", , 264 , 798    , a.  c. , fryxell , b. , plewa , t. , rosner , r. , dursi , l.  j. , weirs , v.  g. , dupont , t. , robey , h.  f. , kane , j.  o. , remington , b.  a. , drake , r.  p. , dimonte , g. , zingale , m. , timmes , f.  x. , olson , k. , ricker , p. , macneice , p. , & tufo , h.  m. 2002 , , 143 , 201    , g. 2003 , , 115 , 763    , p.  c. , bonnell , i.  a. , & klessen , r.  s. 2008 , , 386 , 3    , p. , & woodward , p.  r. 1984 , journal of computational physics , 54 , 174    , b. , hennebelle , p. , audit , e. , chabrier , g. , & teyssier , r. 2008 , , 482 , 371    , r. , friedrichs , k. , & lewy , h. 1928 , mathematische annalen , 100 , 32    , g. , youngs , d.  l. , dimits , a. , weber , s. , marinak , m. , wunsch , s. , garasi , c. , robinson , a. , andrews , m.  j. , ramaprabhu , p. , calder , a.  c. , fryxell , b. , biello , j. , dursi , l. , macneice , p. , olson , k. , ricker , p. , rosner , r. , timmes , f. , tufo , h. , young , y .- n . , & zingale , m. 2004 , physics of fluids , 16 , 1668    , a. , fisher , r. , graziani , c. , jordan , iv , g.  c. , lamb , d.  q. , reid , l.  b. , rich , p. , sheeler , d. , townsley , d. , & weide , k. 2008 , in astronomical society of the pacific conference series , vol .",
    "385 , numerical modeling of space plasma flows , ed .",
    "n.  v. pogorelov , e.  audit , & g.  p. zank , 145    , d.  f. , & pudritz , r.  e. 2008 , , 391 , 1659    , r. 1955 , zeitschrift fr astrophysik , 37 , 217    , b.  g. , & falgarone , e. 1996 , , 471 , 816    , b.  g. , & scalo , j. 2004 , , 42 , 211    , e. , puget , j .- l . , & perault , m. 1992 , , 257 , 715    , c. , klessen , r.  s. , & schmidt , w. 2008 , , 688 , l79    . 2009 , , 692 , 364    , c. , roman - duval , j. , klessen , r.  s. , schmidt , w. , & mac low , m .- m .",
    "2009 , , in press ( arxiv:0905.1060 )    , p.  n. , & chevalier , r.  a. 1993 , , 416 , 303    , b. , olson , k. , ricker , p. , timmes , f.  x. , zingale , m. , lamb , d.  q. , macneice , p. , rosner , r. , truran , j.  w. , & tufo , h. 2000 , , 131 , 273    , r.  a. , & monaghan , j.  j. 1977 , , 181 , 375    . 1983 , , 204 , 715    , a.  a. , pineda , j.  e. , & schnee , s.  l. 2009 , , 692 , 91    , k. , ricker , p.  m. , warren , m.  s. , & habib , s. 2005 , , 160 , 28    , f. , mac low , m .- m .",
    ", & klessen , r.  s. 2001 , , 547 , 280    , p. , & chabrier , g. 2008 , , 684 , 395    . 2009 , , 702 , 1428    , l. , & katz , n. 1989 , , 70 , 419    , m.  h. , & brunt , c.  m. 2004 , , 615 , l45    , d.  a. , goodwin , s.  p. , & whitworth , a.  p. 2006 , , 450 , 881    , c. 1977 , , 218 , 834    , a .- k . , klessen , r.  s. , larson , r.  b. , li , y. , & mac low , m .-",
    "2005 , , 435 , 611    , s. , federrath , c. , klessen , r.  s. , schmidt , w. , price , d.  j. , dursi , l.  j. , gritschneder , m. , walch , s. , piontek , r. , kim , j. , jappsen , a. , ciecielag , p. , & mac low , m. 2009 , , 508 , 541    , r.  s. 2001 , , 556 , 837    , r.  s. , burkert , a. , & bate , m.  r. 1998 , , 501 , l205    , r.  s. , heitsch , f. , & mac low , m .-",
    "2000 , , 535 , 887    , c. , schmidt , w. , & waagan , k. 2007 , journal of computational physics , 227 , 12    , p. 2001",
    ", , 322 , 231    , m.  r. , & bonnell , i.  a. 2007 , to be published in  structure formation in the universe ",
    "g.  chabrier , ( arxiv:0712.0828 )    , m.  r. , klein , r.  i. , & mckee , c.  f. 2007 , , 656 , 959    , m.  r. , mckee , c.  f. , & klein , r.  i. 2004 , , 611 , 399    , c.  j. , & lada , e.  a. 2003 , , 41 , 57    , r.  b. 1969 , , 145 , 271    . 1981 , , 194 , 809    . 2005 , , 359 , 211    , f. , & marsden , j.  e. 2005 , international journal for numerical methods in engineering , 63 , 455    , l.  b. 1977 , , 82 , 1013    , m .- m . , & klessen , r.  s. 2004 , reviews of modern physics , 76 , 125    , c.  f. , & ostriker , e.  c. 2007 , , 45 , 565    , j.  j. , & gingold , r.  a. 1983 , journal of computational physics , 52 , 374    , j.  j. , & lattanzio , j.  c. 1985 , , 149 , 135    , j.  f. , & white , s.  d.  m. 1993 , , 265 , 271    , s. , tomisaka , k. , & nakamura , f. 1999 , , 51 , 637    , p. , & nordlund ,  .",
    "2002 , , 576 , 870    , p. , & nordlund , a. 2009 , , submitted ( arxiv:0907.0248 )    , m.  v. 1969 , , 144 , 425    , w.  h. 1987 , in the use of supercomputers in stellar dynamics , ed .",
    "p.  hut & s.  l.  w. mcmillan , 267    , d.  j. 2010 , , 401 , 1475    , d.  j. , & bate , m.  r. 2008 , , 385 , 1820    , d.  j. , & federrath , c. 2010 , , submitted    , d.  j. , & monaghan , j.  j. 2007 , , 374 , 1347    , p.",
    "m. 2008 , , 176 , 293    , e.  e. 1955 , , 121 , 161    , n. , & alfaro , e.  j. 2009 , , 696 , 2086    , j. 1990 , in astrophysics and space science library , vol .",
    "162 , physical processes in fragmentation and star formation , ed .",
    "r.  capuzzo - dolcetta , c.  chiosi , & a.  di fazio , 151176    , j. , & elmegreen , b.  g. 2004 , , 42 , 275    , s. , & klessen , r.  s. 2004 , , 419 , 405    , w. , federrath , c. , hupp , m. , kern , s. , & niemeyer , j.  c. 2009 , , 494 , 127    , f.  h. 1977 , , 214 , 488    , e.  j. , brunino , r. , mitchell , n.  l. , michielsen , d. , hopton , s. , pearce , f.  r. , bryan , g.  l. , & theuns , t. 2008 , , 390 , 1267    , j.  k. , klein , r.  i. , mckee , c.  f. , holliman , ii , j.  h. , howell , l.  h. , & greenough , j.  a. 1997 , , 489 , l179    , e. 1994 , , 423 , 681    , k. 2009 , journal of computational physics , 228 , 8609    , p. , li , z. , abel , t. , & nakamura , f. 2010 , , 709 , 27    , a. , & summers , d. 1985 , , 214 , 1    , a.  p. 1998",
    ", , 296 , 442    , h. , & yorke , h.  w. 2007 , , 45 , 481",
    "cubic spline softening ( see * ? ? ?",
    "* ; * ? ? ?",
    "* ) is used to soften the gravitational accelerations @xmath215 between sink particles and gas and among sink particles : @xmath216\\,\\frac{{{\\mathbf{r}}}}{r } & \\quad\\mbox{for}\\quad 0\\leq\\frac{r}{{r_\\mathrm{soft}}}<\\frac{1}{2 } \\\\",
    "\\frac{4}{{r_\\mathrm{soft}}^2}\\left[\\frac{16}{3}\\left(\\frac{r}{{r_\\mathrm{soft}}}\\right)-12\\left(\\frac{r}{{r_\\mathrm{soft}}}\\right)^2+\\frac{48}{5}\\left(\\frac{r}{{r_\\mathrm{soft}}}\\right)^3-\\frac{8}{3}\\left(\\frac{r}{{r_\\mathrm{soft}}}\\right)^4-\\frac{1}{60}\\left(\\frac{{r_\\mathrm{soft}}}{r}\\right)^2\\right]\\,\\frac{{{\\mathbf{r}}}}{r } & \\quad\\mbox{for}\\quad \\frac{1}{2}\\leq\\frac{r}{{r_\\mathrm{soft}}}<1 \\\\",
    "\\frac{{{\\mathbf{r}}}}{r^3 } & \\quad\\mbox{for}\\quad r \\geq { r_\\mathrm{soft}}\\ ; , \\\\     \\end{array } \\right.\\ ] ] where @xmath217 and @xmath49 is the softening radius .",
    "see figure  [ fig : softening ] for a graphical representation of this type of softening compared to plummer softening and compared to newton s acceleration of a point mass .",
    "we briefly discuss the conservation laws during accretion of gas onto sink particles .",
    "the index @xmath218 can be used to denote both the multiple gas portions to be accreted and the sink particle onto which these gas portions are being accreted within a single accretion step .",
    "thus , mass and linear momentum conservation during accretion or merging of sink particles are given by the following equations : @xmath219 @xmath220 the last equation determines the center of mass velocity @xmath221 to conserve linear momentum during an accretion or merging step .",
    "however , if these two conservation laws apply , then angular momentum conservation is generally broken in the process of accretion . to see that , consider the angular momentum before the accretion process @xmath222 the angular momentum",
    "after accretion is @xmath223 to fulfill angular momentum conservation @xmath224 , the following equation needs to be solved for the position @xmath225 of the accreted gas plus sink particle : @xmath226 however , this equality _ can not _ be fulfilled in the general case , because @xmath227 and @xmath221 are generally _ not _ orthogonal .",
    "thus , it is impossible to construct a position vector @xmath225 , such that angular momentum conservation holds . furthermore , if @xmath225 is given by the center of mass @xmath228 angular momentum conservation is also typically broken , because eq .  ( [ eq : ang_mom_conserve ] )",
    "does not generally hold true .",
    "this is the case for any implementation of accreting sink particles .",
    "the only way to restore angular momentum conservation is to introduce an intrinsic angular momentum ( spin ) for each sink particle ( see * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "this spin compensates the deviation from global angular momentum conservation caused by accretion or merging of sink particles .",
    "it can also be used to determine the axis along which a bipolar outflow or jet would be launched in a subgrid model of stellar feedback ."
  ],
  "abstract_text": [
    "<S> star formation is such a complex process that accurate numerical tools are needed to quantitatively examine the mass distribution and accretion of fragments in collapsing , turbulent , magnetized gas clouds . to enable a numerical treatment of this regime , we implemented sink particles in the adaptive mesh refinement ( amr ) hydrodynamics code flash . </S>",
    "<S> sink particles are created in regions of local gravitational collapse , and their trajectories and accretion can be followed over many dynamical times . we perform a series of tests including the time integration of circular and elliptical orbits , the collapse of a bonnor - ebert sphere and a rotating , fragmenting cloud core . we compare the collapse of a highly unstable singular isothermal sphere to the theory by shu ( 1977 ) , and show that the sink particle accretion rate is in excellent agreement with the theoretical prediction .    to model eccentric orbits and close encounters of sink particles accurately , we show that a very small timestep is often required , for which we implemented subcycling of the @xmath0-body system . </S>",
    "<S> we emphasize that a sole density threshold for sink particle creation is insufficient in supersonic flows , if the density threshold is below the opacity limit . in that case </S>",
    "<S> , the density can exceed the threshold in strong shocks that do not necessarily lead to local collapse . </S>",
    "<S> additional checks for bound state , gravitational potential minimum , jeans instability and converging flows are absolutely necessary for a meaningful creation of sink particles .    </S>",
    "<S> we apply our new sink particle module for flash to the formation of a stellar cluster , and compare to a smoothed particle hydrodynamics ( sph ) code with sink particles . </S>",
    "<S> our comparison shows encouraging agreement of gas properties , indicated by column density distributions and radial profiles , and of sink particle formation times and positions . </S>",
    "<S> we find excellent agreement in the number of sink particles formed , and in their accretion and mass distributions . </S>"
  ]
}