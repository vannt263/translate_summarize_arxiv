{
  "article_text": [
    "molecular dynamics ( md ) simulations are widely used to study spatially inhomogeneous soft matter systems . in such simulations , it is often necessary to compute the local pressure in a small region of the simulation box , containing only a few atoms or molecules .",
    "examples include calculations of interfacial free energies @xcite , measurements of osmotic pressure gradients @xcite and tests of coarse - grained hydrodynamic theories @xcite .",
    "while accurate expressions for the local pressure exist , their derivation is rather involved . in this paper",
    ", we present a much simpler derivation , which leads to two equivalent expressions for the local pressure .",
    "one of these expressions is analogous to the local stress tensor of lutsko @xcite and cormier _ et al .",
    "_ @xcite ; the other is , to our knowledge , new , but is similar in spirit to the `` method of planes '' of irving and kirkwood @xcite and todd _ et al .",
    "we show that both these expressions give accurate results for the local pressure in soft matter systems , even when computed over very small spatial regions .",
    "for a spatially homogeneous , closed system , the pressure is commonly computed by taking the average of an instantaneous `` pressure function '' : @xmath0 where @xmath1 , @xmath2 and @xmath3 are the number of particles , volume and temperature , @xmath4 is boltzmann s constant , @xmath5 and @xmath6 are the positions of particles @xmath7 and @xmath8 , @xmath9 , and @xmath10 denotes the force exerted on particle @xmath7 by particle @xmath8 @xcite ; the double sum runs over all pairs of particles , avoiding double counting . the first and second terms in eq.([eq : virialp ] ) arise from the kinetic energy of the particles and from interparticle interactions , respectively",
    ". expression ( [ eq : virialp ] ) can be derived in a few steps starting from the clausius virial relation @xmath11 in which @xmath12 and @xmath13 are the momentum and mass of particle @xmath7 , and @xmath14 is the total force acting on particle @xmath7 , due to other particles and the walls of the container @xcite .    for spatially inhomogeneous systems , one can measure directly the pressure across a local plane within the simulation box via the `` method of planes '' ( mop ) , first proposed by irving and kirkwood @xcite and later rederived by todd _ et al .",
    "_ @xcite ; this works well when the plane over which the pressure is computed is large , but leads to poor statistical sampling when computing the local pressure in a small region ( i.e. over a small plane ) .",
    "alternatively , the pressure in a local region of interest can be measured using a local version of eq.([eq : virialp ] ) .",
    "this has the advantage that the region of interest can ( in principle ) be of arbitrary shape , and that statistical averages are taken over a volume rather than an area .",
    "the following local pressure function was proposed by lutsko @xcite and later reformulated by cormier _",
    "@xcite ( note that these authors considered the full stress tensor , while , for simplicity , we focus only on the scalar pressure , which we assume to be locally isotropic ) : @xmath15 here , @xmath16 is the volume of the region of interest , centred on @xmath17 , @xmath18 is unity if particle @xmath7 lies within the volume @xmath16 , and zero otherwise , and @xmath19 is the fraction ( @xmath20 ) of the line joining particles @xmath7 and @xmath8 that lies within @xmath16 ( see figure [ fig : lijfraction ] ) .",
    "the local pressure expression ( [ eq : cormierstress ] ) is analogous to the global one ( [ eq : virialp ] ) , but with two important differences .",
    "firstly , in the kinetic part of eq.([eq : cormierstress ] ) , only those particles which are inside the region of interest ( at time @xmath21 ) are included .",
    "secondly , the components of the interaction term are weighted by the fraction of the line joining particles @xmath7 and @xmath8 that is inside the region of interest ; this highlights the crucial importance of correctly accounting for interparticle interactions which cross the boundary of the region of interest .",
    "note that particles @xmath7 and @xmath8 may both be outside the region yet still contribute to the interaction pressure ; see figure [ fig : lijfraction ] .    both lutsko @xcite and cormier _ et al . _",
    "@xcite derive the stress tensor version of eq.([eq : cormierstress ] ) by fourier transforming the continuity equation for the local momentum flux and applying newton s second law . in this paper",
    ", we present a simpler and arguably more intuitive , real space derivation , which is directly analogous to the derivation of the global pressure expression , eq.([eq : virialp ] ) , from the clausius virial relation ( [ eq : clausius ] ) .",
    "this derivation leads both to eq.([eq : cormierstress ] ) and to a new expression for the local pressure involving the flux of particle momentum across the boundaries of the region of interest , together with cross - boundary interactions .",
    "the equivalence between these two expressions shows directly how the relation between surface flux and volume pressure measurements extends to the atomic scale .",
    "our approach may also prove useful in future for deriving local pressure expressions for systems with different dynamical rules , such as run - and - tumble swimmers @xcite or particles with viscous dynamics @xcite .",
    "to compute the local pressure at some position @xmath17 in the system , we consider a local region of fluid , of volume @xmath16 , centred on @xmath17 .",
    "particles within this region interact with other particles both inside and outside the region . during a given time interval , particles will enter and leave the region of interest .",
    "we begin with an analogue of the clausius virial relation ( [ eq : clausius ] ) , derived by schweitz , for open systems @xcite .",
    "the schweitz virial relation states that @xmath22 where , as above , the function @xmath23 measures whether or not particle @xmath7 is within the region of interest at time @xmath21 , and its time derivative @xmath24 produces a positive or negative @xmath25-function peak at the moment when particle @xmath7 enters or leaves the region of interest . ) , can be derived by setting the time derivative of the function @xmath26 to zero in steady state . for open systems ,",
    "the derivation of the schweitz virial relation follows a similar route , but takes into account the contributions to @xmath27 from particles entering and leaving the system @xcite . ] the first term in eq.([eq : schweitz ] ) , @xmath28 , is the average kinetic energy of particles in the region of interest and is directly analogous to the first term in eq.([eq : clausius ] ) .",
    "the second , interaction , term is analogous to the second term in eq.([eq : clausius ] )  we assume that there are no external forces so the total force on particle @xmath7 is given by the sum of interactions with all other particles in the system . the final term in eq.([eq : schweitz ] ) , @xmath29 , accounts for the exchange of particles between the region of interest and its surroundings .",
    "particles entering the region contribute @xmath30 while those leaving contribute @xmath31 ; these do not cancel because the momentum vectors @xmath32 for particles entering and leaving are opposite in sign .",
    "we now split the second term in eq.([eq : schweitz ] ) into contributions due to interactions with particles inside and outside the region of interest : @xmath33 where @xmath34 , since @xmath35 @xcite .",
    "we have also introduced a new notation : @xmath36 .",
    "likewise , we define @xmath37 and @xmath38 $ ]",
    ". ] contains contributions where both particles are inside the region of interest and @xmath39 contains contributions where particle @xmath7 is inside the region and particle @xmath8 is outside .",
    "substituting eq.([eq : split ] ) into eq.([eq : schweitz ] ) allows us to write the schweitz virial relation as @xmath40      we next use the schweitz virial relation to derive expressions for the local pressure .",
    "the local pressure has two components : a kinetic component , @xmath41 , which is given by the normal flux of particle momentum across the boundaries of the region of interest and an interaction component , @xmath42 , which is the surface density of interparticle forces across the boundary . throughout this paper",
    "the normal to the boundary is assumed to point in the outward direction .",
    "the kinetic component of the local pressure can be related to the component @xmath43 of the schweitz virial relation . to see this ,",
    "we split the particle momentum , @xmath32 , into its components normal and tangential to the boundary : @xmath44 , to give @xmath45\\right\\rangle .\\ ] ] assuming that the density of particles is uniform across the region of interest , the second term in eq.([eq : kin1 ] ) averages to zero .",
    "next , we notice that because @xmath46 is nonzero only when a particle is at the boundary , @xmath47 may be taken outside the summation . assuming ( without loss of generality ) that the region of interest is cubic with the origin at its centre and sides of length @xmath48 , @xmath49 , and the total ( outward ) momentum flux @xmath50 across each of the 6 faces is @xmath51 .",
    "eq.([eq : kin1 ] ) therefore reduces to @xmath52      in a similar way , the interaction component of the local pressure , @xmath42 , can be related to the component @xmath53 of the schweitz virial relation .",
    "we first note that the position vector @xmath5 may be written as @xmath54 , where @xmath55 denotes the position where the line linking particles @xmath7 and @xmath8 crosses the boundary of the region of interest , and @xmath19 is the fraction of the line linking particles @xmath7 and @xmath8 that lies inside the region of interest ( see figure [ fig : lijfraction ] ) .",
    "@xmath53 is then given by @xmath56 where the second line follows from splitting the interparticle force @xmath10 into its components normal and tangential to the boundary : @xmath57 , and @xmath58 .",
    "focusing on the first term , we note that @xmath55 points to the boundary and so ( assuming the same cubic geometry as above ) , @xmath59 . denoting as @xmath60 the average outward normal force per unit area crossing the boundary , due to the @xmath61 interactions , we obtain @xmath62 the interaction component of the pressure , @xmath42 , is equal to the _ total _ surface density of normal force crossing the boundary : @xmath63 , where @xmath64 is the normal contribution due to pairs of particles @xmath7 and @xmath8 which are both outside the region of interest ( see figure [ fig : lijfraction ] ) .",
    "we demonstrate in the appendix that    @xmath65    so that , putting together eqs([eq : schweitz2c])-([eq : xi ] ) , we can relate @xmath66 to @xmath53 by : @xmath67 where @xmath68      an expression for the local pressure , @xmath69 , can be obtained by combining eqs.([eq : kin2 ] ) and ( [ eq : schweitz3 ] ) : @xmath70\\\\\\nonumber & = &    -\\frac{1}{3\\omega}\\left[\\left \\langle \\sum_{i=1}^n \\left(\\vec r_i \\cdot \\vec p_i\\right ) \\dot{\\lambda_i } +   \\sum_{\\mathrm{in\\,out}}\\left(\\vec r_i   - l_{ij } \\vec r_{ij } \\right ) \\cdot \\vec f_{ij } - \\sum_{\\mathrm{out\\,out } } l_{ij } \\vec r_{ij } \\cdot \\vec f_{ij } \\right \\rangle\\right].\\end{aligned}\\ ] ] eq.([eq : res1 ] ) provides a simple prescription for computing the local pressure .",
    "the first term sums over all particles which enter or leave the region of interest and is equivalent to the momentum flux density due to particles crossing the boundary , while the remaining terms , which account for the force density at the boundary due to interparticle interactions , sum over all pairs of particles for which the line connecting the two particles crosses the boundary of the region of interest . in the case where the region of interest is large ,",
    "@xmath71 is dominated by the contributions of @xmath72 and @xmath53 ( @xmath73 becomes negligible ) ; however , as we show below in figure [ fig : opensystem ] , @xmath73 makes an important contribution when the region of interest is small .",
    "eq.([eq : res1 ] ) provides an alternative to existing local pressure expressions , and demonstrates explicitly how the relation between surface flux and volume pressure expressions extends to very small regions of space .",
    "the schweitz virial relation provides a direct route from this `` boundary '' expression to the more usual expression for the local pressure , which involves a sum over particles _ within _ the region of interest .",
    "inserting eq.([eq : res1 ] ) into the schweitz relation ( [ eq : schweitz2 ] ) , we obtain : @xmath74\\\\\\nonumber & = &    \\frac{1}{3\\omega}\\left \\langle \\sum_{i=1}^n \\frac { |\\vec p_i|^2 } { m_i } \\lambda_i(\\vec r ) + \\sum_{\\mathrm{in\\,in } }   \\vec r_{ij } \\cdot \\vec f_{ij } + \\sum_{\\mathrm{in\\,out } }   l_{ij}\\left(\\vec r_{ij } \\cdot \\vec f_{ij } \\right ) + \\sum_{\\mathrm{out\\,out } }   l_{ij}\\left(\\vec r_{ij } \\cdot \\vec f_{ij } \\right ) \\right \\rangle\\\\\\nonumber & = &    \\frac{1}{3\\omega}\\left \\langle \\sum_{i=1}^n \\frac { |\\vec p_i|^2 } { m_i } \\lambda_i(\\vec r ) + \\sum_{i } \\sum_{j > i } l_{ij}\\left ( \\vec r_{ij } \\cdot \\vec f_{ij}\\right )   \\right \\rangle,\\end{aligned}\\ ] ] where the last line follows from the fact that @xmath75 if both particles are inside the region of interest ( assuming the boundary is everywhere concave ) .",
    "eq.([eq : res2 ] ) is identical to eq.([eq : cormierstress ] ) , and constitutes a local version of the global instantaneous pressure function , eq.([eq : virialp ] ) .",
    "we now illustrate , using molecular dynamics simulations , the schweitz virial relation ( [ eq : schweitz2 ] ) as well as the two expressions for the local pressure , eqs.([eq : res1 ] ) and ( [ eq : res2 ] ) . in our simulations ,",
    "a periodic box contains 5000 particles at a density @xmath76 ( reduced units @xcite ) , which interact via a repulsive weeks , chandler , andersen ( wca ) potential @xcite ( a truncated and shifted lennard - jones potential ) . the particle size @xmath77 , the interaction parameter @xmath78 ( both in reduced units ) and the box length is @xmath79 .",
    "the system is simulated using the velocity verlet algorithm @xcite with timestep @xmath80 ( reduced units ) and is maintained in the canonical ( nvt ) ensemble using a nos - hoover thermostat at temperature , @xmath81 ( reduced units ) .",
    "all runs are equilibrated for @xmath82 timesteps prior to data collection , and data is collected over at least @xmath83 timesteps .",
    "errors are computed using bootstrapping @xcite , with 1000 replica datasets .",
    "we first consider a homogeneous fluid , for which the local pressure , measured using eqs.([eq : res1 ] ) and ( [ eq : res2 ] ) , should match the global pressure , measured using eq.([eq : virialp ] ) .",
    "we define a cubic region of interest , located in the centre of our simulation box , whose size @xmath48 we vary from @xmath84 to @xmath85 . for this smallest value of @xmath48",
    ", the region of interest contains only @xmath86 particles on average .",
    "figure [ fig : opensystem]a shows @xmath87 as a function of the size @xmath48 of the region of interest . as predicted by the schweitz virial relation ( [ eq : schweitz2 ] ) , this quantity is zero within our error bars ( note that of the individual terms in this sum , two are @xmath88 5 and the other two are @xmath88 0.8 ) .",
    "figure [ fig : opensystem]b shows the local pressure @xmath69 in the region of interest , computed using expressions ( [ eq : res1 ] ) and ( [ eq : res2 ] ) , as a function of @xmath48 .",
    "both expressions give results in excellent agreement with the global pressure across the whole simulation box , using eq.([eq : virialp ] ) .",
    "the inset to figure [ fig : opensystem]b , which shows eq.([eq : res2 ] ) , neglecting the @xmath73 term , demonstrates the importance of correctly accounting for the boundary terms : neglecting @xmath73 gives a large error , which increases as @xmath48 decreases .",
    "we next consider an osmotic system , in which the local pressure differs in different parts of the simulation box . to construct this system",
    "we label a subset @xmath89 of the particles `` solute '' and the remaining particles `` solvent '' .",
    "solute particles are confined to a cubic region of volume @xmath90 in the center of the simulation box by a smooth confining potential ; solvent particles do not experience this potential and are free to move throughout the simulation box .",
    "the confining potential acts as a semi - permeable membrane , resulting in an osmotic pressure difference , @xmath91 , between the `` solution '' region where the solutes are confined and the rest of the simulation box . to compute the osmotic pressure ,",
    "we define local regions of interest inside and outside the solution compartment ( for dimensions see the caption of figure [ fig : osmotic ] ) .",
    "figure [ fig : osmotic]a shows that the schweitz virial relation ( [ eq : schweitz2 ] ) is obeyed in both of these local regions , over a range of solute concentrations .",
    "the pressure in the two local regions can be computed using eqs .",
    "( [ eq : res1 ] ) and ( [ eq : res2 ] ) ; subtracting the results gives the osmotic pressure difference , @xmath91 .",
    "figure [ fig : osmotic]b shows @xmath91 , as a function of the concentration @xmath92 of solute particles in the solution compartment ; both methods for computing the local pressure produce results in excellent agreement with a direct calculation of the osmotic pressure obtained by measuring the average confining force on the solutes , per unit area of the confining box .",
    "accurate methods for computing the local pressure are essential for simulating inhomogeneous soft matter systems . in this paper , we have derived two equivalent expressions for the local pressure in a molecular dynamics simulation .",
    "the `` boundary '' expression , eq.([eq : res1 ] ) , is , to our knowledge , new .",
    "this expression involves summation over interactions between particles within and outside the local region of interest and is similar in spirit to the `` method of planes '' approach of irving and kirkwood @xcite and of todd _ et al .",
    "the `` volume '' expression eq.([eq : res2 ] ) is a local analogue of the function commonly used to compute the global pressure in homogeneous simulations ; this involves summation over interactions between pairs of particles within the region of interest .",
    "this expression was previously derived via a fourier transform method by lutsko @xcite and by cormier _",
    "_ @xcite ; our derivation , based on the schweitz virial relation , provides a simple real - space alternative .",
    "importantly , both local pressure expressions take careful account of interactions close to the boundary : this is crucial when the region of interest is of the order of the particle size .",
    "the derivation presented in this paper , via the schweitz virial relation , demonstrates explicitly how the equivalence between surface flux and volume expressions for the pressure , familiar from macroscopic systems , plays out on very small ( atomistic ) lengthscales .",
    "this approach may also prove useful in future for deriving local pressure expressions in systems whose dynamics are more complex : for example systems with viscous dynamics @xcite , or active matter systems in which particles are self - propelled and/or chemotactic @xcite . here , the fourier transform method of lutsko and cormier _ et al .",
    "_ @xcite might prove challenging , but we hope that our real - space method should hold with only minor modifications .    finally , we note that an important assumption made in this work is that the local pressure is isotropic : we therefore derive expressions for the scalar pressure rather than the local pressure tensor , as in previous work @xcite .",
    "we believe that it should be possible to extend the present derivation to obtain the analogous expressions for the pressure tensor , via a tensor analogue of the schweitz virial relation . for the present , we leave this as an interesting avenue for future work .",
    "the authors thank mike cates , daan frenkel , davide marenduzzo and juan venegas - ortiz for useful discussions .",
    "tl was supported by an epsrc dta studentship ; rja was supported by a royal society university research fellowship .",
    "here , we discuss the contribution to the interaction component of the pressure made by pairs of particles @xmath7 and @xmath8 , in the cases where both particles are outside the region of interest , but ( as illustrated in figure [ fig : lijfraction ] ) , the line joining particles @xmath7 and @xmath8 crosses the boundary .",
    "our aim is to derive eq.([eq : xi ] ) . assuming that the region of interest is cubic ( with side length @xmath48 and origin at the centre ) , the line joining particles @xmath7 and @xmath8 crosses the boundary on two different faces .",
    "we define these crossing points by the position vectors @xmath93 and @xmath94 .",
    "figure [ fig : app]a illustrates that @xmath95 .",
    "this allows us to write @xmath96 we now resolve @xmath93 and @xmath94 into components normal and tangential to the boundary on faces 1 and 2 respectively [ @xmath97 etc ] .",
    "noting that @xmath98 , we obtain @xmath99 where @xmath64 is the ( outward ) normal force per unit area crossing the boundary due to particle pairs which are both outside the region of interest , @xmath100 and @xmath101 ( we use @xmath102 ) . assuming that particles are homogeneously distributed across the region of interest , @xmath103 ( by symmetry , see figure [ fig : app]a ) .",
    "we now demonstrate that @xmath104 , where @xmath105 , as defined in section [ sec : deriv ] , is the tangential component of the ( @xmath106 ) contribution to @xmath53 .",
    "we study the simplified one dimensional scenario shown in figure [ fig : app]b , in which we consider only particles @xmath7 and @xmath8 lying along two lines parallel to the @xmath107 axis .",
    "we further assume that interactions are restricted in range , such that each particle @xmath7 interacts with only two interaction partners @xmath8 , as shown in figure [ fig : app]b , with tangential forces @xmath108 in opposite directions .",
    "these interactions contribute respectively @xmath109 and @xmath110 to the sum @xmath111 .",
    "we now sum the contribution of the interactions shown in figure [ fig : app]b for the cases where particle @xmath7 is inside the region of interest ( @xmath112 ) and the line joining @xmath7 and @xmath8 crosses the top face of the region ",
    "i.e. the contributions to @xmath105 for this face .",
    "the result is @xmath113 , where @xmath114 is the number of particles @xmath7 per unit length along the line .",
    "for which ( @xmath115 ) have 2 partners and contribute @xmath116 ( case a in figure [ fig : app]b ) , particles for which @xmath117 have 1 partner and contribute @xmath118 while particles for which @xmath119 have 1 partner and contribute @xmath120 ( case b in figure [ fig : app]b ) ; these contributions are then integrated over @xmath121 : @xmath122 = f\\beta d(\\beta - l)$ ] . ]",
    "next , we sum the contributions for the cases where particle @xmath7 is _ outside _ the region of interest , but the line joining @xmath7 and @xmath8 still crosses the top face of the region ( i.e. the contributions to @xmath123 for this face ) .",
    "contributions @xmath124 are made by particles @xmath7 for which @xmath125 or @xmath126 ( case c in figure [ fig : app]b ) . integrating over these ranges of @xmath127",
    ", we obtain a total contribution to @xmath123 of @xmath128 .",
    "thus the contributions to the ( @xmath106 ) tangential term @xmath105 are exactly compensated by the contributions to the ( @xmath129 ) tangential term @xmath123 , and eq.([eq : app1 ] ) reduces to eq.([eq : xi ] ) ."
  ],
  "abstract_text": [
    "<S> computer simulations of inhomogeneous soft matter systems often require accurate methods for computing the local pressure . </S>",
    "<S> we present a simple derivation , based on the virial relation , of two equivalent expressions for the local ( atomistic ) pressure in a molecular dynamics simulation . </S>",
    "<S> one of these expressions , previously derived by other authors via a different route , involves summation over interactions between particles within the region of interest ; the other involves summation over interactions across the boundary of the region of interest . </S>",
    "<S> we illustrate our derivation using simulations of a simple osmotic system ; both expressions produce accurate results even when the region of interest over which the pressure is measured is very small . </S>"
  ]
}