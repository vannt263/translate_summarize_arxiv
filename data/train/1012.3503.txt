{
  "article_text": [
    "intense magnetic fields around sunspot regions drive the most energetic examples of solar activity  large solar flares and coronal mass ejections  which can produce hazardous space weather conditions close to earth .",
    "severe space weather storms present a variety of hazards including increased radiation levels for space travellers and crew on polar air flights , the risks of disabling of gps systems and damage to power grids @xcite , and potential large economic losses due to damage to communications satellites ( odenwald et al .",
    "these effects motivate a need to understand and model the source regions of space weather threats at the sun .",
    "spectro - polarimetric measurements of magnetically sensitive photospheric lines may be used to infer the vector magnetic field at the surface of the sun @xcite , and the resulting maps of the field are called vector magnetograms .",
    "a new generation of instrumentation is set to provide vector magnetogram data over the next solar cycle with unprecedented quality , resolution , and temporal cadence , including the solar optical telescope spectro - polarimeter ( sot / sp ) on the hinode spacecraft ( tsuneta et al .",
    "2008 ) and the helioseismic and magnetic imager on the solar dynamics observatory ( sdo / hmi ) @xcite . in principle",
    "these measurements provide boundary values for coronal magnetic field modeling , or ` magnetic field reconstruction ' .",
    "there is a pressing need for this modeling capability , which has many potential applications in solar research .",
    "however , studies have revealed basic difficulties preventing the construction of reliable coronal field models from vector magnetograms using present modeling techniques .",
    "specifically , a popular and well - developed approach to magnetic field reconstruction , nonlinear force - free modeling , has been shown to produce inconsistent results when applied to hinode / sot vector magnetogram data @xcite .",
    "different modeling codes produce different results based on the same data , and the results from individual codes are also internally inconsistent .",
    "as described in more detail in section  [ sec2 ] , vector magnetograms allow for two sets of boundary conditions for the force - free model , and the two solutions do not in general agree .",
    "it is also difficult to construct the solutions : the boundary conditions on electric current present large currents which prevent the force - free methods from converging strictly . as a result",
    "the ` solutions ' may be inaccurate with respect to the model .",
    "the modeling has been shown to be unable to provide a reliable estimate of the free magnetic energy of a solar active region .",
    "further details of the problems are provided in section  [ sec2 ] .",
    "one likely cause of the failure of nonlinear force - free modeling is a basic inconsistency between the boundary data and the model : the model includes only magnetic forces , an assumption that may be warranted in the corona , but which is thought not to apply at the photospheric level where the data originate @xcite .",
    "recently a new approach to coronal magnetic field reconstruction was presented to address this problem @xcite .",
    "the ` self - consistency ' procedure ( described in more detail in section  [ sec2 ] ) identifies a nonlinear force - free solution with boundary values close to those implied by the vector magnetogram data .",
    "the method constructs a single solution to the nonlinear force - free model which strictly converges .",
    "the solution does not match exactly the field at the photospheric level , but may describe the coronal magnetic field . in @xcite",
    "the method was demonstrated in application to hinode / sot data for noaa active region 10953 .",
    "a solution to the model was constructed with energy @xmath2 , where @xmath1 is the energy of the reference potential ( current - free ) magnetic field matching the boundary conditions on the vertical component of the field .",
    "the self - consistency procedure is capable of taking into account relative uncertainties in the solar boundary data , so that the boundary values for the solution match the vector magnetogram data more closely at points with small uncertainties .",
    "however , uncertainties were omitted from the @xcite calculations , and this omission accounts in part for the low value of the magnetic free energy of the constructed solution ( @xmath3 of the energy of the potential field ) , as explained in section  [ sec24 ] .",
    "for this reason the results in @xcite were argued to represent a ` proof in concept ' of the self - consistency procedure , rather than a full demonstration of its modeling capability . in this paper",
    "we return to the problem of modeling ar 10953 , including uncertainties in the calculation .",
    "the detailed presentation of this paper is as follows .",
    "section  [ sec2 ] provides a more detailed account of the background to the modeling presented here , incuding a summary of the nonlinear force - free model ( section  [ sec21 ] ) , a description of the failure of the model in application to solar data ( section  [ sec22 ] ) , and an account of the self - consistency procedure ( section  [ sec23 ] ) and its initial application to ar 10953 by @xcite ( section  [ sec24 ] ) .",
    "a reader familiar with the background may skim or omit section  [ sec2 ] , but it provides necessary background for a reader new to the topic .",
    "section  [ sec3 ] describes the modeling of ar 10953 taking into account uncertainties , with section  [ sec31 ] presenting the data , and section  [ sec32 ] the results of the modeling .",
    "section  [ sec4 ] discusses the results .",
    "magnetic fields in the corona are often described as being force free @xcite .",
    "the force - free model is static and includes only the magnetic ( lorentz ) force , an approximation justified by the low ratio of gas pressure to magnetic pressure likely to exist at most locations in the corona @xcite .",
    "a force - free magnetic field @xmath4 satisfies @xmath5 where @xmath6 is the force - free parameter .",
    "this parameter is constant along field lines , but varies ( in general ) from field line to field line , and the implicit dependence of @xmath6 on @xmath4 makes the model nonlinear .",
    "the boundary conditions required by the model are the normal component of @xmath4 in the boundary ( denoted @xmath7 ) , and a specification of @xmath8 over one polarity ( sign ) of @xmath7  ( e.g.  grad & rubin 1958 ; sakurai 1981 ; aly 1989 ; amari et al .",
    "we denote the two polarities @xmath9 ( positive ) and @xmath10 ( negative ) , for boundary points with @xmath11 and @xmath12 respectively ( assuming a normal directed into the coronal volume ) .",
    "the boundary condition on @xmath6 is equivalent to a specification of the normal component of the electric current density @xmath13 over either @xmath9 or @xmath10 , because @xmath14 in the model .",
    "a number of numerical methods of solution of the nonlinear force - free equations have been developed in the solar context [ for recent reviews see e.g.@xcite ] .",
    "most methods focus on the solution of the problem in a half space ( @xmath15 ) , with the lower boundary ( @xmath16 ) representing the photosphere , solar curvature being neglected .",
    "the different methods vary in terms of numerical methods and in the treatment of boundary conditions . some methods ",
    "e.g.  the optimization method @xcite  use the full vector magnetic field over both @xmath9 and @xmath10 in the lower boundary as a boundary condition .",
    "this is formally an over - prescription , but does not introduce a problem provided the boundary conditions are consistent with the model , as shown by application to test cases @xcite .",
    "methods based on the ` current - field iteration ' or grad - rubin procedure use the formally correct boundary conditions on @xmath6 described above .",
    "a grad - rubin implementation is the basis for the calculations in this paper @xcite .",
    "these methods work by replacing the nonlinear force - free equations by a sequence of iterations , such that at the @xmath17 iteration the linear equations @xmath18}\\cdot \\nabla \\alpha^{[i ] } = 0 \\quad \\mbox{and } \\quad \\nabla \\times { \\bf b}^{[i ] } = \\alpha^{[i ] } { \\bf b}^{[i-1]},\\ ] ] are solved for @xmath19}$ ] given @xmath20}$ ] , subject to @xmath21}=0 $ ] and the boundary conditions on @xmath22}$ ] and @xmath19}$ ] .",
    "for the half space problem the boundary conditions are the specification of @xmath23}$ ] at @xmath16 and @xmath22}$ ] at @xmath16 over either @xmath9 or @xmath10 .",
    "the iteration is usually started by setting @xmath24}$ ] equal to the reference potential ( current - free ) field matching the boundary conditions on @xmath25 .",
    "a fixed point of the iteration scheme specified by equations  ( [ eq : grad_rubin ] ) provides a solution to the nonlinear force - free equations  ( [ eq : force_free ] ) .",
    "although the nonlinear force - free methods work well in application to test cases @xcite and to synthetic solar - like data @xcite , the application to vector magnetogram data has revealed serious problems .",
    "tests of different methods using hinode / sot data for noaa active regions ar 10930 @xcite and ar 10953 @xcite produced very different solutions for each active region depending on the specific method used . in particular the estimated magnetic free energy of each active region varied substantially among the solutions , preventing reliable determination of this quantity",
    ". perhaps worse , the solutions from particular methods were also found to be internally inconsistent .",
    "for example , for the grad - rubin methods the vector magnetogram data provide both the @xmath9 and @xmath10 choices for the boundary conditions on the force - free parameter .",
    "specifically , @xmath6 may be estimated from the data at the photosphere ( @xmath16 ) by calculating the gradients in the observationally - inferred transverse fields @xmath26 and @xmath27 according to @xmath28 and these values are available over both @xmath9 and @xmath10 .",
    "the @xmath9 and @xmath10 solutions obtained by applying the wheatland ( 2007 ) current - field iteration method to the data for active regions ar 10930 and ar 10953 were found to be very different @xcite .",
    "it is likely that a number of factors contribute to the failure of the modeling .",
    "vector magnetogram field values are approximate due to resolution limitations , modeling assumptions , and photon noise in the polarization measurements .",
    "assumptions made in the inference of the field from the stokes spectral measurements @xcite , for example using a milne - eddington atmosphere , introduce inaccuracy  . the values are also uncertain due to the influence of instrumental noise and resolution limitations on the polarization measurements .",
    "the component of the magnetic field transverse to the line of sight is particularly uncertain due to the intrinsically smaller linear polarization signal relative to the integrated intensity , magneto - optical effects @xcite , and the need to resolve an intrinsic 180-degree ambiguity in the azimuthal direction of the field @xcite .",
    "a problem with the force - free modeling is that different methods of solving the equations  ( [ eq : force_free ] ) make different assumptions regarding the problem of the ` missing ' boundary conditions at the sides and top boundaries of the computational domain .",
    "these different assumptions lead ( not surprisingly ) to different results @xcite .",
    "however , the modeling also faces a more fundamental difficulty : the magnetic field at the height of the measurements is unlikely to be force free because the dense photospheric gas is subject to pressure , gravity , and dynamical forces in addition to the magnetic forces @xcite .",
    "the boundary data are fundamentally inconsistent with the model .",
    "the accuracy of the force - free assumption for the boundary data may be checked a priori by calculating integrals of the field in the boundary representing the net magnetic flux , the net force and the torque on the field in @xmath15 @xcite .",
    "the requirement that these integrals vanish provides a set of necessary conditions for the existence of a force - free solution for given boundary data . in general the integrals",
    "are found to be substantially different from zero for photospheric vector magnetogram data .",
    "one treatment of this problem is a procedure called ` preprocessing , ' whereby the boundary data are varied to minimize the integrals , subject to constraints @xcite .",
    "preprocessing has been found to improve nonlinear force - free reconstructions from synthetic solar data for some methods @xcite , and preprocessed data were used in the modeling of active regions ar 10930 and ar 10953 presented by @xcite and @xcite respectively . however , there are non - trivial problems with the preprocessing approach .",
    "first , the conditions being minimized are necessary but not sufficient , so there is an arbitrary number of such constraints @xcite . the minimization procedure will not satisfy all such constraints , and it is straightforward to show that preprocessed boundary data are still inconsistent with the force - free model @xcite . as a result , the @xmath9 and @xmath10 solutions constructed by grad - rubin methods still disagree , and ` force - free solutions ' constructed using other methods , e.g.  the optimization method @xcite must be internally inconsistent with the force - free model . the situation is then that the observed boundary data is not matched by the ` solution , ' and the force - free model is not being accurately solved .",
    "a second problem is that preprocessing typically involves a smoothing of the data , which is undesirable because it discards information .",
    "recently , another solution was proposed , in which a vector field is calculated which attempts to simultaneously minimize the lorentz force , the divergence , and the departure from observed boundary conditions , using an optimization - like procedure .",
    "however , this method also fails to adhere to the force - free equations or retain ( to within measurement uncertainties ) the observed boundary data .",
    "a related problem with solar nonlinear force - free modeling is that the boundary conditions on the vertical electric current density @xmath29 corresponding to vector - magnetogram derived values of @xmath6 include very large electric currents .",
    "the values of the current density are considerably uncertain because of the uncertainties in the field determinations discussed above , and there is also dependence of the values on the observational spatial resolution , which changes when field values are interpolated onto new grids and rebinned @xcite .",
    "nevertheless there appear to be electric currents sufficiently large to be inconsistent with the force - free model , which prevent strict convergence of nonlinear force - free methods @xcite .",
    "the @xcite method is often found to reach a state where the field configuration exhibits slow oscillation as a function of grad - rubin iteration number rather than achieving a fixed state .",
    "the energy of the solution also oscillates slowly as a function of iteration number .",
    "this behavior suggests the non - existence , or the non - uniqueness , of a solution to the boundary value problem being solved .",
    "the consequence of this problem for the modeling is that the solution is non - unique ( the exact result depends on the arbitrary choice of a stopping iteration ) and also the force - free model is being solved less accurately ( the field is less force free than in the case of strict convergence because the grad - rubin procedure does not achieve a fixed point ) .      in this paper",
    "we adopt the approach to resolving the inconsistency problem introduced recently by @xcite .",
    "the ` self - consistency ' procedure identifies one nonlinear force - free solution with boundary values close , but not exactly matched , to the vector magnetogram data , with guidance from the estimated uncertainties .",
    "the result is an accurate solution within the assumptions of the force - free model .",
    "the procedure may be summarized as follows .",
    "first , @xmath9 and @xmath10 nonlinear force - free solutions are constructed , from unpreprocessed vector magnetogram boundary data , using the grad - rubin code of @xcite , with a chosen number of iterations .",
    "these solutions use boundary values @xmath30 for the force - free parameter , where the @xmath31 values are derived from the vector magnetogram data via equation  ( [ eq : vmag_alpha ] ) , and the uncertainties @xmath32 are obtained by propagating the uncertainties assigned to the field values  @xcite .",
    "the @xmath9 solution provides a mapping , along field lines , of the observational boundary values @xmath30 at points in the region @xmath9 to points in @xmath10 .",
    "this defines new possible boundary values @xmath33 of the force - free parameter at points in @xmath10 .",
    "( these values will not match the observational values @xmath30 due to the inconsistency problem . ) similarly , the @xmath10 solution maps the observational boundary values @xmath30 at points @xmath10 to points in @xmath9 , and so defines new possible boundary values @xmath33 at points in @xmath9 .",
    "together the two solutions define a complete new set of boundary values @xmath33 of the force - free parameter ( over @xmath9 and @xmath10 ) .",
    "figure  [ fig : scmethod ] illustrates the first step of the self - consistency procedure .",
    "second , bayesian probability theory @xcite is applied to decide on a boundary value of the force - free parameter at each boundary point , based on the two sets of values @xmath30 and @xmath33 .",
    "the idea is that the values represent two observations subject to gaussian uncertainties , and bayes s theorem is applied to determine the true value of the force - free parameter .",
    "the resulting most probable value and associated uncertainty are given by the uncertainty - weighted averages @xcite : @xmath34 the resulting set of boundary values @xmath35 over @xmath9 and @xmath10 is still , in general , inconsistent with the force - free model , but the values are expected to be closer to consistency .",
    "finally , steps one and two are iterated .",
    "two force - free solutions ( the @xmath9 and @xmath10 solutions ) are constructed from the new boundary values @xmath36 , again by applying current - field iteration , in each case .",
    "the two solutions define new mappings between the @xmath9 and @xmath10 regions , and hence a complete new set of boundary conditions @xmath37 .",
    "equations  ( [ eq : bayes_avg ] ) are applied to the two sets of values @xmath36 and @xmath37 to decide on most probable values @xmath38 at each boundary point , and so on .",
    "each iteration of the self - consistency procedure [ i.e.  the construction of the @xmath9 and @xmath10 solutions , and then the application of equations  ( [ eq : bayes_avg ] ) to give a new set of boundary conditions on current ] is referred to as a ` self - consistency cycle . '",
    "the cycles are numbered starting at one , and the @xmath9 and @xmath10 solutions are enumerated with an index @xmath39 , such that the first cycle involves construction of @xmath9 and @xmath10 solutions for the vector magnetogram boundary values @xmath40 , with the solutions numbered @xmath41 and @xmath42 respectively .    self - consistency cycling is expected to converge to a self - consistent solution , i.e.  a set of boundary values of the force - free parameter for which the @xmath9 and @xmath10 solutions are the same .",
    "the result is a single force - free solution , with ( in some sense ) a minimal departure from the observations .      in @xcite",
    "the self - consistency procedure was demonstrated in application to hinode / sot data for ar 10953 observed at 22:30  ut on 30 april 2007 .",
    "the vector magnetogram was the same as that described in @xcite but without the preprocessing ( and associated smoothing ) .",
    "uncertainties were assumed to be equal at each boundary point . in that case",
    "the first of equations  ( [ eq : bayes_avg ] ) reduces to @xmath43 , i.e.  a simple average of the two values .",
    "the self - consistency procedure was applied for ten cycles and found to converge to a solution with an energy @xmath2 , where @xmath1 is the energy of the reference potential field .",
    "figure  [ fig : whereg09stereo ] illustrates the self - consistent solution obtained by @xcite .",
    "panel ( a ) shows the @xmath9 solution and panel ( b ) shows the @xmath10 solution , after 10 self - consistency cycles .",
    "each image looks down on the central part of the computational volume .",
    "the red - white - blue image in the background shows the boundary values of @xmath25 , with red indicating negative values , white values close to zero , and blue positive values .",
    "two sets of field lines are shown in each panel by the red and the blue curves .",
    "the blue curves are field lines originating at points in the @xmath9 polarity and the red curves are field lines originating at points in the @xmath10 polarity .",
    "the sets of field lines in panel ( a ) and in panel ( b ) agree closely , illustrating the achievement of self - consistency .",
    "figure  1 in @xcite ( not reproduced here ) also shows the @xmath9 and @xmath10 solutions at the first self - consistency cycle , i.e.  calculated directly from the original boundary data .",
    "the initial @xmath9 and @xmath10 solutions disagree markedly , with the @xmath10 solution having more highly distorted magnetic field lines than the @xmath9 solution , due to large electric currents associated with the leading polarity negative spot in the region .",
    "the self - consistent solution shown in figure  [ fig : whereg09stereo ] has a relatively small magnetic free energy ( about @xmath3 of the energy of @xmath1 ) .",
    "as discussed in @xcite , this is due in part to the neglect of uncertainties in the boundary values of @xmath6 .",
    "many of the boundary points have zero values of @xmath6 .",
    "the hinode field of view is small , and to compensate for this the hinode data was embedded in a larger field of view based on a line - of - sight magnetogram from the michelson doppler interferometer ( mdi ) instrument on the solar and heliospheric observatory ( soho ) spacecraft @xcite .",
    "the soho / mdi data points have zero values for @xmath29 and hence for @xmath6 , and these zero boundary values are given equal weight to non - zero hinode - derived values of @xmath6 in the self - consistency averaging of the first of equations  ( [ eq : bayes_avg ] ) .",
    "this leads to a reduction in the electric currents in the solution , and hence a reduction in the magnetic free energy .",
    "also , some strong currents are expected to occur in strong field regions , which will have more accurately - determined field values in the vector magnetograms ( smaller uncertainties ) .",
    "these larger currents would be preserved in the application of equations  ( [ eq : bayes_avg ] ) with uncertainties included .",
    "this is expected also to contribute to a reduction in the currents in the @xcite solution . for these reasons",
    "the solution was presented as a proof of concept of the self - consistency procedure , rather than as a realistic attempt to model ar 10953 .",
    "the calculations presented here use a set of data for noaa ar 10953 derived from the same hinode / sot spectropolarimeter ( tsuneta et al .",
    "2008 ) observations at 22:30  ut on 30 april 2007 previously used in @xcite and @xcite .",
    "the original hinode data are again inverted with the hao / asp inversion code developed by paul seagraves at ncar / hao @xcite which was used previously .",
    "the code provides estimates of the uncertainties in each magnetic component derived from the @xmath44 variation of the least - squares fit results for the observed stokes spectra .",
    "these error estimates may be considered to provide a lower limit for the uncertainty in any single measurement .",
    "standard error propagation is applied to the transformations used to obtain the field components @xmath45 in the hinode / sp field of view to give corresponding component uncertainties @xmath46 @xcite .    as with the @xcite approach , co - aligned mdi",
    "line - of - sight data are used initially to produce a potential field with a very large field of view , including ar 10954 roughly 15@xmath47 to the east of ar 10953 .",
    "however , the data - merging procedure deviates henceforth .",
    "the two datasets are re - sampled onto a @xmath48 grid ( as compared to the original @xmath49 and @xmath50 resolution of the hinode and mdi data , respectively ) . the computed mdi - derived image - plane potential vector field is merged with the coaligned hinode / sp image - plane vector field ( each component separately ) , by including a hanning - function weighting at the boundary between the two datasets .",
    "this approach ensures a smooth transition between the data over a few pixels and avoids introducing spurious vertical currents due to sharp gradients between the two datasets .",
    "the resulting combined hinode / mdi vector field data and the uncertainties for each component are cropped to a field of view similar in size to that used by @xcite and @xcite , and are re - sampled to the same @xmath51 resolution used in the previous investigations , resulting in a final @xmath52 grid .",
    "the @xmath25 values used here are flux balanced to within @xmath53 .",
    "values of @xmath31 are calculated for all points with @xmath54 using equation  ( [ eq : vmag_alpha ] ) , with centered differencing used to approximate the derivatives .",
    "uncertainties @xmath32 for the force - free parameter boundary values are calculated at each point from @xmath45 and @xmath46 using propagation of errors applied to the differencing scheme @xcite .",
    "a nominal large uncertainty value , equal to the maximum over all points , is assigned to points in the mdi field region .",
    "points where the calculated @xmath31 is zero because @xmath55 are also assigned this nominal large uncertainty .",
    "the effect of this is that poorly - determined boundary values of @xmath6 carry little weight in the decisions on new boundary values made by the self - consistency procedure using equation  ( [ eq : bayes_avg ] ) .",
    "figure  [ fig : newbcs ] illustrates the resulting vector magnetogram for noaa ar 10953 .",
    "panel ( a ) shows the values of @xmath25 , and panel ( b ) shows the boundary values of @xmath29 . the same color table ( red - white - blue for negative - zero - positive values ) used in figure  [ fig : whereg09stereo ]",
    "is adopted .",
    "panel ( b ) may be compared with figure  3 in @xcite and figure  3 in @xcite , which show the current density values for the vector magnetogram used in the earlier studies .",
    "the current structures in the two sets of boundary data are very similar , including strong regions of current in the leading negative polarity spot , and less concentrated current structures in the more diffuse region of positive polarity .",
    "the new current map lacks the artifacts associated with the edge of the hinode data region visible in the earlier data .",
    "figure  [ fig : signpdist ] illustrates the quantitative values of the uncertainty estimates for @xmath25 and @xmath29 obtained for the vector magnetogram .",
    "this figure displays non - parametric estimates ( e.g. * ? ? ?",
    "* ) of the density distribution of boundary points over values of @xmath56 and @xmath57 [ panel ( a ) ] , and over values of @xmath58 and @xmath59 [ panel ( b ) ] .",
    "the uncertainty values for @xmath25 illustrated in the panel ( a ) of figure  [ fig : signpdist ] are relatively small overall because the hinode / sp - derived uncertainties are based solely on @xmath44 fitting values , and do not include estimates of detection levels or systematic errors which would increase the uncertainty .",
    "hence the estimates presented here should be considered to be lower bounds .",
    "the horizontal band of low uncertainty values for @xmath25 in panel ( a ) of the figure represents the uniform noise in the mdi - derived areas .",
    "panel ( b ) of figure  [ fig : signpdist ] shows a substantial horizontal band of large values of @xmath58 with relatively small uncertainties , representing significant currents in the boundary data , as well as a vertical band of small @xmath58 values with large uncertainties , representing points where the current is poorly determined .      the current - field iteration method @xcite is applied to the data , as outlined in section  [ sec23 ] , for 10 self - consistency cycles with 30 grad - rubin iterations used at each cycle to construct @xmath9 and @xmath10 solutions .",
    "each solution is calculated on a @xmath60 grid .",
    "the horizontal grid size matches the boundary data , and the vertical grid size is chosen to include all field lines which do not cross the sides of the computational volume .",
    "the treatment of ` missing information ' associated with the absence of boundary conditions at the sides and top of the computational volume is important for coronal magnetic field reconstruction .",
    "the @xcite method addresses this problem by neglecting currents on field lines which cross these boundaries . at each iteration for each solution , points @xmath61 on the grid threaded by field lines which cross the sides or top boundaries have @xmath62 set to zero .",
    "this includes points @xmath63 on the grid in the lower boundary , so this procedure modifies the boundary values of the force - free parameter during the grad - rubin iterations . for boundary points subject to this modification the corresponding uncertainty in the force - free parameter",
    "is set equal to the nominal large uncertainty value discussed in section  [ sec31 ] .",
    "this choice minimizes the effect of the zero values during the construction [ according to equation  ( [ eq : bayes_avg ] ) ] of a new set of @xmath6 boundary values at the end of a self - consistency cycle .",
    "the choice of the vertical grid size mentioned above also reduces the effect of this modification of the boundary conditions .",
    "the self - consistency procedure converges in less than ten cycles .",
    "figure  [ fig : newsolstereo ] shows the self - consistent @xmath9 and @xmath10 solutions [ panels ( a ) and ( b ) respectively ] obtained after 10 cycles , using the same presentation as for the @xcite solution shown in figure  [ fig : whereg09stereo ] .",
    "once again the red - white - blue images in the background show the boundary values of @xmath25 , and the blue and red curves are field lines originating in @xmath9 and @xmath10 polarities respectively .",
    "the sets of field lines shown in panels ( a ) and ( b ) agree closely , demonstrating the self - consistency achieved .",
    "some specific differences are visible for field lines extending higher into the computational volume .",
    "table  [ tbl-1 ] lists values of the vector field comparison metrics introduced by @xcite in the context of testing nonlinear force - free methods on known solutions .",
    "the more stringent of these checks , the mean vector error and the normalized vector error , are both about @xmath3 for the @xmath10 solution compared with the @xmath9 solution , which are small values for these metrics in this context .",
    "the energies of the @xmath9 and @xmath10 solutions shown in figure  [ fig : newsolstereo ] are @xmath64 and @xmath65 , which differ by less than @xmath66 .",
    "the two fields are sufficiently similar that we refer to the result as representing a single self - consistent solution .",
    "the solution shown in figure  [ fig : newsolstereo ] is considerably more distorted from the potential configuration than the @xcite solution shown in figure  [ fig : whereg09stereo ] , consistent with the larger magnetic free energy ( as discussed in section  [ sec24 ] , the earlier solution has energy @xmath2 ) .",
    "the energy of the self - consistent solution obtained here ( @xmath0 ) is in the middle of the range of values reported in @xcite for different nonlinear force - free methods applied to preprocessed boundary data ( the values were in the range @xmath67@xmath68 ) .",
    "the energy of the self - consistent solution obtained here is larger than the energy @xmath67 of the @xmath9 solution constructed at the first cycle from the vector magnetogram boundary values , but is smaller than the energy @xmath69 of the @xmath10 solution constructed initially .",
    "the averaging of @xmath6 values between foot points of field lines has led to a solution with an intermediate energy .",
    "the potential field has an energy @xmath70 , so the magnetic free energy for the region is about @xmath71 .",
    "figure  [ fig : scenergyvsit ] illustrates the convergence of the self - consistency procedure , showing the energies of the @xmath9 and @xmath10 solutions obtained at the end of each self - consistency cycle , versus cycle number .",
    "the @xmath9-solution energies are indicated by plus signs , and the @xmath10-solution energies by diamonds .",
    "the energy of the first @xmath10 solution is substantially larger than the energy of the first @xmath9 solution , as mentioned above .",
    "the solutions constructed at intermediate cycles approach one another in energy , converging in about eight cycles . during the initial self - consistency cycles , the grad - rubin iterations exhibit oscillation , as discussed in section  [ sec22 ] .",
    "the boundary data contains large values of the electric current density which prevent strict convergence of the grad - rubin method .",
    "this introduces some arbitrariness into the modeling , because the exact @xmath9 and @xmath10 solutions , and hence the energies shown in figure  [ fig : scenergyvsit ] depend on the choice of a stopping iteration .",
    "this problem is discussed in more detail below .",
    "the grad - rubin solutions constructed for later cycles converge quite strictly ( a fixed point of the iteration scheme is achieved ) .",
    "the self - consistency procedure changes the boundary values of the vertical electric current density and hence the boundary values of the horizontal field @xmath72 , but does not change the boundary values of @xmath25 .",
    "figure  [ fig : jzscpn ] illustrates the changes in the vertical current density @xmath29 over the @xmath9 and @xmath10 polarities in the boundary .",
    "the self - consistency procedure reduces the largest values of @xmath58 over both polarities , but retains some large currents .",
    "many of the structures in the distribution of @xmath29 observed in the initial data have survived , and in particular the patterns of strong - current in the leading negative polarity spot are preserved [ see panels ( c ) and ( d ) of figure  [ fig : jzscpn ] ] , although the current distribution has changed in detail .",
    "figure  [ fig : bhchange ] illustrates the corresponding boundary values of the magnitude of the horizontal field at the photosphere , for the initial vector magnetogram and for the final self - consistent solution .",
    "panel ( a ) of figure  [ fig : bhchange ] shows the horizontal field for the magnetogram data , @xmath73^{1/2}$ ] , and panel ( b ) shows the the horizontal field for the self - consistent solution , @xmath74^{1/2}$ ] .",
    "the maximum value of the two fields is very similar , and there is a good qualitative correspondence between features in the two images , although the details have changed .",
    "figure  [ fig : sigbhnpdist ] illustrates the quantitative changes in the horizontal vector field , showing a non - parametric estimate of the density of points ( cf.figure  [ fig : signpdist ] ) over values of @xmath75 as a function of the measured @xmath76 , where @xmath77^{1/2}$ ] and @xmath78 is the uncertainty in @xmath79 .",
    "only points in the hinode data region are included in this comparison .",
    "this figure indicates that the vast majority of points undergo small changes , but there is a substantial low - density tail of points subject to larger changes .",
    "the average absolute change in the horizontal field is @xmath80 , and the average ratio of the changes to the uncertainties is @xmath81 .",
    "many points are subject to changes in the horizontal field substantially larger than the corresponding uncertainty .",
    "as discussed in section  [ sec31 ] , the uncertainties assigned to the vector magnetogram data are lower bounds .",
    "also , the initial boundary data are physically inconsistent with the force - free model ( the departure from the model is not due only to observational uncertainties ) .",
    "the absolute changes in the horizontal field are comparable to those produced by preprocessing @xcite .    a measure of the inconsistency between the boundary data and the force - free model is given by the estimates of the net forces and torques on the field in @xmath15 which may be calculated from the boundary data @xcite , as discussed in section  [ sec22 ] .",
    "table  [ tbl-2 ] presents the values of the forces and torques for the initial vector magnetogram data , and for the self - consistent @xmath9 and @xmath10 solutions .",
    "the components of the initial force are of order a few percent , and the components of the initial torque are of order @xmath82 , in terms of relevant characteristic values . for the self - consistent solutions the force components",
    "are reduced to @xmath83 , and the components of the torques are reduced to @xmath84 ( in most cases much less ) , with the same scaling .",
    "the changes in the horizontal field and hence current illustrated in figures  [ fig : jzscpn][fig : sigbhnpdist ] are necessary to achieve this consistency with the force - free model .",
    "as mentioned above , the grad - rubin iterations do not converge exactly during the early and intermediate self - consistency cycles , and the choice of the final iteration for each cycle introduces some arbitrariness into the procedure . to investigate this effect the calculation",
    "is repeated , with @xmath85 grad - rubin iterations per cycle for both the @xmath9 and @xmath10 solutions ( rather than @xmath86 ) , also with @xmath87 iterations per cycle .",
    "the grad - rubin iterations converge in @xmath88 cycles for later cycles , so @xmath85 is approximately the minimum suitable choice . in each case , the self - consistency procedure is found to converge in less than 10 cycles .",
    "the self - consistent fields obtained with @xmath85 and @xmath87 are qualitative very similar to the @xmath86 result , i.e.  the field lines are visually very similar",
    ". the energies are also remarkably similar , with all three solutions having @xmath0 , to the stated digits .",
    "table  [ tbl-3 ] quotes the vector field comparison metrics from @xcite , comparing the @xmath9 solutions of the two new cases ( @xmath85 and @xmath87 ) with the original case ( @xmath86 ) .",
    "the values are substantially larger than for the comparison of the individual @xmath9 and @xmath10 solutions ( e.g.  table  [ tbl-1 ] ) , but are smaller than the typical differences introduced by varying treatments of the unknown side and top boundary conditions in the application of nonlinear force - free methods to known solutions @xcite . hence in the context of nonlinear force - free modeling ,",
    "the solutions may be considered very similar .",
    "figure  [ fig : varygrit ] illustrates the boundary distributions of @xmath29 for the three self - consistent @xmath10 solutions .",
    "panel ( a ) shows the signal to noise ratio values @xmath89 over the vector magnetogram , which determine how well the initial boundary conditions on @xmath29 are preserved at different locations in the boundary by the self - consistency procedure , according to the first of equations  ( [ eq : bayes_avg ] ) .",
    "panels ( b ) , ( c ) , and ( d ) show the boundary conditions on @xmath29 in the self - conistent solutions for the cases @xmath85 , @xmath86 , and @xmath87 respectively , using the same presentation as figures  [ fig : newbcs ] and  [ fig : jzscpn ] .",
    "panels ( b)(d ) are visually very similar .",
    "the same structures are observed , and the range of values of @xmath29 is very similar .",
    "comparison with the signal to noise ratio map [ panel ( a ) ] illustrates qualitatively how the current is unchanged at locations where @xmath31 ( or @xmath29 ) is well - determined .",
    "these results suggest that the self - consistency procedure , including uncertainties , is identifying a particular force - free solution independent of this element of arbitrariness .",
    "a solution to the nonlinear force - free model is constructed for noaa solar active region ar 10953 , based on a vector magnetogram derived from hinode / sot observations at 22:30  ut on 30 april 2007 .",
    "the solution applies the ` self - consistency ' procedure of @xcite , for the first time taking into account uncertainties in the boundary data .",
    "the boundary data are subject to improved techniques for data merging by comparison with earlier studies using the same hinode / sot observations @xcite .",
    "the self - consistency procedure addresses the problem that vector magnetogram data are inconsistent with the force - free model @xcite .",
    "in particular , the solar boundary data provide two possible force - free solutions ( the @xmath9 and @xmath10 solutions , corresponding to choosing boundary conditions for the vertical electric current density @xmath29 from the positive or the negative polarities of the boundary field respectively ) , which are generally found to be significantly different .",
    "the @xmath9 and the @xmath10 soutions are distinctly different for the vector magnetogram data used here .",
    "the self - consistency procedure modifies the boundary conditions on @xmath29 during a sequence of cycles in which @xmath9 and @xmath10 solutions are constructed using grad - rubin iteration @xcite , and arrives at a solution to the force - free model with boundary values close to , but not exactly matching , the observational vector magnetogram data .",
    "when uncertainties in the boundary data are taken into account , the boundary values of @xmath29 are preserved more closely at points having smaller uncertainties .",
    "self - consistency modeling has two advantages over conventional force - free modeling .",
    "first , force - free methods tend to fail to strictly converge when applied to solar data , and hence do not accurately solve the force - free model .",
    "the self - consistency procedure achieves strict convergence .",
    "second , the method identifies a single solution , rather than two solutions .",
    "active region ar 10953 was previously modelled using the self - consistency procedure in @xcite , but in that case uncertainties were not included , and the results were regarded as a proof of concept of the method , rather than a full demonstration of its capabilities .",
    "this paper presents a more comprehensive demonstration and investigation .",
    "the self - consistent solution obtained for active region ar 10953 is substantially non - potential , with a coronal magnetic energy @xmath0 , where @xmath1 is the energy of the potential field with the same vertical component of the magnetic field in the boundary .",
    "this energy is significantly larger than the energy @xmath2 of the solution obtained in @xcite , which is attributed to the neglect of uncertainties in the earlier paper .",
    "the non - potentiality of the region is due to strong currents in the inner parts of the region , in particular associated with the southern part of the the negative polarity leading spot , as shown in figure  3 .",
    "these currents were reduced in the earlier solution by the self - consistency averaging procedure [ equations  ( [ eq : bayes_avg ] ) ] due to the omission of uncertainties ( or rather , the treatment of all boundary points as having equal uncertainty ) . with uncertainties included correctly , these currents are preserved because they are in regions where the field , and hence current , is well - determined , as shown in figure  [ fig : varygrit ] .",
    "the energy of the new self - consistent solution is intermediate between the energies of the @xmath9 and @xmath10 solutions constructed from the vector magnetogram data ( @xmath67 for the @xmath9 solution , and @xmath69 for the @xmath10 solution ) , and is also in the middle of the range of energies found by @xcite using force - free codes applied to boundary data derived from the same hinode / sot observations but subject to the preprocessing procedure @xcite , which is not used here .",
    "recently @xcite presented a more detailed account of force - free modeling of ar 10953 with two grad - rubin codes applied to the @xmath10-polarity @xcite boundary data , and reported energies @xmath90 and @xmath91 . the energies obtained by these authors are different from the energy of the initial @xmath10 solution obtained here for a number of reasons .",
    "the hinode / mdi boundary data used here is prepared differently , as discussed in section  [ sec31 ] , and preprocessing has not been applied .",
    "the lack of convergence of the initial @xmath9 and @xmath10 solutions obtained here means that a range of energies is possible , depending on the choice of stoppping iteration ( in practise we find energies for the @xmath10 solution in the range @xmath92 to @xmath93 ) .",
    "the present method treats the side and top boundaries in a different way to the @xcite method , and in particular we neglect currents on field lines which cross the side and top boundaries , which tends to reduce the energy .",
    "finally , the stated @xcite and @xcite energies refer to a smaller sub - region of the computational domain . because of these differences we do not attempt a more detailed comparison with the earlier results .",
    "a degree of arbitrariness is introduced into the modeling by the lack of strict convergence of the grad - rubin iterations used to construct the @xmath9 and @xmath10 solutions at early and intermediate self - consistency cycles .",
    "the results of the self - consistency procedure may depend on the choice of the number of grad - rubin iterations .",
    "this effect is investigated by repeating the calculation with @xmath85 and @xmath87 iterations at each cycle ( rather than @xmath86 ) .",
    "the two new self - consistent solutions are remarkably similar to the first solution , and in particular all three solutions have energy @xmath0 .",
    "this suggests that self - consistency modeling provides a solution to the problem of reliable estimation of the coronal magnetic free energy of an active region , once uncertainties in the boundary data are incorporated .",
    "the inclusion of uncertainties preserves boundary conditions on current at points in the boundary where the currents are most accurately determined .",
    "the three self - consistent solutions obtained with different numbers of grad - rubin iterations have very similar boundary distributions of @xmath29 .",
    "the self - consistency procedure ( including uncertainties ) is a promising candidate for routine reconstruction of coronal magnetic fields .",
    "the technique is shown to produce a highly non - potential and accurately force - free coronal field model for noaa ar 10953 from hinode / sot vector magnetogram data .",
    "the estimate of the free energy of the magnetic field appears to be robust based on the results obtained with varying numbers of grad - rubin iterations per self - consistency cycle .",
    "the availability of high - quality vector magnetogram data over the next solar cycle from hinode / sot and sdo / hmi will provide ample opportunities for further testing , development , and application of the method , to investigate many questions in the physics of solar activity .",
    "hinode is a japanese mission developed and launched by isas / jaxa , collaborating with naoj as a domestic partner , and nasa and stfc ( uk ) as international partners .",
    "scientific operation of the hinode mission is conducted by the hinode science team organized at isas / jaxa .",
    "this team mainly consists of scientists from institutes in the partner countries .",
    "support for the post - launch operation is provided by jaxa and naoj ( japan ) , stfc ( u.k . ) , nasa , esa , and nsc ( norway ) .",
    "we extend our thanks to bruce lites for providing the full inversion results for the data used herein and paul seagraves for developing the code at ncar / hao .",
    "kdl appreciates funding from nsf shine grant atm-0454610 and npde code from graham barnes .",
    "mike wheatland acknowledges support from the same nsf shine grant during a collaborative visit to nwra in boulder .",
    "aly , j.  j.  1984 , , 283 , 349 aly , j.  j.  1989 , , 120 , 19 aly , j.  j. , & amari , t.  2007 , geophys .",
    "fluid dyn . ,",
    "101 , 249 auer , l.  h. , house , l.  l. , & heasley , j.  n.  1977 , , 55 , 47 amari , t. , aly , j.  j. , luciani , j.  f. , boulmezaoud , t.  z. , & mikic , z.  1997 , , 174 , 129 amari , t. , boulmezaoud , t.  z. , & aly , j.  j.  2006 , , 446 , 691 bommier , v. , landi deglinnocenti , e. , landolfi , m. , & molodij , g.   2007 , , 464 , 323 borrero , j.  m. , tomczyk , s. , norton , a. , darnell , t. , schou , j. , scherrer , p. , bush , r. , & liu , y.  2007 , , 240 , 177 canou , a. , & amari , t.  2010 , , 715 , 1566 committee on the societal , and economic impacts of severe space weather events 2008 , severe space weather events : understanding societal and economic impacts workshop report , space studies board ad hoc committee on the societal & economic impacts of severe space weather events : a workshop , the national academies press : washington , dc  isbn : 978 - 0 - 309 - 12769 - 1 del toro iniesta , j.  c. , & ruiz cobo , b.  1996 , , 164 , 169 de rosa , m.  l. , et al .",
    "2009 , , 696 , 1780 gary , g.  a.  2001 , , 203 , 71 grad , h. and rubin , h. 1958 , in proc .",
    "2nd int .",
    "conf .  on peaceful uses of atomic energy , vol .  31 , geneva : un , 190 inhester , b. , & wiegelmann , t.  2006 , , 235 , 201 jaynes , e.  t. 2003 , probability theory , by e.  t.  jaynes , ed .   g.  larry bretthorst , cambridge , uk : cambridge university press landi deglinnocenti , e. & landolfi , m. 2004 , polarization in spectral lines , kluwer : dordrecht landolfi , m. , & landi deglinnocenti , e. 1982 , 78 , 355 leka , k.  d. , barnes , g. , crouch , a.  d. , metcalf , t.  r. , gary , g.  a. , jing , j. , & liu , y.  2009 , 260 , 83 leka , k.  d. , & skumanich , a.  1999 , , 188 , 3 leka , k.  d.  1999 , , 188 , 21 lites , b.w .  2009 , private communication mcclymont , a.  n. , jiao , l. , & mikic , z.  1997 , , 174 , 191 metcalf , t.  r.  1994 , , 155 , 235 metcalf , t.  r. , jiao , l. , mcclymont , a.  n. , canfield , r.  c. , & uitenbroek , h.  1995 , , 439 , 474 metcalf , t.  r. , et al .",
    "2006 , , 237 , 267 metcalf , t.  r. , et al .",
    "2008 , , 247 , 269 molodenskii , m.  m.  1969 , , 12 , 585 neukirch , t. 2005 , in innes , d.e . ,",
    "lagg , a. , solanki , s.k .",
    "( eds . ) , proceedings of the international scientific conference on chromospheric and coronal magnetic fields , esa sp-596 , 12.1 ( cdrom ) odenwald , s. , green , j. , & taylor , w.  2006 , adv .",
    "space res .",
    "38 , 280 rgnier , s.  2007 , , 78 , 126 sakurai , t.  1981 , , 69 , 343 scherrer , p.  h. , et al .",
    "1995 , , 162 , 129 scherrer , p.h . ,",
    "hoeksema , j.t . ,",
    "& the hmi team 2006 , 36th cospar scientific assembly , 36 , 1469 .",
    "schrijver , c.  j. , et al .",
    "2006 , , 235 , 161 schrijver , c.  j. , et al .",
    "2008 , , 675 , 1637 silverman , b.  w.  1986 , density estimation for statistics and data analysis , chapman & hall : boca raton skumanich , a. , & lites , b.  w.  1987 , , 322 , 473 sturrock , p.  a.  1994 , plasma physics , cambridge university press : cambridge tsuneta , s. , et al .",
    "2008 , , 249 , 167 wheatland , m.  s. , sturrock , p.  a. , & roumeliotis , g.  2000 , , 540 , 1150 wheatland , m.  s.  2007 , , 245 , 251 wheatland , m.  s. , & rgnier , s.  2009 , , 700 , l88 wheatland , m.  s. , gilchrist , s.a . , & rgnier , s.  2010 , advances in geosciences ( a 6-volume set ) , volume 21 : solar terrestrial ( st ) , vol .  21 editor - in - chief marc duldig , world scientific : singapore wiegelmann , t.  2004 , , 219 , 87 wiegelmann , t. , & inhester , b.  2010 , , 516 , a107 wiegelmann , t. , inhester , b. , & sakurai , t.  2006 , , 233 , 215 wiegelmann , t.  2008 , ( space physics ) , 113 , 3 wiegelmann , t. , thalmann , j.  k. , schrijver , c.  j. , de rosa , m.  l. , & metcalf , t.  r.  2008 , , 247 , 249      cccc quantity & vector magnetogram & self - consistent p solution & self - consistent n solution + @xmath99 & @xmath100 & @xmath101 & @xmath102 + @xmath103 & @xmath104 & @xmath105 & @xmath106 + @xmath107 & @xmath108 & @xmath109 & @xmath105 + @xmath110 & @xmath111 & @xmath112 & @xmath113 + @xmath114 & @xmath115 & @xmath116 & @xmath113 + @xmath117 & @xmath104 & @xmath118 & @xmath119 +"
  ],
  "abstract_text": [
    "<S> a nonlinear force - free solution is constructed for the coronal magnetic field in noaa solar active region ar 10953 based on a photospheric vector magnetogram derived from hinode satellite observations on 30 april 2007 , taking into account uncertainties in the boundary data and using improved methods for merging multiple - instrument data . </S>",
    "<S> the solution demonstrates the ` self - consistency ' procedure of wheatland & rgnier ( 2009 ) , for the first time including uncertainties . </S>",
    "<S> the self - consistency procedure addresses the problem that photospheric vector magnetogram data are inconsistent with the force - free model , and in particular that the boundary conditions on vertical electric current density are over - specified and permit the construction of two different nonlinear force - free solutions . </S>",
    "<S> the procedure modifies the boundary conditions on current density during a sequence of cycles until the two nonlinear force - free solutions agree . </S>",
    "<S> it hence constructs an accurate single solution to the force - free model , with boundary values close , but not matched exactly , to the vector magnetogram data . </S>",
    "<S> the inclusion of uncertainties preserves the boundary conditions more closely at points with smaller uncertainties . </S>",
    "<S> the self - consistent solution obtained for active region ar 10953 is significantly non - potential , with magnetic energy @xmath0 , where @xmath1 is the energy of the reference potential ( current - free ) magnetic field . the self - consistent solution is shown to be robust against changes in the details of the construction of the two force - free models at each cycle . </S>",
    "<S> this suggests that reliable nonlinear force - free modeling of active regions is possible if uncertainties in vector magnetogram boundary data are included . </S>"
  ]
}