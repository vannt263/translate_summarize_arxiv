{
  "article_text": [
    "a major characteristic of the interstellar medium ( ism ) is that it is clumpy , with filamentary structure over scales ranging from hundreds of parsecs through sub - au cloudlets .",
    "the spatial density of electrons is approximately a power law over an astonishing 12 orders of magnitude @xcite , from @xmath0300 pc to @xmath10.1 au in the ism .",
    "the magnetic field of the galaxy varies in a similar fashion on scales from 0.01 to 100 pc .",
    "molecular clouds show a fractal ( scale - free ) spatial variation of the intensity of co ( e.g. , @xcite ) and neutral h @xcite .",
    "sub - parsec variations are shown by the variation of ionic column densities along different ism sightlines towards individual stars in close binaries @xcite .",
    "large area velocity resolved surveys of the molecular ( e.g. , @xcite ) , neutral ( e.g. , @xcite ) , and ionized @xcite gas now allow us to probe the geometry , kinematics , ionization , and temperature structure of the ism .",
    "our development of monte carlo radiation transfer techniques to study photon scattering , ionization , and radiative equilibrium dust temperatures in complex geometries is motivated by these and the many other observations that clearly require three dimensional modeling analyses . in this paper",
    "we describe improvements and extensions to our monte carlo photoionization code @xcite that will enable us to model the 3d temperature , ionization structure , emission line images , and spectra of low density h  ii regions and the diffuse ionized gas ( dig ) , often called  the warm ionized medium \" or `` reynolds layer '' .",
    "this diffuse ionized gas has a complicated structure and surely requires three - dimensional modeling , both as regards the sources of its ionization and the transfer of the ionizing radiation . how can lyman continuum photons from o and b stars percolate from their midplane origins to ionize the high latitude gas ?",
    "a non - uniform ism is required that provides low density paths for ionizing photons to reach the halo . using a `` strmgren volume '' ionization technique and a statistical approach to clumping",
    ", @xcite showed that o and b stars can ionize the dig ( see also @xcite ; @xcite ) .",
    "using monte carlo simulations for hydrogen ionization , @xcite have investigated ionization structures in a fractal ism as proposed by @xcite . in elmegreen s picture ,",
    "the observed h@xmath2 emission may arise from the ionized surfaces of fractal clouds .",
    "this suggestion clearly needs to be investigated with 3d radiation transfer techniques .",
    "other features of the dig that may require 3d analyses are the temperature structure and relative ionization structure of he and h. the temperature of the dig , as determined from line intensity ratios ( e.g. , @xcite ) , appears to require additional heating over and above that provided by photoionization heating @xcite . among the possible heating mechanisms ,",
    "dissipation of energy in a turbulent medium has been proposed @xcite , definitely 3d ! another question is , can clumping / shadowing explain the apparent lack of he@xmath3 in h@xmath4 regions @xcite ? in this scenario , direct stellar photons are prevented from ionizing he in shadow regions behind dense clumps , but diffuse ionizing photons from h and he recombinations can percolate into the shadow regions and ionize h , but not he .    our work on the analysis of scattered light in fractal reflection nebulae @xcite highlighted the crucial role of geometry when trying to determine dust properties from scattered light observations .",
    "much of what we know about abundances of elements comes from analysis of spectra utilizing one - dimensional photoionization techniques ( see e.g. @xcite ) . over the last decade",
    "several three dimensional photoionization codes have been developed .",
    "the code presented by @xcite uses the `` on the spot '' approximation for the diffuse radiation field , while that of @xcite employs an adaptive mesh grid and an iterative procedure to determine the contribution of the diffuse radiation field .",
    "monte carlo techniques naturally include diffuse radiation within three dimensional systems and monte carlo photoionization codes have been described by @xcite for the three - dimensional case and @xcite for the one - dimensional case .",
    "we have extended our basic hydrogen - only monte carlo photoionization code @xcite to treat the photoionization , heating , & cooling for the complex geometry expected in low density h  ii regions and the diffuse ism .",
    "our code is similar to those described by @xcite and @xcite , but calculates the rates of photoionization and heating `` on the fly '' , rather than calculating the mean intensity of the radiation field ( see also lucy 1999 ) .",
    "it also treats reprocessing of radiation in a different manner to that described by @xcite , using `` photon packets '' rather than `` energy packets . ''    in  2 we describe our assumptions and approximations to model the dig .",
    " 3 describes the monte carlo technique , our method of discretizing the radiation field into `` photon packets '' rather than `` energy packets , '' and how we determine the diffuse radiation field using ratios of recombination rates .",
    "5 , &  6 deal with our photoionization and heating / cooling algorithms ,  7 presents the atomic data used in our code , and  8 compares our code with standard h  ii region benchmarks and gives an example of a 2d calculation .",
    "we make the following assumptions and approximations for the opacity , heating and cooling .    * we consider only radiation energetic enough to ionize h ( @xmath513.6 ev ) .",
    "photons of lower energies are ignored until we calculate the emergent intensities of certain spectral features after the simulation is completed . *",
    "all ions are in the ground state when they absorb radiation or recombine with an electron .",
    "this is the standard `` nebular approximation . ''",
    "the low - lying levels giving rise to fine structure lines might be an exception .",
    "radiative transfer in these lines would require consideration of the populations of the levels involved in their production .",
    "we assume that the fine structure lines are optically thin . *",
    "no h - ionizing photons are produced by recombinations to excited levels of h or he .",
    "this is because @xmath6(h@xmath3 ) = 13.6 ev , the ionization potential of h. * there is no collisional ionization or de - excitation . in effect , this limits the densities we can study to be less than a few @xmath7  @xmath8 , which is generally above that encountered in the diffuse ionized gas and typical h  ii regions , but within the typical range of planetary nebulae .",
    "* there is no he@xmath9 because the stellar radiation field has negligible luminosity above 54.4  ev , consistent with observations of almost all h  ii regions . *",
    "the opacity is due to continuous opacity from neutral h and he ; we ignore contributions from other ions because of their low abundances . at present",
    "we ignore all other opacity sources ( e.g. , dust , uv metal line blanketing , etc . ) except photoionization from oxygen . *",
    "photoionization and heating by the he  i lyman  @xmath2 line is included in an `` on - the - spot '' approximation ( see  [ helya ] for a discussion of the physics ) . *",
    "we keep track of the abundances of the stages of ionization of h , he , c , n , o , ne , and s that have their ionization potentials @xmath10 and @xmath11 = 54.4 ev .",
    "these are h@xmath3 , he@xmath3 , c@xmath4 ",
    "c@xmath12 , n@xmath3 ",
    "n@xmath12 , o@xmath3 ",
    "o@xmath9 , ne@xmath3  ne@xmath12 , and s@xmath4  s@xmath12 .",
    "these chemical elements are chosen because some of their ions are important for the heating and cooling rates .",
    "it is straightforward to include other elements , but they do not appreciably affect the h and he ionization structure or contribute to the heating or cooling .",
    "we assume that there is no s@xmath3 because its ionization potential is 10.36  ev , so it is ionized by the ambient stellar radiation fields softer than @xmath13 = 13.6 ev ( see @xcite for observations ) .",
    "* heating arises solely from the photoionization of h and he .",
    "cooling is from recombinations of h and he , free - free emission , and collisionally excited line radiation from n , o , ne , s ( see below ) . *",
    "we ignore dynamics , turbulence , and the effects of shocks and ionization fronts .",
    "it is straightforward to include more ions and the effects of dust opacity .",
    "the assumption of no opacity from heavy elements may also be easily relaxed .",
    "we want to determine the time - independent ionization and temperature structure of a nebula with an assumed fixed density distribution .",
    "we do this by monte carlo radiative transfer followed by iterations to find the ionization structure that determines the opacity .    within each iteration",
    "we consider packets of ionizing photons emitted from the exciting star(s ) of the nebula .",
    "we choose the frequency from the probability distribution of the photon emission from the sources .",
    "we follow each stellar photon packet through the density grid until it is absorbed and causes photoionization .",
    "the subsequent recombination often results in the production of another ionizing photon packet , thereby forming the diffuse radiation field .",
    "the frequency of the new packet is sampled from various atomic probability distributions .",
    "we first determine if the packet was absorbed by h@xmath3 or he@xmath3 , and then determine the frequency of the re - emitted packet ( see below ) .",
    "we continue the monte carlo random walk of absorption / re - emission events until the packet is re - emitted with @xmath14  ev , at which time we terminate it .",
    "our approach differs somewhat from previous monte carlo simulations ( @xcite ; @xcite ; @xcite ; @xcite ) that followed the _ energy _ of a packet , rather than its number of photons . considering energy is natural for investigating problems of radiative equilibrium ( e.g. , scattering and thermal emission by dust , or stellar atmospheres ) , since the energy that is absorbed is thermally re - emitted with exactly the same energy but with a source function , @xmath15 , given by kirchhoff s law ( @xmath16 , where @xmath17 is the emissivity and @xmath18 the absorption coefficient ) .",
    "kirchhoff s law is applicable only when the populations of atomic levels are in local thermodynamic equilibrium and does not apply to nebulae .",
    "the number of photons associated with an energy packet varies with its frequency , so it is not as straightforward to apply atomic probabilities in following the fate of an energy packet .",
    "the energy of an energy packet is given by @xmath19 and is kept constant for radiative equilibrium codes , where @xmath20 is the stellar luminosity , @xmath21 is the time covered by the simulation , and @xmath22 is the number of packets used in the simulation .",
    "the energies of our packets are @xmath23 , where @xmath24 is the ionizing photon luminosity ( units s@xmath25 ) .",
    "the energy is not kept constant as the packet changes frequency , but keeps its number of photons constant ( see also lucy 2003 ) .",
    "since our initial goal is to determine the 3d ionization and temperature structure , we do not follow the non - ionizing diffuse photons : they are emitted with @xmath14  ev and will escape from the nebula , so we terminate the ionizing photon and start a new one from the star .",
    "we thus save memory by not having to form probability distribution functions in each cell for finding the frequency of non - ionizing photons .",
    "rather , we determine a converged ionization and temperature structure and then employ a second code to integrate numerically through our resulting emissivity grid to form the emergent spectrum and images in various spectral lines .",
    "current desktop machines using 1 gb ram can handle grids of around @xmath26 cells for our code .",
    "the iterative photoionization and heating calculation ( described in  4 and 5 ) updates the temperature and ionic fractions of all species we are tracking in each cell throughout the grid . at the end of each iteration we have a new ionization structure and opacity grid for the next iteration .      in monte carlo techniques we must decide on the outcome of events that depend on some physical variable , say @xmath27 ( e.g. , the frequency @xmath28 ) , with a given probability , @xmath29 .",
    "the important quantity is the cumulative distribution function , @xmath30 , given by    @xmath31    where @xmath32 is the minimum value of @xmath27 and @xmath33 the maximum .",
    "we find a randomly selected value of @xmath27 by casting a random number appears in this paper .",
    "a new integer , iseed , is automatically generated by the subroutine after each entry .",
    "] , @xmath34 , in the range [ 0,1 ] and inverting the relation @xmath35 .",
    "we assume the density structure of our nebular simulation , possibly quite complex as appropriate to the ism .",
    "we begin the monte carlo radiation transfer by emitting photon packets from the exciting star(s ) with an initial guess for the ionization structure .",
    "the initial guess for the ionization structure does not affect the final converged solution , but it does affect the number of iterations required for convergence .",
    "for isotropic emission , the random directions are    @xmath36    where @xmath37 and @xmath38 are the usual spherical polar coordinates .",
    "the direction cosines for the initial photon trajectories are then given by    @xmath39    the photon frequency must be sampled to reproduce the ionizing spectrum of the source , @xmath40 , which may be a blackbody or model atmosphere .",
    "we pre - tabulate the cumulative photon distribution function ,    @xmath41    a random frequency is chosen by solving for @xmath28 in @xmath42 by interpolating in the pre - tabulated cumulative distribution function @xmath43 . from @xmath28",
    "we calculate the photoionization cross sections @xmath44 and @xmath45 from analytic formulae .",
    "the optical depth , @xmath46 , along a path length @xmath47 is    @xmath48\\,{\\rm d}s\\ ; .\\ ] ]    where @xmath49 and @xmath50 vary from cell to cell .",
    "we generate a random optical depth by @xmath51 and integrate through the opacity grid until the distance @xmath47 has been reached .",
    "if the distance @xmath47 lies outside the simulation grid the photon has exited our simulation and we start another packet from the star .      on finding the position associated with the randomly chosen optical depth , we decide if the photon packet is absorbed by h@xmath3 or he@xmath3 .",
    "the packet is absorbed by h@xmath3 if @xmath52 $ ] , and by he@xmath3 otherwise . if absorbed by h@xmath3 , it will be re - emitted either as a lyman continuum photon ( and subsequently tracked with the monte carlo technique ) or terminated .",
    "if absorbed by he@xmath3 there are several energy channels into which it can be re - emitted as described below .",
    "once a photon packet has been absorbed we re - emit it with a frequency chosen using the following algorithm .",
    "the probability that the photon is emitted in the hydrogen lyman continuum is    @xmath53    where @xmath54 is the recombination coefficient to the ground level and @xmath55 the coefficient to all levels , including @xmath56 = 1 .",
    "the packet emerges in the lyman continuum if @xmath57 .",
    "if the packet is chosen to be re - emitted in the lyman continuum , we sample its frequency using the @xmath58 derived from the saha - milne emissivity :    @xmath59    we pre - tabulate @xmath60 and from @xmath61 we determine @xmath28 from @xmath34 by interpolating in the table .",
    "the packet is now re - emitted with a direction chosen from an isotropic distribution ( eqs .  1 and 2 ) .    at the start of each iteration we form a 3d grid that contains @xmath62 and",
    "use this grid to decide the fate of photon packets absorbed by h@xmath3 .",
    "similar grids are formed for the he emission probabilities as described in the next section .",
    "these probability grids are updated after each iteration since the recombination rates are temperature dependent .",
    "an absorption by he is followed by recombination and possibly by radiative cascades into either the metastable levels @xmath63 or @xmath64 , to @xmath65 ( the upper level of lyman @xmath2 ) , or to the ground level @xmath66 .",
    "the probabilities for emission in these four channels are as follows :    1 .",
    "he  i lyman continuum ( @xmath67  ev ) is analogous to that given for h in  [ hem ] .",
    "the probability of emission as a 19.8  ev photon packet from the transition @xmath68 is + @xmath69 + the _ effective _ recombination rate takes into account all means of populating the given level , both direct recombination and via cascades from higher levels , from which low energy photons are emitted .",
    "3 .   the probability of emission from the he  i two - photon continuum from @xmath63 is + @xmath70 + note that @xmath71 does not include de - excitations from @xmath65 , which will be discussed in  4.1 +",
    "a fraction 0.28 of the photons in this emission channel is able to ionize h@xmath3 , so the number of photons emitted per decay is 2(0.28 ) = 0.56 photons . after determining that the packet is to be emitted in the 2-photon continuum , we see if @xmath72 . if so , we choose a frequency from a pre - tabulated @xmath58 for two - photon emission ( @xcite , table  ii ) .",
    "the probability of emission as a he  i lyman @xmath2 photon ( @xmath73  ev ) is + @xmath74 + @xcite and @xcite followed energy packets of several of the he  i lyman lines , assuming that the various he lyman lines are absorbed only by the h@xmath3 continuous opacity , propagating through the grid and maintaining their identity without degrading into lyman  @xmath2 .",
    "we do not follow this prescription because resonance lines will be scattered many times without diffusing far in space . following each scattering from @xmath75 ( @xmath76 )",
    ", there is a finite probability of re - emission into a lower excited level rather than to 1@xmath77 .",
    "subsequent emissions from that excited level cascade downwards and populate either @xmath63 or @xmath65 .",
    "conversion to @xmath63 is followed by he  i 2-photon continuum emission .",
    "we discuss our treatment of the @xmath65 in  [ helya ] .    to form the various probabilities , we use analytic fits to the temperature dependent recombination rates for h and he .",
    "these rates , along with all other atomic data , are presented in  [ atdata ] .",
    "since there are only four he  i levels with appreciable populations , we have    @xmath78    we also assume that recombinations to triplets produce only the 19.8  ev 2@xmath79 transition .",
    "we do not follow @xmath80 , as did @xcite , since at low densities 2@xmath81 converts to 2@xmath82 via 10830 emission .",
    "we must calculate the photoionization , heating , and cooling in order to update the ionic fractions and electron temperature after each iteration .    the basic photoionization equations , in the notation of @xcite , are    @xmath83    where @xmath84 and @xmath85 are the number densities ( per @xmath86 ) of successive stages of ionization , @xmath87 is the threshold for photoionization from @xmath88 , @xmath89 is the electron number density , and @xmath90 is the recombination coefficient to all levels of @xmath88 . in our code",
    "the photon luminosity of the sources , @xmath24 , is divided into @xmath22 packets , so we calculate the integral on the left of eqn .",
    "( [ ioneqn ] ) by    @xmath91    where the summation is over all path lengths through the volume @xmath92 for photons in the frequency range ( @xmath93 ) , and @xmath94 is the path length of each photon counted in the sum ( lucy 1999 , 2003 ) .",
    "thus , we do not explicitly calculate the mean intensity @xmath95 throughout the grid in order to compute the integral of @xmath96 for each ion considered .",
    "to save @xmath97 , we would need storage for each grid cell with as many frequencies as being considered .",
    "we add the contribution of each ionizing photon packet , regardless of stellar or nebular origin , to the sum of @xmath98 maintained for each ion , within each cell in the grid . at the end of the iteration",
    "we have a 3d array for each ion that contains the integral @xmath99 .",
    "the photoionization rate is then @xmath100 within each cell .",
    "so long as the number of ions being tracked is less than the typical number of frequencies required for an accurate representation of the mean intensity , our technique will save significantly on memory storage .",
    "we use the above equations to solve the ionization balance of most ions that we follow .",
    "exceptions to this are our treatment of he  i ly@xmath2 photons that can ionize h@xmath3 , and also charge exchange that couples the ionization of some ions to h and he .",
    "we now outline our treatments of the ionization balance for these situations .",
    "we do not need to follow the diffusion of the he  i ly@xmath2 resonance line ( @xmath101 ) in space and frequency .",
    "the level @xmath65 is depopulated either by emission of a he  i ly@xmath2 photon ( @xmath101 ) or a 2.06@xmath102 m photon ( @xmath103 ) . due to the large resonant line opacity , the he  i ly@xmath2 will be scattered locally many times without traveling far .",
    "it will eventually be absorbed locally ( `` on the spot '' ) by h@xmath3 or else decay to @xmath63 .",
    "note that the `` on the spot '' approximation is used due to the large he  i ly@xmath2 resonant opacity and not the h@xmath3 opacity .",
    "what is @xmath104 , the probability of the he  i ly@xmath2 photon being absorbed by h@xmath3 as opposed to the transition @xmath105 occurring ?",
    "the average number of resonant scatterings before decay to 2@xmath77 is @xmath106 ( @xcite ) .",
    "the mean free path between scatterings , @xmath107 , is @xmath108^{-1}$ ] , where the line opacity is + @xmath109/\\delta\\nu_d \\ , \\label{lyal}\\ ] ]    where @xmath110 , the oscillator strength of the transition , is 0.29 .",
    "@xmath111 is the displacement of the frequency of the photon from the line center , in doppler widths .",
    "this displacement is determined by the speed the atom had before recombination , and so has a maxwellian probability distribution ( if we neglect any non - thermal components in the _ local _ velocity distribution ) .",
    "the maxwell - boltzmann distribution can be written @xmath112 $ ] and @xmath113 ) , with @xmath114 .",
    "we average over the line profile :    @xmath115\\rangle\\\\ & = { { \\int_0^\\infty \\exp[-(v / v_{\\rm th})^2]\\ , v^2 \\exp[-(v / v_{\\rm th})^2]\\,{\\rm d}v}\\over { \\int_0^\\infty v^2\\,\\exp[-(v / v_{\\rm th})^2]\\,{\\rm d}v } } \\nonumber \\\\ & = 2^{-3/2}\\ .\\end{aligned}\\ ] ]    the number of absorptions by h@xmath3 during the 914 scatterings is 914 @xmath116 , with @xmath117 @xmath118 .",
    "the probability of the photon being absorbed by h@xmath3 is    @xmath119 } } \\nonumber \\\\ = \\left(1 + 0.77",
    "f({\\rm he}^0)/[f(\\rm h^0 ) ( t/10 ^ 4\\,\\rm k)^{1/2 } ] \\right)^{-1}\\ , \\end{aligned}\\ ] ]    where @xmath120 and @xmath121 are the neutral fractions of he and h , respectively , and he / h = 0.1 in abundance has been assumed .",
    "the @xmath122 favors he , especially for softer exciting stars .",
    "for instance , the inner parts of the nebula surrounding a 40000  k black body favor he@xmath3 by a factor of @xmath07 , so 80% of transitions to 2@xmath123 are converted to 2@xmath77 rather than being absorbed by h@xmath3 . for harder exciting spectra ,",
    "the @xmath124 is @xmath12 , and a significant number of ly@xmath2 photons are absorbed by h@xmath3 .",
    "heating by ly@xmath2 is significantly greater than from 2-photon emission .",
    "however , the ( 2@xmath125 ) photons are far more important than any from the singlets as regards both ionization and heating .    in the `` on - the - spot '' treatment , local absorptions of ly@xmath2",
    "are exactly balanced by local emissions .",
    "the rate of `` on - the - spot '' absorptions by h@xmath3 is @xmath126 times the rate of recombinations into he@xmath127 ) , or @xmath128 .",
    "these absorptions by h@xmath3 are also given by @xmath129 $ ] . by equating these rates",
    ", we obtain a modified ionization balance equation for h :    @xmath130\\ ; , \\end{aligned}\\ ] ]    where the @xmath97 does not include he  i ly@xmath2 , which is contained in the final term on the right side of the equation .",
    "the rate of exchange of an electron between an ion ( @xmath88 ) and h@xmath3 or he@xmath3 can be comparable to or exceed the radiative recombination rates . with our adopted charge exchange cross sections @xcite , the rate of transitions into n@xmath9 , o@xmath3 , and o@xmath4",
    "are seriously affected or dominated by exchange with h@xmath3 . the opposite effect , in which charge exchange dominates the ionization of the lower stage , takes place for o@xmath3 .",
    "a result is that in regions where o@xmath3 is important ( i.e. , h@xmath3 is appreciable ) , ( o@xmath3/o@xmath131 9/8 ( h@xmath3/h@xmath4 ) for all @xmath132 because the ionization potential of o@xmath3 is almost the same as for h@xmath3 ( see @xcite , p. 42",
    "for a discussion . ) for n@xmath3 , charge exchange is not dominant but not negligible .",
    "we included the reactions in the rates for reactions resulting in n@xmath4 and o@xmath4 as well",
    ".    with charge exchange included , the ( o@xmath3/o@xmath4 ) equation becomes    @xmath133 = \\nonumber\\\\ & n({\\rm o}^+)\\,[n_e\\,\\alpha_{\\rm rec}({\\rm o}^+ ) + n({\\rm h}^0)\\,c_{\\rm exch}({\\rm o}^+,\\,{\\rm h}^0)]\\ ; .\\nonumber\\end{aligned}\\ ] ]    the situation regarding charge exchange with he@xmath3 is less clear because the cross section is very difficult to compute . we account for charge exchange with he@xmath3 for interactions resulting in n@xmath4 , n@xmath9 , and o@xmath4 .",
    "the temperature is determined by finding the root of @xmath134 , where @xmath135 and @xmath136 are the heating and cooling rates due to the processes described below ( see chapter  3 of @xcite ) .",
    "we consider only heating by photoionization of h and he and calculate the heating rate in each grid cell in the same manner as we calculated the photoionization rate .",
    "for example , for photoionization of he the heating rate is    @xmath137    so we form integrals analogous to the photoionization rate    @xmath138 \\sum l a_{\\nu } ( { \\rm he}^0 ) ( h\\nu - h\\nu_{{\\rm he}^0})\\ ; .\\end{aligned}\\ ] ]    as with photoionization , we assume `` on - the - spot '' heating by he  i ly@xmath2 packets , so a term @xmath139 $ ] is added to the heating per volume of each cell .      cooling rates as a function of temperature , @xmath140 , due to recombination of h@xmath4 and he@xmath4 are taken from hummer ( 1994 ) and hummer & storey ( 1998 )",
    ". the cooling rate due to free - free radiation is given by @xcite :    @xmath141\\ , n_e\\,g_{\\rm ff}\\sqrt",
    "t_e \\ ; , \\ ] ]    where we use the @xcite fit to the free - free gaunt factor data in @xcite    @xmath142 } \\ ; .\\ ] ]      we include collisional excitation of the lowest five levels of the ions of n@xmath3 , n@xmath4,o@xmath3,o@xmath4,o@xmath9",
    ", ne@xmath9 , s@xmath4 , and s@xmath9 , and of 2 levels of n@xmath9 and ne@xmath4 , as in other photoionization codes ( e.g. , @xcite ) . for this cooling by collisionally excited forbidden lines we use the einstein a values and collision strengths from the compilation by @xcite as updated on a. pradhan s webpage.pradhan/ ]",
    "after each iteration , we simultaneously solve for the ionization and temperature using the equations outlined above .",
    "the code will converge quickly if we have a good first guess of the ionization and temperature structure .",
    "however , for the 3d problems that we wish to address , such a guess will be very difficult to make .",
    "we therefore start the first iteration assuming that h and he are fully ionized , so all stellar photons exit the grid on the first iteration , but do contribute to the mean intensity counters .",
    "if we started with a neutral grid , photon packets could not diffuse far from their point of origin due to the large neutral opacity and convergence would be very slow , if at all .",
    "as in @xcite , we run several iterations with a small number of photon packets to get a rough idea of the ionization and temperature structure : @xmath143 packets for the first eight iterations , up to @xmath144 for higher iterations @xmath14520 .",
    "our models are well converged within 12 iterations ; the higher iterations with large numbers of photon packets provide higher signal - to - noise for the ionization and temperature structure .    in 3d simulations ,",
    "the diffuse field ionizes walls strongly inclined to the direction to the star .",
    "we find a good early approximation to the diffuse field by initially setting all cells to be fully ionized , thereby predicting the diffuse radiation field if the nebula were fully ionized .",
    "for the next iteration , if the stellar radiation can not maintain a high degree of ionization the outer material becomes almost neutral , since the diffuse field is much weaker than the stellar field .",
    "the structure reaches a good approximation to the eventual diffuse field after about five iterations .",
    "if the shadowed regions were allowed to turn neutral before the diffuse field had converged , we would face the same convergence problem ( with each new iteration ionizing a small zone of previously neutral material ) described above .",
    "we run our code on a single desktop machine within a reasonable cpu time ( see @xcite for a discussion of code speed up via parallelization ) , running @xmath01.0 m photon packets per minute on a 2.4 ghz processor .",
    "we use standard references for the line and continuum emissivities ( @xcite ; @xcite ; @xcite ; @xcite ) .",
    "we take the photoionization cross section for h from the fitting formula of @xcite .",
    "the recombination rate to all levels @xmath146 is given by the fitting formula in @xcite .",
    "for the recombinations to the ground state , @xmath147 , we fitted the temperature dependent rates in osterbrock ( 1989 , table 2.1 ) , with    @xmath148    for he we use the @xcite formula for the photoionization cross section . for the recombination rates we use the fitting formulae in table  1 of @xcite that give us the direct recombination rates to the ground level , @xmath66 , and the effective rate to @xmath64 .",
    "we calculated the effective rates to @xmath65 and to @xmath63 , ignoring the @xmath105 transition because we separately consider its competition with absorption by h ( see the discussion in  4.1 ) .",
    "the rates to @xmath65 and @xmath63 were formed by adding the direct recombination rates ( @xcite , table  1 ) , effective rates for @xmath149 ( table  3 ) , and effective rates from all lines for @xmath150 that connect to the appropriate lower level ( table  5 ) . in summary ,",
    "@xmath151    thus enabling us to form the probabilities for reprocessing packets by he (  [ hei ] ) .    the ionization cross section for the ions we use are taken from @xcite and the radiative recombination rates are from @xcite . also important in the recombination are dielectronic recombination rates , for which we use values determined by nussbaumer & storey ( 1983 , 1984 , 1987 ) for n , o , and ne .",
    "the dielectronic recombination rates for sulphur have not been calculated , and we normally use those recommended by @xcite for the first four ionization stages of s : @xmath152 , @xmath153 , @xmath154 , and @xmath155 , which are the mean rates for the first four atoms / ions of c , n , and o as discussed by @xcite .",
    "the charge exchange rates are taken from @xcite for reactions with h@xmath3 and from @xcite for those with he@xmath3 .",
    "any 3d photoionization code must reproduce two benchmark tests of blackbody exciting stars ionizing uniform spherical nebulae of a specified composition .",
    "the benchmarks have been discussed extensively in workshops ( @xcite , @xcite ; see these for the details of the input parameters ) .",
    "results of many codes are given in table 1 ( for a 40kk central star ) and table 2 ( @xmath156 = 20kk ) .",
    "the authors of the other codes are given in the footnote to table 1 .",
    "the dielectronic recombination coefficients assumed for s are zero for s@xmath9 and those in @xcite for s@xmath12 and s@xmath157 .",
    "we believe these were adopted by most of the models in each table .",
    "some models in the benchmark took the optical depths of fine structure lines into account , but we did not .",
    "our results are given in the last column in each table .",
    "figure  1 shows plots of ionization and temperature with radius for the @xmath158 = 40000  k benchmark and compares our results ( crosses ) with the monte carlo photoionization code mocassin @xcite ( squares ) and the widely used code cloudy @xcite ( lines ) .",
    "figure   2 presents the same quantities for the @xmath158 = 20000  k benchmark . in comparing with mocassin",
    ", we set up the density grids to have the same spatial resolution : our code used a grid of @xmath159 cells and mocassin , which utilizes the symmetry of the benchmark , performed the radiation transfer in an @xmath160 octant .",
    "for these simulations our code used @xmath144 photon packets and mocassin used @xmath161 energy packets in the final ( 20th ) iteration , though both codes had essentially converged by iteration 14 . among the three codes ,",
    "the ionization fractions are all in very good agreement . because of our 65@xmath162 grid resolution",
    ", our code produces slightly more ionization at the outer edge .",
    "there is a larger spread in the predicted temperatures for the hot benchmark , with our code being slightly hotter in the inner portions of the nebula and mocassin being slightly cooler towards the edge of the nebula .",
    "the agreement for the cool benchmark temperatures is very good .",
    "the large spread of some ionization fractions ( e.g. , o@xmath9/o in fig .",
    "2 ) illustrates a property of monte carlo codes unless special steps are taken .",
    "the ionization potential of o@xmath4 is 35.1 ev ; an ionizing photon is so rare that even with @xmath144 photon packets there is considerable statistical noise .",
    "if an accurate prediction of the ( o@xmath9/o ) were one of our goals , we could have forced energetic stellar photons to be emitted and then correct the results by the known probabilities of the events we forced .",
    "the cubic nature and limited spatial resolution of our grid makes the comparison problematic for one ion , o@xmath3 , mainly found in the very outermost regions of the nebula . in these regions ,",
    "( o@xmath3/o@xmath4 ) = 9/8 h@xmath3/h@xmath4 because of a resonant charge exchange between o@xmath4 and h@xmath3 .",
    "there is a rather sharp peak in the temperature because of the hardening of stellar radiation caused by selective absorption within the nebula , and a steep temperature gradient because of the large opacity . with better spatial resolution ,",
    "the volume occupied by one cell would contain regions of almost neutral hydrogen , so the temperature assigned to the whole cell , and the strength of [ o  i ] @xmath1636300 , are of limited meaning .",
    "we present results from our cells with h@xmath3/h @xmath164 0.25 ; the cells more neutral than this amount occur in the outer @xmath11% of the radius ( @xmath165 cm for the 40kk benchmark model , as opposed to 1.463@xmath166 cm for the average radial distance ) . in real h  ii regions ,",
    "dynamical effects dominate in these outer regions , where ionized gas is flowing away from the ionization front . with 65 cells on a side and the star at the centre",
    ", each cell has a width of 3% of the radius .",
    "thus , the region we disregard ( with hydrogen being @xmath14525% neutral ) is much less than the width of each cell .",
    "we want to identify  extreme \" predictions , defined by being outside of the range shown by the other models .",
    "one way of describing them @xcite is the  isolation factor \" , the ratio of our value to the next most extreme .    for the 40kk benchmark ,",
    "our code provides three extreme values , two within 4% of the nearest value .",
    "our [ siii ] @xmath1639532 + 9069 prediction is 12.5% larger than that from the rubin code ( rr in the table ) .",
    "rubin s code ( rr ) , mocassin ( be ) , and harrington s ( ph ) are the only ones that use detailed radiative transfer rather than an approximation such as  outward only . \"    for the 20kk benchmark , the results are very similar .",
    "we are extreme in six quantities , by @xmath15% in all but two .",
    "the worst are [ o  iii ] @xmath1635949,5007 and ( 52@xmath102 m + 88@xmath102 m ) , ( 10% and 8% more than t. kalman s xstar ) .",
    "we did not account for optical thickness in these lines , so our high predictions are understandable .",
    "also , for this cool model our photon statistics for o@xmath9 are problematic , as discussed above .",
    "since 1d codes can provide excellent spatial resolution by inserting zones wherever there are steep gradients , especially at the outer edges where the temperature is changing rapidly , we feel that the benchmark results are satisfactory .",
    "one simple check is available for the cool model .",
    "there are relatively few he - ionizing stellar photons , and it is simple to show that he absorptions strongly dominate h for he - ionizing photons . each he ionization is followed by the emission of 0.96 h - ionizing photons @xcite .",
    "thus , the ratio of @xmath167 is the ratio of the he - ionizing to h - ionizing stellar luminosities , 0.49 for a @xmath168 = 20 kk blackbody .",
    "our code predicts 0.47 , suggesting that our relatively coarse cell size is satisfactory for predicting he@xmath4/h@xmath4 and other ionic abundances .",
    "line / h@xmath169 & gf & hn & dp & tk & ph & rs & rr & be & wme + @xmath170 & 2.06 & 2.02 & 2.02 & 2.10 & 2.05 & 2.07 & 2.05 & 2.02 & 2.01 + he i 5876 & 0.119 & 0.112 & 0.113 & 0.116 & 0.118 & 0.116 & - & 0.114 & 0.114 + c ii 2325 + & 0.157 & 0.141 & 0.139 & 0.110 & 0.166 & 0.096 & 0.178 & 0.148 & 0.172 + c iii 1907 + 1909 & 0.071 & 0.076 & 0.069 & 0.091 & 0.060 & 0.066 & 0.074 & 0.041 & 0.078 + n ii 122@xmath102 m & 0.027 & 0.037 & 0.034 & - & 0.032 & 0.035 & 0.030 & 0.036 & 0.031 + n ii 6584 + 6548 & 0.669 & 0.817 & 0.725 & 0.69 & 0.736 & 0.723 & 0.807 & 0.852 & 0.742 + n ii 5755 & 0.0050 & 0.0054 & 0.0050 & - & 0.0064 & 0.0050 & 0.0068 & 0.0061 & 0.0057 + n iii 57.3@xmath102 m & 0.306 & 0.261 & 0.311 & - & 0.292 & 0.273 & 0.301 & 0.223 & 0.308 + o i 6300 + 6363 & 0.0094 & 0.0086 & 0.0088 & 0.012 & 0.0059 & 0.0070 & - & 0.0065 & 0.011 +",
    "o ii 7320 + 7330 & 0.029 & 0.030 & 0.031 & 0.023 & 0.032 & 0.024 & 0.036 & 0.025 & 0.033 + o ii 3726 + 3729 & 1.94 & 2.17 & 2.12 & 1.6 & 2.19 & 1.88 & 2.26 & 1.92 & 2.23 + o iii 52 + 88@xmath102 m & 2.35 & 2.10 & 2.26 & 2.17 & 2.34 & 2.29 & 2.34 & 2.28 & 2.42 + o iii 5007 + 4959 & 2.21 & 2.38 & 2.20 & 3.27 & 1.93 & 2.17 & 2.08 & 1.64 & 2.34 + o iii 4363 & 0.00235 & 0.0046 & 0.0041 & 0.0070 & 0.0032 & 0.0040 & 0.0035 & 0.0022 & 0.0044 + ne ii 12.8@xmath102 m & 0.177 & 0.195 & 0.192 & - & 0.181 & 0.217 & 0.196 & 0.212 & 0.192 + ne iii 15.5@xmath102 m & 0.294 & 0.264 & 0.270 & 0.35 & 0.429 & 0.350 & 0.417 & 0.267 & 0.263 + ne iii 3869 + 3968 & 0.084 & 0.087 & 0.071 & 0.092 & 0.087 & 0.083 & 0.086 & 0.053 & 0.063 + s ii 6716 + 6731 & 0.137 & 0.166 & 0.153 & 0.315 & 0.155 & 0.133 & 0.130 & 0.141 & 0.18 + s ii 4068 + 4076 & 0.0093 & 0.0090 & 0.0100 & 0.026 & 0.0070 & 0.005 & 0.0060 & 0.0060 & 0.0094 + s iii 18.7@xmath102 m & 0.627 & 0.750 & 0.726 & 0.535 & 0.556 & 0.567 & 0.580 & 0.574 & 0.623 + s iii 9532 + 9069 & 1.13 & 1.19 & 1.16 & 1.25 & 1.23 & 1.25 & 1.28 & 1.21 & 1.44 + @xmath171/ & 4.88 & - & 4.95 & - & 5.00 & 5.70 & - & 5.47 & 4.96 + @xmath172/k & 7719 & 7668 & 7663 & 8318 & 7440 & 7644 & 7399 & 7370 & 7743 + @xmath173>$]/k & 7940 & 7936 & 8082 & 8199 & 8030 & 8022 & 8060 & 7720 & 8183 + @xmath174 cm & 1.46 & 1.46 & 1.46 & 1.45 & 1.46 & 1.47 & 1.46 & 1.46 & 1.45 + @xmath175 & 0.787 & 0.727 & 0.754 & 0.77 & 0.764 & 0.804 & 0.829 & 0.715 & 0.771 +          the structure of the shadow zone behind a small high - density clump of gas , such as those found in the planetary nebula ngc  7293 , is of direct astrophysical interest .",
    "there have been several treatments of such a shadowed zone .",
    "approximate static models have also been considered by @xcite and @xcite .",
    "an analytical treatment is given by @xcite , who considered dynamical evolution of the shadowed region and its ionization and temperature structure .",
    "these assume that the radiation field incident upon the shadow is the diffuse field within the h  ii region , estimated by assuming that the nebula is thick to its own diffuse radiation _ and that there is no diffuse radiation produced by _ he .",
    "we tested the influence of he upon the ionization and temperature of a shadowed zone by comparing two models , one with the benchmark composition and one with the same h and heavy elements but no helium .",
    "both used the geometry similar to that in @xcite : a flat circular clump at @xmath176 = 0 , completely opaque to incident plane - parallel starlight out to its outer edge , so that it acts as a circular plate blocking stellar radiation incident normally upon it .",
    "we chose the uniform nebular density ( 100  @xmath8 ) so that the stellar radiation is completely absorbed along the 6.2 pc @xmath176 axis of the cube , even far from the clump .",
    "the ionizing spectrum is that of a 40000  k blackbody with an ionizing flux of @xmath177  @xmath178  s@xmath25 .",
    "the radius of the occulting disk is 1.14 pc .",
    "we used periodic boundary conditions , meaning that when a photon exits one ( @xmath179 ) face of the cube it reappears on the other side .",
    "photons incident upon the @xmath176 = 0 face from within the cube are reflected back into the cube .",
    "the ionization in the shadow is indicated by fig .",
    "[ tvshadow ] for the standard benchmark composition .",
    "we see that the diffuse radiation can penetrate relatively deeply into the shadow near the bottom of the figure ( near the plate ) ; the incident intensity is large because h is highly ionized . in this case , diffuse photons produced within relatively large distances can reach the shadow . at large @xmath176 , near the top of the figure ,",
    "the opacity in the directly illuminated regions is relatively large , the nebular radiation into the shadow is correspondingly low , and the ionized region has a sharp edge .",
    "figure [ tvsrz ] shows @xmath180 vs. @xmath181 , the distance from the axis of the shadow relative to the cloud s radius , and also @xmath180 vs. @xmath176 , the distance along the shadow axis .",
    "heavy lines are for standard composition ; light lines show the no - he models .",
    "[ tvsrz](a ) shows @xmath180 , plotted against @xmath176 , at @xmath182 = 1.17 ( solid line ) , 1.01 ( long dashes ) , and 0.964 ( short dashes ) .",
    "the lines terminate when h becomes @xmath18395% neutral .",
    "we see that for the inner no - he model ( light short dashes ) , @xmath184 ) is much lower than the other temperatures at all @xmath176 , as predicted in @xcite . h recombination radiation has a mean energy of only @xmath185 = 0.4 ev , and the mean number of photons produced is @xmath186 .",
    "values of these functions are given in @xcite .",
    "photons released during the cascade following he recombinations ( mostly the 19.8 ev 2@xmath187s line ) can release @xmath188  ev  =  6.3 ev in photoelectric heating with each ionization and penetrate @xmath03 times as far as h recombinations in the shadow .",
    "thus , the he recombination photons have a major effect on the heating even though there are 10 times as many from h. even just outside of the shadow ( the long dashed curves ) the shadow temperature is about the same as far from the cloud ( the solid curve ) , until the he becomes neutral in the gas fully illuminated by the star , at the point of the slight blip at @xmath1893.9 pc in the heavy solid curve . outside of the shadow ,",
    "we see the expected increase of @xmath180 with @xmath176 , showing the effect of hardening the stellar radiation , for both helium- and no - helium models .",
    "( since we did not account for cooling by collisional excitation of h lines , the maximum temperature reached by the no - he model is probably significantly too large . ) within the shadow ( short dashes ) , there is little change of @xmath168 with @xmath176 because the spectrum of the ionizing recombination radiation changes little along the axis of the shadow . within the shadow ,",
    "@xmath190 for the he models ( heavy short dashes ) is significantly less than outside , so the collisionally excited line strengths are appreciably weaker .",
    "[ tvsrz](b ) shows @xmath180 plotted against @xmath191 ) at two values of @xmath176 : solid lines are for @xmath176 = 0.1  pc ; dashed for 2.6  pc . as before , the thick lines are for models with he , the thin for no helium .",
    "the inward drop of @xmath192 at @xmath193 is obvious .",
    "we see that the low @xmath132 of the no - he models holds at all @xmath194 .",
    "there is an increase in @xmath192 near the center for the helium models because the outer part of the shadow is mainly ionized by the soft recombination photons from h , while the he photons penetrate and deposit more energy when they are absorbed .",
    "there is no similar effect for the no - he shadow ; all ionizing photons are soft .",
    "we see the penetrating power of the he photons into the shadow . outside the shadow",
    "@xmath192 decreases somewhat with increasing @xmath194 because the harder diffuse photons can reach the shadow more easily than the softer .",
    "this example shows the importance of diffuse helium radiation in shadow regions and may also help explain why he is less ionized than h in the diffuse ionized gas @xcite .",
    "it shows that any treatment of the nebular diffuse radiation field inpinging onto shadowed regions must include a careful treatment of the helium recombination radiation .",
    "we will investigate this effect and other 3d photoionization models in future papers .",
    "an anonymous referee provided helpful comments .",
    "jsm thanks a pparc visitors grant to the university of st .",
    "andrews , kw acknowledges support from a pparc advanced fellowship .",
    "we thank kirk korista for comments and providing the cloudy benchmark models and mike barlow and barbara whitney for comments on early versions of the paper .",
    "the mocassin tests were carried out on the enigma sunfire cluster , at the hiperspace computing centre , ucl , which is funded by pparc .",
    "pquignot , d. , et al .",
    "2001 , in `` spectroscopic challenges of photoionized plasmas '' , g. ferland & d. w. savin , eds . , asp conference series vol . 247 .",
    "san francisco : astronomical society of the pacific , 533"
  ],
  "abstract_text": [
    "<S> we have developed a three dimensional monte carlo photoionization code tailored for the study of galactic h  ii regions and the percolation of ionizing photons in diffuse ionized gas . </S>",
    "<S> we describe the code , our calculation of photoionization , heating & cooling , and the approximations we have employed for the low density h  ii regions we wish to study . </S>",
    "<S> our code gives results in agreement with the lexington h  ii region benchmarks . </S>",
    "<S> we show an example of a 2d shadowed region and point out the very significant effect that diffuse radiation produced by recombinations of helium has on the temperature within the shadow .    </S>",
    "<S> [ firstpage ]    radiative transfer  ism  h  ii regions </S>"
  ]
}