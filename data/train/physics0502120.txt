{
  "article_text": [
    "about sixty years have passed since the first , pioneering works on synchrotron radiation have been published ( see @xcite and references therein ) .",
    "the way scientists consider this phenomenon has drastically changed during this period . at first , synchrotron radiation was regarded only as a detrimental factor , a limitation on the maximal particle energy attainable with accelerators ( see , for instance , @xcite ) .",
    "nowadays it is an outstanding research tool allowing continuous advancement of both fundamental and applied sciences and it is used worldwide by tens of thousands of scientists from many different disciplines like physics , chemistry , material sciences and structural biology .",
    "the properties of synchrotron radiation can be derived by applying the methods of classical electrodynamics to the motion of relativistic electrons ( or positrons ) in magnetic structures like bending magnets or undulators .",
    "the theory of synchrotron radiation based on the works by iwanenko , pomeranchuk and schwinger has been described in detail both in convenient summaries @xcite as well as in textbooks @xcite .    on the one hand , these texts contain derivation of fundamental equations describing spectral - angular properties of synchrotron radiation in the far - zone for single electrons . a usual starting point for quantitative descriptions of these properties",
    "is provided by the formulas for the lienard - wiechert fields @xcite .    on the other hand , in relation with the construction of beam lines at synchrotron radiation facilities it is important to understand the modifications to single particle treatment which is due to realistic beams with given cross section area , divergence and energy spread .",
    "this raises several questions .",
    "first , discussing finite electron beam emittance effects , an obvious remark is that , in the case of second generation light sources , the emittance of the electron beam was much larger than the radiation wavelength of interest . as a result ,",
    "both photons and electrons phase space had the same hamiltonian structure , and properties of radiation could be treated on the basis of geometrical optics .",
    "in recent years though , more and more specialized and optimized synchrotron radiation sources have started operation . during design and optimization of these sources much emphasis",
    "has been directed at reducing the transverse phase space area of the electrons . among the most exciting properties of today s third generation sources",
    "is the tiny vertical emittance which is an order of magnitude smaller than @xmath3 ( for design parameters of an up - to - date source see , for instance , @xcite ) . in this case",
    "geometrical optics can not be applied any more and even basic properties like angular distribution of intensity at fixed frequency , or spectral intensity distribution at fixed observation angle should be calculated applying full electromagnetic equations .",
    "a second question arises considering the features of undulator insertion devices . in older sources ,",
    "typical length of insertion devices was about @xmath4 m , while the distance to the user station was of order @xmath5 m. in this situation the asymptotic formulas for the far zone could be applied and the question of their applicability region was of theoretical interest only . nowadays installation of @xmath6 meter - long undulators has been planned at petra iii ( see @xcite ) and distances between source and observer of several tens of meters have been proposed . a similar device ( a @xmath7 m long segmented undulator with no focusing elements between the segments ) has been installed and operates at spring-8 ( see @xcite ) . in this situation applicability region of far - field formulas and",
    "correction for near field effects are of actual practical importance , not to mention the interest for far infrared edge radiation .",
    "another problem is related with the increasing complexity of insertion devices .",
    "for instance at petra iii ( see again @xcite ) , installation of two undulators segments separated by a focusing triplet in between has been proposed to obtain small vertical betatron functions .",
    "computation of radiation characteristics from these novel devices constitute a rather challenging problem .",
    "furthermore , a question which is somewhat related to all the previous ones is linked with the dramatic increase of brilliance achieved in third generation light sources with respect to older designs , which has triggered a number of new techniques and experiments unthinkable before . among the most exciting properties of today third generation facilities",
    "is the high flux of coherent x - rays provided .",
    "the availability of intense coherent x - ray beams has fostered the development of new coherence based techniques like fluctuation correlation dynamics @xcite , phase imaging @xcite , and coherent x - ray diffraction ( cxd ) @xcite .",
    "in all these fields , the understanding of the evolution of transverse coherence properties along the beam line is of uttermost importance : in particular , both the beam size and divergence should be taken into account in the evolution model .    as one can see these questions address quite different physical phenomena ; yet they all belong to the field of synchrotron radiation .",
    "this number of different issues stems from the fact that practical applications make use of a very wide range of radiation wavelengths , from @xmath8 to @xmath9 m , which span over seven orders of magnitude .",
    "it is no surprise that very different problems arise when the wavelength of interest is tuned to such different regions of the electromagnetic spectrum .",
    "considering , for instance , bending magnet radiation , it is clear that near field effects will be of practical importance for fir ( far infra - red ) applications but hardly for x - ray radiation , because of its much shorter radiation formation length . on the other hand",
    ", the influence of the emittance on x - ray radiation will be important because the magnitude of the emittance is comparable with the radiation wavelength , but it will be negligible when it comes to the characterization of fir radiation properties , since in this case the wavelength of interest is way larger than the emittance .    as a result , all the matters mentioned above are of great practical importance in some particular region of the spectrum , although they are systematically neglected in synchrotron radiation textbooks and reviews .",
    "reaction of synchrotron - radiation - users communities to this set of problems was the development of computer codes capable to calculate radiation properties from realistic setups starting from first principles @xcite . at first glance",
    "this settles all issues since , at least from a practical viewpoint , users have the possibility to calculate all the properties they need .    yet",
    ", computer codes can calculate properties for a given set of parameters , but can hardly improve physical understanding , which is particularly important in the stage of planning experiments .",
    "understanding of correct approximations and their region of applicability can simplify many tasks a lot , including practical and non - trivial ones .",
    "the use of dimensional analysis in an analytical framework is of uttermost importance to this goal . by that",
    ", dimensionless quantities of physical interest can be easily identified . in particular , dimensionless parameters",
    "much smaller ( or much larger ) than unity always correspond to simplifications of fundamental equations : most physical theories originate from recognizing and taking advantage of such small ( or large ) quantities .",
    "in contrast , relying only on computational power to solve physical problems , besides being inelegant , would automatically neglect the presence of small ( or large ) parameters and simplifications related to them .",
    "the lack , or poor understanding of approximations involved in a certain theory will result , in its turn , in poor understanding of the mechanisms involved in physical phenomena which would undoubtedly result in gross mistakes .",
    "moreover , just a few codes are available , which can be modified to account for particular situations ( like coherence properties or radiation characteristics from a complex insertion device for instance ) by a few experts only , while there are about twenty facilities each with its own set of particular setups and situation to be accounted for .",
    "we propose to overcome all these difficulties by developing a theory of synchrotron radiation which accounts for all complexities analytically .",
    "analytical approach will help to understand physics of real synchrotron radiation sources , thus filling the gap between idealized textbook analysis and actual situations .",
    "we will make explicit use of small ( or large ) parameters involved in the description of cases of practical interest . in this way we will reduce problems as much as possible , to a level where physical insight is easy , so that simple computer codes , capable to describe the situation under study , can be developed also by non - expert programmers . in this process",
    "we will put particular care in the specification of the region of applicability and of the accuracy of the approximations made , which is usually neglected in analytical calculations .    in the next section",
    "we discuss methods for computation of synchrotron radiation from a single particle on a generic trajectory .",
    "we start reviewing the two algorithms used today , the first based on lienard - wiechert fields , the second on lienard - wiechert potentials .",
    "we propose to start calculations from the very beginning by solving paraxial maxwell equations for a given harmonic of the field .",
    "this is , from a logical and educational viewpoint , the most natural way to perform calculations ; from a computational viewpoint it is also the simplest way .",
    "the use of a paraxial approximation is justified by the features of an ultra relativistic system characterized by a lorentz factor @xmath10 : radiation formation length is , then , much longer than the wavelength , and the radiation is distributed within a cone with opening angle much smaller than unity .",
    "maxwell equation for a given harmonic of the field @xmath11 , which has elliptic characteristic , can be then transformed into a parabolic equation .",
    "we solve this equation with the help of an appropriate green s function thus coming , in section [ sec : gene ] , to a very generic expression for @xmath12 .",
    "we end the section by addressing the obvious question of the relation between our method , and the two algorithm introduced at the beginning .",
    "subsequently we apply our expression to recover some well - known and less well - known properties of synchrotron radiation from bending magnets and undulators , in section [ sec : bend ] and section [ sec : undu ] respectively .",
    "this is far from being a mere repetition of already known results .",
    "in fact our method will prove superior when it comes to physical understanding and determination of applicability region and accuracy of approximations : this has , of course , important application in estimation of practical quantities , like field intensities , _ with their accuracy_. we will also discuss in detail the methodological issues about definition of fields and intensities from single devices . as an example of application of our new understanding we will show , in section [ sec : appl ] , how radiation characteristics from a complex setup can be discussed in very simple terms .",
    "finally , in section [ sec : conc ] we come to conclusions .",
    "there are two basic methods which are used to calculate synchrotron radiation characteristics .",
    "the first @xcite is based on lienard - wiechert fields .",
    "it is the better known of the two and it is used in a very widespread way in textbooks .",
    "lienard - wiechert fields can be customary separated in a velocity and an acceleration term .",
    "usually , the acceleration part alone is analyzed in fourier components of the electric field vector :    @xmath13\\over{|\\boldsymbol{r_o}-\\boldsymbol{r'}(t')|\\left(1-\\boldsymbol{n}\\cdot{\\beta}\\right)^2 } } & & \\cr \\times \\exp\\left\\{i\\omega\\left(t'+{|\\boldsymbol{r_o}-\\boldsymbol{r'}(t')|\\over{c}}\\right)\\right\\}~ , \\label{rev1}\\end{aligned}\\ ] ]    where @xmath14 is the electron charge , @xmath15 is the unit vector from the particle to the observer position , @xmath16 is the particle position , @xmath17 is the observer position @xmath18 and @xmath19 are , respectively , the particle velocity , @xmath20 , normalized to the speed of light @xmath21 and its derivative , all calculated at time @xmath22 .",
    "it is clear that use of eq .",
    "( [ rev1 ] ) implies that the so - called velocity part of the field is neglected in the computation .",
    "the second method @xcite is based on lienard - wiechert potentials . as an alternative to the use of lienard - wiechert fields as a starting point for computations based on first principles , a few authors of scientific research papers start with the lienard - wiechert potentials @xmath23 .",
    "these can be decomposed in their harmonics @xmath24 which can be subsequently used to calculate @xmath25 according to    @xmath26    we failed to find textbooks using this second method for educational purposes : although some authors ( see @xcite for instance ) start their derivation with harmonic analysis of potentials , when it comes to actual calculation of synchrotron radiation they go back to the first method based on lienard - wiechert fields .",
    "questions arise about the relation between eq .",
    "( [ rev1 ] ) and eq .",
    "( [ rev2 ] ) .",
    "first , in contrast to eq .",
    "( [ rev1 ] ) , eq .",
    "( [ rev2 ] ) is exact , in the sense that the velocity field term is not neglected .",
    "it is then natural to ask what are the conditions for which the velocity field term in eq .",
    "( [ rev1 ] ) can be dropped , and with what accuracy this can be done .",
    "in fact , when approximated expressions like eq .",
    "( [ rev1 ] ) and its specialization to particular magnetic systems ( like undulators and bending magnets ) are found , special care should be taken in specifying their region of applicability and accuracy ; yet we failed to find , through references @xcite quantitative specification of accuracy of results obtained under given approximations .",
    "second , eq .",
    "( [ rev1 ] ) and eq .",
    "( [ rev2 ] ) are used both in the far and in the near field region and simplified under the paraxial approximation : it is important to understand relations between the paraxial approximation and the far or near field assumptions as well as region of applicability and accuracy of results .",
    "third , eq . ( [ rev1 ] )",
    "is often used together with integration by parts and neglecting the edge terms after integration : in this case it is interesting to ask what are the conditions which allow the edge terms to be dropped .",
    "moreover , as a remark to both methods , we should note that , in general , one needs to know the entire history of the electron from @xmath27 to @xmath28 since integration in eq .",
    "( [ rev1 ] ) and eq .",
    "( [ rev2 ] ) is performed between these limits .",
    "this statement should be interpreted , physically , depending on the situation under study : integration should in fact be performed from and up to times when the electron does not contribute to the field anymore .",
    "this does not present any problem in the case , for instance , of a circular motion because the particle trajectory is limited in space .",
    "in practical situation though , one deals with radiation from a beamline which is a composition of insertion devices , like undulators and bending magnets , and straight sections .",
    "the requirement of integration over the entire history of the electron poses , then , the following methodological problem : one has to give a meaning to the concept of _ radiation from a given insertion device _ , independently of the trajectory followed by the particle before and after the device .",
    "this problem will be discussed in more detail as we go through our paper . in general",
    "one can break up the electron trajectory in several parts , corresponding to physical devices like undulators , drifts and bending magnets , thus calculating the integral in eq .",
    "( [ rev1 ] ) or eq .",
    "( [ rev2 ] ) along a finite time interval which corresponds to a particular device . in doing this",
    ", it is assumed that the observer is located far away enough from the device , so that the velocity part of the field is negligible with respect to the acceleration part . in this way , again , dropping velocity field part in eq .",
    "( [ rev1 ] ) is justified and the results from eq .",
    "( [ rev1 ] ) and eq .",
    "( [ rev2 ] ) coincide .",
    "it is understood that different contributions from different devices must be accounted for with the correct relative phase relation to get the total @xmath11 as a sum of the separate contributions from single devices . in this way concepts like",
    "_ radiation field from a undulator _ or _ radiation field from a bending magnet _ have a well defined , practically useful meaning as partial contribution to the total field at the observation point .",
    "the concept of _ intensity _ is , instead , subtler , since it involves calculation of @xmath29 . in this case then , also interference terms between different devices should be accounted for , in the most generic case . only when these are not important the total spectral intensity from a given beamline can be broken up in the sum of separate terms from the single devices , and _ radiation intensity from a undulator _ or _ radiation intensity from a bending magnet _ are , then , well - defined .    finally , eq . ( [ rev1 ] )",
    "is based on the integration of maxwell equation in time and in the subsequent harmonic analysis .",
    "this is quite involved from a logical viewpoint : it is much simpler to start with the equations for a given harmonic @xmath30 so to obtain directly @xmath12 after integration of maxwell equations .",
    "a similar comment can be made regarding the way eq .",
    "( [ rev2 ] ) was obtained : first the potentials were found , then their fourier transform was taken . in both cases one is bound to solve the full maxwell equation even though the ultra relativistic nature of the systems considered in practice allows systematic application of a much more convenient paraxial approximation .",
    "note that , usually , paraxial approximation is applied , but only at a later stage , which often makes analytical derivations more involved , and region of applicability and accuracy of results difficult to specify .",
    "a system of electromagnetic sources can be conveniently described by its charge density @xmath31 and current density @xmath32 . in this paper",
    "we will be concerned about a single electron so that , using the dirac delta distribution , we can write    @xmath33    and    @xmath34    where @xmath35 and @xmath36 are , respectively , the position and the velocity of the particle at a given time @xmath37 in a fixed reference frame",
    ". we will assume that the particle trajectory is given @xmath38 , and that maxwell equations in vacuum allow a good description of the source field .",
    "in this case the magnetic field @xmath39 can be easily recovered when the electric field @xmath40 is known simply remembering    @xmath41    where @xmath42 is the unit vector pointing from the retarded position of the particle , @xmath16 to the position @xmath43 at time @xmath44 . therefore in this paper",
    "we will concentrate on the electric field @xmath45 .",
    "trivial manipulations of maxwell equations in @xmath46 system :    @xmath47    and    @xmath48    give the well - known equation for the electric field :    @xmath49    with the help of the identity    @xmath50    and poisson equation @xmath51 we obtain the inhomogeneous wave equation for @xmath40    @xmath52    eq .",
    "( [ diso ] ) is a partial differential equation of hyperbolic type .",
    "we introduce the fourier transform @xmath53 of a quantity @xmath54 as follows :    @xmath55    so that @xmath56 using the representation in eq ( [ fanti ] ) for the quantities in eq .",
    "( [ diso ] ) we get    @xmath57    eq .",
    "( [ trdiso ] ) is the well - known helmholtz equation which has elliptic characteristic . upon introduction of a fixed cartesian reference system @xmath58",
    ", it is always possible to define a quantity @xmath59 such that    @xmath60    however this definition is useful only in the case when @xmath59 varies slowly along @xmath61 with respect to the length @xmath62 : only in that case , in fact , eq . ( [ tildae ] ) is a useful factorization of @xmath12 as the product of a fast and a slowly varying function of @xmath61 . with the help of eq .",
    "( [ tildae ] ) one can write eq .",
    "( [ trdiso ] ) as    @xmath63    let us now write the equation for the sources with the help of the curvilinear abscissa @xmath64 , simply defined as @xmath65 . here",
    "we assume that @xmath66 is a constant .",
    "we will use the general property    @xmath67={\\sum_i { \\delta(x - x_i)\\over{\\mid f'(x_i)\\mid}}}~ , \\label{diracd}\\ ] ]    where @xmath68 are the zeros of @xmath69 .",
    "then , we will regard @xmath70 as @xmath71 $ ] , for any fixed value of @xmath61 .",
    "the only zero of @xmath54 will be readily indicated with @xmath72 , which is the value of @xmath37 for which @xmath73 , while @xmath74 .",
    "therefore , with the help of eq .",
    "( [ diracd ] ) we can write    @xmath75    then , using @xmath76 , eq .",
    "( [ charge ] ) and eq .",
    "( [ curr ] ) give    @xmath77    and    @xmath78    so that    @xmath79    and    @xmath80    by substitution in eq .",
    "( [ trdiso2 ] ) we obtain    @xmath81~.\\label{incipit}\\end{aligned}\\ ] ]    eq .",
    "( [ incipit ] ) is still fully general and may be solved in any fixed reference system @xmath58 of choice with the help of an appropriate green s function . in general",
    ", @xmath59 will vary , in @xmath82 , on a characteristic length which is related with @xmath83 , which enters in the green s function solution of eq .",
    "( [ incipit ] ) as a factor in the integrand .",
    "as it will be clearer after paragraph [ sub : disc ] , as we integrate along @xmath82 , the factor @xmath84 grows larger and larger leading , eventually , to a highly oscillatory behavior of the integrand which does not contribute anymore to the final integration result . the value of @xmath82 for which @xmath85 can be considered as a measure of the value of @xmath82 for which the integrand starts to display such oscillatory behavior and it is naturally defined as the radiation formation length @xmath86 of the system at frequency @xmath30 .",
    "it is easy to see by inspection that if @xmath87 is sensibly smaller than @xmath21 ( but still of order @xmath21 ) , i.e. @xmath88 but @xmath89 , then @xmath90 . on the contrary ,",
    "when @xmath87 is very close to @xmath21 , i.e. @xmath91 , the terms @xmath92 and @xmath93 tend to compensate so that @xmath94 .",
    "the exact expression for @xmath86 depends on the particular magnetic system , i.e. on @xmath95 , and on the frequency of interest @xmath30 .",
    "let us consider the assumption @xmath91 .",
    "we will hold this assumption fulfilled throughout our paper .",
    "in general , introduction of a small ( or large ) parameter in any theory brings simplifications .",
    "in particular the ultra relativistic approximation has two consequences : first , as just remarked , the radiation formation length is much larger than @xmath96 and , second , as it will be discussed in paragraph [ sub : disc ] , radiation is emitted in a narrow cone of opening angle much smaller than unity .",
    "accounting for these features of the radiation , and considering an electron moving on a given trajectory , there will always be , in practical cases of interest , some privileged reference system @xmath58 in which eq .",
    "( [ incipit ] ) is simplified in a paraxial form , due to the ultra relativistic assumption , for some set of observer points .",
    "geometry and reference system for synchrotron radiation problems in paraxial approximation.,width=340 ]    to apply such paraxial approximation we should first assume ultra relativistic motion and identify a main observer @xmath97 .",
    "then we can define a frame with the @xmath61 axis oriented as the tangent from some trajectory point @xmath98 , to @xmath97 . as it will be discussed in paragraph [",
    "sub : disc ] , using this frame we can describe radiation at @xmath97 from all points of the trajectory with velocity vector forming with the @xmath61 axis an angle much smaller than unity . in other words , for all these points @xmath99 : this condition is necessary and sufficient for the applicability of the paraxial approximation .",
    "this is not a restriction , in practice , because it still keeps open the possibility of angles much larger or much smaller than @xmath100 ( bending magnet or undulator case ) .",
    "the situation is described with a particular example for the case of a circular motion , in fig .",
    "[ srgeo ] .",
    "note that the reference frame used to describe radiation at @xmath97 can be also used for observers in the neighborhood of @xmath97 , provided that these form an angle much smaller than unity with respect to the velocity at @xmath98 .",
    "since we presented , as particular example , the case of a circular motion , it is worth to underline the difference between the frame depicted in fig .",
    "[ srgeo ] and the standard frame used for synchrotron radiation computations in fig .",
    "[ srstand ] : using the frame in fig .",
    "[ srstand ] we will never be able to describe the field at to observer locations displaced along the @xmath101 axis .",
    "this is required , for instance , if one needs to calculate the autocorrelation function of the field at those two points . on the contrary ,",
    "such a description is allowed with the choice of a frame like in fig .",
    "[ srgeo ] .",
    "standard reference frame for synchrotron radiation computations.,width=340 ]    since the radiation formation length is much longer than the wavelength , @xmath59 does not vary much along @xmath61 on the scale of @xmath96 , that is @xmath102",
    ". therefore , the second order derivative with respect to @xmath61 in the @xmath103 operator on the left hand side of eq .",
    "( [ incipit ] ) is negligible with respect to the first order derivative .",
    "this means that we can apply a paraxial approximation which considerably simplifies eq .",
    "( [ incipit ] ) as    @xmath104~,\\label{incipit2}\\end{aligned}\\ ] ]    where we consider transverse components of @xmath59 only and we substituted @xmath105 with @xmath21 , having used the fact that @xmath106 .",
    "( [ incipit2 ] ) is maxwell s equation in paraxial approximation .",
    "note that this approximation transformed eq .",
    "( [ incipit ] ) which is an elliptic partial differential equation , into eq .",
    "( [ incipit2 ] ) , which is of parabolic type .    the green s function for eq .",
    "( [ incipit2 ] ) , namely the solution corresponding to the unit point source , satisfies the equation :    @xmath107    and , in an unbounded region , can be written explicitly as    @xmath108    as usual we will denote source coordinates with _ primes _ and observer coordinates with the index _ o_. with the aid of the green s function @xmath109 , the solution of eq .",
    "( [ incipit2 ] ) can be represented as    @xmath110 & & \\cr \\times \\exp\\left\\{i\\omega\\left[{\\mid \\boldsymbol{{r_{\\bot o}}}-\\boldsymbol{r'_\\bot } \\mid^2\\over{2c ( z_o - z')}}+ \\left({s(z')\\over{v}}-{z'\\over{c}}\\right)\\right ] \\right\\ } ~ , & & \\cr \\label{blob}\\end{aligned}\\ ] ]    where @xmath111 represents the gradient operator with respect to the source point .",
    "the integration over transverse coordinates can be carried out leading to the final result :    @xmath112 ~ , \\label{generalfin}\\end{aligned}\\ ] ]    where the total phase @xmath113 is given by    @xmath114 + \\omega \\left [ { \\left(x_o - x'(z')\\right)^2+\\left(y_o - y'(z')\\right)^2\\over{2c ( z_o - z')}}\\right ] \\label{totph}\\ ] ]    eq . ( [ generalfin ] ) can be used in all generality to characterize radiation from an electron moving on any trajectory as long as the ultra relativistic approximation is satisfied , and a reference system suitable for paraxial approximation exists , which is always the case in situation of practical interest . note that both @xmath115 and @xmath116 polarizations terms in eq .",
    "( [ generalfin ] ) are a sum of two parts which can be traced back to current and charge densities : in fact , the first part , proportional to the particle velocity in the @xmath101 or @xmath117 direction , follows from the transverse current density @xmath118 .",
    "the second instead , follows from the gradient of the charge density @xmath119 .",
    "our result makes a consistent use of paraxial approximation and of harmonic analysis which brings simplicity and power to the method . in the following sections we will show how eq . ( [ generalfin ] )",
    "can be used to characterize bending magnet radiation and undulator radiation .      following the previous derivation very natural questions",
    "arise which regard the relation between our expression , eq .",
    "( [ generalfin ] ) , with eq .",
    "( [ rev1 ] ) and eq .",
    "( [ rev2 ] ) as well as the applicability region and the accuracy of our eq .",
    "( [ generalfin ] ) .    in order to investigate these subjects we go back to the most general eq .",
    "( [ trdiso ] ) and we note that it can be solved by direct application of the green s function for the helmholtz equation :    @xmath120    integrating by parts the term in @xmath121 we have    @xmath122&&\\cr\\times \\exp\\left\\ { i{\\omega\\over{c}}{\\mid \\boldsymbol{r_{o } } -\\boldsymbol{r'}\\mid}\\right\\ } \\label{hype}~.\\end{aligned}\\ ] ]    use of explicit expressions for @xmath123 , eq .",
    "( [ charge2tr ] ) , and @xmath124 , eq . ( [ curr2tr ] ) , leads straightforwardly to    @xmath125    finally , remembering @xmath126 we obtain eq .",
    "( [ rev2 ] ) .",
    "this result simply confirms that eq .",
    "( [ rev2 ] ) is derived under most general conditions ; the derivation that we proposed from direct use of fields is much less involved , from a logical viewpoint , with respect to the original , which makes use of potentials ( see @xcite ) and it may be interesting for educational purposes .",
    "it is interesting to note that the only approximation applied to eq .",
    "( [ trdiso ] ) in order to obtain , finally , eq .",
    "( [ generalfin ] ) was simply the paraxial approximation .",
    "we can easily see that if we apply paraxial approximation to eq .",
    "( [ rev2 ] ) we get back eq .",
    "( [ generalfin ] ) .",
    "let us show how this is possible .",
    "the choice of @xmath30 depends on our interest .",
    "then , our ultra relativistic approximation implies a formation length @xmath127 .",
    "moreover in practical cases , @xmath128 will always be at least of order @xmath86 , so that @xmath129 and , with an accuracy @xmath130 , eq . ( [ rev2 ] ) can be simplified as    @xmath131    or , using again @xmath126 , @xmath132 and also @xmath133    @xmath134    remembering that @xmath135 we write the transverse field components as    @xmath136\\right\\}~. \\label{rev444}\\end{aligned}\\ ] ]    in any situation , it is _ mathematically _ correct to expand @xmath128 as an _",
    "infinite sum _ of terms    @xmath137    truncation of the series in eq .",
    "( [ parexpr ] ) and subsequent simplification of the phase in the integrand of eq .",
    "( [ rev444 ] ) is a delicate business .    the first term of the expansion eq .",
    "( [ parexpr ] ) naturally cancels the term @xmath138 in the phase of eq .",
    "( [ rev444 ] ) so that one is left with phase contributions due to higher order terms from the expansion eq .",
    "( [ parexpr ] ) and with @xmath139 .",
    "this last contribution depends on @xmath95 and can be specified only when the magnetic system is specified .",
    "as has already been said in paragraph [ sub : deri ] , as we integrate along @xmath82 , @xmath84 grows larger and larger leading , eventually , to a highly oscillatory behavior of the integrand which does not contribute anymore to the final integration result .",
    "the value of @xmath82 for which @xmath85 can be considered as a measure of the value of @xmath82 for which the integrand starts to display such oscillatory behavior and it is naturally defined as the radiation formation length @xmath86 of the system at frequency @xmath30 .    another length dictated by the physics of the problem is the natural size of the system",
    ". we will refer to it as the characteristic length of the system and we will indicate it with @xmath140 ; for instance , in the case of a circular motion , @xmath140 is simply the circle radius .",
    "relation between @xmath140 and @xmath86 depends on the system . in the ultra relativistic approximation",
    "we can say that @xmath140 can be either much larger or comparable to @xmath86 , but in any case never smaller , since integration of the green s function is performed along a path length comparable with @xmath140 .",
    "moreover , in the ultra relativistic approximation the two terms @xmath92 and - @xmath141 nearly compensate leading to a formation length much longer than @xmath96 so that @xmath94 , and therefore also @xmath142 .",
    "it should be stressed that , although the previous properties are very general , the relation between @xmath86 , @xmath140 and @xmath96 depends on the particular physical situation under study and can be better specified only in relation with that situation : for instance , in the case of ultra relativistic motion on a circular trajectory @xmath143^{1/3}$ ] .",
    "also , note that if the ultra relativistic approximation can not be applied anymore , then even the general scaling laws between @xmath140 , @xmath86 and @xmath96 change .",
    "for instance , when if @xmath88 but @xmath144 , one has @xmath145 .",
    "the expansion eq .",
    "( [ parexpr ] ) makes sense only if @xmath84 is smaller or comparable to unity since the two terms @xmath92 and @xmath146 can be grouped together in a useful way .",
    "once a certain wavelength of interest is fixed , the condition @xmath147 determines the formation length @xmath86 , which can be used in the second term of eq .",
    "( [ parexpr ] ) . by imposing",
    "that also this second term is not larger than unity one obtains a condition on the observation points of interest :    @xmath148    where we assumed @xmath149 . the third term in the expansion",
    "can be then neglected , together with second and next terms in the expansion of the denominator of the integrand in eq .",
    "( [ rev444 ] ) , with an accuracy @xmath150 .",
    "note that , whatever the magnitude of @xmath151 across the beamline , it follows from eq .",
    "( [ sectermcondb ] ) that the square of the opening angle of radiation @xmath152 , is much smaller than unity .",
    "this justify our attention to the transverse components of @xmath153 only .    if we substitute the first two terms of eq .",
    "( [ parexpr ] ) in the phase of the integrand of eq .",
    "( [ rev444 ] ) , and the first term in its denominator we find    @xmath154    that is just eq .",
    "( [ generalfin ] ) .    we demonstrated that application of paraxial approximation",
    "( [ rev2 ] ) gives us back eq .",
    "( [ generalfin ] ) .",
    "this fact is , however , quite obvious . in our derivation of eq .",
    "( [ generalfin ] ) we applied paraxial approximation to maxwell equations from the very beginning , while here we simply apply the same approximation _",
    "after _ solving maxwell equations in their more generic form . for consistency reasons we had to obtain the same result .",
    "the previous discussion tells that our approach is a specialization of the more general approach described by eq .",
    "( [ rev2 ] ) .",
    "the novelty in this , stems from the fact that synchrotron radiation , by definition , applies to radiation by ultrarelativistic particles in magnetic structures ; in paragraph [ sub : deri ] we demonstrated that paraxial approximation can _ always _ be applied to maxwell equations in the case of ultrarelativistic particles .",
    "( [ rev2 ] ) can _ always _ be reduced to eq .",
    "( [ generalfin ] ) in the treatment of synchrotron radiation . in other words",
    ", there is no point in starting from eq .",
    "( [ rev2 ] ) when treating synchrotron radiation problems : one may start , directly , with the simpler eq .",
    "( [ generalfin ] ) without loss of generality .",
    "compared to eq .",
    "( [ rev2 ] ) , eq .",
    "( [ generalfin ] ) is easier to apply for analytical investigations , whose importance we already stressed in the introduction , because the paraxial approximation has been applied from the very beginning , so that the approximations made , their region of applicability and their accuracy could be discussed independently of the magnetic system selected .    the relation between our approach and the method in eq .",
    "( [ rev1 ] ) simplifies then , to the relation between eq .",
    "( [ rev2 ] ) and eq .",
    "( [ rev1 ] ) .",
    "it is not straightforward to show this relation because eq .",
    "( [ rev2 ] ) does not coincide with eq .",
    "( [ rev1 ] ) once the term in @xmath155 is dropped .",
    "however , it is straightforward to show that eq .",
    "( [ rev2 ] ) is completely equivalent to the expression for the fourier transform of the lienard - wiechert fields _ including _ the velocity field part .",
    "this can be shown in full generality , regardless of the paraxial approximation .",
    "( [ rev2 ] ) can be written as    @xmath156    where we have used relation    @xmath157    eq .",
    "( [ revtrasf ] ) can be integrated by parts . when the edge terms can be dropped ( we will discuss this assumption below )",
    "one obtains    @xmath158 & & \\cr \\times \\exp \\left\\{i\\omega\\left(t'+{|\\boldsymbol{r_o}-\\boldsymbol{r'}(t')|\\over{c}}\\right)\\right\\ } \\label{revtrasfbiss}\\end{aligned}\\ ] ]    with the help of eq .",
    "( [ usefulrel ] ) and    @xmath159 \\label{usefulrel0}\\end{aligned}\\ ] ]    one obtains , from eq .",
    "( [ revtrasfbiss ] ) the fourier transform of the lienard - wiechert fields :    @xmath160\\over{|\\boldsymbol{r_o}-\\boldsymbol{r'}| } }   \\right ] & & \\cr \\times \\exp \\left\\{i\\omega\\left(t'+{|\\boldsymbol{r_o}-\\boldsymbol{r'}(t')|\\over{c}}\\right)\\right\\}~. \\label{lw}\\end{aligned}\\ ] ]    the only assumption made going from eq .",
    "( [ revtrasf ] ) to eq .",
    "( [ lw ] ) is that the edge term in the integration by parts is simply zero .",
    "this assumption can be justified by means of physical arguments in the most general situation accounting for the fact that the integral in @xmath161 has to be performed over the entire history of the particle and that at @xmath27 and @xmath162 the electron does not contribute to the field anymore .",
    "it is obvious that the same line of reasoning can be followed starting from eq .",
    "( [ lw ] ) and going back to eq .",
    "( [ revtrasf ] ) : in general , edge terms can be dropped .     a system constituted by two bending magnets connected by a straight section of length @xmath163 .",
    "radiation is collected at a distance @xmath164 from the downstream magnet .",
    ", width=340 ]    the previous statement is very general and _ per se _ trivial but it should be interpreted from a physical viewpoint depending on the situation .",
    "for instance , consider the case of a system like the one sketched in fig .",
    "[ edgeuno ] ( which will be treated extensively in paragraph [ sec : edge ] ) .",
    "[ edgeuno ] shows two bending magnets separated by a straight line . before and after the straight lines are two semi - infinite straight sections .",
    "a question arises about what we may take as @xmath27 and @xmath162 in this particular situation .",
    "intuitively the magnets act like switches : the first magnet switches radiation on , the second switches it off .",
    "the statement that edge terms can be dropped , combined with the paraxial approximation tell that we can take @xmath27 and @xmath162 as the particle is well inside the first and the second bend , respectively , and neglect other parts of the trajectory .",
    "note that an expression alternative to eq .",
    "( [ rev2 ] ) for the fourier transform of the electric fields can be found in @xcite . after starting with eq .",
    "( [ lw ] ) , the authors of @xcite organized integration by part in a different way compared with what has been done in eq .",
    "( [ revtrasfbiss ] ) .",
    "first they found that    @xmath165 \\over{|\\boldsymbol{r_o}-\\boldsymbol{r'}|(1-\\boldsymbol{n}\\cdot\\boldsymbol{\\beta})^2 } } = { 1\\over{|\\boldsymbol{r_o}-\\boldsymbol{r'}| } } { d\\over{dt ' } } \\left[{\\boldsymbol{n}\\times(\\boldsymbol{n}\\times\\boldsymbol{\\beta})\\over{(1-\\boldsymbol{n}\\cdot\\boldsymbol{\\beta})}}\\right ] & & \\cr -\\left[{\\boldsymbol{\\dot{n}}(\\boldsymbol{n}\\cdot\\boldsymbol{\\beta})+\\boldsymbol{n}(\\boldsymbol{\\dot{n}}\\cdot\\boldsymbol{\\beta } ) - \\boldsymbol{\\dot{n}}(\\boldsymbol{n}\\cdot\\boldsymbol{\\beta})^2-\\boldsymbol{\\beta}(\\boldsymbol{\\dot{n}}\\cdot\\boldsymbol{\\beta } ) \\over{|\\boldsymbol{r_o}-\\boldsymbol{r'}|(1-\\boldsymbol{n}\\cdot\\boldsymbol{\\beta})^2}}\\right]~. \\label{luccioparti}\\end{aligned}\\ ] ]    note that eq .",
    "( [ luccioparti ] ) accounts for the fact that @xmath166 is not a constant in time .",
    "second , using eq .",
    "( [ luccioparti ] ) in the integration by parts they got :    @xmath167 & & \\cr \\times \\exp\\left\\{i\\omega\\left(t'+{|\\boldsymbol{r_o}-\\boldsymbol{r'}(t')|\\over{c}}\\right)\\right\\ } ~ \\label{revluccio}\\end{aligned}\\ ] ]    where , similarly as before , the edge terms have been dropped .",
    "( [ revluccio ] ) includes an integrand which is completely different with respect to eq .",
    "( [ rev2 ] ) .",
    "this is no mistake .",
    "( [ rev2 ] ) and ( [ revluccio ] ) are correct : using integration by parts in different ways simply gives different integrands which anyway , after integration , yield the same value for @xmath25 .",
    "it is interesting to note that , both in eq .",
    "( [ rev2 ] ) and eq .",
    "( [ revluccio ] ) , terms in the first and second powers of @xmath168 can not be interpreted as is usually done in time domain , as acceleration and velocity terms respectively nor they constitute , mathematically , fourier pairs with @xmath25 .",
    "in fact , a different organization of the integration by parts leads to different results : such terms have , here , no separate physical meaning .",
    "we have just shown that this situation is obtained starting from the lienard - wiechert field , applying integration by parts in two different ways and dropping the edge terms .",
    "going back to the fact that edge terms can be dropped , we can make now some remark which is particularly interesting from a methodological viewpoint .",
    "edge terms are important only when calculation of radiation properties from a given system is performed over a part of it , that is integration is not taken from @xmath27 to @xmath162 but only on a part of the trajectory arbitrarily chosen . however , summing up all non - negligible contributions is equivalent to integrate the system from @xmath27 to @xmath162 . from this viewpoint edge radiation",
    "can be calculated without accounting for edge terms , which are artificial .",
    "as we will show in paragraph [ sec : edge ] , the low - frequency component of the field generated by a particle moving as in fig .",
    "[ edgeuno ] , usually referred to as edge radiation , actually arises from the straight line between the bends when one integrates the system over all the particle trajectory .",
    "as said before , on the one hand the term in @xmath169 in eq .",
    "( [ rev2 ] ) can be dropped in paraxial approximation but , on the other hand , eq .",
    "( [ rev2 ] ) does not coincide with eq .",
    "( [ rev1 ] ) once the velocity term is dropped .",
    "in other words , the term in @xmath168 of eq .",
    "( [ lw ] ) is not the term in @xmath168 of eq .",
    "( [ rev2 ] ) . even in paraxial approximation ,",
    "the velocity term in eq .",
    "( [ lw ] ) , in general , can not be dropped .",
    "in fact , in order to do so , it is required that the ratio between the modulus of the velocity field and the modulus of the acceleration field is much smaller than unity :    @xmath170 \\mid } } \\ll 1 \\label{conveldrop}\\ ] ]    then , in paraxial approximation we have    @xmath171 = - \\boldsymbol{n}\\times[\\boldsymbol{\\dot{\\beta}}\\times(\\boldsymbol{n}-\\boldsymbol{\\beta } ) ] \\simeq [ \\boldsymbol{\\dot{\\beta}}\\cdot(\\boldsymbol{n}-\\boldsymbol{\\beta})]\\boldsymbol{n } \\label{paraxdoubleprod}\\ ] ]    substitution in condition ( [ conveldrop ] ) gives    @xmath172    condition ( [ finaldropping ] ) depends on the system under investigation , but in general is not automatically satisfied . for instance , in the case of circular motion @xmath173 , @xmath174 being the circle radius",
    ". then we have    @xmath175    where @xmath176 is the angle between @xmath42 and @xmath177 .",
    "for instance , it is well known that the radiation formation length at the critical wavelength @xmath178 is simply @xmath179 and that @xmath180 ; then , in the case @xmath181 , we have    @xmath182    as a result , when @xmath181 and @xmath183 condition ( [ finaldropping ] ) is not satisfied , although the paraxial approximation is enforced .",
    "this counterexample shows that paraxial approximation , alone , is not sufficient to guarantee that the velocity field in eq .",
    "( [ lw ] ) can be dropped .",
    "the region of parameter space for which the velocity field can be neglected is usually referred to as the far field zone . in order to be in the far field zone",
    "the paraxial approximation is necessarily enforced .",
    "we take the condition that @xmath42 is constant as a definition of the far field zone .",
    "when this is the case , the classical result ( see for instance @xcite )    @xmath184 \\over{(1-\\boldsymbol{n}\\cdot\\boldsymbol{\\beta})|\\boldsymbol{r_o}-\\boldsymbol{r'}| } } = { 1\\over{r_o } } { d\\over{dt'}}\\left [ { \\boldsymbol{n}\\times(\\boldsymbol{n}\\times{\\boldsymbol{\\beta}})\\over{1-\\boldsymbol{n}\\cdot\\boldsymbol{\\beta}}}\\right ] \\label{classdiff}\\ ] ]    can be used to perform integration by parts .",
    "starting from eq .",
    "( [ lw ] ) and assuming , as explained before , that the edge terms can be dropped , we arrive at the widely used result presented in textbooks ( see again @xcite )    @xmath185 & & \\cr \\times \\exp \\left\\{i\\omega\\left(t'-{1\\over{c}}{\\boldsymbol{n}\\cdot \\boldsymbol{r'}}\\right)\\right\\ } ~. \\label{revwied}\\end{aligned}\\ ] ]    now , with ultra relativistic accuracy @xmath186 one has @xmath187 : using this relation we see straightforwardly that , in the far field zone , eq .",
    "( [ revwied ] ) is equivalent to eq .",
    "( [ rev3 ] ) . to conclude , in this discussion we have seen that paraxial approximation can be applied in the calculation of synchrotron radiation properties for any set of parameters .",
    "moreover , in general , we should account for both velocity and acceleration term in the lienard - wiechert expression : however , in the case @xmath42 can be taken as a constant ( far zone approximation ) , the velocity term can always be dropped .",
    "consider a particle moving along a circular trajectory and an observer as sketched in fig .",
    "[ srgeo ] .",
    "the radiation from a particle moving with velocity @xmath87 along a circle of radius @xmath174 is observed from a point @xmath97 .",
    "@xmath174 is the only characteristic length of the system so that we can impose naturally that @xmath140 is @xmath174 . when @xmath188 and @xmath189 , defined in fig .",
    "[ srgeo ] , are much smaller than unity the reference system @xmath58 indicated in fig .",
    "[ srgeo ] is a consistent with the conditions for paraxial treatment explained in the previous section and eq .",
    "( [ generalfin ] ) can be used to characterize the radiation at @xmath97 .",
    "the motion along the curvilinear abscissa @xmath64 can be described as    @xmath190    and    @xmath191    where @xmath192 and the expansion in eq .",
    "( [ trmot ] ) is justified , once again , in the framework of the paraxial approximation .    since the integral in eq .",
    "( [ generalfin ] ) is performed along @xmath82 we should invert @xmath193 in eq . ( [ zmot ] ) and",
    "find the explicit dependence @xmath95 :    @xmath194    so that    @xmath195    substituting eq . ( [ sz ] ) , eq.([zmot ] ) and eq . ( [ trmot ] ) in eq . ( [ generalfin ] )",
    "we can write    @xmath196~,&&\\cr \\label{srone}\\end{aligned}\\ ] ]    where @xmath113 is given by    @xmath197 ^ 2+y_o^2 \\over{2c(z_o - z ' ) } } \\right)~.\\label{phh}\\ ] ]    at this stage our expression is still very general and valid for any observation distance @xmath164 .",
    "we keep up to the third order in @xmath82 in the expression for @xmath95 in the phase , since the term @xmath198 includes the small parameter @xmath199 .",
    "note that , although integration is performed from @xmath200 to @xmath201 , the only part of the trajectory contributing to the integral is of order of the radiation formation length @xmath202^{1/3}$ ] . at the critical wavelength @xmath203 that is simply @xmath204 .",
    "physically , this is included in our paraxial approximation .",
    "mathematically , it is reflected in the fact that @xmath113 in eq .",
    "( [ phh ] ) exhibits more and more rapid oscillations as @xmath82 becomes larger and larger due to non linear terms : in particular note that , as @xmath205 , the term in @xmath206 in eq .",
    "( [ phh ] ) is of order unity .",
    "if @xmath207 we can expand all expressions in @xmath208 around @xmath164 .",
    "we will be considering the so - called @xmath209 radiation limit so that , expanding @xmath208 we will retain up to the third order in @xmath82 in the expression for the phase and up to the first order in @xmath82 in the rest of the integrand .",
    "we introduce angles @xmath210 and @xmath211 as in fig .",
    "[ srgeo ] ( with the restriction @xmath212 and @xmath213 ) .",
    "then , accounting for @xmath214 , eq . ( [ srone ] ) and eq .",
    "( [ phh ] ) read respectively    @xmath215    and    @xmath216~.\\label{phh2}\\end{aligned}\\ ] ]    one can easily reorganize the terms in eq .",
    "( [ phh2 ] ) to obtain    @xmath217~.\\label{phh2b}\\end{aligned}\\ ] ]    finally , redefinition of @xmath82 as @xmath218 gives the final result    @xmath219}\\right\\}~,\\label{srtwob}\\end{aligned}\\ ] ]    where @xmath220 and    @xmath221    note that the linear term in @xmath222 in the phase of eq .",
    "( [ srtwo ] ) defines the maximal angle of interest .",
    "when @xmath223 , this term is of order unity if @xmath224^{2/3}$ ] ; this is simply the ratio of @xmath225 to @xmath226 . as the observation angle grows more the linear term becomes larger and larger resulting in an oscillatory behavior of the entire integral in eq .",
    "( [ srtwo ] ) and thus giving no net contribution to the field .",
    "a similar mechanism has been discussed in relation with the radiation formation length .",
    "now that we have found an upper limit to the observation angle , @xmath227 , it is interesting to discuss the accuracy of our expression .",
    "we have @xmath228 in other words , the accuracy of our calculations is given by the square of the maximal observation angle .",
    "to compare eq .",
    "( [ srtwob ] ) with results in literature ( for instance @xcite ) we should remember that the latter are obtained using a reference system like the one in fig . [ srstand ] .",
    "therefore , in order to perform a comparison , we should let @xmath229 , so that @xmath230 . then ,",
    "since results are often obtained in terms of integration along the retarded time @xmath22 we should use @xmath231 .",
    "finally we obtain    @xmath232}\\right\\}~.\\label{srcomp}\\end{aligned}\\ ] ]    every synchrotron radiation textbook ( see , for instance @xcite ) shows that eq .",
    "( [ srcomp ] ) can be written as    @xmath233 .\\label{srcompbess}\\end{aligned}\\ ] ]    here @xmath234 and @xmath235 are the modified bessel functions of second kind of fractional order @xmath236 and @xmath237 respectively , while    @xmath238    note that , depending on the definition of fourier transform eq .",
    "( [ ftran ] ) , textbook versions of eq .",
    "( [ srcomp ] ) or eq .",
    "( [ srcompbess ] ) may differ by a factor @xmath239 and ( or ) by the operation of complex conjugation ; moreover textbooks often neglect the exact phase factor for the field , since they are usually more interested in the calculation of the intensity , which involves the square modulus of eq .",
    "( [ srcomp ] ) .",
    "the result in eq .",
    "( [ srcompbess ] ) is far from being trivial .",
    "bessel functions are real , therefore the @xmath115 component in eq .",
    "( [ srcompbess ] ) is real , while the @xmath116 component is purely imaginary .",
    "in other words , the @xmath115 component of the integral in eq .",
    "( [ srcomp ] ) is purely imaginary , while the @xmath116 component is real .",
    "this is not immediately obvious , but it can be easily seen by inspection , accounting for the fact that the exponential function in the integrand can be written as @xmath240 ; then , for parity reasons , the term in @xmath115 , being odd , couples with the sine function , thus giving an imaginary result while the term in @xmath116 , being even , couples with the cosine function , giving a real result .    from the previous remarks it follows that the only non - trivial phase factor is specified by the surviving exponential argument @xmath241 , which is usually neglected in literature .",
    "this simply represents , in our paraxial approximation , the phase difference between the point @xmath242 and the point @xmath243 .",
    "physically , in the particular reference frame of fig . [ srstand ] , which we have chosen by setting @xmath244 , the electric field is represented by a spherical wave propagating outwards from the origin of the coordinate system .",
    "phase correction for the horizontal polarization component of the field ; case discussed in @xcite.,width=340 ]    it is interesting now to investigate the meaning of the phase @xmath245 , which is nonzero for nonzero values of @xmath189 .",
    "this term has no equivalent in the usual treatment of synchrotron radiation , because displacement along the @xmath101 axis can not be considered in the reference system sketched in fig .",
    "[ srstand ] . in the usual treatment , an @xmath246 displacement",
    "is treated redefining the reference frame so that @xmath247 .",
    "this redefinition has simply the effect of shifting the phase of the field expressed in the old reference frame of a quantity @xmath248 .",
    "there is a considerable amount of literature dealing with the phase of the fourier components of the electric field vector in synchrotron radiation ( see , for instance @xcite ) . in particular , @xcite reports the results of a thorough simulation of single particle effects .",
    "it is obviously found that the wavefront of a single particle is not spherical ; a correspondent phase shift ( with respect to the spherical wave ) for the field of a single particle was computed and analytical estimations within @xmath249 of the numerical result were presented which are in complete agreement with eq .",
    "( [ phio ] ) . for the sake of completeness and comparison we present , in fig .",
    "[ chubarx ] and fig .",
    "[ chubary ] the phase shifts calculated for the horizontal and vertical polarization components , respectively by means of our eq .",
    "( [ phio ] ) for the same example considered in @xcite : bending magnet emission from a @xmath250 gev particle , constant magnetic field in bending magnet @xmath251 t , photon energy 40 ev and distance from tangential source point to optical component @xmath252 m. note that these parameters correspond to the far zone case where @xmath253 .",
    "the phase for the @xmath117-polarization component , in fig .",
    "[ chubary ] , is simply the phase for the @xmath101-polarization component ( that is fig .",
    "[ chubarx ] ) added to @xmath254 , where @xmath255 for @xmath256 and @xmath257 for @xmath258 : this last terms simply accounts for the fact that the @xmath117 component of eq .",
    "( [ srcomp ] ) is odd .",
    "phase correction for the vertical polarization component of the field ; case discussed in @xcite.,width=340 ]",
    "electrons following a circular motion are , of course , an approximation .",
    "electron beams have always some small angular spread and offset with respect to the nominal trajectory . any beam with a small geometrical emittance",
    "can be thought , in agreement with paraxial treatment , as a composition of perfectly collimated beams with different deflection angles with respect to the orbital plane of the nominal trajectory .",
    "this representation is useful when one is interested in calculating , for instance , the influence of angular spread and offset on the electric field intensity : one can simply compute the contribution for each collimated beam and sum up the results .",
    "this method allows to simplify calculations of more complicated quantities like the field autocorrelation function , which is of uttermost importance in the characterization of the statistical properties of a light source .",
    "we have already discussed the advantage of our method regarding calculations of the field autocorrelation function in connection with the choice of a fixed reference frame as in fig .",
    "[ srgeo ] .",
    "let us now discuss how it can be used to calculate @xmath59 from a single particle with a given angular deflection with respect to the orbital plane of a nominal electron .",
    "such an expression was first calculated , starting from the lienard - wiechert fields , in @xcite .",
    "the meaning of horizontal and vertical deflection angles @xmath259 and @xmath260 is clear once we specify the particle velocity    @xmath261 \\label{veloangle}\\end{aligned}\\ ] ]    so that the trajectory can be expressed as a function of the curvilinear abscissa @xmath64 as    @xmath262 \\boldsymbol{\\hat{x } } + \\left[l_y+s \\sin(\\eta_y)\\right ]   \\boldsymbol{\\hat{y } } & & \\cr + \\left[+ r\\sin\\left({s\\over{r}}+\\eta_x\\right)\\cos(\\eta_y ) - r\\sin(\\eta_x)\\sin(\\eta_y ) \\right ] \\boldsymbol{\\hat{z } } & & \\cr \\label{trajangle}\\end{aligned}\\ ] ]    here we have introduced , also , an arbitrary offset @xmath263 in the trajectory . using eq .",
    "( [ trajangle ] ) an approximated expression for @xmath95 can be found :    @xmath264    so that    @xmath265    and    @xmath266    we will consider @xmath267 and @xmath268 in agreement with the fact that we deal with electron _ beams _ with small angular deflection and not with more general kind of plasmas .    substituting , as in the previous paragraph , eq .",
    "( [ szangle ] ) , eq .",
    "( [ trmot2 ] ) and eq .",
    "( [ vapprangle ] ) in eq .",
    "( [ generalfin ] ) we can write    @xmath269~,&&\\cr \\label{srone2}\\end{aligned}\\ ] ]    where @xmath113 is given by    @xmath270 ^ 2 + \\left[y_o - l_y-\\eta_y z'\\right]^2 \\over{2c(z_o - z')}}\\right ) ~.\\label{phh22}\\end{aligned}\\ ] ]    at this stage , as in the previous paragraph , our expression is still very general and valid for any observation distance @xmath164 , and again as we did before , we have retained up to the third order in @xmath82 in the expression for @xmath95 in the phase , since the term @xmath198 includes the small parameter @xmath199 and up to the first order in @xmath82 in the rest of the integrand .",
    "we will now consider the _",
    "far field _",
    "radiation limit which , as the reader remembers , allows expansion of all expressions in @xmath208 around @xmath164 : as before we will retain up to the third order in @xmath82 in the expression for the phase and up to the first order in @xmath82 in the rest of the integrand . from eq .",
    "( [ srone2 ] ) , eq .",
    "( [ phh22 ] ) and eq .",
    "( [ trmot2 ] ) it is evident that the offsets @xmath271 and @xmath272 are always subtracted from @xmath246 and @xmath273 respectively : shifting the particle trajectory on the vertical plane is equivalent to a shift of the observer in the opposite direction . with this in mind , in analogy with fig .",
    "[ srgeo ] , we introduce angles @xmath274 and @xmath275 ( with the restriction @xmath276 and @xmath277 ) . then , accounting for @xmath267 and @xmath278 , eq . ( [ srone2 ] ) and eq . ( [ phh22 ] ) can be written down respectively , as follows :    @xmath279    and    @xmath280    one can easily reorganize the terms in eq .",
    "( [ phh2ang ] ) to obtain    @xmath281    redefinition of @xmath82 as @xmath282 gives the result    @xmath283}\\right\\}~,\\label{srtwoang2}\\end{aligned}\\ ] ]    where @xmath284 and    @xmath285    except for the phase term @xmath286 , eq .",
    "( [ srtwoang2 ] ) can be obtained from eq .",
    "( [ srtwob ] ) simply by substituting @xmath189 with @xmath287 and @xmath188 with @xmath288 : besides a common phase factor then , we can say that including a deflection angle has the same effect of shifting the observer position of the same angle .",
    "still , we should remember that @xmath274 and @xmath275 .    in the limit for @xmath289 , with @xmath290^{1/3}$ ] , one can simplify further eq .",
    "( [ srtwoang2 ] ) .",
    "note how introduction of small parameters allows increasing specialization and simplification of the theory : for instance , in this paragraph we started with an expressions for the fields obtained in the limit for @xmath291 , that could be cast into simpler form in the limit @xmath292 and now further specialized assuming @xmath289 leading to :    @xmath293}\\right\\}~,\\label{srtwoang2bis}\\end{aligned}\\ ] ]    where @xmath294 and    @xmath295    eq .",
    "( [ srtwoang2 ] ) is an extremely useful tool , because it describes the radiation from an electron with offset and deflection as in an electron beam with finite emittance , including the correct phase factor for the field .",
    "starting from eq .",
    "( [ srtwoang2 ] ) then , it is possible to calculate the field correlation function , and to provide a study of transverse coherence properties of the radiation from a given electron beam by means of analytical techniques .",
    "as has already been remarked , coherence is a special and important property of synchrotron radiation sources . in the far zone ,",
    "the spatial coherence at different observer angles @xmath296 and @xmath297 is characterized by the autocorrelation function ( see @xcite and @xcite for applications to synchrotron radiation science ) :    @xmath298    where @xmath299 is the @xmath300-th fourier component of the electric field given in eq .",
    "( [ srtwoang2 ] ) , and brackets @xmath301 denote an ensemble average with respect to electron parameters .",
    "note that a given electron is correlated just with itself , that is why eq .",
    "( [ autocorf ] ) only includes the electric field from a single electron and not from two different particles .",
    "the ensemble average can be replaced by integration over the electron phase - space density .",
    "the intensity distribution can be obtained directly from eq .",
    "( [ autocorf ] ) by letting @xmath302 .    of course a numerical code can always be developed , either starting from eq .",
    "( [ generalfin ] ) or just from the lienard - wiechert fields , which calculates the field correlation function in a generic case , but such a code would not help in physical understanding of the situation . on the contrary , eq .",
    "( [ srtwoang2 ] ) includes all relevant information about an electron in a realistic beam ( i.e. with offset and deflection ) and , being an analytically manageable expression , constitutes the first step towards the characterization of transverse coherence properties from bending magnet radiation .      in this paragraph",
    "we will stress the importance of the knowledge of the _ entire _ trajectory followed by the electron as we study the effect of a change in longitudinal velocity due to the passage of an electron in a magnetic system .",
    "this results in collimated emission of radiation in the low photon energy range , a mechanism analogous to transition radiation , which is well - known in literature under the name of edge radiation @xcite .",
    "we restrict ourselves to the system depicted in fig .",
    "[ edgeuno ] , which shows two bending magnets separated by a straight line of length @xmath163 .",
    "radiation is detected at a screen positioned at distance @xmath164 from the downstream magnet .",
    "we will require that the bending magnets deflect the electron trajectory of an angle much larger than @xmath303^{1/3}$ ] , @xmath96 being the wavelength of interest : in this way the straight lines before the upstream bend and after the downstream bend do not contribute to the field detected at the screen position",
    ". intuitively , the magnets act like switches : the first magnet switches the radiation on , the second switches it off . the trajectory can be therefore split in three parts : the two bends and the straight section of length @xmath163 between them . with the help of eq .",
    "( [ generalfin ] ) we write the contribution from the straight line as    @xmath304    where we assumed @xmath305 .",
    "the previous assumption is not always verified in cases of practical interest . here , however , we are only concerned with an example of application of our method .",
    "@xmath113 in eq .",
    "( [ abcontr ] ) is given by    @xmath306~. \\label{phiab}\\ ] ]    the characteristic length related to the straight section is obviously @xmath307 . in general , the formation length of radiation at wavelength @xmath96 is given imposing @xmath308 , which gives @xmath309 . however ,",
    "if we are interested in low frequencies such that @xmath310 , we can simply consider @xmath311 and neglect the term in @xmath199 in eq .",
    "( [ phiab ] ) .",
    "trivial calculations show that    @xmath312\\over{[\\omega l ( \\theta_x^2+\\theta_y^2 ) /(4c)]}}~ , \\label{lineab}\\ ] ]    where @xmath286 has the usual meaning ( compare , for instance , with eq .",
    "( [ phis ] ) ) . the magnitude of the contribution from the straight section ab can be estimated noting that the sinc function in eq .",
    "( [ lineab ] ) drops rapidly as @xmath313 reach the value @xmath314 .",
    "this means that a maximal observation angle of interest related to the straight line can be found in the transverse direction :    @xmath315    at this angle , the formation length for the straight line radiation at wavelength @xmath96 is simply equal to the straight section length , @xmath163 , as it can be seen from eq .",
    "( [ phiab ] ) .",
    "then , the magnitude of @xmath316 is of order    @xmath317    on the other hand , the magnitude of the contributions from the bends can be estimated as    @xmath318}\\right\\}~.   \\label{bendcon}\\end{aligned}\\ ] ]    in eq .",
    "( [ bendcon ] ) we have redefined the origin of our reference system , as it is clear from the integration limits ; however , here we are interested in the magnitude and not in the phase of the field , so that we can use eq .",
    "( [ bendcon ] ) without further discussion on the correct phase .",
    "the linear term in @xmath82 in the exponential function in eq .",
    "( [ bendcon ] ) is of order unity for angles @xmath188 such that    @xmath319    substituting the formation length for the bends @xmath320^{1/3}$ ] we obtain a condition for the maximal observation angle of interest related to the bending magnets    @xmath321    the previous condition on @xmath322 found for the bends has to be compared with the condition on @xmath322 previously found for the straight line , @xmath323 .",
    "the ratio between the latter and the former is equal to the ratio of the formation length for the straight line to the formation length for the bends respectively , that is @xmath324 . assuming @xmath325 , that is always verified in practice",
    ", we obtain that the maximal observation angle of interest related the straight line is much smaller than the maximal observation angle of interest related to the bend . as a result the entire linear term in the phase of eq .",
    "( [ bendcon ] ) can be neglected thus leading to the following simplified expression for @xmath326 :    @xmath327    an estimate of eq .",
    "( [ bendcon2 ] ) is    @xmath328 ~.   \\label{bendcon3}\\end{aligned}\\ ] ]     intensity distribution of radiation from the setup in fig .",
    "[ edgeuno ] at @xmath329 m and for @xmath330 m. radiation is collected at @xmath331 m from the downstream magnet . a contour plot ( upper figure ) and a horizontal cut by the median plane ( lower figure )",
    "are presented .",
    ", width=340 ]    the ratio between the magnitude of the bend and the straight section contribution is then @xmath332 therefore , under the already accepted condition @xmath333 one can neglect the contribution from the bending magnet .",
    "the only remaining contribution is given by eq .",
    "( [ lineab ] ) , which represents an expression for the field at the detector position .",
    "we plot the intensity corresponding to the field in eq .",
    "( [ lineab ] ) in fig .",
    "[ edge2 ] for the case @xmath334 m , @xmath335 m and @xmath164 = 20 m.    eq .",
    "( [ lineab ] ) is the same reported in @xcite .",
    "it is interesting to remark that in conventional treatments of synchrotron radiation , edge radiation has its origin in the edge term arising in the integration by parts of eq .",
    "( [ rev1 ] ) ; in other words it is found from the acceleration part of the lienard - wiechert field , which is present only in the magnets . on the other hand , from our method ,",
    "edge radiation arises as the contribution from the straight section between the magnets .",
    "this seems paradoxical , but one has to remember that there is no physical meaning in the calculation of the field harmonic content over _ a part _ of the trajectory alone .",
    "it does not make any sense , for instance , to calculate the field intensity from the edge of a single bend , because there will be either a second bend , as in fig .",
    "[ edgeuno ] , other structures downstream of the second bend which must be taken into account in the calculation of the total field : the sum of all these contributions will give interference terms when the intensity is calculated .",
    "then , accepting the viewpoint that only the knowledge of the _ entire _ trajectory of the particle brings physical sense to field calculations , there is no real contradiction : in our method edge radiation appears from the straight section . in the usual approach , instead",
    ", it appears from the edge terms in the integration by part of the acceleration field . yet these terms , alone , have no physical meaning .",
    "this solves our paradox .",
    "our method can be used to compute radiation characteristics from a short magnet , characterized by a bending angle @xmath336 .",
    "this device has the quite interesting characteristic that the fourier transform of the electric field in the far field limit has non - zero value for @xmath337 and that the critical frequency does not depend on the magnet radius but only on the magnet length .",
    "these features can be explained in a simple way . for circular motion the far field from a single particle",
    "has the property :    @xmath338                when the electron moves in arc of circles with different angular extensions @xmath339 though , the time - average of the electric field is nonzero ; then , its fourier transform has a nonzero component for @xmath337 .",
    "the first studies on long wavelength asymptotic can be found in @xcite . for a review on the subject",
    "it may be interesting to consult @xcite ; for a discussion dealing also with properties of csr ( coherent synchrotron radiation ) see @xcite . in fig .",
    "[ fig : dsm2 ] , fig .",
    "[ fig : dsm3 ] and fig .",
    "[ fig : dsm4 ] we plot the energy spectrum of the radiation in the case of an electron moving on circular motion , dipole magnet and short bend , respectively .",
    "all figures refer to the @xmath115 polarization component . as eq .",
    "( [ zerointe ] ) does not hold we find a nonzero component of the energy spectrum at @xmath337 . as the magnet extension becomes smaller than @xmath340 the critical frequency",
    "depends only on the magnet length @xmath341 according to @xmath342 .",
    "the short magnet is a device of particular interest also because its radiation characteristics are related to the methodological issue introduced in section [ sec : intro ] . from the very beginning ,",
    "our method relies on harmonic analysis of the electric field , so that the @xmath343 trajectory of an electron is considered known .",
    "this gives no particular problem in the case of a closed trajectory , as discussed in the previous subsections , but a question arises , now that a short magnet is considered , about the trajectory of our particle outside the short magnet .",
    "in general , the field at the observation position depends strongly on the trajectory followed by the electron before and after the magnet .",
    "so one should clarify what is the meaning of the term @xmath344 by itself , when it is not specified what follows and what precedes the bend .",
    "computing the field from the magnet alone as it is usually done has a meaning , but only in a particular sense : one can always break up the beamline in several parts , calculate contributions separately and finally add them up , accounting for the proper relative phase , to get the total field at the observer position .",
    "then the short magnet radiation is simply a part of the total field , a contribution to be added up to something else , which depends , case by case , on what precedes and follows the magnet .    in conclusion ,",
    "when we talk about radiation from a short magnet , we mean the contribution to the total field at the observer position @xmath97 due to the short magnet alone : this makes sense as long as we consider it only a part of the total field , calculated separately just for computational convenience .    with this in mind",
    "we calculate the short magnet field from eq .",
    "( [ srtwo ] ) limiting the integration to the magnet extent and using @xmath345 .",
    "this introduces a further small parameter in our system which leads to extra simplification of already known formulas derived for the case of a bending magnet with arbitrary extension . from eq .",
    "( [ srtwo ] ) we obtain    @xmath346}\\right\\ } & & \\cr \\times \\exp\\left\\{i\\omega { \\theta_x z'^2\\over{2rc}}\\right\\ } \\exp\\left\\{i \\omega { z'^3\\over{6 r^2 c } } \\right\\}~,\\label{srsh}\\end{aligned}\\ ] ]    where @xmath286 is defined as in eq .",
    "( [ phis ] ) . in eq .",
    "( [ srsh ] ) we intentionally separated phase factors @xmath347 and @xmath348 because we intend to neglect the second and expand the first around unity . for our system",
    "the characteristic length is obviously @xmath349 . in general ,",
    "the formation length of the radiation is fixed by the first phase factor , @xmath350 , but we will be interested in studying the long wavelength region such that @xmath351 , that is the maximum attainable value , since it is always @xmath352",
    ". then , the first phase factor imposes , simultaneously , @xmath353 and @xmath354 .",
    "if on the one hand , from the first of these conditions @xmath355 , from the second condition follows that @xmath356 and from the second phase factor one has @xmath357 . on the other hand if , from the first of these conditions , @xmath358 , then from the second condition follows that @xmath359 and from the second phase factor one has @xmath360 .",
    "it follows from these considerations that we can perform the expansion of @xmath361 up to the second term with an accuracy @xmath362 or better and neglect @xmath363 with the same accuracy for any choice of @xmath30",
    ". then we can write    @xmath364 } \\right\\}~,\\label{srsh2}\\end{aligned}\\ ] ]    performing calculations and dropping negligible terms we find @xmath365 ^ 2 } } \\big[\\big(1+\\gamma^2(\\theta_x^2+\\theta_y^2 ) & & \\cr-2\\gamma^2\\theta_x^2\\big)\\boldsymbol{\\hat{x}}-\\big(2\\gamma^2 \\theta_x\\theta_y\\big)\\boldsymbol{\\hat{y}}\\big ] \\bar{\\chi}_{[-r\\psi , r\\psi]}(\\alpha)~ , \\label{srsh3}\\end{aligned}\\ ] ] where    @xmath366~ \\label{alpha}\\ ] ]    and @xmath367}(\\alpha ) = \\int_{-r\\psi}^{r\\psi } dz ' \\exp\\left\\{i \\alpha z'\\right\\ } ~.\\label{chiftransf}\\end{aligned}\\ ] ] if we define a function @xmath368}$ ] which assumes unitary value on the interval @xmath369 $ ] and zero value elsewhere , then @xmath368}$ ] simply represents the magnetic field shape at the magnet position , and @xmath370}$ ] is its fourier transform with respect to @xmath371 .",
    "suppose now the magnetic field has a generic shape @xmath372 .",
    "keeping the same accuracy as before , we can generalize eq .",
    "( [ srsh3 ] ) substituting relations    @xmath373    and    @xmath374    where @xmath375 is the electron rest mass , in place of @xmath376 and @xmath377 directly in eq .",
    "( [ srsh ] ) . performing approximations as before and integrating by parts two time the term in @xmath378 and one time the term in @xmath379 we find that eq .",
    "( [ srsh3 ] ) can be easily generalized .",
    "results in literature are often given in cylindrical coordinates @xmath380 where @xmath381 and @xmath382 .",
    "the same choice can be found , for instance , @xcite .",
    "making use of this system we obtain :    @xmath383 \\bar{b}\\left({1+\\gamma^2\\theta^2\\over{2c \\gamma^2}}\\omega\\right)~ \\label{srshcomp}\\end{aligned}\\ ] ]    where @xmath384 is the classical radius of the electron    @xmath385    and    @xmath386    as has been said , the field from a short magnet makes sense only as a part of the total field from a given beamline . in this paragraph",
    "we have calculated , for such contribution , the expression in eq .",
    "( [ srshcomp ] ) which can also be found in @xcite .",
    "our aim , here , is not to review a well - known result , but to cast new light in its physical interpretation .    in order to do so",
    "we need first a digression .",
    "( [ generalfin ] ) is based on the more general eq .",
    "( [ rev2 ] ) . in paragraph",
    "[ sub : disc ] we have shown that eq .",
    "( [ rev2 ] ) is equivalent to the fourier transform of the lienard - wiechert fields eq .",
    "( [ lw ] ) provided that the edge term in the integration by parts going from eq .",
    "( [ lw ] ) to eq .",
    "( [ rev2 ] ) ( or viceversa ) can be dropped . on the one hand we showed that this can always be done since the integral in eq .",
    "( [ lw ] ) and eq .",
    "( [ rev2 ] ) should be performed over the entire electron history , and only a finite part of the trajectory contributes , practically , to the electric field at the observer position . on the other hand , one is free to break up the beamline in parts and sum up partial contributions to the total field using eq .",
    "( [ lw ] ) followed by integration by parts for each segment . in this case one must retain edge terms to obtain the same result : as an example of this fact , using our method , we have shown in paragraph [ sec : edge ] that the edge radiation from the system depicted in fig .",
    "[ edgeuno ] arises as the contribution from the straight section between the magnets , while conventional calculations indicate its origins in the edge term from the integration by parts of eq .",
    "( [ lw ] ) in the far field limit .    now coming back to the subject of this paragraph , typical derivations of eq .",
    "( [ srshcomp ] ) ( see @xcite ) start from eq .",
    "( [ rev1 ] ) and include the complete expression for the acceleration field .",
    "then , following conventional derivations , it is not clear wether edge terms play an important role in eq .",
    "( [ srshcomp ] ) or not .",
    "yet , we were able to obtain eq .",
    "( [ srshcomp ] ) without starting with eq .",
    "( [ rev1 ] ) : in fact we began with eq .",
    "( [ srsh ] ) which is eq .",
    "( [ srtwo ] ) with different integration limits which is , in its turn , a reduction of eq .",
    "( [ generalfin ] ) that , finally , is a simplification of eq .",
    "( [ rev2 ] ) . since our result",
    "coincide with the one in literature it follows that edge radiation from the presence of the short magnet is completely ignorable .    of course",
    ", one should still account for contributions from the other parts of the beamline : for instance , if the short magnet were installed in the middle of the straight section in fig .",
    "[ edgeuno ] one should consider the edge radiation contribution as in paragraph [ sec : edge ] .",
    "however , according to our reasoning we can conclude that one can safely drop the contribution of edge terms due to the presence of the short magnet . on the contrary , beginning with eq .",
    "( [ rev1 ] ) as is done in usual treatments , one is not able to separate the two physical phenomena and , indeed , may be easily misunderstand and misinterpret results concluding , erroneously , that short magnet radiation can not be derived without edge contributions . here",
    "we have seen that a critical study of the theoretical status of well - known formulas , can sometimes yield surprises .",
    "for a review of up to date knowledge on undulator radiation one may be interested in consulting references @xcite to @xcite .",
    "an experimental characterization of radiation from insertion devices at third generation light sources can be found in @xcite .",
    "( [ generalfin ] ) can be used to derive the expression for @xmath387 in the case of an undulator as well .",
    "geometry for undulator radiation .",
    ", width=340 ]    again , as before , we remark that , with the term _ undulator field _",
    "we actually mean a part of the total field seen by an observer and that one should account , in general , for the entire motion of the particle .",
    "the situation is sketched in fig .",
    "[ undugeo ] , where a planar undulator consisting of @xmath388 periods is sketched .",
    "we will follow @xcite in deriving well - known relations .",
    "for the electron transverse velocity we assume    @xmath389    here @xmath390 is the deflection parameter , @xmath391 , where @xmath392 is the undulator period , so that the undulator length is @xmath393 .",
    "the undulator length @xmath394 is also , naturally , the characteristic length of the system , so that @xmath395 . the transverse position of the electron is therefore    @xmath396    an expression for the curvilinear abscissa @xmath64 as a function of @xmath61 is given by    @xmath397    where @xmath398 is the time - averaged velocity along the @xmath61 direction , that can be expressed as :    @xmath399     radiation geometry for the undulator field .",
    ", width=340 ]    we can now substitute eq . ( [ erz ] ) and eq .",
    "( [ vuz ] ) in our eq .",
    "( [ generalfin ] ) .",
    "such a substitution leads to a general expression , valid for any observer distance @xmath164 .",
    "it is possible to obtain , similarly to many synchrotron radiation textbooks , a simplified expression valid in the limit for large values of @xmath164 .",
    "since we are interested in the contribution of the undulator device to the total field at the observer position , we will integrate eq .",
    "( [ generalfin ] ) only along the undulator .",
    "then all terms in @xmath208 in the phase factor of eq .",
    "( [ generalfin ] ) can be expanded around @xmath164 . in the limit @xmath400",
    ", we can usually retain first order terms in @xmath82 : later on , in paragraph [ sec : near ] , we will discuss the applicability region of this approximation and we will see that there are particular regions of parameters which do not allow retention of first order terms alone . dropping negligible terms and defining @xmath401 and @xmath402 according to fig . [ angle ] ( or remembering the analogous definition given in paragraph [ sub : short ] ) we obtain    @xmath403~.&&\\cr \\label{undurad}\\end{aligned}\\ ] ]    here    @xmath404 + \\phi_s~,\\label{phitundu}\\end{aligned}\\ ] ]    where @xmath405 , as usual , and @xmath406 is defined as    @xmath407    note that as @xmath408 , the formation length of our system is simply given by @xmath409 as it is seen immediately from eq .",
    "( [ phitundu ] ) imposing the first term in phase to be of order unity .",
    "yet it should be stressed here that the formation length @xmath409 is obtained in the most general case , without accounting for special conditions which are very often chosen for undulator operation .",
    "in fact , when a large number of undulator periods is selected an extra large - parameter is introduced in the system yielding simplifications within the theory ; then , as it will be clear after reading paragraph [ sec : res ] , if the so called resonance condition is met , the actual formation length of the system becomes @xmath410 .",
    "the choice of the integration limits in eq .",
    "( [ undurad ] ) express explicitly the fact that the reference system has its origin in the center of the undulator as in fig .",
    "[ undugeo ] . as said before , eq . ( [ undurad ] ) gives only a partial contribution to the total field , which must be summed up with terms arising from structures preceding and following the undulator .",
    "in @xcite , for instance , no particular attention is given to this problem : the calculation of undulator radiation distribution is performed considering the acceleration term of the lienard - wiechert fields alone , integrating by parts , and dropping the edge term .",
    "undulator followed and preceded by bending magnets and straight sections .",
    "information about the particle trajectory before and after the undulator is necessary to calculate the radiation spectrum.,width=340 ]    it is indeed very useful , at this point , to comment some passage of @xcite .",
    "at page 412 one can read : `` no assumptions on the magnetic field parameters have been made to derive the radiation spectrum in the form of equation ( 7.87 ) which we use to calculate the radiation spectrum from a wiggler magnet '' .",
    "( 7.87 ) in @xcite is the radiation spectrum from a particle moving on a generic trajectory calculated , indeed , starting from the lienard - wiechert field expression for the acceleration field , integrating by parts and neglecting the edge terms ; it obviously appears in the form of an integration with limits from @xmath200 to @xmath201 : this is just our eq .",
    "( [ revwied ] ) that was derived exactly as eq .",
    "( 7.87 ) in @xcite . dropping the velocity field in the lienard - wiechert expression",
    "is done under the sufficient ( but not necessary , in general ! ) condition that @xmath42 can be considered constant .",
    "this is regarded as the far field approximation .",
    "then , neglecting of edge terms can be done under physical assumptions discussed much earlier in paragraph [ sub : disc ] .",
    "again , the integral in @xmath161 has to be performed over the _ entire history of the particle _ ; the physical meaning of @xmath27 and @xmath162 is that at these times , the electron does not contribute to the field anymore . from this viewpoint , the geometry specified in fig .",
    "[ undugeo ] is no more sufficient .",
    "one has to provide information about what precedes and what follows the undulator ; an example is depicted in fig .",
    "[ todo ] . in the case of the scheme in fig .",
    "[ todo ] for instance , @xmath27 and @xmath162 refer to moments when the particle is well inside the first and the second bend , respectively , and do not contribute anymore to the resulting radiation spectrum . in order to drop edge terms in the particular case of the trajectory in fig .",
    "[ todo ] , one has to consider contributions from the first bend , then from @xmath411 to @xmath412 along the straight line , from @xmath412 to @xmath413 inside the undulator , from @xmath413 to @xmath414 along the second straight line and , finally , from the second bending magnet .    instead of following this prescription , the author of @xcite substitutes characteristic quantities for a trajectory on an infinitely long undulator in eq .",
    "( 7.87 ) , and then he simply sets the undulator strength parameter @xmath390 to zero outside of a given temporal interval , which is simply the physical time that an electron takes to pass through the undulator .",
    "this is equivalent to consider two infinite straight lines before and after the end of the undulator .",
    "then , although results are correct in some particular case ( namely under resonant approximation , which we discuss in paragraph [ sec : res ] ) the reader is left with the unsolvable task of understanding what is the physical meaning of two infinite straight lines and , especially , what is the contribution of these infinite parts of the trajectory to the total electric field at the observer position . again , if one wishes to drop the edge terms , one should start considering the entire trajectory of the electron , not a part of it alone .    in the case depicted in fig .",
    "[ todo ] for instance , we will have different interfering contributions from the straight lines before and after the undulator and we would end up with both edge radiation and transition undulator radiation . again , in the most general case , eq .",
    "( [ undurad ] ) refers to a part of the electric field seen by the observer and it should be added to other contributions corresponding to the entire history of the particle . only in particular situations like the one discussed in the following paragraph [ sec : res ] calculation of radiation properties from eq .",
    "( [ undurad ] ) alone makes sense : in paragraph [ sec : res ] we will discuss the resonant approximation which can be used in the case of a large number of undulator periods , @xmath415 .",
    "again , the presence of an extra large ( or small ) parameter yields to further simplifications of the theory .",
    "however it should be noted that , in practice , @xmath388 ranges from a few units , in the case of far infrared insertion devices to about one thousand , for x - ray fels , so that the applicability of the resonant approximation strongly depends on the situation under study .      in general , it does not make sense to calculate the intensity distribution from eq .",
    "( [ undurad ] ) alone , without extra interfering terms .",
    "yet , we can find _ particular situations _ for which the contribution from eq .",
    "( [ undurad ] ) is dominant with respect to others . in this case , and only in this case , eq .",
    "( [ undurad ] ) , alone , is endowed with physical meaning .",
    "the method proposed in @xcite to calculate the integral in eq .",
    "( [ undurad ] ) is very well - known and used by every textbook treating the details of undulator radiation .",
    "again , we will follow notation in @xcite during our derivation .",
    "the method consists in using the identity    @xmath416    where @xmath417 indicates the bessel function of the first kind of order @xmath418 .",
    "after introduction of    @xmath419    and    @xmath420    one can express the exponential function in eq .",
    "( [ undurad ] ) as :    @xmath421    where    @xmath422    then , eq . ( [ undurad ] )",
    "can be re - written in the more suggestive form :    @xmath423~.&&\\cr \\label{undurad2}\\end{aligned}\\ ] ]    performing the integral in eq .",
    "( [ undurad2 ] ) one gets :    @xmath424\\boldsymbol{\\hat{x } } \\right.&&\\cr\\left.+\\theta\\sin\\left(\\phi\\right ) { \\sin ( \\pi n_w r_\\omega ) \\over{\\pi n_w r_\\omega } } \\boldsymbol{\\hat{y}}\\right\\}.&&\\cr \\label{undurad3}\\end{aligned}\\ ] ]    as is well known , and can be seen by inspection , terms in eq .",
    "( [ undurad3 ] ) exhibit resonant character .",
    "maxima of different terms are found as @xmath425 , @xmath426 and @xmath427 .",
    "these correspond to particular frequencies multiples of the fundamental @xmath406 .",
    "always following @xcite we introduce the harmonic number @xmath428 and we set @xmath429 .",
    "then , after setting @xmath430 , the following expression can be obtained for the field around frequency @xmath431 :    @xmath432\\boldsymbol{\\hat{x } } \\right.&&\\cr\\left .",
    "+ \\theta\\sin\\left(\\phi\\right ) j_m(u ) j_{k-2m}(v ) e^{i\\pi ( k-2m)/2 } \\boldsymbol{\\hat{y}}\\right\\}.&&\\cr \\label{undurad3b}\\end{aligned}\\ ] ]    the factor @xmath433 represents the well - known resonant character of the device : our electron produces field peaked at frequencies @xmath431 only .",
    "@xmath431 is a function of the angle @xmath402 .",
    "once an observation angle @xmath402 is fixed , a resonant frequency @xmath434 is also defined and the bandwidth of the radiation is determined by @xmath435 through the resonant factor @xmath433 .",
    "if we are interested in the angular width of the peak around the observation angle @xmath402 , we can introduce an angular displacement @xmath436 with respect to @xmath402 . the resonant frequency at angle @xmath437 , that is @xmath438 ,",
    "has a different value with respect to @xmath434 .",
    "when @xmath436 becomes large enough , @xmath438 gets outside the bandwidth @xmath439 .",
    "this happens for an angular displacement @xmath436 such that    @xmath440    which is the first zero of the @xmath433 function in eq .",
    "( [ undurad3b ] ) .",
    "if we are interested in the angular width of the peak around @xmath441 in the case @xmath442 , that is for the fundamental harmonic , we should solve the equation    @xmath443    with respect to @xmath436 .",
    "( [ angueq ] ) should be taken only as a rough indication of the angular width of the radiation peak .",
    "in fact , taking the first zero of the @xmath433 function in eq .",
    "( [ undurad3b ] ) is just a convention : as we will see , only through similarity techniques we will be able to determine the natural angle which fits with the physical situation under study : @xmath402 can be compared in a natural way only with that angle , and not with the solution of eq .",
    "( [ angueq ] ) . yet",
    ", following textbooks and tradition we will call with @xmath444 the solution in @xmath436 of eq .",
    "( [ angueq ] ) , and we will refer to it as a rough indication of the angular width of the radiation for the @xmath445 harmonic . the cone with aperture @xmath444 is usually called central cone .",
    "it can be found that ( see @xcite )    @xmath446    where @xmath447 . from the previous discussion",
    "follows that eq .",
    "( [ undurad3b ] ) can be drastically simplified under the approximation @xmath415 and within the central cone @xmath448 .",
    "in particular when @xmath442 , that is for the fundamental harmonic , we have    @xmath449    here we neglected all terms but the one proportional to @xmath388 .",
    "also , @xmath450 , and we have used the fact that @xmath451 .",
    "note that at this point we are not able to specify the accuracy of this approximation precisely : we can only say that , when @xmath452 , our accuracy scales as @xmath453 .",
    "this can be seen showing that the third term in @xmath115 and the term in @xmath116 in the series of eq .",
    "( [ undurad3b ] ) can be neglected with an error @xmath454 .",
    "first we fix @xmath442 , that is the fundamental harmonic .",
    "second we note , from eq .",
    "( [ defi ] ) , that for any value of @xmath390 and @xmath402 much smaller than @xmath455 we have @xmath456 of order unity while @xmath87 is much smaller than unity , so that we can take it as a small parameter : then , the largest contributions from the sum in eq . ( [ undurad3b ] ) will be for the smallest indexes of the bessel functions @xmath457 because of the asymptotic behavior of @xmath458 .",
    "it follows that the third term in @xmath115 and the term in @xmath116 in the series of eq .",
    "( [ undurad3b ] ) are of magnitude @xmath459 or @xmath460 to be compared with the first two terms in @xmath115 scaling as @xmath461 and @xmath462 .",
    "this situation refers to the case when trigonometric functions in @xmath401 are of order unity , otherwise extra factors @xmath463 or @xmath464 should be included as well . taking the trigonometric factors of order unity gives an upper limit to the accuracy of our calculation and we will always do this .",
    "whatever the value of @xmath456 , neglecting the third term in @xmath115 and the term in @xmath116 in eq .",
    "( [ undurad3b ] ) can be done with an accuracy given by the ratio    @xmath465    then , when @xmath466 we obtain @xmath467 . yet , as has already been remarked , @xmath468 is not the natural angle to which @xmath402 should be compared and as a result we can not specify numerical factors in front of the @xmath453 .",
    "later we will comment further on this point .",
    "( [ undurad4 ] ) is indeed well - known , but usually no attention is paid to its deeper meaning . as we have said before , it does not make sense to calculate the intensity distribution from eq .",
    "( [ undurad ] ) alone , without extra interfering terms .",
    "yet , we have told that , in _ particular situations _ , the contribution from eq .",
    "( [ undurad ] ) is dominant with respect to others and that in this case eq . ( [ undurad ] ) , alone , is endowed with physical meaning . on the other hand , we have seen that eq .",
    "( [ undurad ] ) simplify to eq .",
    "( [ undurad4 ] ) if @xmath442 , @xmath415 and within the central cone @xmath469 .",
    "again , when @xmath470 such simplification is valid within an accuracy scaling with @xmath453 .",
    "by inspection of eq .",
    "( [ undurad4 ] ) we see that , due to resonance , the only surviving term scales with @xmath388 . any extra term added to eq .",
    "( [ undurad4 ] ) due to non resonant devices like bending magnets or straight lines will be simply negligible with respect the field in eq .",
    "( [ undurad4 ] ) with an accuracy scaling with @xmath453 .",
    "note that eq .",
    "( [ undurad4 ] ) is valid _",
    "regardless _ the value of @xmath390 ( in particular , in the limit for @xmath471 we have an extra small parameter , then @xmath472 and eq .",
    "( [ undurad4 ] ) can be further simplified ) .",
    "this is the power of the resonant approximation .",
    "we can show that the same result is achievable starting with eq .",
    "( [ generalfin ] ) and neglecting the gradient terms in eq .",
    "( [ generalfin ] ) ( including , therefore , the entire @xmath116-polarization contribution ) and also the constrained particle motion in that part of the phase @xmath113 which follows from the green s function , that can be found in the second term in eq .",
    "( [ totph ] ) .",
    "in fact , with these prescriptions , eq .",
    "( [ undurad ] ) and eq .",
    "( [ phitundu ] ) reduce to    @xmath473    and    @xmath474+\\phi_s~.&&\\cr\\label{phitundusimpli}\\end{aligned}\\ ] ]    eq .",
    "( [ unduradsimpli ] ) can be rewritten as    @xmath475 \\right.&&\\cr\\left .",
    "-\\exp\\left[i \\left({\\omega \\over{2\\gamma_z^2c}}-k_w\\right)z'\\right]\\right\\ } \\exp\\left[i\\omega \\left({\\theta^2 z'\\over{2c}}-{1\\over{\\beta c } } \\right.\\right.&&\\cr\\left.\\left.\\times { k^2\\over{8\\gamma^2 k_w } } \\sin(2 k_w z')\\right)+\\phi_s\\right ] \\boldsymbol{\\hat{x}}&&\\cr ~.\\label{unduradsimpli2}\\end{aligned}\\ ] ]    introducing the detuning parameter @xmath413    @xmath476    eq .",
    "( [ unduradsimpli2 ] ) can be written as    @xmath477\\exp \\left[i \\left(c + { \\omega \\theta^{2}\\over{2 c}}\\right)z'\\right ] & & \\cr \\times \\exp \\left\\{i\\omega \\left[- { 1\\over{\\beta c } } { k^2\\over{8\\gamma^2 k_w } } \\sin(2 k_w z')\\right]+\\phi_s \\right\\ } \\boldsymbol{\\hat{x } } \\label{undusimpli2}\\end{aligned}\\ ] ]    note that @xmath478 has maximal magnitude when @xmath479 because otherwise the integrand in eq .",
    "( [ undusimpli2 ] ) starts displaying oscillatory behavior . for @xmath441",
    "this simply means @xmath480 .",
    "condition    @xmath481    is called the resonant condition .    with the help of eq .",
    "( [ alfeq ] ) , eq .",
    "( [ undusimpli2 ] ) can be transformed to    @xmath482&&\\cr \\times \\exp \\left[i \\left(c + { \\omega \\theta^{2}\\over{2 c}}\\right)z'\\right ] \\exp \\left[2 i m k_w z'\\right ] \\boldsymbol{\\hat{x } } \\label{undusimpli3a}\\end{aligned}\\ ] ]    the only non - zero terms are for @xmath483 and @xmath484 so that    @xmath485 \\boldsymbol{\\hat{x } } ~,\\label{undusimpli3}\\end{aligned}\\ ] ]    where the argument of @xmath486 is implied .",
    "( [ undusimpli3 ] ) can be integrated leading to    @xmath487 \\over{c l_w/2 + \\omega l_w \\theta^{2}/(4 c ) } } a_{jj}\\boldsymbol{\\hat{x } } ~.&&\\cr \\label{undurad4bis}\\end{aligned}\\ ] ]    eq .",
    "( [ undurad4bis ] ) is equivalent to eq .",
    "( [ undurad4 ] ) . this can be seen noting that the argument in the resonant term can be written as    @xmath488 & & \\cr = \\left[{l_w c\\over{2}}+{\\omega l_w \\theta^{2}\\over{4c } } \\right]~ , \\label{resoterm}\\end{aligned}\\ ] ]    as it can be readily shown .",
    "the previous result can be cast in a more compact way , suitable for further manipulations , using the following normalized quantities    @xmath489    as remarked before , introduction of similarity techniques involves recognition of natural quantities which enter in the normalization of equations in one possible way only and fit with the physical nature of the problem . for instance , after the introduction of the normalized angle @xmath490 we can say that @xmath402 is to be compared , naturally , with the angle @xmath491^{1/2}$ ] and not with @xmath468 . when @xmath492^{1/2}$ ] , eq .",
    "( [ accuratio ] ) gives , naturally , the numerical factor in front of @xmath453 that we were not able to specify before .",
    "in particular , substitution in eq .",
    "( [ accuratio ] ) gives the following accuracy for our calculations :    @xmath493    using eq .",
    "( [ c ] ) , eq .",
    "( [ undusimpli3 ] ) and eq .",
    "( [ undurad4bis ] ) can be written respectively as    @xmath494 & & \\cr \\label{undunorm}\\end{aligned}\\ ] ]    and    @xmath495 \\over{\\hat{c } /2",
    "+ \\hat{\\theta}^{2}/4 } } ~ , \\label{unduradnorm}\\end{aligned}\\ ] ]    which are valid in the limit for @xmath496 , @xmath497 , and @xmath498 .",
    "the last relation comes from the fact that we are interested in the fundamental harmonic of our device ; then @xmath499 ; use of eq .",
    "( [ resoterm ] ) gives then @xmath500 .",
    "note that for @xmath501 , that is near resonance , the formation length of the system becomes @xmath410 , as one can readily see imposing that the phase of the integrand in eq .",
    "( [ unduradnorm ] ) be of order unity .    as already remarked , although eq .",
    "( [ undunorm ] ) and eq .",
    "( [ unduradnorm ] ) are well known in literature ( at least in their dimensional form ) , our discussion is far from being a mere repetition of textbook material .",
    "in fact we put particular attention to the assumptions used in order to obtain them , which are completely neglected in textbooks .",
    "our method helped to clarify these assumptions .",
    "now , after this step , eq . ( [ undunorm ] ) and eq .",
    "( [ unduradnorm ] ) constitute the starting point for further manipulations : the investigation of the near - field effects treated in the next paragraph , and the derivation of the field in case of an electron with offset and deflection , treated in paragraph [ sec : ofdef ] .      as it has just been said , eq .",
    "( [ unduradnorm ] ) is derived under several assumptions : @xmath502 , @xmath503 , and @xmath504 . here",
    "we will relax the condition @xmath502 and we will treat near field effects , showing how we can control the accuracy of calculations using our method .",
    "we start considering the near field region , where @xmath505 . in practice ,",
    "the field at the very end of the undulator is not interesting because detectors are , in practice , never put at @xmath506 .",
    "therefore in practical situation we will be always interested in situation where @xmath507 or @xmath508 . in this region ,",
    "suitable for our investigations , the assumption @xmath509 , and the resonant approximation are still retained valid , and allow substantial simplification of the equation for the field at the fundamental harmonic , much like eq .",
    "( [ unduradnorm ] ) is a simplification of eq .",
    "( [ undurad3b ] ) . using the same line of reasoning in the last paragraph , but without expanding expressions @xmath510 around @xmath511 , we obtain the following simplified expression for the field , that is    @xmath512 }   ~.\\label{undundu}\\end{aligned}\\ ] ]    here we introduced normalized units @xmath513^{1/2}$ ] and @xmath514^{1/2}$ ] .",
    "these definitions for normalized units , together with the ones given in ( [ c ] ) , are naturally dictated by the system itself , through the non - normalized equations which describe it .",
    "in particular , @xmath515 and @xmath516 can be derived from the definitions of @xmath490 and @xmath517 in ( [ c ] ) .",
    "using normalized units allows one to compare each physical quantity with its natural measure and has the advantage of reducing the number of parameters that the system depends on to the few fitting the physical characteristics of the problem .",
    "note that because of the resonant approximation , the phase factor in eq .",
    "( [ undundu ] ) is much smaller than @xmath518 .",
    "( [ undundu ] ) is valid for any value of @xmath511 with an accuracy @xmath519 .",
    "we may wish to push analytical investigations further : in fact we have now full control over the expansion of @xmath520 , meaning that we can decide when to truncate the series    @xmath521    both in the first factor and in the exponential factor of eq .",
    "( [ undundu ] ) .    neglecting terms of order higher than @xmath522 in the expansion of the first factor in eq .",
    "( [ undundu ] ) can be done with an accuracy better than @xmath523 so that , with this accuracy , we have    @xmath524 }   \\label{undutrunc1}\\end{aligned}\\ ] ]    now we should study the exponential factor .",
    "let us keep orders up to @xmath525 :    @xmath526    where @xmath527 .",
    "the first term to be neglect will give a contribution to the integrand equal to @xmath528 $ ] .",
    "now , if @xmath529 , this exponential contribution can be expanded too , and the dominant term in the expansion , after unity , will be just of order @xmath530 . neglecting this term",
    "can therefore be done with an accuracy @xmath531 .",
    "if we impose that this accuracy be of order @xmath532 , we have automatically that @xmath533 and we find the useful condition    @xmath534    this can be used to retain important terms : for instance , given a maximal observation angle of interest and an accuracy to be reached , for a certain setup , we find @xmath535 such that @xmath536 is the desired accuracy ; then we find @xmath537 such that eq .",
    "( [ accuaccu ] ) is satisfied . to give a numerical example , if we choose @xmath538 and @xmath539 and we want to get our result with an accuracy of about @xmath540 we can put @xmath541 ; of course we should compare this @xmath540 accuracy with the accuracy of the resonant approximation @xmath542 , which is usually about @xmath249 or smaller .",
    "then , solving eq .",
    "( [ accuaccu ] ) for @xmath537 we find @xmath543 .",
    "note that expansions up to @xmath543 and @xmath541 are easy to solve analytically .",
    "one obtains the following result :    @xmath544 \\right.&&\\cr\\left .",
    "+   { 1\\over{\\hat{z}_o}}\\int_{-1/2}^{1/2 } d\\hat{z } ' \\hat{z } ' \\exp \\left[i \\left(\\bar{u } z'+ \\bar{w } \\hat{z}'^2\\right)\\right ] \\right\\ } \\label{undundu2}\\end{aligned}\\ ] ]    where    @xmath545    and    @xmath546    the parameter @xmath547 is closely related to the near field parameter @xmath548 introduced in @xcite .",
    "in fact , once translated in dimensional units , @xmath549 .",
    "we are therefore able to reproduce the results in @xcite , but this time accounting , thanks to our approach , for accuracy and applicability region of the approximations .    the integrals in eq .",
    "( [ undundu2 ] ) can be calculated analytically leading to    @xmath550 \\label{undundu2biss}\\end{aligned}\\ ] ]    where    @xmath551 \\exp\\left[{i { \\bar{u}^2\\over{4\\bar{w}}}}\\right ] \\label{i1}\\end{aligned}\\ ] ]    and    @xmath552\\sqrt{\\bar{w } } \\right.&&\\cr \\left.\\times \\left[-1+\\exp(i \\bar{u})\\right]+ ( 1+i ) \\bar{u } \\exp\\left[i \\bar{u}{\\bar{u}+2\\bar{w}\\over{4\\bar{w}}}\\right ] \\sqrt{2\\pi } \\right.&&\\cr\\left.\\times \\left[-\\mathrm{erf}\\left({e^{3i\\pi/4 } ( \\bar{u}-\\bar{w})\\over{2\\sqrt{\\bar{w}}}}\\right ) \\right.\\right.&&\\cr\\left.\\left .",
    "+ \\mathrm{erf}\\left({e^{3i\\pi/4 } ( \\bar{u}+\\bar{w})\\over{2\\sqrt{\\bar{w}}}}\\right)\\right]\\right\\ } \\exp\\left[{i { \\bar{u}\\left(\\bar{u}+\\bar{w}\\right)\\over{2\\bar{w}}}}\\right ] \\label{i2}\\end{aligned}\\ ] ]    it might be remarked that the @xmath553 function can be represented in terms of fresnel functions which were used in presentation of results in @xcite . for the sake of comparison with @xcite",
    "it may be interesting to plot @xmath554 as a function of @xmath490 . when terms in @xmath555 are negligible this represents , in normalized units , the intensity in the near field .",
    "this is the case , for instance , if we choose @xmath538 , @xmath539 and we want to get our result with an accuracy of about @xmath556 : then we may set @xmath541 and @xmath557 .",
    "results are plotted in fig .",
    "( [ fresn1 ] ) and in fig .",
    "( [ fresn2 ] ) as intensity as a function of @xmath558 for different values of @xmath547 .",
    "intensity , in arbitrary units , from the term @xmath559 , as a function of @xmath558 for @xmath560 ( upper plot ) and for @xmath561 ( lower plot).,width=321 ]     intensity , in arbitrary units , from the term @xmath559 , as a function of @xmath558 for @xmath562 ( upper plot ) and for @xmath563 ( lower plot).,width=321 ]    the understanding of the region of applicability involved in the derivation of eq .",
    "( [ undundu2biss ] ) allows us to make interesting remarks .",
    "for instance , note that for any given negative value of the detuning parameter @xmath564 there is a value of @xmath490 such that @xmath565 .",
    "this means that even when @xmath566 , for example , the value @xmath567 is such that @xmath568 and the contribution of the near field @xmath547 is dominant . in this case , even choosing @xmath569 , @xmath570 and letting @xmath557 and @xmath541 , the term in @xmath547 is the only contribution up to an accuracy of @xmath571 ( note that this is consistent with eq .",
    "( [ accuaccu ] ) , which gives a maximal angle @xmath572 .",
    "this is a very particular region of parameters , where the electric field depends on the near field parameter @xmath547 even though @xmath502 . in this particular situation",
    "we can write    @xmath573~. \\label{undundu3}\\end{aligned}\\ ] ]      the same remark given in paragraph [ sub : circledef ] for electrons on a circular trajectory is valid here for particles in an undulator : the nominal trajectory is just an approximation .",
    "electron beams have always some finite geometrical emittance and they can be thought , in agreement with paraxial treatment , as a composition of perfectly collimated beams with different deflection angles with respect to the orbital plane of the nominal trajectory . as remarked in paragraph [ sub : circledef ] , this representation will be of great importance in the calculation of complicated quantities like the field autocorrelation function , which is of uttermost importance in the characterization of the statistical properties of a light source .",
    "let us now discuss how to calculate @xmath59 from a single particle moving in an undulator with a given angular deflection and offset with respect to the orbital plane of a nominal electron .",
    "once we answer this question for a single particle , we can add up contributions from different electrons the way we want , in perfect symmetry with paragraph [ sub : circledef ] .",
    "let us introduce electron deflection angles @xmath259 and @xmath260 and displacements @xmath271 and @xmath272",
    ". the particle velocity will be characterized , as a function of @xmath82 , as    @xmath574 \\boldsymbol{x}+\\left[\\eta_y v_z \\right]\\boldsymbol{y}~ , \\label{vuz2}\\ ] ]    so that    @xmath575 \\boldsymbol{x } & & \\cr + \\left[\\eta_y z ' + l_y\\right]\\boldsymbol{y}~. \\label{erz2}\\end{aligned}\\ ] ]    using    @xmath576^{1/2 } \\simeq & & \\cr \\int_{0}^{z } dz ' \\left[1+{1\\over{2}}\\left({d x'\\over{dz'}}\\right)^2+{1\\over{2}}\\left({d y'\\over{dz'}}\\right)^2\\right ] \\label{curvascgen}\\end{aligned}\\ ] ]    one has    @xmath577    we will now work under the approximations : @xmath502 , @xmath578 and we are interested in the fundamental harmonic of our device .",
    "we can use a procedure analogous to the one used in paragraph [ sec : res ] ( and paragraph [ sec : near ] ) to get the following simplified expression for the field in normalized units in resonant approximation :    @xmath579 ~,~ \\label{undunormfin}\\end{aligned}\\ ] ]    where @xmath580 { \\hat{z}_o\\over{2 } } \\label{phisnorm}\\ ] ] the same normalization for @xmath402 holds also for @xmath581 .",
    "the accuracy of eq .",
    "( [ undunormfin ] ) is given by the ratio of @xmath582 to @xmath583 .",
    "when @xmath584 and @xmath585 the accuracy is just @xmath586 . finally , eq . ( [ undunormfin ] )",
    "can be integrated giving    @xmath587    where @xmath588 is given in eq .",
    "( [ phisnorm ] ) , while    @xmath589    in the limit when @xmath590 , one can simplify further eq .",
    "( [ endangle ] ) thus getting : @xmath591 where @xmath592 @xmath593 and    @xmath594    the same remarks given for eq .",
    "( [ srtwoang2 ] ) hold for eq .",
    "( [ endangle ] ) , and we will repeat them here , since we consider them of great importance .",
    "( [ endangle ] ) is an extremely useful tool , because it describes the radiation from an electron with offset and deflection as in an electron beam with finite emittance , including the correct phase factor for the field .",
    "( [ srtwoang2 ] ) was derived here from first principles .",
    "an alternative derivation based on the intuitive picture that the undulator radiation can be approximated as a sum of spherical waves emitted at the entrance of each pole is given in @xcite .",
    "accounting for correct phase means that contributions from different electrons can be simply added up to give the field from a beam with given emittance at any observer position .",
    "starting from eq .",
    "( [ endangle ] ) then , it is possible to calculate the field correlation function , and to provide a study of transverse coherence properties of the radiation from a given electron beam by means of analytical techniques .",
    "again , in perfect analogy with what has been remarked in paragraph [ sub : circledef ] , a numerical code can always be developed , either starting from eq .",
    "( [ generalfin ] ) or just from the lienard - wiechert fields , which calculates the field correlation function in a generic case , but such a code would not help in physical understanding of the situation . on the contrary , eq .",
    "( [ endangle ] ) includes all relevant information about an electron in a realistic beam ( i.e. with offset and deflection ) and , being an analytically manageable expression , constitutes a first step towards the more ambitious goal of characterization of transverse coherence properties from undulator radiation , which we leave for future work .      in the next section [ sec : appl ] , we will make use of eq .",
    "( [ endangle ] ) to calculate radiation from a complex system : we will demonstrate in this way the power and the practical convenience of our computational method . in this paragraph instead , we will study in detail how to apply eq .",
    "( [ endangle ] ) to calculate angular distribution and frequency spectrum of radiation produced by an electron beam in a standard undulator when electron beam emittance is present .",
    "we restrict our attention to the asymptotic case of a large horizontal and a small vertical emittance .",
    "this limiting situation is , in fact , of great practical interest for today s third generation light sources and it will be discussed here in order to illustrate the effectiveness of similarity techniques .",
    "first we assume that we can use eq .",
    "( [ endangle22 ] ) in place of eq .",
    "( [ endangle ] ) . indicating with @xmath595 the minimal values of the betatron function in the @xmath101 and @xmath117 directions and with @xmath596 the angular distributions of the particles , again with respect to horizontal and vertical directions we have    @xmath597    where @xmath598 . upon introduction of    @xmath599    where we neglected all indexes in @xmath600 and @xmath601 for notational simplicity , eq .",
    "( [ angledi ] ) can be rewritten as a function of normalized quantities as    @xmath602    we will treat the limiting case @xmath603 . when @xmath604 as it usually is the case , this is simply a condition on the normalized emittance @xmath605 .    in this particular case , the particle density distribution in the vertical phase space behaves like a @xmath606-distribution .",
    "then , the beam intensity is simply given by    @xmath607    or , in normalized units    @xmath608    where    @xmath609    eq . ( [ ilimit ] ) simplifies further in the limit @xmath610 .",
    "also in this case , when @xmath611 as it is usually verified , this is a condition on the normalized emittance @xmath612 . in this limiting situation , the function @xmath613 in eq .",
    "( [ ilimit ] ) behaves as the @xmath606-distribution @xmath614 when compared with the exponential function , so that eq .",
    "( [ ilimit ] ) can be simplified as    @xmath615 \\over{\\sqrt{2\\pi \\hat{\\varepsilon}_x/\\hat{\\beta}_{o x } } } } \\int_{-\\infty}^{\\infty } d\\hat{\\eta}_x { \\sin^2\\zeta\\over{\\zeta^2 } } ~ \\label{ilimitb}\\ ] ]     from a beam in the limit @xmath616 , @xmath617 .",
    "the intensity is plotted as a function of @xmath618 . dashed line : single particle intensity @xmath619 as a function of @xmath618 for @xmath244[cth ] , width=340 ]     using eq .",
    "( [ htbunch ] ) . dashed line : relative intensity @xmath620 from a beam in the limit @xmath616 , @xmath617 .",
    "the intensity is plotted as a function of @xmath618 , as the solid line in fig .",
    "[ cthfit ] , width=340 ]     from a beam in the limit @xmath616 , @xmath617 .",
    "the intensity is plotted as a function of @xmath621 for @xmath622 . dashed line : single particle intensity @xmath619 as a function of @xmath623 for @xmath244 and @xmath622[thyzero ] , width=340 ]     from a beam in the limit @xmath616 , @xmath617 .",
    "the intensity is plotted as a function of @xmath621 for different values of @xmath564 .",
    "the symbol @xmath413 in the figure legend should be read as @xmath624 .",
    "[ thyplus ] , width=340 ]     from a beam in the limit @xmath616 , @xmath617 .",
    "the intensity is plotted as a function of @xmath621 for different values of @xmath625 .",
    "the symbol @xmath413 in the figure legend should be read as @xmath564 .",
    "[ thyminus ] , width=340 ]    now we can introduce the relative intensity    @xmath626^{-1 } \\hat{i}_b \\label{fine}\\ ] ]    so that    @xmath627    and according to our approximations    @xmath628    with an obvious change of integration variable @xmath629 we finally obtain    @xmath630 \\over{\\left [ \\left({\\hat{c}/{2 } } + { \\hat{{\\theta}}_y^2/{4}}\\right)+ { \\hat{\\eta}_x^2/{4}}\\right]^2 } } ~ , \\label{ilimit3}\\ ] ]    it is now evident that similarity techniques we used are not only a theoretical tool : in fact @xmath620 is a universal function of @xmath618 and eq .",
    "( [ ilimit3 ] ) can be integrated with the help of simple numerical techniques to get the universal plot in fig .",
    "[ cth ] ( solid line ) .",
    "this universal plot is compared , always in fig .",
    "[ cth ] ( dashed line ) , with the relative intensity in the case when also @xmath631 . in this case",
    "we simply have the single particle intensity    @xmath632 \\over{\\left[{\\hat{c}/{2 } } + { \\hat{{\\theta}}_y^2/{4}}+ { \\hat{\\theta}_x^2/{4}}\\right]^2 } } ~. \\label{ilimit3bis}\\ ] ]    the dashed line in fig .",
    "[ cth ] refers to the case @xmath633 ; note the different normalization factor between @xmath620 and @xmath619 .",
    "it may be useful to provide a fit of the universal plot in fig .",
    "[ cth ] using the following function :      fitting for @xmath411 , @xmath412 , @xmath635 , @xmath636 and @xmath637 and using , for instance , a reasonable value for @xmath638 we find @xmath639 , @xmath640 , @xmath641 , @xmath642 and @xmath643 which result in the solid curve in fig .",
    "[ cthfit ] , the dashed curve being a comparison with the real universal function plotted in fig .",
    "it should be noted that @xmath644 has no particular physical sense : it simply gives an analytical approximation for the universal plot in fig .",
    "[ cth ] with graphical accuracy shown in fig .",
    "[ cthfit ] .    after fig .",
    "[ cth ] is tabulated , one can plot the intensity as a function of @xmath621 for given values of @xmath564 simply solving @xmath645 for @xmath621 , @xmath646 being any of the tabulated abscissas with constraint @xmath647 . by fixing @xmath622",
    "we obtain the universal plot in fig .",
    "[ thyzero ] ( solid line ) .",
    "this universal plot is compared , always in fig .",
    "[ thyzero ] ( dashed line ) , with the normalized intensity as a function of @xmath621 in the case when also @xmath631 . the dashed line in fig .",
    "[ thyzero ] refers to the case @xmath633 ; again , note the different normalization factor between @xmath620 and @xmath619 .",
    "note that , for this case , eq .",
    "( [ ilimit3bis ] ) calculated for @xmath622 already constitutes a relatively good approximation for the plot in fig .",
    "[ thyzero ] .    letting @xmath564 vary we obtain universal plots of the intensity parameterized with respect to @xmath564",
    "; we show some of them in fig .",
    "[ thyplus ] and fig .",
    "[ thyminus ] with respect to @xmath648 and @xmath649 .    finally , with the help of a monte carlo simulation described in more detail in the following section [ sec : appl ] , we compared our results with the case of a beam with different values of @xmath650 and @xmath651 , always assuming @xmath652 and no energy spread is present .",
    "note that in general , the spectrum ( at @xmath653 ) or the angular intensity ( at @xmath622 , @xmath244 ) is a function of two parameters : @xmath654 and @xmath655 .",
    "results are shown in fig .",
    "[ accuc ] and fig .",
    "[ accuthy ] , where relative intensities are plotted as a function of @xmath564 for @xmath656 and @xmath657 and as a function of @xmath621 for @xmath622 and @xmath656 , respectively .",
    "[ accuc ] and fig .",
    "[ accuthy ] illustrate the accuracy of the asymptotic limit eq .",
    "( [ ilimit3 ] ) .     as a function of @xmath564 for @xmath656 and @xmath657 . here",
    "curve 1 : relative intensity @xmath620 from a beam in the limit @xmath616 , @xmath617 , as in fig .",
    "curve 2 : relative intensity from a beam with @xmath659 , @xmath660 .",
    "curve 3 : relative intensity from a beam with @xmath659 , @xmath661 .",
    "curve 4 : relative intensity from a beam with @xmath662 , @xmath617 .",
    "curve 5 : relative intensity from a beam with @xmath662 , @xmath660 .",
    "[ accuc ] , width=340 ]     as a function of @xmath621 for @xmath656 and @xmath622 . here",
    "curve 1 : relative intensity @xmath620 from a beam in the limit @xmath616 , @xmath617 , as in fig .",
    "[ thyzero ] .",
    "curve 2 : relative intensity from a beam with @xmath659 , @xmath660 .",
    "curve 3 : relative intensity from a beam with @xmath659 , @xmath617 .",
    "curve 4 : relative intensity from a beam with @xmath662 , @xmath664 .",
    "curve 5 : relative intensity from a beam with @xmath662 , @xmath660 .",
    "[ accuthy ] , width=340 ]",
    "in this section we use our understanding of approximations and region of applicability discussed before to deal with a difficult setup constituted by two or more undulator segments separated by strong focusing quadrupoles . in this section , and in fig .",
    "[ applgeo ] , we consider the particular case of two undulator segments separated by a focusing triplet .",
    "undulator system geometry : two undulator segments are separated by strong focusing quadrupoles.,width=340 ]    this scheme is known as segmented undulator scheme .",
    "insertion devices at petra iii are due to work according to an _ on top _ injection scheme and must therefore be compatible with injection of new particles during operation . in general , injection operations require a larger beam acceptance with respect to an already circulating beam and this poses a strict limit to a safe choice of the length of the insertion devices .",
    "since no focusing element is present inside the undulator the @xmath665 function increases quadratically with the distance from the minimal value in the middle of the undulator . in practice , then , the maximal length of the insertion device is also fixed and one has the rule of thumb @xmath666 . here",
    "we can safely talk about the vertical direction only , because the vertical @xmath665 function is also the shortest .    in principle",
    ", given a certain acceptance @xmath667 , it is possible to increase the @xmath665-function by increasing the undulator gap according to @xmath668 . however , the particle energy and the radiation wavelength are nearly fixed at petra iii",
    ". moreover restrictions related with the number of photons required and with operation of third harmonic scheme apply , which allow only values of @xmath390 around unity .",
    "then , @xmath392 is fixed as well as the magnetic field on axis and , as a result , the undulator gap too .",
    "this means that an upper limit on the @xmath665 function and therefore to the insertion device length @xmath394 is also fixed .",
    "in practical situation , when enough experience with the machine , safety margins might be bent .",
    "for instance a single @xmath7 m - long _ in vacuum _",
    "undulator operates at spring-8 in _ on top _ injection mode with a vertical @xmath669 m. however , safety limits indicate , for a first design , much more stringent constraints .    for a first conservative design",
    ", the segmented undulator scheme constitutes a reliable alternative for filling the first straight section at the new arc of petra iii , which can accommodate a @xmath6 m long insertion device .",
    "breaking a long insertion device in several parts allows one to `` keep the average vertical @xmath665-function rather small which in turn is essential to allow for a small geometrical vertical aperture and magnetic gap '' ( cited from @xcite , section 4.1.8 ) .",
    "`` the maximal vertical @xmath670-function along this undulator will be about @xmath671 m. therefore a vertical inner size of @xmath672 mm is necessary for the corresponding chambers '' ( cited from @xcite , section 3.2.1 ) .    with this motivation in mind",
    "we start our investigation .",
    "we are interested in computing the radiation intensity seen by an observer at angles @xmath673 and @xmath621",
    ". we will be interested in both angular and spectral intensity distribution .",
    "although it is possible to take advantage of the analysis performed in paragraph [ sec : near ] and treat near field effect , in this paper we will restrict our attention to the far field limit .",
    "then we will compare our results with the case of an uniform undulator .",
    "of course radiation intensity can be obtained , numerically , from the lienard - wiechert expressions for the electromagnetic field without approximations of any kind .",
    "the previous statement though , sounds like declaring that solution to all electromagnetic problems can be found solving maxwell s equation : it is undoubtedly true , but quite generic .",
    "the most general expressions for the lienard - wiechert field can be used , and have been used ( again , see @xcite and @xcite for instance ) as a basis for numerical codes , but understanding of correct approximations and their region of applicability can simplify many tasks a lot , including practical and non - trivial ones like the one we are going to study here . instead of relying on computational power",
    "we propose a simple technique for dealing with the segmented undulator scheme which minimizes numerical difficulties and computation time and can be implemented straightforwardly also by non - expert programmers . in order to reach this result",
    "we will use our understanding of approximations in undulator radiation theory , thus simplifying equations as much as possible before using , in the final step , some numerical integration technique .",
    "it is worthwhile to stress the fact that we will have full control of our approximations at every step , meaning that we will be able to get the radiation intensity _ and _ the accuracy with which this is computed as well .",
    "we will consider the undulators tuned at the fundamental frequency .",
    "therefore we start reminding the resonant approximation seen in section [ sec : undu ] . in particular , using our method we were able to demonstrate that under the resonant approximation the field contribution from non - resonant structures can be neglected with respect to the undulator field with an accuracy of @xmath674 . here",
    "we will restrict our attention to a region of parameters where such an approximation is valid . having indicated , as in fig .",
    "[ applgeo ] , with @xmath675 the straight section length , we will therefore be interested in the fundamental harmonic of the system within the assumptions : @xmath676 , @xmath677 , and @xmath504 .    also , for the same reason and with the same accuracy we can neglect the constrained motion in the green s function phase and consider the particle moving on a straight line when calculating this phase term .    in paragraph",
    "[ sec : ofdef ] we treated the case of a single electron with offset and deflection . if one is interested in the far field limit case , one can use eq .",
    "( [ endangle22 ] ) to obtain the contributions from each segment but special attention must be taken in summing up the fields with the correct relative phase factor .    with the help of eq .",
    "( [ endangle22 ] ) and the coordinate system depicted in fig .",
    "[ applgeo ] we start accounting for the field contributions from the first and the second undulator in the case there is no straight section between the two segments that is @xmath678 , defined as @xmath679 , is zero . in this case",
    "we have :    @xmath680    while @xmath681 where    @xmath682    @xmath683    and @xmath684 here @xmath286 is defined as usual by eq .",
    "( [ phisnorm ] ) ; offsets @xmath685 refer to the middle point of the system ( i.e. the point with zero value of @xmath61 in fig .",
    "[ applgeo ] ) and deflections @xmath686 and @xmath687 refer to the first and the second undulator respectively , and the relation between the two is determined by the focusing elements only : therefore it makes sense to talk about deflections for the first and the second undulator without specifying the point .    the next step is to account for the phase shift in the case @xmath688 . on the one hand , shifting the first segment of a quantity @xmath689 gives a phase contribution :    @xmath690~. \\label{df1}\\ ] ]    on the other hand , shifting the second segment of a quantity @xmath691 leads to an extra phase term :    @xmath692~. \\label{df2}\\ ] ]    to complicate the situation further , we should account for the fact that , in order to practically control the relative phase between the two contributions phase shifters will be installed .",
    "these devices are also useful in fel technology ( see @xcite ) ; in the case of petra iii , they will be usually designed and tuned in order to provide matching condition for particles at nominal energy moving at zero angle with respect to the undulator axis , and with zero detuning .",
    "this means that the phase shifter will contribute for a relative phase @xmath693 such that    @xmath694    where @xmath695 is an integer number .",
    "taking out the unessential @xmath696 contribution ( or setting @xmath697 ) and accounting for @xmath693 one gets    @xmath698~ \\label{df1b}\\ ] ]    and    @xmath699~. \\label{df2b}\\ ] ]    finally , we make use of the relation @xmath700 and we express @xmath701 and @xmath702 in normalized units thus writing    @xmath703\\hat{l}_s~ \\label{df1c}\\ ] ]    and    @xmath704\\hat{l}_s~ \\label{df2c}\\ ] ]    where    @xmath705    we can account for a given energy deviation @xmath706 expanding @xmath564 around the nominal energy .",
    "trivial calculations show that , for @xmath408 , @xmath406 being now calculated at @xmath441 and at nominal energy we obtain a shift @xmath707 in the detuning parameter given by    @xmath708    including @xmath707 in our equations we obtain the final results :    @xmath709    and @xmath710 with    @xmath711    @xmath712    @xmath713\\hat{l}_s~ , \\label{df1cf}\\ ] ]    @xmath714\\hat{l}_s~ , \\label{df2cf}\\ ] ]    where @xmath564 is now the detuning parameter for a particle with nominal energy and other quantities are as defined before .",
    "as we have said , focusing elements simply change the electron trajectory , but they do not contribute directly to the total field at the observer position . we will treat them like a thin lens with focal length @xmath715 and @xmath716 in the horizontal and vertical planes respectively .",
    "we can , therefore , introduce normalized focal lengths @xmath717 and @xmath718 .    from now on , when possible",
    ", we will neglect indexes @xmath101 or @xmath117 for notational simplicity . if we have offset and deflection @xmath719 and @xmath720 at the entrance of the system ( where @xmath721 , see fig .",
    "[ applgeo ] ) , we can easily calculate    @xmath722    it is worth to note here that if we take the limit for @xmath723 and @xmath724 , the sum @xmath725 gives back eq .",
    "( [ endangle ] ) , as it must .",
    "since we have many particles here we can consider a collective description of the beam , for instance in terms of the twiss parameters @xmath726 , @xmath727 and @xmath728 for the horizontal and vertical planes at the entrance of the system , where @xmath729 .",
    "knowing the twiss parameters and the emittance @xmath730 at the entrance of the first undulator it is easy to write down the number of particles with offset between @xmath731 and @xmath732 and with deflection angles between @xmath733 and @xmath734 , always at the entrance of the system ; in fact , one can simply write it as @xmath735 , where @xmath736 is the following density distribution @xcite :    @xmath737 } ~.&&\\cr \\label{distri}\\end{aligned}\\ ] ]    here @xmath738 is the number of particles in the beam and again , for notational simplicity , we are taking indexes @xmath101 and @xmath117 as implicit .",
    "upon introduction of    @xmath739    we can write eq .",
    "( [ distri ] ) as a function of dimensionless quantities as    @xmath740}~. & & \\cr \\label{distriad}\\end{aligned}\\ ] ]    .set of parameters for the segmented undulator scheme [ tavola1 ] [ cols=\"^,^,^ \" , ]     the local energy spread of the beam will be assumed to be a gaussian function with standard deviation @xmath741 :    @xmath742    where @xmath743 and    @xmath744    brackets indicating the ensamble average over the particle distribution .",
    "a set of realistic normalized parameters for the segmented undulator is given in table [ tavola1 ] and table [ tavola2 ] for dimensional and dimensionless quantities , respectively . from these tables",
    "we can already foresee a large effect of the normalized energy spread parameter @xmath741 which is , in our case , comparable with the normalized horizontal emittance .",
    "we can now average the normalized intensity over the particle distribution function and the energy spread of the beam at the entrance of the system thus finding the final expression for the total intensity @xmath745    @xmath746    as in eq .",
    "( [ blab ] ) , the normalized intensity @xmath745 is related to the non - normalized intensity @xmath747 by    @xmath748    moreover @xmath749 is expressed in terms of @xmath750 and @xmath751 in eq .",
    "( [ eta2 ] ) .",
    "we now reached an expression , eq .",
    "( [ intfinal ] ) , which can be integrated with the help of numerical techniques .",
    "results of numerical integration are the intensity as a function of the detuning parameter @xmath564 for fixed observation angles or the intensity as a function of angles for a fixed detuning parameter .",
    "we developed a short code which uses a monte carlo method to compute eq .",
    "( [ intfinal ] ) .",
    "a quasi - random generator is used to fill the horizontal and vertical transverse phase space with a given number of particles .",
    "the actual simulation makes use of sobol sequences to reduce the formation of cluster of particles , a well known phenomenon described , for instance , in @xcite and references therein .",
    "then , the intensity for each particle is calculated and all contributions are summed up to give an estimation of eq .",
    "( [ intfinal ] ) .",
    "the critical parameter in this kind of codes is the number of particles used .",
    "in general the higher the number of particles is , the smaller the fluctuation of the results from run to run and the higher the accuracy of the integration . on",
    "the other hand numerical algorithm designers warn that quasi - random sequences start to display unwanted correlations after several tens of millions calls to the generating routine .",
    "we observed that a choice of several million particles is more than sufficient to ensure that results converge fast enough so that no relevant fluctuation is present in the outcome ( with graphical accuracy of the results which will be described in the next few figures ) .    first , we compared results from the monte carlo approach in the limiting case @xmath724 , @xmath752 , @xmath616 , @xmath753 and @xmath754 .",
    "results were in perfect agreement with the ones shown in fig .",
    "[ cth ] , fig .",
    "[ thyzero ] , fig .",
    "[ thyplus ] and fig .",
    "[ thyminus ] as it should be .",
    "then , as has already been said in paragraph [ sec : ofdef ] we compared this asymptotic situation with a more practical case of a uniform undulator with @xmath755 and @xmath756 .",
    "results have been already described , and shown in fig .",
    "[ accuc ] and fig .",
    "[ accuthy ] .    .",
    "the intensity is plotted as a function of @xmath564 for @xmath656 and @xmath657 .",
    "it is normalized to the maximal intensity from a beam in a uniform undulator .",
    "dashed line : relative intensity from a beam in a uniform undulator ( @xmath724 m and @xmath757 ) .",
    "we set the minimal betatron function values @xmath758 in the horizontal direction and @xmath759 m in the vertical one .",
    "@xmath760 and @xmath741 are left unvaried as in table [ tavola2 ] .",
    "[ intc ] , width=340 ]    .",
    "the intensity is plotted as a function of @xmath621 for @xmath656 and @xmath622 .",
    "it is normalized to the maximal intensity from a beam in a uniform undulator . dashed line : comparison with the relative intensity from a beam in a uniform undulator ( @xmath761 m and @xmath757 ) .",
    "we set the minimal betatron function values @xmath758 in the horizontal direction and @xmath759 m in the vertical one .",
    "@xmath760 and @xmath741 are left unvaried as in table [ tavola2 ] .",
    "[ inthy ] , width=340 ]    finally we used all the features of our program in order to deal with the segmented undulator case .",
    "we set up parameters as in table [ tavola1 ] , which correspond to a design set for the petra iii case . the solid line in fig .",
    "[ intc ] represents the intensity as a function of the detuning parameter @xmath564 at @xmath633 and @xmath657 . the dashed line in fig .",
    "[ intc ] is the intensity for the uniform undulator case , corresponding to the limit @xmath724 m and @xmath757 , while @xmath762 m. in this case we set the minimal betatron function values to @xmath763 m in the horizontal direction and @xmath764 m in the vertical one .",
    "beam energy , wavelength , undulator deflection parameter , relative energy spread and electron beam emittances are left unvaried as in table [ tavola1 ] . assuming the minimal @xmath665 function in the center of the undulator we can calculate the twiss parameters at the system entrance using for both horizontal and vertical plane ( see , for instance , @xcite ) :    @xmath765~ , \\label{betwiss}\\ ] ]    @xmath766    @xmath767    where @xmath768 indicates the @xmath61-position at the beam waist , while subscripts `` o '' , as usual , denote minimal values of the twiss parameters . taking @xmath769 m at the center of the system and @xmath770 m we obtain the initial twiss parameters to enter in our program : @xmath771 , @xmath772 m and @xmath773 m@xmath774 , @xmath775 , @xmath776 m and @xmath777 m@xmath774 .",
    "it is important to remark that we normalized the solid line in fig .",
    "[ intc ] , that is the result for the segmented undulator , to the maximal intensity found for the uniform undulator while the dashed line represents the relative intensity for the uniform undulator .",
    "this allows direct comparison between uniform undulator and segmented undulator schemes .    to conclude , in fig .",
    "[ inthy ] ( solid line ) we plot again the intensity as a function of @xmath621 at @xmath622 and @xmath656 .",
    "similarly as for fig . [ intc ] , the dashed line in fig [ intc ] represents a comparison with the uniform undulator case @xmath778 m and @xmath757 , where the other parameters are left unvaried as in table [ tavola1 ] .",
    "normalization of the curves are as in fig .",
    "the final results for the two schemes do not appear to be dramatically different .    as a comment for both fig .",
    "[ intc ] and fig .",
    "[ inthy ] it is interesting to note the smoothing action of finite beam emittance combined with finite energy spread .",
    "in this paper we have shown that even well - known and long studied subjects , like synchrotron radiation , continue to retain interest from a theoretical viewpoint .",
    "in particular we have proposed a technique to compute harmonic contributions of the electric field from a moving charge particularly suitable for analytical investigations .",
    "we showed that our general expression , eq .",
    "( [ generalfin ] ) , can be obtained from already known expression eq .",
    "( [ rev2 ] ) with the use of a paraxial approximation , but also much more straightforwardly from maxwell s equation in paraxial form , with the help of a parabolic green s function method .",
    "the main advantage of our approach with respect to standard techniques is that we separated from very beginning approximations independent from the system under study ( paraxial approximation ) and assumptions that , from time to time , arise in the study of a particular magnetic system .",
    "this gave us the possibility to specify region of applicability and accuracy of well known results , which we were , of course , able to recover using our method , like the field from a charge moving on a circle , in a short bending magnet or in an undulator and also edge radiation effects from a particular setup .",
    "again , our particular approach is logically much less involved with respect to the others , since it relies on direct integration of the paraxial maxwell s equations for a given harmonic . as a result",
    ", our expression gives a clearer and completely fresh insight in old results . besides being able to discuss their region of applicability and their accuracy , we pointed out that phase corrections with respect to the spherical wavefront for an electron on a circle arise naturally from analytical treatment .",
    "we have seen that short magnet radiation is a complete separate phenomenon with respect to edge radiation .",
    "we stressed the importance of the knowledge of the entire electron trajectory in order to obtain a correct calculation of the field : from this viewpoint we have seen how edge radiation from two dipoles separated by a straight section arises , in our method , from the contribution due to the straight section alone , and that the field term from the magnets is completely negligible .",
    "we discussed , under resonance approximation , accuracy and applicability region of the far field undulator radiation and we dealt with near field effects as well : in particular we were able to reproduce already known results studying their region of applicability in detail , and we found also other regions of interest , where the near field parameter @xmath547 is of fundamental importance .",
    "besides this , our method proved to be a reliable basis for calculation of more complicated quantities like field autocorrelation functions , either from bending magnets or undulators , which are of fundamental importance in the understanding of spatial coherence properties of synchrotron radiation .",
    "in fact , by direct application of our general formula eq .",
    "( [ generalfin ] ) we were able to provide analytically manageable expressions for bending magnet or undulator radiation in the case of an electron with a transverse offset and deflection .",
    "these expressions can be integrated over realistic beam particle distributions and can be used in very practical calculations .",
    "their strength stems from the fact that they correctly account for the field phase and that they can be simply summed up to give results for apparently complicated situations .",
    "complete treatment of spatial coherence would probably double the size of this paper .",
    "for this reason , this first work focuses on the basis of synchrotron radiation theory only .",
    "a few applications which exploit the power of our approach have been selected for the final part of the paper . at the end of section [ sec : undu ] we addressed basic characteristics of undulator radiation in the presence of electron beam emittance .",
    "we discussed the asymptotic situation for a large horizontal and a small vertical emittance .    finally , in section",
    "[ sec : appl ] , we considered a novel undulator configuration ( setup of two undulators separated by a focusing element ) which is planned for installation at petra iii .",
    "computation of radiation characteristics from new setups by means of numerical techniques alone requires , almost always , modifications of existing simulation codes which can be better done by the code authors themselves . up to date",
    ", the particular case we chose to study has not been included in existing simulation codes .",
    "for this reason we selected this particular example : our goal was to demonstrate that , in general , the application of our method allows solution of apparently difficult problems relying on simple computer algorithm which can be developed by non - expert programmers , with obvious advantages in saving time and better physical understanding .",
    "we expect that our technique will be used in the future as a basis for developments of simulation codes and for physical understanding of complex situation as well .",
    "the authors are grateful to klaus balewski , werner brefeld , winfried decking , martin dohlus , hermann franz , petr ilinski and edgar weckert for many useful discussions and to oliver grimm , jochen schneider and ivan vartanyants for their interest in this work .",
    "99 j. schwinger , phys .",
    "rev . 75 , 1912 ( 1949 ) d. iwanenko and i. pomeranchuk , phys .",
    "65 , 343 ( 1944 ) a. sokolov and i. ternov , synchrotron radiation , akademie verlag , berlin ( 1968 ) j. jackson , classical electrodynamics , john wiley and sons inc .",
    "( 1998 ) h. wiedemann , particle accelerator physics , springer - verlag ( 1993 ) h. wiedemann , synchrotron radiation , springer - verlag , germany ( 2003 ) a. hofmann , cas - cern accelerator school 1998 , cern 98 - 04 ( 1998 ) a. hofmann , the physics of synchrotron radiation , cambridge univ .",
    "press , cambridge ( 2003 ) f. ciocci , g. dattoli et al . ,",
    "insertion devices for synchrotron radiation and free electron laser , world scientific publishing co. pte . ltd . ,",
    "singapore ( 2000 ) p. duke , synchrotron radiation - production and properties , oxford university press inc .",
    ", new york ( 2000 ) petra iii technical design report , issn 0418 - 9833 , edited by k. balewski , w. brefeld et al . , desy , hamburg ( 2004 ) h. kitamura , t. bizen et al .",
    "instr . meth .",
    "res . a , 467 - 468 , 110 ( 2001 ) t. thurn - albrecht , g. meier et al . , phys .",
    "e 59 , 642 ( 1999 ) s. mochrie , a. mayers et al .",
    "78 , 1275 ( 1997 ) o. tsui and s. mochrie , phys",
    "e 57 , 2030 ( 1998 ) d. riese , w. vos et al .",
    "e 61 , 1676 ( 2000 ) t. seydel , a. madsen et al .",
    "b , 63 0734099(4 ) ( 2001 ) i. sikharulidze , i. dolbnya et al . ,",
    "88 , 115503(4 ) ( 2002 ) a. snigirev , i. snigireva et al . ,",
    "66 , 5486 ( 1995 ) s. wilkins , t. gureyev et al . ,",
    "nature 384 , 335 ( 1996 ) t. gureyev , c. raven et al . , j. phys .",
    "d 32 , 563 ( 1999 ) p. cloetens , w. ludwig et al .",
    "75 , 2912 ( 1999 ) j. miao , p.",
    "charalambous et al .",
    "nature 400 , 342 ( 1999 ) i. robinson , j. libbert et al . ,",
    "b 60 , 9965 ( 1999 ) j. pitney , i. robinson et al . , phys . rev .",
    "b 62 , 13084 ( 2000 ) a. letoublon , f. yakhou et al .",
    "54 , 753 ( 2001 ) o. chubar , p.elleaume et al .",
    "res . a , 435 , 495 ( 1999 ) t. tanaka and h. kitamura , j. synch .",
    "8 , 1221 ( 2001 ) o. chubar , rev .",
    "66 , 1872 ( 1995 ) o. chubar and n. smolyakov , proceedings of the 1993 particle accelerator conference , washington dc , usa , 1626 ( 1993 ) y. hirai , a. luccio et al .",
    ", j. appl .",
    "55(1 ) , 25 ( 1984 ) y. takayama and s. kamada , phys . rev .",
    "e 59 , 6 ( 1999 ) v.g .",
    "bagrov , n.i .",
    "fedsov and i.m .",
    "ternov , phys .",
    "d 28 , 2464 ( 1982 ) g. geloni , e. saldin , e. schneidmiller and m. yurkov , desy 03 - 031 , issn 0418 - 9833 , desy , hamburg ( 2003 ) v. a. bordovitsyn ( editor ) , synchrotron radiation theory and its development , world scientific , singapure - london , ( 1999 ) j. w. goodman , statistical optics , john wiley @xmath779 sons , inc . ,",
    "1985 l. mandel and e. wolf , optical coherence and quantum optics , cambridge university press , 1995 d. attwood , soft x - rays and extreme ultraviolet radiation , cambridge university press , 1999 r.a .",
    "bosch , nucl .",
    "instr . meth .",
    "res . a , 386 , 525 ( 1997 ) p. roy , j - b .",
    "brubach et al . , nucl .",
    "instr . meth .",
    "res . a , 426 ( 2001 ) r.a .",
    "bosch , nucl .",
    "instr . meth .",
    "res . a , 482 , 789 ( 2002 ) p. ilinski , ph.d .",
    "thesis , illinois institute of technology ( 1998 ) d. alferov , y.a .",
    "bashmakov et al .",
    "phys . - tech .",
    "18 , 1336 ( 1974 ) r. walker , nucl .",
    "instr . meth .",
    "a , 267 , 537 ( 1988 ) j. pflger and m. tischer , tesla - fel 2000 - 08 ( 2000 ) j. rosenzweig , fundamentals of beam physics , oxford university press inc . , new york ( 2003 ) y. takayama , n. takaya et al .",
    "instr . meth .",
    "res . a , 441 , 565 ( 2000 ) s. reiche , ph.d .",
    "thesis , desy - thesis-2000 - 012 , desy , hamburg ( 2000 )"
  ],
  "abstract_text": [
    "<S> this work contains a systematic treatment of single particle synchrotron radiation and some application to realistic beams with given cross section area , divergence and energy spread . </S>",
    "<S> standard theory relies on several approximations whose applicability limits and accuracy are often forgotten . </S>",
    "<S> we begin remarking that on the one hand , a paraxial approximation can always be applied without loss of generality and with ultra relativistic accuracy . on the other hand , dominance of the acceleration field over the velocity part in the lienard - wiechert expressions </S>",
    "<S> is not always granted and constitutes a separate assumption , whose applicability is discussed . treating synchrotron radiation in paraxial approximation </S>",
    "<S> we derive the equation for the slow varying envelope function of the fourier components of the electric field vector . </S>",
    "<S> calculations of synchrotron radiation properties performed by others showed that the phase of the fourier components of the electric field vector differs from the phase of a virtual point source . </S>",
    "<S> in this paper we present a systematic , analytical description of this phase shift , calculating amplitude and phase of electric field from bending magnets , short magnets , two bending magnet system separated by a straight section ( edge radiation ) and undulator devices . </S>",
    "<S> we pay particular attention to region of applicability and accuracy of approximations used . finally , </S>",
    "<S> taking advantage of results of analytical calculation presented in reduced form we analyze various features of radiation from a complex insertion device ( set of two undulators with a focusing triplet in between ) accounting for the influence of energy spread and electron beam emittance .    </S>",
    "<S> * deutsches elektronen - synchrotron *    * + *    desy 05 - 032    february 2005    @xmath0    @xmath1    * paraxial green s functions in synchrotron radiation theory *    @xmath2    gianluca geloni , evgeni saldin , evgeni schneidmiller and mikhail yurkov    _ + deutsches elektronen - synchrotron desy , hamburg _ </S>",
    "<S> @xmath1 @xmath1 @xmath1 @xmath1 @xmath1 @xmath1 @xmath1 @xmath1 @xmath1 @xmath1 @xmath1 issn </S>",
    "<S> 0418 - 9833 @xmath1    * notkestrasse 85 - 22607 hamburg * </S>"
  ]
}