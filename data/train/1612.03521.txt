{
  "article_text": [
    "recently , we have proposed and developed novel wave function methods based on symmetry - projected hartree - fock@xcite ( phf ) in analogy with the traditional single reference approaches.@xcite it appears phf successfully treats the major static ( nondynamical ) correlation effect arising due to electronic degeneracies in a system , by breaking and restoring the symmetries that a wave function ought to possess .",
    "the key feature of symmetry - breaking is that a broken - symmetry hf determinant such as spin - unrestricted hf ( uhf ) can be written as a linear combination of _ multiple _ configuration state functions , each of which is highly multi - reference ( mr ) possessing a proper symmetry . as a result ,",
    "such an `` effectively mr '' picture hidden in a broken - symmetry slater determinant is potentially capable of providing an efficient means to account for static correlation.@xcite a symmetry projection operator then eliminates the undesired components with the irrelevant symmetries , retrieving a _ genuine _ mr wave function with the designated symmetry .",
    "hence , phf stands as an improved alternative to rhf and uhf , while being black - box unlike most traditional mr methods . this fact has motivated us to develop post - phf methods to account for the residual dynamical correlation by applying perturbation theory@xcite ( emp2 ) or configuration interaction@xcite ( eci ) , without necessiating very expensive canonical mr calculations .",
    "combining phf with density functional correlations was also shown to improve the quantitative accuracy by garza and coworkers.@xcite another direction of post - phf developments includes a time - dependent extension@xcite ( tdphf ) and introduction of spin - flip ( sf ) excitations@xcite for excited states .",
    "however , most benchmark calculations in these works have focused only on energetics , and molecular properties such as dipole moment have been hardly studied .",
    "this is due to the fact that all these post - phf methods do not satisfy the hellmann - feynman theorem , despite they have well - defined wave functions or energy functionals .    to account for the non - hellmann - feynman contribution",
    ", one needs to find the energy derivative with respect to an infinitesimal perturbation . to see this ,",
    "let us introduce a one - electron perturbation @xmath0 into the hamiltonian @xmath1 , @xmath2 where we assume basis functions do not depend on @xmath3 for the sake of simplicity .",
    "the taylor expansion of @xmath4 around @xmath5 becomes @xmath6 since approximate wave functions do not in general satisfy the hellmann - feynman theorem , the expectation value of @xmath7 is different from the first - order energy derivative .",
    "it is widely accepted that the derivative approach is more appropriate because it accounts for the response of perturbation .",
    "the one - electron property with @xmath7 can be computed by @xmath8 where @xmath9 is the relaxed density .",
    "the molecular properties computed without the appropriate response correction are known to be inaccurate for approximate methods , and the importance of the non - hellmann - feynman contribution in calculation of molecular properties is well documented.@xcite phf does not suffer from this problem since it satisfies the hellmann - feynman theorem if the @xmath3 dependence is not present in basis functions . if , on the other hand , @xmath3 is a nuclear displacement @xmath10 , then phf also requires the non - hellmann - feynman term , the so - called pulay force.@xcite yet , the fully variational nature of the phf wave function makes the derivation straightforward without the necessity of solving the coupled - perturbed ( cp ) equations@xcite or equivalently the z - vector equation@xcite for phf .",
    "in fact , the analytical nuclear derivative of phf was first derived by schutski _",
    "except for the point - group symmetry projection,@xcite which was later incorporated by uejima and ten - no.@xcite the latter authors also derived the nuclear gradient for the projection - after - variation scheme , where the orbitals used are variationally determined by uhf , and therefore the corresponding cphf equation was required in general with less computational cost for the self - consistent field ( scf ) part .",
    "taking these works into consideration , our next step is to devise the analytical gradients of post - phf methods with respect to nuclear displacements , because not only is it straightforward to obtain the relaxed density matrix @xmath9 from the resulting expressions , but also it will enable us to perform geometry optimization . in this paper , therefore we will give a detailed discussion on the analytical derivative technique with a special focus on the recently developed eci with singles and doubles ( ecisd)@xcite as an illustrative example .",
    "hence , the projection operator we consider is of collinear spin - symmetry , i , e , the reference is spin - projected uhf ( suhf ) ; this is reasonable as the most post - phf schemes developed so far are based on collinear spin - projection .",
    "nonetheless , we first give a general perspective for post - phf gradients , including other symmetry - projections , in order to point out that it is straightforward to generalize the working equations of ecisd although the resulting derivations would be necessarily cumbersome .",
    "also the strategy outlined below is applicable to any other levels of theory than ecisd ; for example , geometry optimization of tdphf excited states are possible .",
    "their specific derivations and performances will be discussed in the forthcoming papers .",
    "this paper is organized as follows . in section [ sec : general ] , we will outline the general workflow for analytical derivative of post - phf methods , with some notes on the difference from post - hf ones .",
    "suhf , the nonorthogonal wick theorem , and ecisd are briefly reviewed in section [ sec : nomen ] to define our notations used throughout this paper .",
    "section [ sec : ecisdfock ] and [ sec : cpphf ] provide the working equations for the ecisd orbital gradient and cpphf equations .",
    "section [ sec : explicit ] deals with the explicit dependence of the energy on the nuclear displacement .",
    "a short remark on the size - consistent correction to ecisd is given in section [ sec : ecisd+q ] .",
    "finally , we demonstrate the validity and performance of ecisd energy gradients for ozone and cyclobutadiene .",
    "we first consider the analytical nuclear gradients of post - phf methods whose total energy @xmath11 may be variational with respect to particle - hole amplitudes @xmath12 , e.g. , ci coefficients .",
    "due to the restriction that mo coefficients * c * are optimal with phf energy @xmath13 but not with @xmath11 itself , one has to take into account the effect of the possible orbital change upon a small perturbation @xmath10 , either explicitly or implicitly . one way is to formulate and solve linear equations to compute @xmath14 for @xmath15 times , just like cphf . for traditional post - hf methods , handy and schaefer",
    "have shown that these linear equations can be simplified to only one set of equations , using their z - vector method.@xcite a different formulation of the z - vector method was realized by helgaker et al.,@xcite which uses the lagrangian multiplier approach and has later gained popularity in electronic structure theory because it has extended the applicability of the z - vector method to any order of energy derivatives.@xcite we will closely follow helgaker s scheme as it is intuitive , simple , and equally applicable to phf based methods .    in our problem , * c * is determined by minimizing @xmath13 instead of @xmath16 under the condition that orbitals are mutually orthonormal .",
    "this means the generalized brillouin theorem holds ; given the phf energy @xmath17 with the corresponding phf state @xmath18 : @xmath19 where we have used the fact that @xmath20 is commutable with @xmath1 and is orthogonal to each other.@xcite here @xmath21 is a broken - symmetry hf determinant and @xmath22 represent different symmetry components .",
    "also , throughout this paper , we will use the _ spin_-orbitals unless otherwise noted , with @xmath23 to indicate occupied orbitals , @xmath24 virtual orbitals , @xmath25 general orbitals , and @xmath26 atomic orbitals ( ao ) .",
    "therefore , generally , each index runs over both @xmath27 and @xmath28 spins . we should mention that , in our notation , a matrix may be represented in either ao or mo , depending on the characters used for indices .",
    "in addition to the orbital condition eq.([eq : fai ] ) , @xmath29 are also variationally determined by diagonalizing the hamiltonian matrix @xmath30 under metric @xmath31 .",
    "hence , similarly to many post - hf methods , we set up the following lagrangian , @xmath32 + \\sum_{ia } \\left ( z_{ai } { \\mathcal f}_{ai } + z_{ia } { \\mathcal f}_{ia } \\right ) { \\nonumber\\\\}&+ \\sum_{\\cal kk'}\\bigl [ { \\cal z}_{\\cal k } \\left({\\cal h}_{\\cal kk ' } - e_{\\rm phf } { \\cal n}_{\\cal kk'}\\right)f_{\\cal k ' }   { \\nonumber\\\\ } & - \\lambda \\left({\\cal n}_{\\cal kk ' } f_{\\cal k}^ * f_{\\cal k ' }   -1 \\right)\\bigr ]   - { { \\rm tr}}[{\\bm",
    "\\epsilon}\\left({{\\bf c}}^\\dag { { \\bf s}}{{\\bf c}}- { \\bf 1}\\right)],\\label{eq : lag}\\end{aligned}\\ ] ] where @xmath33 and @xmath34 are the lagrange multipliers to account for the first - order relaxation effect of * c * and * f * in the presence of correlation , and therefore will play a role of response",
    ". note that nonzero * z * and @xmath34 are due to the absence of the hellmann - feynman theorem in @xmath11 .",
    "the dimension of * z * changes depending on the phf scheme employed ; for non - collinear phf , the @xmath35 and @xmath36 components are nonzero , while for collinear suhf , they are redundant and necessarily zero . the terms with @xmath37 and @xmath38 in eq.([eq : lag ] ) are added due to the orthonormal condition of @xmath39 and @xmath40 under metric @xmath41 and ao overlap matrix * s*. finally , note that the normalization condition of * c * is not explicitly treated here for the sake of simplicity , but it is implicitly included in the denominator of @xmath42 .    with parameters @xmath43 determined variationally , i.e. , @xmath44 , we find @xmath45 and therefore using the chain - rule @xmath46 the troublesome @xmath47 and @xmath48 terms shall not enter the equation if we enforce @xmath49 .",
    "below , instead of using * c * itself , we parametrize * c * as @xmath50 = { \\bf c}_0 \\exp({\\bm\\kappa}),\\end{aligned}\\ ] ] for convenience , where @xmath51 is an anti - hermitian matrix and @xmath52 performs an orbital rotation from the reference @xmath53 , which is set to constant . then our task boils down to finding appropriate lagrange multipliers @xmath54 , @xmath55 , @xmath37 , and @xmath56 by requiring @xmath57 .",
    "henceforth , we will only consider @xmath58 derivatives , as @xmath51 derivatives are just their complex conjugates .    the orbital rotation on a projected wave function",
    "is expressed simply by @xmath59 with @xmath60 where @xmath61 is the underlying broken - symmetry wave function , and both anti - symmetric matrix @xmath51 and @xmath62 are spin - dependent .",
    "the orbital gradient and * f * gradient of @xmath11 are hence defined by @xmath63 and , together with the derivatives of the second and last terms of eq.([eq : lag ] ) , they will constitute the z - vector equations for post - phf , which we refer to as cpphf equations .",
    "note that @xmath37 is easily identified as a constant @xmath11 , which can be verified by multiplying @xmath64 by @xmath29 and then by summing over all @xmath65 .",
    "once * z * , @xmath55 , and @xmath66 are all determined , the energy gradient for perturbation @xmath10 becomes @xmath67-   \\sum_{pq } \\epsilon_{pq } ( { { { \\bf c}}^\\dag { { \\bf s}}^x { { \\bf c}}})_{qp},\\label{eq : ex1}\\end{aligned}\\ ] ] where superscripts @xmath10 and @xmath68 respectively indicate the total derivative and partial derivative with @xmath69 $ ] fixed .",
    "if @xmath11 is not variational with respect to @xmath43 , we also have to treat * c * in a similar way to * c * as above .",
    "this happens when @xmath11 has an additional correction term like the davidson correction to ci,@xcite or when @xmath11 and * c * are determined by a projective way as in coupled - cluster ( cc ) . in such cases ,",
    "one also needs to treat * c * in a similar way to * c*. while the computational cost will surely increase , its formulation is straightforward , as shown in section [ sec : ecisd+q ] for ecisd+q .",
    "as expected , the above scheme closely resembles the one for regular post - hf methods .",
    "the main difference , however , lies in the _ density matrices_. the post - phf density matrices in a molecular orbital ( mo ) basis depend not only on * c * _ but also on @xmath10 explicitly through * s * and implicitly through * c*_. this is not the case in the traditional schemes , where density matrices in a certain mo basis are only a function of * c * because a transition density matrix element @xmath70 is always either 0 or 1 . in eq.([eq : ex1 ] ) , @xmath71 therefore requires a special treatment , which we will discuss in section [ sec : explicit ] . also , @xmath72 defined as above is of the broken - symmetry representation ( thus it has @xmath27 and @xmath28 components ) and is not the same as the standard generalized fock matrix,@xcite which has been extensively used as orbital gradients . in other words ,",
    "@xmath73 where @xmath74 is the permutation operator and * p * are the unrelaxed density matrices of the method in question .",
    "this is essentially due to the same reason as above , that is , the unrelaxed density matrices for the correlated wave function are not solely determined by * c * but they depend on the mo coefficients .",
    "this somewhat complicates our derivation as will be seen .",
    "one could entirely avoid the broken - symmetry picture by using the internally - contracted spin - free basis where @xmath75 is placed _",
    "after _ the projection operator , i.e. @xmath76 .",
    "this is possible provided that @xmath77 is spin - free , written in , for example , the natural orbital ( no ) basis . formulated in this way , the equality between the left hand and right hand sides of eq.([eq : genf ] ) is now satisfied , if * p * are also spin - free .",
    "however , the broken - symmetry representation offers numerous advantages over a spin - free basis in both the derivation and implementation of analytical gradient .",
    "first , the scf condition for phf is given in the broken - symmetry basis ( eq.([eq : fai ] ) ) , and hence * z * is also effectively spin - polarized .",
    "second , the nonorthogonal wick theorem makes it easy to evaluate the required matrix elements as we have previously shown.@xcite third , there is a clear distinction between occupied and virtual blocks , which enables us to separate the working spaces and to reduce the computational effort .",
    "fourth , there is no need to deal with the double - integration that arises due to the presence of two projection operators , whose computational cost is an order of magnitude higher . of course",
    ", one can reformulate the spin - free formalism within the single integration by adopting the well - known wigner - eckart theorem@xcite ; however , all the expressions will ultimately become a linear combination of the half - projected , broken - symmetry representation , so from the algebraic point of view , it seems pointless to employ the spin - free basis .",
    "indeed , in most situations , we only need half - projected quantities , and therefore we could utilize the wigner - eckart theorem only when necessary , as will be done for the spin - adapted relaxed density matrix . finally , it is expected that most ingredients that will be needed for analytical derivatives are readily available in the broken - symmetry basis from the existing post - phf programs and therefore are likely to require only minor modifications .    in",
    "what follows , we apply the above scheme to derive the ecisd nuclear gradient .",
    "we abbreviate the collinear - spin projection operator as @xmath78 , as the spin quantum number @xmath79 and multiplicity @xmath80 are both obvious .",
    "also note that there is no dependence on @xmath29 and one can remove the corresponding terms from @xmath81 in eq.([eq : lag ] ) .",
    "again , once the derivative is given for ecisd , similar derivations can be obtained for ecis and tdphf excited states as well as spin - flip ecis . for emp2 , care must be taken because it uses uhf - like orbital energies,@xcite but its derivation essentially follows along the same lines.@xcite      before going into detailed derivations , we shall briefly summarize our nomenclature to make this paper self - contained .",
    "we basically follow the same notations with ref . [ ] , but specifically clarify them here as well .    throughout this work ,",
    "we will employ the projection operator in the following form : @xmath82 where @xmath83 and @xmath84 are a rotation operator at some discretized grid point @xmath85 and its weight .",
    "hence , one can generically work on the transition elements between unrotated and rotated states such as @xmath86 and @xmath87 , followed by the summation over @xmath85 .",
    "using eq.([eq : ps ] ) , the suhf energy is given by    @xmath88    where we have used the fact that @xmath89 is hermitian , idempotent , and commutable with spin - free operators such as @xmath1 , and defined @xmath90    hereinafter we will simplify notations by adding subscript @xmath91 to transition elements in order to indicate the elements are intermediate - normalized , i.e. , divided by @xmath92 as in eq.([eq : eg0 ] ) .",
    "the suhf transition one - particle density matrix ( 1pdm ) @xmath93 and transition fock matrix @xmath94 defined by @xmath95 are fundamental quantities for our discussion below .",
    "for example , the suhf transition energy is expressed as @xmath96 for more details , we refer the reader to the original phf paper ( ref . [ ] ) .",
    "the nonorthogonal wick theorem@xcite allows one to write hamiltonian _ at any grid _ @xmath85 as @xmath97 where curly brackets mean the normal - ordering in the sense of the nonorthogonal wick theorem with respect to the left- and right - vacua @xmath98 and @xmath99 . in other words , @xmath100",
    "then , it proves convenient to define the following quantities in the mo basis :    @xmath101    [ eq : calw ]    where @xmath102 and @xmath103 stand for the occupied and virtual orbital blocks , respectively .",
    "the above equations manifest @xmath104 in the nonorthogonal wick theorem , eqs.([eq : calw]-[eq : rho_g ] ) are realized as the contractions of two different fermion operators , @xmath105 and @xmath106 , between @xmath98 and @xmath99 .",
    "note that all other possible contractions result in either the kronecker delta or zero .",
    "then , the standard wick theorem and its generalization for a product of normal - ordered strings can be completely replaced by their generalization to nonorthogonal bases .    in the previous work,@xcite we introduced the left- and right - transformation matrices , given by @xmath107 to manipulate the transition fock matrix and the bare two - electron integrals as @xmath108",
    "it is sometimes convenient to treat these matrices together with the mo transformation in some cases , @xmath109 so that both @xmath11 and @xmath110 are solely expressed as a function of @xmath111 , @xmath112 , and @xmath113 , without explicit @xmath114 $ ] dependence .",
    "similarly to the suhf energy , the ecisd energy can be expressed as    @xmath115    where we have defined the transition energy and overlap @xmath116 [ eq : eecisdx ]    for which , we have presented the expression of @xmath117-vectors in the previous work .",
    "we will not repeat their derivations but the supporting material is available for the final expressions , which are factorized and thus more compact than those presented in refs .",
    "[ ] .    in what follows , we assume both @xmath118 and @xmath119 are properly normalized , i.e. , @xmath120 , for brevity ; however , we stress that these norms need be taken into account in derivative evaluations ( as there derivatives are typically nonzero ) .    note that half - projected density matrices , such as @xmath121 , are neither relaxed nor spin - adapted . as these `` unrelaxed '' ecisd density matrices will repeatedly appear in the following derivations ,",
    "it is useful to analyze these objects for latter discussions .",
    "1pdm @xmath122 is obtained simply by integrating the corresponding transition 1pdm , @xmath123 , @xmath124 and similarly for two - particle density matrix ( 2pdm ) .",
    "the nonorthogonal wick theorem applied to the one - particle operator @xmath125 suggests @xmath123 be separated into two terms , namely , the overlap - weighted suhf contribution @xmath126 and the normal - ordered transition 1pdm defined by @xmath127 which accounts for the correction due to the ecisd correlation contribution .",
    "the programmable expression of eq.([eq : gamma ] ) is easily identified from the ecisd equations , as @xmath128 is contracted only with @xmath94 because of the structure of the normal - ordered hamiltonian eq.([eq : normalh ] ) .",
    "namely , it suffices to replace all @xmath129 with @xmath130 and neglect all other contractions .",
    "note that the correlated ( non - separable ) 2pdm contribution , @xmath131 , is similarly obtained , but with @xmath132 replaced appropriately ( see eq.([eq : vg ] ) ) .",
    "having established our notations above , now we are in a position to derive the ecisd orbital gradient * l*. here the generalized nonorthogonal wick theorem proves useful . using eq.([eq : epq ] ) and the normal ordered hamiltonian eq.([eq : normalh ] ) , we write @xmath133 { \\nonumber\\\\}&= \\sum_g w_g n_g \\biggl[({\\bf p}_g)_{pq } ( e_g   - { { \\mathcal e } } ) + ( { { \\bm \\rho}_g})_{pq } ( { { \\mathcal e}}_g - e_g { { \\mathcal n}}_g ) { \\nonumber\\\\}&- [ { \\bm\\gamma}_g{{\\bf f}_g}{\\bm\\rho}_g]_{pq } +   [ { \\bm\\eta}_g{{\\bf f}_g}{\\bf p}_g]_{pq}+   [ { \\bm\\eta}_g{\\bm { \\mathcal g}}_g { { \\bm \\rho}_g}]_{pq } { \\nonumber\\\\}&+ ( { \\bm \\zeta}_g)_{pq } -   ( { \\bm \\omega}_g)_{pi}\\delta_{iq } + \\delta_{pa}(\\tilde { \\bm \\omega}_g)_{aq } \\biggr ] .",
    "\\label{eq : ecifock}\\end{aligned}\\ ] ] hereafter , the einstein summation convention for repeated indices is assumed for the sake of visual simplification , except @xmath85 integration in order to specifically indicate that the symmetry - projection is being performed . in eq.([eq : ecifock ] ) , we have additionally defined the transition hole matrix @xmath134 and the following @xmath85-dependent quantities : @xmath135 this is a general result for any excitation levels , including suhf and ecis .",
    "for example , * l * will reduce to @xmath136 in the case of suhf . for ecisd",
    ", the explicit expressions of eqs.([eq : zeta]-[eq : tomega ] ) are rather complex as given in the supplemental material , but can be straightforwardly evaluated using the existing ecisd subroutines with minor modifications .",
    "we just note here that we avoid the computation of the correlated 3pdm in eq.([eq : zeta ] ) by performing the integral contraction on - the - fly , and @xmath137 can be thus evaluated for the same cost as the ecisd energy , which scales as @xmath138 .",
    "some observations on the structure of * l * are in order . since the ecisd energy is invariant with respect to an orbital rotation within the occupied space as well as within the virtual space , clearly @xmath139 .",
    "furthermore , @xmath140 must also vanish because it apparently constitutes only @xmath141 and @xmath142 , which are all guaranteed to be zero due to the variationality of ecisd with respect to the ci coefficients .",
    "therefore , only the @xmath143 block contains nonzero elements , as confirmed numerically in our calculations .      with * l * derived above",
    ", we also need the orbital derivative of suhf fock matrix ( [ eq : fai ] ) for computing @xmath144 . using the notations defined in section [ sec : nomen ] ,",
    "@xmath110 is explicitly written as @xmath145_{ai},\\end{aligned}\\ ] ] and @xmath146 is its complex conjugate . as previously shown,@xcite its derivative with respect to an orbital rotation becomes the hessian components ,    @xmath147,\\\\   \\frac{{\\partial}{{\\mathcal f}}_{ai}}{{\\partial}\\kappa_{bj}^ * } & = b_{ai , bj}{\\nonumber\\\\}&= \\sum_g w_g n_g { { \\mathscr p}}(ab){{\\mathscr p}}(ij ) \\bigl [   \\frac{1}{2 } ( e_g - e_{\\rm suhf } )    { { \\mathcal w}}_{ai } { { \\mathcal w}}_{bj } { \\nonumber\\\\}&+   { { \\mathcal w}}_{ai}{\\tilde { \\mathcal f}}_{bj } + \\frac{1}{4 } { \\bar { \\mathcal v}}^{ab}_{ij}\\bigr],\\end{aligned}\\ ] ]    [ eq : ab ]    where we have dropped @xmath85 subscripts in @xmath111 , @xmath148 , and @xmath149 for brevity .",
    "all the derivatives with respect to @xmath150 in the @xmath151 , @xmath152 , and @xmath153 spaces are rigorously zero for a similar reason to the aforementioned discussion for * l*. in deriving eqs.([eq : ab ] ) , we have used the fact that @xmath154 for a converged suhf state .",
    "hence , the stationary condition @xmath155 reads the following set of equations ;    @xmath156    [ eq : epq ]    keeping the structure of * l * in mind ( @xmath157 is the only nonzero block ) and requiring @xmath158 , we find simply @xmath159 as is the case in suhf.@xcite on the other hand , eq.([eq : cpphf0 ] ) results in the z - vector ( cpphf ) equation , @xmath160 again , for general projection operators in the form of eq.([eq : generalp ] ) , this equation will be coupled with the corresponding * f * response , similarly to mrci.@xcite    orbital rotations can often contain linear dependencies , i.e. , hessian @xmath161 is singular in phf , since a projection operator may produce the identical symmetry - adapted state from different broken - symmetry determinants.@xcite if this is the case , such linear dependencies also appear in * l * in exactly the same way , so one can easily identify this redundant space as a mathematically _ null _ space",
    ". the reader may then wonder if * z * is left arbitrary and there are infinite numbers of solutions that satisfy the z - vector equation ( [ eq : cpphf ] ) .",
    "however , this redundancy is simply due to the working space that we have adopted ; had we chosen an appropriate space for orbital rotations other than the broken - symmetry representation , such a null space would completely disappear from the equation .",
    "therefore , the correct approach to treat these linear dependencies in the present z - vector equation is to simply remove them ; in practice , we take the pseudo - inverse of @xmath162 with a threshold of @xmath163 in order to ensure a numerical stability .",
    "this procedure determines only one unique * z*. in passing , if other * z * that yet satisfy eq.([eq : cpphf ] ) are used , gradients would still be correctly evaluated but the relaxed density matrix may become different .    for ecisd , one can solve eq.([eq : cpphf ] ) by explicitly forming and pseudo - inverting the hessian matrix @xmath161 , because its cost is @xmath164 , which is typically less than that of ecisd itself . for other low - scaling methods such as emp2 , one should resort to iterative linear - equation solvers like gmres for efficient computations .",
    "10      in ecisd , the frozen - core approximation becomes a little tricky , as it employs a constrained optimization in phf .",
    "this is very similar to that of constrained unrestricted hf of tsuchimochi and scuseria , where the fock matrix is modified . in this scheme",
    ", we divide the phf orbital space into the core ( @xmath165 ) , active ( @xmath166 ) , and virtual spaces ( @xmath167 ) .",
    "note that @xmath167 is different from @xmath168 , and is intrinsic virtual orbitals whose occupation is zero . here",
    "only the orbitals in the active space are symmetry - broken , while @xmath165 and @xmath167 spaces are forced to preserve the symmetry and require some constraint .",
    "the constrained fock is then written as @xmath169 hence , one needs a slight modification to the phf - scf condition for the @xmath170 and @xmath171 spaces .",
    "the constraint for lagrangian is actually @xmath172 the orbital gradient of the constrained fock is        in section [ sec : general ] , we argued that the explicit dependence on @xmath10 in @xmath11 comes not only from hamiltonian but also from density matrices through * s*. given the ecisd energy eqs.([eq : eecisdx ] ) , one would have to consider terms like @xmath173 and @xmath174 , which are both exactly zero if @xmath175 ( i.e. , the regular single - reference limit ) but are complicated functions of both @xmath40 and @xmath176 in the symmetry - projection methods .",
    "however , one can completely avoid constructing these derivatives and simplify the derivation by formally writing the explicit dependence of @xmath11 on @xmath10 as @xmath177 then , the last summation over @xmath85 takes into account the fact that the density matrices of ecisd are dependent on @xmath10 .",
    "now , recall that we require @xmath11 be completely expressed with @xmath178 , @xmath179 , and @xmath180 , and hence allow no explicit dependence on @xmath40 .",
    "therefore , the previously obtained eci orbital gradient eq.([eq : ecifock ] ) is equivalently expressed as @xmath181 which may be compared with eq.([eq : e(x ) ] ) for their similarity , implying that the latter can be rewritten in terms of @xmath72 .",
    "it is not difficult to show that the explicit derivatives of @xmath178 , @xmath179 , and @xmath180 with respect to @xmath10 critically resemble those with respect to @xmath150 ,    @xmath182    [ eq : x_and_kappa ]    therefore , noting that only @xmath183 depends on @xmath184 in @xmath11 , one can substitute them into eq.([eq : e(x ) ] ) and then use eqs.([eq : epq],[eq : fock1 ] ) to obtain @xmath185 the third term will cancel out the same term in @xmath186 ( _ vide infra _ ) . for the last term of eq.([eq : e(x)1 ] ) , it is relatively easy to derive @xmath187_{pq}+ [ { \\bm { \\mathcal g}}_g{\\bm \\rho}_g]_{pq }   +   [ { { \\bm { \\mathcal l}}_g}^{-1 } \\tilde { \\bm \\omega}_g]_{pq}\\bigr ) , \\label{eq : lastterm}\\end{aligned}\\ ] ] and this will be in part recognized as the energy - weighted density matrix upon a grid integration . we should mention that the existence of @xmath188 is always guaranteed .",
    "one can use the same simplification as presented above to ease the evaluation of the explicit nuclear gradient contribution of the phf fock ; @xmath190 is closely related to the orbital gradients * a * and * b * through eqs.([eq : x_and_kappa ] ) .",
    "our result is    @xmath191_{ia}{\\nonumber\\\\}&+ ( { { { \\bf c}}^\\dag { { \\bf s}}^x { { \\bf c}}})_{qp } ( a_{ai , bj}\\delta_{pb}\\delta_{jq }   -   y_{ia , pq } ) ,    \\\\ { { \\mathcal f}}_{ai}^{(x ) } &   = \\sum_g w_g n_g \\bigl [ { \\bm{{\\mathcal l}}}_g { { \\bf f}_g}^{(\\bar x ) } { \\bm{{\\mathcal r}}}_g    +   e_g^{(\\bar x)}({{\\bm{\\mathcal w}}_g}- { \\bf n } )   \\bigr]_{ai}{\\nonumber\\\\ } & + ( { { { \\bf c}}^\\dag { { \\bf s}}^x { { \\bf c}}})_{qp } ( b_{ai , bj}\\delta_{pb}\\delta_{jq } - y_{ai , pq } ) ,    \\end{aligned}\\ ] ]    [ eq : fx ]    where * y * is the residual effect , @xmath192_{pq } ( { { \\bm{\\mathcal w}}_g}- { \\bf n})_{vw }   { \\nonumber\\\\}&+ ( { { \\bm { \\mathcal l}}_g})_{vq}[{{\\bf f}_g}{{\\bm { \\mathcal r}}_g}]_{pw }   + { \\langle}pr || us{\\rangle}({{\\bm \\rho}_g})_{uq } ( { { \\bm { \\mathcal l}}_g})_{vr } ( { { \\bm { \\mathcal r}}_g})_{s w}\\biggr\\},\\end{aligned}\\ ] ] and the bars on @xmath10 indicate that only hamiltonian is subject to the differentiation , that is to say , in the ao basis , @xmath193 ( note that @xmath93 is an explicit function of * s*. ) notice that in eqs.([eq : fx ] ) , @xmath194 is given in the mo basis .",
    "we have also introduced the suhf norm derivatives , @xmath195 as was mentioned above , @xmath196 and * b * terms in eq.([eq : fx ] ) are canceled out with those in @xmath197 , when contracted with @xmath144 .",
    "putting altogether , we finally arrive at the complete expression , @xmath198 { \\nonumber\\\\ } & -   ( { { { \\bf c}}^\\dag { { \\bf s}}^x { { \\bf c}}})_{qp } \\biggl\\",
    "{ x_{pq } + ( y_{ia , pq } + y_{ai , pq } ) z_{ai }   \\biggr\\ } { \\nonumber\\\\}&= h_{\\mu\\nu}^{x } p^{\\rm rel}_{\\nu\\mu } + \\frac{1}{4 }   { \\langle}\\mu\\nu||\\lambda\\sigma{\\rangle}^{x } p^{\\rm rel}_{\\nu\\mu,\\sigma\\lambda } + s^x_{\\mu\\nu } w_{\\nu\\mu}\\label{eq : lx } \\ ] ] where @xmath199 and @xmath200 are _ spin - incomplete _ relaxed one- and two - particle density matrices , and hence includes not only @xmath201 and @xmath202 but also nonzero @xmath36 and @xmath35 sectors .",
    "using eq.([eq : lastterm ] ) , * w * is the generalized energy - weighted density matrix explicitly given by @xmath203_{pq } +   [ { { \\bm { \\mathcal l}}_g}^{-1 } \\tilde { \\bm \\omega}_g]_{pq }    \\biggr]\\end{aligned}\\ ] ] in the mo basis , with the relaxation correction at grid @xmath85 defined as @xmath204 one can assure that eq.([eq : lx ] ) is consistent with suhf for @xmath205 and @xmath206 .    comparing the terms in eq.([eq : lx ] ) , one can easily identify the spin - incomplete relaxed 1pdm as the sum of the unrelaxed density matrix and relaxation correction ( integrated ) , @xmath207 to gain some physical insights , one can elegantly rewrite the integrated correction term as @xmath208 the meaning of eq.([eq : prel2 ] ) is striking ; it accounts for the first - order orbital relaxation effect on the ecisd density matrix via the reference ( suhf ) density matrix . after some simple algebra",
    ", one can verify that the wigner - eckart theorem can be directly applied so as to obtain the spin - adapted relaxed density ; in other words , @xmath209 and @xmath210 can be derived from a linear combination of @xmath211 and @xmath212 ( see appendix ) .",
    "similarly , the relaxed 2pdm can be easily derived , and may be explicitly symmetrized in the ao basis without loss of generality , i.e. , @xmath213 . however , for ease of computations , the non - separable ( unrelaxed ) term should be directly contracted with two - electron integrals in the ao basis to avoid prohibitively large memory requirement and disk storages .",
    "we should mention the gradient of the davidson correction,@xcite @xmath214 , can be formulated . in this case , the total energy @xmath215 is stationary with respect neither to * c * nor to @xmath43 .",
    "hence , our lagrangian takes a more complicated form @xmath216   { \\nonumber\\\\}&+ \\sum_i \\tilde z_i \\left({\\langle}\\phi_i | ( \\hat h - e ) \\hat p |\\psi{\\rangle}+ { \\langle}\\psi |(\\hat h - e ) \\hat p| \\phi_i{\\rangle}\\right ) \\end{aligned}\\ ] ] where @xmath217 , requiring to solve the resulting cpecisd equation , @xmath218 , for @xmath219 .",
    "while it is straightforward to derive the equations , this will significantly complicate the algorithm and thus is beyond the scope of the present work .",
    "the above scheme has been implemented in the gellan suite of programs , which can also handle the analytical gradient of suhf .",
    "all of the calculations were performed with all - electrons correlated unless otherwise specified . while incorporating the frozen - core approximation is possible",
    ", the implementation is not as straightforward as that for the conventional post - hf methods , because ecisd requires a constrained scf optimization to define frozen - core orbitals.@xcite we will address this issue elsewhere .",
    "for the number of grid points for the spin - projection , @xmath220 was found to be enough to make @xmath221 of a suhf wave function precise to at least @xmath163 for all the calculations presented in this work .",
    "if a precision of @xmath222 is requested for @xmath223 as in the previous studies,@xcite only three grid points is sufficient , while the resulting energy error is less than 1 @xmath224 .",
    "also , increasing @xmath225 did not change both the suhf and ecisd wave functions .",
    "all the spin - projected calculations employed gellan , and single reference methods including cc singles and doubles ( ccsd ) and ccsd with perturbative triples , ccsd(t ) , were performed using gaussian.@xcite we also used molpro@xcite for the mr calculations .",
    "we take the ozone molecule as our first example , as it has been extensively studied by other authors due to its degenerate electronic structure.@xcite we use dunning s dzp@xcite basis set following the earlier work of reduced mr - ccsd ( rmr - ccsd ) calculations,@xcite for a direct comparison with our results .",
    "= 2 mm    [ cols=\"<,^,^,^,^,^,^,^,^ \" , ]     ecisd geometries are used .",
    "the active space used is @xmath226 .",
    "mrci geometries are used .",
    "rhf / rohf reference .",
    "the singlet ( @xmath227 ) and triplet ( @xmath228 ) ccsd(t ) geometries are used .",
    "uhf reference . taken from ref .",
    "on the other hand , ccsd(t ) produces a kink at the @xmath228 point as expected , because of the exact degeneracy in the @xmath229 orbitals . as a result",
    ", its activation barrier is predicted to be 18.4 kcal / mol , which is significantly larger than the experimental estimate of 1.610 kcal / mol,@xcite resulting in the incorrect ordering of the singlet and triplet energies .",
    "however , again , the small energy difference between ccsd(t ) and mr - ccsd(t ) in ref .",
    "[ ] validates the accuracy of ccsd(t ) at the @xmath227 geometry .",
    "hence its @xmath230 , 33.8 kcal / mol , is expected to be reliable , which is indeed close to the mrci+q result ( 33.0 kcal / mol ) .",
    "while eom - sf - ccsd gives a somewhat larger value of 38.3 kcal / mol , the ecisd+q prediction agrees well with ccsd(t ) and mrci+q .",
    "we observe a similar behavior for @xmath231 , where the eom - sf - ccsd value is again slightly larger than those of ecisd+q and mrci+q .",
    "it is likely that this discrepancy is attributed to the spin - contamination inevitable in sf calculations.@xcite at the @xmath228 structure , ecisd+q and mrci+q are energetically very close to each other ; the singlet energies of them are -154.41992 and -154.41910 , whereas the triplet energies are -154.41018 and -154.41166 , in @xmath232 .",
    "therefore , ecisd+q slightly outperforms mrci+q for singlet , but gets worse for triplet , resulting in the increase of @xmath231 compared the latter , although small ( 1.4 kcal / mol ) .    overall , ecisd produces similar results to those obtained with mrci , especially when a size - consistency correction is introduced .",
    "it appears ecisd is satisfactory for this system , considering the simplicity of its wave function _",
    "the availability of analytical derivative is critical in electronic structure calculations , as it broadens the application range of a method by providing a means to compute molecular properties and nuclear gradients . in this manuscript",
    ", we have demonstrated that , using the z - vector technique , the first derivative of post - suhf methods can be derived in a manner analogous to single - reference post - hf .",
    "the chief difference is that , in the mo basis , the density matrices of spin - projected approaches explicitly depend on the underlying molecular orbitals and ao overlap matrix , while only particle - hole amplitudes such as ci coefficients are relevant in single - reference cases .",
    "we showed the calculation of density matrix derivatives with respect to nuclear coordinates can be avoided by expressing the total energy as a sole function of contractions in terms of the nonorthogonal wick theorem , which allows for complete cancellation in such terms .",
    "the resulting relaxed density matrices are not spin - adapted , if a projection operator is not explicitly present at both bra and ket states . however , since the relaxation correction is written as the gradient of suhf 1pdm with respect to orbital change , one can retrieve the spin - adapted form using the wigner - eckart theorem .",
    "our results revealed the suhf frequencies can be sometimes even much worse than uhf as seen in ozone , but this deficiency can be largely ameliorated by the introduction of dynamic correlation in ecisd .",
    "the dipole moment of ozone was also greatly improved when computed with the relaxed density . for the automerization of cyclobutadiene",
    ", the ecisd+q results agreed quite well with mrci , as well as with eom - sf - ccsd and ccsd(t ) reference values .",
    "however , our results also strongly indicate the inclusion of size - extensive ( consistent ) correction is indispensable for accurate descriptions of these systems .",
    "while the davidson correction greatly improves the energy with a negligible computational cost , its derivative is evidently cumbersome .",
    "hence it is more advantageous to renormalize the effect of @xmath214 into the energy functional , so that the total energy derivative with respect to @xmath233 remains to be zero .",
    "research for such extension is currently underway ; some preliminary results are reported elsewhere.@xcite",
    "we would like to thank motoyuki uejima for helpful discussions , and roman schutski for performing non - collinear projected hf calculations .",
    "this work was supported by mext s flagship2020 as priority issue 5 ( development of new fundamental technologies for high - efficiency energy creation , conversion / storage and use ) .",
    "we are also indebted to the hpci system research project for the use of computer resources ( project i d : hp150228 , hp150278 ) .",
    "the relaxed density matrix in the form of eq.([eq : prel ] ) , @xmath234 , is not spin - adapted because the perturbation has been applied to the half - projected hamiltonian @xmath235 but not to the explicitly projected one @xmath236 . on the contrary",
    ", it can be even asymmetric .",
    "this section shows the wigner - eckart theorem can be equally applicable to derive @xmath9 from @xmath234 .    for our purpose ,",
    "let us split the spin - adapted relaxed density matrix as @xmath237 where the first term is the unrelaxed spin - adapted ecisd density matrix ( @xmath238 ) , and superscripts @xmath239 and @xmath240 stand for the contributions from the corresponding space @xmath144 and @xmath241 , respectively .    for the explicitly spin - projected hamiltonian , @xmath242",
    ", it can be shown that phf fock for the @xmath243 component ( @xmath244 spin ) is    @xmath245    where @xmath246    note that the spin - adapted relaxed density contribution in the mo basis @xmath247 then comes from @xmath248 , @xmath249 , and @xmath250 . therefore , we have @xmath251    the last term is simply a product of two projected elements ; both @xmath252 and @xmath253 cancel out between the numerator and denominator , and one can use the definition @xmath254 . on the other hand , @xmath252 in the",
    "the first two terms also cancel out by using the nonorthogonal wick theorem in a backward manner , and these terms can be cast as a single term .",
    "finally , we find    @xmath255    for which we can resort to the wigner - eckart theorem for the expansion of @xmath256 to a linear combination of half - projected , mixed - spin operators @xmath257 .    11",
    "here we check if the energy - weighted density matrix * w * in phf can also be obtained by only considering the difference between @xmath258 and @xmath259 , that is , eq.([eq : x_and_kappa ] ) .",
    "again , for the @xmath260 differentiation , we have to write the phf energy as a function of only @xmath261 , @xmath262 , and @xmath263 to assure no explicit @xmath264 dependence , so that one can use the chain - rule as in eq.([eq : fock1 ] ) . for phf ,",
    "it is evident that @xmath265 and @xmath266 , so the energy - weighted density matrix * w * is defined as @xmath267 then , the @xmath268 dependence of @xmath13 ( or @xmath269 ) only appears naturally in the transition density matrix in the ao basis written as @xmath270 and there is no dependence in @xmath92 , because it can be completely expressed by @xmath261 .",
    "thus , the energy - weighted density matrix for phf gradient may be given simply by @xmath271_{\\alpha k}\\delta_{\\mu\\beta } ( { { \\bm { \\mathcal l}}_g})_{kq}{\\nonumber\\\\}&= -\\sum_g w_g n_g ( { { \\bf f}_g}{{\\bm \\rho}_g})_{pq},\\end{aligned}\\ ] ] where we have used @xmath272_{\\alpha k}\\delta_{\\mu\\beta}.\\\\ & \\frac{{\\partial}({{\\bm \\rho}_g})_{\\alpha\\beta}}{{\\partial}(\\tilde { \\bm { { \\mathcal l}}}_g)_{a\\mu } } = 0.\\end{aligned}\\ ] ] this is consistent with the energy - weighted density matrix of phf previously derived in refs .",
    "[ ] , @xmath273 which , using the variational condition of the phf fock matrix @xmath274 becomes @xmath275 hence , the equivalence is proven ."
  ],
  "abstract_text": [
    "<S> in electronic structure theory , the availability of analytical derivative is one of the desired features for a method to be useful in practical applications , as it allows for geometry optimization as well as computation of molecular properties . with the recent advances in the development of symmetry - projected hartree - fock ( phf ) methods </S>",
    "<S> , we here aim at further extensions by devising the analytic gradients of post - phf approaches with a special focus on spin - extended ( spin - projected ) configuration interaction with single and double substitutions ( ecisd ) . just like standard single - reference methods , </S>",
    "<S> the mean - field phf part does not require the corresponding coupled - perturbed equation to be solved , while the correlation energy term needs the orbital relaxation effect to be accounted for , unless the underlying molecular orbitals are variationally optimized in the presence of the correlation energy . </S>",
    "<S> we present a general strategy for post - phf analytical gradients , which closely parallels that for single - reference methods , yet addressing the major difference between them . </S>",
    "<S> the similarity between ecisd and multi - reference ci not only in the energy but also in the optimized geometry is clearly demonstrated by the numerical examples of ozone and cyclobutadiene . </S>"
  ]
}