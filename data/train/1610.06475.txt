{
  "article_text": [
    "simultaneous localization and mapping ( slam ) has been a hot research topic in the last two decades in the computer vision and robotics communities , and has recently attracted the attention of high - technological companies .",
    "slam techniques build a map of an unknown environment and localize the sensor in the map with a strong focus on real - time operation . among the different sensor modalities , cameras are cheap and provide rich information of the environment that allows for robust and accurate place recognition .",
    "place recognition is a key module of a slam system to close loops ( i.e. detect when the sensor returns to a mapped area and correct the accumulated error in exploration ) and to relocalize the camera after a tracking failure , due to occlusion or aggressive motion , or at system re - initialization",
    ". therefore visual slam , where the main sensor is a camera , has been strongly developed in the last years .",
    "visual slam can be performed by using just a monocular camera , which is the cheapest and smallest sensor setup .",
    "however as depth is not observable from just one camera , the scale of the map and estimated trajectory is unknown .",
    "in addition the system bootstrapping require multi - view or filtering techniques to produce an initial map as it can not be triangulated from the very first frame .",
    "last but not least , monocular slam suffers from scale drift and may fail if performing pure rotations in exploration . by using a stereo or an rgb - d camera all these issues are solved and allows for the most reliable visual slam solutions .    in this paper we built on our monocular orb - slam @xcite and",
    "propose orb - slam2 with the following contributions :    * the first open - sourceslam system for monocular , stereo and rgb - d cameras , including loop closing , relocalization and map reuse .",
    "* our rgb - d results shows that by using bundle adjustment ( ba ) we achieve more accuracy than state - of - the - art methods based on icp or photometric and depth error minimization .",
    "* by using close and far stereo points and monocular observations our stereo results are more accurate than the state - of - the - art direct stereo slam . * a lightweight localization mode that can effectively reuse the map with mapping disabled .",
    "[ fig : example ] shows examples of orb - slam2 output from stereo and rgb - d inputs .",
    "the stereo case shows the final trajectory and sparse reconstruction of the sequence 00 from the kitti dataset @xcite .",
    "this is an urban sequence with multiple loop closures that orb - slam2 was able to successfully detect .",
    "the rgb - d case shows the keyframe poses estimated in sequence fr1_room from the tum rgb - d dataset @xcite , and a dense pointcloud , rendered by backprojecting sensor depth maps from the estimated keyframe poses .",
    "note that our slam does not perform any fusion like kinectfusion @xcite or similar , but the good definition indicates the accuracy of the keyframe poses .",
    "more examples are shown on the attached video . in the rest of the paper , we discuss related work in section [ sec : related ] , we describe our system in section [ sec : sys ] , then present the evaluation results in section [ sec : eval ] and end with conclusions in section [ sec : conclusion ] .",
    "in this section we discuss related work on stereo and rgb - d slam .",
    "our discussion , as well as the evaluation in section [ sec : eval ] is focused only on slam approaches .",
    "a remarkable early stereo slam system was the work of paz et al .",
    "@xcite . based on conditionally independent",
    "divide and conquer ekf - slam it was able to operate in larger environments than other approaches at that time .",
    "most importantly , it was the first stereo slam exploiting both close and far points ( i.e. points whose depth can not be reliably estimated due to little disparity in the stereo camera ) , using an inverse depth parametrization @xcite for the latter .",
    "they empirically showed that points can be reliably triangulated if their depth is less than @xmath0 times the stereo baseline . in this work",
    "we follow this strategy of treating in a different way _ close _ and _ far _ points , as explained in section [ sec : sec : closefar ] .",
    "most modern stereo slam systems are keyframe - based @xcite and perform ba optimization in a local area to achieve scalability .",
    "the work of strasdat et al .",
    "@xcite performs a joint optimization of ba ( point - pose constraints ) in an inner window of keyframes and pose - graph ( pose - pose constraints ) in an outer window . by limiting the size of these windows",
    "the method achieves constant time complexity , at the expense of not guaranteeing global consistency .",
    "the rslam of mei et al .",
    "@xcite uses a relative representation of landmarks and poses and performs relative ba in an active area which can be constrained for constant - time .",
    "rslam is able to close loops which allow to expand active areas at both sides of a loop , but global consistency is not enforced .",
    "the recent s - ptam by pire et al .",
    "@xcite performs local ba , however it lacks large loop closing .",
    "similar to this approaches we perform ba in a local set of keyframes so that the complexity is independent of the map size and we can operate in large environments .",
    "however our goal is to build a globally consistent map .",
    "our system aligns first both sides of the loop , similar to rslam , so that the tracking is able to continue localizing using the old map and then performs a pose - graph optimization that minimizes the drift accumulated in the loop , followed by full ba .",
    "the recent stereo lsd - slam of engel et al .",
    "@xcite is a semi - dense direct approach that minimizes photometric error in image regions with high gradient .",
    "not relying on features , the method is expected to be more robust to motion blur or poorly - textured environments .",
    "however as a direct method its performance can be severely degraded by unmodeled effects like rolling shutter or non - lambertian reflectance .",
    "one of the earliest and most famed rgb - d slam systems was the kinectfusion of newcombe et al .",
    "this method fused all depth data from the sensor into a volumetric dense model that is used to track the camera pose using icp .",
    "this system was limited to small workspaces due to its volumetric representation and the lack of loop closing .",
    "kintinuous by whelan et al .",
    "@xcite was able to operate in large environments by using a rolling cyclical buffer and included loop closing using place recognition and pose graph optimization .",
    "probably the first popular open - source system was the rgb - d slam of endres et al .",
    "this is a feature - based system , whose fronted computes frame - to - frame motion by feature matching and icp .",
    "the backend performs pose - graph optimization with loop closure constraints from an heuristic search .",
    "similarly the backed of dvo - slam of kerl et al .",
    "@xcite optimizes a pose - graph where keyframe - to - keyframe constraints are computed from a visual odometry that minimizes both photometric and depth error .",
    "dvo - slam also searches for loop candidates in an heuristic fashion over all previous frames , instead of relying on place recognition .",
    "the recent elasticfusion of whelan et al .",
    "@xcite builds a surfel - based map of the environment .",
    "this is a map - centric approach that forget poses and performs loop closing applying a non - rigid deformation to the map , instead of a standard pose - graph optimization .",
    "the detailed reconstruction and localization accuracy of this system is impressive , but the current implementation is limited to room - size maps as the complexity scales with the number of surfels in the map .    as proposed by strasdat et al .",
    "@xcite our orb - slam2 uses depth information to synthesize a stereo coordinate for extracted features on the image .",
    "this way our system is agnostic of the input being stereo or rgb - d . differently to all above methods our backend",
    "is based on bundle adjustment and builds a globally consistent sparse reconstruction .",
    "therefore our method is lightweight and works with standard cpus .",
    "our goal is long - term and globally consistent localization instead of building the most detailed dense reconstruction .",
    "however from the highly accurate keyframe poses one could fuse depth maps and get accurate reconstruction on - the - fly in a local area or post - process the depth maps from all keyframes after a full ba and get an accurate 3d model of the whole scene .",
    "orb - slam2 for stereo and rgb - d cameras is built on our monocular feature - based orb - slam @xcite , whose main components are summarized here for reader convenience . a general overview of the system is shown in fig . [ fig : overview ] .",
    "the system has three main parallel threads : 1 ) the tracking to localize the camera with every frame by finding feature matches to the local map and minimizing the reprojection error applying motion - only ba , 2 ) the local mapping to manage the local map and optimize it , performing local ba , 3 ) the loop closing to detect large loops and correct the accumulated drift by performing a pose - graph optimization .",
    "this thread launches a fourth thread to perform full ba after the pose - graph optimization , to compute the optimal structure and motion solution .",
    "the system has embedded a place recognition module based on dbow2 @xcite for relocalization , in case of tracking failure ( e.g. an occlusion ) or for reinitialization in an already mapped scene , and for loop detection .",
    "the system maintains a covisibiliy graph @xcite that links any two keyframes observing common points and a minimum spanning tree connecting all keyframes .",
    "these graph structures allow to retrieve local windows of keyframes , so that tracking and local mapping operate locally , allowing to work on large environments , and serve as structure for the pose - graph optimization performed when closing a loop .",
    "the system uses the same orb features @xcite for tracking , mapping and place recognition tasks .",
    "these features are robust to rotation and scale and present a good invariance to camera auto - gain and auto - exposure , and illumination changes .",
    "moreover they are fast to extract and match allowing for real - time operation and show good precision / recall performance in bag - of - word place recognition @xcite .",
    "in the rest of this section we present how stereo / depth information is exploited and which elements of the system are affected . for a detailed description of each system block , we refer the reader to our monocular publication @xcite .",
    "orb - slam2 as a feature - based method preprocess the input to extract features at salient keypoint locations , as shown in fig .",
    "[ fig : stereo ] .",
    "the input images are then discarded and all system operations are based on these features , so that the system is independent on the sensor being stereo or rgb - d .",
    "our system handles monocular and stereo keypoints , which are further classified as close or far .    * stereo keypoints *",
    "are defined by three coordinates @xmath1 , being @xmath2 the coordinates on the left image and @xmath3 the horizontal coordinate in the right image . for stereo cameras , we extract orb in both images and for every left orb we search for a match in the right image .",
    "this can be done very efficiently assuming stereo rectified images , so that epipolar lines are horizontal .",
    "we then generate the stereo keypoint with the coordinates of the left orb and the horizontal coordinate of the right match , which is subpixel refined by patch correlation . for rgb - d cameras , we extract orb features on the image channel and , as proposed by strasdat et al .",
    "@xcite , we synthesize a right coordinate for each feature , using the associated depth value in the registered depth map channel , and the baseline between the structured light projector and the infrared camera , which for kinect and asus xtion cameras we approximate to @xmath4 .",
    "a stereo keypoint is classified as * close * if its associated depth is less than 40 times the stereo / rgb - d baseline , as suggested in @xcite , otherwise it is classified as * far*. close keypoints can be safely triangulated from one frame as depth is accurately estimated and provide scale , translation and rotation information . on the other hand",
    "far points provide accurate rotation information but weaker scale and translation information .",
    "we triangulate far points when they are supported by multiple views .",
    "* monocular keypoints * are defined by two coordinates @xmath5 on the left image and correspond to all those orb for which a stereo match could not be found or that have an invalid depth value in the rgb - d case .",
    "these points are only triangulated from multiple views and do not provide scale information , but contribute to the rotation and translation estimation .",
    "one of the main benefits of using stereo or rgb - d cameras is that , by having depth information from just one frame , we do not need an specific structure from motion initialization as in the monocular case . at system startup",
    "we create a keyframe with the first frame , set its pose to the origin , and create an initial map from all stereo keypoints .",
    "our system performs bundle adjustment to optimize the camera pose in the tracking ( motion - only ba ) , to optimize a local window of keyframes and points in the local mapping ( local ba ) , and after a loop closure to optimize all keyframes and points ( full ba ) .",
    "we use the levenberg - marquadt implementation in g2o @xcite .",
    "* motion - only ba * optimizes the camera orientation @xmath6 and position @xmath7 , minimizing the reprojection error between matched 3d points @xmath8 in world coordinates and keypoints @xmath9 , either monocular @xmath10 or stereo @xmath11 , with @xmath12 the set of all matches :    @xmath13    where @xmath14 is the robust huber cost function and @xmath15 the covariance matrix associated to the scale of the keypoint . the projection functions @xmath16 , monocular @xmath17 and rectified stereo @xmath18 , are defined as follows : @xmath19 f_y\\frac{y}{z } + c_y \\end{bmatrix } \\\\",
    "\\pi_\\mathrm{s } \\left(\\begin{bmatrix}x\\\\y\\\\z\\end{bmatrix } \\right ) = \\begin{bmatrix } f_x\\frac{x}{z } + c_x\\\\[0.2em ] f_y\\frac{y}{z } + c_y \\\\[0.2em ] f_x\\frac{x - b}{z } + c_x\\end{bmatrix }   \\end{gathered}\\ ] ] where @xmath20 is the focal length , @xmath21 is the principal point and @xmath22 the baseline , all known from calibration .    *",
    "local ba * optimizes a set of covisible keyframes @xmath23 and all points seen in those keyframes @xmath24 .",
    "all other keyframes @xmath25 , not in @xmath23 , observing points in @xmath24 contribute to the cost function but remain fixed in the optimization . defining @xmath26 as the set of matches between points in @xmath24 and keypoints in a keyframe @xmath27 , the optimization problem is the following : @xmath28    * full ba * is the specific case of local ba , where all keyframes and points in the map are optimized , except the origin keyframe that is fixed to eliminate the gauge freedom .",
    "loop closing is performed in two steps , firstly a loop has to be detected and validated , and secondly the loop is corrected optimizing a pose - graph .",
    "in contrast to monocular orb - slam , where scale drift may occur @xcite , the stereo / depth information makes scale observable and the geometric validation and pose - graph optimization no longer require dealing with scale drift and are based on rigid body transformations instead of similarities .    in orb - slam2",
    "we have incorporated a full ba optimization after the pose - graph to achieve the optimal solution .",
    "this optimization might be very costly and therefore we perform it in a separate thread , allowing the system to continue creating map and detecting loops .",
    "however this brings the challenge of merging the bundle adjustment output with the current state of the map .",
    "if a new loop is detected while the optimization is running , we abort the optimization and proceed to close the loop , which will launch the full ba optimization again . when the full ba finishes , we need to merge the updated subset of keyframes and points optimized by the full ba , with the non - updated keyframes and points that where inserted while the optimization was running .",
    "this is done by propagating the correction of updated keyframes ( i.e. the transformation from the non - optimized to the optimized pose ) to non - updated keyframes through the spanning tree .",
    "non - updated points are transformed according to the correction applied to their reference keyframe .",
    "orb - slam2 follows the policy introduced in monocular orb - slam of inserting keyframes very often and culling redundant ones afterwards .",
    "the distinction between close and far stereo points allows us to introduce a new condition for keyframe insertion , which can be critical in challenging environments where a big part of the scene is far from the stereo sensor , as shown in fig .",
    "[ fig : highway ] . in such environment we need to have a sufficient amount of close points to accurately estimate translation ,",
    "therefore if the number of tracked close points drops below @xmath29 and the frame could create at least @xmath30 new close stereo points , the system will insert a new keyframe .",
    "we empirically found that @xmath31 and @xmath32 works well in all our experiments .",
    "we incorporate a localization mode which can be useful for lightweight long - term localization in well mapped areas , as long as there are not significant changes in the environment . in this mode",
    "the local mapping and loop closing threads are deactivated and the camera is continuously localized by the tracking using relocalization if needed . in this mode",
    "the tracking leverages visual odometry matches and matches to map points .",
    "visual odometry matches are matches between orb in the current frame and 3d points created in the previous frame from the stereo / depth information .",
    "these matches make the localization robust to unmapped regions , but drift can be accumulated .",
    "map point matches ensure drift - free localization to the existing map . this mode is demonstrated in the accompanying video .",
    "we have evaluated orb - slam2 in three popular datasets and compared to other state - of - the - art slam systems , using always results published by the original authors .",
    "we have run orb - slam2 in an intel core i7 - 4790 desktop computer with 16 gb ram , being the average processing time of the tracking always below the sensor s frame - rate .",
    "we have run each sequence 5 times and show always median results , to account for the non - deterministic nature of the multi - threading system .",
    "our open - source implementation includes calibration and instructions to run the system in all these datasets .",
    "the kitti dataset @xcite contains stereo sequences recorded from a car in urban and highway environments .",
    "the stereo sensor has a @xmath33 baseline and works at 10hz with a resolution before rectification of @xmath34 pixels . sequences 00 , 02 , 05 , 06 , 07 and 09 contain loops .",
    "our orb - slam2 detects all loops and is able to reuse its map afterwards , except for sequence 09 where the loop happens in very few frames at the end of the sequence .",
    "table [ tb : kitti ] shows results in the 11 training sequences , which have public ground - truth , compared to the state - of - the - art stereo lsd - slam @xcite , to our knowledge the only stereo slam showing detailed results for all sequences .",
    "we use two different metrics , the absolute translation rmse @xmath35 proposed in @xcite , and the average relative translation @xmath36 and rotation @xmath37 errors proposed in @xcite .",
    "our system outperforms stereo lsd - slam in most sequences , and achieves in general a relative error lower than 1% .",
    "the sequence 01 , see fig .",
    "[ fig : highway ] , is the only highway sequence in the training set and the translation error is slightly worse .",
    "translation is harder to estimate in this sequence because very few close points can be tracked , due to highspeed and low frame - rate .",
    "however orientation can be accurately estimated , achieving an error of 0.21 degrees per 100 meters , as there are many far point that can be long tracked .",
    "[ fig : kitti ] shows some examples of estimated trajectories .",
    ".comparison of accuracy in the kitti dataset . [ cols=\"^,^,^,^,^,^,^ \" , ]",
    "we have presented a full slam system for monocular , stereo and rgb - d sensors , able to perform relocalization , loop closing and reuse its map in real - time in standard cpus .",
    "we focus on building globally consistent maps for reliable and long - term localization in a wide range of environments as demonstrated in the experiments .",
    "the comparison to the state - of - the - art shows very competitive accuracy of orb - slam2 , being in most cases the most accurate solution .",
    "surprisingly our rgb - d results demonstrate that if the most accurate camera localization is desired , bundle adjustment performs better than direct methods or icp , with the additional advantage of being less computationally expensive .",
    "we have released the source code of our system , with examples and instructions so that it can be easily used by other researchers .",
    "we are aware that it has been already used out - of - the - box in @xcite .",
    "future extensions might include , to name some examples , non - overlapping multi - camera , fisheye or omnidirectional cameras support , large scale dense fusion , cooperative mapping or increased motion blur robustness ."
  ],
  "abstract_text": [
    "<S> we present orb - slam2 a complete slam system for monocular , stereo and rgb - d cameras , including map reuse , loop closing and relocalization capabilities . </S>",
    "<S> the system works in real - time in standard cpus in a wide variety of environments from small hand - held indoors sequences , to drones flying in industrial environments and cars driving around a city . </S>",
    "<S> our backend based on bundle adjustment with monocular and stereo observations allows for accurate trajectory estimation with metric scale . </S>",
    "<S> our system includes a lightweight localization mode that leverages visual odometry tracks for unmapped regions and matches to map points that allow for zero - drift localization . </S>",
    "<S> the evaluation in 29 popular public sequences shows that our method achieves state - of - the - art accuracy , being in most cases the most accurate slam solution . </S>",
    "<S> we publish the source code , not only for the benefit of the slam community , but with the aim of being an out - of - the - box slam solution for researchers in other fields . </S>"
  ]
}