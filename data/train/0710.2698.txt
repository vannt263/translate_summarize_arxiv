{
  "article_text": [
    "faithful mapping between quantum states of light ( flying qubits ) and quantum states of matter ( storage and/or memory qubits ) is an important outstanding goal in the field of quantum information processing and is being pursued both theoretically and experimentally by a large number of research groups around the world .",
    "photon storage in @xmath0-type atomic media is a promising avenue for achieving this goal . in a recent theoretical paper @xcite",
    ", we unified a wide range of protocols for photon storage in @xmath0-type media , including the techniques based on electromagnetically induced transparency ( eit ) , off - resonant raman interactions , and photon - echo . in ref .",
    "@xcite we also demonstrated equivalence between all these protocols and suggested several efficiency optimization procedures , some of which have since been demonstrated experimentally @xcite . in the three preceding papers of this series , refs .",
    "@xcite , which we will refer to henceforth as papers i , ii , and iii , we presented some details and many extensions of the analysis of ref .",
    "most of the results in ref .",
    "@xcite and in papers i , ii , and iii were obtained based on physical arguments and on exact solutions available in certain limits .",
    "however , the optimization problems discussed there fall naturally into the framework of optimal control problems , for which powerful numerical optimization methods exist @xcite .",
    "thus , in the present paper , we apply these optimal control methods to the problem of photon storage . as a result , we open up the possibility of efficient photon storage in previously inaccessible regimes by increasing the bandwidth of the memory and provide simple intuitive understanding for the optimization methods underlying photon storage .",
    "we refer the reader to paper i for a comprehensive introduction to photon storage in @xmath0-type atomic media and for the full list of references . here",
    "we summarize only a few important points . in a typical photon storage protocol , an atomic ensemble with @xmath0-type level structure shown in fig .",
    "[ fig : lambda ] is assumed to start with all @xmath1 atoms pumped into the metastable state @xmath2 .",
    "the incoming quantum light mode is coupled to the @xmath3 transition with a collectively enhanced coupling constant @xmath4 and is mapped onto the collective coherence ( called a spin wave ) between the metastable states @xmath5 and @xmath2 using a classical two - photon - resonant control pulse with time - dependent rabi frequency @xmath6 .",
    "ideal mapping of the light mode onto the spin wave and back can be achieved in an ensemble that has infinite resonant optical depth @xmath7 on the @xmath3 transition . however , despite the existence of proposals for achieving high values of @xmath7 @xcite , in most current experiments @xmath7 ( or the cooperativity parameter @xmath8 for ensembles enclosed in a cavity @xcite ) is limited to @xmath9 due to experimental imperfections such as competing four - wave mixing processes @xcite , spatially - varying light shifts @xcite , number of atoms in a trap @xcite , or inhomogeneous broadening and short interaction lengths @xcite . as a result of the limited optical depth ,",
    "the experimentally demonstrated efficiencies for the light - matter interface are low , which makes the optimization of photon storage protocols at finite values of @xmath7 crucial .",
    "the optimization in ref .",
    "@xcite , in papers i , ii , and iii , as well as in the present paper relies on the knowledge of the shape of the incoming photon mode .",
    "note that such knowledge is not incompatible with storing unknown quantum states because the mode usually acts simply as a carrier while the information is stored in the quantum state of the harmonic oscillator corresponding to this mode @xcite .",
    "a different type of problem is the storage of an unknown mode or , equivalently , the storage of multiple photonic modes within an ensemble @xcite . while we believe that the optimization procedures considered here will probably also be relevant to this situation",
    ", we shall not discuss it in more detail here .",
    "the main tool used in this paper is a numerical iterative optimization with respect to some set of control parameters , which are updated to yield higher photon storage efficiency at every iteration .",
    "such iterative optimization methods are a standard tool in applied optimal control theory @xcite .",
    "these methods and their variations are already being used in a variety of applications including laser control of chemical reactions @xcite , design of nmr pulse sequences @xcite , loading of bose - einstein condensates into an optical lattice @xcite , atom transport in time - dependent superlattices @xcite , quantum control of the hyperfine spin of an atom @xcite , and design of quantum gates @xcite . although advanced mechanisms for updating the control parameters from one iteration to the next exist and exhibit superior convergence characteristics @xcite",
    ", we will concentrate in the present paper on optimization via a simple gradient ascent method @xcite , except for sec .",
    "[ sec : ein ] where advanced updating mechanisms will also be used .",
    "gradient ascent methods are often more efficient than simple variations of the control parameters using , e.g. , genetic algorithms .",
    "moreover , we will show that gradient ascent optimization has the advantage that it can often be understood physically and can provide deeper intuition for the photon storage problem .",
    "in particular , in papers i , ii , and iii , we used involved physical arguments and exact analytical solutions available in certain limits to derive a time - reversal - based iterative optimization with respect to the shape of the incoming photon mode . in the present paper , we show that these time - reversal iterations and the general and often discussed connection between optimality and time reversal in photon storage @xcite naturally follow from the gradient ascent method .",
    "the results of papers i , ii , and iii are , however , still crucial since they show in certain cases that the solutions obtained via the local gradient ascent method represent global , rather than local , optima .",
    "in addition to considering optimization with respect to the shape of the input mode , we consider in the present paper optimization with respect to the storage control field .",
    "in particular , we show that shaping the control field via the gradient ascent method allows for efficient storage of pulses that are an order of magnitude shorter than when the control field is optimized in the adiabatic approximation discussed in ref .",
    "@xcite and in papers i and ii . in other words",
    ", this new control shaping method increases the bandwidth of the memory .",
    "finally , we discuss the performance of optimal control pulses in the context of photon storage via controlled reversible inhomogeneous broadening ( crib ) @xcite .",
    "in particular , assuming one is interested in storing a single known incoming light mode and assuming one can shape control pulses with sufficient precision , we are not able to identify any advantages of crib - based photon storage compared to photon storage with optimal control pulses in homogeneously broadened media .    the remainder of the paper is organized as follows . in secs .  [ sec : contr ] , [ sec : ein ] , and [ sec : inh ] , we show how gradient ascent can be used to optimize with respect to the control field , the input mode , and the inhomogeneous profile , respectively .",
    "we summarize the discussion in sec .",
    "[ sec : sum ] and , finally , present some details omitted in the main text in the appendixes [ app : contrcav]-[app : inhom ] .",
    "in principle , both the incoming light mode and the classical control pulse may be adjusted to maximize the light storage efficiency .",
    "however , it is often easier to vary the classical control pulse . in particular",
    ", the photonic state we wish to store may be some non - classical state generated by an experimental setup , where we can not completely control the shape of the outgoing wave packet .",
    "this is , e.g. , the case for single photons generated by parametric down conversion @xcite or by single nitrogen - vacancy centers in diamond @xcite , where the shape of the wave packet will be , respectively , set by the bandwidth of the setup and the exponential decay associated with spontaneous emission .",
    "alternatively , the wave packet may also be distorted in an uncontrollable way by the quantum channel used for transmitting the photonic state @xcite . in this section ,",
    "we therefore discuss optimization with respect to the storage control field in both the cavity model ( sec .",
    "[ sec : contrcav ] ) and the free space model ( sec .",
    "[ sec : contrfree ] ) .",
    "as discussed in papers i and ii , the cavity model , in which the atomic ensemble is enclosed in a cavity , is theoretically simpler than the free space model because only one collective atomic mode can be excited .",
    "in addition , as shown in papers i and ii , the cavity setup can yield higher efficiencies in certain cases than the free space model due to the enhancement of the optical depth by the cavity finesse and due to ( for certain spin wave modes ) better scaling of the error with the optical depth @xmath7 ( @xmath10 in the cavity vs. @xmath11 in free space ) . we , therefore , start with the cavity model . as in paper",
    "i , to get the closest analogy to the free - space regime , we will discuss in the present paper only the so - called  bad cavity \" limit , in which the cavity mode can be adiabatically eliminated .",
    "however , the method of gradient ascent can easily be applied outside of this limit , as well .    to simplify the discussion ,",
    "we first consider the simplest example , in which one stores a given resonant input mode into a homogeneously broadened ensemble enclosed in a cavity and having negligible spin - wave decay rate .",
    "it is important to note that , because only one spin - wave mode is accessible in the cavity model , the retrieval efficiency is independent of how the storage is done ( see paper i ) .",
    "this makes it meaningful to optimize storage separately from retrieval [ the latter does not have to be optimized since its efficiency depends only on the cooperativity parameter ( see paper i ) ] .",
    "we follow the derivation of paper i to adiabatically eliminate the cavity mode and to reduce the equations of motion to the following complex number equations on the time interval @xmath12 $ ] : @xmath13 here the optical polarization @xmath14 on the @xmath3 transition and the spin polarization @xmath15 on the @xmath16 transition satisfy initial conditions @xmath17 and @xmath18 , respectively , corresponding to the absence of atomic excitations at @xmath19 . in this example , the shape of the incoming mode @xmath20 is assumed to be specified , real , and normalized according to @xmath21 .",
    "@xmath22 is the decay rate of the optical polarization and @xmath8 is the collectively enhanced cooperativity parameter equal to the optical depth of the atomic ensemble times the cavity finesse .",
    "the goal is to find the slowly varying control field rabi frequency envelope @xmath6 ( assumed to be real ) that maximizes the storage efficiency @xmath23 .",
    "[ to avoid carrying around extra factors of @xmath24 , @xmath6 is defined as half of what is usually called the rabi frequency : it takes time @xmath25 to do a @xmath26 pulse ] .",
    "for the moment , we suppose that there is no constraint on the energy of the control pulse and return to the possibility of including such a constraint below .",
    "it is worth noting that due to their linearity , the equations of motion ( and all the results of the present paper ) apply equally well both to classical input fields with pulse shapes proportional to @xmath20 and to quantum fields whose excitations are confined to the mode described by @xmath20 .",
    "the efficiency @xmath27 is thus the only parameter required to fully characterize the memory ( see paper i ) .",
    "since the optimization of @xmath28 is constrained by the equations of motion ( [ cavp1 ] ) and ( [ cavs1 ] ) , we introduce lagrange multipliers @xmath29 and @xmath30 to ensure that the equations of motion are fulfilled , and turn the problem into an unconstrained maximization of @xcite @xmath31 \\nonumber \\\\ & & + \\int_0^t d t \\left [ \\bar s^ * \\left(-\\dot s + i \\omega",
    "p\\right ) + c.c . \\right],\\end{aligned}\\ ] ] where c.c",
    ".  stands for the complex conjugate @xcite .",
    "the optimum requires that @xmath32 is stationary with respect to any variation in @xmath33 , @xmath34 , and @xmath35 . as shown in appendix [ app : contrcav ]",
    ", setting @xmath32 to be stationary with respect to variations in @xmath33 and @xmath34 requires that the lagrange multipliers ( also referred to as the adjoint variables ) @xmath36 and @xmath37 satisfy the equations of motion @xmath38 subject to boundary conditions at time @xmath39 @xmath40 these are the same equations as for @xmath34 and @xmath33 [ eqs .",
    "( [ cavp1 ] ) and ( [ cavs1 ] ) ] except that there is no input field and that the decay with rate @xmath41 is replaced with growth , which will function as decay for backward evolution .",
    "this backward evolution , in fact , corresponds to retrieval with the time - reversed control field and can be implemented experimentally as such ( see papers i , ii and ref .",
    "@xcite ) . it is satisfying to have obtained this purely mathematical and simple derivation of the often discussed connection between optimality and time reversal in photon storage @xcite .",
    "as explained in the introduction to paper i and as shown in detail in paper ii , this connection goes beyond the perfect reversibility of unitary evolution discussed in refs .",
    "@xcite by including systems with non - reversible dynamics , as exemplified , for example , by the decay rate @xmath22 in the present model .",
    "( [ eqpt])-([eqstt ] ) ensure that @xmath32 is stationary with respect to variations in @xmath33 and @xmath34 . to find the optimum it remains to set to zero the functional derivative of @xmath32 with respect to @xmath35 .",
    "this functional derivative is given by @xmath42,\\ ] ] where `` i m '' denotes the imaginary part .",
    "in general , if one has a real function of several variables , one way to find a local maximum is to pick a random point , compute partial derivatives at that point , move a small step up the gradient , and then iterate .",
    "the same procedure can be applied to our optimal control problem @xcite .",
    "the gradient ascent procedure for finding the optimal storage control pulse @xmath6 is to take a trial @xmath6 and then iteratively update @xmath6 by moving up the gradient in eq .",
    "( [ gradcav ] ) according to @xmath43.\\ ] ] where @xmath44 regulates the step size . in order to compute the right hand side of eq .",
    "( [ omupdatecav ] ) , one has to evolve the system forward in time from @xmath19 to @xmath39 using eqs .",
    "( [ cavp1 ] ) and ( [ cavs1 ] ) to obtain @xmath15 and @xmath14 .",
    "then project the final atomic state described by @xmath45 and @xmath46 onto @xmath34 according to eqs .",
    "( [ eqptt ] ) and ( [ eqstt ] ) to obtain @xmath47 and @xmath48",
    ". then evolve @xmath37 and @xmath36 backwards in time from @xmath39 to @xmath19 according to eqs .",
    "( [ eqpt ] ) and ( [ eqst ] ) .    in general , as in any gradient ascent method , the step size @xmath44 in eq .",
    "( [ omupdatecav ] ) has to be chosen not too big ( one should not go up the gradient so quickly as to miss the peak ) but not too small ( in order to approach the peak relatively quickly ) . to achieve faster convergence",
    ", one could use a different step size @xmath44 for each iteration ; but for the problems considered in the present paper , convergence is usually sufficiently fast that we do not need to do this ( unless the initial guess is too far from the optimum , in which case changing @xmath49 a few times helps ) .",
    "moreover , in some optimization problems @xcite , @xmath44 has to be chosen such that it depends on the argument of the function we are trying to optimize , i.e. , in this case the time @xmath50 ; this is not required for the present problems , and @xmath44 is just taken to be a constant .",
    "for example , let us take @xmath51 , @xmath52 , and a gaussian - like input mode @xmath53 where @xmath54 is a normalization constant and where the mode is chosen to vanish at @xmath19 and @xmath39 for computational convenience . starting with an initial guess @xmath55 and using @xmath56 , it takes about 45 iterations for the efficiency to converge to within @xmath57 of the optimal efficiency of @xmath58 ( see paper i for the derivation of this formula ) . if , however , @xmath49 is too small ( e.g.  @xmath59 ) , then the step size is too large , and , instead of increasing with each iteration , the efficiency wildly varies and does not converge .",
    "we now compare the optimal control field shaping to the adiabatic control field shaping presented in paper i. we first take @xmath60 and consider the input mode in eq .",
    "( [ ein ] ) with @xmath61 .",
    "following paper i , we calculate the storage control field using the adiabatic equations [ eq .",
    "( 26 ) in paper i ] , then numerically compute the storage efficiency with this control field , and multiply it by the complete retrieval efficiency @xmath62 to obtain the total efficiency . since we are in the adiabatic limit ( @xmath63 ) , the resulting total efficiency is equal to the maximum possible efficiency @xmath64 ( see paper i ) .",
    "[ fig : cavcontr](a ) shows the input mode in eq .",
    "( [ ein ] ) ( dashed line ) and the adiabatic storage control field ( dotted line ) . the optimal control field shaping using gradient ascent via eq .",
    "( [ omupdatecav ] ) also yields the maximum possible efficiency @xmath64 independent of the initial guess for @xmath6 .",
    "the four solid lines in fig .  [ fig : cavcontr](a ) show @xmath6 resulting from optimal control field shaping for four different initial guesses , @xmath65 , @xmath66 , @xmath24 , and @xmath67 .",
    "the four optimal control fields and the adiabatic control field agree except at small times .",
    "the reason for the disagreement is that the dependence of storage efficiency on the front section of the control field is very weak because this section affects only the front part of the excitation , and a large part of this anyway leaks out at the back end of the atomic ensemble .",
    "in fact , the dependence is so weak that gradient ascent leaves the front part of the initial guesses almost unperturbed .",
    "it is worth noting that , in general , gradient ascent methods are not guaranteed to yield the global optimum , and the iterations may get trapped in a local maximum . however , for our photon storage problem , we know what the global optimum is in some cases . in particular , we have shown in paper i ( for the cavity model ) and in paper ii ( for the free space model ) that , in the adiabatic limit , adiabatic control field shaping yields the global optimum . since control shaping via",
    "gradient ascent agrees with the adiabatic shaping in this limit , we have a strong indication that gradient ascent always yields the global optimum also outside of the adiabatic limit .",
    "the global optimum is here the ( unique ) maximum possible efficiency , which , within the numerical error , is achievable for a variety of control fields due to the lack of sensitivity to the control field for small times ( see fig .  [",
    "fig : cavcontr ] ) .",
    "we now repeat the same steps except that we use @xmath68 .",
    "the resulting control fields are shown in fig .",
    "[ fig : cavcontr](b ) .",
    "again the four optimal control fields correspond to different initial guesses [ @xmath69 , @xmath70 , @xmath71 , and @xmath72 .",
    "the adiabatic control field now differs from the optimal one on the entire time interval .",
    "the reason is that the adiabatic limit ( @xmath73 ) is not satisfied to a sufficient degree ( @xmath74 ) , and , as a result , the adiabatic approximation does not work well .",
    "indeed , the efficiency yielded by the adiabatic control ( @xmath75 ) is much smaller than that yielded by the optimal control ( @xmath76 ) .",
    "physically , the breakdown of the adiabatic approximation means that the optical polarization @xmath14 no longer follows the spin wave @xmath15 adiabatically , but rather evolves dynamically according to the full differential equation ( [ cavp1 ] ) . since in this regime ( @xmath77 ) the optimal control field is turned on abruptly following a time period when it is off [ see fig .  [",
    "fig : cavcontr](b ) ] , the optimal storage procedure acquires some characteristics of photon - echo type fast storage @xcite .",
    "in fast storage , the input pulse is first absorbed on the @xmath78 transition in the absence of the control field , and is then mapped to the @xmath79 coherence via a control @xmath26 pulse .",
    "this connection is not surprising since fast storage is indeed optimal for certain input modes of duration @xmath80 .",
    "finally , we note that all the initial guesses for @xmath35 that we tried yielded the same optimal control ( up to the unimportant front part ) and the same efficiency , which is a signature of the robustness of the optimization protocol and is another strong indication that , for this optimal control problem , gradient ascent yields the global , rather than local , optimum .",
    "having performed the comparison of the control fields generated by adiabatic shaping and by gradient ascent , we turn to the investigation of the dependence on @xmath8 and on @xmath81 of the efficiency achieved by these two methods . in fig .",
    "[ fig : caveff](a ) , we compare the efficiency of storage followed by retrieval of the input mode of eq .",
    "( [ ein ] ) obtained using the adiabatic control field ( dotted lines ) and using the control found via gradient ascent ( solid lines ) .",
    "the efficiencies are plotted as a function of @xmath81 for three indicated values of @xmath8 ( @xmath82 , @xmath83 , @xmath84 ) .",
    "dashed lines correspond to @xmath85 , the maximum efficiency possible at any given @xmath8 .",
    "we note that the dotted lines have already been shown in fig .",
    "2(a ) of paper i. according to the arguments presented in papers ii and iii , we note that it is impossible to retrieve into a mode much shorter than @xmath86 , and hence , by time - reversal , it is impossible to efficiently store such a short mode . fig .",
    "[ fig : caveff](a ) confirms that indeed , when @xmath87 , even optimal controls can not give high efficiency . using gradient ascent instead of adiabatic shaping",
    ", one can , however , efficiently store input modes that are about an order of magnitude shorter and , thus , an order of magnitude larger in bandwidth .",
    "it is worth repeating that although the method of gradient ascent is generally not guaranteed to yield the global maximum , the fact that it does give the known global maximum in the limit @xmath73 suggests that it probably yields the global maximum at all values of @xmath81 .    to confirm the robustness and generality of the optimization procedure , we show in fig .",
    "[ fig : caveff](b ) the results of the same optimization as in fig .",
    "[ fig : caveff](a ) but for a square input mode @xmath88 instead of the gaussian - like input mode of eq .",
    "( [ ein ] ) . as in fig .",
    "[ fig : caveff](a ) , we see that gradient ascent control shaping improves the threshold in the value of @xmath81 , where efficiency abruptly drops , by an order of magnitude .",
    "this can again be interpreted as an effective increase in the bandwidth of the memory by an order of magnitude . the optimal storage efficiency for the square input pulse falls to half of the maximum at smaller @xmath81 than for the gaussian - like input pulse because the latter has a duration ( half - width at half maximum , for example ) significantly shorter than @xmath89 [ see eq .",
    "( [ ein ] ) or fig .",
    "[ fig : cavcontr ] ] . on the other hand , as @xmath81 is increased , the maximum is approached slower for the square input mode than for the gaussian - like mode .",
    "this is because the high frequency components contributed by the sharp edges of the square pulse are difficult to store .",
    "most experiments have features that go beyond the simple model we have just described .",
    "therefore , in appendix [ app : cavgen ] , we generalize this model and the optimization procedure to include the possibility of complex control field envelopes @xmath6 and input mode envelopes @xmath90 , nonzero single - photon detuning @xmath91 and spin wave decay rate @xmath92 , and ( possibly reversible @xcite ) inhomogeneous broadening .",
    "our model of inhomogeneous broadening is applicable both to doppler broadening in gases and to the broadening of optical transitions in solid state impurities caused by the differences in the environments of the impurities @xcite . for the case of doppler broadened gases ,",
    "we also allow for the possibility of modeling velocity changing collisions with rate @xmath93 . finally , in appendix [ app : cavgen ] , we also show how to take into account the possibility that the classical driving fields available in the laboratory are not sufficiently strong to realize the optimal control fields , which may be the case for short input modes and/or large single - photon detuning @xmath91 , both of which require control pulses with large intensities .",
    "although a comprehensive study of optimization for @xmath94 is beyond the scope of the present paper , we will now prove that the maximum efficiency for @xmath94 is exactly equal to the maximum efficiency for @xmath95 .",
    "suppose we know the control field @xmath96 that achieves the optimum for a given resonant input @xmath90 .",
    "then , for an input at @xmath94 with the same envelope @xmath90 , we can construct the control field @xmath6 as a sum of two parts [ written in the two - photon - resonant rotating frame as in eqs .",
    "( [ pj ] ) and ( [ sj ] ) ] @xmath97 the first part is a far - detuned control ( @xmath98 ) that stark - shifts level @xmath99 into resonance with the input ( i.e.  such that @xmath100 ) , while the second part is resonant with the stark - shifted @xmath101 transition and has the envelope equal to the optimal resonant control .",
    "the reason why an extra detuning @xmath91 is needed to bring the second term in two - photon resonance is because @xmath102 stark - shifts both @xmath99 and @xmath5 by @xmath91",
    ". the resulting efficiency must be equal to the optimal resonant efficiency up to an error on the order of the small population mixing between @xmath99 and @xmath5 caused by @xmath102 ; that is , @xmath103 . to verify mathematically that the control in eq .  ( [ omega2 ] ) works , one can write @xmath33 and @xmath34 as a sum of a slowly varying piece and a rapidly oscillating piece , extract separate equations for the rapidly and slowly oscillating variables , and finally adiabatically eliminate the rapidly oscillating variables .",
    "we have also numerically verified the performance of the control in eq .",
    "( [ omega2 ] ) and the scaling of the error ( @xmath104 ) by integrating the equations of motion for the case of homogeneous broadening at several different values of @xmath105 and @xmath8 for the pulse shape in eq .",
    "( [ ein ] ) .",
    "thus , the optimal off - resonant efficiency is greater than or equal to the optimal resonant efficiency for the same input envelope @xmath90 . carrying out the same argument backwards [ i.e.  using @xmath106 to shift @xmath99 _ out _ of resonance ]",
    ", we conclude that the optimal efficiency must be the same on and off resonance . when applying this idea in practice , one should , of course , realize that , in addition to a possible technical limit on the available control power , the three - level approximation and the rotating - wave approximation may start to break down for sufficiently large values of @xmath107 and @xmath102 .      although the cavity model discussed in sec .",
    "[ sec : contrcav ] is theoretically simpler and results , in certain cases , in higher efficiencies than the free space model , the latter is easier to set up experimentally .",
    "moreover , because of the accessibility of a large number of spin wave modes , the free space model can provide higher efficiencies in some other cases ( see paper ii ) and can , in principle , function , as a multi - mode memory .",
    "therefore , we turn in the present section to the analysis of the free space model .    to demonstrate how optimization with respect to the control field works in the free space model , we again begin with a simple example of resonant photon storage in a homogeneously broadened atomic ensemble with negligible spin - wave decay .",
    "it is important to note that , in contrast to the cavity model , the free space model gives access to many different spin - wave modes , which makes the retrieval efficiency dependent on how storage is carried out ( see paper ii ) .",
    "therefore , optimization of storage alone is not a priori very practical .",
    "however , as shown in paper ii , the optimization of storage alone is indeed useful because , in many cases , it also optimizes storage followed by backward retrieval .    in order to have slightly simpler mathematical expressions , we work in the co - moving frame ( see paper ii ) , although the same argument can be carried out using the original time variable , as well . the complex number equations of motion on the interval @xmath12 $ ] are then ( see ref .",
    "@xcite and paper ii ) @xmath108 with initial and boundary conditions @xmath109 these equations are written using dimensionless variables , in which ( co - moving ) time and rabi frequency are rescaled by @xmath22 ( @xmath110 and @xmath111 ) and the position is rescaled by the length @xmath112 of the ensemble ( @xmath113 ) .",
    "@xmath114 describes the slowly varying electric field envelope , the input mode @xmath115 satisfies the normalization constraint @xmath116 , @xmath7 is the resonant optical depth , and @xmath117 and @xmath115 are for now assumed to be real . [ to avoid carrying around extra factors of @xmath24 , @xmath7 is defined as half of what is often referred as the optical depth : the steady - state solution with @xmath118 gives probe intensity attenuation @xmath119 . ] the goal is to maximize the storage efficiency @xmath120 with respect to @xmath121 . a procedure analogous to that used in the cavity model in sec .",
    "[ sec : contrcav ] yields equations of motion ( also referred to as the adjoint equations ) for the lagrange multipliers @xmath122 , @xmath123 , and @xmath124 : @xmath125 with initial and boundary conditions @xmath126 as in the cavity discussion in sec .",
    "[ sec : contrcav ] , these equations describe backward retrieval and provide a simple mathematical connection between optimality and time - reversal . in order to move up the gradient",
    ", one should update @xmath127 according to @xmath128 .",
    "\\end{aligned}\\ ] ]    we showed in ref .",
    "@xcite and in paper ii that , in the adiabatic limit ( @xmath129 ) and for a certain class of input modes of duration @xmath130 , one can achieve a universally optimal ( for a fixed @xmath7 ) storage efficiency that can not be exceeded even if one chooses a different input mode .",
    "we showed that in that case the obtained control field will also maximize the total efficiency of storage followed by backward retrieval .",
    "however , this would not necessarily be the case for a general input mode in the non - adiabatic limit ( @xmath131 ) , which is precisely the limit , in which gradient ascent optimization becomes most useful .",
    "moreover , for the case of forward retrieval , the control field that maximizes the storage efficiency does not maximize the total efficiency of storage followed by retrieval even in the adiabatic limit .",
    "thus , in appendix [ app : freegen ] , we describe how to use gradient ascent to maximize ( still with respect to the storage control field ) the total efficiency of storage followed by retrieval .    as in the cavity model in sec .",
    "[ sec : contrcav ] , we now compare adiabatic shaping of the storage control field ( see ref .",
    "@xcite and paper ii ) to the optimal shaping via gradient ascent . to compare with the results of paper ii , we maximize the total efficiency of storage followed by backward retrieval rather than the storage efficiency alone .",
    "we assume that @xmath132 and that @xmath90 is the gaussian - like input mode in eq .",
    "( [ ein ] ) , shown as a dashed line in figs .  [ fig : freecontr](a ) and [ fig : freecontr](b ) .",
    "we first consider the case @xmath61 and shape the storage control using adiabatic shaping ( sec .",
    "vi b of paper ii ) .",
    "then we numerically compute the total efficiency of storage followed by complete backward retrieval using this storage control field ( the total efficiency is independent of the retrieval control field provided no excitations are left in the atoms ) .",
    "the adiabatic storage control is shown as a dotted line in fig .",
    "[ fig : freecontr](a ) . since for this input mode",
    "the adiabatic limit is satisfied ( @xmath133 ) , the adiabatic storage control yields an efficiency of @xmath134 , which is the maximum efficiency possible at this @xmath7 @xcite .",
    "for the same reason , the adiabatic control agrees with the control field computed via gradient ascent ( solid line ) , which also yields an efficiency of @xmath134 .",
    "[ fig : freecontr](a ) shows four solid lines ( optimal control fields ) corresponding to four initial guesses @xmath65 , @xmath135 , @xmath66 , and @xmath136 . as in the cavity model discussion in sec",
    ".  [ sec : contrcav ] , the difference between the four optimal controls and the adiabatic control is inconsequential .    repeating the calculation for @xmath68",
    ", we obtain fig .",
    "[ fig : freecontr](b ) . since the adiabatic limit ( @xmath129 ) is no longer satisfied ( @xmath137 ) , the adiabatic approximation does not work and the adiabatic control differs from the optimal control and gives a lower efficiency : @xmath138 vs.  @xmath139 . as in fig .",
    "[ fig : freecontr](a ) , the four optimal control fields plotted correspond to different initial guesses @xmath140 , @xmath67 , @xmath70 , and @xmath141 .",
    "as in the cavity discussion , fig .",
    "[ fig : freecontr](b ) indicates that , in the regime @xmath142 , where the adiabatic approximation no longer holds , the optimal control field acquires characteristics of the control field used in fast storage .    as in the analysis of the cavity model in sec .",
    "[ sec : contrcav ] , we now analyze the dependence on @xmath7 and @xmath143 of the efficiency yielded by the adiabatic control shaping and the optimal control shaping . in fig .",
    "[ fig : freeeff ] , we compare the efficiency of storage followed by complete backward retrieval of the input mode in eq .",
    "( [ ein ] ) obtained using the control field shaped using the adiabatic equations ( dotted lines ) and using gradient ascent ( solid lines ) .",
    "the efficiencies are plotted as a function of @xmath143 for three indicated values of @xmath7 ( @xmath82 , @xmath83 , @xmath84 ) .",
    "horizontal dashed lines represent the maximum efficiency possible at the given @xmath7 @xcite .",
    "the dotted lines are the same as in fig .",
    "6(a ) of paper ii .",
    "similar to the corresponding discussion of the cavity model in sec .",
    "[ sec : contrcav ] , fig .",
    "[ fig : freeeff ] confirms the predictions of papers ii and iii that efficient photon storage is not possible for @xmath131 .",
    "it also illustrates that optimal control fields open up the possibility of efficient storage of input modes with a bandwidth that is an order of magnitude larger than the bandwidth allowed by the adiabatic storage .",
    "in addition , the same reasoning as in the cavity discussion leads to the conclusion that for this problem , gradient ascent most likely yields the global , rather than local , maximum at all values of @xmath143 .",
    "various generalizations of the presented procedure can be made .",
    "first , the generalization to limited control pulse energy , ( possibly reversible @xcite ) inhomogeneous broadening , complex @xmath35 and @xmath144 , and nonzero @xmath91 , @xmath92 , and @xmath93 can be carried out exactly as in the cavity case ( appendix [ app : cavgen ] ) .",
    "second , in the case of backward retrieval , if the two metastable states are nondegenerate and have a frequency difference @xmath145 , one should incorporate an appropriate position - dependent phase shift of the spin wave of the form @xmath146 , where @xmath147 ( see sec .",
    "viii of paper ii ) .",
    "finally , another extension can be made for the cases when the total efficiency depends on the retrieval control field ( e.g.  if @xmath92 and/or @xmath93 are nonzero ) . in those cases",
    ", one can simultaneously optimize with respect to both the storage and the retrieval control fields .",
    "however , one may then need to put a limit on the energy in the retrieval control pulse since , for the case of @xmath148 , for example , the faster one retrieves , the higher is the efficiency , and the optimal retrieval control field may , in principle , end up having unlimited power ( e.g.  an infinitely short @xmath26 pulse ) .",
    "although it is usually easier to optimize with respect to the control field , optimization with respect to the input mode can also be carried out in certain systems . for both classical and quantum light",
    ", the mode shape can often be controlled by varying the parameters used during the generation of the mode .",
    "for example , if the photon mode is created by releasing some generated collective atomic excitation , one can , under certain assumptions , generate any desired mode shape @xcite . for the case of classical light",
    ", one can also shape the input light pulse simply using an acousto - optical modulator .",
    "an important advantage of optimizing with respect to the input mode is that the iterations can be carried out experimentally @xcite . in this section",
    ", we consider the maximization of light storage efficiency with respect to the shape of the input mode .",
    "the gradient ascent method , used in sec .",
    "[ sec : contr ] to optimize with respect to the control field , can be easily applied to the optimization with respect to the input mode shape both in the cavity model and in the free space model .",
    "since one is interested in finding the optimal input mode shape , the optimization has to be carried out subject to the normalization condition @xmath149 . this condition",
    "can be included by adding an extra term with a lagrange multiplier to the functional @xmath32 to be optimized .",
    "the iterations are then done as follows : one first integrates the storage equations for a trial input mode ; then integrates the adjoint equations corresponding to backward retrieval ( as in secs .",
    "[ sec : contrcav ] and [ sec : contrfree ] ) ; then updates the trial input mode by adding to it a small correction proportional to the output of backward retrieval [ @xmath150 in the cavity model or @xmath151 in the free space model ] ; and finally renormalizes the new input mode to satisfy the normalization condition .",
    "an important feature that distinguishes the optimization with respect to the input mode from the optimization with respect to the control field is the possibility of making finite ( not infinitesimal ) steps .",
    "standard gradient - ascent improvement [ such as via eqs .",
    "( [ omupdatecav ] ) and ( [ omupdate2 ] ) ] is , in principle , infinitesimal due to its reliance on the small parameter @xmath44 .",
    "several decades ago , krotov introduced and developed an important powerful and rapidly converging global improvement method @xcite that is not characterized by a small parameter .",
    "largely thanks to the presence of the normalization condition on the input mode , this method can be applied to derive non - infinitesimal quickly converging updates for the problem of optimization of light storage efficiency with respect to the input mode . for the cavity model of sec .",
    "[ sec : contrcav ] , this update is given by @xmath152 followed by a renormalization of @xmath90 , while for the free - space model of sec .",
    "[ sec : contrfree ] , the update is given by @xmath153 followed by renormalization .",
    "these updates precisely correspond to the time - reversal - based iterations suggested in ref .",
    "@xcite and explained in more detail in papers i and ii . in these iterations ,",
    "optimization of light storage with respect to the input field is done by carrying out storage of a trial input mode followed by backward retrieval , and then using the normalized output of backward retrieval as the input mode in the next iteration .",
    "the beauty of this update procedure is the possibility of carrying it out experimentally .",
    "in fact , the extension of this procedure to the optimization of storage followed by forward retrieval , suggested in ref .",
    "@xcite and in paper ii , has already been demonstrated experimentally @xcite .    in the language of gradient ascent",
    ", one can still think of eqs .",
    "( [ onestep ] ) and ( [ einupdatefree3 ] ) as steps along the gradient .",
    "these steps are , however , finite , not infinitesimal .",
    "this allows one to think of time - reversal - based optimization with respect to the input mode as simple intuitive walk up the gradient .",
    "as shown in paper i , the fact that only one collective atomic mode can be excited in the cavity model makes the iterations of eq .",
    "( [ onestep ] ) converge to the optimum in a single step . using the terminology of gradient ascent ,",
    "the optimization with respect to the input field in the cavity model can , surprisingly , be achieved with a single large step up the gradient .",
    "we note that the optimization procedure discussed in this section can be easily generalized to include inhomogeneous broadening and ( for the case of doppler broadened gases ) the presence of velocity changing collisions .",
    "one can show that , even with these features , the iterative optimization procedure still works in exactly the same way by updating the input mode with the output of time - reversed retrieval .",
    "having discussed optimization with respect to the control field and the input mode , we now turn to the optimization with respect to the shape of the inhomogeneous profile .",
    "this optimization is most relevant in the context of controlled reversible inhomogeneous broadening ( crib ) @xcite .",
    "the main idea of crib is that by introducing inhomogeneous broadening into a homogeneously broadened medium ( via stark or zeeman shifts , for example ) and by optimizing the shape and width of this inhomogeneous profile , one can better match the absorption profile of the medium to the spectrum of the incoming photon mode and , thus , increase the storage efficiency @xcite . at the same time",
    ", one can minimize the losses caused by dephasing of different frequency classes with respect to each other by using an echo - like process triggered by a reversal of the inhomogeneous profile between the processes of storage and retrieval @xcite .",
    "we refer the reader to papers i and iii for a full list of references , and to ref .",
    "@xcite and paper iii for examples of recent theoretical studies .      as in sec .",
    "[ sec : contr ] , we begin the discussion with the theoretically simpler cavity model . although one can , of course , optimize with respect to the inhomogeneous profile in the problem of storage alone ( i.e.  not followed by retrieval ) , in the context of crib it is more relevant to consider the problem of storage followed by retrieval with the reversed inhomogeneous profile @xcite . moreover , although the approach can be extended to nonzero single - photon detuning and arbitrary control fields , we suppose for simplicity that the input mode @xmath90 is resonant and that the storage and retrieval control pulses are @xmath26 pulses . following the convention of ref .",
    "@xcite and papers i - iii , we refer to this use of @xmath26-pulse control fields as fast storage and fast retrieval .",
    "we leave most of the mathematical details of the problem to appendix [ app : inhom ] . here",
    "we only note that we describe the inhomogeneous profile by a discrete number of frequency classes .",
    "the index @xmath154 labels the frequency class with detuning @xmath155 from the center of the line containing a fraction @xmath156 of atoms ( @xmath157 ) . in appendix",
    "[ app : inhom ] , we show how to carry out optimization with respect to @xmath156 and/or @xmath155 .",
    "we now present the results of gradient ascent optimization with respect to the inhomogeneous profile for a particular example .",
    "we suppose that the input pulse is the gaussian - like mode in eq .",
    "( [ ein ] ) and that @xmath158 . the total efficiency of storage followed by retrieval , as a function of @xmath81 , is shown in fig .  [ fig : cavinhom](a ) for various storage protocols .",
    "the dash - dotted line gives the efficiency of fast storage ( i.e.  storage obtained by applying a control @xmath26 pulse on the @xmath3 transition at the end of the input mode at time @xmath89 ) followed by fast retrieval using a homogeneous line .",
    "as discussed in papers i and ii , a homogeneous ensemble enclosed in a cavity has only one accessible spin - wave mode and can , therefore , fast - store only one input mode , which has duration @xmath80 . as a result ,",
    "the decay at @xmath73 of the efficiency represented by the dash - dotted line is dominated by leakage of the input mode into the output mode and not by polarization decay .",
    "we now consider intoducing reversible inhomogeneous broadening and iteratively optimizing with respect to its shape ( using eq .",
    "( [ xj ] ) or eq .",
    "( [ xj2 ] ) ) . as expected , the efficiency grows with each iteration independently of the choice of the number of frequency classes , the choice of @xmath155 , and the initial guess for @xmath156 .",
    "the landscape in the control space , however , depends on the number of frequency classes and on @xmath155 .",
    "this landscape is also not as simple as in secs .",
    "[ sec : contr ] and [ sec : ein ] , i.e.  there exist local maxima .",
    "we did not perform an exhaustive search , but out of all the initial configurations , number of frequency classes , and @xmath155 distributions that we tried , the highest efficiencies were obtained for the cases when gradient ascent converged to only two nonempty frequency classes with opposite detunings ( we have not been able to come up with a simple physical reason for this ) .",
    "we therefore focus on the case of only two frequency classes with detunings @xmath159 and optimize with respect to @xmath160 [ using eq .",
    "( [ deltai ] ) ] .",
    "the optimized efficiency is shown with circles in fig .  [",
    "fig : cavinhom](a ) . for @xmath81 less than about @xmath161",
    ", it is optimal to have @xmath162 . for larger @xmath81",
    ", the optimal @xmath160 is shown in fig .",
    "[ fig : cavinhom](b ) : at small @xmath81 , it scales approximately as @xmath163 and then slower .",
    "the presence of two frequency classes and hence two accessible spin wave modes instead of one allows us to reduce the leakage error , so that the efficiency [ circles in fig .  [",
    "fig : cavinhom](a ) ] is now limited by polarization decay .",
    "finally , we would like to compare the broadening - optimized efficiency to the homogeneous control - optimized efficiency . repeating the optimization procedure of sec .",
    "[ sec : contrcav ] for @xmath158 , we obtain the solid line in fig .  [",
    "fig : cavinhom](a ) .",
    "the maximum efficiency possible at this @xmath8 is @xmath164 and is shown as the dashed line .",
    "the dashed line and the solid line are the same as in fig .",
    "[ fig : caveff](a ) , except that now @xmath158 . the fact that the solid line in fig .",
    "[ fig : cavinhom](a ) lies above the circles indicates that we have not been able to identify any advantage of fast storage with crib compared to optimal storage in the homogeneous medium .",
    "moreover , all inhomogeneous broadening configurations we tried to introduce into the optimized homogeneous protocol converged back to the homogeneous profile .",
    "these results suggest that if one wants to store a single mode of known shape using a homogeneously broadened ensemble of @xmath0-type systems enclosed in a cavity and can shape and time the control field with sufficient precision , it may be better to use optimal homogeneous storage and not to use crib .",
    "it is , however , worth noting that we have only carried out the simplest optimization of fast storage with crib .",
    "in particular , the performance of fast storage with crib may be further enhanced by optimizing with respect to the time , at which the storage @xmath26 pulse is applied .",
    "such optimization represents an optimal control problem with a free terminal time @xcite and is beyond the scope of the present paper ( although it can be carried out in a straightforward manner by repeating the optimization above systematically for different times of the @xmath26-pulse application ) .",
    "it is also important to note that the use of crib in the cavity model may allow for implementing a multimode memory @xcite in the cavity setup . unlike the free space model , which allows for the storage of multiple temporal input modes using , e.g. , raman- or eit - based protocols @xcite",
    ", the homogeneously broadened cavity model only has a single accessible spin - wave mode .",
    "therefore , if we do not use crib or some other inhomogeneous broadening mechanism , it can only store a single input mode      having discussed the optimization with respect to the inhomogeneous profile in the cavity model , we note that the same procedure can be carried out for the free space model in an analogous manner .",
    "the appropriate update equations are listed at the end of appendix [ app : inhom ] .    in paper iii , we compared storage using adiabatic control shaping in a homogeneous ensemble to fast storage with crib .",
    "we found that fast storage with crib can indeed do better than adiabatic homogeneous storage for @xmath142 .",
    "we show now that this result was mainly due to imperfect control field optimization outside of the adiabatic limit and that , in the present work , we have not been able to identify any advantages of fast storage with crib compared to optimal homogeneous storage .",
    "we consider storage of the resonant gaussian - like input mode in eq .",
    "( [ ein ] ) in a free space atomic ensemble with @xmath165 followed by backward retrieval . the total efficiency for various storage protocols is shown in fig .  [ fig : freeeff100 ] as a function of @xmath143 . the dash - dotted line and the two solid lines labeled g and l are taken from fig .",
    "8(a ) of paper iii .",
    "the dash - dotted line is the efficiency of fast storage followed by fast backward retrieval using a homogeneous line .",
    "the two solid lines labeled g and l are obtained using fast storage with optimal - width reversible inhomogeneous broadening with gaussian profile and lorentzian profile , respectively .",
    "although the optimization with respect to the inhomogeneous width can be done efficiently via gradient ascent [ using eq .",
    "( [ deltaifree ] ) ] , we have already performed this optimization in paper iii by sampling a sufficiently large set of inhomogeneous widths . the remaining third solid line and the dotted line ( both taken from fig .  [ fig : freeeff ] )",
    "correspond to homogeneous storage with optimal storage controls ( solid ) and with adiabatic controls ( dotted ) .",
    "the dashed line ( also from fig .",
    "[ fig : freeeff ] ) is the maximum possible efficiency at this @xmath7 .",
    "the plot shows that while adiabatic control field shaping ( dotted ) makes homogeneous storage less efficient for some values of @xmath143 than fast storage with crib ( solid lines labeled g and l ) , optimal control field shaping ( unlabeled solid line ) may enable homogeneous storage to be more efficient than fast storage with crib at all values of @xmath143 .    as in sec .",
    "[ sec : inhcav ] , we note , however , that we have presented only the simplest optimization of crib and that the full investigation of the advantages of crib is beyond the scope of the present paper . in particular , the crib efficiency may be enhanced by optimizing with respect to the time , at which the storage @xmath26-pulse is applied .",
    "moreover , crib might be useful in circumstances such as when a homogeneously broadened three - level system is not available , when more complicated inputs ( such as time - bin qubits ) are used , or when precise shaping and timing of the control pulse is harder to achieve than controlled reversible broadening .",
    "finally , crib - based memories may even be implemented without any optical control fields @xcite .",
    "in conclusion , we have shown that the powerful numerical optimal control method of gradient ascent allows one to obtain simple intuitive understanding and to achieve a significantly improved efficiency and a higher bandwidth in the problem of photon storage in @xmath0-type atomic ensembles .",
    "first , we showed how to apply gradient ascent to numerically compute optimal control fields even outside of the adiabatic limit both with and without a constraint on the energy in the control pulse .",
    "in particular , this opens up the possibility of efficient storage of input modes that are an order of magnitude shorter ( and hence an order of magnitude larger in bandwidth ) than the shortest modes that can be efficiently stored using adiabatic control field shaping .",
    "second , we showed that gradient ascent provides an alternative justification for the often discussed connection between optimality and time - reversal in photon storage , as well as for the iterative time - reversal - based optimization procedure with respect to the input field suggested in ref .",
    "@xcite , discussed in detail in papers i , ii , and iii , and demonstrated experimentally in ref .",
    "in particular , we confirmed that the iterative procedure works even in the presence of inhomogeneous broadening and ( for the case of doppler broadened gases ) in the presence of velocity changing collisions .",
    "finally , we showed how to use gradient ascent to optimize with respect to inhomogeneous broadening and demonstrated how this can significantly increase the efficiency of fast storage followed by fast backward retrieval in the presence of controlled reversible inhomogeneous broadening ( crib ) @xcite .",
    "provided one is interested in storing a single input photon mode of known shape and provided the control pulses can be generated with sufficient precision , we have not , however , been able to identify any advantages of crib - based photon storage compared to photon storage with optimal control pulses in homogeneously broadened media .    in general , gradient ascent methods",
    "do not guarantee the attainment of the global maxima .",
    "the global maximum is , however , indeed attained for our problem in the regimes where this maximum is known .",
    "this strongly suggests that , for the optimization with respect to the input mode and with respect to the storage control , gradient ascent may indeed be yielding the global optimum .",
    "we also note that one can optimize simultaneously with respect to various combinations of the control parameters simply by simultaneously updating each of them along the corresponding gradient .",
    "one can also include other possible control parameters that are available in a given experimental setup but have not been discussed in the present paper .",
    "for example , for the case of photon storage in solid - state systems , one can consider optimizing with respect to the number of atoms put back into the antihole @xcite or with respect to a time - dependent reversible inhomogeneous profile .",
    "other light storage systems , such as photonic crystals @xcite or cavity models where the cavity field can not be eliminated , are also susceptible to gradient ascent optimization .",
    "therefore , we expect the optimization procedures described in the present paper to allow for increased efficiencies and increased bandwidths in many current experiments on quantum memories for light , many of which are narrowband and suffer from low efficiencies",
    ". such improvements would facilitate advances in fields such as quantum communication and quantum computation .",
    "we thank n.  khaneja , l.  jiang , i.  novikova , v.f .",
    "krotov , and m.  shapiro for fruitful discussions .",
    "this work was supported by the national science foundation , danish natural science research council , darpa , the packard foundation , and the ec - funded projects scala and qoqip .",
    "this work has also been partially supported by the national science foundation through a grant for the institute for theoretical atomic , molecular and optical physics at harvard university and smithsonian astrophysical observatory .",
    "in sec .  [ sec : contrcav ] , we omitted the derivations of the adjoint equations of motion ( [ eqpt ] ) and ( [ eqst ] ) and of the corresponding boundary conditions ( [ eqptt ] ) and ( [ eqstt ] ) .",
    "we provide these derivations in this appendix .    varying @xmath32 given in eq .",
    "( [ jcav ] ) with respect to @xmath34 , @xmath166 , @xmath33 , and @xmath167 , we obtain @xmath168 where `` c.c . ''",
    "means complex conjugate taken of the whole expression after the equal sign .",
    "integrating by parts the terms containing time derivatives , we obtain @xmath169 since the initial conditions are fixed , we have here used @xmath170 to simplify the expression .",
    "the optimum requires that @xmath171 for any variations @xmath172 and @xmath173 .",
    "hence we collect the terms multiplying , e.g. , @xmath174 and set the result to zero . carrying out this procedure for @xmath174 , @xmath175 , and their conjugates , we obtain the boundary conditions ( [ eqptt ] ) and ( [ eqstt ] ) . collecting terms proportional to @xmath172 , @xmath173 , and their conjugates , we obtain adjoint equations of motion ( [ eqpt ] ) and ( [ eqst ] ) .",
    "in sec .  [ sec : contrcav ] , we showed how to perform control field optimization in the simplest possible version of the cavity model : a resonant input mode with a real envelope was stored using a control pulse with a real envelope and unlimited power into a homogeneously broadened ensemble with infinite spin - wave lifetime . in this appendix",
    ", we show how to optimize the control field in a more general model that includes the possibility of complex control field envelopes @xmath6 and input mode envelopes @xmath90 , nonzero single - photon detuning @xmath91 and spin wave decay rate @xmath92 , and ( possibly reversible @xcite ) inhomogeneous broadening such as doppler broadening in gases or the broadening of optical transitions in solid state impurities @xcite . for the case of doppler broadened gases ,",
    "we also include velocity changing collisions with rate @xmath93 .",
    "we also show how to take into account possible experimental restrictions on the strength of the classical control fields .    using the notation of paper iii , the complex number equations describing the generalized model are @xmath176 p_j - \\gamma c \\sqrt{p_j } p + i \\omega s_j    \\nonumber \\\\ & & + i \\sqrt{2 \\gamma c } \\sqrt{p_j } \\e_\\textrm{in } + \\gamma_c ( \\sqrt{p_j } p - p_j ) , \\\\ \\label{sj } \\dot s_j & = & -\\gamma_s s_j + i \\omega^ * p_j + \\gamma_c ( \\sqrt{p_j } s - s_j),\\end{aligned}\\ ] ] where @xmath154 labels the frequency class with detuning @xmath155 from the center of the line containing a fraction @xmath156 of atoms ( @xmath157 ) and where the total optical and spin polarizations are @xmath177 and @xmath178 , respectively .",
    "the terms proportional to @xmath93 describe completely rethermalizing collisions with rate @xmath93 @xcite .",
    "one can , of course , also take @xmath93 to be different for @xmath33 and @xmath34 .",
    "for example , if @xmath179 , which is often the case , one can drop the terms proportional to @xmath93 in eq .",
    "( [ pj ] ) @xcite .",
    "in addition to moving atoms from one frequency class to the other , collisions also result in line broadening , which can be taken into account by increasing @xmath22 @xcite .",
    "we assume that the goal is to maximize the efficiency @xmath23 of storage into the symmetric mode @xmath45 with respect to the control pulse @xmath6 for a given input mode shape @xmath90 satisfying the normalization condition @xmath180 .",
    "a procedure very similar to that described in sec .",
    "[ sec : contrcav ] and in appendix [ app : contrcav ] yields the following equations of motion for the adjoint variables : @xmath181 \\bar p_j + \\gamma c \\sqrt{p_j } \\bar p + i \\omega \\bar s_j   \\nonumber \\\\ & & - \\gamma_c ( \\sqrt{p_j } \\bar p-\\bar p_j ) , \\\\ \\dot { \\bar s}_j & = & \\gamma_s \\bar s_j + i \\omega^ * \\bar p_j - \\gamma_c ( \\sqrt{p_j } \\bar s- \\bar s_j),\\end{aligned}\\ ] ] where @xmath182 and @xmath183 .",
    "the corresponding initial conditions for backward propagation are @xmath184 similarly to sec .",
    "[ sec : contrcav ] , after taking an initial guess for @xmath6 and solving for @xmath185 , @xmath186 , @xmath187 , and @xmath188 , one updates @xmath6 by moving up the gradient @xmath189    short input modes and/or large single - photon detuning @xmath91 require control pulses with large intensities that might not be available in the laboratory .",
    "there exist ways to include a bound on the control field amplitude @xcite .",
    "alternatively , one may want to consider a slightly simpler optimization problem with a limit on the control pulse energy @xmath190 for some @xmath191 @xcite . in order to carry out the optimization subject to this constraint",
    ", one should first carry out the optimization without the constraint and see whether the optimal control satisfies the constraint or not .",
    "if it does not satisfy the constraint , one has to add a term @xmath192 to @xmath32 , so that the update becomes @xmath193,\\ ] ] where @xmath194 is adjusted to satisfy the constraint . by redefining @xmath194 and @xmath49",
    ", this update can be simplified back to eq .",
    "( [ omupdate1 ] ) followed by a renormalization to satisfy the constraint .",
    "depending on how severe the energy constraint is , one can then sometimes ( but not always ) further simplify the update by completely replacing @xmath6 with the gradient [ i.e.  set @xmath195 in eq .",
    "( [ omupdate3 ] ) ] followed by a renormalization of @xmath6 , as is done , for example , in ref .",
    "@xcite for the problem of laser control of chemical reactions .",
    "we note that these optimization protocols can be trivially extended to the full process of storage followed by retrieval , which , in the presence of inhomogeneous broadening , one might not be able to optimize by optimizing storage and retrieval separately .",
    "similarly , one may include the possibility of reversing the inhomogeneous profile between the processes of storage and retrieval @xcite .",
    "in sec .  [ sec : contrfree ] , we showed how to use gradient accent to find the control field that maximizes the storage efficiency .",
    "however , the obtained storage control field does not always maximize the total efficiency of storage followed by retrieval .",
    "therefore , in this appendix , we consider the maximization of the total efficiency of storage followed by retrieval with respect to the storage control field .",
    "while we demonstrate the procedure only for the case of forward retrieval , the treatment of backward retrieval is analogous .    we suppose that the control field @xmath6 consists of a storage control pulse on @xmath12 $ ] and a retrieval control pulse on @xmath196 $ ] .",
    "we want to optimize with respect to the former given the latter and the input mode ( note that the total efficiency is independent of the retrieval control for sufficiently strong retrieval control pulses , and it is therefore often less important to optimize with respect to the retrieval control pulse ) . here",
    "@xmath197 , and the subscripts in @xmath198 and @xmath199 stand for `` retrieval '' and `` final '' .",
    "the time interval @xmath200 $ ] corresponds to the waiting ( i.e.  storage ) time between the processes of storage ( which ends at @xmath39 ) and retrieval ( which begins at @xmath201 ) .",
    "we suppose that storage is described by eqs .",
    "( [ freeqe1])-([freeins1 ] ) on @xmath12 $ ] .",
    "then forward retrieval that follows after the storage time interval @xmath200 $ ] is described by the same equations ( [ freeqe1])-([freeqe3 ] ) but on the time interval @xmath196 $ ] with initial and boundary conditions @xmath202 where @xmath203 ( similarly , @xmath204 ) .",
    "( [ pztr ] ) assumes that the polarization has sufficient time to decay before retrieval starts , while eq .",
    "( [ s2 ] ) assumes that spin - wave decay is negligible during the storage time .",
    "the goal is to maximize the total efficiency of storage followed by retrieval , @xmath205 with respect to the storage control field .",
    "constructing @xmath32 and taking appropriate variations , we obtain initial and boundary conditions for backward propagation : @xmath206 $ } , \\\\ \\bar p(\\tilde z,\\tilde t_\\textrm{f } ) & = & 0 , \\\\ \\bar s(\\tilde z,\\tilde",
    "t_\\textrm{f } ) & = & 0,\\end{aligned}\\ ] ] and @xmath207 $ } , \\\\ \\bar",
    "p(\\tilde z,\\tilde t ) & = & 0 , \\\\ \\label{s4 } \\bar s(\\tilde z,\\tilde t ) & = & \\bar s(\\tilde z,\\tilde t_\\textrm{r}).\\end{aligned}\\ ] ] by taking the variational derivative of @xmath32 with respect to @xmath121 on the storage interval , we find that the update is exactly the same as for the optimization of storage alone and can be done via eq .",
    "( [ omupdate2 ] ) .",
    "we note that if the retrieval control pulse leaves no atomic excitations , one can obtain the same optimization equations by solving the storage optimization problem in sec .",
    "[ sec : contrfree ] but changing the function to be maximized from the number of spin - wave excitations @xmath208 to the complete retrieval efficiency from @xmath209 [ eq .",
    "( 6 ) of ref .",
    "it is also worth noting that the derivation presented here can trivially be extended to apply to backward ( instead of forward ) retrieval and to include complex @xmath35 and @xmath144 , ( possibly reversible @xcite ) inhomogeneous broadening , and nonzero @xmath91 , @xmath92 , and @xmath93 .",
    "in sec .  [ sec : inh ] , we presented the results on the optimization of photon storage with respect to the inhomogeneous broadening without providing the mathematical details . in this appendix , we present these details .",
    "we first consider the cavity model , but turn briefly to the free - space model at the end of this appendix .",
    "we suppose for simplicity that the input mode @xmath90 is resonant and that the storage and retrieval control pulses are @xmath26 pulses at @xmath39 and @xmath201 , respectively . in order to simplify notation",
    ", we define @xmath210 , satisfying the normalization @xmath211 . the storage equation ( [ pj ] ) on the interval @xmath12 $ ] then becomes @xmath212 with @xmath213 and with the initial condition @xmath214 .",
    "a @xmath26-pulse at @xmath39 mapping @xmath33 onto @xmath34 followed by another @xmath26-pulse at @xmath201 mapping @xmath34 back onto @xmath33 result in an overall @xmath215 pulse , so that @xmath216 . assuming the broadening is reversed at some time between @xmath89 and @xmath198 , the equations for retrieval on the interval @xmath196 $ ] are @xmath217 the total efficiency of storage followed by retrieval is then @xmath218    one can show that the equations of motion for the adjoint variables ( i.e.  the lagrange multipliers ) @xmath187 are @xmath219 for @xmath220 $ ] with @xmath221 and @xmath222 for @xmath12 $ ] with @xmath223 , where we defined @xmath224 .",
    "the last term in eq .",
    "( [ barpj1 ] ) describes an incoming field that is the time - reverse of the retrieved field .",
    "assuming we are optimizing with respect to @xmath225 , the update is @xmath226 followed by a rescaling of all @xmath225 by a common factor to ensure the normalization @xmath211 . here",
    "@xmath227 is given by @xmath228 \\left(\\bar p^*_j p + \\bar",
    "p^ * p_j\\right )   \\nonumber \\\\ & & - \\sqrt{2 \\gamma c } \\ , \\textrm{im }",
    "\\int_0^t d t \\ein \\bar p^*_j    \\nonumber \\\\ & & + 2 \\gamma c \\ , \\textrm{re } \\int_{t_\\textrm{r}}^{t_\\textrm{f } } d t p^*_{j } p , \\end{aligned}\\ ] ] where re denotes the real part .",
    "numerics show that the update can usually be simplified in a way that avoids the search for convenient values of @xmath49 and does not lose convergence . specifically , taking @xmath229 in eq .",
    "( [ xj ] ) , we obtain @xmath230 followed by renormalization . by defining a particular functional form for the dependence of @xmath225 on @xmath155 , one could also consider optimization with respect to only a few parameters , such as , for example , the width @xmath160 and the degree of localization @xmath231 of the inhomogeneous profile of the form @xmath232 $ ] .",
    "equivalently , instead of optimizing with respect to @xmath225 , one can optimize with respect to @xmath155 . to illustrate this procedure",
    ", we consider a simple optimization procedure with respect to a single parameter , the inhomogeneous width @xmath160 .",
    "we write @xmath233 for some fixed dimensionless parameters @xmath234 and consider maximizing the efficiency with respect to @xmath160 for fixed @xmath225 and @xmath234 .",
    "the equations of motion and the initial conditions for both @xmath185 and @xmath187 stay the same as in the optimization with respect to @xmath225 while the update becomes @xmath235 \\bar p^*_j f_j p_j.\\ ] ] by adjusting @xmath234 and @xmath225 , one can choose a particular inhomogeneous profile shape ( e.g.  lorentzian , gaussian , or a square ) and optimize with respect to its width .    having discussed the cavity case , we now list the corresponding free - space results . in free space , the update of @xmath225 via eq .",
    "( [ xj2 ] ) would use @xmath236 \\left(\\bar p^*_j \\e + \\bar \\e^ * p_j\\right).\\ ] ] similarly , the update of @xmath237 would be @xmath238 \\bar p^*_j f_j p_j.\\ ] ]                                                                      in order to understand why complex conjugates have to be added in eq .",
    "( [ jcav ] ) and how to take variations with respect to complex variables , one could rewrite the equations in terms of real variables , that is , the real and imaginary parts of @xmath33 and @xmath34 . the variations with respect to the real and imaginary parts can now be seen to be equivalent to treating the variables and their complex conjugates as independent variables . note , however , that this convention means that the gradient ascent update for any complex variable @xmath239 is @xmath240 ( we will use this for the optimization with respect to complex @xmath90 and complex @xmath6 ) .",
    "s. a. moiseev and b. s. ham , phys .",
    "a * 70 * , 063809 ( 2004 ) ; s. a. moiseev and m. i. noskov , laser phys . lett . * 1 * , 303 ( 2004 ) ; s. a. moiseev , izv .",
    "nauk , ser .",
    "68 * , 1260 ( 2004 ) [ bull .",
    "phys . * 68 * , 1408 ( 2004 ) ] ; s. a. moiseev , c. simon , and n. gisin , e - print arxiv : quant - ph/0609173 .",
    "m. fleischhauer , s. f. yelin , and m. d. lukin , opt",
    ". commun . * 179 * , 395 ( 2000 ) ; m. fleischhauer and m. d. lukin , phys .",
    "* 84 * , 5094 , ( 2000 ) ; m. fleischhauer and m. d. lukin , phys .",
    "a * 65 * , 022314 ( 2002 ) ."
  ],
  "abstract_text": [
    "<S> we use the numerical gradient ascent method from optimal control theory to extend efficient photon storage in @xmath0-type media to previously inaccessible regimes and to provide simple intuitive explanations for our optimization techniques . </S>",
    "<S> in particular , by using gradient ascent to shape classical control pulses used to mediate photon storage , we open up the possibility of high efficiency photon storage in the non - adiabatic limit , in which analytical solutions to the equations of motion do not exist . </S>",
    "<S> this control shaping technique enables an order - of - magnitude increase in the bandwidth of the memory . </S>",
    "<S> we also demonstrate that the often discussed connection between time reversal and optimality in photon storage follows naturally from gradient ascent . </S>",
    "<S> finally , we discuss the optimization of controlled reversible inhomogeneous broadening . </S>"
  ]
}