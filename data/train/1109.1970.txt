{
  "article_text": [
    "density functional theory ( dft ) @xcite is widely and routinely used for computational electronic structure simulations due to its favorable balance of speed and accuracy . however , making dft simulations scale well to the numbers of atoms required to study large complex systems such as proteins and nanostructures presents significant challenges . various linear - scaling approaches to dft have emerged over the last two decades to meet this challenge @xcite .",
    "several of these methods use basis sets which are related to plane waves and require periodic boundary conditions ( pbcs ) .",
    "the plane - wave pseudopotential approach has been developed with crystalline systems in mind , and as these are genuinely periodic , the treatment of electrostatics in the framework of pbcs was a natural choice with significant advantages . in reciprocal space ,",
    "the hartree interaction is diagonal , so the hartree potential and energy are easily obtained using fast fourier transforms ( ffts ) .",
    "furthermore , the plane - wave basis set is systematic in the sense that it provides a uniform description of space and can be improved by increasing the value of one parameter .",
    "however , the increasing use of linear - scaling dft ( ls - dft ) in large systems highlights long - standing issues in electronic structure methods relating to the treatment of electrostatic interactions , i.e.  the long - ranged parts of the coulomb interaction between electron density and electron density ( ` hartree ' terms ) , electron density and ion cores , and between ion cores , under pbcs .",
    "bulk systems can be genuinely periodic and then the influence of periodic replicas is desired ; however , to allow simulation of finite , isolated systems within pbcs , the supercell approximation is widely used @xcite .",
    "this involves the replacement of a genuinely isolated system with a lattice of periodic replicas , with vacuum ` padding ' surrounding the system to reduce the influence of periodic replicas on each other .",
    "while this is a reasonable approach , it introduces finite size errors whereby the total energy varies with supercell size .",
    "the use of a supercell is frequently a well - controlled approximation : that is to say , by increasing the size of the cell and thus the distance between periodic images , one rapidly approaches the true isolated , non - periodic limit .",
    "for example , in the case of relatively small , charge - neutral molecules without significant dipole moment , one needs to ensure simply that the charge densities of periodic replicas do not overlap to any significant extent .",
    "in other cases , the amount of vacuum padding required to reach this limit can become prohibitively large . the slow decay of the interaction of periodic replicas of a monopole charge , as @xmath0 , means that the infinite limit is impossible to reach in practice for charged systems .",
    "similarly , for highly - elongated charge - neutral systems possessing a large dipole moment ( such as in a simulation of a polar semiconductor nanorod ) , the simulation cell would likewise need to be unfeasibly large to prevent interactions between periodic images of adjacent rods .",
    "clearly the isolated limit can not always be found simply by extrapolating to infinite supercell size .",
    "this issue is exacerbated as the isolated molecules and their dipole moments become larger .    to address this problem , a large range of techniques that aim to either reduce or eliminate the effects of the pbcs on the electrostatics of grid - based electronic structure calculations",
    "have been developed over the recent years @xcite .",
    "these include methods which attempt to formulate an _ a posteriori _ correction term to add to the energy @xcite on the basis of a multipole expansion of the localised charge , having first inserted a uniform periodic background to counter any monopole charge @xcite ; methods which formulate a more complex form of ` counter - charge ' which counteracts the periodic interactions @xcite , and methods that modify the form of the interaction in real or reciprocal space in order to avoid the existence of periodic interactions in the first place @xcite .    in this paper , we examine , implement and compare three different approaches fulfilling these criteria : truncation of the coulomb interaction in real space , referred to here as ` cutoff coulomb ' ( cc ) @xcite ; the approaches of martyna and tuckerman ( mt ) and genovese _ et al . , _ which replace the periodic coulomb interaction with a minimum image convention ( mic ) approach to the coulomb potential @xcite ; and the replacement of pbcs with open boundary conditions ( obcs ) using a multigrid approach to the poisson equation@xcite .",
    "these methods are implemented and tested on a range of systems representing typical cases with challenging electrostatic properties .",
    "we compare their accuracy , convergence properties , complexity and computational overhead , and summarise the advantages and disadvantages of each .    throughout this work ,",
    "we employ linear - scaling dft with the onetep code @xcite , and while our findings will be applicable to all electronic structure methods , linear - scaling or otherwise , we focus in particular on the challenges encountered applying these methods to large , complex systems",
    ". system size can be measured either by the number of atoms @xmath1 included in the simulation , or by the volume @xmath2 of the simulation cell  the latter being particularly relevant in the case of isolated systems .",
    "onetep combines linear - scaling computational effort , in that the total computational time for a simulation of @xmath1 atoms can be made to scale as @xmath3 , with near - independence of the computational effort on the amount of vacuum padding ( i.e.nearly independent of @xmath2 at fixed @xmath1 ) , and systematic control of the accuracy with respect to the basis , akin to that of plane - wave dft .",
    "the requirements on any method used to treat electrostatic interactions are therefore that it must have systematically controllable accuracy , must not impose too high a computational overhead , and must have low - order scaling with @xmath1 and @xmath2 .",
    "the calculations in this work are performed with the onetep linear - scaling dft approach .",
    "like most linear - scaling approaches to dft , onetep uses the density matrix rather than eigenstates of the hamiltonian , representing the single - electron density matrix @xmath4 in terms of nonorthogonal localised orbitals @xmath5 and a ` density kernel ' @xmath6 as@xmath7 the einstein convention of summation over repeated greek indices will be employed throughout . using the density matrix , the electron density @xmath8 can be found from@xmath9 where onetep differs from most linear - scaling approaches is that the local orbitals , referred to as nonorthogonal generalised wannier functions ( ngwfs ) @xcite , are themselves expressed in a systematic underyling basis of periodic - sinc functions ( psincs ) , and are therefore systematically convergeable .",
    "this is achieved by a double - loop optimisation@xcite of both the coefficients @xmath10 of the psinc functions @xmath11 describing each ngwf and the elements of the density kernel @xmath6:@xmath12 where @xmath13 represents optimisation with respect to the density kernel , a generalisation of the occupancies , through:@xmath14 this results in a method with controllable accuracy and systematic convergence of total energies and forces with respect to basis size , equivalent to the plane - wave approach * @xcite * , in systems of tens of thousands of atoms * @xcite*. convergence is controlled by varying the spacing of the psinc grid , in a manner equivalent to varying a plane - wave cutoff , described by a cutoff energy @xmath15 , and by varying the cutoff radii of the spherically - truncated ngwfs , described by a sphere radius @xmath16 . to achieve true asymptotically linear scaling behaviour ,",
    "it is also necessary to truncate the range of the density kernel @xmath6 so that elements for ngwfs centred on distant atoms for which @xmath17 are set to zero .",
    "however , this latter form of truncation is only necessary in very large systems and will not be considered in this work .    this accurate and systematic approach to linear - scaling total energy calculations demands that all aspects of the calculation be carried out with high accuracy , including the long - range electrostatic part .",
    "the electrostatic energy comprises the hartree term , @xmath18 $ ] , which is the classical density - density interaction ; the local pseudopotential term , @xmath19 $ ] , which is the interaction of the electron density with the long - ranged part of the potential resulting from the ion cores ; and the interaction between the ion cores , @xmath20 .",
    "it should be noted that during the optimisation of the kernel and ngwf coefficients @xmath6 and @xmath10 , the full interacting energy is minimised by conjugate gradients process , meaning that no mixing of densities is required at any point .",
    "the problem , then , becomes one simply of evaluating @xmath18 $ ] and @xmath21(\\mathbf{r})$ ] for a given density @xmath8 ( which always integrates fo the number of electrons @xmath22 ) .",
    "to be absolutely clear on the formalism involved , we will briefly re - visit the standard approach , making careful distinctions on how the expressions and their meaning vary under pbcs and under obcs , where the potentials tend to zero at infinity . in both cases ,",
    "the hartree energy can be obtained as @xmath23 , where the hartree potential @xmath24 resulting from a density @xmath8 , is formally obtained by solving the poisson equation : @xmath25 note that we are working in atomic units , for which @xmath26 .",
    "this can in general be solved through the use of the corresponding green function @xmath27 , producing@xmath28 this result builds in the obc definition that the potential goes to zero at infinity , and can not be used directly to evaluate @xmath29 or @xmath24 under pbcs as the integral has infinite value at all @xmath30 for periodic @xmath31 .    when pbcs are used eq .",
    "( [ eq : poisson ] ) is only valid for charge distributions of zero charge per simulation cell . if the total charge on one cell @xmath32 is non - zero , eq .",
    "( [ eq : poisson ] ) is modified to the following form : @xmath33 where @xmath34 is the volume of the simulation cell .",
    "this is equivalent to the insertion of a uniform background charge density of equal and opposite charge to @xmath8 so that the total charge is zero .",
    "a periodic density will result in a periodic potential and in this case we can re - write both sides of eq .",
    "( [ eq : poisson_2 ] ) in terms of their discrete fourier transforms and rearrange to obtain @xmath35 note that eq .",
    "( [ eq : hartreeperiodic ] ) makes clear the utility of a reciprocal space approach to calculating @xmath36 , even outside of a genuinely periodic situation : the coulomb interaction is diagonal in reciprocal space , so @xmath36 can be obtained trivially from @xmath37 . after obtaining @xmath24 by an inverse fft , the integral @xmath38 can be performed only over one simulation cell to obtain the hartree energy per simulation cell .",
    "different ways of making a function obey periodic boundary conditions inside a simulation cell , demonstrated for a gaussian function .",
    "top panel : the fourier transform approach .",
    "the resulting function is the same as the one that would be obtained by a superposition ( sum ) of periodically repeated gaussians .",
    "bottom panel : the minimum image convention ( mic ) approach : the resulting function is the same as the one that would be obtained by having a single gaussian in the simulation cell and making it periodic by applying the mic . ]    in pbcs the potential is , by definition , the result of contributions from not just the @xmath8 of the home simulation cell but also from the densities of an infinite number of periodic replicas of that cell . a periodic function that can be constructed in this way",
    "is demonstrated with the example at the top panel of figure  [ fig : ft - mt ] . as we have already mentioned , the potential and the electrostatic energy diverge for non - zero total charge in the simulation cell ( or equivalently when @xmath39 is nonzero ) .",
    "to avoid this divergence one must set @xmath39 to zero for each component making up total charge density ( including the ion charges ) to ensure that the result is finite .",
    "having made this choice however , one alters the problem being studied as the potential @xmath24 obtained is that resulting not just from the infinite periodic array of @xmath8 , but also from a neutralising charge distribution , which is usually taken to be a uniform background charge over the whole cell .",
    "the same arguments apply to the other electrostatic terms , by replacing the electron density @xmath8 with the charge density of the ions , in the form of a collection of point charges . for an isolated system ,",
    "the energy of interaction of the ions is of course simply @xmath40 while under pbcs , in the presence of the neutralising background , the energy of interaction per unit cell is most commonly calculated using the ewald technique @xcite .",
    "the influence of periodic neighbours will affect ( polarise ) the charge distribution during a self - consistent electronic structure calculation .",
    "therefore , it should be immediately clear that no _ a posteriori _ approach to correcting total energies obtained from a simulation under pbcs can be completely successful in providing total energies that match those of an isolated system as even after the `` removal '' of the periodicity the density will remain distorted to what it was in the periodic calculation . here",
    "we examine three approaches that are applied within the self - consistent procedure and therefore are able to correct not only the energy but also the potential .",
    "one way to avoid the effects of pbcs which are intrinsic to the discrete fourier representation of the coulomb potential is to use a modified form for the coulomb potential .",
    "one such possibility is the use of a cutoff form of the coulomb interaction .",
    "this allows the usual fourier transform - based approach to be used , including a nominally periodic simulation cell , but truncates the coulomb potential so that it is confined within the primary simulation cell .",
    "the approach has been applied by several previous works @xcite and is implemented in several codes @xcite .",
    "the essence of the cutoff coulomb approach is that the periodic , background - neutralised coulomb potential @xmath41 is replaced with the bare coulomb interaction , truncated so as to prevent any part of the simulation cell feeling the potential from any neighbouring copy .",
    "this removes the need for the canceling background , even though the charge density is periodically repeated .",
    "some new complications arise however as the cutoff coulomb potential needs to be generated in reciprocal space .    to retain the simplicity of having an interaction that is diagonal in reciprocal space , but still avoid the influence of periodic replicas",
    ", one can use the following form for the coulomb potential @xmath42 @xmath43 is a region of a size and shape chosen such that when centered at any point @xmath30 at which @xmath24 is required ( this may be anywhere inside the main simulation cell , or it may just be anywhere where the density is nonzero ) , @xmath43 encloses all @xmath44 for which @xmath45 .",
    "the hartree potential is now obtained as the convolution of the cut - off coulomb operator and the density @xmath46 the simplest shape for @xmath43 is a sphere of radius @xmath47 , for which @xmath48 where @xmath49 is the heaviside step function . in this case , the fourier transform of the interaction is well - known : @xmath50 as this function does not have a singularity at @xmath51 the hartree potential is obtained in reciprocal space as its product with @xmath37 as in eq .",
    "( [ eq : hartreeperiodic ] ) but without the @xmath52 term as there is no longer the need to include a uniform background charge .",
    "a spherical cutoff removes the periodicity in all three spatial dimensions .",
    "if periodicity is retained in one or two dimensions there are corresponding forms for @xmath53 to account for these wire ( 1d periodicity ) and slab ( 2d periodicity ) geometries .",
    "a comprehensive study was made by rozzi _",
    "_ @xcite describing the terms of the cutoff coulomb interaction for each geometry .    in a practical calculation , the electron density @xmath54 ) on a real space grid over the original simulation cell",
    "is transferred to a grid for a larger ` padded ' cell of size @xmath55 and padded with zeros , then fourier transformed to give @xmath56 .",
    "the terms of @xmath53 are calculated for this reciprocal space grid in advance and stored , and are used to multiply the fourier components @xmath56 whenever the hartree potential is required .",
    "reverse fourier transforming these components gives @xmath57 from which the values of @xmath24 on the original cell are extracted .",
    "the corresponding cut - off form of the coulomb interaction must also be used in place of the long - ranged coulombic tail of the ion cores in the local pseudopotential @xmath58 to achieve this , @xmath59 is calculated over the whole padded grid , replacing the @xmath60 term by @xmath61 for the relevant form of cutoff coulomb interaction .",
    "this is then transformed to real space by fourier transform and extracted to the standard grid to give the required form of @xmath62 .",
    "similarly , the periodic coulomb and ewald terms in the calculation of the forces acting on the ion cores are replaced by their cutoff coulomb forms .    ,",
    "@xmath55 and cutoff radius @xmath47 required for the spherical cutoff coulomb approach .",
    "@xmath47 must be at least as large as the largest distance between any two non - zero charges in the system ( this is trivially satisfied if @xmath63 ) . in order for the periodic densities not to impinge on each other ,",
    "@xmath64 must be satisfied , where @xmath65 is the extent of the system ( again , defined as maximum distance between two non - zero charges ) in any cartesian direction . ]    the computational overhead of the method during an scf calculation compared to the traditional pbc fourier transform coulomb approach consists of three parts : transfer of the calculated density from the original grid to a larger , padded grid , calculation of the forward and backwards fast fourier transforms required for the hartree potential on the larger grid , and extraction of the calculated potential from the larger grid back to the original one .",
    "the first and last of these are in general comparatively trivial and take very little time . performing the fft on",
    "the larger grid often incurs a considerable slowdown relative to performing it on the original grid , but nevertheless , generally speaking , this part of the calculation takes a almost negligible fraction of the total computational time for large enough systems .",
    "when simulating an isolated object such as a nanocrystal or nanotube with a high aspect ratio , the geometry of the system requires that we use a simulation cell that is very long in one dimension ( the @xmath66 direction here ) and comparatively small in the other two ( @xmath67 and @xmath68 ) . performing cutoff coulomb calculations with a spherical cutoff",
    "would rapidly become impractical as the length of the system is increased , since for a sphere geometry , we would be required to embed the original cell in a padded cell with all the side lengths @xmath69 . in such cases ,",
    "we need to define a geometry for the cutoff coulomb interaction such that the cutoff range can be very long in one direction and shorter in the other two . one obvious choice for a long , thin system is to cut off the coulomb interaction on the surface of a cylinder . in this case , the integrals required to evaluate the coefficients are not analytically solvable but can be put in a form amenable to numerical evaluation .",
    "appendix a gives details on the evaluation of the fourier coefficients of the interaction for a cylindrical cutoff . with an efficient system for evaluating the terms @xmath70",
    "numerically , the interaction can be calculated rapidly in advance and reused , and simulations of isolated high aspect ratio systems can proceed within cells of feasible size .",
    "an alternative technique for avoiding periodic interactions is the class of approaches which includes those of martyna - tuckerman @xcite and genovese _ et al _ @xcite .",
    "the essence of these , which we will call minimum image convention ( mic ) approaches is that the form of the coulomb operator is modified in a way that is still periodic ( as this is unavoidable if standard ffts are to be used ) but which nevertheless removes contributions from neighbouring cells .    to see how this is achieved , we consider first the fourier transform of a function @xmath71 , defined as @xmath72 in pbcs , a discrete set of wave vectors @xmath73",
    "are used to expand functions in fourier space .",
    "these wavevectors are chosen by the requirement that they need to be commensurate with the simulation cell .",
    "therefore , given the expression for @xmath74 , the real space representation of the function @xmath71 under pbcs is the following : @xmath75 this is an exact result and shows that the fourier representation of @xmath71 in the simulation cell is a periodic function @xmath76 with the periodicity of the simulation cell .",
    "it is important to notice is that this function is constructed as a superposition of periodically repeated functions @xmath71 , one in each cell .",
    "this is demonstrated for the example of a gaussian function in the top panel of figure  [ fig : ft - mt ] , where its resulting periodic form in one simulation cell is provided , as it would be generated in real space as a fourier expansion by eq .",
    "( [ eq : f - per ] ) .",
    "this result implies that periodic interactions are unavoidable if the potential is constructed by approaches based on fourier transforms in the standard simulation cell , as pbcs are implicit in such procedures .",
    "however , mic approaches are designed to avoid the part of the coulomb interaction which produces this undesired long - ranged interaction .",
    "we have implemented the martyna - tuckerman approach @xcite , in which the fourier method is used to construct not the periodic function @xmath76 but the periodic function @xmath77 which results by making @xmath71 periodic over a single simulation cell using the mic @xcite .",
    "a similar approach can also be employed in quantum monte carlo calculations , via the `` model periodic coulomb '' approach @xcite .",
    "the distinction between @xmath76 and @xmath77 is clarified in figure  [ fig : ft - mt ] where the bottom panel demonstrates the construction of @xmath77 for the example of a gaussian function .",
    "to work with this formalism we need to determine the fourier transform @xmath78 that will produce the desired @xmath77 @xmath79 as this method is intended for dealing with the coulomb potential , from now on we will fix the function @xmath71 to be equal to @xmath80 so that we can focus on particular issues that arise in this case . in determining the form of @xmath81",
    "we need to deal with the extra complication of the singularity of the potential at @xmath82 ( short range ) and at @xmath83 ( long range ) .",
    "the coulomb potential is partitioned as @xmath84 where @xmath85 is a convergence parameter which determines the region where the transition from short to long - range terms takes place .",
    "assuming that the simulation cell is large enough so that @xmath86 only the long range form @xmath87 needs to be determined .",
    "the desired fourier transform is expressed as @xmath88+[\\tilde{\\phi}_{{\\rm long}}(\\mathbf{g})+\\tilde{\\phi}_{{\\rm short}}(\\mathbf{g})]\\nonumber \\\\   & = & \\hat{\\phi}_{{\\rm screen}}(\\mathbf{g})+\\tilde{\\phi}(\\mathbf{g})\\,\\,\\,,\\label{eq : screen}\\end{aligned}\\ ] ] where the explicit expression for @xmath89 is @xmath90\\;.\\label{eq : short - tilder}\\ ] ]    eq .",
    "( [ eq : short+long ] ) can also be further expanded to the form shown in eq .",
    "( [ eq : screen ] ) which demonstrates that the mt formalism is equivalent to augmenting @xmath91 with a `` screening potential '' @xmath92 which cuts off the interactions from the periodic images of the simulation cell . in practice , we compute @xmath81 according to eq .",
    "( [ eq : short+long ] ) and we distinguish two cases : @xmath93 and @xmath94 , which must be treated separately .",
    "the function @xmath87 for @xmath93 is obtained as @xmath95 where the above integral is computed as a sum over the simulation cell grid points as this is an exact expression for the wavevectors @xmath73 which are commensurate with the simulation cell .",
    "the above expression is the desired one as the term @xmath96 does not contain contributions from periodic images .",
    "it also does not contain a singularity at @xmath97 so the evaluation of this integral poses no difficulties . the complete expression for @xmath81",
    "is obtained as the sum of the terms eq .",
    "( [ eq : short - tilder ] ) and eq .",
    "( [ eq : long - over ] ) .    to find the @xmath94 term , we need to consider the limit of eq .",
    "( [ eq : short - tilder ] ) as @xmath73 goes to zero @xmath98\\nonumber \\\\   & = & \\frac{\\pi}{\\alpha^{2}}\\label{eq : short - zero}\\end{aligned}\\ ] ] and taking this into account , eq .",
    "( [ eq : short+long ] ) becomes @xmath99 where the integral in the above expression is again evaluated as a sum over the simulation cell grid points as the integrand does not contain a singularity at @xmath97 .    in order to use the mt potential in practical calculations ,",
    "we need to ensure that appropriate conditions are obeyed as regards the relative sizes of the simulated molecule and the simulation cell .",
    "from the example in the bottom panel of figure  [ fig : ft - mt ] we can see that the length that a simulation cell can have in any direction needs to be at least twice the length of the molecule being simulated . in the opposite case",
    "unphysical interactions will be introduced as some charges on the molecule will be experiencing the coulomb potential from other parts of the molecule ( as they should ) while other charges will experience the potential from a periodic image ( which they should not ) .    in our implementation",
    "the hartree potential is generated in reciprocal space from the electronic density as a product with the fourier transform of mt potential @xmath81 @xmath100 in a similar way , the local pseudopotential is obtained in reciprocal space as a sum of short and long range terms @xmath101 for an ion with charge @xmath102 , ( following the established electronic structure theory convention of taking the ionic potential as negative ) , the periodic coulomb component is subtracted from the pseudopotential to obtain its short range part @xmath103 and the long range part is obtained as the mic coulomb interaction @xmath104 finally the core - core interaction energy is obtained as a coulombic sum between point charge interactions in the simulation cell according to eq .",
    "( [ eq : eionion ] ) .",
    "genovese _ et al . _",
    "@xcite proposed an approach that is rather similar in principle but in practice has some different properties .",
    "they described a wavelet - based approach to calculating the mic coulomb interaction .",
    "the charge density is expanded using interpolating scaling functions @xcite of order @xmath105 ( typically @xmath106 ) .",
    "this guarantees that when a known continuous charge density is represented , the first @xmath105 moments are preserved .",
    "although most practical methods do not attempt to represent given continuous charge densities , this approach is useful when using pseudopotentials of the form proposed by goedecker _",
    "et al . _",
    "the representation of the coulomb operator is made separable by employing an expansion in terms of gaussians @xcite .",
    "the resulting one - dimensional integrals can be calculated to machine precision by exploiting the refinement relation of scaling functions and then tabulated for future use .",
    "the necessary convolution to obtain the hartree potential requires ffts on a grid that is doubled in each dimension to avoid spurious periodic interactions , but this can be performed without additional computational effort by modifying the fft algorithm to exploit the fact that the charge density is zero on the additional grid points .",
    "this latter optimisation would also benefit the cutoff coulomb approach . a representation of the hartree potential arising from the mic coulomb potential results that is essentially exact .",
    "the final possibility we will consider is to change not the form of the interactions , but that of the boundary conditions . a careful recasting of the electrostatic terms in the kohn - sham energy functional allows us to use a form suitable for calculation with open boundary conditions ( obcs ) .",
    "this is achieved by replacing the reciprocal - space evaluation of the core - core , hartree and local pseudopotential energy terms by calculations performed in real space , which assume no periodicity of the system .",
    "the core - core interaction energy is calculated as a coulombic sum of the interaction energies of point charges as in eq .",
    "( [ eq : eionion ] ) .",
    "we describe in appendix b how the local pseudopotential @xmath107 can be calculated in real space .",
    "the hartree potential @xmath24 is obtained by solving the poisson eq .",
    "( [ eq : poisson_2 ] ) in real space .",
    "the multigrid method @xcite represents an efficient approach for solving for the potential , given the charge density sampled on a regular grid and dirichlet boundary conditions on the faces on the simulation cell , @xmath108 . by using a hierarchy of successively coarser grids along with interpolation and restriction operators to transfer the problem between the grids , the multigrid approach addresses the problem of critical slowing down that plagues stationary iterative methods @xcite . for a more thorough discussion of the approach the reader",
    "is referred to refs .",
    "@xcite . in the simplest approach , second - order finite differences ( fds ) are used to approximate the laplacian in eq .",
    "( [ eq : poisson_2 ] ) . however , there is evidence @xcite that this is not sufficiently accurate for dft calculations .",
    "one way to assess the accuracy of the solution is by comparing the values of two expressions for the hartree energy , namely @xmath109 and @xmath110.\\label{eq : eh1}\\ ] ] the relative discretization error , defined as @xmath111 can then serve as a measure of the inaccuracy of the solution .",
    "figure  [ fig : pbc_mg_discrepancy ] shows how this error is unacceptably large when a second - order solver is used .",
    "the problem can be addressed by employing high - order defect correction , where higher - order finite differences are used to iteratively correct the solution obtained with a second - order solver @xcite . in this way",
    "the discretization error can be systematically reduced ( figure  [ fig : pbc_mg_discrepancy ] ) with moderate computational cost .",
    "no changes to the second - order solver are necessary .",
    "the computational cost of the multigrid approach scales linearly with the volume of the simulation cell , albeit with a large prefactor .",
    "relative discretization error eq .",
    "( [ eq : d ] ) in the hartree energy vs. the order of the finite differences used in the defect correction of the second - order solution , on the example of aspartate .",
    "an order of 2 corresponds to the uncorrected solution .",
    "smeared ions were used . ]    the multigrid method does not rely on any particular form of the dirichlet boundary conditions specified on @xmath108 , however , to obtain a potential consistent with the obcs used for the remaining energy terms , these should be @xmath112 although the evaluation of the boundary conditions is straightforward , it is computationally costly , scaling unfavourably as @xmath113 , which , for localised charge , implies @xmath114 . to ameliorate this problem ,",
    "a suitable coarse - grained approximation can be used instead of @xmath115 . combined with evaluating eq .",
    "( [ eq : obc ] ) only for a subset of points in @xmath108 and using interpolation in between , this leads to a reduction of the computational effort by 3 - 4 orders of magnitude , which brings it into the realm of feasibility .",
    "the smeared - ion formalism @xcite , where the total energy is rewritten by adding and subsequently subtracting gaussian charge distributions centred on the cores , can be used in conjunction with the multigrid approach . in this case , the poisson equation , eq .",
    "( [ eq : poisson_2 ] ) , is solved for the electrostatic potential generated by the _ total _",
    "charge density ( due to electrons and smeared ions ) . as the cores neutralize a significant fraction of the electronic charge , the magnitude of the relevant quantities ( charge density , potential ) is smaller . assuming the relative error incurred by the multigrid remains the same , this has the advantage of reducing the absolute error .",
    "the use of smeared ions , however , introduces approximations of its own . for a more detailed discussion of smeared ions the reader",
    "is referred to ref .",
    "we shall evaluate the approach with and without smeared ions .",
    "we test these methods first on small - scale , simple systems to demonstrate their equivalence in the limit that all relevant parameters are accurately converged . for this",
    ", we select a test set of small ions molecules : a phosphate ion ( po@xmath116 ) , pyridinium ( c@xmath117nh@xmath118)@xmath119 , the amino - acid salt aspartate with a charge of @xmath120 , and the amino acid lysine with a charge of @xmath121 , the neutral molecules water ( h@xmath122o ) and potassium chloride ( kcl ) . in this set ,",
    "we have thus included two cations , two anions and neutral molecules with a relatively low and a very high dipole moment , respectively .",
    "clearly , these small molecules are unchallenging calculations for linear - scaling dft , of a size below the onset of any linear - scaling behaviour , but they serve to illustrate the main convergence issues in a controllable way , since it is here possible to make the simulation cell very much larger than the molecule , within feasible computational memory requirements",
    ". illustrations are shown in figure  [ fig : small_molecules ] of this test set .",
    "each molecule was simulated in a cubic simulation cell initially of size 32.5@xmath123 , with a grid spacing of 0.5@xmath123 ( equivalent to an energy cutoff of around 827ev ) , and with all ngwf radii set to 7.0@xmath123 .",
    "the density kernel was not truncated ( all elements allowed to be nonzero ) as the systems are too small for meaningful truncation .",
    "norm - conserving pseudopotentials are employed for all the ions included here , and exchange - correlation is described by the pbe functional .",
    "we choose , throughout this work , to examine the convergence of the total energy , because although in practice one is most often interested in a quantity derived from it , such as formation or binding energies , the finite size errors made in total energies due to monopole or higher charges can not be expected to cancel between ( for example ) reactant and product states , so convergence of the total energy must be obtained individually for each system .",
    "first , we examine the option of extrapolation to infinite size from calculations performed under pbcs .",
    "the black diamonds in figure  [ fig : mp_small_molecules ] show the uncorrected total energy of each of the six molecular species , calculated under pbcs . according to makov and payne @xcite ,",
    "the total energy as a function of box size can be expected to behave approximately as@xmath124 in a cubic simulation cell of side @xmath13 , where @xmath52 is the total charge , @xmath125 is the quadrupole moment , and @xmath85 is the madelung constant , where for cubic cells @xmath126 .",
    "they suggest an approximate correction scheme based on removing the leading order @xmath13-dependent term . however , there are two options for going about this in practice",
    ".    direct calculation of quadrupole moment @xmath125 from the density is problematic and a more reliable approach is to set the monopole charge @xmath52 according to the known charge and then fit @xmath127 and @xmath125 to data using a least - squares fit to data at multiple values of @xmath13 .",
    "this produces the dotted black line in each figure .",
    "alternatively , one could take into account that for a cell containing a molecule which is to some extent extended and may be somewhat polarisable , the mean dielectric constant is not equal to precisely unity .",
    "one could therefore also allow the coefficient of the @xmath128 term to vary freely , and allow an @xmath129 coefficient as well .",
    "examining figure  [ fig : mp_small_molecules ] we see that the finite size error for those species with a monopole charge follows @xmath130 fairly well as expected . the species with only a dipole moment ( not a monopole ) display a much weaker effect , which behaves as @xmath131 . however , as the charge distribution varies with @xmath13 , and so the coefficient @xmath125 in eq .",
    "( [ eq : mp_corr ] ) depends weakly on @xmath13 , the fit to the makov - payne form is not exact .",
    "nevertheless , in the small _ charged _",
    "molecules used here , the fitted makov - payne correction achieves a fairly well - defined correction to the total energy , aligning each individual energy to the extrapolated infinite - cell - size limit even for smaller cells , producing a good fit . however , the extra freedom allowed by varying @xmath52 or introducing @xmath129 terms are seen to produce a less useful extrapolation , by fitting to noise .",
    "this can only be seen for sure by comparing to the known answer obtained under one of the correction schemes as seen below .",
    "the effect of self - consistency in these small systems is not very strong : that is to say , the rearrangement of the charge due to the influence of the potential from neighbouring images of the cell is not very great .",
    "henceforth , for makov - payne results , we will show the _ corrected _ result @xmath132 , where @xmath133 is the appropriate makov - payne choice , as this result falls on a comparable scale to the results for the other schemes , enabling visual comparison .    within the cutoff coulomb approach , we can individually vary the size of the original cell , the size of the padded cell , and the cutoff radius of the interaction .",
    "we note that the results obtained are converged to less than 1@xmath134ev / atom once the extent of the density of the molecule is less than that of the original cell .",
    "since the interaction is constructed in reciprocal space but has a sharp cutoff in real space at @xmath135 , care must be taken to include sufficient padding that the cutoff falls within a vacuum region , and the region of ` ringing ' induced by the cutoff is at least 5 - 10@xmath123 from any significant values of nonzero density .",
    "once this is achieved , residual variation of the result with @xmath135 is well below 1@xmath134ev / atom .    for the mic approach , we obtain near - identical results for our implementation of the martyna - tuckerman approach as compared to our implementation of the approach of genovese _ et .",
    "_ we thus only show the mt approach henceforth , which was rather easier to parallelise in the current methodology , even though the genovese _ et .",
    "approach is technically more sophisticated and requires less computational effort overall due to the lower padding requirements .",
    "martyna and tuckerman note that to obtain accurate reciprocal - space representation of the mic coulomb potential , a smaller grid spacing is sometimes required compared to the requirements of a comparable pbc calculation .",
    "alternatively , one can represent just the density and potential on a finer grid . taking the latter approach ,",
    "we compared grid spacings @xmath136 , @xmath137 and @xmath138 the underlying psinc grid for representation of the density and potential . while the results do show minor variations ( from 20 to 100 @xmath134ev / atom depending on the system ) , this variation is present to the same extent also in pbc calculations so should not be attributed to the mt approach itself  rather it is thought to result from changing the grid in discrete evaluation of the xc energy integral .",
    "we thus employ the standard @xmath136fine grid spacing throughout the rest of this work .",
    "we show in figure  [ fig : te_small_molecules ] the total energy of the test systems evaluated all the above methods .",
    "the cc results use the spherical cutoff of eq .",
    "( [ eq : v_cc_sphere ] ) .",
    "the results for the cc and mic methods converge rapidly with system size to effectively the same value . in very small simulation cells , below 42@xmath123 , the extent of the ` fft box '  and thus the total extent of the charge distribution  is the same as that of the simulation cell . in such cases , the simulation cell contains very small contributions to the total electron density that wrap through the periodic boundaries .",
    "therefore , even the correction schemes do not fully account for the absense of periodic interactions , and a quite strong dependence on @xmath13 at very small @xmath13 is seen .",
    "however , as soon as the simulation cell is large enough that the density is contained fully within one cell , the result is beyond that point entirely converged with system size and independent of @xmath13 .",
    "however , the obc calculations evidently produce results of a somewhat lower accuracy . for these results , several distinct sources of inaccuracy",
    "can be distinguished .",
    "first and foremost , the calculation of the local pseudopotential under obcs is performed numerically and the associated error increases with the size of the simulation cell .",
    "the reasons behind this are explained in detail in appendix b. for the systems and box sizes encountered here , the magnitude of this error is @xmath139ev / atom , thus it is only apparent in the plots for kcl , where the magnification is the highest .",
    "second , the use of a multigrid approach to solve eq .",
    "( [ eq : poisson_2 ] ) introduces a discretization error .",
    "the magnitude of this error , however , can be easily made negligible by employing high - order defect correction , and introducing smeared ions , as explained earlier in section  [ sec : open - boundaries ] , cf .",
    "[ fig : pbc_mg_discrepancy ] .",
    "third , there are approximations involved in the generation of boundary conditions eq .",
    "( [ eq : obc ] ) for the solution of eq  ( [ eq : poisson_2 ] ) . in our implementation we coarse - grain charge densities ( electronic when smeared ions are not used , or total when using smeared ions ) represented on a grid by replacing cubic blocks of @xmath140 gridpoints with a single point charge located at the centre of charge of the block ( thus , in general , not at a gridpoint ) .",
    "this is only done when evaluating the integral in eq  ( [ eq : obc ] ) . with @xmath141 ( used throughout this work ) the the prefactor for the calculation of the boundary conditions",
    "is reduced @xmath142-fold , whereas the associated error in the energy was less than @xmath143ev / atom in the worst case ( po@xmath116 in the smallest box ) and diminished quickly with increasing box sizes . for neutral systems , even with high dipole moments , this error was less than @xmath144ev / atom , again quickly diminishing with the box size .",
    "finally , the introduction of smeared ions @xcite also affects the obtained energies , as evidenced by the near - constant shifts between the results with and without smeared ions , observed in the plots .",
    "the error incurred by using smeared ions is due to the fact that certain terms in the formalism ( e.g.  the self - interaction of every smeared ion ) are calculated analytically , whereas other terms ( e.g.  the local pseudopotential energy ) are calculated by integrating the relevant quantities on a grid .",
    "thus , the terms that are meant to cancel only do so in the limit of an infinitely fine grid . for the systems discussed here ,",
    "the residual error is @xmath145ev / atom , outweighing the reduction in the other sources of error that smeared ions bring about ",
    "it is apparent from the plots that the calculations would be more accurate without smeared ions .",
    "smeared ions find use in the context of implicit solvent calculations @xcite , as they allow the dielectric continuum to polarise in response not only to the electronic density , but also to the density of the smeared cores . for calculations in vacuum involving the systems of interest here , their introduction negatively impacted accuracy .",
    "overall , one can conclude from these tests that in small systems , both the cc and mic methods can be used with confidence , once the system size is large enough that the charge density is fully contained within the appropriate box .",
    "extrapolation - based techniques can correct energies to comparable accuracy , but should be used with care and the use of excessive variational freedom in the parameters tends to worsen results . finally , when using obcs , the energy is actually expected to very slowly diverge with the size of the simulation cell , due to the inaccuracies involved in the evaluation of the local pseudopotential .",
    "this effect , compounded by the near - constant shift due to the use of smeared ions means that obc results should only be compared against other obc results rather than results from pbc calculations .",
    "to validate and compare these methods in a more realistic setting , it is necessary to examine their performance in larger - scale systems more typical of the real applications of linear - scaling dft .",
    "these will often behave very differently from very small systems , because it is usually impossible to perform the calculations in a simulation cell where the dimensions of the cell greatly exceed that of the molecule or nanostructure .",
    "furthermore , the scaling of the computational effort with system size may be very different as the balance of time spent in different parts of the calculation changes with the number of atoms .    to demonstrate the accuracy of the methods , and the computational overhead and the scaling of each of these approaches ,",
    "we have simulated two fairly large systems , each comprising around 1250 atoms , which for these systems is well above the threshold at which linear - scaling methods offer a clear advantage in terms of reduced computational effort over comparable traditional dft approaches .",
    "these systems are : a fragment of the l99a / m102q mutant of the t4 lysozyme protein @xcite , and a nanocrystal of gallium arsenide in the wurtzite structure , with hydrogen termination @xcite .",
    "figure  [ fig : large_systems ] illustrates these systems .",
    "illustration of test set of large systems ( a ) 1234-atom fragment of the l99a / m102q mutant of the t4 lysozyme protein ( b ) wurtzite - structure gaas nanorod of 1284 atoms , with hydrogen atoms terminating dangling bonds . ]",
    "illustration of test set of large systems ( a ) 1234-atom fragment of the l99a / m102q mutant of the t4 lysozyme protein ( b ) wurtzite - structure gaas nanorod of 1284 atoms , with hydrogen atoms terminating dangling bonds . ]",
    "the protein fragment has a high net charge of @xmath146 as a result of the protonation state of its residues at normal ph , and hence displays a strong finite size effect on the total energy if periodic boundary conditions are employed .",
    "this makes it difficult to calculate meaningful binding energies of ligands to its polar binding site .",
    "the distribution of the net charge is largely determined by the functional groups included and to a great extent it can be viewed as localised on these groups , so it is not expected to depend strongly on the system size : to a reasonable approximation we can treat the density of this system as fixed when we vary the size of the simulation cell .",
    "the gaas nanorod , on the other hand , has no net charge , but the underyling wurtzite structure , with no inversion symmetry , means that when truncated at each end of the rod along the @xmath147-axis , ga and as faces are exposed on opposite ends of the rod .",
    "no matter how the surface is terminated ( in the case studied here , all dangling bonds are saturated with hydrogen ) , there will be some form of charge transfer between the ends and a dipole moment along the @xmath147-axis will result . if such a rod is simulated in a box of size comparable to the rod itself under pbcs , then the rod is effectively surrounded by an inifinite array of replicas , producing a very different electric field from that of an isolated rod .",
    "indeed , unless the box is very large along all axes , the ga - terminated end of the rod will be in closer proximity to the as - terminated ends of rods in adjacent cells than to the as - terminated end on the on the same rod ( and vice versa ) , and the rod is strongly polarisable .",
    "this is clearly a very different situation from the ideal situation many correction methods assume , of a strongly localised fixed charge distribution in a box considerably larger than the charge distribution itself . because the magnitude of the dipole moment depends sensitively on the balance of charge distribution and the density of states at the polar surfaces of the rod ,",
    "its value can be affected by the field created by the charge distribution of periodic images of the rod , bringing self - consistent effects into play .    to perform these large simulations , we use in both cases a grid spacing of 0.5@xmath123 , equivalent to a plane - wave cutoff of around 827ev , and standard well - tested norm - conserving pseudopotentials for each species . for the protein system ,",
    "four ngwfs of radius 7.0@xmath123 were placed on each c , n , o and s atom , and one on each h atom . for the nanorod ,",
    "larger ngwfs were required to achieve good convergence , so @xmath148 was used , with four ngwfs on ga and as and one on h.    the total energy of the the protein fragment as a function of supercell side length is shown in figure  [ fig : catechol - pbc_cc ] .",
    "we use a series of cells up to @xmath149 in size , so as to be able to accurately extrapolate to @xmath150 .",
    "we see that on the larger scale ( top figure ) , the results for all three methods lie on apparently the same line , agreeing with the extrapolation of the makov - payne form to large @xmath13 .",
    "however , zooming in reveals two significant details : firstly , there remains considerable residual variation in the makov - payne corrected results , which do not converge to better than 0.05ev until @xmath151 .",
    "when they do so , they agree well with the mp extrapolation .",
    "the obc result suffers from considerable residual error , mostly due to the approximations involved in the evaluation of the local pseudopotential , which for the smaller box sizes cancels out , to a degree , with the error due to the approximations in the construction of the boundary conditions , but for larger boxes causes the energy to very slowly diverge .",
    "the almost constant shift in energy incurred by the use of smeared ions is approximately @xmath152ev / atom .",
    "the cc and mt results agree very well with each other , to around the 1mev level .",
    "we conclude that for monopolar systems with an approximately fixed charge distribution , the cc and mt methods are both reliable as long as the cell is made large enough for the conditions of each method to hold .",
    "convergence of total energy with cell size for t4 lysozyme fragment , showing results for cutoff coulomb ( green circles ) , minimum image convention ( orange triangles ) , open boundary conditions ( blue diamonds , filled when smeared ions were used ) and periodic boundary conditions ( red squares ) corrected using the makov - payne form ( a ) fitted by least - squares fitting to @xmath127 and @xmath153 . ]    the total energy of the the nanorod as a function of supercell side length is shown in figure  [ fig : nanorod - pbc_cc ] . here",
    "the default supercell is not chosen to be cubic as this would be particularly inefficient for such a high - aspect ratio nanostructure .",
    "we start with @xmath154 , @xmath155 as the smallest cell able to completely enclose the rod with around @xmath156 padding in all directions , and then @xmath157 and @xmath158 are scaled commensurately with @xmath159 .",
    "we see that in this case , with a highly polarisable rod , the same makov - payne fit that successfully described the dipolar systems in section  [ sec : convergence ] now fails significantly for all the cells studied here and returns an @xmath127 which does not match the @xmath160 limit , nor does it match the cc or mic results .",
    "the latter are well - converged with respect to @xmath159 , and are in good agreement with each other . however ,",
    "again the obc results are strongly size - dependent , as a result of the approximations made in order to obtain feasible computational effort at this large scale .",
    "the validity of the convergence of the approximate methods starts to break down beyond @xmath161 , resulting in significant error .",
    "convergence of total energy with cell size for gaas nanorod , showing results for cutoff coulomb ( green circles ) , minimum image convention ( orange triangles ) , open boundary conditions ( blue diamonds , filled when smeared ions were used ) and periodic boundary conditions ( red squares ) corrected using the makov - payne form ( c ) fitted by least - squares fitting to @xmath127 and @xmath153 .",
    "cc results are independent of cell size for all @xmath159 greater than the rod length .",
    "the mic approach requires @xmath162 , so results are only shown for @xmath163 . ]    by examining the behaviour of the dipole moment of the rod along its length , calculated as @xmath164 , we see immediately why this is the case : the dipole moment varies strongly with cell size because of the induced polarisation caused by the periodic images , as seen in figure  [ fig : nanorod - dipole ]",
    ". the periodic images of the nanorods are all aligned , so if the rods are very close end - to - end they will tend to increase the dipole moment .",
    "however , if they are closer side - to - side the dipole field of the periodic image ( in the opposite direction to the polarisation , as viewed outside the rod to its side ) will tend to depolarise the rod and the dipole moment will decrease .",
    "therefore there is a strong dependence of @xmath165 on both @xmath159 and @xmath166 .",
    "both of these are spurious effects when one wishes to simulate an isolated rod .",
    "we see that all three approaches , cc , mic , and obc , all correct these influences and obtain the ` correct ' isolated result for @xmath165 even for small system sizes .",
    "dipole moment @xmath165 ( see text ) as a function of cell size @xmath159 for a gaas nanorod . here",
    "the inset illustration is shown approximately to - scale with the @xmath13-axis .",
    "the exact form of @xmath167 would depend on aspect ratio , and would be difficult to accurately extrapolate to @xmath160 .",
    "the cutoff coulomb and mic approaches obtain converged results for all cell sizes large enough for their methods to hold , while the periodic results converge only very slowly to this isolated value . ]",
    "we therefore conclude that in such cases of large , polarisable systems with a strong dipole moment , there is no choice but to use an approach including the truncation of periodic images : in analogy to the study of polar thin films @xcite , a correction scheme _ must _ be employed if reliable results are to be obtained .",
    "we have demonstrated that the approaches of coulomb truncation and mic are suitable for this purpose .",
    "the inaccuracies inherent in the obc approach are particularly visible in the case of the nanorod , as the very large box sizes cause the error associated with the evaluation of the local pseudopotential to become unacceptably large .",
    "the error due to the smeared ion representation is approximately @xmath168ev / atom and for the smallest box sizes it conveniently cancels most of the error in the local pseudopotential , however for the larger simulation cells the energy inevitably diverges .",
    "although this divergence is slow ( compared to the total energy of the system ) , in the absence of a monopole charge and the associated @xmath169 term it makes the obc results unacceptably inaccurate for energies .",
    "figure  [ fig : nanorod - dipole ] shows nevertheless that for other physical properties , such as the dipole moment , it may be reliable .",
    "we have described and applied three different methods , each with a rather different theoretical basis , to the study of calculations on charged and dipolar systems using linear - scaling density functional theory under periodic boundary conditions .",
    "we have shown that with each of these methods it is possible , while staying within a nominally periodic formalism , to achieve the desired limit of equivalence of any calculated properties to those of a single isolated system .    in small systems , _ post - hoc _",
    "correction schemes are capable of extrapolating to the isolated limit on the basis of several calculations performed under pbcs , but only if simulation cells are used which are very large compared to the system being studied .",
    "the first - order term of the makov - payne correction , on its own , is inadequate for accurate results , but by fitting the coefficient of the @xmath170 term , one can acheive an accurate result for a cubic cell as long as there is not a dipole moment present of comparable physical size to the cell itself .",
    "this is clearly a highly computational expensive approach due to the need to simulate several large cells to achieve an accurate fit , and is not really practical for production calculations .",
    "fitting further coefficients of the makov - payne expansion tends to reduce the accuracy by over - fitting to numerical noise .",
    "however , we have also seen that the larger systems encountered in large linear - scaling dft calculations can behave very differently from the small molecules in the test set . in particular , there is scope in large systems for considerable long - range charge redistribution _ in response to the effect of periodic images _",
    ", so reliable extrapolation from simulations using a small unit cell are then impossible . in such situations ,",
    "one has no choice but to use a method that explicitly negates the effect of periodic images .",
    "approaches which redefine the coulomb potential to avoid periodic interactions , either by using the minimum image convention ( whether in the form proposed by martyna and tuckerman , or in the rather different form by genovese _",
    "_ et al . _ _ ) or the cutoff coulomb method , have been seen to rapidly converge to the isolated result as soon as the conditions required as outlined above are met . in the case of the mt formulation , this is that the size of the simulation cell be at least twice the extent of the electron density in a given direction , while in the genovese form , this requirement is relaxed due to the method being performed on what is effectively a padded real - space grid .    the cutoff coulomb approach is seen to produce accurately converged results for a single - shot calculation , regardless of the size of the simulation cell ( as long as it is bigger than the extent of the nonzero density ) .",
    "the only requirement is that the original cell must , for the purposes of fourier transforms , be embedded in a padded cell of sufficient size .",
    "this generally entails quite a large temporary memory requirement , and in small systems the performance of ffts can become the limiting factor on the speed of the whole calculation .",
    "however , in large systems , where the hartree calculation is generally not a significant part of the total computational effort , this is no longer an issue .",
    "finally , the use of open boundary conditions , while exact in principle , is seen to entail several further approximations in practice to render it feasible . in particular , these enter into the evaluation of the dirichlet boundary values on the faces of the simulation cell , and the use of a smeared - ion representation and the evaluation of the local pseudopotential in real space . these approximations combine to give a residual finite - size error notably larger than the other methods can achieve . furthermore , the multigrid approach to the hartree potential is computationally rather demanding and does not parallelise as well as the rest of the approach .",
    "this makes the obc approach the least efficient method presented here .",
    "however , it has one major advantage the others can not match , namely that it can be used with an nonhomogeneous dielectric constant , in the context of implicit solvent calculations . for future calculations of this type , further investigation will be required in order to develop means to calculate the boundary conditions to higher accuracy  such as by combining the multigrid obc approach with one of the other schemes here solely for the determination of boundary conditions .",
    "we noted also that two of the methods considered here can benefit from similar speedups by suitable treatment of fourier transforms padded with zeroes . in both the cutoff coulomb approach and the mic approach ,",
    "there is a need to perform a fft of the charge density to reciprocal space under conditions where the value on most of the real - space grid is known to be zero . in such cases",
    ", it has been shown that algorithms can be designed which not only significantly reduce the computational expense of such a transform but also reduce the memory usage by not explicitly storing the zeros . the mic implementation of genovese _ _ et al . _",
    "_ employs such an approach , but the martyna - tuckerman and cutoff coulomb approaches could in principle also do so .",
    "this would render them all very similar in terms of computational cost , only marginally above that of the original , uncorrected approach .",
    "n.d.m.h and j.d .",
    "acknowledge the support of the engineering and physical sciences research council ( epsrc grant nos .",
    "ep / f010974/1 , ep / g05567x/1 and ep / g055882/1 ) for postdoctoral funding through the hpc software development call 2008/2009 . p.d.h . and c .- k.s .",
    "acknowledge support from the royal society in the form of university research fellowships .",
    "the authors are grateful for the computing resources provided by imperial college s high performance computing service ( cx2 ) , and by southampton s isolutions ( iridis3 ) which have enabled all the simulations presented here .",
    "we would like to thank stephen fox for the structure of the t4 lysozyme and philip avraam for the structure of the gaas nanorod .",
    "the integral for the fourier components @xmath171 of the coulomb interaction cut off over a cylinder of length @xmath172 and radius @xmath173 can be written@xmath174 here we have taken the cylinder to be aligned along @xmath66 , and taken @xmath175 to lie in the @xmath176-plane , without loss of generality . to ensure that the resulting expression is finite and well - behaved for all non - negative values of @xmath73 , we identify four regions which must be treated separately : @xmath177 the latter three cases all allow significant simplification of the integral and will be examined first .",
    "the @xmath178 @xmath179 terms are the only ones where the integral can be performed fully analytically :    @xmath180\\big]\\end{aligned}\\ ] ]    the @xmath178 @xmath181 terms can be rendered into a well - behaved integral over @xmath66 :    @xmath182    which can be evaluated numerically with no significant difficulties    similarly , the @xmath183 @xmath179 terms can be made into a well - behaved integral over @xmath184 :    @xmath185}{\\sqrt{\\rho^{2}+x^{2}}}\\,\\mathrm{d}\\phi\\mathrm{d}x\\mathrm{d}\\rho\\\\   & = & 4\\pi\\int_{0}^{r}\\int_{0}^{l}\\frac{\\rho}{\\sqrt{\\rho^{2}+x^{2}}}j_{0}(g_{\\rho}\\rho)\\,\\mathrm{d}x\\mathrm{d}\\rho\\\\   & = & 2\\pi\\int_{0}^{r}\\ln\\left[\\frac{l+\\sqrt{\\rho^{2}+l^{2}}}{-l+\\sqrt{\\rho^{2}+l^{2}}}\\right]\\,\\rho\\ , j_{0}(g_{\\rho}\\rho)\\,\\mathrm{d}\\rho.\\end{aligned}\\ ] ]    which also remains well - behaved over its range .",
    "finally , for @xmath183 @xmath181 , the integral can not so easily be put in a 1-dimensional form for easy evaluation . however , if the cylinder length @xmath13 is first taken to infinity ( effectively making the interaction periodic in @xmath66 ) , the integrals become tractable , then the resulting answer can be convolved with a top - hat function to retrieve the desired limits on the integral .",
    "the top hat function is defined in terms of the heaviside step function:@xmath186 the transform of the coulomb interaction for the infinite cylinder would give@xmath187 so we can write the transform of the finite cylinder as@xmath188 by the convolution theorem we can write the transform of the product of two functions in real space as the convolution of these two functions in reciprocal space . using * @xmath189 * for our primed set of reciprocal space",
    "coordinates we get : @xmath190 all three integrals for @xmath191 can be done analytically :    @xmath192\\end{aligned}\\ ] ]",
    "this expression is in fact very simple to evaluate as it contains no bessel functions of higher order than 1 .",
    "these can be rapidly evaluated using accurate polynomial approximations over the domain required for the integrals .    for the step function ,",
    "the transform is well known@xmath193\\mathrm{d}x\\,\\delta(g_{\\rho})\\\\   & = & \\frac{2\\sin(g_{x}l)}{g_{x}}\\delta(g_{\\rho})\\;.\\end{aligned}\\ ] ] combining the two gives us @xmath194}{g_{x}-h_{x}}\\delta(g_{\\rho}-h_{\\rho})\\tilde{v}_{ic}(\\mathbf{h})\\,\\mathrm{d}^{3}\\mathbf{h}\\;.\\end{aligned}\\ ] ] after performing the @xmath195 integral to leave only @xmath196 , we obtain    @xmath197}{(g_{x}-h_{x})}\\\\   &   & \\times\\left[\\frac{1+g_{\\rho}r\\ , k_{0}(h_{x}r)\\ , j_{1}(g_{\\rho}r)-h_{x}r\\ , k_{1}(h_{x}r)\\ , j_{0}(g_{\\rho}r)}{g_{\\rho}^{2}+h_{x}^{2}}\\right]\\mathrm{d}h_{x}\\\\   & = & \\frac{4\\pi}{(g_{x}^{2}+g_{\\rho}^{2})}\\times\\left(1-e^{-g_{\\rho}l}(\\frac{g_{x}}{g_{\\rho}}\\sin g_{x}l-\\cos g_{x}l)\\right)\\\\   &   & + 4\\int_{-\\infty}^{\\infty}\\frac{\\sin[(g_{x}-h_{x})l][g_{\\rho}r\\ , k_{0}(h_{x}r)\\ , j_{1}(g_{\\rho}r)-h_{x}r\\ , k_{1}(h_{x}r)\\ , j_{0}(g_{\\rho}r)]}{(g_{x}-h_{x})(g_{\\rho}^{2}+h_{x}^{2})}\\mathrm{d}h_{x}\\end{aligned}\\ ] ]    only the latter integral term needs to be calculated numerically .",
    "one can see that as @xmath198 and @xmath150 , the modified bessel function terms tend to zero , leaving only the expected @xmath199 behaviour from the first part .",
    "when performing the integral numerically , the denominator damps out the oscillations rapidly so the region of integration can be relatively small .",
    "a fairly fine mesh must be used to capture the oscillations of the sinc function , but not unmanageably so for the @xmath200-vectors typically required .",
    "we used 200001 points in this work , ensuring convergence to 10 significant figures for the largest @xmath201 and @xmath13 values required .",
    "the local pseudopotential @xmath107 can be evaluated in real space as a sum of spherically - symmetrical contributions from all atomic cores @xmath202 , each located at @xmath203 : @xmath204 to generate the local pseudopotential @xmath205 due to core @xmath202 at a point @xmath206 in real space , the continuous fourier transform can be employed : @xmath207 where we have set @xmath208 .",
    "we then use the expansion of the plane wave @xmath209 in terms of localised functions , to obtain : @xmath210d{\\mathbf{g}}\\;,\\end{aligned}\\ ] ] where @xmath211 are spherical bessel functions of the first kind and @xmath212 are the real spherical harmonics .",
    "a simple rearrangement leads to @xmath213 after changing into spherical polar coordinates and applying the orthonormality property of spherical harmonics , the above expression simplifies to a spherically - symmetric form : @xmath214 in practice , it is sufficient to evaluate this expression once , for every ionic species @xmath215 , rather than for every core @xmath202 , on a fine radial grid with @xmath66 ranging from 0 to a maximum value dictated by the size of the simulation cell in use .",
    "a finite upper limit , @xmath216 , corresponding to the longest vector representable on the reciprocal grid , should be used in the integral in eq  ( [ eq : vloci ] ) , in order to avoid aliasing when transforming from reciprocal to real space .",
    "the numerical evaluation of the integral in eq .  ( [ eq : vloci ] ) is not straightforward .",
    "one source of difficulties is the oscillatory nature of @xmath217 . for larger cells ,",
    "the oscillations become so rapid that the resolution with which the reciprocal - space coefficients @xmath218 of the pseudopotential are provided , typically 0.05 @xmath219 , is not sufficient and it becomes necessary to interpolate @xmath218 , and the whole integrand , in between these points .",
    "another difficulty is caused by the singularity in @xmath218 as @xmath220 , where the behaviour of @xmath218 approaches that of @xmath221 ( where @xmath222 is the charge of the core of species @xmath223 ) .",
    "although the integral is convergent , this singularity can not be numerically integrated in an accurate fashion , and it also contributes to making the abovementioned interpolation inaccurate at low @xmath200 s .",
    "this is partially alleviated by subtracting the coulombic potential , @xmath221 , before interpolating to the fine radial reciprocal - space grid , and then adding it back but the residual numerical inaccuracy leads to a near - constant shift of the obtained real - space pseudopotential , which in turn results in errors in the total energy in the order 0.01% .    to address this problem",
    "the pseudopotential can be partitioned into a short - range and a long - range term , similarly as in eq .",
    "( [ eq : partition ] ) .",
    "this leads to @xmath224\\frac{\\sin\\left(gx\\right)}{x}g\\ , dg\\;,\\label{eq : vlocisrlr}\\end{aligned}\\ ] ] where the first term , with the error function , is the long range part and the second is the short range part and @xmath85 is an adjustable parameter that controls where the transition between short - range and long - range takes place .",
    "owing to the @xmath225 $ ] factor , the singularity at @xmath226 is avoided in the same way as in eq .",
    "( [ eq : short - zero ] ) and the integral can be accurately evaluated numerically , provided @xmath85 is large enough .",
    "smaller values of @xmath85 make the numerical integration less accurate , because the oscillations at low values of @xmath200 increase in magnitude .",
    "larger values of @xmath85 increase the accuracy of the integration , however , they lead to a faster decay of the reciprocal - space term and cause the long - range behaviour to be increasingly more dictated by the first term in the rhs of eq .",
    "( [ eq : vlocisrlr ] ) . as this term",
    "is calculated in real space , it lacks the oscillations that are expected to be present in the pseudpotential at large @xmath66 , due to the finite value of @xmath216 , causing aliasing . for this reason @xmath85 needs to be as small as possible , without negatively impacting on the accuracy of the numerical integration .",
    "the accuracy of the approach can be assessed by comparing the real - space tail of the obtained pseudopotential with the coulombic potential . since",
    "the obtained pseudopotential is expected to oscillate slightly so that it takes values above and below @xmath227 , a good measure of accuracy , which we will call @xmath228 , is @xmath229 , where the average runs over the real - space tail of the pseudopotential , from , say , 5@xmath123 to the maximum @xmath66 for which @xmath230 is evaluated .",
    "ideally , @xmath228 should be zero .",
    "numerical inaccuracy will cause a shift in @xmath230 which will present itself as a finite , non - zero value of @xmath228 .",
    "direct numerical integration of eq .",
    "( [ eq : vloci ] ) using various high order quadrature schemes results in values of @xmath228 in the order of 0.01 , which can be reduced by an order of magnitude by interpolating to a very fine radial reciprocal - space grid .",
    "subtracting the coulombic potential and integrating only the difference between @xmath218 and the coulombic potential numerically , while analytically integrating the remaining part reduces @xmath228 to about 0.0005 .",
    "application of the proposed approach eq .",
    "( [ eq : vlocisrlr ] ) yields @xmath231 for @xmath232 and @xmath233 for @xmath234 , where @xmath235 is the length of the simulation cell .",
    "the total energy is then insensitive ( to more than 0.0001% ) to the choice of @xmath85 , provided it is in a wide `` reasonable '' range of @xmath236 .",
    "56ifxundefined [ 1 ] ifx#1 ifnum [ 1 ] # 1firstoftwo secondoftwo ifx [ 1 ] # 1firstoftwo secondoftwo `` `` # 1''''@noop [ 0]secondoftwosanitize@url [ 0 ]",
    " + 12$12  & 12#1212_12%12@startlink[1]@endlink[0]@bib@innerbibempty link:\\doibase 10.1103/physrev.136.b864 [ * * , ( ) ] link:\\doibase 10.1103/physrev.140.a1133 [ * * , ( ) ] @noop * *",
    ",   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) link:\\doibase 10.1103/physrevb.12.5575 [ * * ,   ( ) ] @noop * * ,   ( ) @noop * * ,   ( ) @noop _ _  ( , ) link:\\doibase 10.1088/0022 - 3719/18/5/005 [ * * ,   ( ) ] link:\\doibase 10.1103/physrevb.51.4014 [ * * , ( ) ] link:\\doibase 10.1103/physrevb.56.14972 [ * * ,   ( ) ] link:\\doibase 10.1103/physrevb.60.15476 [ * * ,   ( ) ] link:\\doibase 10.1103/physrevb.59.12301 [ * * ,   ( ) ] link:\\doibase 10.1063/1.477923 [ * * , ( ) ] link:\\doibase 10.1103/physreve.62.1390 [ * * ,   ( ) ] link:\\doibase 10.1103/physrevlett.84.1942 [ * * ,   ( ) ] link:\\doibase 10.1139/p03 - 078 [ * * ,   ( ) ] link:\\doibase    10.1103/physrevb.73.205119 [ * * ,   ( ) ] link:\\doibase    10.1063/1.2335442 [ * * ,   ( ) ] link:\\doibase 10.1103/physrevb.73.233103 [ * * ,   ( ) ] link:\\doibase 10.1103/physrevb.74.235209 [ * * ,   ( ) ] link:\\doibase 10.1063/1.2754685 [ * * ,   ( ) ] link:\\doibase 10.1103/physrevb.77.115139 [ * * ,   ( ) ] link:\\doibase    10.1103/physrevb.77.245102 [ * * ,   ( ) ] link:\\doibase 10.1103/physrevb.30.1844 [ * * ,   ( ) ] @noop * * ,   ( ) @noop _ _ ( ,  )  p. @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) link:\\doibase 10.1063/1.2796168 [ * * , ( ) ] link:\\doibase 10.1103/physrevb.83.195102 [ * * ,   ( ) ] @noop * * ,   ( ) link:\\doibase 10.1063/1.3492379 [ * * ,   ( ) ] @noop _ _  ( , ) link:\\doibase 16/s0010 - 4655(02)00686 - 0 [ * * , ( ) ] link:\\doibase 10.1002/pssb.200642067 [ * * ,   ( ) ] link:\\doibase    10.1103/physrevb.55.r4851 [ * * ,   ( ) ] link:\\doibase 10.1103/physrevb.59.1917 [ * * ,   ( ) ] link:\\doibase 10.1007/bf01889598 [ * * ,   ( ) ] link:\\doibase 10.1103/physrevb.54.1703 [ * * ,   ( ) ] link:\\doibase 10.1109/78.258102 [ * * ,   ( ) ] _ _ ,  @noop ph.d . thesis ,   ( ) link:\\doibase 10.1103/physrevlett.72.1240 [ * * , ( ) ] @noop * * ,   ( ) @noop * * ,   ( ) link:\\doibase    10.1209/0295 - 5075/95/43001 [ * * ,   ( ) ] @noop * * ,   ( ) link:\\doibase 10.1103/physrevb.83.241402 [ * * ,   ( ) ]"
  ],
  "abstract_text": [
    "<S> we present a comparison of methods for treating the electrostatic interactions of finite , isolated systems within periodic boundary conditions ( pbcs ) , within density functional theory ( dft ) , with particular emphasis on linear - scaling ( ls ) dft . often , pbcs are not physically realistic but are an unavoidable consequence of the choice of basis set and the efficacy of using fourier transforms to compute the hartree potential . in such cases </S>",
    "<S> the effects of pbcs on the calculations need to be avoided , so that the results obtained represent the open rather than the periodic boundary . </S>",
    "<S> the very large systems encountered in ls - dft make the demands of the supercell approximation for isolated systems more difficult to manage , and we show cases where the open boundary ( infinite cell ) result can not be obtained from extrapolation of calculations from periodic cells of increasing size . </S>",
    "<S> we discuss , implement and test three very different approaches for overcoming or circumventing the effects of pbcs : truncation of the coulomb interaction combined with padding of the simulation cell , approaches based on the minimum image convention , and the explicit use of open boundary conditions ( obcs ) . </S>",
    "<S> we have implemented these approaches in the onetep ls - dft program and applied them to a range of systems , including a polar nanorod and a protein . </S>",
    "<S> we compare their accuracy , complexity , and rate of convergence with simulation cell size . </S>",
    "<S> we demonstrate that corrective approaches within pbcs can acheive the obc result more efficiently and accurately than pure obc approaches . </S>"
  ]
}