{
  "article_text": [
    "gas - dynamical and radiative processes couple with gravitational instability to play a crucial role in the formation of galaxies . in",
    "hierarchically clustering universes galaxies are formed via the dissipative cooling and condensation of gas within dark matter halos .",
    "the analytic understanding of galaxy formation within this framework is well developed ( e.g. white 1996 and references therein ) .",
    "it is most practically embodied in the so - called ` semi - analytic ' ( sa ) models .",
    "these implement simple analytic treatments of baryonic processes within a model for the nonlinear development of the dark matter distribution to give monte carlo realisations of the evolution of the galaxy population ( white & frenk 1991 ; lacey & silk 1991 ; kauffmann , white & guiderdoni 1993 ; cole et al .",
    "1994 ; somerville & primack 1998 ) .",
    "a full description of galaxy formation requires treatment of many complex physical processes . the huge dynamic range between the scales on which individual stars form and those of a ` typical ' region of the universe makes it impossible to simulate all relevant processes together .",
    "some kind of ` sub - grid ' model must therefore be adopted to describe the unresolved physics of star - formation and feedback within a dynamical treatment of larger scale evolution .",
    "semi - analytic modelling adopts this philosophy not only on small scales , but also on scales where the evolution can , at some computational cost , be simulated directly . in sa models",
    "the merging history of dark matter halos is taken as the principal dynamical input .",
    "the following additional key physical processes are then included : ( 1 ) shock heating and virialisation of gas within halos , ( 2 ) radiative cooling and condensation of this gas , ( 3 ) star formation in the cold dense gas , ( 4 ) energy feedback from supernovae and stellar winds , ( 5 ) metal enrichment , ( 6 ) stellar evolution , and ( 7 ) galaxy merging .",
    "early work by white & rees ( 1978 ) and white & frenk ( 1991 ) showed that regulation of star formation by feedback is necessary to avoid substantial over - production of stars at early times and in small objects , i.e. at least the first four of the above processes must be taken into account to obtain a realistic model .",
    "more recent semi - analytic models have incorporated all these processes in a consistent manner into monte carlo halo merger trees constructed using the ( extended ) press - schechter theory ( kauffmann et al .  1993 ; cole et al .",
    "1994 , 2000 ; kauffmann , nusser & steinmetz 1997 ; somerville & primack 1998 ; benson et al .",
    "the output from such models has been tested against a wide range of observational data , showing that many properties of the observed galaxy population can be successfully reproduced .",
    "a recent development has been to replace the monte carlo merger trees with trees constructed directly from the output of high resolution @xmath0-body simulations ( kauffmann et al .  1999 ,",
    "hereafter kcdw ) .",
    "this removes uncertainties related to the press - schechter halo merger model and allows the evolution of the galaxy distribution to be followed explicitly and in detail . with the high resolution of springel et al .",
    "( 2001b , hereafter swtk ) it is also possible to follow the merging of the brighter galaxies explicitly , thus removing item ( 7 ) from the list of processes to be treated by semi - analytic recipes .",
    "although the models underlying these recipes are physically plausible and the resulting galaxy populations are in reasonable agreement with observation , the validity and the limitations of each model remain unclear . among the seven ingredients listed above , the first two are well understood and can be incorporated in hydrodynamic simulations in a direct and transparent manner .",
    "recently , benson et al .  ( 2001 ) studied the evolution of cooling gas associated with galaxy formation both in smoothed particle hydrodynamics ( sph ) simulations and in a semi - analytic model using monte carlo merger trees . comparing the output of the two models",
    ", they found reasonable agreement in properties such as the global fractions of gas in cold , hot and uncollapsed phases , and the amount of cold gas predicted in a dark halo as a function of its mass .",
    "their results suggest that the assumptions of semi - analytic models give an appropriate description of the cooling of gas onto ` protogalaxies ' . since the monte carlo merger histories they assign to each halo in their simulation are unrelated to its actual formation history , it is unclear , however , whether gas behaves as predicted by the sa model on an object - by - object basis .    in this paper",
    "we address this issue using a set of numerical simulations of rich galaxy cluster formation .",
    "we carry out two sph simulations including radiative cooling , but excluding star - formation and the related feedback .",
    "the simulations differ only in the specific implementation of sph employed .",
    "we compare the ` galaxy ' populations of these simulations with those produced by implementing a stripped - down sa model in which star - formation and feedback are also suppressed .",
    "this comparison tests for differences arising from the very different treatments of hydrodynamics and cooling , and is unaffected by differences in the recipes which the sa and sph approaches typically use for star formation and feedback . because both techniques follow the dark matter distribution using the _ same _ @xmath0-body particle representation , we are able to compare the galaxy populations on an object - by - object basis",
    ".    the remainder of the paper is organised as follows .",
    "sections 2 and 3 describe our sph simulations and present their results . in section 4",
    ", we explain our semi - analytic modelling highlighting features included specifically for the present study .",
    "we study and compare the effective resolution of our sa and sph techniques in section 5 . in section 6 , we describe how we match the galaxies formed by the two techniques , and we show how their masses compare .",
    "we discuss the implications of these results in our concluding section 7 .",
    "we work with a flat @xmath1-dominated cold dark matter universe , with matter density @xmath2 , cosmological constant @xmath3 and expansion rate @xmath4 km  s@xmath5mpc@xmath5 .",
    "we carry out further simulations of the cluster studied by swtk and yoshida et al .",
    "( 2000a , b ) which is the second most massive cluster in the gif simulation of kcdw . as in these earlier papers ,",
    "we resimulate the cluster with a multi - mass technique in which only the region immediately surrounding the object of interest is represented at high resolution ; the rest of the simulated volume is followed at much lower resolution and serves merely to provide the correct tidal gravitational field on the high resolution region .",
    "within this region we split each particle into a dark matter particle of mass @xmath6 and a gas particle of mass @xmath7 , and we set the gravitational softening length to be @xmath8kpc .",
    "the simulations are carried out with the parallel tree @xmath0-body / sph code gadget ( springel , yoshida & white 2001a ) ; further details are presented in yoshida ( 2001 ) . during the simulations , we dump 50 snapshots of the particle data spaced logarithmically in the cosmic expansion parameter from redshift @xmath9 to @xmath10 .",
    "we use these outputs for identifying and tracing galaxies , and also for constructing dark matter halo merger trees for use in the semi - analytic simulation . for the latter we throw out the gas particles and increase the mass of each dark matter particle to @xmath11 .",
    "we implement gas cooling in the sph part of the code in a similar manner to that in katz , weinberg & hernquist ( 1996 , hereafter kwh ) . as in kwh",
    "we compute the abundances of ionic species by assuming collisional equilibrium for a gas of primordial composition consisting of 76% hydrogen and 24% helium .",
    "we call these simulations ` s0-sph ' .",
    "they include a time - dependent uniform uv background radiation , as in dav et al .",
    "( 1999 ) , but its effect , especially on the destruction of small objects , is very small at the resolution we are using ( weinberg , katz , & hernquist 1997 ) .",
    "hence the inclusion of the uv heating is not important for the analysis presented in this paper .",
    "we fix a minimum sph smoothing length which prevents the gas smoothing length from dropping below a quarter of the gravitational softening length .",
    "we set the number of neighbouring particles in the sph smoothing kernel , @xmath12 , to be 32 .",
    "this smoothing in the sph simulation poses an effective resolution limit for gas cooling ; gas cooling can take place efficiently only within objects that become dense enough and which contain enough gas particles .",
    "we will discuss this resolution effect in more detail in sections 4 and 5 .",
    "an important feature of our simulations is that we employ two different implementations of sph .",
    "one is an energy- and momentum - conserving scheme based on taking geometric means of the pairwise hydrodynamic forces between neighboring particles ; it is very similar to that employed by kwh , weinberg et al .",
    "( 1997 ) , dav et al .",
    "( 1999 ) and white , hernquist & springel ( 2001 ) among others .",
    "the other is a novel formulation of sph recently suggested by springel & hernquist ( 2001 ) , which manifestly conserves momentum , energy and entropy in non - shock regions , even when adaptive smoothing lengths are employed . in a series of numerical tests , springel &",
    "hernquist showed that several of the commonly employed formulations of sph can give rise to an over - cooling phenomenon which results from spurious losses of specific entropy in poorly resolved cooling flows .",
    "this effect is particularly strong when the geometric symmetrisation of the hydrodynamical forces is employed .",
    "our two simulations highlight the extent to which such differences in the formulation of sph can affect the final result . in the following ,",
    "we concentrate on results from the simulation carried out with the new ` entropy ' scheme , but we stress the major points at which they differ from those found using the geometric averaging technique . note that while we will often refer to the latter technique as the ` conventional ' sph technique , it suffers from the overcooling problem more severely than other ` conventional ' techniques which have also been used in studies of galaxy formation ( e.g. benson et al .",
    "pearce et al .",
    "( 2001 ) found that ignoring cold dense particles in the sph density estimate for hot particles successfully reduces the over - cooling of gas .",
    "although we do not employ this phase - decoupling technique in our sph simulations , the problem of density overestimates for hot particles in the vicinity of the condensed cold phase is much alleviated in the new entropy scheme ( see figure 8 in springel & hernquist , 2002 ) , so the effect of the decoupling is expected to be small in our simulations .",
    "we begin by presenting the basic properties of our simulated cluster .",
    "the virial radius of the main cluster at the present epoch is @xmath13mpc , and the corresponding virial mass is @xmath14 .",
    "we define the virial radius @xmath15 as the radius of the sphere centred on the most bound particle of the fof group having overdensity 200 with respect to the critical density .",
    "the virial mass @xmath16 is then the enclosed mass within @xmath15 .",
    "figure  [ fig_cool1 ] shows the projected gas mass distribution around the main cluster .",
    "bright clumps seen in figure  [ fig_cool1 ] are groups of cold gas particles , which we will later define as ` galaxies ' .",
    "the diffuse component in the figure consists mainly of a shock - heated hot gas in and around the cluster .",
    "=    figure  [ fig_cool4 ] shows the distribution of gas in the thermodynamic phase plane . the cold , dense gas particles appear clearly as a narrow tail in the plot , whereas the shock - heated gas and the adiabatically cooled , unshocked gas appear in the upper and in the lower left portions , respectively .",
    "the rectangular box approximately separates out the gas particles in the ` galaxy ' phase . in practice",
    "we identify galaxies by linking the cold gas particles using the standard fof technique with a small linking length .",
    "we describe our galaxy identification in the next section .",
    "in this section we show the distribution and the properties of gas in the dark halos in the simulations .",
    "we locate the dark halos by running a fof group finder with linking parameter @xmath17 .",
    "we assigned virial radii and virial masses to the dark halos in the manner described above .",
    "we found 833 dark halos with virial mass larger than @xmath18 at the present epoch .",
    "in figure  [ fig_cool3 ] we plot the total gas mass and cold gas fraction against the host halo mass in the ` entropy ' version of the s0-sph simulation .",
    "gas quantities are calculated within a sphere of radius @xmath15 .",
    "we define the cold gas fraction as the total mass of all the cold ( @xmath19 k ) gas divided by the total gas mass within the halo .",
    "three sets of plots for the outputs at z=0 , 1 , and 2 , are shown in figure  [ fig_cool3 ] . in the top panels the solid line indicates the global mean baryon fraction in the simulation , @xmath20=0.15 .",
    "a tight correlation is seen , showing that the baryon fractions of the halos are very close to the universal baryon fraction . at mass scales",
    "larger than @xmath21 ( corresponding about 80 dark matter particles ) , the scatter is very small . at early times",
    ", there is a clear tendency for the gas fraction to lie slightly above the global fraction .",
    "this is a consequence of the rapid loss of pressure support behind the accretion shock when cooling is efficient .",
    "the bottom panels in figure  [ fig_cool3 ] show that the cold gas fraction is a decreasing function of halo mass and shows relatively little scatter above halo masses of @xmath22 . in this regime",
    "the cold gas mass fraction at given halo mass becomes progressively _ lower _ at lower redshift .",
    "this behaviour is expected as a result of the decrease in cooling efficiency at lower redshift produced by the lower gas density within halos .",
    "it confirms that the new sph implementation substantially reduces over - cooling of gas . in the simulation carried out with the conventional sph implementation",
    ", we found the opposite behaviour ; the cold gas mass fraction gets progressively higher at lower redshift . this ( mis-)behaviour agrees with the experiments of springel & hernquist ( 2001 ) who showed that an sph formulation with geometric symmetrisation can substantially overestimate the cooling rates in the centres of halos , leading to the accumulation of too much cold gas .",
    "the cold gas fractions are near 80% for most halos at @xmath10 in our simulation using this scheme ,",
    "much larger than the values plotted in figure  [ fig_cool3 ] .",
    "even for the main cluster halo itself , the cold gas fraction is overestimated by a factor of 2 .",
    "although the small scatter and the systematic trends in cold gas fraction seen above a halo mass of @xmath21 in figure  [ fig_cool3 ] are in good agreement with simple semi - analytic models ( e.g. white & frenk 1991 and section 5 below ) , the increase in scatter below @xmath22 is unexpected .",
    "this is a consequence of resolution problems in the sph simulation .",
    "when a halo contains relatively few gas particles , the smoothing inherent in the sph technique reduces the estimated gas density to the point where the cooling rate is seriously underestimated .",
    "as is clearly visible in the figure , the effect is worse at @xmath10 than at higher redshifts because of the lower mean cooling rates at later times .",
    "we will return to the effective resolution limit implied by this problem in section 5 .    at redshift @xmath23 and particularly at @xmath24 , another interesting effect is visible at small masses in figure  [ fig_cool3 ] .",
    "as the typical cold gas fraction approaches 100% the cold gas mass within halos rises systematically above the nominal maximum given by the halo mass times the global baryon fraction . at the lowest masses this effect is about a factor of two .",
    "although this may , in part , be due to sph artifacts in the strong cooling and small particle number limit , much of the effect is undoubtedly real . when cooling is efficient shocks are unable to raise infalling gas to the virial temperature of a halo , no significant hot gas atmosphere is formed and the accretion shock moves in close to the halo centre . the total gas mass within the nominal halo radius then increases since pressure effects no longer impede infall at larger radii . we note in passing that this effect is not correctly included in the semi - analytic model we discuss below , which assumes that the maximum mass which can cool in any halo is @xmath25 .",
    "we close this section by mentioning a different cooling problem .",
    "as noted above , it has been known for more than twenty years that feedback of some kind is needed in hierarchical cosmogonies to prevent excessive cooling and star - formation at early times .",
    "katz & white ( 1993 ; see also evrard , summers & davis 1995 ; suginohara & ostriker 1998 ) demonstrated that such over - cooling occurs in hydrodynamic simulations of cdm universes provided these are able to resolve the relevant early phases of evolution .",
    "subsequent work by lewis et al .",
    "( 2000 ) and pearce et al .",
    "( 2001 ) confirmed that the cold gas fraction indeed increases with increasing resolution . in our simulation ,",
    "the cold gas fraction of the main cluster is about 23% at the present epoch ( see the rightmost point in figure  [ fig_cool3 ] ) .",
    "although this value is substantially smaller than the 55% which we found in the simulation with the conventional sph implementation , it still appears too high to be compatible with observational constraints on the fraction of baryons locked up in stars in rich clusters ( balogh et al .",
    "this again confirms that efficient feedback mechanisms are required to regulate cooling and star formation in realistic models . nevertheless , since our aim is to compare the treatment of gas cooling in sph and sa simulations , this ` cooling catastrophe ' is not directly relevant to our analysis .",
    "= = 0.95    = = 0.95    = = 0.95      in our two versions of the s0-sph simulation , we define cold , dense clumps of gas as ` galaxies ' .",
    "we locate these objects by running a fof group finder over the gas particles with a very small linking parameter , @xmath26 .",
    "we note that the choice of linking parameter is not particularly critical ; adopting a slightly smaller or larger value makes only a minor difference to the number of galaxies and their masses .",
    "we also checked that for our chosen value most cold , dense particles in the more massive halos are linked into galaxies , and multiple galaxies within a single halo are successfully separated into discrete objects . in the following we require a clump to contain ten or more gas particles to be considered as a galaxy , corresponding to a minimum mass of @xmath27 .",
    "we refer to such objects as sph galaxies , in contrast to the sa galaxies defined using the semi - analytic model .",
    "the mass of an sph galaxy is simply the mass of its grouped particles .",
    "we note that it may not be appropriate to regard @xmath28 sph particles as a distinct group , where @xmath29 , because of the sph smoothing with @xmath12 particles .",
    "nevertheless we include such small groups in our sph galaxy catalogue , because , at early epochs , many of them are progenitor galaxies with which we can keep track of the formation history in detail .",
    "we give an extensive discussion on the resolution of our sph simulation in section 5 .",
    "in the galaxy formation models of kcdw and of swtk , outputs of high resolution n - body simulations are used to define populations of dark halos and to follow their formation and evolution .",
    "although the merging of halos is followed explicitly by these simulations ( as is also the evolution of halo substructure in swtk ) , all aspects of the evolution of the baryonic component are included using simple , physically motivated , recipes taken from earlier semi - analytic models . in this paper we follow the procedures of kcdw , simplified to exclude processes other than gas cooling and ` galaxy ' merging .",
    "this eliminates the free parameters normally adjusted in sa models , since these are associated with star formation and feedback .",
    "the standard cooling model contains no free parameters ( see below ) and the merger model of kcdw implies merger rates in good agreement with those seen in simulations where merging can be followed explicitly ( swkt ) .    for each dark halo in each simulation output , we assign the following related halo properties : the virial radius @xmath15 , the virial mass @xmath16 , and the circular velocity @xmath30 .",
    "these halos are linked to their progenitors in the previous output to build up merger history trees within which the growth of galaxies is followed . notice that since we use the dark matter distribution from the @xmath0-body / sph simulation to set up these trees , there is an exact correspondence between the halos and their merger histories in our sa and sph simulations .",
    "any differences in the resulting galaxy populations must therefore be produced purely by differences in how gas dynamics , cooling and galaxy merging are handled .",
    "we now turn to the assumptions used to model gas cooling .",
    "gas cooling is treated as in white & frenk ( 1991 ) .",
    "we assume that the gas in a dark halo is shock - heated to the virial temperature and is initially distributed like a singular isothermal sphere with density profile @xmath31 .",
    "we define the local cooling time of the gas , @xmath32 , as the ratio of the thermal energy density of the gas to the cooling rate per unit volume : @xmath33 where @xmath34 is the mean molecular weight , @xmath35 is the proton mass , @xmath36 is the electron number density , @xmath37 is the gas temperature , which we approximate with the virial temperature of the halo @xmath38 k , and @xmath39 is the cooling rate .",
    "we employ the tabulated cooling functions of sutherland & dopita ( 1993 ) .",
    "we define a cooling radius @xmath40 such that the cooling time at this radius is equal to the time for which the halo has been able to cool quasi - statically .",
    "we approximate this time with the halo s dynamical time @xmath41 . the cooling rate for the gas within this cooling radius",
    "is then given by @xmath42 in reality , cooling rates depend strongly on the metallicity of the gas , but for simplicity ( and consistency ) we use zero metallicity cooling functions in both our sa and our sph models .",
    "we note that this cooling model is extremely simplified and corresponds quite poorly to the detailed dynamics seen in hydrodynamic simulations of the evolution of galaxy - sized objects in a cdm universe .",
    "the good agreement which we find below with the gas accumulation rates in our best sph simulation is thus quite surprising .",
    "our sph simulations do not include star formation or feedback processes . in order to make a direct comparison , we remove these processes also from our semi - analytic simulation . in this stripped - down model , star formation and feedback",
    "are switched off , and no cooling cut - off is implemented in massive halos ( c.f .",
    "kcdw ) . as in the sph simulations , galaxies in our stripped - down sa simulation do not possess properties such as luminosity or morphological type .",
    "they are defined purely by their mass of cold gas , their positions and velocities , and their formation histories .",
    "there are only two populations of galaxies in this model .",
    "each dark halo carries exactly one _ central _ galaxy which is identified with the most - bound particle of the halo .",
    "many halos have also one or more _ satellite _ galaxies .",
    "satellites are galaxies that were central galaxies in earlier outputs , but whose host halos merged at some time into the larger halo where they now reside .",
    "satellites are identified with the particle to which they were attached when they were last a central galaxy .",
    "they are assumed to merge with the central galaxy of their new halo on a dynamical friction timescale ( see kcdw ) .",
    "in this implementation , only the central galaxy accretes new gas that cools within the halo ; hence the mass of a satellite galaxy stays constant .",
    "in this section we discuss the effective resolution limits of our two simulation techniques .",
    "the principal goal of our paper is to compare the predictions of these techniques for the cooling of gas onto protogalaxies , but before this is possible we must establish the range of protogalaxy masses for which the predictions of each technique are independent of the resolution parameters  particle mass , force softening , sph smoothing , timestep  employed in the corresponding simulation . with this in mind , we define the effective resolution of a simulation to be the minimum galaxy mass for which the simulated galaxy population has identical properties to that in a much higher resolution simulation of the same system _ carried out with the same technique_. notice that with this definition there is no guarantee that the galaxy populations produced by simulations using our two techniques will agree above the larger of their two resolution limits , although we find below that they do .",
    "notice also that for the physical processes included here  cooling , but no star formation or feedback  there is reason to worry that our definition may fail ; as the resolution of a simulation is increased the masses of _ all _ galaxies might increase systematically towards their maximal possible values , corresponding to the total baryon content of their individual halos .",
    "we find below that a ` cooling catastrophe ' of this type does not , in fact , occur .",
    "we begin by studying the resolution limit of our sa simulation technique .",
    "this is relatively straightforward because swtk have already carried out a series of higher resolution simulations of the physical system studied here . for their highest resolution model , s4 ,",
    "the mass resolution is about 250 times higher and the spatial resolution about 50 times higher than in our s0-sa simulation .",
    "we have run our ` stripped - down ' sa modelling on swtk s s4 simulation to derive a galaxy population which can be compared directly with those of this paper .",
    "figure  [ massfunc ] compares the cumulative mass functions of the two sa simulations . above a mass of about",
    "the agreement is good with the masses of galaxies in the high resolution simulation lying slightly below those of galaxies in s0-sa . at lower mass",
    "the mass function of s0-sa shows a clear change in slope .",
    "this is easily understood .",
    "our halo merger trees keep track of all halos with 10 or more particles .",
    "the maximum mass of a galaxy which could form in an unresolved halo is thus given by the global baryon fraction times the mass of a 9 particle halo .",
    "this is @xmath44 , slightly larger than the mass at which we see the change in slope .",
    "the convergence tests of swtk indicate similar resolution limits for their full semi - analytic model .",
    "it is important to note the very steep mass functions in figure  [ massfunc ] which are a consequence of the absence of feedback .",
    "the total amount of gas cooled in the sa simulations is a strong function of resolution , rising from 16% in s0-sa to 25% in s4-sa .",
    "( we have not attempted to include the effects of an ionizing background in the sa modelling , which would reduce the strength of this effect . )",
    "it turns out , however , that the additional gas which cools off in small objects does not reduce the reservoir of diffuse gas enough to substantially affect the masses of the larger objects which form later .",
    "similarly merging is not efficient enough for the increased supply of low - mass merger candidates to cause a substantial increase in the masses of larger systems .",
    "thus , although there is no formal convergence as resolution is increased , the properties of the higher mass galaxy population vary very little .",
    "it is more difficult to study the mass limit for our sph model , because we can not carry out a similar convergence test to that we decribed above for the sa models .",
    "our decision to impose a 10 particle lower limit on our sph ` galaxies ' clearly imposes a lower bound of @xmath45 on the resolution limit , but figure  [ fig_cool3 ] shows that the effective resolution limit is substantially higher . below a _ halo _",
    "mass of about @xmath21 many halos contain substantially less cold gas than expected and some contain none at all .",
    "this is a consequence of the smoothing associated with sph density estimates which leads to an underestimate of the cooling in systems where the number of gas particles is comparable to that required within the sph smoothing kernel .",
    "we plot the @xmath10 cumulative galaxy mass function for the ` entropy ' version of our s0-sph simulation in figure  [ massfunc ] . above @xmath46",
    "this function agrees well with that of our two sa simulations , except for a slight shift to higher mass .",
    "below @xmath46 the mass function has a clear change in slope .",
    "we take this mass scale as a conservative estimate for the mass resolution of our sph simulation .",
    "this effective resolution limit in our s0-sph simulation is about an order of magnitude larger than the corresponding limit for our s0-sa simulation . in light of this",
    "a robust comparison of sa- and sph - galaxies can only be made at masses larger than about @xmath18 .",
    "=    = 0.8 = 0.8",
    "we now turn to a direct comparison of the properties of the individual objects which form in our sa and sph simulations .",
    "the dark matter distributions of the two simulations are identical at all times , by construction , and as a result it is possible to identify individual galaxies in the two models almost without ambiguity .",
    "we begin by comparing the masses of the central galaxies .",
    "every halo with at least 10 particles is automatically assigned a central galaxy in our semi - analytic model ( see section 4.2 ) whereas defining the central galaxy in the sph simulation is less clear . for simplicity",
    ", we define the most massive sph - galaxy within a halo to be its central galaxy , and we tag other galaxies as satellites . note that this definition corresponds closely to that used in the sa model for halos with multiple galaxies ( see kcdw ) .    in figure  [ fig_cool5 ]",
    "we compare the distributions of sa- and sph - galaxies more massive than @xmath47 in a cubic region , 15@xmath48mpc on a side , centred on our cluster .",
    "the two distributions are very similar , and an almost one - to - one correspondence can be found .",
    "most of these galaxies are the central galaxies of their dark matter halos except in the main cluster itself where there are many satellites .",
    "thus the galaxy distribution largely reflects that of the centres of the massive halos .",
    "most differences arise when galaxies lie on opposite sides of our mass threshold in the two samples .    in figure  [ fig_cool7 ]",
    "we plot sa mass against sph mass for the central galaxies of all halos with 10 or more dark matter particles .",
    "halos with no sph - galaxy are shown on the left of this diagram at an arbitrary sph mass . above our sph",
    "effective resolution limit ( @xmath49 ) the central galaxy masses predicted by our two techniques agree extremely well over more than two orders of magnitude in mass .",
    "below this limit the masses of the sph - galaxies are systematically low and many halos contain no sph - galaxy even though the corresponding sa - galaxy mass is well above @xmath50 , the limit imposed by our requirement that an sph - galaxy contain at least 10 particles .",
    "we emphasize that the agreement above @xmath18 limit is remarkable considering the crudity of the cooling model used in the sa treatment and the fact that our two implementations of sph lead to galaxy masses differing systematically by a factor of two .",
    "( in this section we only show results from the ` entropy ' implementation . )",
    "it is also interesting to see the _ evolution _ of the masses in two models . in figure  [ massevolution ]",
    "we compare the masses of the three most massive galaxies at @xmath10 and their progenitors at earlier epochs .",
    "it is clearly seen that even the time evolution is remarkably similar in the two models .",
    "small deviations from the perfect linear relation at output instants are due to time offset of satellite merging onto the central galaxy , because of the simplified prescription of satellite merging in our sa model .",
    "= =    = =    = =    a similar comparison for satellite galaxy masses is shown in the bottom panels in figure  [ fig_cool7 ] . in this case",
    "matching sa- and sph - galaxies is much more complicated than for central galaxies .",
    "once an object becomes a satellite its position will not be the same in the two kinds of simulation , and indeed it may merge with the central galaxy in one of the simulations but not in the other .",
    "we use the histories of the satellite galaxies in the two simulations in order to carry out this matching . given",
    "a satellite galaxy identified in an output of the semi - analytic simulation , say at redshift @xmath51 , we track it back through earlier outputs until we find the time when it was last a central galaxy .",
    "let us denote this time @xmath52 .",
    "( recall that , in our semi - analytic scheme every satellite galaxy was a central galaxy at some earlier time . )",
    "we then search in the sph simulation at @xmath53 and identify the sa progenitor of our satellite with the most massive sph galaxy in its halo . in some cases",
    "the halo may contain no sph galaxy and we then consider our original sa satellite to be unmatched .",
    "otherwise we locate the particles of the matched sph galaxy in the sph simulation at @xmath54 and consider the sph galaxy which contains the majority of them to be the counterpart of the original sa satellite .",
    "this counterpart may be an sph satellite , the sph central galaxy , or ( rarely ) an ` orphan ' galaxy outside any halo .",
    "occasionally it can fall below the 10 particle threshold to be considered a _ bona fide _ sph galaxy and we then again consider the original sa satellite to be unmatched .",
    "we also carry out the reverse procedure . starting from an sph satellite at @xmath51 , we trace back its progenitors ( defined at each time to be the sph galaxy which donates the largest number of particles to the galaxy at the subsequent output ) until we find one which was the most massive sph galaxy in its halo .",
    "this one we then identify with the sa central galaxy of the same halo .",
    "we take particular care to investigate sph satellite galaxies which appear to have no progenitors . in each output , some new sph galaxies appear for the first time as satellites ; in the previous output , their member particles are already cold and are just condensing at the center of a halo . due to discrete sampling of the output times",
    ", there is always a slight offset between the true formation epoch of sph galaxies and the time when they are first identified .",
    "their host halo can merge with a larger system during this time . to take this into account , we tag the central sa galaxy in any halo that hosts such a _ forming _ sph galaxy as its counterpart , because it is clear that such pairs indeed correspond closely .",
    "in this way we can partially compensate for incompleteness in our sph ",
    "sa galaxy matching procedure .",
    "the @xmath54 descendent of the matched @xmath53 sa galaxy is identified as the counterpart of the original sph satellite .",
    "again , this counterpart may be a satellite , a central galaxy , or ( rarely ) an ` orphan ' .",
    "we find 40 out of 84 sph satellite galaxies at @xmath10 matched to sa satellites .",
    "another 34 are matched to sa central galaxies .",
    "the remaining 10 are unmatched , mostly because they were formed under peculiar conditions in large halos without being at the center of the halos .",
    "it is likely that many are associated with subhalos within the large halo , but our simulation does not have adequate resolution to trace their formation in detail",
    ".    there are 8 sa satellites which are matched to sph central galaxies , and 74 sa satellites more massive than @xmath50 which are unmatched .",
    "a few of the latter may , in fact , correspond to unmatched sph satellites ; most correspond to systems in which the sph gas did not cool .",
    "the small number of sa satellites matched to sph centrals in comparison with the number of sph satellites matched to sa centrals is a consequence of the lower effective resolution of the sph simulation .",
    "we have checked that the merging rate , estimated as the fraction of all satellites which merge between two output times , is actually very similar in the two simulations .",
    "=    satellite - satellite matches are plotted as filled circles in figure  [ fig_cool7 ] , whereas sa satellite  sph central and sa central  sph satellite matches are plotted as open circles .",
    "unmatched satellites are plotted at an arbitrary small value of the ` missing ' mass and so appear along the left and bottom edges of the diagrams .",
    "the numbers of matches of each type are listed explicitly . the number given for the unmatched sa satellites corresponds to objects with masses above @xmath55 , the minimum mass for an sph galaxy .    for satellite ",
    "satellite matches the correspondence between the masses found using our two techniques is still reasonably good although with considerably more scatter than was the case for central galaxies .",
    "there is a tendency for the sph masses to be larger than the sa masses suggesting that gas is continuing to cool onto the galaxies after the time when they are last identified as central objects .",
    "it should be noted that a group of points appearing in the lower portion of the plot , indicating sph satellites matched to small mass sa satellites , are mostly those which are matched by our particular treatment for _ forming _ sph galaxies , as explained above . in such cases ,",
    "the halos hosting the forming galaxies merge into larger halos before the next output .",
    "their central sa galaxies then become satellites , and their masses stay constant , whereas the sph galaxies grow in mass continually until ( and even after ) they actually become satellites . unsurprisingly , for the satellite  central galaxy matches the central galaxy mass is almost always substantially larger than the satellite galaxy mass , regardless of which is sph and which sa .",
    "it is noticeable that as one moves to higher redshift , the number of unmatched sph satellites increases substantially relative to the number of unmatched sa satellites .",
    "this is probably a reflection of the limited time resolution of our merger trees . at",
    "early times structure is building up very rapidly and cooling is efficient .",
    "the spacing between our outputs may then be too large to resolve the formation and merging of significant numbers of halos .",
    "these can form an sph galaxy and turn it into a satellite between two levels of our numerical merger tree .",
    "in such cases the sa scheme will miss the satellite altogether .",
    "this highlights a different resolution issue from those discussed above .",
    "the sa scheme must store data sufficiently frequently that no significant stages of halo formation are missed .    in general , we conclude from the overall level of agreement seen for individual central and satellite galaxies that the standard recipe of gas cooling in the semi - analytic model gives an adequate description of the cooling process in the sph model .",
    "we have studied the cooling and condensation of gas onto protogalaxies using two very different treatments of the gas physics within the _ same _ simulation of dark matter evolution .",
    "one treatment uses schematic recipes taken from semi - analytic galaxy formation models , while the other tries to follow the hydrodynamics ` correctly ' and in detail using an sph approach .",
    "we have also tested two different implementations of the sph equations , confirming springel & hernquist s ( 2001 ) conclusion that the outcome of a simulation can depend sensitively on such details . in our case",
    "the two sph approaches lead to ` galaxy ' masses which differ by a factor of 2 , even for objects which are apparently well resolved .",
    "we believe the energy and entropy conserving implementation of springel & hernquist ( 2001 ) to be the most reliable and have concentrated on it when comparing sph results to those of the semi - analytic simulation .",
    "we have characterised the effective resolution limit of simulations using each of our gas modelling techniques by the lower limit for which the simulated galaxy mass function agrees with that of a much higher resolution simulation carried out using _ the same _ technique . for the sa modelling",
    "this galaxy mass limit is just below the total baryon content of the least massive halo included in construction of the merger trees ( 10 particles in the models used here ) . for the sph modelling",
    "the effective resolution limit is significantly higher , particularly at low redshifts when cooling times exceed the age of the universe in most resolved halos . for the simulations studied here",
    "the sph mass resolution limit at @xmath10 is roughly an order of magnitude larger than the sa limit , corresponding to a galaxy of about 75 sph particles .    above the resolution limit of both techniques ( i.e. for galaxy masses above @xmath49 ) the @xmath10 galaxy populations found by the two methods",
    "correspond remarkably well on an object - by object basis .",
    "the agreement is particularly good for the most massive galaxies in each halo ( the ` central ' galaxies ) . for satellite galaxies",
    "the agreement is still reasonably good for objects which match between the two types of simulation , but two significant types of discrepancy occur .",
    "one concerns objects which merge with the central galaxy in one of the simulations but not in the other .",
    "this is inevitable given the crudity of the recipe used to determine merging probabilities in the sa model .",
    "the difficulty can be avoided , at least for the more massive galaxies , with @xmath0-body simulations of high enough resolution .",
    "the dark matter substructures associated with satellite galaxies can then be tracked explicitly and no sa recipe is needed to follow their merging ( see swtk ) .",
    "a more interesting discrepancy is the significant number of sph satellites , which are unmatched in the sa simulation",
    ". some of these may reflect insufficient time resolution in the simulation outputs from which the sa merger trees are constructed ; halos may collapse , form galaxies , and merge into a larger halo between two of the stored outputs .",
    "other unmatched sph satellites may reflect more fundamental failures of the sa scheme .",
    "a forming dark halo may be sufficiently irregular to cool gas onto two galaxies rather than one , or cooling shocks associated with large - scale structure may fragment to make galaxies without any associated halo .",
    "the number of unmatched sph satellites is clearly greater at early times than at @xmath10 , suggesting that the process producing these objects is more effective when cooling times are short and structure growth is more rapid .",
    "this issue clearly warrants further investigation .",
    "although the unmatched sph satellites are a small population above the effective resolution limit of the sph simulation , they probably signal a real failure of the sa scheme .",
    "it is instructive to compare the computational efficiency of our two schemes .",
    "the comparison of this paper is based on implementing each of the schemes on top of a dark matter simulation with given @xmath0 . for the sa scheme the overhead in post - processing , although non - negligible , is not dominant .",
    "thus the computational cost is essentially that of running the high resolution cosmological @xmath0-body simulation .",
    "the sph scheme requires an additional @xmath0 sph particles , the force calculation for the sph particles is considerably more complex than for the dark matter particles , and substantially shorter timesteps are needed to get convergent results in an sph simulation with cooling than in the corresponding pure dark matter simulation . as a result , somewhat more than twice the memory and roughly an order of magnitude more cpu time are needed to carry out the sph simulation than the corresponding pure @xmath0-body simulation .",
    "( the actual cpu factor for the simulations of this paper was about 20 , but in neither case were the simulation parameters optimally chosen for the particular configuration treated . )",
    "we have seen , however , that the effective galaxy mass resolution of the sph simulation is roughly an order of magnitude worse than that of sa simulation .",
    "thus an sph simulation with ten times as many particles would be needed to get a galaxy population with the same effective mass resolution as the sa simulation .",
    "this would require 20 times as much memory and more than two orders of magnitude more cpu time than the sa simulation .    in practice",
    "these considerations imply that simulations can be carried out using the sa technique which are far beyond the current capabilities of the sph technique .",
    "for example , the s4 cluster simulation of swtk has 250 times better mass resolution than the sa simulation of this paper and so of order 2000 times better resolution than our sph simulation .",
    "it will be a long time before we can consider an sph cluster / galaxy formation simulation with 2000 times more particles than the one analysed above .",
    "a further advantage of the sa technique is that the assumptions about uncertain aspects of the galaxy formation modelling ( e.g. the mode and efficiency of star - formation or feedback ) can be changed without any need to rerun the simulation .",
    "an example of this was shown in figure  [ massfunc ] , where the predictions of the high resolution s4 simulation in the absence of star - formation and feedback could be calculated from the stored simulation output .",
    "thus for simulations concentrating on the global properties of the galaxy population and their dependence on the ` subgrid ' physics ( star formation , feedback , etc . ) the sa technique is clearly the method of choice .    on the other hand ,",
    "it is obvious that the sa technique can only be as good as the recipes on which it is based .",
    "our work has shown that the standard gas cooling prescription works surprisingly well , but has also uncovered some apparent discrepancies .",
    "discrepancies of this kind can only be studied and understood through comparison with simulations ( or analytic models ) which attempt to follow the relevant physics from first principles .",
    "such models or simulations are also needed , of course , to design the sa recipes in the first place .",
    "in addition there are many aspects of galaxy formation where sa modelling can only give crude indications .",
    "confirmation through direct simulation is then indispensable .",
    "examples include the internal structure of galaxies , the structure of the intergalactic medium , and the comparison of both of these with the wealth of available data .",
    "galaxy formation and its interaction with the environment is a complex and highly nonlinear process involving many different aspects of astrophysics .",
    "gaining some understanding will require concerted use of all the observational and theoretical weapons at our disposal .",
    "sa and sph simulation techniques will both remain major parts of our theoretical arsenal ."
  ],
  "abstract_text": [
    "<S> we compare two techniques for following the cooling of gas and its condensation into galaxies within high resolution simulations of cosmologically representative regions . </S>",
    "<S> both techniques treat the dark matter using @xmath0-body methods . </S>",
    "<S> one follows the gas using smoothed particle hydrodynamics ( sph ) while the other uses simplified recipes from semi - analytic ( sa ) models . </S>",
    "<S> we compare the masses and locations predicted for dense knots of cold gas ( the ` galaxies ' ) when the two techniques are applied to evolution from the same initial conditions and when the additional complications of star formation and feedback are ignored . </S>",
    "<S> we find that above the effective resolution limit of the two techniques , they give very similar results both for global quantities such as the total amount of cooled gas and for the properties of individual ` galaxies ' . </S>",
    "<S> the sa technique has systematic uncertainties arising from the simplified cooling model adopted , while details of the sph implementation can produce substantial systematic variations in the galaxy masses it predicts . </S>",
    "<S> nevertheless , for the best current sph methods and the standard assumptions of the sa model , systematic differences between the two techniques are remarkably small . </S>",
    "<S> the sa technique gives adequate predictions for the condensation of gas into ` galaxies ' at less than one percent of the computational cost of obtaining similar results at comparable resolution using sph .    </S>",
    "<S> galaxies : clusters  galaxies : evolution  methods : n - body simulations </S>"
  ]
}