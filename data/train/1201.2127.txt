{
  "article_text": [
    "modeling gravitational lens systems is fundamentally a two step process .",
    "a successful model requires an outer optimization procedure to discover the parameters of the lens model , and a nested optimization step to determine the structure of the lensed source object .",
    "this inner source optimization step must incorporate the effect of the point spread function ( psf ) .",
    "observed data are blurred by the psf , and the presence of noise complicates the deconvolution process in general @xcite .",
    "this problem has been well studied by a variety of authors using spatially invariant psfs ( @xcite ; @xcite ; @xcite ) .    to include blurring and lensing effects",
    ", we describe operations on images by the application of linear operators .",
    "we use `` flattened '' images to facilitate this notation , in which each column of the image is stacked upon the next , forming a vector .",
    "our preferred scheme for solving the lens modeling problem is a modification of the semilinear method of @xcite , as outlined in @xcite . to begin , we define image and source coordinate systems that are connected by the thin lens equation : @xmath0 where @xmath1 and @xmath2 are the image and source coordinates respectively , and @xmath3@xmath4@xmath1@xmath5 is the deflection angle determined by the gravitational potential of the lens density distribution .",
    "the lens equation is a nonlinear equation that maps pixels from the image to the source plane ( @xcite ; @xcite ) .",
    "the source plane pixels are represented as a vector @xmath6 , with elements that can be varied independently to account for the details of the unknown source intensity distribution .",
    "the details of the psf are encoded in the blurring matrix @xmath7 and gravitational lens effects , described by equation [ eq : thinlens ] , are included in the lensing matrix @xmath8 .",
    "we then define the total lens matrix @xmath9 and data vector @xmath10 . denoting the standard deviation of the noise as @xmath11 , and given a source intensity distribution , the resulting @xmath12 statistic between the data and model is @xmath13 by requiring derivatives of this equation with respect to the elements of the source vector @xmath6 vanish , we find that the optimal source pixel intensities satisfy a least - squares equation : @xmath14 where we have absorbed factors of @xmath15 into the matrix @xmath16 and data vector @xmath17 .",
    "the details of this derivation can be found in @xcite and @xcite , where the system is solved by direct matrix inversion with regularization .",
    "this least squares form is commonly found in the context of large scale image deconvolution problems , which are typically solved by iterative methods ( @xcite ; @xcite ; @xcite ) .",
    "note that the semilinear method provides a technique for solving the linear parameters of the lensed system only ( the source intensity distribution ) in an `` inner loop '' , while the nonlinear parameters of the lens mass distribution must be solved in a separate `` outer loop '' optimization step @xcite .",
    "spatial dependence of the psf is not considered in most conventional deconvolution problems .",
    "this simplifies the construction of the blurring matrix @xmath7 , since only one psf is taken into account .",
    "however , it is well known that the psf can not always be treated as constant over an image in cases of astronomical interest . for example , spatially variant psfs have been studied in the context of adaptive optics ( @xcite ; @xcite ) and the psf of astronomical instruments , such as the hubble advanced camera for surveys , can be extremely position dependent @xcite .",
    "several schemes have been designed to deal with this variability ( @xcite ; @xcite ; @xcite ; @xcite ) .",
    "describing a spatially variant psf is much more complicated than for the invariant case , since each row of the blurring matrix @xmath7 will be derived from a unique psf in general .",
    "the position of a pixel in the image determines the amount by which it is blurred .",
    "we illustrate the effect of spatially dependent psfs on gravitationally lensed images in figure [ fig1 ] .",
    "consider the lensing effect produced by a singular isothermal sphere ( sis ) , which has three parameters : velocity dispersion @xmath18 and lens center @xmath19 .",
    "the deflection angle due to a sis lens has a simple analytical form most conveniently described in standard polar coordinates @xmath20 : @xmath21 where @xmath22 and @xmath23 are the angular distances between lens and source and observer and source respectively , and @xmath24 is the speed of light .",
    "we model the blurring in figure [ fig1 ] with @xmath25 km s@xmath26 and use source redshift @xmath27 and lens plane redshift @xmath28 .",
    "this model was calculated using cosmological parameters @xmath29 km s@xmath26 mpc@xmath26 , @xmath30 and @xmath31 which we adopt for the remainder of this study .",
    "the source is comprised of a set of circular disks in the source plane as shown in the left - hand panel of figure [ fig1 ] and the gravitationally lensed image is shown in the center panel .",
    "the lensed image is then blurred by a spatially variant psf and is shown in the right panel of figure [ fig1 ] .",
    "the distortion used to create this image varies from a delta function in the lower - left corner ( negligible blur ) to a gaussian with standard deviation @xmath32 pixels in the upper right corner .",
    "each psf is defined on an arbitrary @xmath33 grid and is normalized to unity sum .",
    "the source and image plane size are @xmath34 pixels .",
    "unlike constant psfs , spatially variant psfs can not be described by a simple convolution operation . fortunately",
    ", numerical methods have been devised to handle them , including sectioning methods @xcite , which deconvolve each psf independently and forms the source from the sum of the reconstructions .",
    "@xcite devised a clever method to model the effects of spatially variant psfs within the framework of the standard image deconvolution problem .",
    "this approach differs from sectioning methods in that the separate psfs are used to build an approximation to the blurred image of a given source , and a single iterative deconvolution operation is needed to solve for the source intensity distribution .",
    "the method was implemented in @xcite and represents the spatial dependence of the psf as a summation of piecewise blurring matrices , each of which applies over a limited area of the image . in this study",
    ", we use the method of @xcite to incorporate spatially variant blurring into our gravitational lens modeling code .",
    "we briefly review the method here and discuss the procedure in detail in the appendix .    to include the effects of spatially variant blurs ,",
    "the image of the unblurred lensed source is padded to enforce a boundary condition @xcite .",
    "we focus on the use of reflexive boundary conditions , in which the image is padded by symmetric reflections of itself .",
    "reflexive boundary conditions tend to reduce ringing artifacts if a significant amount of structure is located near the edges of the image .",
    "the image is then divided into a square grid , where the psf is assumed constant in each region .",
    "these image regions and the psfs are then padded to match in size .",
    "the two - dimensional fast fourier transform ( fft ) is used to calculate the resultant blurred image regions independently , resulting in an effective piecewise convolution . by substituting efficient algorithms for the explicit matrix and matrix - transpose multiplications in equation [ eq : ls ] , the least squares form of the problem",
    "is preserved and the system can be solved efficiently .    in principle",
    "spatially variant blurring can be described by a blurring matrix compatible with the semilinear method . however , in practice there are several problems with the matrix approach .",
    "first , the size of the blurring matrix is @xmath35 , so the matrix quickly becomes large as the image resolution is increased .",
    "second , since the psfs vary over regions of the image , it is possible that @xmath7 may contain a large number of small but non - zero entries , particularly for large , complicated psfs that are not well approximated by gaussians or other simple analytical functions .",
    "this complicates the optimization because @xmath36@xmath37@xmath38@xmath39@xmath38 must be inverted in the semilinear scheme .",
    "it is generally required that @xmath36 is sparse in order to store and invert this large matrix .",
    "the sparsity requirement helps to reduce computation time and reduces the amplification of noise in the reconstructed source . in practice",
    "the semilinear method requires regularization to control the amount of noise present in the solution of equation [ eq : ls ] .",
    "the details and effects of several distinct regularization methods used with the semilinear method were studied in detail by @xcite .",
    "our previous work @xcite , compared the semilinear method with several iterative methods to solve the least - squares problem ( equation [ eq : ls ] ) .",
    "iterative schemes have the advantage that time is saved by avoiding the explicit construction of the lens and blurring matrices .",
    "this is done using direct interpolation on the source plane under the effect of the lens equation ( equation [ eq : thinlens ] ) .",
    "@xcite used the qubist optimization toolbox @xcite to map the @xmath12 surface over the space of the nonlinear lens parameters using the ferret genetic algorithm ( ga ) and locust particle swarm optimizer ( pso ) . since this mapping requires a large number of function evaluations ( @xmath40 ) over the course of a run , speed is of the essence when choosing an inner loop optimization to determine the source plane parameters .    using the techniques introduced by @xcite as a foundation",
    ", we have added the capability to include spatially variant psfs to our gravitational lens modeling code using piecewise constant psfs .",
    "this new capability is the subject of the current exploration .",
    "in this section , we provide an example of modeling an extended source under the effects of a spatially variant psf .",
    "we generate the lensed image of an analytical function that describes a spiral source intensity distribution , according to the equation : @xmath41 , \\label{bonnetsource}\\ ] ] where @xmath42 is the maximum brightness in arbitrary units and core radius @xmath43 .",
    "the tightness of the arms about the central bulge is controlled by @xmath44 , and @xmath45 controls the orientation of the spiral , in standard polar coordinates @xmath46 . this artificial `` galaxy '' , originally described by @xcite , serves as a convenient test pattern . to draw comparisons between our results for spatially invariant psfs @xcite",
    ", we will again make use of a singular isothermal ellipse ( sie ; @xcite ) with deflection angle components :    @xmath47    @xmath48    with @xmath49 and @xmath50 , and @xmath51 is the equivalent einstein radius when @xmath52 .",
    "the parameter @xmath51 is related to the velocity dispersion @xmath18 by equation [ einsteinradius ] .",
    "the parameters used in this test are velocity dispersion @xmath25 km s@xmath26 with @xmath53 and @xmath54 giving an equivalent einstein ring of @xmath55 arcsec , ellipticity @xmath56 , lens center @xmath57 , core size @xmath6 , and orientation angle @xmath58 measured counterclockwise from the right of the image .",
    "we set @xmath59 , resulting in a singular mass distribution .",
    "we used equation [ eq : thinlens ] to form the lensed image of the source ( equation [ bonnetsource ] ) using the sie deflection angle formulae .",
    "we generated a @xmath60 grid of spatially variant gaussian psfs where each psf is defined by a @xmath61 pixel mesh and has an fwhm ranging from @xmath62 to @xmath63 pixels , shown in figure [ psfgrid ] .",
    "this grid of psfs was used to blur the gravitationally lensed image and additive gaussian white noise with standard deviation @xmath64 was added after the blurring operation , resulting in the artificial data shown in figure [ fig2image ] .",
    "we define the peak signal - to - noise ratio ( psnr ) as @xmath65 giving @xmath66 .",
    "to illustrate the effect of varying the number of psfs , we model the data using smaller grids of @xmath67 , @xmath68 , @xmath69 , @xmath70 , and @xmath71 psfs . as shown in figure [ f2residual ] , the best reconstruction with the lowest reduced @xmath12",
    "is obtained using a grid of @xmath71 psfs , which is the same number used to generate the data .",
    "this source and corresponding model image after @xmath72 iterations are also shown in figure [ fig2image ] .",
    "the @xmath67 and @xmath68 image residuals show significant structure , which is not present in the finer approximations . the residuals using a grid of @xmath60 psfs appear featureless .",
    "this demonstrates the improvement in image reconstruction as we include successively more information characterizing the blur .",
    "figure [ fig2converge ] shows the relative error between the model source and the true solution as a function of iteration . for all psf grid sizes , we find that the solutions display semi - convergence behavior such that the relative error between the model solution and the true solution improves until a minimum is reached and then begins to increase .",
    "this is due to the properties of the local optimizer used to determine the optimal source , and arises in the deconvolution step due to noise in the observed image .",
    "regularization methods are generally used to control the increase of noise in the reconstructed source found by the semilinear method @xcite .",
    "several optimization methods have been applied to problems with spatially variant blur including landweber iteration ( @xcite ; @xcite ; @xcite ) , richardson - lucy deconvolution @xcite , and lanczos - tikhonov hybrid methods @xcite in the context of the standard image deconvolution problem .",
    "following @xcite , we focus on the conjugate gradient method for least - squares problems ( cgls ) and the steepest descent method ( sd ) .",
    "figure [ fig2sd ] shows the convergence history of the sd algorithm . as in the invariant psf case discussed in @xcite ,",
    "the sd solution converges more slowly than cgls and therefore it is less sensitive to the stopping criteria .",
    "when using an iterative method for local optimization , the number of iterations itself acts as a regularization parameter .",
    "the optimal stopping iteration of these local optimizers is at the minimum of the relative error curve for a given set of lens parameters and psf tiling .",
    "this critical iteration represents a balance between the reduced image @xmath12 and the amount of regularization used @xcite .",
    "established methods exist to determine this critical iteration , including the l - curve criterion @xcite and generalized cross validation @xcite . in previous work @xcite we made use of the l - curve criterion but generalized cross validation",
    "is also implemented in our software .",
    "we find that the execution time of the problem including a spatially variant psf increases approximately linearly with the number of separate psfs used in the inversion as shown in figure [ timing ] .",
    "this suggests that significant gains could be made in the efficiency of the routine by parallelizing the implementation , since each image region is independent . by splitting up the problem over several processors , the runtime for",
    "very large psf grids can become feasible .",
    "to demonstrate the code in operation on a large scale problem , we simulate the lensing effect of the mass distribution of a galaxy cluster on a portion of the hubble deep field using an elliptical potential .",
    "this test is intended as a demonstration of the feasibility and efficiency of our method on a problem that would be difficult using the semilinear method while including a spatially dependent psf .",
    "problems of this size are realistic for a number of practical modeling situations . for example , @xcite has modeled the lensed system sl2sj021408 - 053532 , which produces a set of large arcs .",
    "this system has a lens that is comprised of a small group of six galaxies . due to the large size of the lensed arcs , the scope of the source modeling prohibited the direct application of the semilinear method .",
    "we form the lensed image of a portion of the hubble deep field @xcite by applying the elliptical potential of @xcite which was used by @xcite to simulate the lens effect of the dark matter distribution of galaxy clusters .",
    "this potential function is given by @xmath73^q , \\label{psipot}\\ ] ] which results in deflection angle @xmath3@xmath4@xmath1@xmath74@xmath1@xmath5 .",
    "the elliptical potential depends on seven parameters : @xmath51 is the equivalent einstein radius in the limit of vanishing core radius @xmath6 , ellipticity @xmath75 , and power law index @xmath76 , where @xmath77 .",
    "the position angle of the lens @xmath78 determines the functions @xmath79 and @xmath80 .",
    "we use the einstein radius @xmath81 , power law index @xmath82 , @xmath83 , position @xmath84 and @xmath85 .",
    "the lens and source redshifts are @xmath86 and @xmath27 , respectively .",
    "we used an array of @xmath87 psfs arranged on a @xmath68 grid to blur the image .",
    "this set of psfs has been used to test image restoration schemes for hubble space telescope ( hst ) images and represents the spatially variant nature of the aberrations affecting the hst before it was repaired ( @xcite ; @xcite ) .",
    "the size of each psf is @xmath88 pixels , and the source and image plane used to generate our lensed image are @xmath89 pixel@xmath90 .",
    "gaussian white noise was added with standard deviation @xmath91 , giving the image @xmath92 .",
    "the image after @xmath93 iterations is shown in figure [ fig3cluster ] , and a reduced @xmath94 was found .",
    "the system was solved using the cgls algorithm with all @xmath87 psfs using the lens parameters defined above .",
    "the model took approximately @xmath95 minutes to solve using a single 2.4 ghz cpu core .",
    "an approximation to the nonlinear lens parameters could be found using global optimization methods if one of the following strategies were employed : ( 1 ) a low - resolution approximation to the data could be used early during the lens parameter optimization , with successive refinement occurring later during the run ; ( 2 ) a global optimizer could be used to roughly approximate the lens parameters , shifting to a faster local optimization scheme once solutions are localized to a small region of parameter space ; or ( 3 ) global optimization could be used for the entire problem making use of large - scale parallelization .",
    "we have developed a method to include the effects of a spatially variant psf in gravitational lens modeling . including these effects in the standard semilinear method",
    "would be difficult due to the complicated blurring matrix required .",
    "these complications can be overcome easily by incorporating the method of @xcite .",
    "our approach can accommodate large lensing problems like the case studied by @xcite , which limits the applicability of the direct semilinear approach .",
    "techniques to include the effects of spatially variant psfs are important , as the response varies over the detector area for many astronomical instruments .",
    "our algorithm allows this effect to be included in lensing problems , thus improving the quality of reconstructions when the variability of the psf is significant .",
    "the cgls and sd algorithms allow a regularized inversion to be found quickly by truncated iteration .",
    "a.r . acknowledges nserc for funding this research , and j.f . acknowledges funding from an nserc discovery grant .",
    "the authors also thank the anonymous referee , whose comments helped to improve the flow of the paper .",
    "to describe blurring by a spatially variant psf we first present an efficient method using two - dimensional ffts .",
    "we then show how to treat the problem in terms of blurring matrices and flattened image vectors .",
    "see @xcite for more details on the approach and @xcite for a matlab implementation .",
    "consider an @xmath96 grid of independent psfs @xmath97@xmath98 and split the unknown blurred image @xmath99 into regions @xmath99@xmath98 , each of size @xmath100 : @xmath101 each of these blocks will be affected by an independent psf .",
    "suppose that the size of each psf is @xmath102 with @xmath103 even , and let the unblurred @xmath96 image be represented by @xmath104 .",
    "let us define a set of `` mask '' matrices @xmath105@xmath98 . in the case of piecewise constant psfs",
    ", these masks are the same size as the unblurred image and are comprised of @xmath106 entries everywhere except for the @xmath100 block at position @xmath107 , where the entries of @xmath105@xmath98 are set to @xmath108 .    to find the components of a given region we convolve @xmath104 with the corresponding psf @xmath109 , followed by an element - wise multiplication by the mask @xmath105@xmath98 .",
    "the non - zero elements of this product give @xmath99@xmath98 .",
    "proceeding in this way we build up the blurred image block by block : @xmath110 where the symbol `` @xmath111 '' represents element - wise multiplication and symbol `` @xmath112 '' is the convolution operation .",
    "note that each term in the sum is determined by the convolution of the entire image @xmath104 with the appropriate psf before the mask is applied .",
    "this is crucial to ensure that `` seams '' will not be visible between regions in the blurred image @xmath99 .    in general",
    ", it is possible to speed up this routine by calculating @xmath99@xmath98 directly .",
    "consider splitting the unblurred image into regions @xmath104@xmath113 where the superscript denotes the size of the block , in this case @xmath100 . in order to avoid artifacts and keep the correct intensity near the edges of this block after convolution",
    ", we include a number of neighboring rows and columns on each side of @xmath104@xmath113 .",
    "the width of this border is set by the size of the psf , @xmath114 , with regions on the image boundary padded to enforce the boundary conditions discussed in section [ sec : intro ] .",
    "these extended regions are then denoted @xmath104@xmath115 .",
    "the psfs are padded to match the extended regions in size , resulting in @xmath97@xmath115 .",
    "the blurred extended region is found by the convolution @xmath116 the central @xmath100 block of this product is clipped out and placed in the @xmath107 position of @xmath99 .",
    "the process is repeated until the entire blurred image is filled in .",
    "time is saved working with extended regions and padded psfs since we only need to calculate the convolution over the @xmath117 block for each psf rather than the entire image as in equation [ eq : convos ] , and the construction of masks is not needed .",
    "the convolutions can be carried out efficiently with two - dimensional ffts .",
    "the basic procedure can also be described by an analogous matrix - vector operation . to express the sum in equation [ eq : convos ] in terms of matrix multiplication",
    ", we define the unblurred flattened image as a vector @xmath118 , and the flattened blurred image as @xmath119 .",
    "we build a set of @xmath120 blurring matrices to describe the effect of each psf on @xmath118 , which we denote as @xmath7@xmath98 .",
    "the mask matrices @xmath105@xmath98 are used to construct analogous weighting matrices @xmath121@xmath98 .",
    "these matrices are of size @xmath35 , where @xmath122 is the number of pixels in the image , identical to the size of the blurring matrices @xmath7@xmath98 .",
    "the total blurring matrix @xmath7 is then written as a weighted sum of blurring matrices @xmath7@xmath123 , @xmath7@xmath124, ... ,@xmath7@xmath125 .",
    "@xmath126 the blurred image is then found by a matrix multiplication @xmath119=@xmath127 .",
    "the weighting matrices @xmath121@xmath98 have the @xmath128th diagonal entry equal to @xmath108 provided that image pixel @xmath128 is in region @xmath107 , and all other elements @xmath106 .",
    "the weighting matrices satisfy @xmath129 @xmath121@xmath130@xmath131 where @xmath131 is the @xmath35 identity .",
    "we adopt the use of piecewise constant psfs but in general it is possible to include higher order interpolation schemes between psfs using the weighting matrices . the case of linear interpolation in solving systems with spatially variant blur",
    "has been studied by @xcite , but its inclusion complicates the procedure and did not provide a significant improvement to the quality of the solution and increased computation times @xcite ."
  ],
  "abstract_text": [
    "<S> astronomical instruments generally possess spatially variant point - spread functions , which determine the amount by which an image pixel is blurred as a function of position . </S>",
    "<S> several techniques have been devised to handle this variability in the context of the standard image deconvolution problem . </S>",
    "<S> we have developed an iterative gravitational lens modeling code called mirage that determines the parameters of pixelated source intensity distributions for a given lens model . </S>",
    "<S> we are able to include the effects of spatially variant point - spread functions using the iterative procedures in this lensing code . in this paper </S>",
    "<S> , we discuss the methods to include spatially variant blurring effects and test the results of the algorithm in the context of gravitational lens modeling problems .    9.0 in </S>"
  ]
}