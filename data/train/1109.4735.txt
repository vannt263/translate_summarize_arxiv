{
  "article_text": [
    "for scattering experiments in particle physics one often needs fast trigger decisions . the trigger signal should have a good time resolution with respect to the occurrence of the scattering event , of the order of 1  ns .",
    "scintillation detectors allow for fast trigger decisions with an appropriate time resolution .",
    "however , in large scintillation detectors the time resolution is deteriorated by a varying light propagation time depending on the impact point of a particle in the detector .",
    "thus , such long scintillator strips are read out on both sides by photo multiplier tubes ( pmts ) , and the method of mean - timing is employed by generating in real time a signal whose time corresponds to the average time of the individual pmt pulses and is thus independent of the impact point .",
    "various methods have been developed to meet this requirement  @xcite .    in this article an implementation of a mean - timer logic and a subsequent coincidence logic",
    "is presented .",
    "the goal was to use an already existing multi - purpose fpga board equipped with a xilinx virtex-5 allowing for a maximum clock frequency of 500 mhz .",
    "the corresponding granularity of 2 ns was not enough for our application , so we decided to use an unclocked logic which does not underlie the discreteness of the clock cycles .",
    "up to now such a mean - timer was only implemented on a cpld  @xcite .",
    "the paper is organized as follows .",
    "section  [ prb ] describes the requirements of the system and the fpga board used .",
    "the main section  [ impl ] presents the implementation of the mean - timer and coincidence logic on the fpga board .",
    "section  [ perf ] discusses the implementation and performance of the system at the compass experiment at cern  @xcite .",
    "fig .  [ trigger ] explains the main features of the trigger system at the compass experiment  @xcite .",
    "muons produce light in two scintillator hodoscopes placed along the beam direction .",
    "the scintillator strips are read out on both sides by pmts .",
    "after conversion to logic signals , these are passed on to the mean - timer . for offline analysis ,",
    "the single pmt signals are digitized by time - to - digital - converters ( tdcs ) .    in a subsequent coincidence logic ,",
    "the mean - timer outputs of the two hodoscopes are passed on to a coincidence matrix which allows to select coincidences between the strips of the two hodoscopes . by selecting only certain channel combinations of h1 and h2 , as indicated in fig .",
    "[ trigger ] , it is possible to discriminate scattered particles from beam halo particles .    ]",
    "both hodoscopes have 32 strips , so in total 64 mean - timers and a 32@xmath032 coincidence matrix are needed . since the length of each scintillator strip is 250  cm , which corresponds to a light propagation time of approximately 20  ns , the dynamic range of each mean - timer",
    "is required to be at least @xmath1  ns .      for the implementation of the mean - timer and the coincidence logic",
    ", we use a custom made fpga board developed at the university of freiburg @xcite .",
    "this so called gandalf board can be equipped with two input cards providing 2 @xmath0 64 lvds inputs and in addition 2 nim inputs and 4 nim outputs ( see fig .",
    "[ fig : gandalf ] ) .",
    "the board is constructed as a 6u - vme64x / vxs module and can be controlled via the vme - bus .",
    "it is based on a xilinx virtex-5 ( xc5vsx95t-2 ) fpga  @xcite .",
    "this fpga consists of an array of @xmath2 configurable logic blocks ( clb ) .",
    "each of these clbs contains 8 programmable logic elements and various other elements like a carry logic and flip - flops .",
    "the programmable logic elements are called look - up tables ( luts ) and have 6 inputs and 2 outputs , so that any 6-to-2 logic can be implemented . to allow communication between different luts and flip - flops , every clb has a switch matrix to which all elements of a clb are connected .",
    "if two elements reside in different clbs their switch matrices use so called global interconnects .",
    "the fpga provides 640 i / o connections , from which 256 are used for the 128 lvds inputs , and 6 for the nim inputs and outputs . to each of these connections",
    "belongs a dedicated delay element which allows to delay the signal in 64 steps of 75  ps .",
    "thus the maximum delay is about 5  ns .",
    "a 36  kbit block - ram , a dynamic clock manager ( dcm ) and some clbs optimized for digital signal processing algorithms complete the structure of the fpga .    due to variations in the production process ,",
    "each fpga has its own timing behavior . to be able to design clocked circuits ,",
    "however , some maximum propagation timings must not be exceeded .",
    "therefore , xilinx characterizes every single fpga by its timing behavior by so called speed grades ranging from 1 to 3 .",
    "a speed grade of 1 corresponds to the slowest version  @xcite . in the simulation software",
    "the developer has to select the correct speed grade .",
    "it is indicated by the last digit in the device number , in our case an fpga with speed grade 2 is used .",
    "the mean - timers are constructed using the tapped delay line ( tdl ) method  @xcite as shown in fig .",
    "[ meantimer ] and app .",
    "[ app_tdl ] .",
    "the two input signals of each mean - timer propagate in opposite directions in the two delay lines and trigger the ands between these lines while passing each other .",
    "the or - ed output of all ands provides the desired mean - timed signal .    ]    implementing an unclocked mean - timer on a fpga , one has to take care that    1 .",
    "all delays on the tapped delay line are of equal amount ( up to a few ps ) and 2 .   the delays from the ands to the logical or are identical .",
    "a chain of luts is used to build the tapped delay line .",
    "it turns out that the delays between the 8 luts inside the same clb are much smaller than the delays between two luts located in two different clbs , because the second case requires global interconnects . since more than 8 delay elements are needed to reach the desired dynamic range , the tapped delay lines have to be constructed using those interconnects . to determine the path length of a particular interconnect between two luts , we used loc - constraints ( location constraints ) to place the luts at certain positions and added a signal path from one of the two outputs from the first lut to one of the 6 input pins of the second lut .",
    "furthermore we tagged that path with a maxdelay constraint of a few ps to enforce the shortest path between these two luts .",
    "after the xilinx software finished the place and route process , we extracted the simulated path length from the logfile . to be sure that exactly this path will be used in the later design , we used the xilinx fpga - editor to extract the route - constraint of the simulated path .",
    "this process had been automated to simulate all conceivable combinations and we found two oppositely running paths between adjacent clbs with an equal length of 579 ps .",
    "however , these paths lengths depend on the absolute position of the used adjacent clbs in the clb grid of the fpga , but it was possible to identify enough clbs with the same simulated timing behavior to construct 64 identical mean - timers . the resulting design is illustrated in fig .",
    "[ hobclb ] . the propagating signals in the tdls",
    "are not only sent to the next delay element but also to one of the inputs of the ands .",
    "these ands are realized in one of the 6 remaining luts of each clb ( 2 are already used for the tapped delay lines ) .",
    "the propagation time from the tdl luts to the ands has to be identical only within one mean - timer , differences between different mean - timers can be compensated by delays of each input .    to implement 64 mean - timers in 46 columns with 160 clbs",
    "each , two mean - timers need to be placed in one column .",
    "we choose to design the tapped delay lines with 53 delays and thus 54 luts which amounts to a total range of 53@xmath0579  ps @xmath3 30  ns .",
    "the mean - timers are placed at the top and at the bottom of 32 clb columns .",
    "this is advantageous for the implementation of the coincidence logic between the two hodoscopes discussed in section  [ coinc ] .    ]",
    "the last step consists of implementing the or of all 54 and outputs for each mean - timer .",
    "as stated before , each lut has only six inputs , thus the or has to be realized as a cascade of multiple ors .",
    "all signals of the same level of this cascade should have equal delays .",
    "the search for suited combinations has been performed with an automated script , as for the tdls . to be able to place all 64 mean - timers side by side , the paths of the cascade are not allowed to leave the clb column .",
    "a solution was found using a 6 level cascade with 2 to 1 ors where the propagation time variation is at most 34  ps . these solutions are different for every mean - timer , leading to different total propagation times which are again compensated by the input delays of each mean - timer .",
    "[ mt_test ] shows the result of a test measurement where two input signals derived from two slightly detuned clocks are sent to the two inputs of one mean - timer and simultaneously to tdcs for time measurement .",
    "the @xmath4 axis shows the time difference of the input signals , @xmath5 .",
    "the @xmath6 axis shows the time difference between the output signal of the mean - timer , @xmath7 , and the mean - time calculated from @xmath8 .",
    "the propagation time of the signals through the fpga including the coincidence logic described in sec .",
    "[ coinc ] is approximately 70  ns .    , and the calculated mean - time @xmath8 .",
    "[ mt_test],title=\"fig : \" ] +     on the @xmath6-axis .",
    "[ mt_test_proj ] ]    the output shows the desired behavior in a time range of @xmath920  ns , i.e. the mean - time is independent of the time difference @xmath5 .",
    "one also clearly observes a modulation in the inset which shows a magnification on the region 6.5 to 10  ns of the @xmath4-axis , due to the tapped delay line .",
    "the observed jitter of the order of 120  ps ( rms ) as seen in the projection on the @xmath6-axis in fig .",
    "[ mt_test_proj ] is acceptable .",
    "the observed slope of 5  ps per ns originates from a slightly different propagation time in the two tdls which was not present in the simulation . at the borders",
    "the mean - time signal comes later by up to 200  ps .",
    "the reason for this effect is the following .",
    "if one of the signals already left the tapped delay line when the second signal just enters , the and is not triggered by the leading edge of the signal leaving the tapped delay line , the mean - time signal is correspondingly delayed . for the data shown in fig .  [ mt_test ] this effect was minimized by shortening the input signals inside the fpga to a width of 1  ns .    the total dynamic range of @xmath10  ns is shorter than predicted by simulations ( @xmath11  ns ) .",
    "this is due to the simulation software which overestimates the propagation time .",
    "this software is designed for clocked applications for which an upper limit of propagation time must be guaranteed , however , most signal paths are faster than simulated .",
    "the influence of temperature variation of the fpga on the propagation time of the signals through all logic elements inside the fpga can be neglected .",
    "it was measured to be 30  ps / k in a range from 40 to 80@xmath12c inside the fpga chip .",
    "the coincidence logic has to be implemented in a way that arbitrary combinations between 32 inputs from the first hodoscope ( h1 ) with 32 inputs from the second hodoscopes ( h2 ) , i.e. in total 1024 ands are selectable in a so called coincidence matrix .",
    "one of the 1024 matrix elements is shown in fig .",
    "[ mat_el ] .",
    "the selection is done by using a third input on a and gate which is set to a logic 1 if the channel combination is selected .",
    "the trigger signal is then given by an or of all 1024 ands .",
    "it is required that the or signal is generated at a fixed time with respect to the particle passing the hodoscopes , independently of the channels hit . moreover , for each matrix element the respective signals of the two hodoscope counters have to reach the and at the same time .    ]",
    "the scheme presented in fig .",
    "[ coinc_matrix ] meets both requirements .",
    "the @xmath13 signals propagate through the matrix with the delays @xmath14 and @xmath15 which are given by the interconnect paths between the luts on the fpga .",
    "signal delays between the mean - timer outputs and the matrix inputs have to be adjusted in order to compensate for the delays inside the matrix as stated in the figure .",
    "consider for example the element marked with @xmath16 .",
    "both signals are delayed by @xmath17 before they arrive at the matrix element .",
    "moreover , it is easy to see that all signals from input h1 ( input h2 ) reach output h1 ( output h2 ) at the same time .",
    "the or of all 1024 and outputs carries the logic information whether at least one selected coincidence between h1 and h2 has occurred .",
    "the timing information of this occurrence is derived from the output h1 .    ) after re - timing with the h1-output .",
    "[ coinc_matrix ] ]    fig .",
    "[ system ] shows schematically the entire system starting from the lvds inputs to the outputs .",
    "apart from the output of the matrix needed for the trigger signal , several auxiliary outputs , like the or of all channels in a hodoscope are provided .",
    "a web interface allows to set conveniently all delays and to select the coincidences of the matrix .",
    "more details can be found in @xcite .    ]",
    "the system comprising two gandalf modules was successfully installed and operated for the 2010 data taking period at the compass experiment at cern  @xcite on a newly installed hodoscope pair enlarging the kinematic range of the trigger system .",
    "[ mt_plot ] demonstrates the performance of the whole system , starting from the scintillation detectors up to the generation of a trigger signal in the fpga .",
    "the upper plot shows the calculated mean - time from the tdc information of the two pmts of one scintillator element vs. the mean - time signal generated by the fpga . a detector located in the beam line of the experiment with a good time resolution of 300  ps serves as a reference ( `` bms time '' ) .",
    "the strong correlation proves the correct operation of the system .",
    "the two plots on the bottom show the projections on both axes .",
    "both distributions have approximately the same width of 600  ps , dominated by the resolution of the scintillation counter .    ]    the upper left plot in fig .",
    "[ timing_las1 ] shows again the timing of the trigger signal vs. the beam line detector , but this time all possible coincidences between channels in the two hodoscopes indicated in the matrix pattern in the lower right plot contribute to the spectrum . the fact that the width of the gaussian of 820  ps is only slightly worse than the width for the single channel in fig .",
    "[ mt_plot ] proves that the matrix scheme presented in section  [ coinc ] is working and that timing adjustments succeeded .",
    "note that the timing adjustments have to be performed for each fpga individually to compensate variations of internal delays .",
    "the small spectra in fig .",
    "[ timing_las1 ] show the corresponding time distributions of the central matrix elements indicated by dark circles in the lower right plot .    ]",
    "in summary , a combined mean - time and coincidence logic based on fpga technology was developed and implemented at the compass experiment at cern .",
    "the design was based on a xilinx virtex-5 fpga .",
    "for the first time an unclocked scheme was used for such an implementation .",
    "the mean - timer operates in a range of @xmath9 20  ns with a resolution of approximately 400  ps . on a single fpga board in total @xmath13 mean - timer and a 32@xmath032 coincidence logic",
    "was implemented .",
    "the spectra shown stem from the 2010 compass data taking period and prove that the system is running successfully .",
    "we acknowledge the help of our compass colleagues , especially johannes bernhard , nicolas du fresne von hohenesche and eva - maria kabu who were responsible for the design and installation of the hodoscope system .",
    "the developments described in this report are supported by the german bundesministerium fr bildung und forschung and the european community research infrastructure integrating activity under the fp7 study of strongly interacting matter ( hadronphysics2 , grant agreement number 227431 ) .",
    "the basics of the tapped delay line ( tdl ) technique is outlined in this appendix . denoting by @xmath18 ( @xmath19 ) in fig .",
    "[ meantimer ] the light propagation time from the impact point of the particle in the scintillator to the left ( right ) pmt and by @xmath20 ( @xmath21 ) the corresponding times until both signals meet at one of the ands , the time difference between the occurrence of the event and triggering of one of the ands is @xmath22 denoting by @xmath23 the constant time of light propagation through the entire scintillator and by @xmath24 the constant total propagation time through the complete tapped delay line , one finds @xmath25 i.e. the time @xmath26 when the first and fires is independent of the differences in the light propagation time to the left and right end of the scintillator strip .    00 j.  faust and r.  s.  larsen , nucl .",
    "instrum .",
    "* 116 * ( 1974 ) 365 a.  r.  baldwin and r.  madey , nucl .",
    "* 171 * ( 1980 ) 149 v.  d.  sandberg _ et al . _ ,",
    "instrum .",
    "a * 234 * ( 1985 ) 512 .",
    "t.  yoshioka , m.  nomachi , a.  artamanov , b.  bhuyan , j.  s.  frank , t.  fujiwara , k.  higa , s.  h.  kettell _ et al .",
    "_ , ieee trans .",
    "* 51 * ( 2004 ) 334 - 339 .",
    "p.  abbon _ et al .",
    "_ [ compass collaboration ] , nucl .",
    "instrum .",
    "a * 577 * ( 2007 ) 455 [ arxiv : hep - ex/0703049 ] . c.  bernet _ et al . _ ,",
    "instrum .",
    "a * 550 * ( 2005 ) 217 .",
    "s.  bartknecht , _ et al .",
    "_ , + nucl.instr.and meth.a(2010),doi:10.1016/j.nima.2010.03.052    xilinx inc . ,",
    "virtex-5 fpga user guide , 2009 xilinx inc .",
    ", virtex-5 fpga data sheet : dc and switching characteristics , 2009 xilinx ise design suite , http://www.xilinx.com/support/download/index.htm j.  bieling , diploma thesis , 11/2010 , universitt bonn , accessible at http://wwwcompass.cern.ch/compass/publications/welcome.html#theses"
  ],
  "abstract_text": [
    "<S> this article describes the implementation of a mean - timer and coincidence logic on a virtex-5 fpga for trigger purposes in a particle physics experiment . </S>",
    "<S> the novel feature is that the mean - timing and the coincidence logic are not synchronized with a clock which allows for a higher resolution of approximately 400 ps , not limited by a clock frequency .    </S>",
    "<S> fpga , mean - timing , coincidence logic , trigger , asynchronous , unclocked logic </S>"
  ]
}