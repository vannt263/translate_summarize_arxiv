{
  "article_text": [
    "is a modular design of a pcierdmanic supporting different network links , namely standard gbe(1000base - t ) and 10-gbe(10base - r ) , besides custom 34  gbps apelink  @xcite and 2.5  gbps deterministic latency optical km3link  @xcite .",
    "the design includes a network stack protocol offload engine yielding a very stable communication latency , a feature making nanetsuitable for use in contexts ; nanetgpudirectrdmacapability , inherited from the apenet+3d torus nic dedicated to hpc systems  @xcite , extends its into the world of gpgpu heterogeneous computing .",
    "nanetdesign is partitioned into 4 main modules : _",
    "i / o interface _ , _ router _ , _ network interface _ and _ pciecore _ ( see fig .",
    "[ fig : nanet ] ) .",
    "i / o interface module performs a processing on the data stream : following the osi model , the physical link coding stage implements , as the name suggests , the channel physical layer ( _ e.g._1000base - t ) while the protocol manager stage handles , depending on the kind of channel , data / network / transport layers ( _ e.g._time division multiplexing or udp ) ; the data processing stage implements application dependent transformations on data streams ( _ e.g._performing compression / decompression ) while the apenet protocol encoder performs protocol adaptation , encapsulating inbound payload data in apelinkpacket protocol , used in the inner nanetlogic , and decapsulating outbound apelinkpackets before their payload in output channel transport protocol ( _ e.g._udp ) .    the router module supports a configurable number of ports implementing a full crossbar switch responsible for data routing and dispatch .",
    "number and of the switch ports and the routing algorithm can each be defined by the user to automatically achieve a desired configuration .",
    "the router block dynamically interconnects the ports and comprises a fully connected switch , plus routing and arbitration blocks managing multiple data flows @2.8  gb / s    the _ network interface _ block acts on the trasmitting side by gathering data coming in from the pcieport and forwarding them to the router destination ports while on the receiving side it provides support for rdmain communications involving both the host and the gpu ( via the dedicated _ gpu i / o accelerator _",
    "module ) . a nios  ii@xmath0controller in included to support configuration and runtime operations .",
    "finally , the pciecore module is built upon a powerful commercial core from plda that sports a simplified but efficient backend interface and multiple dma engines .    as will be shown in the following",
    ", this general architecture has been specialized to be employed in several contexts , and implemented on several devices : alterastratix iv and v fpga development kit and terasic de5-netboard .",
    "the na62 experiment at cern  @xcite aims at measuring the branching ratio of the decay of the charged kaon into a pion and a pair .",
    "the na62 goal is to collect @xmath1 events with a signal to background ratio 10:1 , using a novel technique with a ( 75  gev ) unseparated hadron beam decaying in flight . in order to manage the data stream due to",
    "a @xmath2 10  mhz rate of particle decays illuminating the detectors , a set of trigger levels will have to reduce this rate by three orders of magnitude .",
    "the entire trigger chain works on the main digitized data stream  @xcite .",
    "the low - level trigger ( l0 ) , implemented in hardware by means of fpgas on the readout boards , reduces the data stream by a factor 10 to meet the maximum design rate for event readout of 1  mhz .",
    "the upper trigger levels ( l1 and l2 ) are on a commodity pc farm for further reconstruction and event building .    in the standard implementation ,",
    "the fpgas on the readout boards compute simple trigger primitives on the fly , such as hit multiplicities and rough hit patterns , which are then and sent to a central processor for matching and trigger decision .",
    "thus the maximum latency allowed for the synchronous l0 trigger is related to the maximum data storage time available on the data acquisition boards . for na62",
    "this value is up to 1  ms , in principle allowing use of more compute demanding implementations at this level , _ i.e._the gpus .    as a first example of gpu application in the na62 trigger system we studied the possibility to reconstruct rings in the rich .",
    "the rich l0 trigger processor is a synchronous level and the possibility to use the gpu must be verified . in order to test feasibility and performances , as a starting point 5 algorithms for single ring finding in a sparse matrix of 1000 points ( centered on the pms in the rich spot ) with 20 firing pms ( `` hits '' ) on average",
    "have been implemented .",
    "results of this study are available in  @xcite and show that gpu processing latency is stable and reproducible once data are available in the device internal memory .    in order to fully characterize latency and throughput of the rich l0 trigger processor ( grl0tp ) ,",
    "data communication between the detector readout boards ( tel62 ) and the l0 trigger processor ( l0tp ) need to be kept under control .",
    "the requisite on bandwidth is 400@xmath3700  mb / s , depending on the final choice of the primitives data protocol which in turn depends on the amount of preprocessing actually to be implemented in the tel62 fpga .",
    "therefore , in the final system 4@xmath36 gbelinks will be used to extract primitives data from the readout board towards the l0tp .",
    "the nic was integrated in the grl0tp prototype , using the `` system loopback '' setup described in section  [ sec : perf ] .",
    "the is a pciegen2 x8 nic featuring a standard gbeinterface implemented on alterastratix iv fpga development kit ( see fig .",
    "[ fig : board ] ) . a custom mezzanine mounting 3 qsfp+ connectors ,",
    "was designed to be optionally mounted on top of the alteraboard and makes able to manage 3 apelinkchannels with switching capabilities up to 34  gbps .",
    "apelinkadopts a proprietary data transmission word stuffing protocol ; this is pulled for free into .",
    "the gbetransmission system follows the general i / o interface architecture description of fig .",
    "[ fig : nanet ] .",
    "the alteratriple speed ethernet megacore ( tse mac ) is the physical link coding , providing complete 10/100/1000  mbps ethernet ip modules .",
    "the _ udp offloader _ analyzes and interprets the data protocol .",
    "it deals with udp packets payload extraction and provides a wide channel achieving 6.4  gbps which is a 6 times greater bandwidth than what the standard gberequires .",
    "the data coming from tse mac are collected by the udp offloader through the alteraavalon streaming interface and redirected into the nanethardware processing data path , avoiding the use of the the fpga @xmath0controller ( nios  ii ) from udp traffic management .",
    "the _ nanetcontroller _ translates the data packets into apenet+encapsulated ones , then hands them over to the network interface that takes care of moving them to their gpu memory buffer destination .",
    "performances were assessed on a supermicro superserver .",
    "the setup comprised a ( tylersburg chipset  intel 5520 ) dual socket motherboard , 2 intel 82576 gbeports and nvidiam2070 gpu ; sockets were populated with intel xeon x5570 @2.93  ghz .",
    "the host simulates the ro board by sending udp packets containing primitives data from the host system gbeport to the gbeport hosted by , which in turn streams data directly towards clops in gpu memory that are sequentially consumed by the cuda kernel implementing the ring reconstruction algorithm .",
    "this measurement setup is called `` system loopback '' . exploiting the x86 time stamp counter ( tsc )",
    "register as a common time reference , it was possible in a single process test application to measure latency as time difference between when a received buffer is signalled to the application and the moment before the first udp packet of a bunch ( needed to fill the receive buffer ) is sent through the host gbeport .",
    "communication and kernel processing tasks were serialized in order to perform the measure ; this represents a situation : given rdma capabilities , during normal operation this serialization does not occur and kernel processing seamlessly overlaps with data transfer . similarly , we closed in a loopback configuration two of the three available apelinkports and performed the same measurement .            in fig .",
    "[ fig : latenza_nanet_fermi ] latencies for varying size buffer transfers in gpu memory using the gbelink are represented .",
    "besides the smooth behaviour increasing receive buffer sizes , fluctuations are minimal , matching both constraints for and , compatibly with link bandwidth , on data transfers ; for a more detailed performance analysis , see  @xcite .",
    "bandwidth and latency performances for apelinkchannel are in fig .",
    "[ fig : latenza_apelink ] .",
    "it is clear that the system remains within the 1  ms time budget with gpu receive buffer sizes in the @xmath4  events range .",
    "although real system physical link and data protocol were used to show the behaviour on , we measured on a reduced bandwidth single gbeport system that could not match the 10  mevents / s experiment requirement for the grl0tp .    to demonstrate the suitability of design for the rich l0tp",
    ", we decided to perform equivalent benchmarks using one of its apelinkports instead of the gbeone .",
    "current implementation of apelinkis able to sustain a data flow up to @xmath5  gbps .",
    "results for latency of the rich l0tp are shown in fig .",
    "[ fig : latenza_apelink ] : a single apelinkdata channel between rich ro and grl0tp systems roughly matches trigger throughput and latency requirements for receiving buffer size in the @xmath6  kevents range .",
    "km3net - itis an underwater experimental apparatus for the detection of high energy neutrinos in the tev@xmath3pev range based on the erenkovtechnique .",
    "the detector measures the visible erenkovphotons induced by charged particles propagating in sea water at speed larger than that of light in the medium , and consists of an array of photomultipliers ( pmt ) .",
    "the charged particle track can be reconstructed measuring the time of arrival of the erenkovphotons on the pmts , whose positions must be known .",
    "the km3net - itdetection unit is called _ tower _ and consists of 14  floors vertically spaced 20  meters apart .",
    "the floor arms are about 8  m long and support 6 glass spheres called optical modules ( om ) : 2 oms are located at each floor end and 2 oms in the middle of the floor ; each om contains one 10  inches  pmt and the electronics needed to digitize the pmt signal , format and transmit the data .",
    "each floor hosts also two hydrophones , used to reconstruct in the om position , and , where needed , oceanographic instrumentation to monitor site conditions relevant for the detector .",
    "all data produced by oms , hydrophones , and instruments , are collected by an electronic board contained in a vessel at the centre of the floor ; this board , called _ floor control module _ ( fcm ) manages the communication between the laboratory and the underwater devices , also distributing the timing information and signals .",
    "timing resolution is fundamental in track reconstruction , _ i.e._pointing accuracy in reconstructing the source position in the sky .",
    "an overall time resolution of about 3  ns yields an angular resolution of 0.1  degrees for neutrino energies greater than 1  tev",
    ". such resolution depends on electronics but also on position measurement of the oms , which is , in fact , continuously tracked .    the spatial accuracy required should be better than 40  cm .",
    "the daq architecture is heavily influenced by the need of a common timing distributed all over the system in order to correlate signals from different parts of the apparatus with the required nanosecond resolution .",
    "the aim of the data acquisition and transport electronics is to label each signal with a `` time stamp '' , _",
    "i.e._the hit arrival time , in order to reconstruct tracks .",
    "this need implies that the readout electronics , which is spatially distributed , require common timing and a known delay with respect to a fixed reference .",
    "the described constraints hinted to the choice of a synchronous link protocol which embeds clock and data with a deterministic latency ; due to the distance between the apparatus and shoreland , the transmission medium is forced to be an optical fiber .",
    "all floor data produced by the oms , the hydrophones and other devices used to monitor the apparatus status and the environmental conditions , are collected by the floor control module ( fcm ) board , packed together and transmitted through the optical link .",
    "each floor is independent from the others and is connected by an optical bidirectional virtual connection to the laboratory .    the data stream that a single floor delivers to shore has a rate of @xmath2300  mbps , while the communication data rate is much lower , consisting only of data for the apparatus .",
    "to preserve optical power budget , the link speed is operated at 800  mbps , which , using an 8b10b encoding , accounts for a 640  mbpsof user payload , well beyond experimental requirement .",
    "each fcm needs an communication endpoint counterpart .",
    "the limited data rate per fcm compared with link technologies led us to designing nanet@xmath7 , an readout board able to manage multiple fcm data channels .",
    "this design represents a nanetcustomization for the km3net - itexperiment , adding support in its i / o interface for a synchronous link protocol with deterministic latency at physical level and for a time division multiplexing protocol at data level ( see fig .",
    "[ fig : nanet ] ) .      the first stage design for nanet@xmath7was implemented on an evaluation board from terasic",
    ", the de5-netboard , which is based on alterastratix - v  gx fpga , supports up to 4  sfp+ channels and a pciex8 edge connector .",
    "the first constraint to be satisfied requires having a time delta with nanosecond precision between the wavefronts of three clocks :    * the first clock is an reference one ( typically coming from a gps and redistributed by custom fanout boards ) and is used for the optical link transmission from nanet@xmath7towards the underwater fcm ; * the second clock is recovered from the incoming data stream by a cdr module at the receiving end of the fcm which uses it for sending its data payload from the apparatus back ; * a third clock is again recovered by nanet@xmath7while decoding this payload at the end of the loop .",
    "the link established in this way is fully synchronous .",
    "the second fundamental constraint is the deterministic latency that the alterastratix device must enforce  as the fcm does  on both forward and backward path to allow correct time stamping of events on the pmt .    in this way",
    ", the nanet@xmath7board plays the role of a bridge between the 4 fcms and the fcmserver  _ i.e._the hosting pc  through the pciebus .",
    "control data en route to the underwater apparatus are correctly sent over the pciebus to the nanet@xmath7board , which then routes the data to the required optical link . on the opposite direction , both control and hydrophones data plus signals from the boards",
    "are extracted from the optical link and on the pciebus towards an application managing all the data .",
    "since the data rate supported by the pciebus is much higher than the data produced by the electronics , we foresee to develop a custom board supporting more than 4 optical links . on the other hand , the gpudirectrdmafeatures of nanet , fully imported in nanet@xmath7design , will allow us , at a later stage , to build an effective , , platform , in order to investigate improved trigger and data reconstruction algorithms .    at a higher level ,",
    "two systems handle the data that come from and go to : the trigger system , which is in charge of analysing the data from pmts extracting meaningful data from noise , and the data manager , which controls the apparatus .",
    "the fcmserver communicates with these two systems using standard 10-gbenetwork links .",
    "preliminary results show that the interoperability between different vendors fpga devices can be achieved and the timing resolution complies with physics requirements .",
    "+ we develop a test setup to explore the fixed latency capabilities of a complete links chain .",
    "+ we leverage on the fixed latency native mode of the alteratransceivers and on the hardware fixed latency implementation for xilinx device  @xcite .",
    "the testbed is composed by the nanet@xmath7board and the fcm board respectively emulating the and boards connected by optical fibers ( see fig .",
    "[ fig : testbed ] ) .",
    "+    testbed . ]",
    "the external clock has been input to the nanet@xmath7to clock the transmitting side of the device .",
    "a sequence of dummy parallel data are serialised , 8b/10b encoded and transmitted , together with the embedded serial clock , at a data rate of 800  mbps along the fiber towards the receiver side of the fcm system .",
    "the fcm system recovers from the received clock and transmits the received data and recovered clock back to the nanet@xmath7boards .",
    "lastly , the received side of nanet@xmath7deserializes data and produces the received clock .",
    "+ the way to test the fixed latency features of the serdes hardware implementation is quite easy taking into account that every time a new initialisation sequence , following an hardware reset or a powerup of the serdes hardware , has been done , we should be able to measure the same phase shift between transmitted and received clock , equal to the fixed number of serial clock cycles shift used to correctly align the deserialised data stream .",
    "[ fig : fixed_lat ] is a picture taken from scope acquisition in infinity persistence showing the results of a preliminary 12  h test where every 10  s a new _ reset and align _ procedure has been issued .",
    "the nanet@xmath7transmitter parallel clock ( the purple signal ) maintains exactly the same phase difference with the receiver parallel clock ( the yellow signal ) and with the fcm recovered clock ( the green signal ) .",
    "serdes : the plot scope shows the phase alignment of the transmitting ( purple ) and receiving ( yellow ) parallel clocks after 12  h test of periodic reset and initialisation sequence . ]",
    "our nanetdesign proved to be efficient in performing data communication between the na62 rich readout system and the gpu - based l0 trigger processor over a single gbe link .",
    "preliminary results of its customization for the data transport system of the km3net - itexperiment shows that the fundamental requirement of a deterministic latency link can be implemented using nanet , paving the way to the use of hybrid trigger and data reconstruction systems .",
    "10 gbe board , currently under development , will allow for a full integration of our architecture in the na62 experiment and smooth the path to nanetusage in other contexts .",
    "r.  ammendola , a.  biagioni , o.  frezza , a.  lonardo , f.  l. cicero , p.  s. paolucci , d.  rossetti , f.  simula , l.  tosoratto , and p.  vicini , _",
    "apenet+ 34 gbps data transmission system and custom transmission logic _ , _ journal of instrumentation _ * 8 * ( 2013 ) , no .  12 c12022 .",
    "a.  aloisio , f.  ameli , a.  damico , r.  giordano , v.  izzo , and f.  simeone , `` the nemo experiment data acquisition and timing distribution systems , '' in _ nuclear science symposium and medical imaging conference ( nss / mic ) , 2011 ieee _ , oct 2011 , pp . 147152 .",
    "r.  ammendola , a.  biagioni , o.  frezza , f.  l. cicero , a.  lonardo , p.  s. paolucci , d.  rossetti , f.  simula , l.  tosoratto , and p.  vicini , `` apenet+ : a 3d torus network optimized for gpu - based hpc systems , '' _ journal of physics : conference series _",
    "396 , no .  4 , p. 042059",
    "[ online ] .",
    "available : http://stacks.iop.org/1742-6596/396/i=4/a=042059        g.  collazuol , g.  lamanna , j.  pinzino , and m.  s. sozzi , `` fast online triggering in high - energy physics experiments using gpus , '' _ nuclear instruments and methods in physics research a _ , vol .",
    "662 , pp . 4954 , jan .",
    "r.  ammendola , a.  biagioni , o.  frezza , g.  lamanna , a.  lonardo , f.  l. cicero , p.  s. paolucci , f.  pantaleo , d.  rossetti , f.  simula , m.  sozzi , l.  tosoratto , and p.  vicini , `` nanet : a flexible and configurable low - latency nic for real - time trigger systems based on gpus , '' _ journal of instrumentation _",
    "9 , no .  02 , p. c02023 , 2014 .",
    "[ online ] .",
    "available : http://stacks.iop.org/1748-0221/9/i=02/a=c02023"
  ],
  "abstract_text": [
    "<S> while the gpgpu paradigm is widely recognized as an effective approach to high performance computing , its adoption in , systems is still in its early stages .    </S>",
    "<S> although gpus typically show deterministic behaviour in terms of latency in executing computational kernels as soon as data is available in their internal memories , assessment of features of a standard gpgpu system needs careful characterization of all subsystems along data stream path . </S>",
    "<S> the networking subsystem results in being the most critical one in terms of absolute value and fluctuations of its response latency .    </S>",
    "<S> our envisioned solution to this issue is nanet , an pcienetwork interface card ( nic ) design featuring a configurable and extensible set of network channels with direct access through gpudirectto nvidia fermi / kepler gpu memories .    </S>",
    "<S> nanetdesign currently supports both standard - gbe(1000base - t ) and 10-gbe(10base - r ) - and custom - 34  gbps apelinkand 2.5  gbps deterministic latency km3link - channels , but its modularity allows for a straightforward inclusion of other link technologies .    to avoid host os intervention on data stream and remove a possible source of jitter , </S>",
    "<S> the design includes a network / transport layer offload module with , latency , supporting udp , km3link time division multiplexing and apelinkprotocols .    </S>",
    "<S> after nanetarchitecture description and its latency / bandwidth characterization for all supported links , two real world use cases will be presented : the low level trigger for the rich detector in na62 experiment at cern and the data link for km3 underwater neutrino telescope .    </S>",
    "<S> results of nanetperformances in both experiments will be reported and discussed . </S>"
  ]
}