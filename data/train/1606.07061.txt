{
  "article_text": [
    "the analysis of intrinsic galaxy clustering inherently relies on accurate sample density calibration .",
    "any fluctuations in the density of galaxies caused by mis - calibration have the potential to be misinterpreted as being of astrophysical origin , which would bias measurements . for cosmological applications",
    "it is large - scale relative calibration that is important , as the signal lies in the fractional variation of galaxy density , rather than the absolute value .",
    "it is also not the calibration of individual galaxies that is important , but large - scale variations of the average calibration .",
    "such relative calibration has been shown to be a dominant systematic in current large - scale clustering measurements from the sloan digital sky survey ( sdss ) @xcite and the dark energy survey ( des ) @xcite .    for galaxy surveys using photometric redshifts , or spectroscopic samples where targets are selected from imaging data , any angular mis - calibration of the",
    "photometry directly translates into spatial fluctuations in the resulting spectroscopic catalogue . for spectroscopic surveys",
    ", we also have to calibrate observation - dependent variations in redshift measurement efficiency . the cmass sample from the baryon oscillation spectroscopic survey @xcite , part of sdss - iii @xcite ,",
    "has an average classification completeness of 96% .",
    "the high completeness means that variations in spectral signal - to - noise only have a small effect on the measured catalogue , as most redshift measurements are secure even at lower signal - to - noise .",
    "future surveys , which propose to make spectral measurements that have emission line signal - to - noise that is closer to the limit required for redshift measurement , will be more sensitive to spectrophotometric calibration , and have lower overall completeness .",
    "i.e. the calibration is sensitive to the gradient @xmath0 at the emission line signal to noise ( snr ) required for redshift measurement .",
    "therefore the local flux limits in the survey , or equivalently , the local magnitude zero - points must be determined and corrected .",
    "this is the process of calibration .",
    "euclid @xcite is the second medium - size ( m - class ) mission in the esa cosmic visions program and will cover two primary probes of cosmic large - scale structure : weak lensing and gravitational clustering .",
    "based on these two probes , euclid will map out the underlying distribution of dark matter in the universe , as well as constrain the cosmic expansion history and therefore the equation of state parameter of dark energy .",
    "for each probe the telescope will simultaneously investigate , a separate instrument is being built : the visual ( vis ) instrument @xcite for imaging in the optical , and the near - infrared spectroscope and photometer ( nisp ) instrument @xcite for imaging and slit - less spectroscopy in the near infra - red ( nir ) . in order to achieve its scientific goals",
    ", the euclid mission must be optimised in a way that balances the requirements of these two primary probes , with additional science goals .",
    "euclid will undertake a slit - less spectroscopic galaxy survey using a nir grism in the light path to decompose incident light .",
    "a detection in the nir - imaging data will be used to locate the galaxies and provide the baseline for the wavelength solution for the nir slit - less spectroscopy .",
    "the response of the grism is designed to enable the detection and wavelength measurement of the h-@xmath1 line emitted by galaxies with redshifts @xmath2 . whereas strong fluctuations in the calibration of the nir imaging data may scatter galaxies back across this detection threshold",
    ", we do not expect many galaxies for which we will have h-@xmath1 detections failing to be detected in a stacked nir - image .",
    "therefore the dominant dependence will be on the spectrophotometric calibration of the grism observations .",
    "a review of the systematic uncertainties that need to be removed from ground - based ccd surveys is presented in @xcite and references therein , which also compares calibration procedures . in general",
    ", the calibration of measurements can proceed in a number of ways .",
    "the traditional method for calibration is to match observations to standards with known brightnesses , which is good at fixing the absolute calibration of individual objects .",
    "however , in order to calibrate a survey using such a methodology , many observations of standards are required , with the observing frequency dependent on the rate of drift in the measurement response .",
    "an alternative is self - calibration , where measurements of the same object , taken using different overlapping exposures within a single survey are used to limit variations between exposures ( e.g. * ? ? ?",
    "such methods are good at removing small - scale variations , but can have limited sensitivity to large - scale drifts in calibration , which are spread into a coherent small offsets in a large number of overlaps .",
    "this is a function of survey strategy .",
    "thus , regular observations of standards are still required , but with lower frequency , to correct the large - scale drifts .",
    "recently , @xcite employed and expanded upon the approach of @xcite , looking at the impact on survey design and possible other extensions of the procedure .",
    "the procedure has been applied in the cases of two ground - based surveys : sdss and panstarrs-1 ( ps1 , * ? ? ?",
    "however , euclid is a space - based step - and - stare survey .",
    "therefore its calibration will not use large , interwoven , contiguous scans to connect the different survey regions and epochs .",
    "this will be achieved by returning to the same field(s ) to monitor the long - term instrument stability on large space- and time - scales and with small overlaps of adjacent fields to ensure the stability between those visits .",
    "the overlap - based _ ubercalibration _ procedure developed by @xcite was applied to the sdss imaging data and provided relative photometry of the order of 1% .",
    "the procedure performs a likelihood maximisation , jointly fitting for the parameters of their calibration model , having marginalised over the magnitudes of stars in overlap regions .",
    "the calibration model was designed to combine knowledge of the frequency of different potential calibration changes and their form , with free parameters to quantify the amplitudes .",
    "here , we consider a similar approach for calibrating the relative spectrophotometric component of the euclid survey , for a set of different observing strategy configurations . for this component , we do not yet have a good model for the expected variations in detector response , and so we consider two models where the magnitude zero - point calibration is independently determined for each full focal plane exposure , or for each detector in each exposure .",
    "we assume that the absolute calibration will be done independently .",
    "the absolute calibration can be considered to be on the largest scale - that of the entire survey , but this is not discussed in this paper . assuming the absolute calibration has determined the total zero - point of the survey , the remaining non - uniformity of the survey zero - points",
    "can be mitigated with relative calibration , which is our subject of discussion .",
    "we further split the relative calibration into three types of scales : large , intermediate and small .",
    "the small scales are essentially only the pixel - to - pixel flat - field uncertainties as considered in @xcite .",
    "the intermediate , considered in this paper are the variations in the zero points of the individual exposures or at least detector tiles of the survey .",
    "we leave the consideration of the very largest scale , long term stability of the calibration to future work .",
    "this paper presents a study on the optimisation of the observing strategy for the isolated purpose of spectro - photometric calibration .",
    "we describe an overlap - based model for relative calibration set up to test the impact of the observing strategy on this type of calibration .",
    "we have based our model observing strategies on some of the expected euclid configuration parameter values , but we also made several simplifications , since we are only interested in the relative results .",
    "the final euclid strategy has to take into account the visible channel as well as other limitation on survey strategy to optimise joint measurements . indeed ,",
    "in this paper we consider parts of the parameter space that are presently forbidden for the full euclid case .",
    "however , this is justified since we expect that parts of this space may become accessible in the future due to developments during the euclid optimisation phase .",
    "we construct a simplified model of the euclid spectroscopic survey with a random set of zero - point errors and describe the simulation procedure in . in",
    "we calculate the posterior distribution of the calibration parameters and show the simplifications we make to find the optimal solution . in",
    "we describe the spectroscopic component of the euclid survey and our simplified model of it .",
    "we also describe the considered dither strategy and instrumental setup .",
    "we then attempt to perform an _ ubercalibration _ of our synthetic survey by finding a new , corrected set of zero - points by minimizing a @xmath3-like mis - calibration cost function .",
    "in we present the results of our simulations of the relative self - calibration procedure .",
    "we summarise and conclude in .",
    "we would like to simulate a realistic yet simplified synthetic survey with a set of offsets of exposure zero - points to be calibrated , one for each exposure taken .    to do this ,",
    "we firstly take an input survey configuration and use the https://github.com/mollyswanson/mangle[mangle code ] @xcite to create the survey geometry by inputting a list of rectangles in the form of mangle polygons , representing the overlapping sets of exposures of the individual nir detectors .",
    "we then balkanise them into unique , non - overlapping regions , which we call * overlap tiles * , while keeping track of the set of detectors that cover each of them .",
    "we then treat these overlap tiles separately .",
    "we discard any tiles that are covered with one or no passes .",
    "we describe the implementation of this geometry further in .",
    "secondly , we create the synthetic sky divided into overlap tiles , from the information about stellar calibrator populations . for the case of our simplified model of the spectroscopic component of euclid ,",
    "the calibrator populations are described in .",
    "we employ the simplification of only generating average magnitudes optimally weighted over all the calibrator populations in each overlap tile , so that we may simulate only one value and its uncertainty per overlap , thereby speeding up the calculation of the calibration fit .",
    "this is described in more detail below in .",
    "_ nota bene _ , when creating the synthetic calibrator stars for the use in our simplified ubercalibration we never generate individual dispersed spectra .",
    "our analysis starts at the point where spectra - or parts of them - have been integrated over , the fluxes converted to magnitudes , and the magnitudes averaged over the overlap tile . for this , we neglect edge effects caused by the different dispersion directions , and assume that we can calibrate using any part of the spectrum that falls into the overlap region with an accuracy depending on the amount of that spectrum in the overlap region .",
    "in other words , we are effectively generating weighted mean magnitude of all the pixels in an exposure that we expect to belong to stars .",
    "hence , the number of calibrators that can be used can be approximated by the number of calibrators with coordinates in the overlap region .",
    "+ indeed , working with the full spectrum may enable us in the future to consider a chromatic dependence of the calibration and therefore enable the study of the color - dependent stability .",
    "we leave this to future work .",
    "we add the simulated average stellar calibrator fluxes to a _ randomly distributed _ set of initial calibrations or initial zero - point errors of the full field - of - view exposures .",
    "the initial distribution is assumed to have a width of @xmath4 millimagnitudes ( mmag ) in @xmath5 magnitude , which corresponds to a 4% scatter between the measured flux of full field - of - view exposures ( as we show below in ) .",
    "+ it is important to note that such an initial scenario of random and independent initial zero - point scatter is unrealistic and should be considered as the most significant approximation of this paper .    finally , we perform our calibration procedure , which we describe in more detail in and find the standard deviation of the best - fit set of exposure calibration parameters @xmath6 , which we call the final scatter , @xmath7 .",
    "we use this as a quality metric for the final uniformity of the survey ( i.e. decrease in the scatter of the residual zero - point ) after our procedure .",
    "note that the @xmath8 here represent the scatter around the survey mean , since we d like to exclude any absolute calibration error from our consideration .",
    "we are only concerned with the resulting survey uniformity .    for simplicity and clarity we first simulate the calibration of entire exposures , taking the zero - point to be uniform over the focal - plane , not varying among detectors . in the second step we consider the relative calibration of individual detectors to see how much our resulting calibration scatter degrades .",
    "we report on the results in .",
    "we now describe our simplified approach to modelling the incident calibrator brightness , the error on its measurement and the zero - point off - set in the measurement before relative calibration .",
    "we simulate both the measurement errors ( ) and the zero - point off - sets of individual full - focal plane exposures ( ) below by generating them from their respective gaussian distributions .",
    "we justify this by first discussing the model in terms of the spectrophotometric flux , which is relevant particularly in our case of slit - less spectroscopy measurement .",
    "we convert the fluxes and their scatter to magnitudes as is also done in the case of pure photometric measurements by @xcite .",
    "ordinarily , we would like to make several measurements , @xmath9 of the fluxes of our calibrator stars , @xmath10 .",
    "we would like to compare these measurements between the different exposures , @xmath11 to calibrate the exposures , optimising for this task rather than for the optimal measurement of the true fluxes .",
    "following @xcite , we construct the following measured , @xmath9 , and calibrated , @xmath12 , quantities : @xmath13 where @xmath14 is the multiplicative calibration and @xmath15 is the total dark current of exposure @xmath11 .",
    "here we assume that there is no variation in the calibration across the detectors i.e. @xmath16 where @xmath17 and @xmath18 are the pixel coordinates within the detector image of exposure @xmath11 ( such variation was studied by * ? ? ?",
    "* we briefly revisit their method with an updated configuration in in the appendix ) .",
    "this assumption is a reasonable approximation at this stage as we expect that the pixel - to - pixel flat - fields will be constrained otherwise and that the fluctuations of fluxes within the detector are strongly dominated by the fluctuations in the true fluxes of the calibrator objects .",
    "therefore we leave the impact of the ( possibly time - dependent ) flat - field uncertainty on the calibration to future study .    for self - calibration , we are only interested in obtaining the @xmath14 from and regard the true stellar fluxes , @xmath19 as nuisance parameters .",
    "we assume the dark current to be successfully subtracted prior to calibration , so we let @xmath20 in .",
    "we then take the @xmath21 of ( cancelling the reference object flux ) and work with magnitudes from now on .      the relative flux calibration",
    ", @xmath14 now becomes an additive constant , @xmath22 : @xmath23    before moving on to the likelihood , let us consider the distribution of calibrations .",
    "we can show that the width of the assumed gaussian distribution , @xmath24 of the exposure calibrations in magnitude , @xmath22 relates to the width , @xmath25 of the assumed lognormal distribution of absolute calibrations residuals in flux ( magnitude zero - points ) , @xmath14 : @xmath26 since @xmath27 can be assumed by requiring the absolute calibration to have been corrected perfectly beforehand by subtracting the average flux over the whole survey ( see also in the appendix ) . in words",
    ", this means that the scatter in the fractional flux variation from calibration equals the variation of additive magnitude calibrations .",
    "note that the @xmath14 and therefore the @xmath22 are not measurement errors , but rather the set of parameters to be determined",
    ". their distribution should therefore be used as a prior .",
    "+ we now also assume that the measurements are distributed as according to a gaussian distribution around the true value of the magnitude . we can construct a multivariate likelihood from the assumed probability distribution of residual `` miscalibrations '' , @xmath28 .",
    "the likelihood will reach a maximum when the measured and calibrated magnitude @xmath29 is precisely correct , i.e. equal to the true stellar magnitude @xmath30 : @xmath31 and have the width @xmath32 for each of the stars , @xmath33 and exposures @xmath11 .",
    "the number of dimensions of the multivariate distribution will equal the number of stars plus the number of exposures , @xmath34 .",
    "one may be inclined to assume that i ) the true stellar brightnesses are completely independent , ii ) that there is no cross - covariance between the stars and exposures and iii ) that the exposure calibrations are independent from each other .",
    "the easiest to immediately justify is assumption i ) .",
    "assumption ii ) on the other hand can be understood as writing the variance of the @xmath28 as : @xmath35 where the @xmath36 is the measurement scatter in a pixel , at @xmath37 in the focal plane within exposure @xmath11 .",
    "the @xmath37-dependence is excluded from our analysis , because this flat - field calibration will be done using other calibration techniques as mentioned above , therefore @xmath38 .",
    "it is important to note that the dependence of the exposure - to - exposure variance on the star index , @xmath33 is artificial due to selecting calibrator star image pixels from the full exposure .",
    "below , in , we easily integrate out the @xmath39-dependence , by averaging over all the calibrators in an overlap - tile .",
    "+ finally , in order to assume independence of adjacent exposures ( iii ) , we must assume that the model of the decay in the detector response is either negligible or effectively fully understood .",
    "the first is unlikely to be the case , which in fact brings about the motivation for self - calibration and this paper .",
    "we adopt the second assumption for now , and leave the discussion to further work as it requires better models of long term behaviour of the instrument , but we stress here , that this stands to introduce a strong limit on the capability of the relative calibration procedure . note that our notation is such that flux - related variables are capitalised and those in lower case are related to magnitudes .",
    "we note that our approach differs somewhat from that of @xcite .",
    "firstly , the spectrophotometric model we are using is simpler , because we are considering a space - based survey , where the complex atmospheric effects do not apply .",
    "secondly , we are considering different detectors .",
    "whereas sdss imaging used charge - coupled devices ( ccds ) , euclid spectroscopy will be using h2rg nir detectors @xcite .",
    "this means that the noise model will differ .",
    "however this is not relevant for the present modelling due to the simplifications we make .",
    "the final difference is our simplification , which optimises for the measurement of the exposure calibrations and averages out any information about the individual fluxes of the calibrator stars .    throughout the paper we use 4 types of indices : @xmath33 always indexes stars , @xmath11 exposures , @xmath40 overlap tiles and @xmath41 stellar types or `` populations '' .      we propose to simplify the simulation of calibrator stars needed for the ubercalibration procedure . instead of generating the individual stars ( indexed with @xmath33 ) from a known distribution ( see ) ,",
    "we produce a single , weighted measurement for a contiguous region of the field of view ( fov ) , where we assume the calibration value will be uniform .",
    "ultimately the shape and size of such a region depends on our division of the calibration into different scales .",
    "a sensible choice for such a regions is what we call an overlap tile or overlap region .",
    "such overlap tiles can be seen as different shaded rectangles ( depending on the level of coverage ) in .",
    "the full focal plane exposures are fragmented into detector - squares and detector - gap - rectangles , which are further divided into contiguous rectangles , each covered with the same set of exposures .",
    "we refer to these latter rectangles as overlap tiles and denote them with the index @xmath40 . in such small patches it can be assumed that the total stellar surface number density , @xmath42 const for @xmath43 , which is a conservative choice in calibrator density",
    ".    therefore we end up with a measured and calibrated set of @xmath40 tile means in exposure @xmath11 : @xmath44 where @xmath45 is the number of all stars with @xmath46 in the @xmath47 overlap tile and each @xmath48 is averaged over all stars , @xmath49 in an overlap tile , @xmath40 .    in practice",
    ", we do not simulate the individual stars in order to average over them , but find the @xmath48 from a weighted mean over the stellar populations in different brightness bins ( as we do in ) .",
    "assuming the magnitude scatter depends only on the magnitude bin , @xmath41 , @xmath50 we drop the index @xmath33 , assuming @xmath51 to be the same for all the magnitude bins , in and divide the sum in into @xmath41 sub - sums , each time summing over all the @xmath41-type stars in the area of the @xmath40-overlap , @xmath52 .",
    "we use the rms@xmath53 values of type - f stars in to be conservative as these have the largest scatter .",
    "we obtain the @xmath52 each time by drawing from a poisson distribution with mean  @xmath54 , having calculated the overlap - tile - area , @xmath55 from the survey geometry and the @xmath56 from below .",
    "the @xmath57 is the intrinsic , true scatter in magnitudes of @xmath41-type stars .",
    "+ note that such a division into populations is only done to simplify the simulation .",
    "when it comes to a real measurement of the stellar magnitudes , this weighting can be done with any other set of errors , which can be specified as it is deemed practical , which includes having individual weights for all the individual stars . in order to self - calibrate the survey using real data in the future",
    ", the full set of calibrator stars , including variable stars and other outliers will have to be considered . +",
    "then the mean measured flux of all the stars of brightness @xmath41 in exposure @xmath11 of overlap tile @xmath40 would be : @xmath58 and we can simply rewrite as a weighted average : @xmath59 where the poissonian optimal weights , @xmath60 .",
    "having assumed the rms due to detector noise is exactly the same in each exposure , @xmath11 in the survey .",
    "therefore , using and , having summed over the @xmath28 , the tile miscalibrations , @xmath61 are drawn from gaussian , @xmath62 with : @xmath63    since the ubercalibration procedure uses only the differences between calibrated and true or mean values , we only ever generate the @xmath64 from a gaussian with the width given in , having also generated the @xmath65 using a poissonian distribution of numbers of stars as described above .",
    "note that we have made several simplifying assumptions when we generated our synthetic calibrator averages .",
    "before using this approach one should weigh its advantages against the disadvantage of losing the ability to calibrate the flat - field . in our case , this is in fact a desirable outcome as we have assumed the flat - field ( or small - scale , pixel - to - pixel ) self - calibration will be achieved otherwise .",
    "we do not expect our relative analysis below to depend on these assumptions .",
    "we would like to find the maximum of the posterior probability distribution of the calibration values , irrespective of the true fluxes of the calibrator stars .",
    "if @xmath66 is the @xmath67 multivariate gaussian prior on our calibration and our stellar magnitude distribution , and @xmath68 the likelihood of the measured stellar magnitudes given the calibrations and the true values , we get the posterior probability for the set of the calibration and true values by bayes to be : @xmath69 however , we are only interested in the calibrations , @xmath22 of exposures @xmath11 .    similarly to the @xcite analysis , we would like to marginalise over the true values of the stellar magnitudes to obtain : @xmath70 it can be shown that using @xmath71 and below gives the @xmath72 of the final posterior ( modulo additive constants ) as : @xmath73 where we have rewritten the posterior as a function of the average over @xmath74 exposures . ] of each star , @xmath33 in order to obtain an estimator of the true stellar magnitude , @xmath30 : @xmath75 if the calibration correctly accounts for the systematic bias in the measurement , this estimator will by definition be unbiased .",
    "this simplifies the minimisation routine as we do not need to explicitly estimate calibrator brightnesses , but instead automatically marginalises over their values .",
    "the intermediate steps can be followed in in the appendix .",
    "finding the minimum of this with respect to the set of @xmath6 gives us an unbiased estimate of the calibrations .",
    "however , the width of their distribution can be estimated using the second derivative of only up to a bessel correction factor .    to speed up the calculation of the @xmath76 in by compressing our calibrator data to only retain the information relevant to the calibration we wish to perform",
    ", we use the quantities derived in . as we do not need the measurements of individual stars , but rather derive the calibrations from the comparisons of measurements between the same stars in different exposures",
    ", we can perform an optimally weighted averaging over a contiguous fragment of the sky that is imaged by the same set of exposures .",
    "this rectangle - shaped overlap tile must by definition be smaller than a detector image .",
    "note that this only works because we are interested in fixing the exposure - to - exposure variation in the calibration , leaving any pixel - to - pixel variation in the flat field to be constrained otherwise .",
    "we therefore split up the first sum in into @xmath77 sets of stars in the full survey : @xmath78 where @xmath79 is the number of stars , @xmath33 in overlap @xmath40 , @xmath80 is the mean of all calibrated measurements , @xmath11 of the stellar magnitude , and @xmath81 when star @xmath33 appears in overlap @xmath40 , but @xmath82 otherwise .",
    "then we can calculate the likelihood contribution to the effective @xmath3 as : @xmath83 where @xmath84 and where now @xmath85 is the number of exposures that contain the tile @xmath40 .",
    "it can be shown that minimising the @xmath3 in with either of the @xmath86 will give the same set of calibrations , @xmath22 with a modified distribution in non - minimum solutions .",
    "therefore , our final @xmath3 equation is : @xmath87 where in the first term the dependence on @xmath22 is in the @xmath88 .",
    "finding the set , @xmath6 that minimises this equation ( using ) therefore gives an optimal set of calibrations to use to correct the magnitude zero - points of the survey , @xmath89 .",
    "the euclid satellite mission will consist of 3 channels using the same 1.2 meter telescope : visual imaging , nir imaging photometry and slit - less nir spectroscopy .",
    "the latter two will be performed using an instrument with one set of nir detectors and filter - wheels to apply different photometric filters and spectroscopic grisms .",
    "the photometry will be in euclid y , j and h bands and the spectroscopy will cover the wavelength range of 12,500 - 18,500  . in this paper , we consider only the relative calibration of the spectroscopic channel , but this analysis could in principle easily be extended to the other two .",
    "each spectroscopic * exposure * will have a fov covered by a @xmath90 array of h2rg nir detectors @xcite .",
    "the baseline survey strategy will be step - and - stare with slightly overlapping adjacent pointings , each pointing will be dithered 3 times to cover each field with approximately 4 dithered exposures .    to test calibration strategies ,",
    "we construct a smaller , simplified model of the spectroscopic component of the euclid survey . in this work",
    "we consider a realisation of the nisp instrument .",
    "the focal plane is made up of @xmath91 * detector * squares .",
    "each * pointing * of the telescope includes four dithered exposures of the entire focal plane and therefore generates a set of four four - by - four arrays of squares .",
    "each detector is made up of 2040-by-2040 pixels , which corresponds to each detector covering an area of 612-by-612 squared arc - seconds in our model for simplicity .",
    "] on the sky at the nisp magnification .",
    "the chip - gaps between detectors correspond to 50 and 100 arc - seconds horizontally and vertically respectively .",
    "we furthermore disregard pointing errors and assume that each new pointing of the telescope starts exactly a chip - gap away from the edge of the first exposure of the previous pointing .",
    "this is conservative in terms of calibration as it is likely that further overlaps will result from a denser tiling actually applied .",
    "therefore , if the detector width , @xmath92 , and the chip - gaps , @xmath93 , then one full focal plane exposure covers approximately @xmath94 deg@xmath95 on the sky .",
    "we consider a survey with @xmath96 pointings , each dithered @xmath97 times . if @xmath98 and @xmath99 , the setup looks like the black pattern in . in this figure",
    "we emphasise only one dither for clarity , however in the rest of the paper we consider the default of @xmath100 ( matching * ? ? ?",
    "each pair of @xmath101 respectively corresponds to an exposure , @xmath11 .    as a simplification , we consider the sky to be flat",
    ", therefore the only source of overlaps is the dithering , having also assumed an infinite pointing precision .",
    "there is no overlap between adjacent pointings due to would - be euclidean square tiling of the celestial sphere .",
    "furthermore , we assume no overlaps due to pointing error , which do not have to be negligibly small in a space - based survey like euclid , where they are expected to be as large as @xmath102 at @xmath103 . as is shown in @xcite and below , irregularities in the geometry of overlaps _",
    "improve _ the power of the ubercalibration procedure as this ensures that very different regions of the focal plane can be sampled by the same calibrators . therefore",
    ", since our assumptions described here increase the regularity , we can be satisfied that we are making a slightly conservative estimation of the power of such self - calibration",
    ".    -pass coverage .",
    "each square corresponds to a single detector , the first exposure of each pointing is highlighted in black , the dithered exposures are shaded grey .",
    "the black ( or white ) connected dots indicate the first pixel of the dithers of each pointing . ]",
    "the exposures will be slightly dithered in order to cover the parts of the sky that would otherwise fall into the gaps between detectors .",
    "therefore the coverage of the sky will produce a repeating pattern of 4- , 3- , 2- , 1- , and 0-pass regions .    [",
    "cols=\"<,>,>,>,>,>,>,>,>,>\",options=\"header \" , ]     we parametrise this dithering pattern with an array of three 2-dimensional dither vectors . each 2-dimensional vector in describes the displacement from the previous dither position , starting at the position of the pointing : @xmath104\\ .\\ ] ] for example , what we call the * s - pattern * for 4 dithers would look like the following 3 consecutive displacements from @xmath105 : @xmath106\\ , \\ ] ] with @xmath107 and @xmath108 in all our reference scenarios , which is chosen to exactly cover the inter - detector gaps in the focal plane .",
    "keeping the horizontal , @xmath109 and vertical , @xmath110 displacements constant in the array , i.e. @xmath111 is something we do throughout this analysis to constrain the number of patterns we need to explore .",
    "however , in the sections below , we do vary the scaling , @xmath112 of the total dither vector . then @xmath113 and so @xmath112 , or equivalently the x - shift of the dithers ,",
    "@xmath109 fully constrains the size of a given pattern .",
    "in addition , we calculate the total distance the telescope must move during dithering as @xmath114 +        in this paper we consider 6 different patterns named approximately according to the shape that a single pixel on the focal plane describes during the full dithering of one pointing .",
    "the basic patterns are s and j , the latter having been presented in @xcite and used in our plots as a reference .",
    "it is worth recalling that the reference solution is only one among those which fulfill all the constraints and that was used to show the mission feasibility .",
    "in fact , this solution is likely to change after the corresponding optimisation phase studies are completed .    mirroring s and",
    "j across the diagonal gives n and r respectively . to",
    "that we add two very simple control patterns , o and x. these 6 patterns could be split into 3 groups : s and n , j and r , o and x in order of decreasing complexity .",
    "we choose these patterns on the basis of how they connect survey area in the reference scenario .",
    "s and its horizontal version , n in the reference scenario do not leave any gaps in the coverage and connect not only vertically , but also horizontally to adjacent detector tiles and pointings .",
    "j and it s horizontal version r only connect vertically adjacent tiles .",
    "o and x are studied simply as potentially overly simple patterns .",
    "the dither vectors for these patterns can be seen in .",
    "note that in the case of dither steps larger that those in the reference scenario , the survey quickly becomes entirely connected and the difference between the patterns diminishes .",
    "we show the regions of 4 , 3 , 2 , 1 and 0-pass coverage in for a smallest repeating fragment ( of the size of a detector and one set of gaps ) of the central region in a survey of 9 tiled pointings , each dithered 4 times in the default size ( @xmath115 ) of each of the 6 patterns that we consider in this paper .",
    "we choose them such that at a scale of @xmath115 all the patterns have the same x - step , @xmath107 ( when not set to 0 by the pattern definition ) and require comparable amounts of spacecraft consumables , indicated by the total telescope movement required to make the full dithers , @xmath116 .",
    "we wish to find the pattern and size that gives us the best returns in the calibration for a similar amount of resources and without negatively impacting the coverage .",
    "different dither patterns therefore result in different fractions of coverage ( see ) .",
    "note that there is a difference to the percentage reported in table 4.8 of the euclid red book @xcite .",
    "this is likely explained by the different assumptions about the inter - pointing spacing in our simple model . whereas the red book assumes no inter - pointing spacing , in this paper we repeat the inter - detector gaps when tiling the first exposures of different pointings .",
    "this can for example be seen in figure 4.18 in the red book .",
    "secondly , we do not consider any pointing errors in our model survey .",
    "as also seen in we calculate this by constructing a survey mask of @xmath117 pointings using the mangle code @xcite . using the same code",
    "we find the overlap regions that are covered with 4 , 3 , 2 , 1 , and 0 passes .",
    "for this calculation we discard all the overlap regions that lie outside of the first exposure of the central pointing , to which we count both the area of the 16 detectors as well as the gaps between them and half the gaps around the exposure . in our setup",
    "this pattern of passes repeats exactly , so even the region of one detector and its gaps ( see also ) suffices for this calculation .",
    "we add together the areas in square degrees covered by each number of passes . in we",
    "show how the coverage changes with the dither scale , parametrised by the x - shift of the dithers , @xmath109 for the s - pattern , @xmath118 being the optimal choice to maximise 3- and 4-pass coverage with minimal total displacement .",
    "j & 1.06% & 6.49% & 3.18% & 52.06% & 37.20% + s & 0.00% & 2.12% & 11.80% & 52.19% & 33.89% + r & 1.06% & 12.98% & 3.18% & 32.59% & 50.19%",
    "+ n & 0.00% & 2.12% & 18.29% & 39.21% & 40.38% + o & 0.00% & 4.24% & 34.71% & 0.00% & 61.05% + x & 2.12% & 0.00% & 36.83% & 0.00% & 61.05% +     +     for the s - pattern of dithering .",
    "an @xmath115 corresponds to the first dither displacement equal to the detector gap , i.e. @xmath118 .",
    "the magenta , green , cyan , red and black areas , stacked from bottom to top , correspond respectively to 4- , 3- , 2- , 1- and 0-pass coverage of the survey region .",
    "the vertical dotted black line marks where our survey geometry algorithm becomes less reliable , since the last dither moves beyond the first dither of the pointing . ]",
    "note that the parameters and pattern of @xcite were chosen on the basis of requirements other than _ ubercalibration_. however this paper is only concerned with this method and therefore does not consider the effects of using different dither patterns beyond the changes in coverage and the effectiveness of relative calibration from overlaps .",
    "we assume relative calibrations are made using the brightness of stars in overlap regions .",
    "we conservatively assume that no extended objects can be used .",
    "we use the http://stev.oapd.inaf.it/cgi-bin/trilegal[trilegal ] @xcite model to generate the calibrator star j magnitudes at different galactic latitudes ( see ) in the ab photometric system , @xcite . for the analysis ,",
    "we pessimistically choose to carry out our computations with a low density of bright stars , typical of the high galactic latitude sky at @xmath43 . to obtain a robust estimate for this density ,",
    "we have extracted a virtual 10 deg@xmath95 field .",
    "the 10 deg@xmath95 patch is generated from five 2-deg@xmath95 patches at the same galactic latitude and random galactic longitude to calculate the average surface number density and signal - to - noise ratios ( snr ) .",
    "the results for stellar types f , k , and m are shown in and .",
    "patch of the milky way .",
    "all stellar types are shown , giving 235,689 stars in total at three different galactic latitudes , @xmath119 . ]",
    "@xmath5 bin centre & @xmath120 + @xmath12112.0 & 267 & 12.0 & 92 + @xmath12113.0 & 550 & 13.0 & 192 + @xmath12114.0 & 1028 & 14.0 & 319 + @xmath12115.0 & 1892 & 15.0 & 602 + @xmath12116.0 & 3402 & 16.0 & 975 + @xmath12117.0 & 5949 & 17.0 & 1563 + @xmath12118.0 & 9719 & 18.0 & 2343 + @xmath12119.0 & 15303 & 19.0 & 3321 + @xmath12120.0 & 23031 & 20.0 & 4288 +    we check how realistic these models are with respect to the real sky as measured by the vipers survey @xcite .",
    "we compare the numbers of stars and the scatter in their brightness in the same magnitude bins as those in and , this time generated for a galactic latitude of @xmath122 , with a 5-deg@xmath95 patch of the 2-hour w1 vipers field .",
    "the star - galaxy separation of vipers is at magnitude @xmath123 , which yields 11,369 stars in the vipers field . in the vipers control sample ,",
    "the star - galaxy separation was carried out using purely the size of the image without other assumptions for stars brighter than @xmath124 , therefore it is extremely reliable for these relatively bright objects @xcite . for stars fainter than @xmath124 ,",
    "the loci of stars and galaxies start to merge because of the noise , and the separation becomes less reliable .",
    "therefore we use only the stars brighter than this limit . comparing to the trilegal model , which gives us 11,124 with the same magnitude cut , in the same field - size , we are satisfied that the numbers are close to reality , erring on the conservative side .",
    "we then calculate the snr from simulations of the nisp using the tips code @xcite and the euclid baseline parameters .",
    "we use the tips code to generate `` measured '' two - dimensional slit - less spectra from `` true '' one - dimensional stellar spectra using the @xcite spectral templates .",
    "we measure the scatter of the `` observed '' stellar fluxes around the `` true '' fluxes given by the model from the @xcite library .",
    "we do this by generating a number of simulations of observations of each star . using the imodel @xcite pipeline",
    "we simulate the detection and extraction of the one - dimensional `` measured '' spectrum of each star , having subtracted the template continuum so as not to include real continuum variations in the calculation of the noise rms .",
    "stellar spectra were generated as to reproduce stars with a range of magnitudes , @xmath125 .",
    "we generated 70 spectra for each one of the three spectral types , f , k , m and for each magnitude bin , making up a total of 1470 star spectra , which is the number of spectra that fit in a regular , well spaced grid avoiding overlaps .",
    "since the spectra are different for the three spectral types , the signal is different even if the stars have the same apparent @xmath126 magnitude .",
    "therefore we generated a range of spectral types in order to map out the variability in a real sky patch .",
    "we then integrate the simulated single exposure spectra of selected stars over the spectral range of 13,000  -  14,000   , over 102 pixels at wavelength sampling of 9.8  / pixel .",
    "the choice of integration wavelength range was intentionally minimal in order to be conservative to test that the method can still work even though we are only able to extract a partial calibrator spectrum , giving us a larger level of noise than if we had the full spectrum available . as mentioned , we repeat this several times for each star .",
    "we measure the spread of the distribution of the measured integrated fluxes , @xmath127 for all the observations of each star , having kept the input `` true '' flux the same .",
    "this root - mean - square , @xmath128 is given in the _ rms _ column of .",
    "for comparison , in the _ expected snr _ column , we give the simple pixel - to - pixel scatter of the flux around the extracted continuum in the same wavelength range of single spectra .",
    "since it does not include any error in background subtraction of flux calibration , the latter is therefore a little optimistic .    for a further comparison , to gauge the spread in the incoming signal related to the intrinsic spread of stellar fluxes , we consider the numbers of three stellar types , f , k and m @xcite at a fixed @xmath126 magnitude .",
    "their numbers are given on the right of .",
    "1/rms@xmath53 & expected snr@xmath53 + & f & 0.00193 & 519.14 & 1335.70 + 14.0 & k & 0.00161 & 620.77 & 1568.83 + & m & 0.00108 & 928.66 & 1568.83 + & f & 0.00252 & 397.27 & 834.26 + 15.0 & k & 0.00218 & 459.62 & 931.34 + & m & 0.00168 & 594.18 & 931.34 + & f & 0.00356 & 281.01 & 442.22 + 16.0 & k & 0.00348 & 287.26 & 487.80 + & m & 0.00285 & 350.84 & 487.80 + & f & 0.00642 & 155.85 & 209.71 + 17.0 & k & 0.00616 & 162.23 & 217.57 + & m & 0.00653 & 153.23 & 217.57 + & f & 0.01594 & 62.74 & 80.55 + 18.0 & k & 0.01513 & 66.11 & 87.80 + & m & 0.01372 & 72.88 & 87.80 + & f & 0.04102 & 24.38 & 32.86 + 19.0 & k & 0.04386 & 22.80 & 35.70 + & m & 0.03962 & 25.24 & 35.70 + & f & 0.11044 & 9.05 & 13.53 + 20.0 & k & 0.10742 & 9.31 & 14.58 + & m & 0.07990 & 12.52 & 14.58 +    we also make the following optimistic assumptions .",
    "the stellar spectra are uncontaminated by adjacent objects on the sky that would normally be typical for slit - less spectroscopy .",
    "we do not include cosmic rays .",
    "we assume these effects would be minor and will degrade the stability of the calibration less than including more fainter stars will improve it .",
    "we make this assumption , because we choose mostly very bright stars that should be proportionally less contaminated by the fainter stars .",
    "secondly , we assume that contamination by adjacent stars will be roughly constant exposure to exposure as the stellar density is roughly constant between adjacent pointings .    on average , this results in an uncertainty (",
    "not including the zero - point offsets ) on the mean stellar magnitude in an overlap with an area , @xmath129 of @xmath130 mmag .",
    "this is the average value of what is used in the denominator of the first term in to serve as the weight in the optimisation .",
    "it should be noted that this is not to be taken as the uncertainty on the final measured stellar magnitudes in the euclid spectroscopic range .",
    "it is simply the expected purely statistical scatter between the measurements of the mean calibrator magnitude in an overlap patch of @xmath131 .",
    "we generate calibrated measurements of the magnitudes of calibrator stars optimally averaged over each exposure , @xmath11 of each overlap tile , @xmath40 according to .",
    "we use @xmath132 as a metric of calibration improvement as it measures the final decreased scatter of the residual zero - points over the survey in magnitude .",
    "we find the set of exposure zero - point calibrations @xmath133 that minimises using a simple gradient descent method in the likelihood , updating our parameter set , @xmath6 until the @xmath134 in converges .",
    "the update rule uses the gradient of the likelihood multiplied by a learning rate , which simply equals to a quarter of the total error in an exposure , @xmath11 , from all the overlap tiles , @xmath40 it covers : @xmath135 where @xmath136 is the number of useful overlap tiles covered by exposure @xmath11 , and where now @xmath137 is the mean over all but the @xmath11-th exposure in overlap tile @xmath40 .",
    "we run two sets of simulations and calibrations .",
    "both times we assume the large scale variations are initially completely unconstrained and the zero point of each subsequent exposure is drawn from a gaussian with the width of @xmath24 anew and is therefore independent of all other zero - points .",
    "we consider any other variation of the zero - point across one field - of - view to be due to the shape of the flat - field and calibrated otherwise .",
    "as mentioned throughout this paper , we also assume that there is no time variation of the shape of the flat - field , but we allow the average of the flat - field to vary freely .",
    "we describe the results in and .    .",
    "the black , green , red , cyan , magenta and yellow line correspond to the so - called j- , s- , x- , r- , o- , and n - pattern respectively .",
    "the black circle and dashed vertical line mark the reference strategy . ]    .",
    "the black , green , red , cyan , magenta and yellow line correspond to the so - called j- , s- , x- , r- , o- , and n - pattern respectively . the black circle and dashed vertical line mark the reference strategy . ]    , i.e. @xmath118 .",
    "we construct square surveys out of an integer number of pointings , given on the x - axis .",
    "we find 10 realisations of each configuration and plot their @xmath138 scatter ( grey shaded region ) and their mean ( coloured lines ) .",
    "the dotted lines are the weighed averages across all the survey sizes with @xmath139 . as",
    "before , the black , green , red , cyan , magenta and yellow line correspond to the so - called j- , s- , x- , r- , o- , and n - pattern respectively ( some overlap ) . ]      first we follow the procedure as described above and vary the calibrations * exposure - to - exposure*. we generate a single zero - point error for each full exposure of the focal plane , containing 16 detectors .",
    "this corresponds to our first choice of split between large- and small - scales .",
    "we take @xmath140  mmag ( or 4% in flux ) between full focal plane exposures since this corresponds to a reasonable required minimum for this quantity .",
    "we collate the results of our exposure - to - exposure varying simulations in , , and , where we plot @xmath132 , our quality metric that quantifies the uniformity of the calibrations across the survey after our procedure .",
    "we find that at the reference value of @xcite , which corresponds to @xmath118 in the j - pattern , the final scatter , @xmath141 mmag , meaning we are going from an exposure - to - exposure stability of @xmath142% to @xmath143% in flux after the relative re - calibration .",
    "however , at the same @xmath109 , the s - pattern performs better and achieves a final scatter , @xmath144 mmag or @xmath145% in flux .",
    "we obtain these numbers by calculating an optimally weighted average over all the survey sizes considered ( excluding the @xmath146 case ) . because the s - pattern means a longer dithering vector with the same @xmath109",
    ", we consider an s - pattern with the same total dithering path as the nominal j - pattern , which has @xmath147 .",
    "this still provides a large improvement on the reference and results in a final flux calibration stability of @xmath148 mmag ( see also ) in this very simple model .    to check that our results converge with the size of the survey and are statistically robust",
    ", we repeat the calculation by keeping the @xmath118 constant , and changing the number of pointings in the square survey . in addition",
    ", we calculate several realisations of each survey size and calculate their scatter .",
    "it can be seen from that @xmath132 converges for all the patterns as the survey size is increased .",
    "+                  we then consider the relative effectiveness of our dither patterns for the purposes of ubercalibration , if we make a different large- and small - scale split . therefore",
    ", we run a second set of simulations , where we allow the calibration to vary * detector - to - detector*. the procedure is exactly analogous as in the first set , with the difference that now each exposure by each detector is treated as a new , independent exposure and indexed with @xmath11 . in this second case , where we allow a scatter also between the 16 detectors in the focal plane , we appropriately adjust the detector - to - detector zero - point scatter to @xmath149  mmag ( or 16% in flux ) to keep the initial total exposure - to - exposure scatter the same as in .",
    "this does not fundamentally change anything in our analysis .",
    "it is simply an alternative way to split up large and small scales .",
    "this step is rather pessimistic , since it assumes a complete ignorance about the relative zero points of all the detectors as well as the zero - point variation from dither to dither .",
    "we assume to only know the distribution of these zero - point errors , which we again assume to be gaussian with a scatter of @xmath24 as in .",
    "we plot the results of our simulations of the calibration procedure , where we have allowed the calibrations of the individual detector tiles to vary in , , and . in and",
    ", one can notice that the improvement of the survey uniformity at no dither displacement is not as good as a factor of @xmath150 , from 40 mmag to 20 mmag as one may naively expect .",
    "this is most likely due to a combination of three factors .",
    "the first and probably dominant effect is that we are comparing the initial pure zero - point scatter , which is unknown , to the final , measured zero - point scatter , which in a way includes the measurement errors of the true mean stellar magnitudes .",
    "secondly , we expect that the _ ubercalibration _ procedure introduces correlations between the final zero - points whose exposures overlap with each other , which makes the calculation of expected zero - point scatter a little more complicated that a division with @xmath151 .",
    "finally , in these two plots , we are only looking at one realisation of the initial scatter of calibrators , which means that the exact value is sensitive to statistical fluctuations .",
    "it is also apparent from that the calibration quality converges more quickly with survey size in this case than in .",
    "this is likely to be simply due to having 16-times more data points .    in this , more pessimistic scenario ,",
    "the mean post - calibration zero - point scatter between full exposure zero - points ( i.e. averaged over their 16 detectors ) for the reference s - pattern is @xmath152  mmag and @xmath153  mmag for the j , both with @xmath118 . taking the slightly smaller @xmath147 in the s - pattern",
    "again gives @xmath154  mmag .    in this case",
    "it is possible to see additional features around @xmath155 i.e. half of width of detector @xmath156 vertical gap , meaning that @xmath157 , which corresponds to a perfect vertical alignment ( see in the appendix ) of all dithers and therefore a large fraction of 0-pass coverage for all the patterns ( for s , see ) .",
    "this feature indicates a decrease in uniformity ( increase in @xmath132 ) , since the survey becomes less interconnected , which corresponds to a large 0-pass coverage , separating the different connected regions .",
    "see also in the appendix for more plots .",
    "the additional feature in this scenario corresponds therefore to introducing a new typical scale of @xmath158  detector + gap width .",
    "+     & 1.0 & 4.3 & 1.8 & 5.4 & 1.9 & 19.9 & 19.9 + & 2.0 & 0.9 & 1.0 & 0.7 & 0.7 & 0.8 & 1.1 + & 1.0 & 7.7 & 4.0 & 11.4 & 4.4 & 20.3 & 20.1 + & 2.0 & 2.6 & 2.4 & 2.2 & 2.2 & 2.3 & 2.6 +    we summarise the above results at the reference scenario dither step ( @xmath159 ) in .",
    "we show the results from both as `` exp - to - exp '' and as `` det - to - det '' for the 6 base dither patterns considered in this paper . in the `` det - to - det '' case",
    "we compute the scatter of the full exposure zero points , averaging over the zero - point of the 16 individual detectors in one exposure .",
    "this is the same procedure used to produce and .",
    "it is important to correctly split up the calibration into small and large scales .",
    "the present technique is good for intermediate - scale calibration , but something more extensive is required for the small scales .",
    "for example , one may calculate an average @xmath160 for each pixel over all exposures to calibrate the pixel - to - pixel zero - points .",
    "this of course does not fix any time decay , where one should do the opposite and average over all the pixels in each exposure or detector and try to find long - term trends .",
    "here we are studying the intermediate step , calibrating the noisy exposure - to - exposure zero - point variations .",
    "note also that for all dither patterns in both sets of simulations the _ ubercalibration _ improves as the dither step is increased up to the size of the section with a constant zero - point ( exposure in or detector in ) .",
    "this is because this increases the overlap between adjacent independent measurements of the calibrator flux , eventually connecting the entire survey together .",
    "however as the step is increased , more telescope consumables are used up . therefore an optimal trade - off should be found and the pattern with the best trade - off should be used .",
    "therefore , this paper shows that s is the optimal pattern for ubercalibration giving the best stability in exchange for the smallest telescope movement required .",
    "we have studied how the potential for undertaking an _ ubercalibration _ style retrospective relative self - calibration based on matching the brightness of objects observed in overlap regions can be taken into account in survey strategy design .",
    "in particular , we have tested the efficiency of six dither patterns in determining a highly stable intermediate - scale calibration of our simple model of the spectroscopic component of the euclid survey . in order to avoid fitting for individual stellar brightness and significantly increase the speed of calculation , we introduced a new simplification to the calculation of @xcite , averaging over all the calibrator stars in all the relevant stellar populations , and fitting to the mean .",
    "we have shown that the method is equivalent with the standard assumptions of gaussian errors .",
    "we have conducted this analysis for the case of our simplified simulations . in order to apply our methods directly to data",
    ", a more complex study should be undertaken to test some of our assumptions .",
    "the gaussian distributions of calibrator magnitudes would have to be one of the issues considered as would the calibration on intra - detector scales .",
    "the latter has been studied by @xcite , which we briefly revisited in of the appendix .",
    "the former will have to account for outlier calibrators , most importantly variable stars , for example by replacing the means with medians , which are more resistant to extreme values .",
    "we have tested 6 dithering patterns , using 6 different dithering vectors ( see ) .",
    "the best performing in terms of coverage and calibration stability improvements are s and j as they cover @xmath161 and @xmath162 of the sky with @xmath163 passes . considering only exposure - to - exposure zero - point variations , the s and j patterns in their reference size with @xmath118 improve calibration stability from a distribution with rms of 40.0 mmag to 1.8 mmag and 4.5 mmag respectively .",
    "the 40.0 mmag baseline corresponds approximately to @xmath1644% fractional rms variations in flux , and is the required limit for the instrument and telescope stability .",
    "we have shown how the _ ubercalibration _ procedure can be used to achieve further calibration stability .",
    "in addition , as @xcite show , larger increases in overlap between exposures with different zero - points generally tend to result in a larger improvement in the power of the _ ubercalibration _ procedure .",
    "larger overlaps generally result from larger dither steps up to the size of the repeating section of the exposure pattern .",
    "however , large dither steps cost more in fuel and time , so there is a clear trade - off with survey efficiency .",
    "we have made some assumptions in this paper , whose impact on the effectiveness of _ ubercalibration _ can be studied in the future . + firstly , we only considered scaling the same six patterns up and down , but not changing the relative sizes of the steps .",
    "we believe this is sufficient to study the behaviour of the different dithering patterns and stick to the simplicity of limiting the number of patterns studied .",
    "+ an important caveat in this analysis is that we only considered a flat , euclidean sky , which is not appropriate for large surveys .",
    "however , we showed that the solution converges as we increase the size of the survey and do most of our analysis on surveys of @xmath165 pointings , which span @xmath166 degrees on the sky .",
    "furthermore , @xcite have shown that irregular overlaps improve the power of the _ ubercalibration _ procedure , so we are making a conservative assumption .",
    "+ our study has only used the calibrator distribution of one galactic latitude with a relatively low density . however , our relative conclusions are only weakly dependent on the density of calibrators .",
    "a higher calibrator density is expected to improve the results slightly .",
    "+ we neglect any uncertainty in the flat - field . including it would generally add parameters that need to be constrained due to the parametrisation of the flat - field .",
    "we have done this in order to focus on zero - point calibrations on large scales , which are most relevant to measurements of cosmological large - scale structure statistics .",
    "we assume that the intra - detector flat field parameters as well as their evolution will be constrained well using other calibration and self calibration techniques .",
    "+ studying the time evolution of the exposure - to - exposure and detector - to - detector variations is out of the scope of this work .",
    "it is however expected that models will be available to describe this evolution and therefore the calibration method would be designed to fit parameters of this model , rather than the calibrations of individual exposures , assuming that there is no other information .",
    "it is important to keep in mind that all these assumptions make this a toy model and the resulting large calibration stability should not be taken at face value .",
    "one should consider mostly the relative result when comparing the survey strategies .",
    "further studies taking into account better models of instrument stability and better error modeling are needed to predict the power of _ ubercalibration _ for euclid .",
    "we have presented a study of the optimisation of the euclid nir survey geometry with the sole focus on the large - scale calibration .",
    "we have shown that relative calibrations can be significantly improved by choosing certain steps and patterns .",
    "because , as seen most clearly in , the _ ubercalibration _ procedure can improve the uncertainty on the zero - points of exposures , it is worth including the proposed geometries into the optimisation studies of the euclid survey , which will balance this with a wide range of additional limitations and requirements .",
    "relative nisp calibration is only one of many goals the survey strategy must take into account , while still fulfilling a large number of requirements , which were not taken into account in this study .",
    "although we have considered an idealised scenario in this paper , calculations are underway and will be reported separately @xcite that consider a more realistic distribution of observations , when geometrical effects and noise are included .",
    "the qualitative conclusions of this work agree with our simplified calculations , and thus we believe our conclusions on the relative coverage fractions for the different dither strategies considered here are robust .",
    "we leave to future work the study of the calibration procedure of surveys covering different regions of the galaxy as well as other large - scale effects . among those are effects of the long term stability of the instrument , effects from solar system and galactic noise etc .",
    "in addition , we leave for future work the study of the impact of survey uniformity improvements due to different dither patters ( as in * ? ? ? * for the case of lsst ) on clustering statistics .",
    "we make our simulation code public on github at http://github.com/didamarkovic/ubercal[`github.com/didamarkovic/ubercal ` ] .",
    "dm and wjp acknowledge support from the uk science & technology facilities council through grants st / m001709/1 and st / n000668/1 .",
    "wjp is also grateful for support from the european research council through grant 614030 darksurvey , and support from the uk space agency through grant st / n00180x/1 .",
    "bg , lg , rs and ms acknowledge financial support by the italian space agency , through contract asi / inaf n. i/023/12/1 .",
    "we thank adriano derosa , carlo burigana , nikhil padmanabhan , julian zoubian , vincent venin , and florent leclerc for useful discussions .",
    "in addition , we thank rene laureijs , roland vavrek and the euclid consortium .",
    "we acknowledge the use of the astropy package for python @xcite .",
    "numerical computations were done on the sciama high performance compute ( hpc ) cluster which is supported by the icg , sepnet and the university of portsmouth .",
    "@xmath1 & equatorial coordinates right ascension & @xmath167 + @xmath168 & equatorial coordinates declination & @xmath167 + @xmath169 & galactic latitude & @xmath167 + @xmath17 & horizontal coordinate on the detector & @xmath170 + @xmath18 & vertical coordinate on the detector & @xmath170 + @xmath17 & width of the detector ( clear from context ) & @xmath170 + @xmath18 & height of the detector ( clear from context ) & @xmath170 + @xmath171 & horizontal gap between detectors & @xmath170 + @xmath172 & vertical gap between detectors & @xmath170 + @xmath96 & total number of fields in the survey & _ none _ + @xmath97 & number of times",
    "each field is dithered & _ none _",
    "+ @xmath173 & number of detectors in one focal plane & _ none _",
    "+ @xmath174 & indexes fields , max is @xmath96 & _ none _",
    "+ @xmath175 & indexes dithers , max is @xmath97 & _ none _",
    "+ @xmath176 & array of all dither displacements & @xmath170 + @xmath177 & n@xmath178 horizontal dither displacement & @xmath170 + @xmath179 & n@xmath178 vertical dither displacement & @xmath170 + @xmath109 & generic horizontal dither displacement & @xmath170 + @xmath110 & generic vertical dither displacement & @xmath170 + @xmath112 & scaling of the dither vector , i.e. of @xmath109 and @xmath110 from 50@xmath170 and 100@xmath170 & _ none _",
    "+ @xmath180 & total telescope displacement after dithers & @xmath170 + @xmath116 & total telescope movement during dithers & @xmath170 + @xmath126 & j magnitude ( ab photometric system ) & mag + @xmath181 & i magnitude ( ab photometric system ) & mag + @xmath182 & integrated noise in the observed spectrum & adu + @xmath127 & integrated signal in the observed spectrum & adu + @xmath41 & indexes calibrator populations & _ none _ + rms@xmath53 & root - mean - squared of the fluxes of @xmath41-type calibrators & _ none _",
    "+ @xmath57 & intrinsic scatter of magnitudes in @xmath41-type stars & mmag + @xmath183 & surface number density of calibrator stars at a position @xmath184 on the sky & deg@xmath185 + @xmath186 & average surface number density of calibrator stars at galactic latitude , @xmath169 & deg@xmath185 + @xmath120 & surface number density of @xmath41-type calibrator stars & deg@xmath185 + @xmath11 & indexes exposures , max is @xmath187 & _ none _",
    "+ @xmath33 & indexes calibrator stars , max is @xmath188 & _ none _",
    "+ @xmath40 & indexes overlap tiles & _ none _",
    "+ @xmath188 & total number of calibrator stars & _ none _",
    "+ @xmath45 & number of all calibrator stars in the @xmath47 overlap tile & _ none _ + @xmath52 & number of @xmath41-type calibrator stars in tile @xmath40 & _ none _",
    "+ @xmath187 & total number of exposures in survey & _ none _",
    "+ @xmath74 & total number of observations of calibrator @xmath33 & _ none _",
    "+ @xmath51 & area of the calibrator @xmath33 image & pix + @xmath85 & number of exposures that contain the tile @xmath40 & _ none _ + @xmath189 & number of overlap tiles in exposure @xmath11 & _ none _",
    "+ @xmath55 & area of overlap tile @xmath40 & deg@xmath95 +     @xmath10 & true flux of calibrator @xmath33 & erg / s / cm@xmath95 + @xmath9 & flux of calibrator @xmath33 measured in exposure @xmath11 & adu + @xmath12 & calibrated flux of calibrator @xmath33 in exposure @xmath11 & erg / s / cm@xmath95 + @xmath191 & mean dark current of exposure @xmath11 & adu + @xmath14 & multiplicative flux calibration mean of exposure @xmath11 to be determined & _ none _",
    "+ @xmath192 & multiplicative flux calibration at position @xmath37 in exposure @xmath11 & _ none _",
    "+ @xmath193 & difference from @xmath14 at position @xmath37 in exposure @xmath11 & _ none _",
    "+ @xmath194 & true magnitude of calibrator @xmath33 & mag + @xmath195 & true mean magnitude of all calibrator in tile @xmath40 & mag + @xmath196 & magnitude of calibrator @xmath33 measured in exposure @xmath11 & mag + @xmath80 & mean of all calibrated magnitude measurements of calibrator @xmath33 & mag + @xmath197 & magnitude of calibrator @xmath33 calibrated in exposure @xmath11 & mag + @xmath198 & magnitude of calibrator @xmath33 from population @xmath41 , calibrated in exposure @xmath11 & mag + @xmath48 & mean calibrated magnitude of all stars in tile @xmath40 of exposure @xmath11 & mag + @xmath199 & mean calibrated magnitude of all exposures in tile @xmath40 & mag + @xmath137 & mean calibrated magnitude of all but the @xmath11-th exposure in tile @xmath40 & mag + @xmath28 & miscalibration of the magnitude of star @xmath33 in exposure @xmath11 & mag + @xmath64 & miscalibration of the @xmath40-tile mean in exposure @xmath11 & mag + @xmath22 & additive magnitude calibration of exposure @xmath11 to be determined & mag + @xmath200 & scatter of calibrated flux measurements of calibrator star @xmath33 & erg / s / cm@xmath95 + @xmath32 & error on the measurement of magnitude @xmath33 in exposure @xmath11 & mmag + @xmath201 & error on the measurement of magnitude @xmath33 in overlap @xmath40 of exposure @xmath11 & mmag + @xmath202 & error on the measured mean magnitude @xmath40-tile & mmag + @xmath36 & error in pixel at position @xmath37 in exposure @xmath11 & mmag + @xmath203 & error in a pixel in exposure @xmath11 & mmag + @xmath204 & scatter in measured magnitudes of @xmath41-type stars & mmag + @xmath65 & poissonian optimal weight of @xmath41-type calibrators in tile @xmath40 & mmag@xmath185 + @xmath205 & uncalibrated zero - point scatter & mmag + @xmath7 & residual zero - point scatter & mmag + @xmath206 & probability ( either posterior , prior or likelihood ) & _ none _",
    "+ @xmath207 & exponent of the likelihood & _ none _",
    "+ @xmath134 & exponent of the posterior & _ none _",
    "+    we summarise our notation in this section . to facilitate quick look - up we provide tables with brief descriptions and units .",
    "in we gather the symbols that parametrise the survey and dithering strategies . in",
    "we provide the parameters connected to the statistical description of the calibrators and calibrations .",
    "we would like to show the relationship between the miscalibration , @xmath28 defined in and it s flux equivalent @xmath208 , being the fractional flux miscalibration , which we define here , by writing the true flux of star @xmath33 as @xmath209 therefore by , the measurement of the true flux of star @xmath33 in exposure @xmath11 will be : @xmath210 with @xmath211 being the standard deviation of the distribution of the fractional random relative miscalibration variable , @xmath208 . in the case of perfect ubercalibration , we would achieve @xmath212 and @xmath213 .    as a consequence of these assumptions , any difference between the flux measurements of two stars in the same exposure will be due to a random ( close to poissonian ) noise from the detector in addition to intrinsic variations in the true stellar fluxes .",
    "we can characterise the detector - noise with the scatter @xmath214 and the scatter in stellar brightnesses as @xmath215 .",
    "the better we understand these noise models and the behaviours of the corresponding quantities , the better the end result of this procedure . with this in mind",
    ", we later divide the variations of the second kind into those due to the different stellar types and a gaussian distribution of magnitudes ( not fluxes ) among the stars of each type .",
    "we discuss this division above in .",
    "the @xmath216 is the expected scatter of measurements due to intrinsic flux scatter , the noise from the observation of each star ( telescope and detector effects ) and the error resulting from the extraction and analysis procedure . since this quantity does not vary from star to star , but",
    "only the stellar type and exposure , we will say that if star @xmath33 belongs to population @xmath41 , @xmath217 , where the capital letters denote the relation of the quantities to flux rather than magnitude .",
    "the first moment of the distribution of this variable can be derived from by writing the true flux as : @xmath218^{-1 } \\nonumber\\ , \\\\",
    "\\rightarrow { m_j^\\star } & = & k_i + { m}_{ij } + e_{ij }   \\nonumber\\ , \\\\ \\textrm{where}\\ e_{ij }   & = & { m_j^\\star } - { m_{ij}^\\textrm{c } } \\nonumber\\\\ & = & 2.5\\log_{10}\\left[1+e_{ij}\\left(\\sigma_{ij}/{{f}_j^\\star}\\right)\\right ] \\ .\\end{aligned}\\ ] ] we can therefore find the width of the @xmath28 distribution as : @xmath219 \\frac{2.5}{\\ln(10)\\left(1+e_{ij}\\right ) } \\ .\\ ] ] we then find that averaging over all exposures , @xmath11 gives : @xmath220^{-1 } \\ , \\ ] ] if @xmath221 and @xmath222 .",
    "we would like to calculate the posterior distribution in , of the set of exposure calibrations @xmath22 , given a set of measurements of calibrator magnitudes , @xmath223 , marginalised over the true calibrator magnitudes , @xmath224 .",
    "this means we must first find the marginalised likelihood : @xmath225 we assume the likelihood of measured stellar fluxes is a simple multivariate gaussian and that the measured fluxes are independent , therefore the probability is simply a product of the individual probabilities , and taking the natural logarithm gives : @xmath226   = & - & n_{\\textrm{exp}}\\sum^{n_\\star}_j\\sum^{n_{\\textrm{exp}}}_i\\ln(\\sigma_{ij}\\sqrt{2\\pi } ) + \\ \\ \\ \\ \\ \\ \\ \\\\ & - & \\frac{1}{2}\\sum^{n_\\star}_j\\sum^{n_{\\textrm{exp}}}_i\\frac{({m_{ij } } - ( { m_j^\\star}+k_i))^2}{\\sigma_{ij}^2 } \\nonumber\\ , \\end{aligned}\\ ] ] where the @xmath32 is also assumed to be known .",
    "we can construct a prior on the true magnitudes expecting that they are distributed as a gaussian with a mean of @xmath227 and a width @xmath228 .",
    "@xmath229 = -n_\\star\\ln(\\tau\\sqrt{2\\pi } )   - \\frac{1}{2}\\sum^{n_\\star}_j\\left(\\frac{{m_j^\\star } - \\mu}{\\tau^2}\\right)^2   \\label{eq : starprior}\\ .\\ ] ] from now on we drop all the constants and keep only terms that will be relevant in finding the maximum of the posterior .",
    "we are effectively working with the @xmath3 estimator as in @xcite .",
    "then we can consider the @xmath72 of the integrand in : @xmath230 with @xmath231      } ^{m_j^a } - 2{m_j^\\star }      \\overbrace {      \\left[\\sum_i\\frac{{m_{ij } } - k_i}{\\sigma_{ij}^2 } + \\frac{\\mu}{\\tau^2}\\right ]      } ^{m_j^b }   \\nonumber\\\\ & = &   \\left({m_j^\\star } \\sqrt{m_j^a } - \\frac{m_j^b}{\\sqrt{m_j^a}}\\right)^2 - \\frac{(m_j^b)^2}{m_j^a } \\ , \\end{aligned}\\ ] ] having `` completed the square '' @xcite .",
    "therefore , in order to marginalise over the true magnitudes , we must integrate over : @xmath232 + \\nonumber\\\\ & - & \\frac{1}{2 } \\sum_j \\left({m_j^\\star } \\sqrt{m_j^a } - \\frac{m_j^b}{\\sqrt{m_j^a}}\\right)^2 \\ .\\end{aligned}\\ ] ] the second term in this equation is the only term that depends on @xmath30 , therefore the other terms can come out of the integral as multiplicative constants",
    ". then we will get an ordinary gaussian interval , whose value will be independent of @xmath233 and therefore of @xmath22 , which means that in the search for the maximum of the posterior with respect to @xmath22 it can be treated as a constant , i.e. ignored : @xmath234      \\right\\ } \\ . \\nonumber\\end{aligned}\\ ] ] now that we have this general expression , we can loosen the prior on @xmath30 : @xmath235^{-1 } \\ . \\nonumber\\ ] ] using that @xmath236 we can write the marginalised likelihood : @xmath237^{-1 } \\ . \\nonumber\\end{aligned}\\ ] ] simply as an effective @xmath3 : @xmath238 we know that the absolute calibrations should be done to a certain quality , @xmath205 and therefore we can also construct a prior to reflect this : @xmath239 = -n_{\\textrm{exp}}\\ln(\\sigma^k\\sqrt{2\\pi } )   - \\frac{1}{2}\\sum_i^{n_{\\textrm{exp}}}\\left(\\frac{k_i}{\\sigma^k}\\right)^2   \\ , \\nonumber\\ ] ] since by definition of _ relative _ calibrations , taking the ensemble average over the full survey gives @xmath240 . and",
    "so , the @xmath72 of the final posterior ( modulo additive constants ) becomes : @xmath241",
    "we wish to plot some more dither configurations at dither sizes that display clear features in and in , as well as coverage evolution with dither size for two of the the remaining five patterns , namely j and o. we choose to add the coverage of the j - pattern of @xcite and we choose the o - pattern for its intuitive simplicity .",
    "the connection to the dips in calibration quality can be seen particularly well in the visible increase in 0-pass coverage at @xmath242 .",
    "we use the publicly available https://github.com/davidwhogg/selfcalibration[_self-calibration_ ] code to repeat the analysis of @xcite using two ( j and s ) out of the above 8 dither patterns and compare them to two of the @xcite dither patterns ( uniformly displaced , c and quasi - random , qr ) .",
    "this analysis considers the very small scales of calibration and tries to fit the pixel - to - pixel flat - field residuals across the full field of view , which is modelled as a square and not split into detector squares .",
    "therefore there are no gaps between detectors or pointings and the coverage is always at least 4-pass .",
    "we re - plot some of the figures from their paper with these four dither patterns and with only 4 dithers per pointing ( they had 9 ) and show the results in , , , and .",
    "we do this to compare the new pattern we propose , s , to the previously proposed patterns .",
    "@xmath3 + c & 26.0 & 0.2098 & 0.3373 & 0.0233 & 315496.97 + qr & 13.0 & 0.2055 & 0.3388 & 0.0059 & 36554.80 + j & 3459.0 & 0.2538 & 0.3340 & 0.0825 & 307420.63 + s & 1447.0 & 0.2491 & 0.3364 & 0.0764 & 307616.41 +"
  ],
  "abstract_text": [
    "<S> we consider the application of relative self - calibration using overlap regions to spectroscopic galaxy surveys that use slit - less spectroscopy . this method is based on that developed for the sdss by @xcite in that we consider jointly fitting and marginalising over calibrator brightness , rather than treating these as free parameters . </S>",
    "<S> however , we separate the calibration of the detector - to - detector from the full - focal - plane exposure - to - exposure calibration . to demonstrate how the calibration procedure will work , </S>",
    "<S> we simulate the procedure for a potential implementation of the spectroscopic component of the wide euclid survey . </S>",
    "<S> we study the change of coverage and the determination of relative multiplicative errors in flux measurements for different dithering configurations . </S>",
    "<S> we use the new method to study the case where the flat - field across each exposure or detector is measured precisely and only exposure - to - exposure or detector - to - detector variation in the flux error remains . </S>",
    "<S> we consider several base dither patterns and find that they strongly influence the ability to calibrate , using this methodology . to enable self - calibration , it is important that the survey strategy connects different observations with at least a minimum amount of overlap , and we propose an `` s''-pattern for dithering that fulfills this requirement . the final survey strategy adopted by euclid will have to optimise for a number of different science goals and requirements . </S>",
    "<S> the large - scale calibration of the spectroscopic galaxy survey is clearly cosmologically crucial , but is not the only one . </S>",
    "<S> + we make our simulation code public on http://github.com/didamarkovic/ubercal[`github.com/didamarkovic/ubercal ` ] .    </S>",
    "<S> [ firstpage ]    methods : statistical  cosmology : observations  large - scale structure of universe  instrumentation : detectors </S>"
  ]
}