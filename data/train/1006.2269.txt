{
  "article_text": [
    "we consider in this paper a general error analysis and some implementation issues for fast multipole methods ( fmms ) .",
    "since their first appearance in @xcite , these tree - based algorithms have become important computational tools for evaluating pairwise interactions of the type @xmath0 fmms offer an @xmath1-complexity and an _ a priori _ error estimate , but implementing a fully fledged adaptive fmm in 3d is a daunting task @xcite .",
    "parallelization issues complicate matter even further and call for a balance between , on the one hand theoretical efficiency , and on the other hand software complexity @xcite . a major inconvenience with _ adaptive _ versions",
    "is the complicated memory access pattern which is due to the communication between levels in the multipole tree . although this can be mitigated either through post - balancing algorithms @xcite , or by employing more advanced data - structures ( * ? ? ?",
    "6.6 ) , with modern data - parallel architectures it has in fact been suggested that uniform versions offer better performance @xcite .    an alternative is to use _ asymmetric _ adaptive meshes as outlined in figures  [ fig : mesh ] and [ fig : boxes ] . here",
    "the tree becomes balanced at the cost of a variable , but local , communication stencil .",
    "also , the actual form of the _ multipole acceptance criterion _ becomes more critical as the mesh looses regularity .",
    "comparisons between different criteria for cell - to - particle methods are found in @xcite , while a careful worst - case analysis of uniform fmms is found in @xcite .",
    "the main contributions of the current paper are found in sections  [ sec : assumptions ] and [ sec : analysis ] where the precise statement of the multipole acceptance criterion and the required assumptions on the kernel @xmath2 are discussed together with a general error analysis .",
    "our approach is inspired by the treatment in the monograph @xcite , but we are able to offer several important corrections . in sections  [ sec :",
    "implementation ] and [ sec : experiments ] implementation issues are highlighted and we also perform numerical experiments illustrating the sharpness of the theory and the efficiency of the proposed approach .",
    "we begin by stating the one - parameter criterion for two sets being well - separated .",
    "this is also a correction to the too weak criterion found in ( * ? ? ?",
    "* eq .  ( 8.31 ) , p.  379 ) .",
    "[ crit : theta ] let the sets @xmath3 be contained inside two disjoint spheres such that @xmath4 and @xmath5 .",
    "given @xmath6 , if @xmath7 , @xmath8 , and @xmath9 , then the two sets are _ well - separated _ whenever @xmath10 .",
    "in other words , any of the two sets may be expanded by a factor of @xmath11 and arbitrarily rotated about its center point without touching the other set .",
    "when regarded as a parameter inside the fmm it will be evident that a smaller @xmath12 yields a smaller error at the cost of a larger communication stencil .",
    "we remark that the @xmath12-criterion  under consideration is symmetric in its two arguments as a reflection upon the fact that we mainly consider fmms where the sources and the evaluation points are `` roughly '' the same .",
    " indeed , our implementation as outlined in section  [ sec : implementation ] produces a representation of the total field in the _ whole _ enclosing box under consideration .",
    "an algorithm which is adaptive in sources and evaluation points separately is described in ( * ? ? ?",
    "6.6 ; see also fig .",
    "we shall need the following two simple consequences of the @xmath12-criterion : since @xmath13 we get @xmath14    for @xmath15 and @xmath16 multi - indices in the normed space @xmath17 we write for brevity @xmath18 and additionally define factorials and powers in the usual intuitive manner . similarly to ( * ? ? ?",
    "* eq .  ( 8.15 ) , p.  317 ) ( but here with an explicit factor @xmath19 ) we assume that the kernel @xmath2 s first few derivatives are equivalent to the harmonic potential :    [ ass : gbound ] for @xmath20 with @xmath21 , @xmath22    the analysis below takes place in @xmath23-dimensional cartesian space . in order to avoid the worst - case bound @xmath24 , assuming some kind of symmetry of the kernel seems inevitable ( see also @xcite ) :    [ ass : grot ] for any rotation @xmath25 of the coordinate system , @xmath26    in other words , we may freely rotate the coordinate system before expanding the kernel ( provided of course that any expansion points are rotated as well ) . by choosing a @xmath25 such that @xmath27",
    ", results obtained below in @xmath28 will be transferred to the euclidean norm without introducing any constants .",
    "consider now two points @xmath29 and @xmath30 , where @xmath31 and @xmath32 satisfy the @xmath12-criterion . approximating a unit source at @xmath33 using a far - to - far translation ( @xmath34 , centered at @xmath35 ) , followed by a far - to - local expansion ( @xmath36 , centered at @xmath37 ) ,",
    "can be written as @xmath38-    \\left [ { \\widehat{g}}_{p}(x , y ; \\ ; y_{0})-g(x , y ) \\right ] \\\\",
    "\\label{eq : errsplit }    & = : { \\widetilde{g}}_{p}(x , y ; \\ ; x_{0},y_{0})-{e_{\\mbox{{\\footnotesize far - to - local}}}}-{e_{\\mbox{{\\footnotesize far - to - far}}}},\\end{aligned}\\ ] ] with @xmath39 the order of the expansion .",
    "we consider the two errors in turn .",
    "the integral form for the remainder of the @xmath23-dimensional taylor series becomes @xmath40 using and the multinomial theorem . as discussed in conjunction with assumption  [ ass : grot ] above we may now replace @xmath41 with @xmath42 . using the triangle inequality and yields",
    "@xmath43 so that from , @xmath44 using @xmath45 we readily bound the integrand and get @xmath46    as for the first term in we obtain this time a _ sum _ of integral remainders , @xmath47 where the multinomial theorem and the rotational invariance were used twice .",
    "the sum can be evaluated when the upper limit tends to @xmath48 ; hence by uniform convergence , @xmath49 using , the triangle inequality , and we get ( compare with ) @xmath50 for the integrand we use the same type of bound as before and finally get @xmath51    by summing the contributions and from @xmath52 _ positive _ potentials ( cf .  ) we thus conclude that the relative error for the @xmath39th order fast multipole method under the @xmath12-criterion  is bounded by a @xmath53 .    in the above derivation we are lead to the @xmath12-criterion  by the initial requirement that @xmath54 . clearly , the only natural way to obtain this is from the the triangle inequality and the slightly stronger requirement that @xmath55 ( cf .  ) . despite this clear reasoning",
    "we have not been able to find our version of the @xmath12-criterion  made explicit in the literature .",
    "presumably , this is due to the fact that quadratic meshes are so popular .",
    "we note also that the integral remainder term was consistently used instead of the lagrangian version ( hinted at also in @xcite ) . to see why , note that in bounding e.g.  @xmath56 above we would otherwise obtain terms of the form @xmath57 with @xmath58 $ ] and @xmath59 .",
    "the only sensible bound now includes the factor @xmath60 suggesting that the convergence would deteriorate as @xmath61 .",
    "by contrast , the bounds and are perfectly regular for _ any _ @xmath62 .",
    "it is to be stressed that we like to view the above analysis as a kind of _ template _ ; the precise form of the assumptions and their implications are all very clearly visible .",
    "the effect of changing them can therefore readily be assessed .",
    "the current paper on the @xmath12-criterion  stems mainly from the fact that allowing an asymmetric adaptive splitting when creating the fmm mesh makes a convenient implementation possible .",
    "the ease of implementation is mainly thanks to the fact that the associated multipole tree is always balanced so that a static memory layout becomes natural . as a result ,",
    "neighboring boxes are always arranged in the same level in the multipole tree , thereby facilitating the communication between them ( see figure  [ fig : boxes ] for an illustration ) .",
    "we now give a brief description of our current implementation . for more detailed information",
    "the interested reader is kindly referred to the freely available code itself ( see section  [ subsec : reproduce ] ) .",
    "the multipole mesh is constructed first and is obtained by recursively splitting the source points at or near their median in each coordinate direction .",
    "a very fast and well - known algorithm is available for doing just this ; this is the _ median - of - three _ selection algorithm which is most often used when implementing _ quicksort _",
    "the source points themselves are naturally stored in a _",
    "data - structure , a _",
    "@xmath63-tree _ cut at a certain maximum level ( * ? ? ?",
    "after the sources have been assigned a box at the finest level , the _ connectivity _ information is determined . at any level in the tree the boxes",
    "are either decoupled or , respectively , strongly / weakly coupled . for each box @xmath64 ,",
    "the strong connections @xmath65 of its parent box @xmath39 are examined ; all children of a box in @xmath65 that satisfy the @xmath12-criterion  with respect to @xmath64 become weakly coupled to @xmath64  the rest remain strongly coupled .",
    "this simple rule together with the fact that a box is always strongly connected to itself recursively defines the connectivity for the whole tree .",
    "the resulting topology is conveniently stored in sparse matrices with sparsity patterns known _ before _ each level is to be examined .    in the downward",
    "/ upward phases the expansions are shifted as usual according to parent / child relations .",
    "the critical far - to - local shift follows the weak connectivity pattern and , at the finest level , the remaining strong connections are evaluated directly . as suggested in @xcite all shifts in the implementation tested below relies on blas level 3 routines with constant transition matrices ( using pre- and post - scaling according to the local geometry ) .",
    "a few structural optimizations are optionally possible .",
    "for instance , a box weakly coupled to all children of a parent box can often interact via the latter instead ( whenever the @xmath12-criterion  with respect to that parent is true ) .",
    "this is visible in figure  [ fig : mesh ] where some of the weakly coupled grey boxes are noticeable large  here the interactions are in fact managed via parent boxes . a related idea at the _ finest _ level is to investigate strongly coupled boxes of very different radii , @xmath66 , say .",
    "if the @xmath12-criterion  is true _ when the roles of @xmath67 and @xmath68 are exchanged _",
    ", then the sources in the larger box can be directly converted into a near field expansion in the smaller box , and the outgoing expansion from the smaller can simply be evaluated at each point in the larger box .",
    "this optimization was suggested already in @xcite .    since it is beneficial to admit as large set of boxes as possible into the set of weak connections , it is natural to try to somehow locally relax the @xmath12-criterion . rather than uniformly enforcing a single value of @xmath12 for example , _ different _",
    "@xmath69 s may well be accepted provided that an estimate of the total error remains bounded .",
    "for instance , if @xmath70 observed values of @xmath69 satisfy @xmath71 , then the relative error estimate is still @xmath72 .",
    "ideas along these lines are discussed in @xcite .",
    "we conclude this section by very briefly discussing the algorithmic complexity .",
    "it is known that there typically exists extremely non - uniform distributions of @xmath52 source points that make most tree - codes ( even the adaptive ones ) run in time proportional to @xmath73 @xcite .",
    "practical experience is usually much better , although for certain applications , simpler algorithms are occasionally preferred ( see @xcite , and further the discussions in ( * ? ? ?",
    "8.7 ) , and ( * ? ?",
    "6.6.3 ) ) .    in any case",
    ", the serial complexity for a 2d implementation using asymmetric adaptivity can be estimated to be roughly proportional to @xmath74 , since each of about @xmath52 boxes at the finest level is to interact through cluster - to - cluster interactions with on the order of @xmath75 boxes at the same level , and since each such shift requires on the order of @xmath76 operations . for a given relative tolerance @xmath77 , the analysis in section  [ sec : analysis ] implies @xmath78 , so that the complexity is @xmath79 , thus indicating that the choice @xmath80 is nearly optimal . in practice ,",
    "the best value of @xmath12 as well as the optimal number of subdivisions is rather dependent on the hardware and should be determined from experience .",
    "on balance we have found that the convenient choice @xmath81 and subdividing the points until the number of sources per box is @xmath82 works very well in practice .",
    "as illustrations to the analysis in section  [ sec : analysis ] and in order to highlight some of the benefits with the proposed adaptivity we report some results from our two - dimensional implementation which employs the classical complex polynomial / multipole representation @xcite .",
    "firstly , we investigated the sharpness of the @xmath12-criterion  and the accompanying error analysis . for this purpose ,",
    "the complex - valued field @xmath83 was used and we calculated the total force in a system consisting of a million sources ( see figure  [ fig : errors ] for results and further details of this simulation ) . since @xmath2 is complex - valued",
    "the assumption is clearly violated .",
    "cancellation effects therefore implies that relative error estimates may well be impossible to obtain .",
    "nevertheless , since the points are distributed randomly and an irregular mesh is used the effect is negligible in this case ( although somewhat more prominent for the uniform distribution , see figure  [ fig : errors ] ) .        secondly , we evaluated the efficiency of the proposed adaptivity at an effective relative tolerance of about @xmath84 ( using @xmath85 expansion coefficients ) .",
    "since our code is developed from a highly optimized uniform code outlined in @xcite , a reasonably fair comparison is possible .",
    "evidently , a square and uniformly subdivided multipole mesh implies a completely regular access pattern so that a highly efficient implementation using direct addressing techniques is possible .",
    "it is therefore of some interest to estimate under what circumstances adaptivity is actually beneficial . for this purpose",
    "we measured the speedup achieved by the adaptive code when the point sources were sampled from increasingly non - uniform data .",
    "the results are displayed in figure  [ fig : aavsu ] and shows that only for very uniform distributions of points is there a small gain ( @xmath86 ) in using the uniform code .        as a third and final experiment we assessed the performance of the adaptive code for different point distributions . using again a relative tolerance of @xmath84 , we measured the cpu - time for increasing number of points sampled from three very different distributions .",
    "as shown in figure  [ fig : robustness ] , the code is very robust indeed and scales well at least up to some 5 million point sources on a single cpu .",
    "our two - dimensional implementation as described in section  [ sec : implementation ] is available for download via the author s web - page .",
    "the code has been tested on several platforms , is fully documented , and comes with a convenient matlab mex - interface . along with the code ,",
    "automatic matlab - scripts that repeat the numerical experiments in section  [ sec : experiments ] are also distributed .",
    "the results presented here were all obtained with a 3.06 ghz intel core 2 duo processor with 4 gb of internal memory running under mac  os  x  10.6.6 .",
    "asymmetric adaptive meshes offer convenient and efficient fmm implementations .",
    "if cluster - to - cluster interactions are restricted to boxes for which the @xmath12-criterion  is true and if the kernel satisfies the assumptions outlined in section  [ sec : assumptions ] , then the relative error can be bounded by a @xmath87 for @xmath6 and with @xmath39 the number of expansion terms .",
    "the computational complexity of the resulting 2d - algorithm can be expected to be about @xmath88 for some target tolerance @xmath77 . not only is the actual performance of the algorithm competitive with optimized uniform fmms even for relatively uniform data , but it is also robust for non - uniform distribution of points .",
    "ongoing work includes porting the code to manycore platforms .",
    "this work was supported by the swedish research council within the flow and the upmarc linnaeus centers of excellence .",
    "18 natexlab#1#1[2]#2 , , ( ) . . , , , in : , volume   of _ _ .",
    ", , , , ( ) . . , , , , ( ) . . , , , , ( ) . . , , , , , ( ) . . , , , ( ) . . , , , , volume   of _ _ , , , . , , , elsevier series in electromagnetism , , , . , , , ( ) . . , , , , ( )",
    ", , , ( ) . . , , addison - wesley series in computer science , , , . , , , ( ) . . , , , , ( ) . . , , , , , in : , pp . . .",
    ", , , ( ) . . , , , ( ) . ."
  ],
  "abstract_text": [
    "<S> the notion of well - separated sets is crucial in fast multipole methods as the main idea is to approximate the interaction between such sets via cluster expansions . </S>",
    "<S> we revisit the one - parameter multipole acceptance criterion in a general setting and derive a relative error estimate . </S>",
    "<S> this analysis benefits asymmetric versions of the method , where the division of the multipole boxes is more liberal than in conventional codes . </S>",
    "<S> such variants offer a particularly elegant implementation with a balanced multipole tree , a feature which might be very favorable on modern computer architectures .    </S>",
    "<S> fast multipole method , balanced tree , asymmetric adaptive mesh , error analysis , cartesian expansion . </S>",
    "<S> 65m15 , 65m80 . </S>"
  ]
}