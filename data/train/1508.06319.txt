{
  "article_text": [
    "control is ubiquitous in atomic , molecular , and optical ( amo ) physics .",
    "a typical experiment might include a dozen or more feedback controllers for tasks such as laser frequency , power , and phase stabilization @xcite ; temperature stabilization @xcite ; and vibration isolation @xcite .",
    "yet the control repertoire practiced by an average amo physicist is often limited to simple proportional - integral - derivative ( pid ) feedback , unable to leverage the developments of the field of control theory over the past several decades @xcite .    with the rapid development of hardware suitable for low - latency digital signal processing ( dsp ) , such as field - programmable gate arrays ( fpgas ) and digital signal processors ,",
    "high - speed digital feedback controllers have become increasingly practical and increasingly common over the past decade .",
    "the advantages of a digital approach include fast and easy ( no soldering ) reconfiguration of the feedback transfer function ; implementation of multiple - input , multiple - output ( mimo ) transfer functions with shapes that go beyond pid @xcite ; the ability to detect whether the system is currently locked and to perform automatic lock acquisition @xcite ; the integration of signal pre - processing such as digital lock - in amplifiers for generation of the error signal @xcite ; and the integration of diagnostics for easy analysis of open- and closed - loop system performance @xcite . while for many years digital controllers were limited to low bandwidth applications such as temperature controllers , modern hardware is capable of mhz bandwidth feedback control . however , there is typically a tradeoff between ease of use and performance , with microcontrollers being easier to program and less expensive but limited to feedback bandwidths below about 100  khz @xcite , and digital signal processors and fpgas being capable of several mhz feedback bandwidths but more expensive and usually requiring knowledge of specialized , low - level programming languages @xcite .",
    "we have developed a general purpose digital servo optimized for feedback control of lasers in amo physics experiments .",
    "the servo is based on a custom - built hardware box that includes an fpga for computation of feedback transfer functions , two channels of low - noise and high - speed analog - to - digital conversion ( adc ) , and three channels of low - noise and high - speed digital - to - analog conversion ( dac ) .",
    "the hardware latency is suitable for feedback to acousto - optic modulators ( aoms ) with bandwidths of several hundred khz , and one of the analog output channels includes a high - voltage amplifier for driving piezoelectric transducers ( pzts ) .",
    "configuration of the feedback transfer function and diagnostic tools are controlled via a graphical user interface ( gui ) that runs on a standard personal computer ( pc ) .",
    "the hardware and software design is public domain and available for download online @xcite .",
    "others are encouraged to use the digital servo as is ( which does not require knowledge of any programming languages ) , or to modify the design to suit their own purposes and to contribute their modifications to the project website .",
    "the goal of this project is to lower the entry barrier for the use of high - performance digital control tools , enabling physicists to go beyond simple pid .",
    "this paper proceeds as follows .",
    "section  [ sec : design ] describes the hardware , firmware , and software design of the digital servo .",
    "section  [ sec : applications ] describes the use of the digital servo in two example applications : frequency control of the clock laser used in an @xmath0al@xmath1 optical atomic clock , and length control of a cavity used for resonant frequency doubling of a laser .",
    "some of the advantages of the digital servo relative to analog servos are highlighted .",
    "section  [ sec : conclusion ] summarizes and concludes .",
    "finally , appendix  [ sec : dspprimer ] presents a detailed description of the digital filter design used in the digital servo .",
    "the digital servo is comprised of a custom - built hardware box that implements the desired feedback transfer function using infinite impulse response ( iir ) filters in an fpga , firmware that describes the dsp in the fpga , and a software gui that runs on a pc for setting the feedback transfer function and controlling diagnostic tools .",
    "these three components will be described in the following three subsections .",
    "the digital servo hardware consists of two printed circuit boards ( pcbs ) packaged in a @xmath2  mm@xmath3 box .",
    "the first is a commercial fpga integration module ( opal kelly xem6010-lx150 @xcite ) , which contains a xilinx spartan 6 xc6slx150 - 2 fpga @xcite , a 32 mb flash memory , a 128 mb sdram , and a universal serial bus ( usb ) 2.0 interface .",
    "this fpga was selected for its combination of high dsp performance and relatively low cost .",
    "specifically , it contains 180 dsp48a1 slices that are each capable of performing @xmath4 bit signed integer multiplication in a single clock cycle .",
    "the @xmath5 bit signed integer multiplications used to compute the iir filters in the digital servo are performed using four dsp48a1 slices combined to form a single multiplier .",
    "although the maximum clock rate for these @xmath5 multipliers is specified to be 39  mhz in the timing report generated by the xilinx ise design suite @xcite , we overclock them at 100  mhz without any pipeline stages and have not seen any resulting multiplication errors .",
    "note , however , that all testing and operation of the digital servos reported here took place in well temperature controlled laboratories , and that temperatures or supply voltages closer to the specified limits of the fpga may cause multiplication errors at this clock rate .",
    "the flash memory is used to store both the fpga firmware and the servo feedback configuration while the power is off .",
    "the sdram is used to store the values of the digitized signals at sample rates up to 6  mhz ; this data is read back to the pc at a slower rate for off - line analysis of noise spectra and transfer functions .",
    "the digital servo hardware communicates with the pc over the usb interface .",
    "the second pcb is a custom - built daughterboard that provides two channels of high - speed analog input , two channels of high - speed analog output , and one channel of low - speed analog output .",
    "the high - speed inputs and outputs are implemented by a two channel , 16 bit adc ( linear technology ltc2195 @xcite ) and a two channel , 16 bit dac ( analog devices ad9783 @xcite ) , both of which operate with update rates of 100  mhz . these chips were selected for their low pipeline delays , their low noise , and their use of low voltage differential signal ( lvds ) interfaces .",
    "input and output range scaling of the high - speed channels is provided by variable gain amplifiers ( vgas , analog devices ad8251 @xcite ) , so that the high - speed inputs have a software selectable range of @xmath6  v , @xmath7  v , @xmath8  v , or @xmath9  v and the high - speed outputs have a software selectable range of @xmath7  v , @xmath8  v , @xmath9  v , or @xmath10  v. the analog bandwidth of the high speed inputs and outputs is limited by the vgas to between 3  mhz and 10  mhz depending on the gain setting .",
    "the low - speed output is implemented by a single channel , 20 bit dac ( analog devices ad5791 @xcite ) that operates with a 1  mhz update rate .",
    "two output amplifiers are included so that the output range 0  v to @xmath11  v is available on one output connector and the output range 0  v to @xmath12  v is available on a second output connector .",
    "the daughterboard also provides several channels of digital input , which can be used for integrator hold or automatic lock acquisition functionality , and digital output , which can be used to tell other parts of a complex experiment whether the servo is currently locked .",
    "the input noise of the analog inputs when set to the @xmath6  v input range and shorted to ground is 50  nv@xmath13 at 1  khz , and the long - time stability is 2  @xmath14v for averaging times between @xmath15  s and @xmath16  s ( in a well temperature controlled laboratory ) .",
    "note that this stability is smaller than one bit of the 16 bit adc , which is possible because we are oversampling in the regime where the analog noise at the input of the adc is slightly larger than one bit @xcite .",
    "this dithering is important as it suppresses limit cycle oscillations .",
    "the output noise of the high - speed analog outputs when set to the @xmath7  v output range is 40  nv@xmath13 at 1  khz .",
    "the output noise of the low - speed analog output is 20  nv@xmath13 at the 0  v to @xmath11  v output range connector and 300  nv@xmath13 at the 0  v to @xmath12  v output range connector at 1  khz .",
    "the digital servo firmware is written in the verilog hardware description language @xcite using the xilinx ise design suite @xcite .",
    "figure  [ fig : digitalservoblockdiagram ] shows a block diagram depicting the dsp modules and signal paths .",
    "most of the calculations are clocked at 100  mhz .",
    "the discretized analog signals are passed between dsp modules in the fpga as 24 bit signed integer signals , and the iir filters internally use 35 bit signed integer signals to represent both the data and the coefficients to prevent rounding errors @xcite .",
    "the settings of each module and all of the signal connections not pictured in fig .",
    "[ fig : digitalservoblockdiagram ] are software configurable in the gui , and many of the iir filters can be optionally bypassed when they are not needed to minimize the latency .",
    "each of the analog inputs is immediately followed by a first - order iir filter .",
    "this filter can be either enabled or disabled ( bypassed ) and is typically configured as a low - pass filter to remove input noise above the desired feedback bandwidth .",
    "each analog output signal is generated as the sum of a loop filter module ( i.e. , feedback controller ) , a sweep module that generates a triangle wave , and a relock module that performs automatic lock acquisition .",
    "the loop filter module can take any of the analog signals as its input and consists of up to four sequentially applied first- or second - order iir filters .",
    "for example , a proportional - integral - integral - derivative ( piid ) filter , which is third order , can be configured by enabling three sequential first order iir filters ( pi , pi , pd where pi is a proportional - integral filter and pd is a proportional - derivative filter ) . for a comprehensive description of the iir filters implemented in the digital servo as well as",
    "bode diagrams of the built - in iir filter transfer functions , see appendix  [ sec : dspprimer ] .",
    "the relock module can accept any of the analog signals or digital inputs as its input . if the input signal is within the software defined",
    "`` locked '' range , the relock module output is zero .",
    "if the input signal falls outside the `` locked '' range , the relock module holds the output ( and internal state ) of the loop filter module constant and outputs a triangle wave sweep with an amplitude that doubles every cycle and a constant slew rate .",
    "once the input signal returns to the `` locked '' range , the loop filter module is re - enabled and the relock module output ramps back to zero .",
    "@xmath17{lp } & \\includegraphics[width=1.0\\columnwidth]{hp } \\\\",
    "\\includegraphics[width=1.0\\columnwidth]{ap } & \\includegraphics[width=1.0\\columnwidth]{i } \\\\",
    "\\includegraphics[width=1.0\\columnwidth]{pi } & \\includegraphics[width=1.0\\columnwidth]{pd } \\end{array } $ ]        formally , the transfer function is obtained by laplace transformation of the equations of motion of the dynamical system . in practice",
    ", however , controller transfer function design typically proceeds in the reverse direction : first a transfer function is postulated and second a corresponding controller ( i.e. , dynamical system ) is built . for a gain - limited pi filter ,",
    "we postulate the transfer function @xmath18 where @xmath19 is the proportional gain , @xmath20 is the pi corner frequency , and @xmath21 is the gain limit .",
    "to convert from the laplace transformation variable @xmath22 to angular frequency @xmath23 , simply evaluate @xmath24 at @xmath25 .      to go from a continuous transfer function @xmath24 to a discrete transfer function @xmath26 , we use tustin s transformation ( an approximate version of the @xmath27 transformation ) : @xmath28 where @xmath29 is the sample time .",
    "this corresponds to discretization of the equations of motion using the trapezoidal rule for integration . for the case of the gain - limited pi filter",
    ", we get @xmath30      the inverse of the @xmath27 transformation variable , @xmath31 , means `` delay by @xmath29 '' . as a result",
    ", the general discrete transfer function @xmath32 can be interpreted as an iir filter with a corresponding difference equation @xmath33 where @xmath34 are the inputs and @xmath35 are the outputs . for the case of the gain - limited pi filter , the iir filter coefficients are given by @xmath36          a final consideration is that on the fpga , iir filters are implemented with finite precision ( fixed point ) math .",
    "thus , it is important to consider truncation of both the filter coefficients and the data , as well as potential overflow due to high gain . in our implementation , the gain - limited pi filter coefficients above are scaled by @xmath37 and we use 35 bit @xmath38 35 bit signed integer multiplication . figs .",
    "[ fig : iir1 ] and [ fig : iir2 ] show the finite precision transfer functions of the iir filters built in to the digital servo ; their good agreement with the continuous transfer functions indicates that we are using enough bits .",
    "the first - order iir filters are implemented in the fpga as shown in fig .",
    "[ fig : iirfilterimplementation ] .",
    "a new output is calculated every clock cycle , and the latency is three clock cycles .",
    "the second - order iir filters are implemented using a finite state machine that calculates a new output every 27 clock cycles based on eq .",
    "[ eq : iirdifferenceeqn ] .",
    "a single @xmath5 bit multiplier is used in a time multiplexed fashion to sequentially compute all five of the multiplications , and the latency is eight clock cycles ."
  ],
  "abstract_text": [
    "<S> we describe a general purpose digital servo optimized for feedback control of lasers in atomic , molecular , and optical ( amo ) physics experiments . </S>",
    "<S> the servo is capable of feedback bandwidths up to roughly 1  mhz ( limited by the 320  ns total latency ) ; loop filter shapes up to fifth order ; multiple - input , multiple - output control ; and automatic lock acquisition . the configuration of the servo is controlled via a graphical user interface , which also provides a rudimentary software oscilloscope and tools for measurement of system transfer functions . </S>",
    "<S> we illustrate the functionality of the digital servo by describing its use in two example scenarios : frequency control of the laser used to probe the narrow clock transition of @xmath0al@xmath1 in an optical atomic clock , and length control of a cavity used for resonant frequency doubling of a laser . </S>"
  ]
}