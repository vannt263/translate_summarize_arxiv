{
  "article_text": [
    "the fundamental combinatorial problem of graph coloring is as ancient as the cartographer s task of coloring a map without using the same color on neighboring regions . in the context of general graphs ,",
    "we say that an assignment of a color to every vertex is a _ proper coloring _ if no two adjacent vertices receive the same color , and we say that a graph is _",
    "@xmath1-colorable _ it has a proper coloring using only at most @xmath1 different colors .    the problem of counting the number @xmath0 of @xmath1-colorings of a given graph @xmath2 has been the focus of much research over the past century .",
    "although it is already np - hard even to determine whether this number is nonzero , the function @xmath0 itself has very interesting properties .",
    "@xmath0 was first introduced by birkhoff @xcite , who proved that it is always a polynomial in @xmath1 .",
    "it is now called the _ chromatic polynomial _ of @xmath2 .",
    "although @xmath0 has been studied for its own sake ( e.g. , whitney @xcite expressed its coefficients in terms of graph theoretic parameters ) , perhaps more interestingly there is a long history of diverse applications which has led researchers to minimize or maximize @xmath0 over various families of graphs .",
    "in fact , birkhoff s original motivation for investigating the chromatic polynomial was to use it to attack the famous four - color theorem . indeed , one way to show that every planar graph is 4-colorable is to minimize @xmath3 over all planar @xmath2 , and show that the minimum is nonzero . in this direction birkhoff",
    "@xcite proved the tight lower bound @xmath11 for all @xmath4-vertex planar graphs @xmath2 when @xmath12 , later conjecturing with lewis in @xcite that it extended to @xmath13 as well .",
    "linial @xcite arrived at the problem of minimizing the chromatic polynomial from a completely different motivation .",
    "the worst - case computational complexity of determining whether a particular function @xmath14 is a proper coloring ( i.e. , satisfies @xmath15 for every pair of adjacent vertices @xmath16 and @xmath17 ) is closely related to the number of _ acyclic orientations _ of a graph , which equals @xmath18 , obtained by substituting @xmath19 into the formal polynomial expression of @xmath0 .",
    "lower bounding the worst - case complexity therefore corresponds to minimizing @xmath18 over the family @xmath20 of graphs with @xmath4 vertices and @xmath5 edges .",
    "linial showed that that surprisingly , for any @xmath21 there is a graph which _ simultaneously _ minimizes each @xmath22 over @xmath20 , for _ every _ integer @xmath1 .",
    "this graph is simply a clique @xmath23 with an additional vertex adjacent to @xmath24 vertices of the @xmath23 , plus @xmath25 isolated vertices , where @xmath26 are the unique integers satisfying @xmath27 with @xmath28 . at the end of his paper , linial posed the problem of maximizing @xmath0 over all graphs in @xmath20 .    around the same time",
    ", wilf arrived at exactly that maximization problem while analyzing the _ backtrack _ algorithm for finding a proper @xmath1-coloring of a graph ( see @xcite ) .",
    "although this generated much interest in the problem , it was only solved in sporadic cases .",
    "the special case @xmath29 was completely solved for all @xmath30 , by lazebnik in @xcite . for @xmath31 ,",
    "the only nontrivial pairs @xmath30 for which extremal graphs were known corresponded to the number of vertices and edges in the turn graph @xmath32 , which is the complete @xmath33-partite graph on @xmath4 vertices with all parts of size either @xmath34 or @xmath35 . in this vein , lazebnik @xcite proved that @xmath32 is optimal for very large @xmath36 , and proved with pikhurko and woldar @xcite that @xmath37 is optimal when @xmath9 and asymptotically optimal when @xmath13 .",
    "outside these isolated cases , very little was known for general @xmath30 .",
    "although many upper and lower bounds for @xmath0 were proved by various researchers @xcite , these bounds were widely separated .",
    "even the @xmath9 case resisted solution : twenty years ago , lazebnik @xcite conjectured that when @xmath38 , the @xmath4-vertex graphs with @xmath5 edges which maximized the number of 3-colorings were complete bipartite graphs minus the edges of a star , plus isolated vertices . only very recently",
    ", simonelli @xcite managed to make some progress on this conjecture , verifying it under the additional very strong assumption that all optimal graphs are already bipartite .",
    "perhaps part of the difficulty for general @xmath39 stems from the fact that the maximal graphs are substantially more complicated than the minimal graphs that linial found . for number - theoretic reasons ,",
    "it is essentially impossible to explicitly construct maximal graphs for general @xmath30 .",
    "furthermore , even their coarse structure depends on the density @xmath40 .",
    "for example , when @xmath40 is small , the maximal graphs are roughly complete bipartite graphs , but after @xmath41 , the maximal graphs become tripartite . at the most extreme density , when @xmath30 correspond to the turn graph @xmath42 , the unique maximal graph is obviously the complete @xmath1-partite graph .",
    "therefore , in order to tackle the general case of this problem , one must devise a unified approach that can handle all of the outcomes .    in this paper , we propose such an approach , developing the machinery that one might be able to use to determine the maximal graphs in many nontrivial ranges of @xmath30 .",
    "our methodology can be roughly outlined as follows .",
    "we show , via szemerdi s regularity lemma , that the asymptotic solution to the problem reduces to a certain quadratically - constrained linear program in @xmath43 variables . for any given @xmath1",
    ", this task can in principle be automated by a computer code that symbolically solves the optimization problem , although a more sophisticated approach was required to solve this for all @xmath1 .",
    "our solutions to the optimization problem then give us the approximate structure of the maximal graphs .",
    "finally , we use various local arguments , such as the so - called `` stability '' approach introduced by simonovits @xcite , to refine their structure into precise results .",
    "we successfully applied our machinery to solve the linial - wilf problem for many nontrivial ranges of @xmath30 , and @xmath44 .",
    "in particular , for @xmath9 , our results confirm a stronger form of lazebnik s conjecture when @xmath5 is large .",
    "in addition , for each @xmath6 we show that for all densities @xmath40 up to approximately @xmath45 , the extremal graphs are also complete bipartite graphs minus a star . in order to state our results",
    "precisely , we need the following definition .",
    "[ def : semi - complete ] let @xmath46 be positive integers .",
    "we say that @xmath2 is a * semi - complete subgraph of @xmath47 * if the number of missing edges @xmath48 is less than @xmath49 , and they form a star ( i.e. , they share a common endpoint @xmath50 which we call the * center * ) .",
    "if @xmath50 belongs to the larger side of @xmath51 , then we also say that @xmath2 is * correctly oriented*.    define the constant @xmath52 .",
    "all logarithms here and in the rest of the paper are in base @xmath53 . in the following theorems ,",
    "we write @xmath54 to represent a quantity that tends to zero as @xmath55 .",
    "[ thm : main : sparse ] for every fixed integer @xmath44 , and any @xmath56 , the following holds for all sufficiently large @xmath5 with @xmath57 .",
    "every @xmath4-vertex graph with @xmath5 edges which maximizes the number of @xmath1-colorings is a semi - complete subgraph ( correctly oriented if @xmath58 ) of some @xmath51 , plus isolated vertices , where @xmath59 and @xmath60 .",
    "the corresponding number of @xmath1-colorings is @xmath61 , where @xmath62 .",
    "* the part sizes of the maximal graphs above all have the ratio roughly @xmath63 .",
    "the constant @xmath64 corresponds to the density @xmath65 at which the number of isolated vertices becomes @xmath66 in the optimal construction .    for 3 colors",
    ", we can push our argument further , beyond the density @xmath67 .",
    "now , due to the absence of isolated vertices , a rare exception occurs , which requires us to include an additional possibility .",
    "here , a `` pendant edge '' means that a new vertex is added , along with a single edge between it and any other vertex in the graph .",
    "proposition [ prop : pendant - necessary ] shows that this outcome is in fact necessary .",
    "[ thm : main : q=3 ] the following holds for all sufficiently large @xmath38 .",
    "every @xmath4-vertex graph with @xmath5 edges and the maximum number of 3-colorings is either * ( i ) * a semi - complete subgraph of some @xmath51 , plus isolated vertices if necessary , or * ( ii ) * a complete bipartite graph @xmath51 plus a pendant edge . furthermore :    * if @xmath68 , then @xmath69 and @xmath70 .",
    "the corresponding number of colorings is @xmath71 , where @xmath72 . * if @xmath73 , then @xmath74 and @xmath75 .",
    "the corresponding number of colorings is @xmath76 .",
    "we also considered another conjecture of lazebnik ( see , e.g. , @xcite ) , that the turn graphs @xmath32 are always extremal when @xmath77 .",
    "building upon the techniques in @xcite that answered the @xmath78 case , we confirmed this conjecture for large @xmath4 and @xmath79 .",
    "[ thm : exact : turan ] fix an integer @xmath6 . for all sufficiently large @xmath4 ,",
    "the turn graph @xmath80 has more @xmath1-colorings than any other graph with the same number of vertices and edges .",
    "we close by mentioning some related work .",
    "tomescu @xcite and dohmen @xcite considered the problem of maximizing or minimizing the number of @xmath1-colorings of @xmath2 given some other parameters , such as chromatic number , connectedness , planarity , and girth .",
    "wright @xcite asymptotically determined the total number of @xmath1-colored labeled @xmath4-vertex graphs with @xmath5 edges , for the entire range of @xmath5 ; this immediately gives an asymptotic approximation for the _ average _ value of @xmath0 over all labeled @xmath4-vertex graphs with @xmath5 edges .    graph coloring is also a special case of a homomorphism problem , and as we will discuss in our concluding remarks , our approach easily extends to that more general setting .",
    "recall that a graph homomorphism @xmath81 is a map from the vertices of @xmath2 to those of @xmath82 , such that adjacent vertices in @xmath2 are mapped to adjacent vertices in @xmath82 .",
    "thus , the number of @xmath1-colorings of @xmath2 is precisely the number of homomorphisms from @xmath2 to @xmath83 .",
    "another interesting target graph @xmath82 is the two - vertex graph consisting of a single edge , plus a loop at one vertex .",
    "then , the number of homomorphisms is precisely the number of independent sets in @xmath2 , and the problem of estimating that number given some partial information about @xmath2 is motivated by various questions in statistical physics and the theory of partially ordered sets .",
    "alon @xcite studied the maximum number of independent sets that a @xmath84-regular graph of order @xmath4 can have , and kahn @xcite considered this problem under the additional assumption that the @xmath84-regular graph is bipartite .",
    "galvin and tetali @xcite generalized the main result from @xcite to arbitrary target graphs @xmath82 .",
    "another direction of related research was initiated by the question of erds and rothschild ( see erds @xcite , yuster @xcite , alon , balogh , keevash , and sudakov @xcite , balogh @xcite , and others ) , about the maximum over all @xmath4-vertex graphs of the number of @xmath1-edge - colorings ( not necessarily proper ) that do not contain a monochromatic @xmath85-subgraph .",
    "our method is somewhat similar to that in @xcite , and these two problems may be more deeply related than just a similarity in their formulations .",
    "the rest of this paper is organized as follows .",
    "the next section contains some definitions , and a formulation of the szemerdi regularity lemma . in section [ sec : reduction - to - opt ] , we prove theorems [ thm : asymp - number ] and [ thm : asymp - stability ] , which ( asymptotically ) reduce the general case of the problem to a quadratically constrained linear program .",
    "then , in the next section we solve the relevant instances of the optimization problem to give approximate versions of our main theorems . sections [ sec : exact : sparse ] and [ sec : exact : q=3 ] refine these into the precise forms of theorems [ thm : main : sparse ] and [ thm : main : q=3 ] .",
    "we prove theorem [ thm : exact : turan ] in section [ sec : exact : turan ] .",
    "the final section contains some concluding remarks and open problems .",
    "the following ( standard ) asymptotic notation will be utilized extensively . for two functions @xmath86 and @xmath87 , we write @xmath88 if @xmath89 , and @xmath90 or @xmath91 if there exists a constant @xmath92 such that @xmath93 for all sufficiently large @xmath4 .",
    "we also write @xmath94 if both @xmath95 and @xmath96 are satisfied",
    ".    we will use @xmath97 $ ] to denote the set @xmath98 , and @xmath99}$ ] to denote the collection of all of its subsets . as mentioned in the introduction , the _ turn graph _",
    "@xmath42 is the complete @xmath33-partite graph on @xmath4 vertices with all parts of size either @xmath34 or @xmath35",
    ".    given two graphs with the same number of vertices , their _",
    "edit distance _ is the minimum number of edges that need to be added or deleted from one graph to make it isomorphic to the other .",
    "we say that two graphs are _",
    "@xmath100-close _ if their edit distance is at most @xmath100",
    ".    the rest of this section is devoted to formulating the celebrated szemerdi regularity lemma .",
    "this theorem roughly states that every graph , no matter how large , can be approximated by an object of bounded complexity , which corresponds to a union of a bounded number of random - looking graphs .",
    "to measure the randomness of edge distribution , we use the following definition .",
    "let the edge density @xmath101 be the fraction @xmath102 , where @xmath103 is the number of edges between @xmath104 and @xmath105 .",
    "a pair @xmath106 of disjoint subsets of a graph is * @xmath107-regular * if every pair of subsets @xmath108 and @xmath109 with @xmath110 and @xmath111 has @xmath112 .    in this paper",
    ", we use the following convenient form of the regularity lemma , which is essentially theorem iv.5.@xmath113 in the textbook @xcite .    [ thm : regularity - lemma ] for every @xmath114",
    ", there is a natural number @xmath115 such that * every * graph @xmath116 has a partition @xmath117 with the following properties .",
    "the sizes of the vertex clusters @xmath118 are as equal as possible ( differing by at most 1 ) , their number is between @xmath119 , and all but at most @xmath120 of the pairs @xmath121 are @xmath107-regular .",
    "in this section , we show that the solution of the following quadratically constrained linear .",
    "] program answers our main problem asymptotically .",
    "* optimization problem 1 .",
    "* fix an integer @xmath122 and a real parameter @xmath123 .",
    "consider the following objective and constraint functions : @xmath124 the vector @xmath125 has @xmath43 coordinates @xmath126 indexed by the nonempty subsets @xmath127 $ ] , and the sum in @xmath128 runs over _ unordered _ pairs of disjoint nonempty sets @xmath129 .",
    "let @xmath130 be the _",
    "feasible set _ of vectors defined by the constraints @xmath131 , @xmath132 , and @xmath133 .",
    "we seek to maximize @xmath134 over the set @xmath130 , and we define @xmath135 to be this maximum value , which exists by compactness .",
    "we will write that the vector @xmath125 _ solves _ @xmath135 when both @xmath136 and @xmath137 .",
    "* in the remainder of this paper , we will write @xmath138 instead of @xmath139 because it is clear from the definition of @xmath125 that the empty set is excluded .    * construction 1 : @xmath140 .",
    "* let @xmath4 and @xmath5 be the desired numbers of vertices and edges , and let @xmath141 be a feasible vector .",
    "consider the following @xmath4-vertex graph , which we call @xmath142 .",
    "partition the vertices into ( possibly empty ) clusters @xmath143 such that each @xmath144 differs from @xmath145 by less than 1 . for every pair of clusters @xmath146 which is indexed by disjoint subsets , place a complete bipartite graph between the clusters .",
    "observe that any coloring that for each cluster @xmath143 uses only colors from @xmath104 is a proper coloring . therefore ,",
    "if all @xmath145 happened to be integers , then @xmath142 would have at least @xmath147 colorings , and also precisely @xmath148 edges .",
    "but we can not simply apply construction 1 to the @xmath125 that solves @xmath149 , because it may happen that @xmath142 has fewer than @xmath5 edges if the entries of @xmath125 are not integer multiples of @xmath150 .",
    "fortunately , the shortfall can not be substantial :    [ prop : construction - asymp - edges ] the number of edges in any @xmath142 differs from @xmath151 by less than @xmath152 . also , for any other vector @xmath153 , the edit - distance between @xmath142 and @xmath154 is at most @xmath155 , where @xmath156 is the @xmath157-norm .",
    "the proof is elementary and routine , so we will defer it to section [ sec : pf - asymp - number - ii ] so as not to interrupt this exposition . to recover from the @xmath158 edge deficit , we extend the construction in the following way .    * construction 2 : @xmath159 .",
    "* let @xmath4 and @xmath5 be the desired numbers of vertices and edges , and let @xmath141 be a feasible vector .",
    "if @xmath142 from construction 1 already has at least @xmath5 edges , then set @xmath160 .",
    "otherwise , @xmath142 is short by , say , @xmath84 edges , and @xmath161 by proposition [ prop : construction - asymp - edges ] .",
    "let @xmath143 be its largest cluster whose index @xmath104 is not a singleton .",
    "suppose first that @xmath162 .",
    "so far @xmath143 does not span any edges , so we can add @xmath84 edges to @xmath142 by selecting two disjoint subsets @xmath163 of size @xmath164 , and putting a @xmath84-edge bipartite graph between them .",
    "call the result @xmath165",
    ".    the last case is @xmath166 .",
    "we will later show that this only arises when the maximum number of colorings is only @xmath167 , and this is already achieved by the turn graph @xmath42 .",
    "so , to clean up the statements of our theorems , we just define @xmath168 here .",
    "we are now ready to state our theorem , which shows that solutions to optimization problem 1 produce graphs which asymptotically maximize the number of @xmath1-colorings .",
    "[ thm : asymp - number ] for any @xmath114 , the following holds for any sufficiently large @xmath4 , and any @xmath5 less than or equal to the number of edges in the turn graph @xmath42 .",
    "( i ) : :    every @xmath4-vertex graph with @xmath5 edges has    fewer than @xmath169    proper @xmath1-colorings . ( ii ) : :    any @xmath125 which solves    @xmath149 yields a graph    @xmath165 via construction 2 which has    at least @xmath5 edges and more than    @xmath170 proper    @xmath1-colorings .    * remark . * the number of colorings can only increase when edges are deleted , so one may take an arbitrary @xmath5-edge subgraph of @xmath165 if one requires a graph with exactly @xmath5 edges .    the key ingredient in the proof of theorem [ thm : asymp - number ] is szemerdi s regularity lemma .",
    "part ( ii ) is routine , and full details are given in section [ sec : pf - asymp - number - ii ] .",
    "on the other hand , the argument for part ( i ) is more involved , so we highlight its structure here so that the reader does not get lost in the details .",
    "the proof breaks into the following claims .",
    "claim 1 . : :    for any @xmath171 , there exists @xmath172 such    that the following holds for any graph @xmath173 with    @xmath174 vertices and @xmath5 edges .",
    "the    regularity lemma gives a special partition of the vertex set into sets    @xmath175 , ",
    ", @xmath176 of almost equal size , where    @xmath92 is upper bounded by a constant depending only on    @xmath177 .",
    "then , we may delete at most    @xmath178 edges of @xmath2 in such a way that    the resulting graph @xmath179 has the following properties .",
    "+    ( i ) ; ;      each @xmath180 $ ] spans no edges .",
    "( ii ) ; ;      if @xmath179 has any edges at all between two parts      @xmath118 and @xmath181 , then in fact it has an edge      between every pair of subsets @xmath182 ,      @xmath183 with @xmath184 and @xmath185 .",
    "+    note that since @xmath179 is a subgraph of @xmath2 , the    number of @xmath1-colorings can only increase .",
    "claim 2 . : :    let @xmath186 be the set of colorings of    @xmath179 .",
    "then , if we keep only those colorings    @xmath187 with the property that in each @xmath118 ,    any color is used either zero times or at least    @xmath188 times , we will still have    @xmath189 .    here",
    ", @xmath190 is a constant which tends to zero with    @xmath177 . now",
    "each coloring in @xmath191    has the special property that whenever the same color appears on two    parts @xmath118 and @xmath181 , then there can not be    any edges between those entire parts .",
    "claim 3 . : :    by looking at which colors appear on each part @xmath118 , we    may associate each coloring with a map @xmath192 \\rightarrow      2^{[q]}$ ] .",
    "let @xmath193 \\rightarrow 2^{[q]}$ ] be a map    which is associated with the maximum number of colorings in    @xmath191 .",
    "then , if we keep only those colorings    @xmath194 which give @xmath195 , we still have    @xmath196 .",
    "claim 4 . : :    for every nonempty @xmath127 $ ] , let @xmath143    be the union of those parts @xmath118 for which    @xmath197 .",
    "( these are the parts that in all colorings    in @xmath198 are colored using exactly colors from    @xmath104 . )",
    "define the vector    @xmath125 by setting each    @xmath199 .",
    "then    @xmath200 , and since    @xmath179 only differs from our original @xmath2 by at    most @xmath178 edges , we also have    @xmath201 .    thus :",
    "@xmath202 claim 5 . : :    the function @xmath203 is uniformly continuous .",
    "thus , for an appropriate ( sufficiently small ) choice of    @xmath171 , we have for all sufficiently large    @xmath4 that @xmath204 as    desired .",
    "( recall that @xmath0 is the number of    @xmath1-colorings of @xmath2 . )    by combining these five claims with an elementary analysis argument , we also obtain a stability result , which roughly states that if a graph has `` close '' to the optimal number of colorings , then it must resemble a graph from construction 1 .",
    "a stability result is very useful , because the approximate structure later allows us to apply combinatorial arguments to refine our asymptotic results into exact results .",
    "we quantify this in terms of the edit - distance , which we defined in section [ sec : preliminaries ] .",
    "recall that we say that two graphs are @xmath100-close when their edit distance is at most @xmath100 .",
    "we prove the following theorem in section [ sec : asymp - stability ] .",
    "[ thm : asymp - stability ] for any @xmath205 , the following holds for all sufficiently large @xmath4 .",
    "let @xmath2 be an @xmath4-vertex , graph with @xmath206 edges , which maximizes the number of @xmath1-colorings .",
    "then @xmath2 is @xmath207-close to some @xmath142 from construction 1 , for an @xmath125 which solves @xmath135 for some @xmath208 with @xmath209 .",
    "* this theorem is only useful if the resulting @xmath123 falls within the range of densities for which the solution of @xmath203 is known .",
    "the technical parameter @xmath210 is used to keep @xmath123 within this range .",
    "the regularity lemma is nontrivial only for graphs with positive edge density ( i.e. , quadratic number of edges ) .",
    "this typically presents a serious and often insurmountable obstacle when trying to extend regularity - based results to situations involving sparse graphs .",
    "although much work has been done to develop sparse variants of the regularity lemma , the resulting analogues are weaker and much more difficult to apply .",
    "let us illustrate the issue by attempting to apply theorem [ thm : asymp - number ] when @xmath211 .",
    "then , we find that the maximum number of @xmath1-colorings of any @xmath4-vertex graph with @xmath5 edges is @xmath212 , where @xmath213 is a constant entirely determined by @xmath1 .",
    "note that the final asymptotic is independent of @xmath5 , even if @xmath5 grows extremely slowly compared to @xmath214 .",
    "this is because the key parameter was the density @xmath65 , which already vanished once @xmath211 .",
    "thus , the interesting question in the sparse case is to distinguish between sparse graphs and very sparse graphs , by looking inside the @xmath66 error term in the exponent .",
    "we are able to circumvent these difficulties by making the following key observation which allows us to pass to a dense subgraph .",
    "as it turns out , every sparse graph which maximizes the number of @xmath1-colorings has a nice structure : most of the vertices are isolated , and _ all _ of the edges are contained in a subgraph which is dense , but not too dense .",
    "section [ sec : sparse - proofs ] contains the following lemma s short proof , which basically boils down to a comparison against the smallest turn graph with at least @xmath5 edges .",
    "[ lem : sparse - has - core ] fix an integer @xmath122 and a threshold @xmath215 . given any positive integer @xmath5",
    ", there exists an @xmath216 with @xmath217 such that the following holds for any @xmath218 . in every @xmath4-vertex graph @xmath2 with @xmath5 edges , which maximizes the number of @xmath1-colorings",
    ", there is a set of @xmath172 vertices which spans all of the edges .",
    "the fact that our graph is sparse becomes a benefit rather than a drawback , because it allows us to limit the edge density from above by any fixed threshold .",
    "this is useful , because we can completely solve the optimization problem for all densities below @xmath219 .",
    "we will prove the following proposition in section [ sec : solve - opt - sparse ] .",
    "[ prop : solve - opt - sparse ] fix an integer @xmath44 . for any @xmath220 , the * unique * solution ( up to a permutation of the ground set @xmath97 $ ] ) to @xmath135 has the following form . @xmath221 } = 1 - \\alpha_{\\{1\\ } } - \\alpha_{\\{2 , \\ldots q\\}},\\ ] ] with all other @xmath222 .",
    "this gives @xmath223 .",
    "since we have the complete solution of the relevant instance of the optimization problem , we can give explicit bounds when we transfer our asymptotic results from the previous section to the sparse case .",
    "we can also explicitly describe the graph that approximates any optimal graph , as follows .",
    "let @xmath224 and @xmath225 be real numbers that satisfy @xmath226 and @xmath227 . take a complete bipartite graph between two vertex clusters @xmath175 and @xmath228 with sizes @xmath229 , and add enough isolated vertices to make the total number of vertices exactly @xmath4 .",
    "call the result @xmath230 .",
    "[ prop : asymp - sparse ] fix an integer @xmath44 .",
    "the following hold for all sufficiently large @xmath231 .",
    "( i ) : :    the maximum number of @xmath1-colorings of an    @xmath4-vertex graph with @xmath5 edges is    @xmath232 , where @xmath233 . here",
    ", the @xmath54    term tends to zero as @xmath234 .",
    "( ii ) : :    for any @xmath114 , as long as @xmath5 is    sufficiently large , every @xmath4-vertex graph @xmath2    with @xmath5 edges , which maximizes the number of    @xmath1-colorings , is @xmath235-close to the    graph @xmath236 which we described above .",
    "we prove this proposition in section [ sec : sparse - proofs ] .",
    "note that part ( i ) is precisely the final claim of theorem [ thm : main : sparse ] .",
    "this section contains the proofs of the claims in section [ sec : dense - structure - argument ] , except for claim 3 , which is obvious .",
    "together , these establish part ( i ) of theorem [ thm : asymp - number ] , which gives the asymptotic upper bound for the number of @xmath1-colorings of an @xmath4-vertex graph with @xmath5 edges .",
    "* proof of claim 1 . *",
    "apply szemerdi s regularity lemma ( theorem [ thm : regularity - lemma ] ) with parameter @xmath237 to partition of @xmath238 into nearly - equal parts @xmath175 , ",
    ", @xmath176 .",
    "then , all but @xmath120 of the pairs @xmath121 are @xmath107-regular , and @xmath239 .",
    "importantly , @xmath92 is also upper bounded by a constant independent of @xmath4 .",
    "we clean up the graph in a way typical of many applications of the regularity lemma .",
    "delete all edges in each induced subgraph @xmath240 $ ] , all edges between pairs @xmath121 which are not @xmath107-regular , and all edges between pairs @xmath121 whose edge density is at most @xmath107 .",
    "since all @xmath241 , the number of deleted edges is at most @xmath242 \\ \\leq \\ ( 1+o(1 ) ) [ \\epsilon n^2 / 2 + \\epsilon n^2 +   \\epsilon n^2 / 2 ] , \\ ] ] which is indeed less than @xmath178 when @xmath4 is sufficiently large .    it remains to show property ( ii ) .",
    "the only edges remaining in @xmath179 are those between @xmath107-regular pairs @xmath121 with edge - density greater than @xmath107 . by definition of @xmath107-regularity",
    "( and since @xmath243 , the edge density between every pair of sets @xmath244 , @xmath245 must be positive .",
    "in particular , there must be at least one edge , which establishes property ( ii ) .",
    "@xmath246    * proof of claim 2 .",
    "* we aim to establish @xmath189 , with @xmath247 .",
    "it is a simple calculus exercise to verify that @xmath248 as @xmath249 .",
    "let us show that we can obtain any coloring @xmath250 by starting with an appropriate coloring @xmath251 , and changing only a few color choices .",
    "since we may assume @xmath252 , every part @xmath118 has some color @xmath253 which appears on at least @xmath177-fraction of its vertices .",
    "now consider each @xmath118 .",
    "for every color @xmath254 which appears less than @xmath188 times in @xmath118 , use color @xmath253 to re - color all vertices of @xmath118 that had color @xmath254 under @xmath255 . now all colors appear either 0 or at least @xmath188 times , so once we verify that the coloring is still proper , we will have our desired @xmath251 .",
    "but the only way to make a monochromatic edge is to have two distinct parts @xmath118 , @xmath181 , with @xmath256 , joined by at least one edge .",
    "then part ( ii ) of claim 1 implies that there is also some edge between the @xmath188 vertices in @xmath118 originally colored @xmath253 under @xmath255 , and the @xmath257 vertices in @xmath181 originally colored @xmath258 .",
    "this contradicts the fact that @xmath255 was a proper coloring .    reversing the process",
    ", it is clear that @xmath255 can be recovered by taking @xmath251 and changing the colors of at most @xmath188 vertices for every color @xmath259 $ ] and every @xmath260 .",
    "note that for each @xmath259 $ ] , we recolor a subset of @xmath2 of total size at most @xmath261 . using the bounds @xmath262 and @xmath263 , we see that the total number of distinct ways in which we can modify any given @xmath251 is at most @xmath264^q    \\ \\leq \\ \\left [ ( 1 + \\delta n ) { n \\choose \\delta n } \\right]^q    \\ \\leq \\ \\left [ e^{\\delta n } \\left(\\frac{en}{\\delta n}\\right)^{\\delta n } \\right]^q    \\ = \\ e^{c_\\delta n},\\ ] ] which provides the desired upper bound on latexmath:[$|\\mathcal{c}_1| /     the final part of this claim is a simple consequence of property ( ii ) of claim 1 . indeed , suppose that some coloring in @xmath191 assigns the same color @xmath254 to some vertices @xmath266 and @xmath267 .",
    "since this is a proper coloring , there can not be any edges between @xmath268 and @xmath269 . yet",
    "@xmath270 and @xmath271 by definition of @xmath191 .",
    "therefore , by property ( ii ) of claim 1 , there are no edges at all between @xmath118 and @xmath181 , as claimed .",
    "* proof of claim 4 . *",
    "recall that @xmath142 was obtained in construction 1 by putting a complete bipartite graph between every pair ( @xmath272 ) indexed by disjoint subsets .",
    "the last part of claim 2 implies that @xmath179 has no edges at all between parts @xmath118 and @xmath181 which receive overlapping color sets under @xmath198 .",
    "furthermore , each @xmath180 $ ] is empty by part ( i ) of claim 1 .",
    "so , @xmath179 has no edges in each @xmath143 , and also has no edges between any @xmath143 and @xmath273 that are indexed by overlapping sets .",
    "hence @xmath179 is indeed a subgraph of @xmath142 .",
    "furthermore , @xmath142 has at least @xmath274 edges , because @xmath179 differs from @xmath2 by at most @xmath178 edges .",
    "yet all @xmath145 are integers by construction , so @xmath142 has precisely @xmath148 edges",
    ". therefore , @xmath275 , as claimed .",
    "the final inequality in claim 4 follows from the fact that @xmath198 only uses colors from @xmath104 to color each @xmath143 , and the definitions of @xmath199 and @xmath276 .",
    "@xmath246    * proof of claim 5 . *",
    "the only nontrivial part of this claim is the continuity of @xmath203 on its domain , which is the set of @xmath123 for which @xmath277 .",
    "this is easily recognized as the interval @xmath278 $ ] , where the upper endpoint , which corresponds to the @xmath1-partite turn graph , equals @xmath128 for the vector @xmath125 with @xmath279 for all singletons @xmath104 .",
    "note that the constraint @xmath131 already guarantees that @xmath280 , so @xmath203 is constant on @xmath281 $ ] .",
    "fix an @xmath114 .",
    "since @xmath203 is monotonically decreasing by definition , and constant on @xmath281 $ ] , it suffices to show that any @xmath282 with @xmath283 has @xmath284 .",
    "select any @xmath125 which solves @xmath135 .",
    "we will adjust @xmath125 to find an @xmath285 with @xmath286 , using essentially the same perturbation as in construction 2 .",
    "if there is an @xmath287 with @xmath288 , shift @xmath107 of @xmath289 s value falls by @xmath290 , and each of @xmath291 and @xmath292 increase by @xmath107 . ] to each of @xmath291 and @xmath292 for distinct @xmath293 .",
    "this clearly keeps @xmath294 invariant , and it increases @xmath128 by at least @xmath295 because @xmath296 is a summand of @xmath128 .",
    "yet it only reduces @xmath134 by at most @xmath297 , so @xmath298 , finishing this case .    on the other hand ,",
    "if all non - singletons @xmath104 have @xmath299 , then @xmath134 is already less than @xmath300 .",
    "since @xmath203 is always nonnegative , we trivially have @xmath301 , as desired .",
    "@xmath246      in this section , we establish the asymptotic tightness of our upper bound , by showing that construction 2 produces graphs that asymptotically maximize the number of @xmath1-colorings",
    ". we will need proposition [ prop : construction - asymp - edges ] , so we prove it first .",
    "* proof of proposition [ prop : construction - asymp - edges ] .",
    "* define the variables @xmath302 ( not necessarily integers ) , and call the expressions @xmath303 and @xmath304 the numbers of _ fractional vertices _ and _ fractional edges _",
    ", respectively . initially , there are exactly @xmath4 fractional vertices and @xmath148 fractional edges .",
    "recall that the construction rounds each @xmath305 either up or down to the next integer .",
    "let us perform these individual roundings sequentially , finishing all of the downward roundings before the upward roundings .",
    "this ensures that the number of fractional vertices is kept @xmath306 throughout the process .",
    "but each iteration changes the number of fractional edges by at most @xmath307 , and there are at most @xmath308 iterations , so our final number of edges is indeed within @xmath152 of @xmath5 .",
    "the second part of the proposition is proved similarly .",
    "we can apply the same iterative process to change each part size from @xmath309 to @xmath310 , in such a way that all downward adjustments are performed first .",
    "when updating the coordinate indexed by @xmath311 $ ] , we affect at most @xmath312 edges , where the extra 2 comes from the fact that the part sizes were rounded off . therefore , after the @xmath313 total iterations , the total number of edges we edit is indeed at most @xmath314 . @xmath246    * proof of theorem [ thm : asymp - number](ii ) .",
    "* let @xmath4 and @xmath5 be given , with @xmath5 less than the number of edges in the turn graph @xmath42 .",
    "suppose we have a vector @xmath315 which achieves the maximum @xmath316 .",
    "construction 2 produces a graph @xmath165 with @xmath4 vertices and at least @xmath5 edges , which we will show has more than @xmath317 proper @xmath1-colorings , as long as @xmath4 is sufficiently large .",
    "if @xmath142 already has at least @xmath5 edges , then we defined @xmath318 , which has at least @xmath319 colorings , because all colorings that use only colors from @xmath104 for each @xmath143 are proper .",
    "otherwise , @xmath142 is short by , say , @xmath84 edges , which is @xmath320 by proposition [ prop : construction - asymp - edges ] . if the largest @xmath144 indexed by a non - singleton is at least @xmath321 , our construction places a @xmath84-edge bipartite graph between @xmath163 .",
    "let @xmath322 and @xmath323 be two distinct colors in @xmath104 .",
    "even if we force every vertex in each @xmath268 to take the color @xmath324 , we only lose at most a factor of @xmath325 compared to the bound in the previous paragraph .",
    "this is because each of the @xmath326 vertices in @xmath327 had its number of color choices reduced from @xmath328 to 1 .",
    "so , @xmath165 still has at least @xmath329 colorings .",
    "the final case is when all parts @xmath143 indexed by non - singletons are smaller than @xmath326 . here",
    ", the construction simply defines @xmath165 to be the turn graph @xmath42 . since @xmath330 for singletons @xmath104 , the upper bound on @xmath144 implies that @xmath331 .",
    "this is less than @xmath107 for sufficiently large @xmath4 , because we had @xmath332 .",
    "then , @xmath333 , which is of course less than the number of @xmath1-colorings of the turn graph @xmath42 .",
    "this completes our proof .",
    "@xmath246      in this section , we prove that any @xmath4-vertex graph with @xmath5 edges , which maximizes the number of @xmath1-colorings , is in fact close ( in edit - distance ) to a graph @xmath142 from construction 1 .",
    "in fact , we prove something slightly stronger : if a graph has `` close '' to the maximum number of @xmath1-colorings , then it must be `` close '' ( in edit - distance ) to an asymptotically optimal graph from construction 1 .",
    "[ lem : asymp - stability ] for any @xmath205 , there exists @xmath171 such that the following holds for all sufficiently large @xmath4 .",
    "let @xmath2 be an @xmath4-vertex graph with @xmath57 edges and at least @xmath334 proper @xmath1-colorings .",
    "then @xmath2 is @xmath207-close to some @xmath142 from construction 1 , for an @xmath125 which solves @xmath135 for some @xmath335 with @xmath209 .",
    "note that this lemma immediately implies theorem [ thm : asymp - stability ] , because theorem [ thm : asymp - number ] established that the maximum number of colorings of an @xmath4-vertex graph with @xmath5 edges was @xmath336 .",
    "its proof is an elementary analysis exercise in compactness , which only requires the continuity of @xmath337 , @xmath203 , @xmath338 , and @xmath339 , the fact that @xmath125 and the edge densities @xmath65 reside in compact spaces , and the following consequence of claims 14 of section [ sec : dense - structure - argument ] ( whose simple proof we omit ) :    [ cor : stability - to - suboptimal ] for every @xmath171 , the following holds for all sufficiently large @xmath4 .",
    "every @xmath1-colorable , @xmath4-vertex graph @xmath2 with @xmath5 edges is @xmath178-close to a subgraph of some @xmath142 with @xmath201 . also , @xmath2 has at most @xmath340 proper @xmath1-colorings .",
    "* proof of lemma [ lem : asymp - stability ] .",
    "* we proceed by contradiction .",
    "then , there is some fixed @xmath114 , a sequence @xmath341 , and a sequence of graphs @xmath342 with the following properties .",
    "( i ) : :    @xmath342 has at least as many vertices as required to apply    corollary [ cor : stability - to - suboptimal ] with parameter    @xmath343 . (",
    "ii ) : :    @xmath342 has at least    @xmath344    colorings , where @xmath345 and @xmath346 are its    numbers of vertices and edges , and    @xmath347 .",
    "( iii ) : :    @xmath342 is at least @xmath348-far from    @xmath349 for every    @xmath125 that solves    @xmath135 with    @xmath350 .",
    "applying corollary [ cor : stability - to - suboptimal ] to each @xmath342 with parameter @xmath343 , we find vectors @xmath351 such that @xmath342 is @xmath352-close to some subgraph @xmath353 of @xmath354 , and each @xmath342 has at most @xmath355 proper @xmath1-colorings . combining this with property ( ii ) above , we find that each @xmath356 . the densities @xmath357 and the vectors @xmath358 live in bounded ( hence compact ) spaces",
    "so , by passing to a subsequence , we may assume that @xmath359 and @xmath360 for some limit points @xmath123 and @xmath125 .",
    "observe that by continuity , both @xmath361 and @xmath362 .",
    "therefore @xmath125 solves @xmath135 , i.e. , @xmath363 .",
    "furthermore , although _ a priori _ we only knew that @xmath133 , maximality implies that in fact @xmath364 . indeed , if not then one could shift more mass to @xmath365}$ ] to increase @xmath134 while staying within the feasible set . this would contradict that @xmath363 .",
    "we finish by showing that eventually @xmath342 is @xmath348-close to @xmath349 , contradicting ( iii ) . to do this ,",
    "we show that all three of the edit - distances between @xmath366 are @xmath367 .",
    "the closeness of the first pair follows by construction since @xmath341 , and the closeness of the last pair follows from proposition [ prop : construction - asymp - edges ] because @xmath368 .",
    "for the central pair , recall that @xmath353 is actually contained in @xmath354 , so we only need to compare their numbers of edges .",
    "in fact , since we already established @xmath367-closeness of the first and last pairs , it suffices to show that the difference between the number of edges in @xmath342 and @xmath349 is @xmath367 .",
    "recall from above that @xmath364 , and therefore by proposition [ prop : construction - asymp - edges ] , @xmath349 has @xmath369 edges . yet",
    "@xmath342 also has @xmath370 edges , because @xmath371 .",
    "this completes the proof .",
    "@xmath246      in this section , we prove the statements which refine our results in the case when the graph is sparse , i.e. , @xmath211 .",
    "we begin with the lemma which shows that every sparse graph with the maximum number of colorings has a dense core which spans all of the edges .",
    "* proof of lemma [ lem : sparse - has - core ] .",
    "* let @xmath372 be the number of non - isolated vertices in @xmath2 , and let @xmath33 be the number of connected components in the subgraph induced by the non - isolated vertices . since all such vertices there have degree at least 1 , we have @xmath373 .    any connected graph on @xmath374 vertices",
    "has at most @xmath375 proper @xmath1-colorings , because we may iteratively color the vertices along a depth - first - search tree rooted at an arbitrary vertex ; when we visit any vertex other than the root , there will only be at most @xmath376 colors left to choose from .",
    "so , @xmath2 has at most @xmath377 colorings , where the first factor comes from the fact that isolated vertices have a free choice over all @xmath1 colors . using @xmath373 , this bound is at most @xmath378 .",
    "but since @xmath2 is optimal , it must have at least as many colorings as the turn graph @xmath379 plus @xmath380 isolated vertices , where @xmath381 is the minimum number of vertices in a @xmath1-partite turn graph with at least @xmath5 edges .",
    "the isolated vertices already give the latter graph at least @xmath382 colorings , so we must have @xmath383 , which implies that @xmath384 the expression on the right hand side is @xmath385 , so if we define the integer @xmath172 to be the maximum of right hand side in and @xmath386 ( rounding up to the next integer if necessary ) then we indeed have @xmath387 .",
    "@xmath246    next , we prove the first part of proposition [ prop : asymp - sparse ] , which claims that the maximum number of @xmath1-colorings of an @xmath4-vertex graph with @xmath231 edges is asymptotically @xmath388 , where @xmath389 and @xmath390",
    ".    * proof of proposition [ prop : asymp - sparse](i ) .",
    "* let @xmath2 be an @xmath4-vertex graph with @xmath5 edges , which maximizes the number of @xmath1-colorings .",
    "let @xmath172 be the integer obtained by applying lemma [ lem : sparse - has - core ] with threshold @xmath64 . if @xmath391 , the lemma gives a dense @xmath172-vertex subgraph @xmath392 which contains all of the edges .",
    "otherwise , set @xmath393 . in either case , we obtain a graph @xmath179 whose number of vertices @xmath394 is @xmath395 , and @xmath396 .",
    "since the vertices in @xmath397 ( if any ) are isolated , the number of @xmath1-colorings of @xmath2 is precisely @xmath398 times the number of @xmath1-colorings of @xmath179 .",
    "therefore , @xmath179 must also have the maximum number of @xmath1-colorings over all @xmath394-vertex graphs with @xmath5 edges . applying theorem [ thm : asymp - number ] to @xmath179 , we find that @xmath179 has @xmath399 colorings .",
    "proposition [ prop : solve - opt - sparse ] gives us the precise answer @xmath400 , so substituting that in gives us that the number of @xmath1-colorings of @xmath2 is : @xmath401 where @xmath254 is indeed the same constant as claimed in the statement of this proposition .",
    "we finish this section by proving the stability result which shows that any optimal sparse graph is @xmath235-close ( in edit - distance ) to the graph @xmath236 defined in section [ sec : sparse - summary ] .",
    "* proof of proposition [ prop : asymp - sparse](ii ) .",
    "* let @xmath2 be an @xmath4-vertex graph with @xmath5 edges , which maximizes the number of @xmath1-colorings .",
    "we will actually show the equivalent statement that @xmath2 is @xmath402-close to @xmath236 .",
    "as in the proof of part ( i ) above , we find a dense @xmath394-vertex subgraph @xmath403 that spans all of the edges , which itself must maximize the number of @xmath1-colorings .",
    "using the same parameters as above , we have @xmath404 and @xmath405 . by theorem [ thm : asymp - stability ]",
    ", @xmath179 must be @xmath406-close to a graph @xmath407 from construction 1 , for some @xmath125 that solves @xmath135 with @xmath408 . since @xmath404 ,",
    "the graphs are @xmath409-close .",
    "the @xmath123 is within the range in which proposition [ prop : solve - opt - sparse ] solved optimization problem 1 , so @xmath407 is a complete bipartite graph plus isolated vertices , which indeed resembles @xmath236 .",
    "moreover , the ratio between the sizes of the sides of the complete bipartite graph in @xmath407 is correct , because it tends to the constant @xmath410 regardless of the value of @xmath123 .",
    "also , their product , which equals the number of edges in @xmath407 , is within @xmath409 of @xmath5 because @xmath407 is @xmath409-close to the @xmath5-edge graph @xmath179 .",
    "therefore , each of the sides of the complete bipartite graph in @xmath407 differs in size from its corresponding side in @xmath411 by at most @xmath412 .",
    "since each side of the bipartite graph in @xmath236 has size @xmath395 , we can transform @xmath407 into @xmath236 by adding isolated vertices and editing at most @xmath413 edges . yet by construction of @xmath125 , the graphs @xmath179 and @xmath407 were @xmath409-close , modulo isolated vertices .",
    "therefore , @xmath2 and @xmath236 are indeed @xmath402-close , as claimed .",
    "in this section , we solve the optimization problem for low densities , for all values of @xmath1 .",
    "we also solve it for all densities in the case when @xmath9 .",
    "the key observation is that when the edge density is low , we can reduce the optimization problem to one with no edge density parameter and no vertex constraint .",
    "this turns out to be substantially easier to solve .",
    "* optimization problem 2 .",
    "* fix an integer @xmath1 , and consider the following objective and constraint functions : @xmath414 the vector @xmath125 has @xmath415 coordinates @xmath126 indexed by the nonempty * proper * subsets @xmath311 $ ] , and the sum in @xmath128 runs over unordered pairs of disjoint sets @xmath129 . let @xmath416 be the feasible set of vectors defined by the constraints @xmath131 and @xmath417 . we seek to maximize @xmath418 over the set @xmath416 , and we define @xmath419 to be this maximum value , which we will show to exist in section [ sec : sparse : observ ] .",
    "we write that the vector @xmath125 _ solves _",
    "@xmath419 when both @xmath420 and @xmath421 .",
    "[ prop : solve - opt-2 ] for any given @xmath44 , the * unique * solution ( up to a permutation of the base set @xmath97 $ ] ) to optimization problem 2 is the vector @xmath422 with @xmath423 this gives @xmath424 .",
    "let us show how proposition [ prop : solve - opt-2 ] implies proposition [ prop : solve - opt - sparse ] , which gave the solution to optimization problem 1 for sufficiently low edge densities @xmath123 .",
    "* proof of proposition [ prop : solve - opt - sparse ] .",
    "* let @xmath422 be the unique maximizer for optimization problem 2 , and consider any number @xmath425 .",
    "then @xmath422 is still the unique maximizer of @xmath418 when @xmath125 is required to satisfy the vacuous condition @xmath426 as well .",
    "let @xmath427 be the vector obtained by dividing every entry of @xmath422 by @xmath374 , and adding a new entry @xmath428}$ ] so that @xmath429 .",
    "then , @xmath427 is the unique maximizer of @xmath418 when @xmath125 is constrained by @xmath132 and @xmath430 .",
    "but when @xmath132 is one of the constraints , then @xmath431 , so this implies that @xmath427 is the unique solution to @xmath432 .",
    "using the substitution @xmath433 , we see that @xmath427 is precisely the vector described in .",
    "since @xmath425 was arbitrary , we conclude that this holds for all @xmath123 below @xmath434 .",
    "@xmath246      we begin by showing that @xmath435 attains its maximum on the feasible set @xmath416 . since @xmath416 is clearly nonempty , there is some finite @xmath436 for which @xmath437 . in the formula for @xmath435 ,",
    "all coefficients @xmath438 of the @xmath289 are negative , so we only need to consider the compact region bounded by @xmath439 for each @xmath104 . therefore , by compactness , @xmath435 indeed attains its maximum on @xmath416 .",
    "now that we know the maximum is attained , we can use perturbation arguments to determine its location",
    ". the following definition will be convenient for our analysis .",
    "let the * support * of a vector @xmath125 be the collection of @xmath104 for which @xmath440 .",
    "the following lemma will allow us to reduce to the case of considering optimal vectors whose supports are a partition of @xmath97 $ ] .",
    "[ lem : sparse : support = partition ] one of the vectors @xmath125 which solves @xmath419 has support that is a partition$ ] .",
    "] of @xmath97 $ ] . furthermore , if the only partitions that support optimal vectors consist of a singleton plus a @xmath441-set , then in fact every vector which solves @xmath419 is supported by such a partition",
    ".    * proof . *",
    "we begin with the first statement .",
    "let @xmath125 be a vector which solves @xmath419 , and suppose that its support contains two intersecting sets @xmath104 and @xmath105 .",
    "we will perturb @xmath289 and @xmath442 while keeping all other @xmath443 s fixed . since @xmath104 and @xmath105 intersect , the polynomial @xmath128 has no products @xmath444 , i.e. , it is of the form @xmath445 , for some constants @xmath446 .",
    "furthermore , @xmath447 , or else we could reduce @xmath289 to zero without affecting @xmath128 , but this would strictly increase @xmath418 because all coefficients @xmath438 in @xmath435 are negative . similarly , @xmath448 .",
    "therefore , we may perturb @xmath289 by @xmath449 and @xmath442 by @xmath450 , while keeping @xmath128 fixed . since we may use both positive and negative @xmath374 and @xmath435 itself",
    "is linear in @xmath289 and @xmath442 , optimality implies that @xmath435 does not depend on @xmath374 .",
    "hence we may choose a @xmath374 which drives one of @xmath289 or @xmath442 to zero ( we are free to pick which one ) , and @xmath435 will remain unchanged .    repeating this process , we eventually obtain a vector @xmath125 which is supported by disjoint sets",
    ". their union must be the entire @xmath97 $ ] , because otherwise we could simply grow one of the sets in the support by adding the unused elements of @xmath97 $ ] .",
    "this would not affect @xmath128 , but it would strictly increase @xmath435 .    it remains to prove the second part of our lemma .",
    "let @xmath125 be an optimal vector , and apply the above reduction process to simplify its support .",
    "at the end , we will have a vector supported by @xmath451 and @xmath452 , by assumption .",
    "each iteration of the reduction removes exactly one set from the support , so the second to last stage will have some @xmath453 supported by three distinct sets , two of which are the final @xmath104 and @xmath105 , and the third which we call @xmath454 .    in the reduction , when we consider two overlapping sets , we are free to select which one is removed .",
    "therefore , we could choose to keep the third set @xmath454 and remove one of @xmath104 and @xmath105 , and then continue reducing until the support is disjoint , while keeping @xmath435 unchanged . yet",
    "no matter what @xmath454 was , it is impossible for this alternative reduction route to terminate in a partition of @xmath97 $ ] , contradicting the above observation that any reduction must terminate in a partition .",
    "@xmath246    [ def : sparse : ij ]",
    "let @xmath125 be a fixed vector whose support is a partition of @xmath97 $ ] .",
    "for each @xmath127 $ ] , define the expressions : @xmath455    [ lem : sparse : ij ] let @xmath125 be a vector which solves @xmath419 , whose support is a partition of @xmath97 $ ] .",
    "then :    ( i ) : :    for every @xmath127 $ ] , we have    @xmath456 . in particular , for each @xmath104 in    the support , @xmath457 . ( ii ) : :    suppose @xmath104 and @xmath105 are both in the support ,    and @xmath458 .",
    "then @xmath459 as well .    *",
    "we begin with part ( i ) .",
    "fix any @xmath460 $ ] . consider the following operation for small @xmath461 .",
    "first , replace @xmath289 by @xmath462 .",
    "observe that @xmath463 because the support of @xmath125 is a partition of @xmath97 $ ] .",
    "therefore we increase @xmath464 by @xmath465 .",
    "next , multiply all @xmath443 s ( including the one we just increased ) by @xmath466 .",
    "then @xmath128 is still at least 1 and our perturbed vector is in @xmath416 .",
    "its new objective equals @xmath467 .",
    "since @xmath125 maximized the objective ( which is always negative ) , we must have @xmath468 .",
    "rearranging , this implies that @xmath469 . sending @xmath470",
    ", we see that @xmath471 .",
    "the opposite inequality follows from considering the replacement of @xmath289 by @xmath472 , and then multiplying @xmath443 s by @xmath473 .",
    "this establishes part ( i ) .    for part ( ii ) , let @xmath474 . since the support of @xmath125 is a partition of @xmath97 $ ] , @xmath475 . by part ( i )",
    ", this equals @xmath476 , which is determined by the cardinality of @xmath104 .",
    "therefore , @xmath477 , which implies ( ii ) .",
    "@xmath246      in its original form , optimization problem 2 involves exponentially many variables , but lemma [ lem : sparse : support = partition ] dramatically reduces their number by allowing us to consider only supports that are partitions of @xmath97 $ ] .",
    "therefore , we need to make one computation per partition of @xmath97 $ ] , which can actually be done _ symbolically _ ( hence exactly ) by _ mathematica_. the running time of _ mathematica _ s symbolic maximization is double - exponential in the number of variables , so it was particularly helpful to reduce the number of variables .",
    "the entire computation for @xmath479 took less than an hour , and the complete _ mathematica _ program and output appear in appendix [ sec : mathematica ] .",
    "let us illustrate this process by showing what needs to be done for the partition @xmath480 .",
    "this corresponds to maximizing @xmath481 subject to the constraints @xmath482 and @xmath131 . by lemma [ lem :",
    "sparse : ij](ii ) , we may assume @xmath459 , so it suffices to maximize @xmath483 subject to @xmath484 and @xmath485 .",
    "this is achieved by _ mathematica _",
    "s ` maximize ` function :    .... maximize[{2 x log[2/7 ] + y log[3/7 ] , x^2 + 2 x y > = 1 & & x > = 0 & & y > = 0 } , { x , y } ] ....    _ mathematica _ answers that the maximum value is @xmath486 , which is indeed less than the claimed value @xmath487 .",
    "we performed one such computation per partition of each @xmath488 . in every case except for the partition @xmath489 , the maximum indeed fell short of the claimed value .",
    "that final partition is completely solved analytically ( i.e. , including the uniqueness result ) by lemma [ lem : sparse:2sets=>done ] in the next section .",
    "this completes the analysis for all @xmath490 .",
    "we begin by ruling out several extreme partitions that our general argument below will not handle .",
    "as one may expect , each of these special cases has a fairly pedestrian proof , so we postpone the proofs of the following two lemmas to the appendix .    [",
    "lem : sparse:2sets=>done ] fix any integer @xmath44 , and let @xmath125 be a vector which solves @xmath419 . if the support of @xmath125 is a partition of @xmath97 $ ] into exactly two sets , then ( up to permutation of the ground set @xmath97 $ ] ) @xmath125 must be equal to the claimed unique optimal vector @xmath422 in proposition [ prop : solve - opt-2 ] .",
    "[ lem : sparse : extreme ] fix any integer @xmath6 , and let @xmath125 be a vector which solves @xmath419 , whose support is a partition of @xmath97 $ ] . then that partition can not have any of the following forms :    ( i ) : :    all singletons ; ( ii ) : :    all singletons , except for one 2-set ; ( iii ) : :    have a @xmath492-set as one of the parts .",
    "the heart of the solution to the optimization problem is the following general case , which we will prove momentarily .",
    "[ lem : sparse:<q-2=>done ] fix any integer @xmath493 , and let @xmath125 be a vector which solves @xmath419 , whose support is a partition of @xmath97 $ ] . then that partition must have a set of size at least @xmath494 .",
    "these collected results show that @xmath419 has the unique solution that we claimed at the beginning of this section .",
    "* proof of proposition [ prop : solve - opt-2 ] for @xmath491 .",
    "* let @xmath125 be a vector which solves @xmath419 .",
    "by lemma [ lem : sparse : support = partition ] , we may assume that its support is a partition of @xmath97 $ ] .",
    "it can not be a single set ( of cardinality @xmath1 ) , because then @xmath495 , and by lemmas",
    "[ lem : sparse : extreme](iii ) and [ lem : sparse:<q-2=>done ] , the support can not contain a set of size @xmath496 .",
    "thus , the support must contain a set of size @xmath376 , and since it is a partition , the only other set is a singleton . then lemma [ lem : sparse:2sets=>done ]",
    "gives us that @xmath125 equals the claimed unique optimal vector @xmath422 , up to a permutation of the ground set @xmath97 $ ] .",
    "this completes the proof .",
    "@xmath246    in the remainder of this section , we prove the general case ( lemma [ lem : sparse:<q-2=>done ] ) .",
    "the following definition and fact are convenient , but the proof is a routine calculus exercise , so we postpone it to the appendix .",
    "[ lem : sparse : fq ] define the function @xmath497 .",
    "( i ) : :    for @xmath498 , @xmath499 strictly increases on    @xmath500 and strictly decreases on @xmath501 . (",
    "ii ) : :    for @xmath493 , we have the inequality    @xmath502 .",
    "* proof of lemma [ lem : sparse:<q-2=>done ] . *",
    "assume for the sake of contradiction that all sets in the support of the optimal @xmath125 have size at most @xmath503 . in terms of the expressions @xmath504 and @xmath505 from definition [ def :",
    "sparse : ij ] , we have the following equality , where the sums should be interpreted as only over sets in the support of @xmath125 : @xmath506 ( the second equality is lemma [ lem : sparse : ij](i ) , and the other three equalities come from the definitions of @xmath504 and @xmath505 . ) note that the above logarithms are always negative .",
    "it is cleaner to work with positive quantities , so we rewrite the above equality in the equivalent form : @xmath507 since every @xmath105 in the above sum is disjoint from @xmath104 and we assumed all sets in the support have size at most @xmath503 , we have that every @xmath105 above has size @xmath508 .",
    "this gives the upper bound : @xmath509 since @xmath510 , the left hand side is at least @xmath511 .",
    "also , @xmath499 is symmetric about @xmath512 and we assumed that @xmath513 and @xmath514 , so lemma [ lem : sparse : fq](i ) implies that this is in turn @xmath515 .",
    "lemma [ lem : sparse : fq](ii ) bounds this in terms of @xmath516 , which ultimately gives us the following bound for @xmath517 : @xmath518 here , @xmath422 is the claimed optimal vector in proposition [ prop : solve - opt-2 ] , and we recognize @xmath519 .",
    "the first inequality follows from the maximality of @xmath125 , and its direction is reversed because @xmath435 is always negative .",
    "let @xmath374 be the number of sets in the support of @xmath125 .",
    "summing over all sets @xmath104 in the support : @xmath520 yet @xmath521 by definition , so this implies @xmath522 , which forces @xmath523 .",
    "then , the support must be all singletons , except possibly for a single 2-set .",
    "this contradicts lemma [ lem : sparse : extreme ] , and completes our proof .",
    "@xmath246      in this section ,",
    "we provide the complete analytic solution to optimization problem 1 , for the entire range of the edge density parameter @xmath123 when the number of colors @xmath1 is exactly 3 . to simplify notation ,",
    "we will write @xmath524 instead of @xmath525 , etc .    [ prop : solve - opt ] define the constant @xmath526 .",
    "then , the * unique * solution ( up to a permutation of the index set @xmath527 ) of optimization problem 1 with edge density parameter @xmath123 is the vector @xmath125 defined as follows . ( all unspecified @xmath289 below are zero . )",
    "( i ) : :    if @xmath528 , then    @xmath529 , @xmath530 , and    @xmath531 .",
    "this gives    @xmath532 .",
    "( ii ) : :    if @xmath533 , then    @xmath534 and    @xmath535 , which gives    @xmath536 .",
    "( iii ) : :    if @xmath537 , then    @xmath538 ,    @xmath539 , and @xmath540 , which gives    @xmath541 .",
    "this covers the entire range of admissible @xmath123 , because @xmath542 corresponds to the density of the turn graph @xmath543 , which is the densest 3-colorable graph .",
    "the strategy of the solution is as follows .",
    "suppose we have some @xmath125 that solves @xmath135 .",
    "since we may permute the index set , we may assume without loss of generality that @xmath544 .",
    "we then use perturbation arguments to pinpoint the location of @xmath125 .",
    "although the problem initially looks cumbersome ( there are 7 nontrivially - related variables ) , the solution cleanly follows from 6 short steps .",
    ": :    by _ _ shifting mass _ _ while conserving their sum    @xmath545 .",
    "] between the    @xmath289 with @xmath546 , we deduce that    @xmath547 and @xmath548 are both zero .",
    ": :    by smoothing together @xmath549 and    @xmath550 , we deduce that    @xmath551 .",
    ": :    by shifting mass between the variables @xmath289 with    @xmath451 , we reduce to one of the following two    situations . either @xmath552 , or    @xmath553 .",
    ": :    we solve the first case resulting from step 3 , which is vastly simpler    than the original problem .",
    "we find that the solution corresponds to    outcomes ( i ) and ( ii ) of proposition [ prop : solve - opt ] .",
    ": :    it remains to consider the second case resulting from step 3 . by    taking mass away from both @xmath554 and    @xmath549 , and giving it to @xmath524",
    ", we    conclude that @xmath555 .",
    ": :    we are left with the situation where the only nonzero variables are    @xmath549 , @xmath550 ,    @xmath556 , and @xmath524 , and they are    related by the equation @xmath557 .",
    "again , this is vastly simpler than the original    problem , and we find that its solution corresponds to outcome ( iii ) of    proposition [ prop : solve - opt ] .",
    "we begin by recording a simple result that we will use repeatedly in the solution .",
    "[ lem : shift - equal - index ] let @xmath125 be a vector that solves @xmath135 .",
    "then @xmath364 . furthermore ,",
    "if @xmath453 is obtained from @xmath125 by shifting mass from some @xmath289 to another @xmath442 with @xmath558 , then @xmath559 .    * proof . *",
    "suppose for contradiction that @xmath560 . the slack in the edge constraint",
    "lets us shift some more mass to @xmath554 while keeping @xmath561 .",
    "but in the definition of @xmath337 , the coefficient ( @xmath562 ) of @xmath554 is the largest , so this shift strictly increases @xmath337 , contradicting maximality of @xmath125 .    for the second claim ,",
    "observe that @xmath337 is invariant under the shift since @xmath558 .",
    "now suppose for contradiction that @xmath563 .",
    "then , as above , we could shift more mass to @xmath554 , which would strictly increase @xmath337 , again contradicting the maximality of @xmath125 .",
    "@xmath246    * step 1 . * consider shifting mass among @xmath564 . if we hold all other @xmath289 constant , then @xmath565 , which is linear in the three variables of interest .",
    "let us postpone the uniqueness claim for a moment .",
    "since we ordered @xmath566 , shifting all of the mass from @xmath567 to @xmath524 will either strictly grow @xmath128 if @xmath568 , or keep @xmath128 unchanged .",
    "also , @xmath134 will be invariant .",
    "therefore , if we are only looking for an upper bound for @xmath135 , we may perform this shift , and reduce to the case when @xmath569 without loss of generality .",
    "we return to the topic of uniqueness .",
    "the next five steps of this solution will deduce that , conditioned on @xmath569 , the unique optimal @xmath125 always has either @xmath570 or @xmath571 .",
    "we claim that this implies that our initial shift of mass to @xmath524 _ never happened_. indeed , in the case with @xmath568 , the previous paragraph shows that an initial shift would have strictly increased @xmath128 , violating lemma [ lem : shift - equal - index ] . and",
    "in the case with @xmath572 , there was not even any mass at all to shift .",
    "therefore , this will imply the full uniqueness result .",
    "* step 2 . * consider shifting mass between @xmath549 and @xmath550 until they become equal .",
    "if we hold all other @xmath289 constant , then @xmath573 .",
    "this `` smoothing '' operation strictly increases the first term , while keeping the other terms invariant .",
    "but lemma [ lem : shift - equal - index ] prohibits @xmath128 from increasing , so we conclude that we must have had @xmath551 .    * step 3 . *",
    "consider shifting mass among @xmath574 .",
    "that is , fix @xmath575 , and vary @xmath576 in the range @xmath577 . by step 2 , @xmath578 . step 1 gave @xmath579 , so we have : @xmath580 by lemma [ lem : shift - equal - index ] , @xmath581 must maximize this downward - opening parabola in the range @xmath577 . recall that quadratics @xmath582 reach their extreme value at @xmath583 , which corresponds to @xmath584 above .",
    "thus , if @xmath585 , then we must have @xmath586 .",
    "step 2 gave us @xmath551 , which forces @xmath587 .",
    "this is the second claimed outcome of this step .    on the other hand , if @xmath588 , then the quadratic is strictly increasing on the interval @xmath577 .",
    "therefore , we must have @xmath589 , forcing @xmath590 .",
    "this is the first claimed outcome of this step .",
    "* step 4 . * in this case , only @xmath556 , @xmath524 , and @xmath554 are nonzero .",
    "then the edge constraint is simply @xmath591 ( lemma [ lem : shift - equal - index ] forces equality ) .",
    "note that since @xmath592 , their product @xmath593 is always at most @xmath594 , * so we can only be in this case when * @xmath595 .",
    "now let @xmath596 and @xmath597 .",
    "the vertex constraint forces @xmath598 , so we are left with the routine problem of maximizing @xmath599 subject to the constraints @xmath600 these constraints specify a segment of a hyperbola ( a convex function ) in the first quadrant of the @xmath601-plane , and the objective is linear in @xmath16 and @xmath17 . therefore , by convexity , the maximum would be at the global maximum of @xmath337 on the entire first quadrant branch of the hyperbola , unless that fell outside the segment , in which case it must be at an endpoint , forcing @xmath602 .",
    "the maximum over the entire branch of @xmath603 follows easily from the inequality of arithmetic and geometric means : @xmath604 , with equality when @xmath605 . using @xmath603 to solve for @xmath16 and @xmath17 , we see that the unique global maximum is at @xmath606 and @xmath607 .",
    "this lies on our segment ( satisfies @xmath608 ) precisely when @xmath123 is below the constant @xmath609 in proposition [ prop : solve - opt ] , and these values of @xmath610 and @xmath611 indeed match those claimed in that regime .    on the other hand , when @xmath612 , we are outside the segment , so by the above we must have @xmath613 , and we may substitute @xmath614 .",
    "we are left with the single - variable maximization of @xmath615 subject to @xmath616 and @xmath617 . by the quadratic formula , this is at @xmath618 , which produces @xmath619 .",
    "this indeed matches outcome ( ii ) of our proposition .",
    "* step 5 . *",
    "the remaining case is @xmath620 , and we will show that this forces @xmath555 . indeed , suppose for the sake of contradiction that @xmath621 . shift mass to @xmath524 by taking @xmath107 from @xmath554 and @xmath622 from @xmath549 . since many @xmath289 are zero , @xmath623 .",
    "our perturbation decreases the first term by @xmath624 , increases the third term by @xmath625 , and does not change the second term , so our choice of @xmath626 keeps @xmath128 invariant .    on the other hand",
    ", @xmath337 increases by @xmath627 . since we know @xmath628 ,",
    "in particular we always have @xmath629 , which implies that @xmath630 because we assume @xmath631 .",
    "hence the increase in @xmath337 is @xmath632 , contradicting the maximality of @xmath125 .",
    "therefore , we must have had @xmath555",
    ".    * step 6 .",
    "* now only @xmath549 , @xmath550 , @xmath556 , and @xmath524 remain .",
    "let @xmath576 and @xmath633 .",
    "step 3 gives @xmath634 .",
    "we use the vertex constraint to eliminate @xmath374 : @xmath635 , so @xmath636 . substituting this for @xmath374 , we are left with @xmath637 and @xmath638 .",
    "since we need all @xmath639 , the range for @xmath33 is @xmath640 .",
    "the above expressions give @xmath641 , and lemma [ lem : shift - equal - index ] forces @xmath364 .",
    "the quadratic formula gives the roots @xmath642 .",
    "these are only real when @xmath643 , so * this case only occurs when * @xmath644 .",
    "furthermore , the only root within the interval @xmath640 is @xmath645 . plugging this value of @xmath33 into the expressions for the @xmath289",
    ", we indeed obtain outcome ( iii ) of proposition [ prop : solve - opt ] .    * conclusion . *",
    "the only steps which proposed possible maxima were steps 4 and 6 .",
    "conveniently , step 4 also required that @xmath646 , while step 6 required @xmath647 ( both deductions are bolded above ) , so we do not need to compare them except at @xmath648 , which is trivial .",
    "finally , note that all extremal outcomes indeed have @xmath568 , except at @xmath649 , in which case @xmath650 .",
    "this justifies the uniqueness argument that we used at the end of step 1 , and completes our proof of proposition [ prop : solve - opt ] .",
    "in this section , we determine the precise structure of the sparse graphs that maximize the number of colorings , completing the proof of theorem [ thm : main : sparse ] .",
    "proposition [ prop : asymp - sparse](ii ) showed that in this regime , the optimal graphs were close , in edit distance , to complete bipartite graphs .",
    "as a warm - up for the arguments that will follow in this section , let us begin by showing that the semi - complete subgraphs of definition [ def : semi - complete ] are optimal among bipartite graphs .",
    "we will use this in the final stage of our proof of the exact result .",
    "[ lem : semi - complete ] let @xmath44 and @xmath651 be positive integers . among all subgraphs of @xmath51 with @xmath33 missing edges ,",
    "the ones which maximize the number of @xmath1-colorings are precisely :    ( i ) : :    both the correctly and incorrectly oriented semi - complete subgraphs ,    when @xmath9 , and ( ii ) : :    the correctly oriented semi - complete subgraph , when @xmath652 and    @xmath653 and    @xmath49 is sufficiently large ( i.e. , @xmath654 ,    where @xmath655 depends only on @xmath1 ) .",
    "* the above result is not as clean when more than 3 colors are used , but is sufficient for our purposes . in the sparse case ,",
    "we encounter only highly unbalanced bipartite graphs , all of which have part size ratio approximately @xmath656 . apparently out of sheer coincidence ( and good fortune ) , this is just barely enough to satisfy the additional condition of the lemma .",
    "nevertheless , it would be nice to remove that condition .",
    "* proof of lemma [ lem : semi - complete](ii ) .",
    "* let @xmath657 be the vertex partition of @xmath51 , with @xmath658 and @xmath659 .",
    "let @xmath660 be the correctly oriented semi - complete subgraph of @xmath51 with exactly @xmath33 missing edges .",
    "let @xmath661 be another non - isomorphic subgraph of @xmath51 with the same number of edges .",
    "we will show that @xmath661 has fewer colorings . since @xmath661 and @xmath660 are both bipartite , they share every coloring that uses disjoint sets of colors on the sides of the bipartition .",
    "discrepancies arise when the same color appears on both sides .",
    "note , however , that whenever this occurs , every edge between same - colored vertices must be missing from the graph .",
    "this set of forced missing edges , , not the entire @xmath662 . ] which we call the coloring s _ footprint _ , is always a union of vertex - disjoint complete bipartite graphs , one per color that appears on both sides . for each subset @xmath82 of the missing edges of @xmath661 ,",
    "let @xmath663 be the number of colorings of @xmath661 with footprint @xmath82 .",
    "then , @xmath664 is exactly the number of colorings of @xmath661 . to give each @xmath663 a counterpart from @xmath660 , fix an arbitrary bijection @xmath195 between the missing edges of @xmath661 and @xmath660 , and let @xmath665 be the number of colorings of @xmath660 with footprint @xmath666 .",
    "since @xmath660 has @xmath667 colorings , it suffices to show that @xmath668 for all @xmath82 , with strict inequality for at least one @xmath82 .    clearly , when @xmath82 is empty , or a star centered in @xmath105 , then @xmath669 .",
    "we observed that all footprints are unions @xmath670 of vertex - disjoint complete bipartite graphs , so all @xmath82 not of that form automatically have @xmath671 .",
    "it remains to consider @xmath82 that have this form , but are not stars centered in @xmath105 .",
    "colorings with this footprint are monochromatic on each @xmath672 , and there are @xmath673 ways to choose a distinct color for each @xmath672 .",
    "the remaining @xmath674 colors are partitioned into two sets , one for @xmath675 and one for @xmath676 .",
    "crucially , @xmath677 because @xmath82 is not a star centered in @xmath105 .",
    "thus , @xmath678 \\cdot     \\sum_{i=1}^{q - k-1 } { q - k \\choose i } i^{|a \\setminus v(h)| }    ( q - k - i)^{|b \\setminus v(h)| }   \\\\    & \\leq &    q^k \\cdot \\sum_{i=1}^{q - k-1 } { q - k \\choose i } i^a ( q - k - i)^{b-2}.\\end{aligned}\\ ] ] to see that the sum is dominated by the @xmath679 term , note that since we assumed that @xmath653 , for sufficiently large @xmath49 we have @xmath680 so we may apply inequality [ ineq : partition - colors](ii ) from the appendix .",
    "this gives @xmath681 .",
    "next , we claim that this bound is greatest when @xmath84 is smallest .",
    "indeed , when @xmath84 increases by one , @xmath682 increases by the factor @xmath1 , but @xmath683 decreases by a factor of at least @xmath684 for large @xmath685 .",
    "hence we have @xmath686 .    on the other hand",
    ", @xmath666 is always a star centered in @xmath105 , so we can easily construct @xmath687 colorings of @xmath660 .",
    "indeed , choose one color for the vertices of the graph @xmath666 , a different color for the remainder of @xmath688 , and allow each vertex left in @xmath689 to take any of the other @xmath494 colors . since @xmath666 intersects @xmath105 in exactly one vertex , @xmath690 , as claimed .",
    "but @xmath691 , so we have the desired strict inequality @xmath692 for all remaining @xmath82 . @xmath246    part ( i ) is a consequence of the following more precise result , which we will also need later .",
    "[ lem : subgraph - bipartite : q=3 ] let @xmath661 be a subgraph of the complete bipartite graph @xmath51 with vertex partition @xmath657 , and @xmath693 missing edges .",
    "suppose @xmath661 has @xmath694 and @xmath695 with @xmath16 complete to @xmath105 and @xmath17 complete to @xmath104 .",
    "then its number of 3-colorings is precisely @xmath696 , where @xmath697 is the number of nonempty subsets of missing edges which form complete bipartite graphs .",
    "this is at most @xmath698 , with equality exactly when the missing edges form a star",
    ".    * proof . * as in the proof of lemma [ lem : semi - complete](ii ) ,",
    "let @xmath663 be the number of 3-colorings of @xmath661 with footprint @xmath82 .",
    "the key observation is that for every nonempty @xmath82 , @xmath699 when @xmath82 is a complete bipartite graph , and @xmath700 otherwise . indeed ,",
    "if @xmath82 is not a complete bipartite graph , then it can not be a footprint of a 3-coloring , so @xmath700 .",
    "otherwise , there are 3 ways to choose a color for the vertices of @xmath82 , and then by definition of footprint , the remaining two colors must be split between @xmath701 and @xmath702 . both of these sets are nonempty , because @xmath701 must contain the given vertex @xmath16 and @xmath702 must contain @xmath17 , so the only way to split the two colors is to use one on all of @xmath701 and the other on all of @xmath702 .",
    "there are 2 ways to decide how to do this .",
    "so , @xmath703 , as claimed , and this produces the @xmath704 in the formula .",
    "the rest of the formula follows from @xmath705 .",
    "indeed , the terms correspond to the colorings that use a single color ( for which there are three choices ) on @xmath105 and allow the other two on @xmath104 , those that use one on @xmath104 and allow the others on @xmath105 , and those that use only one on each of @xmath104 and @xmath105 ( hence were double - counted ) .",
    "the final claim in the statement comes from the fact that stars are the only @xmath33-edge graphs which have all @xmath706 of their nonempty subgraphs complete bipartite . @xmath246",
    "* proof of lemma [ lem : semi - complete](i ) .",
    "* since the number of missing edges @xmath33 is less than both @xmath707 and @xmath708 , the vertices @xmath16 and @xmath17 of lemma [ lem : subgraph - bipartite : q=3 ] must exist .",
    "therefore , its equality condition implies that the optimal subgraphs are indeed semi - complete .",
    "we will use several small constants with relative order of magnitude @xmath709 , related by @xmath710 .",
    "we do not send them to zero ; rather , we show that there is an eventual choice of the @xmath711 , determined by @xmath1 and @xmath210 , that makes our argument work .",
    "so , to avoid confusion , the @xmath712 , @xmath713 , and @xmath714 notation that we employ in this proof will only mask constants depending on @xmath715 alone .",
    "for example , we will write @xmath716 when there is a constant @xmath717 such that @xmath718 for sufficiently large @xmath5 and @xmath4 .",
    "occasionally , we will use phrases like `` almost all colorings have property @xmath719 '' when @xmath720-fraction of all colorings have that property .",
    "* proof of theorem [ thm : main : sparse ] .",
    "* let @xmath721 be an optimal graph with @xmath4 vertices and @xmath57 edges .",
    "we begin with a convenient technical modification : if @xmath2 has an isolated edge @xmath601 , replace it with an edge between @xmath16 and another non - isolated vertex of minimal degree .",
    "do this only once , even if @xmath2 had multiple isolated edges .",
    "the number of colorings stays the same because both graphs share the same partial colorings of @xmath722 , and each of those has exactly @xmath376 extensions ( in each graph ) to the degree-1 vertex @xmath16 .",
    "this adjustment will not compromise the uniqueness claim , because it can not create one of the optimal graphs listed in theorem [ thm : main : sparse ] .",
    "indeed , if it did , then the degree-1 vertex @xmath16 would now have to be the center of the missing star of the semi - complete subgraph @xmath723 .",
    "but we made @xmath16 adjacent to a vertex of minimal degree , so @xmath16 must be on the smaller side of @xmath82 s bipartition .",
    "then the number of @xmath51-edges missing from the semi - complete @xmath82 is precisely @xmath724 .",
    "this exceeds @xmath49 for all optimal graphs listed in theorem [ thm : main : sparse ] , but our definition of semi - completeness required that the number of missing edges was strictly less than the size of the smaller part .",
    "this contradiction shows that we may assume without loss of generality that if @xmath2 has an isolated edge @xmath725 , then it also contains a degree-1 vertex @xmath726 .",
    "define @xmath727 and @xmath728 , and note that @xmath729 and @xmath730 .",
    "so , proposition [ prop : asymp - sparse](ii ) gives disjoint subsets @xmath731 of size @xmath732 , such that by editing at most @xmath733 edges , we can transform @xmath2 into the complete bipartite graph between @xmath734 and @xmath735 , with all other vertices isolated .",
    "call that graph @xmath736 .",
    "let @xmath737 be a max - cut partition of the * non - isolated * vertices of @xmath2 , such that @xmath175 contains at least as many vertices of @xmath734 as @xmath228 does .",
    "we would like to show that this partition is very close to @xmath738 , so we keep track of the @xmath268 by defining @xmath739 and @xmath740 for each @xmath741 . to help us recognize vertices that are `` mostly correct , '' let @xmath742 be the vertices that are adjacent to all but at most @xmath743 vertices of @xmath744 .",
    "the following series of claims will complete the proof of theorem [ thm : main : sparse ] , since proposition [ prop : asymp - sparse](i ) already determined the asymptotic maximum number of colorings .",
    ": :    for each @xmath745 , @xmath746 is within    @xmath747 of @xmath748 , @xmath749 is within    @xmath750 of @xmath748 , and    @xmath751 .",
    ": :    almost all colorings of @xmath2 are _",
    "@xmath752-regular _ , which means that they only use one color on    @xmath753 , and avoid that color on @xmath754 .",
    "claim 3 . : :    at most one non - isolated vertex @xmath755 has degree    @xmath756 .",
    "we use this to show that each    @xmath757 is within @xmath750 of    @xmath748 .",
    "let @xmath758 if it exists ;    otherwise , let @xmath759 .",
    "let    @xmath760 .",
    ": :    almost all colorings are _ @xmath761-regular _ , i.e. ,    use one color for @xmath762 , and avoid it on    @xmath763 .",
    "claim 5 . : :    each @xmath764 is an independent set , and @xmath755    ( if it exists ) has neighbors in only one of the @xmath764 .    hence @xmath2 is a bipartite graph plus isolated vertices .",
    "claim 6 . : :    @xmath2 is a semi - complete subgraph of    @xmath765 plus isolated vertices , correctly    oriented if @xmath6 .",
    "* proof of claim 1 .",
    "* we know that by editing at most @xmath733 edges , @xmath2 can be transformed into @xmath736 , the complete bipartite graph between @xmath738 , plus isolated vertices .",
    "since @xmath766 , all vertices in the @xmath268 have degree @xmath395 in @xmath736 .",
    "so , the number of @xmath268-vertices that are isolated in @xmath2 is at most @xmath767 , implying in particular that the number of @xmath734-vertices in @xmath768 is at least @xmath769 .",
    "( recall that @xmath737 is a max - cut partition of the _ non - isolated _ vertices of @xmath2 . )",
    "since more @xmath734-vertices are in @xmath175 than in @xmath228 , and @xmath770 , we have @xmath771 .    also , @xmath736 has at least @xmath5 edges crossing between @xmath738 , so @xmath2 has at least @xmath772 edges crossing between @xmath738 , and at least that many between its max - cut @xmath737 .",
    "as @xmath2 has only @xmath5 edges , this shows that each @xmath240 $ ] spans at most @xmath733 edges .",
    "but the sets @xmath773 are complete to each other in @xmath736 , so among the @xmath774 edges of @xmath775 $ ] , at least @xmath776 of them must go between @xmath777 and @xmath778 . combining this with the above result that @xmath779",
    ", we obtain the desired bound @xmath780 .",
    "then @xmath781 , the set of @xmath735-vertices in @xmath228 , has size at least @xmath782 , because only @xmath783 of the @xmath735-vertices are isolated and @xmath780 of them are in @xmath175 . repeating the previous paragraph s argument with respect to @xmath781 and @xmath784",
    ", we find that @xmath785 , which then implies that @xmath786 .",
    "it remains to control @xmath787 , which we recall to be the vertices of @xmath788 which had at most @xmath743 non - neighbors in @xmath744 .",
    "the @xmath788 are complete to each other in @xmath736 , so each vertex not in @xmath787 contributes at least @xmath743 to the total edit distance of @xmath774 .",
    "we set @xmath789 , so this implies that all but at most @xmath790 vertices of @xmath788 belong to @xmath787 .",
    "since @xmath746 is within @xmath783 of @xmath748 , this gives the desired result .",
    "* proof of claim 2 .",
    "* we bound the number of colorings that are not @xmath791-regular . for each partition @xmath97 = c_0 \\cup c_1 \\cup c_2 \\cup c_3 $ ] , we count the colorings which use the colors @xmath792 in @xmath753 but not @xmath754 , use @xmath793 in @xmath754 but not @xmath753 , use @xmath794 in both @xmath753 and @xmath754 , and do not use @xmath795 in either @xmath753 or @xmath754",
    ". then we sum over all _ irregular _ partitions , which are all partitions with @xmath796 or @xmath797 .",
    "it suffices to show that the result is of smaller order than the total number of colorings of @xmath2 .    for",
    "any given partition with @xmath798 , we claim that the corresponding number of colorings is at most @xmath799 .",
    "the first factor comes from choosing @xmath800 pairs of vertices @xmath801 , @xmath802 on which to use each color of @xmath794 .",
    "then , every vertex in the common neighborhood of @xmath803 must avoid @xmath794 in order to produce a proper coloring . by definition of @xmath754 ,",
    "the number of vertices of @xmath777 that are not in this common neighborhood is at most @xmath804 . thus all but at most @xmath805 vertices of @xmath806 are adjacent to every @xmath803 , and therefore restricted to colors in @xmath792 .",
    "this produces the second factor in our bound , and the third factor is obtained analogously .",
    "of course every vertex has at most @xmath1 color choices , and we use that trivial bound for all remaining vertices , producing our final factor . using that each @xmath749 is within @xmath750 of @xmath807 , we find that the sum @xmath808 of this bound over all @xmath809 irregular partitions is : @xmath810 for any irregular partition with @xmath811 , it is clear that @xmath812 increases when @xmath792 is replaced by @xmath813 , and @xmath795 and @xmath794 are reduced to @xmath814 .",
    "it is also clear that this procedure gives another irregular partition , but this time with @xmath815 . yet",
    "@xmath816 , so we may apply inequality [ ineq : partition - colors](i ) , which gives @xmath817 thus for small @xmath818 , we have @xmath819 .    on the other hand , proposition [ prop : asymp - sparse](i )",
    "shows that the optimal graph has at least @xmath820 colorings , where @xmath821 . since @xmath727 and @xmath822",
    ", routine algebra shows that @xmath823 is precisely @xmath824 .",
    "therefore , for small @xmath825 we have @xmath826 , i.e. , almost all colorings of @xmath2 are @xmath791-regular .",
    "@xmath246    before proving the next claim , it is convenient to establish the following lemma , which should be understood in the context of claim 3 .",
    "[ lem : exact : sparse : sum - degrees ] let @xmath827 be a pair of non - isolated vertices of @xmath2 , such that @xmath601 is not an isolated edge .",
    "then @xmath828 .    *",
    "proof . * suppose for contradiction that there is such a pair @xmath827 with @xmath829 .",
    "let @xmath179 be the graph obtained by deleting the @xmath830 edges incident to @xmath16 or @xmath17 , and adding back as many edges between @xmath16 and @xmath831 . in @xmath179 , any @xmath832-regular partial coloring , which uses only one color on @xmath833 , and",
    "avoids that color on @xmath834 .",
    "] of @xmath835 has exactly @xmath376 extensions to @xmath16 since only one color appears on @xmath836 , and then exactly @xmath1 further extensions to the newly - isolated vertex @xmath17 . on the other hand ,",
    "since @xmath16 and @xmath17 both have degree at least 1 and do not form an isolated edge , one of them , say @xmath16 , has a neighbor in the rest of the graph .",
    "therefore , in @xmath2 the same partial coloring has at most @xmath376 extensions to the vertex @xmath16 , and then at most @xmath376 further extensions to the non - isolated vertex @xmath17 .",
    "yet by claim 2 , almost all colorings of @xmath2 arise in this way , so for sufficiently large @xmath5 , @xmath2 has fewer colorings than @xmath179 , contradiction . @xmath246    * proof of claim 3 . *",
    "recall that our initial technical adjustment allows us to assume that if @xmath2 contains an isolated edge @xmath725 , then it also contains a degree-1 vertex @xmath837 .",
    "this would give @xmath838 , contradicting lemma [ lem : exact : sparse : sum - degrees ] because @xmath839 can not be an isolated edge .",
    "hence @xmath2 in fact has no isolated edges .",
    "but then the same lemma implies that at most one vertex @xmath755 has degree @xmath840 , since @xmath841 by claim 1 .",
    "it remains to show that each @xmath757 is within @xmath842 of @xmath748 .",
    "recall that @xmath777 and @xmath778 are the the @xmath734- and @xmath735-vertices that are in @xmath175 .",
    "all other vertices of @xmath175 are isolated in the graph @xmath736 which is within edit - distance @xmath733 of @xmath2 .",
    "so by the previous paragraph , each of them ( except @xmath755 if it exists ) has degree at least @xmath843 , and thus contributes at least @xmath844 to the edit distance between @xmath2 and @xmath736 .",
    "therefore , there are at most @xmath845 of them , where we used @xmath846 .",
    "claim 1 controls @xmath746 and @xmath847 , so we indeed find that @xmath848 is within @xmath750 of @xmath849 .",
    "the analogous result for @xmath228 follows by a similar argument .",
    "@xmath246    * proof of claim 4 . * since almost all colorings are @xmath791-regular , it suffices to prove this claim only for those colorings .",
    "so , we bound the @xmath791-regular colorings that * ( i ) * use a common color on both @xmath763 and @xmath762 , or * ( ii ) * use at most @xmath494 colors on @xmath763 .",
    "note that every @xmath791-regular coloring which avoids both ( i ) and ( ii ) must use exactly @xmath376 colors on @xmath763 and only the remaining color on @xmath762 , and so is automatically @xmath761-regular .",
    "it therefore suffices to show that these two types of colorings constitute @xmath54-fraction of all colorings .",
    "the key observation is that every @xmath850 has a neighbor in @xmath753 .",
    "indeed , @xmath737 is a max - cut , so at least half of the @xmath851 neighbors of @xmath50 must be in @xmath175 .",
    "these can not all avoid @xmath753 , because claims 1 and 3 show that only @xmath750 vertices of @xmath175 are outside @xmath753 , and @xmath852 .    to bound the number of colorings of type ( i ) above , first choose a color @xmath322 for all @xmath753 . by the key observation",
    ", @xmath322 can not appear on @xmath763 , so the shared color @xmath323 must be different .",
    "hence we have @xmath376 choices for @xmath323 , and must pick a pair of vertices @xmath853 and @xmath854 to use it on . the @xmath855 neighbors of @xmath16 in @xmath763 must avoid @xmath323 as well as @xmath322 , so they each have at most @xmath494 color choices .",
    "every other vertex of @xmath763 must still avoid @xmath322 , so we use the bound of @xmath856 color choices there . using the trivial bound @xmath857 for all other vertices , and the fact that @xmath749 and @xmath858 are within @xmath750 of @xmath807 , we find that the number of type-(i ) colorings is at most : @xmath859 on the other hand , we showed at the end of the proof of claim 2 that @xmath2 had at least @xmath860 colorings . since @xmath861 , we have @xmath862 , as desired .    the number of type-(ii ) colorings is easily bounded by @xmath863 .",
    "the four factors correspond to choosing a color for @xmath753 , choosing another color to avoid on @xmath763 , coloring @xmath763 , and coloring all remaining vertices . using that @xmath749 and @xmath858 are within @xmath750 of @xmath748",
    ", we obtain @xmath864 , so @xmath865 .",
    "since @xmath866 , for small enough @xmath818 we indeed have @xmath867 , as desired .",
    "* proof of claim 5 .",
    "* almost all colorings are @xmath761-regular , so @xmath868 $ ] spans no edges .",
    "we turn our attention to @xmath763 , and start by showing that all degrees within @xmath869 $ ] are at most @xmath870 . indeed , suppose for contradiction that some @xmath871 has at least @xmath872 neighbors in @xmath763",
    ". then the number of @xmath873-regular colorings is at most @xmath874 . here",
    ", the factors correspond to choosing a color @xmath322 for @xmath875 , choosing a color @xmath323 for @xmath16 , coloring @xmath876 without @xmath322 or @xmath323 , coloring the rest of @xmath763 without @xmath322 , and coloring the remaining vertices . using that each @xmath858 is within @xmath842 of @xmath748",
    ", we find that @xmath877 yet we showed at the end of the proof of claim 2 that @xmath2 had at least @xmath878 colorings , so using @xmath709 , we obtain @xmath879 .",
    "this contradicts the fact that @xmath880 includes almost all colorings .",
    "therefore , all degrees within @xmath869 $ ] are indeed at most @xmath870 .",
    "we now use this intermediate bound to show that all such degrees are in fact zero .",
    "suppose for contradiction that some @xmath871 has neighbors within @xmath763 .",
    "let @xmath179 be the graph obtained by deleting all edges between @xmath16 and @xmath763 and all edges incident to @xmath755 ( if it exists ) , and adding back as many edges between @xmath762 and some formerly isolated vertex @xmath881 .",
    "is within @xmath750 of @xmath748 , so the number of non - isolated vertices is @xmath882 .",
    "this is strictly below @xmath4 for small @xmath818 , because @xmath883 , and we assumed that @xmath57 with @xmath56 .",
    "] this is possible because @xmath884 and @xmath16 has at most @xmath870 neighbors within @xmath763 , while @xmath885 . observe that any @xmath886-regular partial coloring of @xmath887 has exactly @xmath888 extensions to all of @xmath179 , because @xmath16 and @xmath881 only need to avoid the single color which appears on @xmath762 , and @xmath755 is now isolated , if it exists . on the other hand , we claim that the same partial coloring has at most @xmath889 extensions in @xmath2 .",
    "indeed , there are at most @xmath494 extensions to @xmath16 because @xmath16 must avoid the color of @xmath762 as well as some ( different ) color which appears on its neighbor in @xmath763 . then , there are @xmath1 ways to color the isolated vertex @xmath881 , and finally at most @xmath376 further extensions to the non - isolated vertex @xmath755 if it exists .",
    "yet by claim 2 , almost all colorings of @xmath2 arise in this way , so for sufficiently large @xmath5 , @xmath2 has fewer colorings than @xmath179 .",
    "this is impossible , so @xmath763 must indeed be an independent set .    it remains to show that @xmath755 , if it exists , has neighbors in only one @xmath764 .",
    "suppose for contradiction that @xmath755 is adjacent to both @xmath762 and @xmath763 , and consider the graph @xmath179 obtained by deleting all edges incident to @xmath755 , and replacing them with edges to @xmath762 only .",
    "this is possible because @xmath884 and @xmath885 .",
    "any partial @xmath761-regular coloring of @xmath890 has at most @xmath494 extensions to @xmath755 , because @xmath755 s neighbors in @xmath763 are colored differently from its neighbors in @xmath762 .",
    "yet the same partial coloring has exactly @xmath376 extensions with respect to @xmath179 , since it uses the same color on all of @xmath755 s neighbors ( now in @xmath762 ) .",
    "so , for sufficiently large @xmath5 , @xmath179 has more colorings than @xmath2 , giving the required contradiction .",
    "* proof of claim 6 . * first , consider the case when @xmath891 is empty .",
    "then all non - isolated vertices are already in the bipartite graph @xmath761 .",
    "if that subgraph is less than @xmath875 edges away from being complete bipartite , then lemma [ lem : semi - complete ] already implies is the smaller side of the bipartite graph @xmath761 because claim 3 shows that @xmath875 is within @xmath750 of @xmath892 and @xmath893 is within @xmath750 of @xmath894 . ]",
    "that @xmath895 $ ] is semi - complete ( and correctly oriented if @xmath6 ) , so we are done . on the other hand , if that subgraph has at least @xmath875 missing edges , then we can construct an @xmath4-vertex graph @xmath179 with at least @xmath5 edges by taking @xmath896 and adding enough isolated vertices .",
    "then , @xmath179 has at least @xmath897 colorings because there are @xmath1 choices of a single color for the @xmath875-side , @xmath376 color choices for each vertex on the other side , and @xmath1 choices for each remaining ( isolated ) vertex .",
    "however , the same counting shows that @xmath2 has exactly @xmath898 colorings that are @xmath761-regular , which includes almost all colorings by claim 4 .",
    "hence for sufficiently large @xmath5 , @xmath179 has more colorings , and this contradiction completes the case when @xmath891 is empty .",
    "now suppose the vertex @xmath755 with degree @xmath899 exists . by counting @xmath761-regular colorings",
    ", we find that @xmath2 has at most @xmath900 colorings . here , the factors correspond to choosing a color for @xmath762 , coloring @xmath763 , coloring the non - isolated vertex @xmath755 which must avoid a neighbor s color , and coloring the remaining vertices .",
    "observe that if there were at least @xmath901 edges missing between @xmath762 and @xmath763 , then we could isolate @xmath755 by deleting its edges and adding back as many between @xmath762 and @xmath763 .",
    "the resulting graph would have at least @xmath902 colorings , where the factors correspond to choosing a color for @xmath762 , coloring @xmath763 , and coloring the remaining ( isolated ) vertices .",
    "for sufficiently large @xmath5 , this exceeds the number of colorings of @xmath2 , which is impossible .",
    "therefore , less than @xmath901 edges are missing between @xmath873 .    by claim 5",
    ", @xmath755 has neighbors in only one @xmath764 .",
    "if it is @xmath762 , we must have @xmath903 and @xmath904 because @xmath737 is a max - cut .",
    "the previous paragraph then implies that less than @xmath848 edges are missing between @xmath737 , so lemma [ lem : semi - complete ] shows that @xmath2 is indeed semi - complete on its non - isolated vertices ( and correctly oriented if @xmath6 ) .",
    "the only remaining case is when @xmath755 has neighbors only in @xmath763 , which we will show is impossible .",
    "this time , the max - cut gives @xmath905 and @xmath906 . since @xmath907 , there are at least @xmath908 missing edges between @xmath737 .",
    "so , if we let @xmath909 , we can construct an @xmath4-vertex graph @xmath179 with at least @xmath5 edges by taking @xmath910 and adding enough isolated vertices .",
    "this graph has at least @xmath911 colorings , by the same counting as earlier in this proof .",
    "let us compare this with the number of colorings @xmath912 of @xmath2 , which we calculated above .",
    "since @xmath913 and @xmath914 , we have @xmath915 .    crucially , @xmath63 is always irrational , because any positive integral solution to @xmath916 would require @xmath1 and @xmath376 to have a nontrivial common factor .",
    "so , by choosing our @xmath107 s sufficiently small in advance ( based only on @xmath1 ) , we may ensure that @xmath917 for some small positive constant @xmath918 .",
    "since @xmath919 , this gives @xmath920 , which exceeds 1 for large @xmath5 , leaving @xmath179 with more colorings than @xmath2 .",
    "this contradiction finishes our last case , and our entire proof .",
    "our arguments can be pushed further when only three colors are used . in this section",
    ", we complete the proof of theorem [ thm : main : q=3 ] , determining the precise structure of the graphs that maximize the number of 3-colorings , for edge densities up to @xmath921 ( i.e. , up to the density of the complete bipartite graph ) .",
    "the structure of this proof closely resembles that of the previous section , so parts that are essentially the same are rewritten briefly .",
    "we would , however , like to draw attention to a new piece of notation .",
    "recall that , as defined in the previous section , a coloring is @xmath922-regular if it uses only one color on @xmath923 and the other @xmath376 on @xmath924 .",
    "this time , we will also need a symmetric version of this concept , which we denote with square brackets .",
    "we will say that a coloring is _",
    "@xmath925$]-regular _ if one of @xmath923 or @xmath924 is monochromatic , and the other avoids that color entirely .",
    "note that this is equivalent to having no colors shared between @xmath923 and @xmath924 , because there are only 3 colors altogether .",
    "* proof of theorem [ thm : main : q=3 ] .",
    "* theorem [ thm : main : sparse ] already established our result for densities up to @xmath57 for some constant @xmath210 , so we may assume that @xmath926 .",
    "routine algebra verifies that proposition [ prop : solve - opt ] and theorem [ thm : asymp - number ] establish the claimed numbers of colorings in this theorem .",
    "this leaves us to concentrate on the optimal graph structure .",
    "we use several constants @xmath709 , related by @xmath710 , and show that there is an eventual choice that makes our argument work . to avoid confusion , our @xmath712 , @xmath713 , and @xmath714 notation will only mask absolute constants .",
    "let @xmath173 be an optimal graph whose density @xmath65 is between @xmath210 and @xmath594 .",
    "let @xmath927 and @xmath928 , where the @xmath443 s are determined by proposition [ prop : solve - opt ] with density parameter @xmath929 .",
    "note that since @xmath930 , each @xmath931 .",
    "theorem [ thm : asymp - stability ] gives disjoint subsets @xmath731 with @xmath932 , such that by editing at most @xmath933 edges , we can transform @xmath2 into the complete bipartite graph between @xmath734 and @xmath735 , plus isolated vertices .",
    "call that graph @xmath736 .",
    "let @xmath737 be a max - cut partition of the * non - isolated * vertices of @xmath2 , such that @xmath175 contains at least as many vertices of @xmath734 as @xmath228 does .",
    "define @xmath739 and @xmath934 , and let @xmath742 be the vertices that are adjacent to all but at most @xmath935 vertices of @xmath744 .",
    "the following series of claims will complete the proof of theorem [ thm : main : q=3 ] .",
    ": :    for each @xmath745 , @xmath746 is within    @xmath936 of @xmath748 ,    @xmath749 is within @xmath937 of    @xmath748 , and @xmath938 .",
    "claim 2 . : :    almost all colorings of @xmath2 are _",
    "@xmath939$]-regular _ , meaning that one @xmath787 is    monochromatic , and the other @xmath940 avoids that color    entirely .",
    "claim 3 . : :    all nonzero degrees are at least @xmath941 , except    possibly for either ( i ) only one isolated edge @xmath942 ,    or ( ii ) only one non - isolated vertex @xmath755 .",
    "we use this to    show that each @xmath757 is within    @xmath937 of @xmath748 .",
    "let    @xmath943 if exception ( i ) occurs , let    @xmath758 if ( ii ) occurs , and let    @xmath759 otherwise .",
    "let @xmath760 .",
    "claim 4 . : :    almost all colorings are @xmath944$]-regular .",
    "claim 5 . : :    each @xmath764 is an independent set , and @xmath755    ( if it exists ) has neighbors in only one of the @xmath764 .",
    "hence @xmath2 is a bipartite graph plus isolated vertices .",
    "claim 6 . : :    @xmath2 is either a semi - complete subgraph of    @xmath945 plus isolated vertices , or a complete bipartite subgraph    @xmath946 plus a pendant edge to    @xmath755 .",
    "* proof of claim 1 . * the sets @xmath947 are complete to each other in @xmath736 ,",
    "so all @xmath268-vertices have degree @xmath948 in @xmath736 .",
    "as @xmath2 is at most @xmath933 edges away from @xmath736 , the number of @xmath268-vertices that are isolated in @xmath2 is at most @xmath949 .",
    "since @xmath175 received more non - isolated @xmath734-vertices than @xmath228 did , we must have @xmath950 . by proposition [ prop : construction - asymp - edges ]",
    ", @xmath736 has at least @xmath951 edges , all of which cross between @xmath738 .",
    "so @xmath2 has at least @xmath952 edges there , and at least that many between its max - cut @xmath737 .",
    "as @xmath2 has only @xmath5 edges , this shows that each @xmath240 $ ] spans @xmath953 edges .",
    "but the sets @xmath954 are complete to each other in @xmath736 , so @xmath955 , we indeed obtain @xmath956 .    then @xmath957 , because only @xmath936 of the @xmath735-vertices are isolated and @xmath956 of them are in @xmath175 . so , repeating the above with respect to @xmath781 and @xmath784 instead of @xmath777 and @xmath778 , we find that @xmath958 , which then implies that @xmath959 .    to control @xmath787 , observe that since the @xmath788 are complete to each other in @xmath736 , each vertex not in @xmath787 contributes at least @xmath935 to the total edit distance of @xmath960 between @xmath2 and @xmath736 .",
    "we set @xmath961 , so all but at most @xmath935 vertices of @xmath788 belong to @xmath787 .",
    "since @xmath746 is within @xmath936 of @xmath748 , this gives the desired result .",
    "@xmath246    * proof of claim 2 . * for each partition @xmath962 , we count the colorings which use the colors @xmath792 in @xmath753 but not @xmath754 , use @xmath793 in @xmath754 but not @xmath753 , use @xmath794 in both @xmath753 and @xmath754 , and do not use @xmath795 in either @xmath753 or @xmath754 .",
    "then we sum over all _ irregular _ partitions , which are all partitions with @xmath797 .",
    "note that a coloring is @xmath963$]-regular if and only if it does not use any color on both @xmath787 , so this sum will include all other colorings .    for any given partition with @xmath798 , we have that the corresponding number of colorings is at most @xmath964 , by the calculation in claim 2 of section [ sec : exact : sparse : details ] with @xmath1 replaced by 3 and @xmath965 replaced by @xmath4 . using that each @xmath749 is within @xmath937 of @xmath966 and all irregular colorings have @xmath967 , we find that the sum @xmath808 of this bound over all @xmath968 irregular partitions is : @xmath969 on the other hand , proposition [ prop : solve - opt ] , theorem [ thm : asymp - number ] , and routine algebra show that just as in the sparse case , the optimal graph has at least @xmath970 colorings . using @xmath971 , we find that @xmath972 , i.e. , almost all colorings of @xmath2 are @xmath973$]-regular .",
    "@xmath246    before proving the next claim , it is convenient to establish the following lemma , which should be understood in the context of claim 3 .",
    "[ lem : exact : q=3:sum - degrees ] let @xmath827 be a pair of non - isolated vertices of @xmath2 , such that @xmath601 is not an isolated edge",
    ". then @xmath974 .    *",
    "suppose for contradiction that there is such a pair @xmath827 with @xmath975 .",
    "also suppose that among the @xmath976$]-regular partial colorings of @xmath835 , at least half of them have @xmath977 monochromatic .",
    "( the case when at least half have @xmath978 monochromatic follows by a similar argument . )",
    "let @xmath179 be the graph obtained by deleting the @xmath830 edges incident to @xmath16 or @xmath17 , and adding back as many edges between @xmath16 and @xmath831 .",
    "consider any @xmath979$]-regular partial coloring of @xmath835 .",
    "if it is monochromatic in @xmath753 , which happens at least half the time by assumption , then in @xmath179 it has exactly 2 extensions to @xmath16 , followed by 3 further extensions to the newly - isolated vertex @xmath17 .",
    "the rest of the time , the partial coloring is monochromatic in @xmath754 and uses at most 2 colors in @xmath753 .",
    "then , in @xmath179 it has at least 1 extension to @xmath16 , followed by 3 further extensions to @xmath17 .    on the other hand ,",
    "since @xmath16 and @xmath17 both have degree at least 1 and do not form an isolated edge , one of them , say @xmath16 , has a neighbor in the rest of the graph .",
    "therefore , in @xmath2 the same partial coloring has at most @xmath980 extensions to the vertex @xmath16 , and then at most @xmath980 further extensions to the non - isolated vertex @xmath17 .",
    "yet by claim 2 , almost all colorings of @xmath2 arise in this way , so the ratio of @xmath179-colorings to @xmath2-colorings is at least @xmath981 , contradiction .",
    "@xmath246    * proof of claim 3 . *",
    "if there is an isolated edge @xmath942 , then lemma [ lem : exact : q=3:sum - degrees ] implies that any other vertex @xmath16 has latexmath:[$d(x ) + 1 = d(x ) + d(w_1 ) \\geq \\min\\{|x_1| ,    lemma implies there is at most one vertex @xmath755 of degree @xmath983 , giving exception ( ii ) .",
    "the rest of this claim , that each @xmath757 is within @xmath937 of @xmath748 , follows by the same argument as in claim 3 of section [ sec : exact : sparse : details ] , but with @xmath965 replaced by @xmath4 throughout .",
    "@xmath246    * proof of claim 4 . *",
    "note that a coloring is @xmath944$]-regular if and only if it does not use any color on both @xmath764 .",
    "so , we bound the colorings that share a color on both @xmath764 , but * ( i ) * use only one color on @xmath753 and a subset of the other two on @xmath754 , or * ( ii ) * one on @xmath754 and a subset of the other two on @xmath753 .",
    "since almost all colorings are @xmath963$]-regular , it suffices to show that these two types of colorings constitute @xmath54-fraction of all colorings .",
    "the same calculation as in claim 4 of section [ sec : exact : sparse : details ] , with @xmath1 replaced by 3 and @xmath965 replaced by @xmath4 , shows that the number of type-(i ) colorings is at most : @xmath984 on the other hand , we showed at the end of the proof of claim 2 that @xmath2 had at least @xmath985 colorings . since @xmath861",
    ", we have @xmath986 , as desired . the analogous result for type-(ii )",
    "colorings follows by a similar argument .",
    "@xmath246    * proof of claim 5 .",
    "* we first show that @xmath755 can not have neighbors in both @xmath764 .",
    "suppose for contradiction that this is not the case .",
    "almost all colorings are @xmath944$]-regular by claim 4 , so there is @xmath987 such that @xmath988 is monochromatic in at least @xmath989-fraction of all colorings",
    ". let @xmath179 be obtained by deleting the @xmath983 edges incident to @xmath755 , and replacing them with edges to @xmath990 only .",
    "consider any partial @xmath991$]-regular coloring of @xmath992 .",
    "if it uses only one color on @xmath988 ( which happens at least half the time by assumption ) , in @xmath179 it has exactly 2 extensions to @xmath755 .",
    "the rest of the time , it still uses at most 2 colors on @xmath988 , so there is at least 1 extension . on the other hand , in @xmath2",
    "the same partial coloring always has at most 1 extension to @xmath755 , because @xmath755 s neighbors in @xmath762 are colored differently from its neighbors in @xmath763 . by claim 2 , almost all colorings of @xmath2",
    "arise in this way , so the ratio of number of colorings of @xmath179 to @xmath2 is at least @xmath993 , contradiction .",
    "therefore , @xmath755 can not have neighbors in both @xmath764 , as claimed .",
    "it remains to show that both @xmath994 $ ] are empty .",
    "suppose for contradiction that some @xmath871 has neighbors within @xmath763 .",
    "( the analogous result for @xmath762 follows by a similar argument . )",
    "almost every coloring is @xmath944$]-regular , but @xmath763 can never be monochromatic because it contains edges .",
    "so , almost all colorings are in fact @xmath761-regular .",
    "is monochromatic , and @xmath763 has the other two colors . ]",
    "therefore , the same argument as in claim 5 of section [ sec : exact : sparse : details ] , with @xmath1 replaced by 3 and @xmath965 replaced by @xmath4 , shows that @xmath16 has at most @xmath995 neighbors within @xmath763 .",
    "* case 1 : there is some @xmath996 .",
    "* let @xmath179 be obtained by deleting the @xmath997 edges between @xmath16 and @xmath763 and the @xmath998 edges incident to anything in @xmath891 , and adding back as many edges between @xmath999 and @xmath1000 .",
    "every @xmath1001-regular partial coloring of @xmath1002 has exactly @xmath1003 extensions to all of @xmath179 , because @xmath16 and @xmath999 only need to avoid the single color which appears on @xmath762 , and the rest of @xmath891 ( if any ) is now isolated .",
    "on the other hand , in @xmath2 the same partial coloring has at most 1 extension to @xmath16 because @xmath16 must avoid the color of @xmath762 as well as some ( different ) color which appears on its neighbor in @xmath763 .",
    "then , it has at most @xmath1004 further extensions to @xmath1005 by the trivial bound , and at most 2 further extensions to the non - isolated vertex @xmath999 .",
    "note that all @xmath761-regular colorings of @xmath2 arise in this way , which is almost all of the total by our remark before we split into cases . hence for sufficiently large @xmath5",
    ", @xmath2 has fewer colorings than @xmath179 , contradiction .",
    "* case 2 : @xmath1006 , but there is some isolated vertex @xmath1007 . *",
    "define @xmath179 by deleting the @xmath997 edges between @xmath16 and @xmath763 , and adding back as many edges between @xmath881 and @xmath1008 . by the same arguments as in case 1 ,",
    "all @xmath1001-regular partial colorings of @xmath1009 have exactly @xmath1010 extensions to @xmath179 , but in @xmath2 they have at most 1 extension to @xmath16 , followed by 3 further extensions to the isolated @xmath881 .",
    "this produces almost all colorings of @xmath2 , so @xmath179 has more colorings for large @xmath5 , contradiction .",
    "* case 3 : @xmath1011 .",
    "* we observed that the edges in @xmath763 force almost all colorings to use only one color for @xmath762 and the other two on @xmath763 ( hence @xmath869 $ ] is bipartite ) .",
    "there are 3 color choices for @xmath762 , so the number of colorings of @xmath2 is @xmath1012 . recall that the number of 2-colorings of any bipartite graph @xmath661 is precisely @xmath1013 , where @xmath33 is its number of connected components .",
    "we claim that the bipartite @xmath869 $ ] has at most @xmath1014 components , where @xmath374 is the number of edges in @xmath869 $ ] .",
    "indeed , for fixed @xmath374 , the optimal configuration is to have all isolated vertices except for a single nontrivial ( bipartite ) component @xmath454 .",
    "the sizes @xmath1015 of the sides of that bipartite @xmath454 should minimize @xmath1016 subject to the constraint @xmath1017 , so by the inequality of the arithmetic and geometric means , we have @xmath1018 , as desired .",
    "therefore , @xmath2 has at most @xmath1019 colorings .",
    "let @xmath179 be the complete bipartite graph with sides @xmath697 and @xmath1020 , such that @xmath697 is as large as possible subject to @xmath1021 .",
    "note that @xmath1022 because all but @xmath374 of @xmath2 s @xmath5 edges cross between the @xmath764 , so inequality [ ineq : exact : q=3:claim5 ] routinely shows that @xmath1023 .",
    "since @xmath179 is complete bipartite , it has exactly @xmath1024 colorings , and thus our bound on @xmath697 implies that @xmath179 has strictly more than @xmath1025 colorings . yet for @xmath1026 , one may check that @xmath1027 , giving @xmath179 more colorings than @xmath2 , which is impossible .",
    "we are left with the cases @xmath1028 , but for these values there is always a vertex @xmath854 with exactly 1 neighbor @xmath881 in @xmath869 $ ] .",
    "this forces all edges to be present between the @xmath764 , because otherwise we could increase the number of @xmath873-regular colorings by a factor of 2 by deleting the edge @xmath1029 and adding one of the missing edges between the @xmath764 .",
    "the presence of the complete bipartite graph forces _ every _ coloring of @xmath2 to use exactly two colors on @xmath763 , and the other on @xmath762 . together with the observation that the maximum number of connected components of @xmath869 $ ] is @xmath1030 when @xmath1028 , we find that @xmath2 has _ exactly _",
    "@xmath1031 colorings . on the other hand , we showed above that @xmath179 had more than @xmath1032 colorings . since @xmath1033 for @xmath1028 , @xmath179 has more colorings than @xmath2 , contradiction . @xmath246    * proof of claim 6 .",
    "* let @xmath1034 $ ] be the graph formed by the non - isolated vertices of @xmath2 , and let @xmath1035 times the number of colorings of @xmath1036 , the optimality of @xmath2 implies that @xmath1036 must also be optimal among @xmath172-vertex graphs with @xmath5 edges .",
    "furthermore , claim 4 also implies that almost all colorings of @xmath1036 are @xmath944$]-regular .",
    "* case 1 : @xmath1037 is empty .",
    "* let @xmath1038 be the sizes of the @xmath764 , with @xmath46 .",
    "if there are less than @xmath49 missing edges between the @xmath764 , then lemma [ lem : semi - complete ] shows that @xmath1036 is semi - complete , so we are done . on the other hand ,",
    "if there are at least @xmath49 missing edges , then @xmath1039 plus one isolated vertex has @xmath172 vertices and at least @xmath5 edges , but also exactly @xmath1040 colorings . yet @xmath1036 has no vertices outside @xmath1041 , and almost all colorings are @xmath944$]-regular , so @xmath1036 has at most @xmath1042 colorings , which is smaller , contradiction .",
    "@xmath246    * case 2 : @xmath1037 is the single edge @xmath1043 .",
    "* we show that this is impossible .",
    "let @xmath1038 be the sizes of the @xmath1044 with @xmath46 . since there are always exactly 6 ways to color the endpoints @xmath1045 of the isolated edge independently of the rest of @xmath238 , and almost all colorings are @xmath944$]-regular , @xmath1036 has @xmath1046 colorings .",
    "let @xmath179 be the complete bipartite graph @xmath1047 , and let @xmath1048 be the complete bipartite graph @xmath1049 plus one isolated vertex .",
    "both graphs have the same number of vertices as @xmath1036 , so it suffices to show that at least one of them has more edges and more colorings than @xmath1036 .",
    "claim 3 gives @xmath1050 , and proposition [ prop : solve - opt ] implies that @xmath1051 .",
    "so for small @xmath818 and large @xmath4 , we have that @xmath1052 , hence @xmath179 has more edges than @xmath1036 . also , @xmath179 has @xmath1053 colorings that use only one color on the @xmath1054-side and the other two on the @xmath1055-side .",
    "we claim that this already exceeds the number of colorings of @xmath1036 whenever @xmath1056 . indeed , then @xmath1057 , so the number of colorings of @xmath1036 is at most : @xmath1058 which is indeed less than the number of colorings of @xmath179 .",
    "it remains to consider @xmath1059 .",
    "here , @xmath1048 has @xmath1060 edges , and exactly @xmath1061 colorings . using @xmath1062 ,",
    "this is at least @xmath1063 . on the other hand , using @xmath46",
    ", the number of colorings of @xmath1036 is at most @xmath1064 , which is smaller .",
    "therefore , @xmath1048 is superior on this range , and we are done .",
    "* case 3 : @xmath1037 is the single vertex @xmath1065 .",
    "* let @xmath504 be the index ( unique by claim 5 ) such that @xmath988 contains neighbors of @xmath755 .",
    "let @xmath1066 be the other index , and let @xmath1067 , @xmath1068 .",
    "note that @xmath1036 is bipartite with partition @xmath1069 .",
    "if at least @xmath901 edges are missing between @xmath988 and @xmath1070 , then we can isolate @xmath755 while only adding edges between @xmath988 and @xmath1070 .",
    "this increases the number of @xmath1071$]-regular colorings by a factor of @xmath1072 , which is impossible .",
    "so , less than @xmath901 edges are missing between @xmath988 and @xmath1070 , which implies that less than @xmath49 edges are missing between @xmath988 and @xmath1073 .",
    "hence @xmath1036 is a subgraph of @xmath1074 with less than @xmath49 missing edges .",
    "when @xmath1075 , lemma [ lem : semi - complete ] shows that @xmath1036 is semi - complete , as desired .",
    "it remains to consider @xmath1076 .",
    "some vertex of the set @xmath988 of size @xmath49 is complete to @xmath1073 , because less than @xmath49 edges are missing between @xmath988 and @xmath1077 .",
    "but we also showed that less than @xmath1078 edges are missing between @xmath988 and @xmath1070 , so some vertex of @xmath1070 must be complete to @xmath988 .",
    "thus , lemma [ lem : subgraph - bipartite : q=3 ] implies that since @xmath1036 is an optimal graph , the missing edges @xmath1079 form a star , which must have center @xmath755 because @xmath1080 .",
    "in particular , the number of missing edges is then exactly @xmath1081 , where @xmath1082 , and then the same lemma shows that @xmath1036 has exactly @xmath1083 colorings .    consider the graph @xmath179 obtained by removing a @xmath1084-edge star from the complete bipartite graph @xmath1085 .",
    "this has as many vertices and edges as @xmath1036 , and @xmath1086 colorings by lemma [ lem : subgraph - bipartite : q=3 ] .",
    "the difference between the numbers of colorings of @xmath179 and @xmath1036 is @xmath1087 which exceeds zero for @xmath1088 because we are in the case @xmath1089 .",
    "optimality of @xmath1036 thus forces @xmath1090 .",
    "we showed there were less than @xmath901 edges missing between the @xmath764 , so now we know that the non - isolated vertices of @xmath2 form a complete bipartite subgraph @xmath761 plus a pendant edge to @xmath755 . finally , observe that @xmath2 can not have any isolated vertex @xmath881 , or else",
    "we could replace the pendant edge with the ( isolated ) edge @xmath1091 , and this would not change the number of colorings because every partial coloring of @xmath992 would still have exactly 2 extensions to the degree-1 vertex @xmath755 . but the resulting graph is not optimal by the same argument as in case 2 of this claim . therefore , @xmath2 is only a complete bipartite subgraph plus a pendant edge , with no isolated vertices .",
    "this completes the final case of our final claim , and our entire proof .",
    "we now study the extremality of turn graphs . as we mentioned in the introduction",
    ", lazebnik conjectured that turn graphs @xmath32 were the unique graphs that maximized the number of @xmath1-colorings whenever @xmath77 .",
    "note that theorem [ thm : main : q=3 ] implies this result for @xmath9 and @xmath1092 when @xmath4 is large , because it shows that all optimal graphs are bipartite , and no other bipartite graph has as many edges as @xmath1093 . in this section , we prove theorem [ thm : exact : turan ] , which confirms ( for large @xmath4 ) lazebnik s conjecture when @xmath79 , for all remaining @xmath1 .",
    "our proof relies on the following special case of a result of simonovits @xcite .",
    "let @xmath1094 denote the number of edges of the @xmath33-partite turn graph @xmath32 with @xmath4 vertices .",
    "[ fact : simonovits ] let @xmath661 be a graph with chromatic number @xmath1095 .",
    "suppose there is an edge whose deletion makes @xmath661 @xmath33-colorable .",
    "then for all sufficiently large @xmath4 , the turn graph @xmath32 is the unique @xmath4-vertex graph with at least @xmath1094 edges that does not contain a subgraph isomorphic to @xmath661 .",
    "we use this fact to prove the following lemma , which we will need later .",
    "[ lem : exact : turan ] let @xmath6 be fixed .",
    "the following holds for all sufficiently large @xmath4 .",
    "let @xmath1096 have @xmath4 vertices , and at least as many edges and @xmath1-colorings as @xmath80 .",
    "let @xmath1097 be the difference between the number of edges of @xmath2 and @xmath80 , and let @xmath1098 .",
    "then there is an @xmath394-vertex graph @xmath82 with at least @xmath1099 more edges than @xmath1100 , and at least half as many @xmath1-colorings as @xmath2 has .",
    "* we begin with a convenient technical adjustment . if @xmath2 has @xmath1101 connectivity components @xmath1102 that are not isolated vertices , then choose vertices @xmath1103 and glue the components together by merging all of the @xmath1104 into a single vertex @xmath50 .",
    "add @xmath1105 isolated vertices @xmath1106 to restore the vertex count , and let @xmath179 be the resulting graph .",
    "clearly , @xmath179 has as many edges as @xmath2 , and it also is not @xmath80 because @xmath179 has a vertex whose deletion increases the number of components while @xmath80 does not .",
    "furthermore , we claim that @xmath2 and @xmath179 have the same number of colorings . indeed , by symmetry , for an arbitrary color @xmath254 , the total number of colorings of @xmath2 is precisely @xmath682 times the number of colorings of @xmath2 which use @xmath254 for every @xmath1104 .",
    "the obvious correspondence gives a bijection between these colorings and partial colorings of @xmath1107 which use @xmath254 on the merged vertex @xmath50 .",
    "yet the @xmath1108 are isolated , so each of these partial colorings has exactly @xmath1109 extensions to all of @xmath179 .",
    "again by symmetry , the total number of colorings of @xmath179 is precisely @xmath1 times the number that use @xmath254 on @xmath50 . putting everything together , we find that @xmath2 and @xmath179 indeed have the same number of colorings . therefore , by replacing @xmath2 with @xmath179 , we may assume without loss of generality that @xmath2 has only one nontrivial connectivity component .",
    "fact [ fact : simonovits ] implies that for large @xmath4 , @xmath2 has a subgraph @xmath661 which is the complete @xmath441-partite graph on @xmath1110 with each part @xmath1111 consisting of two vertices , plus an extra edge @xmath1112 .",
    "let @xmath1113 and @xmath1114 , and let @xmath1115 .",
    "let @xmath177 be the difference between the number of edges of @xmath80 and @xmath1100 .",
    "we claim that if there is a set @xmath924 of @xmath376 vertices of @xmath104 such that the sum of their degrees is at most @xmath1116 , then @xmath1117 satisfies the lemma s assertion",
    ". clearly , @xmath82 has the correct number of vertices , and it has the correct number of edges because @xmath1118 induces a complete graph @xmath1119 , so the number of deleted edges is at most @xmath1120 .",
    "we now show that every @xmath1-coloring of @xmath82 extends to at most two @xmath1-colorings of @xmath2 .    if @xmath1121 , since @xmath1122 induces a @xmath83-subgraph in @xmath2 , every coloring of @xmath1123 has at most 1 extension to @xmath849",
    ". then , every other @xmath748 has at most 1 choice because @xmath1124 induces a @xmath83-subgraph in which @xmath748 is the only uncolored vertex .",
    "thus when @xmath1121 , every coloring of @xmath82 colors @xmath1125 and hence has at most 1 extension to @xmath2 . on the other hand ,",
    "up to a symmetry of @xmath661 , the only other case is when @xmath1126 .",
    "as before , @xmath1122 induces a @xmath83-subgraph in @xmath2 , but this time @xmath82 contains neither @xmath849 nor @xmath1127 ( although it contains the rest ) .",
    "any partial coloring of @xmath494 vertices of @xmath83 has only 2 completions , so there are at most 2 ways to extend any coloring of @xmath82 to include @xmath849 and @xmath1127 .",
    "but then every other @xmath748 has at most 1 choice because @xmath1124 induces a @xmath83-subgraph in which @xmath748 is the only uncolored vertex .",
    "therefore , every coloring of @xmath82 has at most 2 extensions to @xmath2 , as claimed .",
    "it remains to consider the case when every set of @xmath376 vertices of @xmath104 has degrees summing to at least @xmath1128 .",
    "we will show that then @xmath2 has fewer colorings than @xmath80 , which is impossible .",
    "let @xmath1129 . by an averaging argument , the sum of degrees of @xmath104 is at least @xmath1130 $ ] .",
    "since @xmath1131 , the number of edges between @xmath104 and @xmath105 is at least @xmath1132 - 2 { q    \\choose 2}$ ] .",
    "let @xmath1133 be the set of isolated vertices of @xmath2 , and for @xmath1134 , let @xmath1135 be the set of vertices of @xmath105 that send @xmath745 edges to @xmath104 .",
    "note that no vertex can send @xmath1136 edges to @xmath104 because that would create a @xmath1137-subgraph , making @xmath2 not @xmath1-colorable .",
    "so , if we let @xmath1138 , then every vertex of @xmath1139 either sends exactly 1 edge to @xmath104 , or it is a non - isolated vertex that sends no edges to @xmath104 .",
    "let @xmath1140 . by counting the number of edges between @xmath104 and @xmath105 ,",
    "we obtain : @xmath1141     - 2 { q \\choose 2}.\\ ] ]    we now bound the number of @xmath1-colorings of @xmath2 in terms of the @xmath1142 .",
    "there are exactly @xmath1143 ways to color @xmath104 because it induces @xmath83",
    ". then , there are exactly @xmath1144 ways to extend this partial coloring to @xmath1133 because each isolated vertex has a free choice of the @xmath1 colors .",
    "next , for every @xmath1145 , each vertex in @xmath1135 has at most @xmath1146 color choices left because it is adjacent to @xmath745 vertices in @xmath104 , all of which received different colors since @xmath1147 = k_q$ ] . finally , we color the vertices of @xmath1139 by considering them in an order such that whenever we color a vertex , it always has a neighbor that we already colored .",
    "this is possible because our initial technical adjustment allows us to assume that @xmath2 has only one nontrivial connectivity component .",
    "hence each vertex in @xmath1139 will have at most @xmath376 choices .",
    "putting this all together , we find that the number of @xmath1-colorings of @xmath2 is at most @xmath1148       + 2 { q \\choose 2}},\\ ] ] where we used the inequality @xmath1149 for @xmath1150 , the identity @xmath1151 ( since @xmath1152 ) , and the bound for @xmath1153 from inequality .",
    "inequality [ ineq : exact : turan : routine ] routinely verifies that this final bound is always strictly less than the number of colorings of @xmath80 , contradicting our assumption that @xmath2 had at least that many colorings .",
    "@xmath246    * proof of theorem [ thm : exact : turan ] .",
    "* let @xmath1154 be fixed , and let @xmath1155 be the corresponding minimum number of vertices for which lemma [ lem : exact : turan ] holds ( it is valid only for sufficiently large @xmath4 ) .",
    "we will show that theorem [ thm : exact : turan ] holds for all @xmath1156 .",
    "so , suppose for contradiction that @xmath1096 is an @xmath4-vertex graph with at least as many edges and @xmath1-colorings as @xmath80 .",
    "define a sequence of graphs as follows .",
    "start with @xmath1157 .",
    "if @xmath342 is the current graph , stop if @xmath342 has fewer colorings than the @xmath441-partite turn graph with @xmath1158 vertices .",
    "otherwise , let @xmath1159 be the graph @xmath82 obtained by applying lemma [ lem : exact : turan ] to @xmath342 .",
    "we claim that this process terminates before the graph @xmath342 has fewer than @xmath1155 vertices , so we will always be able to apply the lemma .",
    "indeed , each @xmath342 has exactly @xmath1158 vertices , so it will take more than @xmath1160 iterations before @xmath342 has fewer than @xmath1155 vertices . yet",
    "if @xmath1161 is the difference between the number of edges of @xmath2 and @xmath80 , then each @xmath342 has at least @xmath1162 more edges than the @xmath441-partite turn graph with @xmath1158 vertices .",
    "so , after @xmath1160 iterations , @xmath342 would certainly have more than the maximum number of edges of an @xmath1155-vertex graph , and we indeed can never reach a graph with fewer than @xmath1155 vertices .",
    "therefore , we stop at some @xmath1163 , which has @xmath1164 vertices and fewer colorings than @xmath1100 , but at least @xmath1165 times as many colorings as @xmath2 .",
    "divide @xmath4 by @xmath376 , so that @xmath1166 with @xmath1167 , and note that @xmath1168 .",
    "lemma [ lem : turan - number - colorings ] calculates that @xmath1100 has exactly @xmath1169 $ ] colorings , so @xmath2 has at most @xmath1170 times that many , hence fewer than @xmath1171 $ ] . yet by the same lemma , that final bound equals the number of colorings of @xmath80 .",
    "thus @xmath2 has fewer colorings than @xmath80 , contradiction . @xmath246",
    "* we have developed an approach that we hope future researchers can use to determine the graphs that maximize the number of @xmath1-colorings .",
    "theorems [ thm : asymp - number ] and [ thm : asymp - stability ] reduce any instance of this problem to a quadratically - constrained linear program , which can be solved for any case of interest .",
    "thus , thanks to modern computer algebra packages , these theorems imply that for any fixed @xmath1 , approximately determining the extremal graphs amounts to a finite symbolic computation . + the remaining challenge is to find analytic arguments which solve the optimization problem for general @xmath1 , and then refine the approximate structure into precise results .",
    "we accomplished this for low densities @xmath65 , and the natural next step would be to extend the result to the range @xmath1172 . in this range , and for all @xmath1 , we expect the solution to the optimization problem to correspond to a bipartite graph plus isolated vertices .",
    "this common form gives hope that perhaps one can find a solution which works across all @xmath1 .",
    "* for @xmath9 , we also know the approximate form of the extremal graphs when @xmath41 , since proposition [ prop : solve - opt ] solved the entire @xmath9 case of the optimization problem",
    ". however , we did not pursue the precise structure of the optimal graphs because it appears that their description is substantially more involved , and this paper was already quite long . * our methods in section",
    "[ sec : reduction - to - opt ] can easily be adapted to maximize the number of graph homomorphisms to an arbitrary @xmath82 ( not just @xmath83 ) .",
    "the analogues of theorems [ thm : asymp - number ] and [ thm : asymp - stability ] show that for any fixed @xmath82 , the asymptotic maximum number of homomorphisms from an @xmath4-vertex , @xmath5-edge graph to @xmath82 can be determined by solving a certain quadratically - constrained linear program .",
    "although this can in principle be done , it appears that the computations become rather messy even for graphs @xmath82 of small order .",
    "+ however , in the interesting case when @xmath82 is the two - vertex graph consisting of a single edge plus a loop , one can easily determine the extremal graphs via a direct argument . as we mentioned in the introduction",
    ", this corresponds to maximizing the number of independent sets . by considering the complement of the graph ,",
    "this is equivalent to maximizing the number of cliques .",
    "+ we claim that for any @xmath21 , the same graph that linial found to minimize the number of colorings also happens to maximize the number of cliques .",
    "this graph @xmath736 was a clique @xmath23 with an additional vertex adjacent to @xmath24 vertices of the @xmath23 , plus @xmath25 isolated vertices , where @xmath26 are the unique integers satisfying @xmath1173 with @xmath1174 .",
    "we will show that for any @xmath374 , every @xmath4-vertex graph @xmath2 with @xmath5 edges has at most as many @xmath374-cliques as @xmath736 .",
    "the only nontrivial values of @xmath374 to check are @xmath1175 .",
    "+ if @xmath1176 , then @xmath736 has exactly @xmath1177 cliques of size @xmath374 .",
    "suppose for contradiction that @xmath2 has more @xmath374-cliques .",
    "construct a @xmath374-uniform hypergraph with at least @xmath1178 hyperedges by defining a hyperedge for each @xmath374-clique . by the kruskal - katona theorem ( see , e.g. , the book @xcite ) , the number of 2-sets that are contained in some hyperedge is at least @xmath1179 , which exceeds the number of edges of @xmath2 .",
    "this contradicts the definition of the hyperedges , because each of these 2-sets must be an edge of @xmath2 .",
    "+ on the other hand , if @xmath1180 , @xmath736 has exactly @xmath1181 cliques of size @xmath374 .",
    "a similar argument shows that if @xmath2 has at least @xmath1182 cliques of size @xmath374 , then @xmath2 must have at least @xmath1183 edges , contradiction .",
    "+ therefore , @xmath736 indeed maximizes the number of cliques .",
    "furthermore , we can classify all extremal graphs , because our argument shows that any other graph @xmath2 with as many cliques as @xmath736 must also have exactly the same number of @xmath374-cliques for all integers @xmath374 .",
    "in particular , using @xmath1184 , we see that @xmath2 must also contain a @xmath23 .",
    "if @xmath1185 , we can use @xmath1186 to conclude that the remaining edges form a star with all endpoints in the @xmath23 .",
    "therefore , the maximizer is unique unless @xmath1187 , in which case the extremal graphs are @xmath23 plus an arbitrary edge ( not necessarily incident to the @xmath23 ) .",
    "99 n. alon , independent sets in regular graphs and sum - free subsets of finite groups , _",
    "israel j. math .",
    "_ * 73 * ( 1991 ) , 247256 .",
    "n. alon , j. balogh , p. keevash , and b. sudakov , the number of edge colorings with no monochromatic cliques , _ j. lond .",
    "* 70 * ( 2004 ) , 273288 .",
    "j. balogh , a remark on the number of edge colorings of graphs , _ europ .",
    "j. combin . _",
    "* 27 * ( 2006 ) , 565573 .",
    "n. alon and j. spencer , * the probabilistic method * , 2nd ed . ,",
    "wiley , new york , ny , 2000 .",
    "i. anderson , * combinatorics of finite sets * , dover , mineola , ny , 2002 .",
    "e. bender and h. wilf , a theoretical analysis of backtracking in the graph coloring problem , _ journal of algorithms _ * 6 * ( 1985 ) , 275282 .",
    "g. birkhoff , a determinant formula for the number of ways of coloring a map , _ annals of mathematics _ * 14 * ( 1912 ) , 4246 .",
    "g. birkhoff , on the number of ways of colouring a map , _ proc .",
    "edinburgh math .",
    "( 2 ) _ * 2 * ( 1930 ) , 8391 .",
    "g. birkhoff and d. lewis , chromatic polynomials , _ transactions of the american mathematical society _ * 60 * ( 1946 ) , 355451 .",
    "b. bollobs , * modern graph theory * , springer - verlag , new york , ny , 1998 .",
    "o. byer , some new bounds for the maximum number of vertex colorings of a @xmath1188-graph , _ j. graph theory _ * 28 * ( 1998 ) , 115128 .",
    "k. dohmen , lower bounds and upper bounds for chromatic polynomials , _ j. graph theory _ * 17 * ( 1993 ) , 7580 .",
    "k. dohmen , bounds to the chromatic polynomial of a graph , _ results math . _",
    "* 33 * ( 1998 ) , 8788 .",
    "p. erds , some new applications of probability methods to combinatorial analysis and graph theory , _ congres . numer .",
    "_ * 10 * ( 1974 ) , 3951 .",
    "p. erds , some of my favourite problems in various branches of combinatorics , _ matematiche ( catania ) _ * 47 * ( 1992 ) , 231240 .",
    "d. galvin and p. tetali , on weighted graph homomorphisms , in : _",
    "graphs , morphisms and statistical physics _ , dimacs ser .",
    "discrete math .",
    "63 , amer .",
    "soc . , providence , ri , 2004 , 97104 .",
    "j. kahn , an entropy approach to the hard - core model on bipartite graphs , _ combin .",
    "computing _ * 10 * ( 2001 ) , 219237 .",
    "j. kahn , entropy , independent sets and antichains : a new approach to dedekind s problem , _ proc .",
    "* 130 * ( 2002 ) , 371378 .",
    "f. lazebnik , on the greatest number of 2 and 3 colorings of a @xmath1189-graph , _ j. graph theory _ * 13 * ( 1989 ) , 203214 .",
    "f. lazebnik , new upper bounds for the greatest number of proper colorings of a @xmath1189-graph , _ j. graph theory _ * 14 * ( 1990 ) , 2529 .",
    "f. lazebnik , some corollaries of a theorem of whitney on the chromatic polynomial , _ discrete math . _",
    "* 87 * ( 1991 ) , 5364 .",
    "f. lazebnik , o. pikhurko , and a. woldar , maximum number of colorings of @xmath1190-graphs , _ j. graph theory _ * 56 * ( 2007 ) , 135148 .",
    "n. linial , legal coloring of graphs , _ combinatorica _ * 6 * ( 1986 ) , 4954 .    r. liu , on the greatest number of proper 3-colorings of a graph , _ math .",
    "_ * 6 * ( 1993 ) , 8891 .",
    "r. read , the number of @xmath84-coloured graphs on labelled nodes , _ can .",
    "_ * 12 * ( 1960 ) , 409413 .",
    "i. simonelli , optimal graphs for chromatic polynomials , _ discrete math . _",
    "* 308 * ( 2008 ) , 22282239 .",
    "m. simonovits , a method for solving extremal problems in graph theory , stability problems , in : _ theory of graphs ( proceedings of the colloquium , tihany , 1966 ) _ , eds .",
    "p. erds and g. katona , academic press , new york ( 1968 ) , 279319 .",
    "i. tomescu , le nombre maximal de colorations dun graphe , _ c. r. acad .",
    "paris _ * 272 * ( 1971 ) , 13011303 .    i. tomescu , le nombre maximal de 3-colorations dun graphe connexe , _ discrete math . _",
    "* 1 * ( 1972 ) , 351356 .",
    "i. tomescu , le nombre minimal de colorations dun graphe , _ c. r. acad .",
    "paris _ * 274 * ( 1972 ) , 539542 .",
    "i. tomescu , problmes extremaux concernant le nombre des colorations des sommets dun graphe fini , in : _ combinatorial programming : methods and applications ( proc .",
    "nato advanced study inst . ,",
    "versailles , 1974 ) _ , nato advanced study inst . ser .",
    "c : math . and phys .",
    "19 , reidel , dordrecht , 1975 , 327336 .",
    "i. tomescu , le nombre maximal de colorations dun graphe hamiltonien , _ discrete math .",
    "_ * 16 * ( 1976 ) , 353359 .",
    "i. tomescu , maximal chromatic polynomials of connected planar graphs , _ j. graph theory _ * 14 * ( 1990 ) , 101110 .    i. tomescu , maximum chromatic polynomials of 2-connected graphs , _ j. graph theory _ * 18 * ( 1994 ) , 329336 .    i. tomescu , maximum chromatic polynomial of 3-chromatic blocks , _ discrete math . _",
    "* 172 * ( 1997 ) , 131139 .",
    "h. whitney , a logical expansion in mathematics , _ bull .",
    "* 38 * ( 1932 ) , 572579 .",
    "h. wilf , backtrack : an @xmath1191 expected time algorithm for the graph coloring problem , _ information processing letters _ * 18 * ( 1984 ) , 119121 .",
    "e. wright , counting coloured graphs iii , _ can .",
    "_ * 24 * ( 1972 ) , 8289 .",
    "r. yuster , the number of edge colorings with no monochromatic triangle , _ j. graph theory _ * 21 * ( 1996 ) , 441452 .",
    "in this section , we present the postponed proofs of the results stated in section [ sec : solve - opt - sparse - q>=9 ] .",
    "we begin by disposing of lemma [ lem : sparse : fq ] , which states some analytical facts about the function @xmath1192 .",
    "* proof of lemma [ lem : sparse : fq ] . * for part ( i ) ,",
    "observe that if we reparameterize with @xmath1193 , then we need to show that the function @xmath1194 is strictly increasing on @xmath1195 and strictly decreasing on @xmath1196 . instead of presenting a tedious analytic proof ( which is routine and not very interesting ) , we refer the reader to _ mathematica _",
    "s plot of @xmath1197 in figure [ fig : sparse : fq](i ) .    for part ( ii ) ,",
    "define the functions @xmath1198 and @xmath1199 .",
    "we need to show that @xmath1200 for all @xmath1201 .",
    "direct substitution yields @xmath1202 and @xmath1203 , so it is true at @xmath1204 .",
    "also , a quick estimate shows that asymptotically , as @xmath1205 , @xmath1206 and @xmath1207 .",
    "therefore , the ratio @xmath1208 tends to 1.5 , which is indeed greater than 1 .",
    "again , instead of writing a routine analytic proof to fill in the gap between 9 and infinity , we refer the reader to figure [ fig : sparse : fq](ii ) , which shows that the ratio @xmath1209 steadily increases as @xmath16 grows from 9 .",
    "thus , @xmath1200 for all @xmath1201 , as required .",
    "@xmath246    .",
    "plot ( ii ) displays the ratio @xmath1210 , where @xmath1211 and @xmath1212 are as defined above , and the horizontal axis is parameterized by @xmath1213 . ]    * plot ( i ) *    . plot ( ii )",
    "displays the ratio @xmath1210 , where @xmath1211 and @xmath1212 are as defined above , and the horizontal axis is parameterized by @xmath1213 . ]    * plot ( ii ) *    the monotonicity of @xmath499 on @xmath1214 , which we just established , is useful for our next proof .",
    "this is lemma [ lem : sparse:2sets=>done ] , which stated that if @xmath125 solves @xmath419 and is supported by a partition of @xmath97 $ ] consisting of exactly two sets , then @xmath125 must have the same form as @xmath422 , the claimed optimal vector in proposition [ prop : solve - opt-2 ] .",
    "* proof of lemma [ lem : sparse:2sets=>done ] .",
    "* let @xmath104 and @xmath105 denote the two sets in the support , with @xmath1215 .",
    "write @xmath1216 . flipping the fractions to make the logarithms positive",
    ", we have @xmath1217 by the inequality of arithmetic and geometric means .",
    "yet @xmath1218 since @xmath125 is in the feasible set @xmath416 , so @xmath1219 . here",
    ", @xmath1220 is the function which lemma [ lem : sparse : fq](i ) claimed was strictly increasing between 0 and @xmath1221 . in particular , since @xmath1222 , the final bound is at most @xmath1223 , which we recognize as @xmath1224 , where @xmath422 is the claimed unique optimal vector in proposition [ prop : solve - opt-2 ] .",
    "since @xmath125 was assumed to be maximal , we must have equality in all of the above inequalities . checking the equality conditions",
    ", we find that @xmath125 must indeed have the unique form claimed in proposition [ prop : solve - opt-2 ] .",
    "@xmath246    the remaining lemma from section [ sec : solve - opt - sparse - q>=9 ] ruled out a handful of partitions as possible supports for optimal vectors .",
    "it turns out that each of those excluded partitions is a special case of the following result .",
    "[ lem : sparse : almost - singletons ] fix any integer @xmath44 , and let @xmath125 be a vector which solves @xmath419 , whose support is a partition of @xmath97 $ ] . then that partition can not be @xmath1225 , where @xmath1226",
    ".    * proof . *",
    "assume for the sake of contradiction that @xmath125 is supported by the above partition .",
    "let @xmath1227 , which are all equal by lemma [ lem : sparse : ij](ii ) .",
    "we assumed that @xmath125 was maximal , so in particular @xmath1228 , where @xmath422 is the feasible vector constructed in proposition [ prop : solve - opt-2 ] .",
    "therefore , @xmath1229 and we conclude that @xmath1230 . on the other hand , we also know by lemma [ lem : sparse : ij](i ) for the set @xmath1231 that @xmath1232 . using the final bound for @xmath1233 above",
    ", this gives @xmath1234 ( the inequality reversed because @xmath1235 is negative . )    to get our contradiction , it remains to show that this is less than @xmath424 . cancelling the common factor of @xmath1236 and rearranging terms",
    ", this reduces to showing that @xmath1237 .    since @xmath1238 by definition",
    ", it suffices to show that @xmath1239 .",
    "removing the logarithms reduces us to showing that @xmath1240 .",
    "this is equivalent to @xmath1241 , which is easily seen to be true by multiplying out each side .",
    "@xmath246    * proof of lemma [ lem : sparse : extreme]*. part ( i ) , the partition of all singletons , is precisely the case of the previous lemma when @xmath1242 .",
    "similarly , part ( ii ) , the partition of all singletons except for a 2-set , corresponds to the @xmath1243 case . for part ( iii ) , which concerns partitions that include a @xmath492-set , first note that",
    "if the partition is a @xmath492-set plus two singletons , then it is precisely the @xmath1244 case of the previous lemma .",
    "the only other possibility is that the partition is a @xmath492-set plus a 2-set , and this is excluded by lemma [ lem : sparse:2sets=>done ] .",
    "[ prop : pendant - necessary ] let @xmath33 be a sufficiently large positive integer . then the complete bipartite graph @xmath1245 plus one pendant edge achieves the maximum number of colorings among all @xmath1246-vertex graphs with @xmath1247 edges .    * proof . *",
    "every 3-coloring of @xmath1245 has exactly 2 extensions to the pendant vertex , so lemma [ lem : subgraph - bipartite : q=3 ] shows that the above graph has exactly @xmath1248 colorings .",
    "plugging @xmath1249 and @xmath1250 into the dense case of theorem [ thm : main : q=3 ] , we see that the only other graphs we need to consider are semi - complete subgraphs of some @xmath51 with @xmath1251 and @xmath1252 , plus isolated vertices .",
    "note that we must have @xmath1253 , because when @xmath1254 and @xmath1255 , convexity implies that @xmath1256 , and there would not be enough edges .",
    "let @xmath179 be one of the above graphs with @xmath1257 for some @xmath1258 .",
    "we must have @xmath1259 , because @xmath1260 , so any smaller @xmath685 would not produce enough edges .",
    "this leaves @xmath1261 isolated vertices .",
    "observe that when @xmath1262 , this forces @xmath179 to be a semi - complete subgraph of @xmath1263 with exactly @xmath1264 missing edges .",
    "lemma [ lem : subgraph - bipartite : q=3 ] then shows that the number of colorings of @xmath179 is @xmath1265 , which is exactly the same as @xmath2 .",
    "it remains to consider @xmath1266 . by definition , any semi - complete subgraph of @xmath51 is missing at most @xmath1267 edges ,",
    "so lemma [ lem : subgraph - bipartite : q=3 ] implies that the number of 3-colorings of @xmath179 is at most @xmath1268 .",
    "this expression is largest when @xmath685 is as small as possible , so using @xmath1259 and @xmath1249 , we find that @xmath179 has at most @xmath1269 colorings .",
    "since @xmath1251 , this is at most @xmath1270 , which is indeed less than the number of colorings of @xmath2 when @xmath33 is large .",
    "@xmath246    * remark . *",
    "a similar argument shows that for any @xmath1271 and large @xmath33 , @xmath1272 plus a pendant edge is optimal among graphs with @xmath1273 vertices and @xmath1274 edges .",
    "interestingly enough , it can also be shown that these values of @xmath21 are the only ones which produce optimal graphs that are not semi - complete plus isolated vertices , when @xmath21 are large .",
    "[ ineq : partition - colors ] let @xmath1275 be positive integers , with @xmath1026 and @xmath1276 .",
    "then :    ( i ) : :    the product @xmath1277 falls by a factor of at least    @xmath1278 when @xmath745 increases by 1 , for all    @xmath1279 .",
    "( ii ) : :    if we further assume that @xmath49 is sufficiently large    ( depending only on @xmath374 ) , then    @xmath1280 , i.e. , the first summand    dominates .    * proof . *",
    "when @xmath1281 increases by 1 , @xmath745 grows by a factor of at most 2 , but @xmath1282 falls by at least @xmath1283 .",
    "thus , the product @xmath1277 falls by a factor of at least @xmath1284 .",
    "since @xmath1026 , this gives ( i ) .",
    "for part ( ii ) , when @xmath745 increases by 1 , the term @xmath1285 in the summand grows by a factor of at most @xmath374 , but by ( i ) the rest of the summand falls by a factor of at least @xmath1278 .",
    "thus for sufficiently large @xmath49 , each successive term of the sum falls by a factor of at least @xmath1286 .",
    "the result follows by bounding the sum by a geometric series , since @xmath1287 .",
    "@xmath246    [ ineq : exact : q=3:claim5 ] let @xmath5 , @xmath4 , @xmath374 , and @xmath1288 be positive integers , with @xmath10 and @xmath1289 .",
    "let @xmath697 be the largest integer that satisfies @xmath1021",
    ". then @xmath1290 .    *",
    "proof . * the inequality for @xmath697 rearranges to @xmath1291",
    ", so the quadratic formula implies that @xmath697 is precisely @xmath1292 .",
    "similarly , the inequality for @xmath1288 rearranges to @xmath1293 , so the quadratic formula implies that @xmath1294 .",
    "therefore , @xmath1295 since the function @xmath1296 is concave and we assumed @xmath1297 , this final bound is largest when @xmath1298 .",
    "therefore , @xmath1299 , which gives the claimed result .",
    "[ lem : turan - number - colorings ] the number of @xmath1-colorings of the turn graph @xmath80 is exactly @xmath1300 $ ] , where @xmath697 and @xmath33 are defined by @xmath1166 with @xmath1167 .",
    "* proof . *",
    "the complete @xmath441-partite graph @xmath80 has @xmath33 parts of size @xmath1301 and @xmath1302 parts of size @xmath697 , and any @xmath1-coloring must use different colors on each part .",
    "the number of @xmath1-colorings that use exactly one color on each part is exactly @xmath1303 .",
    "all other colorings use 2 colors on one part , and one color on each of the other parts .",
    "there are @xmath1304 ways to choose which two colors are paired .",
    "if the pair of colors is used on one of the @xmath33 parts of size @xmath1301 , then there are @xmath1305 ways to color that part with exactly 2 colors , followed by @xmath1306 ways to choose which color goes to each of the remaining parts . otherwise ,",
    "if the pair of colors appears on one of the @xmath1302 parts of size @xmath697 , then there @xmath1307 colorings of this form . therefore , the number of @xmath1-colorings of @xmath80 is exactly @xmath1308     \\ \\ = \\ \\   q",
    "! \\cdot \\left",
    "[ ( q-1+r)2^{s-1 } - q + 2 \\right],\\ ] ] as claimed . @xmath246    [ ineq : exact : turan : routine ] fix any @xmath6 . for all sufficiently large @xmath4 ,",
    "the number of @xmath1-colorings of the turn graph @xmath80 is strictly greater than @xmath1309       + 2 { q \\choose 2}},\\ ] ] where @xmath177 is the difference between the number of edges of @xmath80 and @xmath1310 .",
    "* proof . * divide @xmath4 by @xmath376 , so that @xmath1311 with @xmath1167 .",
    "then @xmath80 has exactly @xmath33 parts of size @xmath1301 and @xmath1302 parts of size @xmath697 , and @xmath1310 is obtained by deleting one vertex per part . each deleted vertex in a part of size @xmath1301 had degree @xmath1312 , while each deleted vertex in a part of size @xmath697 had degree @xmath1020 .",
    "thus , the number of deleted edges is @xmath1313 , where we had to subtract the double - counted edges of the @xmath1119 induced by the set of deleted vertices . substituting this into and using @xmath1314 to simplify the expression ,",
    "we obtain : @xmath1315       + 2 { q \\choose 2 } }    & = & q !",
    "\\cdot 2^{(q-1)(n - q ) } \\cdot 2^ {      -\\frac{q}{q-1 } \\left [ r(n - s-1 ) + ( q-1-r)(n - s ) \\right ]       + 2 { q \\choose 2 } } \\\\    & = &    q !",
    "\\cdot 2^s \\cdot 2^{\\frac{r}{q-1}}.\\end{aligned}\\ ] ] it remains to show that this is strictly less than the number of colorings of @xmath80 , which lemma [ lem : turan - number - colorings ] calculated to be @xmath1316 = ( 1-o(1 ) ) \\cdot q !",
    "\\cdot 2^s \\cdot \\frac{q-1+r}{2}$ ] . here",
    ", the @xmath54 term tends to zero as @xmath4 grows ( and @xmath1317 grows ) . recall that @xmath1167 , so when @xmath1318 and @xmath6 we always have @xmath1319 , giving the desired result . on the other hand , when @xmath1320 , the result follows from @xmath1321 . @xmath246",
    "the next 9 pages contain the complete _ mathematica _ program ( and output ) , solving optimization problem 2 for @xmath490 ."
  ],
  "abstract_text": [
    "<S> let @xmath0 denote the number of proper @xmath1-colorings of a graph @xmath2 . </S>",
    "<S> this function , called the _ chromatic polynomial _ of @xmath2 , was introduced by birkhoff in 1912 , who sought to attack the famous four - color problem by minimizing @xmath3 over all planar graphs @xmath2 . since then , motivated by a variety of applications , much research was done on minimizing or maximizing @xmath0 over various families of graphs .    in this paper , we study an old problem of linial and wilf , to find the graphs with @xmath4 vertices and @xmath5 edges which maximize the number of @xmath1-colorings . we provide the first approach which enables one to solve this problem for many nontrivial ranges of parameters . using our machinery </S>",
    "<S> , we show that for each @xmath6 and sufficiently large @xmath7 where @xmath8 , the extremal graphs are complete bipartite graphs minus the edges of a star , plus isolated vertices . </S>",
    "<S> moreover , for @xmath9 , we establish the structure of optimal graphs for all large @xmath10 , confirming ( in a stronger form ) a conjecture of lazebnik from 1989 . </S>"
  ]
}