{
  "article_text": [
    "cosmological numerical simulations are a powerful tool to investigate the properties of the universe at the largest scales . from galaxy formation to the precise measurement of cosmological parameters , from the propagation of ultra high cosmic rays to the growth of the non - thermal energy components of the intra cluster medium ( e.g. magnetic field , relativistic particles ) ,",
    "cosmological simulations represent an effective complement to theoretical models and observations ( e.g. borgani et al .",
    "2008 ; borgani & kravtsov 2009 and norman 2010 for recent reviews ) . in order to model the evolution of cosmic structures in the most reliable way",
    ", numerical methods must follow the non - linear dynamics of the gas and dark matter ( dm ) assembly across a very large dynamical range ( e.g. from scales of @xmath3 to @xmath4 ) , over the age of the universe .    to accomplish this task ,",
    "a number of finite difference methods have been developed in the past , which can be broadly divided into 2 classes ( e.g. dolag et al .",
    "2008 for a modern review ) .",
    "`` lagrangian '' methods discretize baryon gas by mass , using a finite number of particles , and the equation of fluid - dynamics are solved with the approach of smoothed particle hydrodynamics ( sph , see price 2008 and springel 2010 for recent reviews ) .",
    "further details of the sph method investigated in this project will be discussed in sec.[subsec : sph ] .",
    "contrarily , `` eulerian '' methods discretize space , by dividing the computational domain into regular cells ( with fixed or variable size ) , and the gas - dynamics is evolved by solving cell - to - cell interactions ( e.g. le veque 1990 for a review ) .",
    "a variety of numerical schemes can be applied for the reconstruction of the gas velocity , density , and pressure fields for a given number of neighbors ( e.g. piecewise linear method , colella & glaz 1985 ; piecewise parabolic method , colella & woodward 1984 ) , as well as for the time integration of the fluxes across the cells ( e.g. roe method , powell et al .",
    "1999 ; hll / hlle method , harten et al . 1983 ; hllc method , li 2005 ) .",
    "further details of the grid methods employed in this project will be presented in sections  [ subsec : enzo_cp ] and [ subsec : tvdhydro ] .    despite the enormous progresses made since their first applications ( e.g. peebles 1978 ; efstathiou & eastwood 1981 ; davis et al .",
    "1985 ; efstathiou 1985 ; ) , the mutual convergence of the results of cosmological numerical methods is still matter of debate and research .",
    "this is true also for the most simple physical modeling of large scale structures , where no forces other than gravity and pressure are taken into account .    a few comparison works in the literature ( e.g. kang et al . 1994 , frenk et al.1999 , oshea et al .",
    "2005 , heitmann et al .",
    "2008 ) have provided evidences that most of the relevant quantities involved in large scale structure dynamics are generally reproduced with similar accuracy by most codes on the market .",
    "the general findings suggest that the simplest clustering properties of dm , and their dependencies on assumed cosmological and numerical parameters are fairly well understood ( e.g. heitmann et al . 2008 ) .    a less satisfactory agreement is generally found when",
    "the properties of gas in different methods are compared , even when simple non - radiative numerical setups are considered . in simulations of galaxy clusters , for instance",
    ", the entropy profile , the baryon fraction and the x - ray luminosities are affected by the larger uncertainties among codes reaching differences up to a factor of a few ( e.g. frenk et al .",
    "1999 ; oshea et al . 2005",
    "; voit et al . 2005 ; kravtsov et al . 2005 ; ettori et al . 2006 ; vazza et al .",
    "2010 ) .",
    "more recent works aiming at comparing different numerical methods in more idealized test cases ( e.g. shock tubes , blast waves , halo profile stability , ram pressure stripping of substructure ) produced additional insights in the ways in which the numerical implementations of different codes work ( e.g. agertz et al .",
    "2007 , tasker et al .",
    "2008 , mitchell et al . 2009 ; springel 2010 ; robertson et al . 2010 ; hess & springel 2010 ; merlin et al .",
    "one of the reported key findings is that the effective numerical viscosity acting within each code has a sizable impact on the overall evolution of quantities tightly linked to ram pressure stripping , turbulence and shocks in the gas medium .",
    "cosmological simulations also proved to be important tools to study the acceleration and evolution of cosmic ray particles ( cr ) in the universe , and their connection to the observed statistics of non - thermal emission from galaxy clusters ( e.g. dolag et al .",
    "2008 for a review ) .",
    "several mechanisms related to cluster mergers and to the accretion of matter can act as sources of non - thermal components in the icm .",
    "the most important mechanism during cluster formation is likely diffusive shock acceleration ( dsa ) : the thermal particles in the high - energy tail of the maxwellian distribution function are able to experience multiple scatterings across the shock surface which can be modeled as a diffusion process .",
    "this leads to an exponential gain of energy and an exponential loss of the number of particles which results in a power - law distribution in particle momentum extending into the relativistic regime and giving rise to so - called cosmic rays ( e.g. bell 1978 ; blandford & ostriker 1978 ; drury & vlk 1981 ; see also kang & ryu 2010 and caprioli et al .",
    "2010 for recent reviews ) .",
    "energetic shocks generated by mergers are believed to accelerate supra - thermal electrons from the thermal pool and explain the origin of radio relics ( ensslin et al .",
    "1998 ; rttiger et al . 1999 ; pfrommer et al . 2008 ; pfrommer 2008 ; hoeft & brggen 2007 ; battaglia et al . 2009",
    "; skillman et al .",
    "2011 ) , while high - energy electrons accelerated at these shocks can produce x - rays and gamma - rays via inverse compton scattering off cmb photons ( e.g. , sarazin 1999 ; loeb & waxmann 2000 ; blasi 2001 ; miniati 2003 ; pfrommer et al .",
    "2008 ; pfrommer 2008 ) .",
    "relativistic hadrons accelerated at shocks can be advected in galaxy clusters and efficiently accumulated there ( vlk , aharonian , & breitschwerdt 1996 ; berezinsky , blasi , & ptuskin 1997 ) , possibly leading to a sizable non - thermal component which could be detected by gamma - ray observations ( e.g. , pfrommer & ensslin 2004 ; blasi , gabici & brunetti 2007 ; pfrommer et al .",
    "2007 ; pfrommer 2008 ; pinzke & pfrommer 2011 ) . the re - acceleration of relativistic electrons by mhd turbulence can be responsible for the episodic diffuse radio emission observed in the form of radio halos ( e.g. , petrosian & bykov 2008 ; brunetti et al . 2008 ; brunetti & lazarian 2011 ) ; in addition secondary particles injected in the icm via proton  proton collisions may also produce detectable synchrotron radiation ( e.g. , blasi & colafrancesco 1999 ; dolag & enssil 2000 ; miniati et al .",
    "2001 ; pfrommer et al .",
    "2008 ; enlin et al.2011 ) .",
    "the occurrence of shock waves in large scale structures has been studied in detail with cosmological numerical simulations ( e.g. , miniati et al .",
    "2001 ; ryu et al .",
    "2003 ; pfrommer et al . 2006 ; pfrommer et al . 2007 ; kang et al .",
    "2007 ; hoeft et al . 2008",
    "; skillman et al . 2008 ; vazza , brunetti & gheller 2009 ; molnar et al.2009 ) or indirectly by the action of shock waves on radio plasma bubbles , employing a novel method of combining radio observations and analytical insight that is supported by idealized hydrodynamic simulations ( e.g. , enlin et al .",
    "2001 ; pfrommer & jones 2011 ) .",
    "most of these numerical works agree on the fact that the bulk of the energy in the universe is dissipated at relatively weak shocks , @xmath5 ( where @xmath6 is the mach number ) , internal to clusters , while strong and larger shocks are found outside of large scale structures , @xmath7 , at the boundary layers between the `` collapsing '' and the `` expanding '' universe .",
    "however when the properties of cr injection by dsa are compared across the different simulations , differences up to @xmath8 orders of magnitude in various quantities are found , including ( but not limited to ) quantities such as the ratio of energies of cr and thermal gas , the spectral energy distribution ( e.g. , miniati et al .",
    "2002 ; ryu et al .",
    "2003 ; pfrommer et al .",
    "2006,2007,2008 ; pfrommer 2008 ; kang et al . 2007",
    "; hoeft et al . 2008 ; vazza et al . 2009,2010 ; skillman et al .",
    "2008,2011 ; pinzke & pfrommer 2011 ) .",
    "this limits our present understanding of the main mechanism for the enrichment of crs in the intra cluster medium .    in this work ,",
    "we explicitly aim at comparing three independent numerical approaches for cosmological simulations , applied to the evolution of a large volume of the universe : the smoothed particle hydrodynamics code gadget ( springel , yoshida & white 2001 ; springel 2005 ) ; the total variation diminishing code developed by d. ryu and collaborators ( ryu et al . 1993 ; ryu et al .",
    "2003 ) and the parabolic piecewise method enzo , developed by g.bryan and collaborators ( e.g. oshea et al .",
    "2004 ; norman et al .",
    "2007 ) .",
    "we adopted a set of shared _ identical _ initial conditions generated at different resolution , and we re - simulated them with the three codes ; the output of all runs were then compared in detail , looking at the convergence of several thermal and non - thermal properties across the various codes and for different numerical resolutions .",
    "we chose the simplest possible physical setup for this project , and include only non - radiative physics ( i.e. , no radiative cooling , no uv radiation background from primordial stars , no magnetic fields , etc . ) .",
    "this approach helps us to understand which differences are due to the numerical methods ( e.g. `` lagrangian '' versus `` eulerian '' method for gas dynamics ) and which are due to the post - processing ( e.g. temperature - based method to detect shocks versus velocity based methods ) .",
    "also , this approach helps in assessing some of the more robust findings of present cosmological simulations , and determines the minimum resolution requirements needed to achieve a good convergence independent of the particular adopted numerical method .",
    "the paper is organized as follows . in sec.[sec : codes ] we give a brief description on the underlying numerical schemes of these codes .",
    "based on the simulations using different resolutions we present a comparison of the general distribution statistics for dark matter and thermal gas in sections [ sec : dm ] and [ sec : thermal ] .",
    "in particular , we focus on the galaxy clusters properties according to the various codes in section [ subsec : clusters_cp ] and present an exploratory test showing important differences between the underlying numerical , hydrodynamical schemes ( specially between ppm and sph ) in the matter accretion pattern inside halos in section [ subsec : tracers ] .",
    "we then apply different shock detecting schemes in section [ subsec : basic ] to the various re - simulations and we present results for the characterization of shock waves in all codes in sections [ subsec : dn_comp][subsec : phas_comp ] .",
    "we particularly focus on shocks in galaxy clusters , their properties and their role in the acceleration of cr predicted according to the different , underlying numerical schemes in section [ subsec : comp_cr_clust ] .",
    "[ tab : tab_cp ]    .details of the simulations run for this comparison project .",
    "first column : name of the run ; second column : initial redshift of the simulation ; third column : mass resolution for dark matter particles ; fourth column : softening length ( for sph runs ) or uniform mesh spacing ( for enzo and tvd ) employed in the runs . [ cols=\"^,^,^,^ \" , ]",
    "enzo is an adaptive mesh refinement ( amr ) cosmological hybrid code originally written by greg bryan and michael norman ( bryan & norman 1997 , 1998 ; oshea et al .",
    "2004 ; norman et al .",
    "it couples a particle - mesh solver with an adaptive mesh method for ideal fluid - dynamics ( berger & colella , 1989 ) .",
    "enzo uses a particle - mesh n - body method ( pm ) to follow the dynamics of collision - less systems .",
    "this method computes trajectories of a representative sample of individual dm particles and it is much more efficient than a direct solution of the boltzmann equation in most astrophysical situations .    dm particles are distributed onto a regular grid using the cloud - in - cell ( cic ) interpolation technique , forming a spatially discretized dm density field . after sampling dark matter density onto the grid and adding baryon density ( calculated in the hydro method of the code ) , the gravitational potential is calculated on the periodic root grid using fast fourier transform algorithms , and finally solving the elliptic poisson s equation .",
    "the effective force resolution of a pm calculation is approximately twice as coarse as the grid spacing at a given level of resolution .",
    "the potential is solved in each grid cell ; however , the quantity of interest , namely the acceleration , is the gradient of the potential , and hence two potential values are required to calculate this .    in the case of enzo simulations employing amr ,",
    "the potential is recursively computed within sub - grids at a higher resolution and the boundary conditions are interpolated from the potential values of the parent grid .",
    "then a multi - grid relaxation technique is adopted to compute the gravitational force for each cell within sub - grids ( e.g. oshea et al .",
    "this enables the use of a gravitational softening of the order of the highest resolution available in the simulation ; however in this project we did not use amr capabilities of enzo , and thus the maximum available softening is the fixed resolution of the adopted mesh .    as hydrodynamical solver , enzo adopts the eulerian piecewise parabolic method ( ppm , woodward & colella , 1984 ) .",
    "the ppm algorithm belongs to a class of schemes in which an accurate representation of flow discontinuities is made possible by building into the numerical method the calculation of the propagation and interaction of non  linear waves .",
    "it is a higher order extension of godunov s shock capturing method ( godunov 1959 ) .",
    "it is at least second  order accurate in space ( up to the fourth  order , in the case of smooth flows and small time - steps ) and second  order accurate in time .",
    "this leads to an optimal treatment of energy conversion processes , to the minimization of errors due to the finite size of the cells of the grid and to a spatial resolution close to the nominal one .    in order to treat more accurately bulk hypersonic motions , where the kinetic energy of the gas can dominate the internal energy by many orders of magnitude , both",
    "the gas internal energy equation and total energy equation are solved everywhere on the grid at all times .",
    "this _ dual energy formulation _ ensures that the method produces the correct entropy jump at strong shocks and also yields accurate pressures and temperatures in cosmological hypersonic flows .",
    "this works uses the public 1.0.1 version of enzo . to simplify the comparison with the other codes of this project , this work employs a fixed grid only instead of the adaptive multilevel grids and additional physics ( e.g. star formation , re - ionization and cooling processes ) which are powerful tools in enzo .",
    "the cosmological code created by ryu et al .",
    "( 1993 ) is based on the harten ( 1983 ) total variation diminishing ( tvd ) scheme .",
    "it is a flux - based eulerian code with second - order accuracy in space and time .",
    "it captures shocks within two to three cells without generating oscillations , but limiting the numerical flux according to the tvd scheme instead of adding a simple artificial viscosity .",
    "several important improvements were made while incorporating the tvd scheme into the cosmological code .",
    "the numerical artificial heating around the extremely supersonic flows where the bulk kinetic energy is much greater than the thermal energy is reduced ; this was achieved by following the adiabatic changes of the thermal energy using a modified -entropy equation instead of using the total energy equation .",
    "the leakage of the gravitational energy into the thermal energy in regions of supersonic flows was prevented by including the effects of the gravitational force only to the momentum and kinetic energy and keeping the thermal energy rather than solving the conservation of the total energy .",
    "also , a correction due to the mass diffusion under the gravitational field has been added in the gravitational force term in order to obtain better conservation of the total energy and to satisfy the cosmic energy equation .",
    "additional details can be found in ryu et al .",
    "( 1993 ) and ryu et al .",
    "( 2003 ) .",
    "the treatment of gravity and dm particle dynamics follows the particle mesh approach on a fixed resolution grid ( see sec.[subsec : enzo_cp ] ) .",
    "additionally , in this code there is the possibility of using a number of dm particles smaller than the total number of cells in the grid , in order to spare memory usage .",
    "this is motivated by the fact that , as stressed in sec.[subsec : enzo_cp ] , in the pm scheme the effective force resolution is approximately twice as coarse as the mesh spacing .",
    "therefore , adopting a number of dm particles which is @xmath9 for a @xmath10 grid , has a very little or negligible difference in the final accuracy of the resulting potential and accelerations .",
    "we compare eulerian methods with the parallel treesph code gadget3 ( springel 2005 ) , which combines smoothed particle hydrodynamics with a hierarchical treepm algorithm for gravitational forces .",
    "sph uses a set of tracer particles to discretize mass elements of the fluid .",
    "continuous fluid quantities are estimated by a kernel interpolation technique ( e.g. monaghan 1992 ) .",
    "the equation of motion for these tracer particles can be derived ( by applying the variational principle ) from the lagrangian of such system .",
    "the thermodynamic state of each fluid element may either be defined in terms of its thermal energy per unit mass , @xmath11 , or in terms of the entropy per unit mass , @xmath12 .",
    "the latter is used as the independent thermodynamic variable evolved in sph , as discussed in full detail by springel & hernquist ( 2002 ) .",
    "the adaptive smoothing lengths @xmath13 of each sph particle are defined such that their kernel volumes contain a constant mass for the estimated density ( e.g. corresponding to the mass of @xmath14 particles is a common choices ) .",
    "accounting for the fact that then the adaptive smoothing lengths @xmath13 are a function of density allows sph to be formulated so that both energy and entropy are manifestly conserved .",
    "provided there are no shocks and no external sources of heat , the derivation of equations for the reversible fluid dynamics in sph is straightforward ( see price 2008 and springel 2010 for recent reviews on sph ) .",
    "however , flows of ideal gases can easily develop discontinuities where entropy must be generated by micro - physics .",
    "such shocks need to be captured by an artificial viscosity in sph , which is active only when fluid elements approach one another in space , preventing particle interpenetration and transforming kinetic energy irreversibly into heat ( e.g. monaghan & gingold 1983 ) .",
    "modern schemes like gadget3 make also use of an artificial viscosity based on an analogy with riemann solutions of compressible gas dynamics , as proposed by monaghan 1997 ; additional viscosity - limiters are also introduced in gadget3 in the presence of strong shear flows to alleviate spurious angular momentum transport ( steinmetz 1996 ) .    both the collision - less dark matter and the gaseous fluid are represented by particles , allowing the self - gravity of both components to be computed with gravitational n - body methods .",
    "gadget3 allows the pure tree algorithm to be replaced by a hybrid method consisting of a synthesis of the particle - mesh method and the tree algorithm , with significant reduction of the computational effort .",
    "the effective force resolution is controlled by the gravitational softening @xmath15 used in the tree part as listed in the last column of table 1 for the different simulations and the particles are allowed to have individual time steps , based on different time stepping criteria ( see springel 2005 for details ) .",
    "we have assumed a `` concordance '' model , with density parameters @xmath16 , @xmath17 , @xmath18 , @xmath19 , hubble parameter @xmath20 , a power spectrum with slope @xmath21 and a normalization of the primordial matter power spectrum @xmath22 .",
    "the @xmath23 parameter is intentionally set to a larger value compared to recent estimate from cmb data ( e.g. spergel et al .",
    "2007 ) in order to enhance the probability of forming massive halos within the simulated volume of side @xmath0 .",
    "any modeling of cooling , radiative and heating processes for the gas component is neglected , and therefore the thermal history of cosmic gas here is mainly driven by shock waves induced by gravity .",
    "table [ tab : tab_cp ] lists the main parameters of all simulations run for the project .",
    "the initial displacements and velocities of dm particles were identical for all codes ; the numbers of dm particles adopted are @xmath24 , @xmath25 , @xmath26 and @xmath27 .",
    "the gadget3 simulations preliminary looked remarkably converged with resolution already at @xmath25 , and therefore we choose to skip the production of the @xmath24 case in sph , in order to spare computational resources time .",
    "the initial redshift of simulations were computed in order to reach the same growth rate at @xmath28 for the smallest available density perturbations : @xmath29 , @xmath30 , @xmath31 and @xmath32 for the different resolutions , respectively .    usually in sph",
    "cosmological runs both the dm and the gas particle distributions are perturbed in their initial positions and velocities according to the zeldovich approximation ( e.g. dolag et al .",
    "2008 for a review ) . in grid runs",
    ", on the other hand , the initial gas distribution is at rest compared to the dm initial velocities . since computing exactly the same initial perturbation in velocity for sph particles and cells is not a trivial issue , for the sake of simplicity in this work we neglected initial perturbations in velocities also for the sph distribution .    in the following",
    "we will refer to a given run according to the number of its gas particles or gas cells ; in the case of the tvd code , the number of dm particles is kept 8 times smaller than the number of gas cells ( see sec.[subsec : tvdhydro ] ) . in what follows",
    ", we will typically refer to `` _ self_convergence '' meaning the convergence of a code with respect to increasing resolution , and to `` _ cross_convergence '' meaning the convergence between different codes , at a given resolution .",
    "a number of works in the literature have shown that present day numerical codes at their best achieve an agreement within @xmath33 per cent on the mass functions of halos ( e.g. frenk et al .",
    "1999 ; oshea et al . 2005 ; heitmann et al .",
    "however , subtle differences in the adopted numerical methods should be responsible for the exact shape of the inner dm profiles ( e.g. bullock et al .",
    "2001 ; warren et al . 2006 ) .",
    "we compared the properties of the dm component for all resolutions and codes in order to ensure that the distribution of dm in our simulated large scale structures is characterized by a similar degree of intrinsic `` scatter '' reported in the literature .",
    "the most important statistics related to dm is the mass function of halos , for which analytical solutions as a function of cosmological parameters are available ( e.g. press & schecter 1974 ; sheth & tormen 1999 ) .",
    "we report in fig .  [",
    "fig : mf1 ] the cumulative mass functions ( dm plus gas ) for all runs in the project .",
    "the virial mass , @xmath34 , is customarily defined as the spherical over - density of gas+dm , enclosing a mean over - density of @xmath35 , where @xmath36 is the critical density of the universe ( e.g. eke et al . 1998 ) .",
    "the virial halo masses are computed using the same halo finder in all codes , based on the gas+dm spherical over - density . in the case of grid runs , the cells distributions",
    "have been converted into a distribution of particles , in order to apply exactly the same procedure used to analyse gadget runs .    in order to compare different codes and resolution ,",
    "it is useful to assign a `` formal '' resolution to each run .",
    "this allows us to understand which halos in our simulations are suitable for `` convergence '' studies and which are not , because of under - sampling problems at a given cluster size .",
    "even if in gadget runs the mass functions are resolved down to the smallest halos ( with @xmath37 particles ) , power et al .",
    "( 2003 ) showed that convergence in the inner dynamical structures of halos is achieved with at least @xmath38 particles inside @xmath39 , may required to achieve a good convergence in the x - ray luminosities of clusters ( e.g. valdarnini , ghizzardi & bonometto 1999 ; valdarnini 2002 ) . ] .",
    "we preliminary consider that the resolution limit in gadget is achieved with 500 dm particles within the virial radius . for grid runs , we apply the following empirical approach : we consider only halos whose virial radius is resolved with at least 500 cells , and we assign a _",
    "formal _ minimum mass to have halos `` suitable for convergence '' taking the corresponding virial mass , extracted from the theoretical @xmath39 versus @xmath34 relation .",
    "the corresponding minimum masses for all codes and resolutions are shown as vertical lines in fig .",
    "[ fig : mf1 ] .",
    "although this methods is rather artificial , we find it predicts rather well the convergence observed for halos in grid codes , which takes place at larger masses compared to corresponding gadget runs at the same dm mass resolution .",
    "for instance , gadget run 256 shows a halos mass function which is converged down to masses of @xmath40 , while run 256 in enzo and tvd achieve convergence only for halos with masses larger than @xmath41 .",
    "therefore , we would expect to see cross - convergence of the virial parameter for none but the largest halos in grid results , while we expect good self - convergence across a larger range of masses in gadget .",
    "a similar trend is also observed in the baryon fraction of halos in the various run , as reported in fig .",
    "[ fig : bf ] .",
    "the baryon fraction in gadget is rather perfectly converged at all resolutions for @xmath42 , with a value of @xmath43 , where @xmath44 is the cosmic baryon fraction in our runs ) . in grid codes",
    ", the convergence to a slightly larger baryon fraction , @xmath45 , seems to be reached only for masses larger than @xmath46 ( as for the halos mass functions , enzo shows the a slower rate of convergence compared to tvd ) .",
    "the radial profiles of dm mass density for the most massive galaxy cluster in our sample are shown in fig .",
    "[ fig : dm_profile ] for various resolutions .",
    "all profiles in gadget3 runs are remarkably self converged , while the profiles of dm in both grid methods present a slower rate of convergence . at the best available resolution , the grid codes agree at the percent level with the reference profile of gadget3 runs , with sizable differences only in the core region of the cluster , @xmath47 , due to the well known lack of force resolution in the pm method ( the softening length for the gravity force in the @xmath24 runs is @xmath48 ) .",
    "overall , the trend found are in line with those reported by oshea et al .",
    "( 2005 ) and heitmann et al .",
    "( 2008 ) . based on our results",
    ", we suggest that the representation of the underlying dm distribution is similar to what can be found in the recent literature , and that the bulk of differences that will be reported in the next sections are mostly connected with a different modeling of hydrodynamics in the various methods .",
    "in the following sections we compare the distributions of several gas thermodynamical variables in all runs as a function of numerical resolution . the final goal is to identify which are the cosmic environments and minimum resolution requirements necessary to achieve a good convergence in the estimates provided by the different methods .",
    "a preliminary inspection of the morphological distribution of baryon gas in the cosmic structures captured by all methods ensure that at a zero order all simulations correctly sample a cosmological volume with identical density fluctuations . in figure  [ fig:1d_line ]",
    "we report the one - dimensional behavior of gas density and gas temperature along a line crossing the position of the most massive galaxy cluster in the volume , for all @xmath25 runs .",
    "the spatial distribution of gas density is well matched in all codes , and in particular the positions of the gas density peaks associated with halos and filaments agree within a @xmath8 cells accuracy ( i.e. @xmath49 at this resolution ) .",
    "the one - dimensional gas temperature profiles show very similar maxima near the gas density peaks , but sizable differences can be found in the outer regions .",
    "the bulk of the difference here is however a simple effect of the variable smoothing length in gadget3 , which provide a coarser resolution compared to grid codes for the regions outside of clusters .    in the panels in fig .",
    "[ fig : maps ] we report the maps of projected mass - weighted temperature across the simulated volume , for the most resolved runs of the project ( run 256 for gadget3 and runs 512 for enzo and tvd ) .",
    "the trend with resolution of the projected mass - weighted temperature , at all resolutions , is reported in fig .",
    "[ fig : maps_zoom ] for a sub - volume of @xmath50 inside the cosmological box .    to readily compare lagrangian and eulerian data at the same spatial resolution",
    ", the gas fields of gadget3 runs have been interpolated onto a regular grid , with resolution equal to that of the corresponding grid runs , using the same sph kernel employed during the simulation for each gas particle .    in gadget3 , over dense non - linear structures ( e.g. halos and sub - halos )",
    "are very similarly reconstructed at all resolutions , while structures at about the critical density ( e.g. cosmic filament ) start being resolved only at sufficiently high dm mass resolution .",
    "the opposite trend appear in grid codes , where large scale patterns are soon reconstructed at all resolutions , while a clear modeling of the smaller halos and cluster satellites is achieved only approaching the highest available resolutions .",
    "and grid runs with @xmath24.,title=\"fig:\",scaledwidth=49.0%,scaledwidth=35.0% ]   and grid runs with @xmath24.,title=\"fig:\",scaledwidth=49.0%,scaledwidth=35.0% ]      a quantitative analysis of the differences between the codes is performed by studying the volume - weighted distribution functions of gas density and gas temperature at increasing resolution , as shown in fig .",
    "[ fig : res_pdf ] . figure [ fig : all_pdf ] further shows the cross - comparison between the highest resolution runs available for each code .    in this case",
    ", we adopt volume - weighted statistics for each bin in gas density / temperature .",
    "despite the obvious fact that volume - weighted distributions can not be translated into observable quantities ( since the convolution of the two does not provide the total gas energy within the simulated volume ) we find this approach useful to focus on the properties of the low density , volume - filling baryon gas around large scale structures .",
    "our purpose here is to highlight the differences in the modeling of the lower density baryon gas at large scales ( which encompasses filaments and clusters of galaxies ) in the different numerical methods .",
    "this can also be readily compared with the early comparison work of kang et al .",
    "in addition , these volume filling regions are expected to be an important site of acceleration of relativistic particles , via direct shock acceleration at strong shocks ( e.g. miniati et al .",
    "2001 ; ryu et al .",
    "2003 ; pfrommer et al .",
    "2006 ; vazza , brunetti & gheller 2009 ) .    in the following section ( sect .  [ subsec : clusters_cp ] ) we will rather refer to mass - weighted profiles of gas density and gas temperature , since they are closely related to the thermalization properties of internal merger shocks inside clusters .",
    "as expected , the cross  convergence between different codes is more satisfactory when resolution is increased : the density distributions runs with @xmath51 dm particles ( i.e. with @xmath52 ) , have the same average value in all codes within a @xmath53 per cent scatter .",
    "the largest and the smallest gas densities are similar within a factor of @xmath54 , and gadget3 produces the most extreme values in both cases .",
    "gadget3 runs are also the ones which provide the largest degree of self - convergence , with very similar outputs at all investigated resolutions .    in the case of temperature distributions , enzo presents the larger degree of self - convergence ( within a factor of @xmath55 per cent ) at all resolutions , while the other codes show significant evolution with resolution , especially at temperatures below @xmath56 .",
    "we note that different floors in the value of temperature were adopted in the three codes , to limit the lowest temperature available to cells / particles of the simulated volume . for each code",
    "we used the temperature floor usually adopted by each simulator : a minimum temperature of @xmath57 in allowed in enzo , @xmath58 in tvd and @xmath59 in gadget3 .",
    "this explains the different piling of cells / particles in the temperature distributions below @xmath60 ; we also made sure that the adoption of different floor in temperature does not affect in any way the temperature distribution above the adopted @xmath61 ( e.g. vazza , brunetti & gheller 2009 ) .",
    "therefore the analysis of the temperature distribution we present here is meant to pinpoint the numerical problems of the various methods , while the differences between runs employing re - ionization would be much smaller . ] .",
    "on the other hand , the temperature distributions found in the simulations become quite similar for @xmath62 , which would correspond to the typical virial temperatures of collapsed halos ; this is in line with the early findings reported by kang et al .",
    "( 1994 ) , and later by oshea et al .",
    "( 2005 ) .",
    "we conclude that even if the gas mass distribution within halos is rather convergent in all codes for ( for a dm mass resolution of @xmath52 ) , the convergence in the gas temperature distribution is generally not yet reached , and the cross - convergence between codes is not achieved for all regions where @xmath63 , for the resolutions investigated in this project .    in these regimes , some amount of spurious numerical heating can be expected due to the graininess of dm mass distributions , which makes two - body heating a likely channel of ( un - physical ) energy transfer from the dm particles to the baryon gas ( steinmetz & white 1997 ) . the effect of two - body heating is expected to decrease with the number of dm particles in the simulation , so the trend with resolution in all codes qualitatively suggests that at least part of the different temperature below @xmath64 is related to this effect .",
    "however , the evolution of gas temperature with resolution in enzo runs is extremely small compared to all other codes .",
    "interestingly , a similar trend was noticed by oshea et al .",
    "( 2005 ) , by comparing the temperature distributions obtained with gadget2 and enzo ( both using the ppm version of the code , or its formulation with artificial viscosity , i.e. enzo - zeus ) .",
    "the authors suggested that the reported trend were consistent with an increasing action of the effective viscosity employed in the hydro solver of the three codes , going from enzo - ppm to enzo - zeus to gadget2 .",
    "this explanation is also likely in our case ; we will come to this point again in sect .",
    "[ subsec : phas_comp ] , in connection with the study of phase diagrams for the shocked cells / particles in the various runs .",
    "differently from the case of gas density and gas temperature distributions in the whole simulated volume , for which large statistics is available , our setup does not allow us to study the convergence with resolution of cluster statistics for a large number of objects .",
    "given the minimum requirement of mass and spatial resolutions outlined in the previous sections , we must expect that only a few galaxy clusters in our @xmath65 box are sampled with enough particle / cells to allow the monitoring of thermodynamical distributions inside the virial radius , being free from resolution effects , namely the two most massive clusters within the sample :    * cluster a : a system of total mass @xmath66 and @xmath67 , in a fairly relaxed dynamical stage ; * cluster b : a system of total mass @xmath68 and @xmath69 , in an ongoing merger phase .",
    "we preliminary checked that the total masses at all resolutions and in all codes are in agreement within a @xmath70 per cent level within @xmath39 , so that the general parameters defining the systems are nearly identical in all investigated resolutions .",
    "however , we still have a minor source of scatter in the detailed comparison of data , given by the fact that the different codes adopt different time stepping criteria , and even if the cosmic time of the outputting of data is formally the same , tiny differences of the order of a few @xmath71 can be expected in the data .",
    "this is expected to be problem only for the comparison of small scales in the cluster profiles , for which a perfect synchronization is impossible .",
    "this is issue is particularly relevant for the cluster merger b : at @xmath28 the exact positions of the thermal features linked to the merger event are spread at different distances from the cluster center , as an effect of tiny differences in the internal timings of the codes . in the case of the relaxed cluster",
    "a , the spatial locations of sub - clumps is much more similar in all codes .    in fig .",
    "[ fig : prof_cpa ] ( upper panels ) we show the mass - weighted profiles of mass density , temperature and of the gas mass clumping factor , @xmath72 , for cluster a at @xmath28 .",
    "we define here the mass density profile as @xmath73 , where @xmath74 is the mass associated to each particle / cell in the simulation , and @xmath75 is the volume of each radial shell along the radius .",
    "the profile thus defined is independent of the differences in the properties of clumping within each shell , and allows us to investigate how the matter is distributed in the the different simulations .",
    "the computation of the clumping factor then provides the complementary information about the distribution function of gas matter within each radial shell .    in this case",
    ", the weighting by gas mass ensures that the profiles are closely related to the thermal energy of the gas inside clusters , which in turn depends on the statistics of energetic and low mach number internal shocks ( see also sect .",
    "[ sec : shocks ] ) .",
    "the profiles of density and temperature converge with resolution rather steadily , with an agreement better than a @xmath76 per cent between the profiles at all radii , when different resolution are compared .",
    "this is reassuring , since the combination of the above profiles gives the profiles of the thermal energy distribution within the clusters , and this is a rather well converged finding in all codes . on the other hand",
    "the profiles of the gas clumping factor shows a much slower convergence even within each code , with sizable evolution at all radii from the cluster center . in",
    "all runs the clumping factor increases with radius , and reaches @xmath77 outside of @xmath39 . at the best available resolutions the self - convergence between for each code is yet to be reached , despite the fact that the profile of gas matter density is much better behaved .    in figure",
    "[ fig : prof_entr ] we report the volume weighted profiles of the entropic function ( @xmath78 ) for each particle / cell , for all codes and resolution .",
    "the weighting by the volume here is chosen to focus more on the trend of the entropy associated with the smooth , volume filling accretion around clusters .",
    "compared to the more standard `` entropy '' profile , based on the ratio between temperature and @xmath79 profiles , we consider the profile of the entropic function more useful to characterize the tiny differences of entropy which could be very locally associated with different dynamical accretion pattern in the different codes .",
    "the study of mass - weighted entropy distributions in a smaller re - simulation of this project will be discussed in sect .",
    "[ subsec : tracers ] , where we investigated the entropy generation associated with the clumps of matter in clusters . in this case , gadget3 runs are those characterized by the slowest resolution compared to grid methods , and they also present a peak of the entropy gradient at a significant larger distance compared to tvd and enzo runs .",
    "we also report the interesting trend that , compared to grid methods , the increase in spatial resolution causes a significant smoothing of the entropy jump in gadget3 clusters ( see fig .  [",
    "fig : prof_cpa_cfr ] ) . at the best available resolution ,",
    "the full - width - half - maximum of the entropy `` jump '' in grid methods is significantly smaller than in gadget3 ( @xmath80 in tvd and enzo versus @xmath81 in gadget3 ) . to check",
    "if differences in the clumping of gas matter is responsible for the above differences , we also computed the profiles for the 256 gadget3 run by considering only the 50 per cent less dense particles ( fig .",
    "[ fig : prof_cpa_cfr ] ) , but no significant differences can be found .",
    "this difference in gadget3 can only be partially explained by sph smoothing effects , since the observed broadening is considerably larger than the smoothing length at these over densities .",
    "the dynamics of shock waves on large scale accretion pattern around clusters are however expected to play the major role here : we will further explore this issue in sect .",
    "[ sec : shocks ] .",
    "a second interesting feature of entropy profiles is the hint of a flattening of the entropy profile at @xmath82 in clusters simulated with enzo compared to gadget3 runs .",
    "this is in line with a number of existing results in the literature ( e.g. frenk et al .",
    "1999 ; wadsley et al .",
    "2008 ; tasker et al .",
    "2008 ; mitchell et al .",
    "2009 ) , even if the grid resolution here is too coarse to show conclusive evidence .",
    "however , tests employing efficient adaptive mesh refinement with enzo have recently shown that that the extreme flatness of the entropy profile in these cluster runs inside @xmath83 is a very robust feature against numerical and mass / spatial resolution effects ( vazza 2011 ) .",
    "based on the literature , it seems likely that the differences in the inner entropy profiles are produced by the different integrated mixing role played by artificial viscosity which is enhanced in grid codes compared to sph ( e.g. wadsley et al .",
    "2008 ; mitchell et al .",
    "2009 ) . with our setup",
    "we tested in detail the way in which entropy is advected inside clusters in enzo and gadget with a further re - simulation , discussed in the section below ( sec.[subsec : tracers ] .    on the other hand , it is very likely that the leading mechanism which sets the shape of the entropy distribution beyond @xmath39 is the action of shock waves .",
    "gravitationally induced motions of gas matter are the leading drivers of shock waves in these simulations , and therefore a detailed analysis of the distribution of gas matter in the outer shells of simulated clusters is helpful to understand the reported differences . while we defer to sect .",
    "[ sec : shocks ] a detailed study of the morphologies and statistics of accretion shock around clusters , while here we study in detail the simple gas matter distribution in the outer cluster regions , comparing different codes and resolutions .",
    "the panels in fig .",
    "[ fig : distr_clump1 ] present the mass - weighted and volume - weighted distribution of gas matter within the radial shell @xmath84 outside of cluster a , for the same runs of previous figures .",
    "as expected , the volume weighted distributions show that the grid codes are able to resolve more structures ( e.g. smooth filaments of gas ) in the low density regions ; on the other hand it can be seen in the mass weighted distributions that gadget3 resolves much more collapsed objects , which are absent in the grid codes .",
    "this corresponds to the larger number of gas clumps that can be visually seen in the projected maps of fig .",
    "[ fig : maps_zoom ] .",
    "however , such material in grid codes produces also an excess of baryon gas in the range @xmath85 , compared to gadget3 .",
    "these two excesses in grid codes and in sph produce signals of a similar order , which explains why the average clumping factors reported in fig .",
    "[ fig : prof_cpa ] are quite similar , despite the fact that the differential distribution have rather different shapes .",
    "the differential distribution of gas matter in the outer shells provide a preliminary suggestion that the shock waves associated with these accretions can be significantly different in the two methods .",
    "indeed , a larger contribution from stronger shocks ( driven by `` smooth '' , rather than `` clumpy '' accretions ) should be expected on average in grid codes , at the same radius .",
    "the larger entropy jumps associated with these strong shocks around smooth accretions may then well explain the differences of shape in the outer entropy profiles of cluster a and cluster b. for recent works employing higher spatial and mass resolution to characterize in detail the clumping and azimuthal scatter properties of gas matter in the outer region of galaxy clusters , we address the reader to roncarelli et al .",
    "( 2006 ) , burns et al .",
    "( 2010 ) , vazza et al .",
    "( 2011 ) and nagai et al .",
    "the issue of matter clumping in the outskirts of galaxy clusters has also recently become a topic available to x - ray observations ( e.g. simionescu et al .",
    "2011 ; urban et al .",
    "2011 ) , and therefore the predictions of different numerical methods , even at @xmath86 , are going to be likely tested with observations in the next future .                              in order to analyze in a more conclusive way the differences in the entropy profiles of cluster , we performed a re - simulation study which followed in detail how the entropy of gas is build inside one massive clusters during its evolution .    to this goal we simulated a smaller volume of side @xmath87 ,",
    "whose initial conditions were produced in a similar way as in sec.[sec : sim ] ; in this case an even larger normalization for the matter power spectrum parameter were used , @xmath88 , in order to form a @xmath89 cluster inside this small volume box , at different resolutions , can be found at this url : http://canopus.cnu.ac.kr / shocks / case1/. ] .    since the entropy profiles of grid codes were found to be very similar , for simplicity we tested here only the and enzo run with @xmath25 cells ( corresponding to a spatial resolution of @xmath90 with a gadget3 run with @xmath25 gas particles .",
    "we are interested in the evolution of gas entropy linked to the matter accretion history of the cluster , and we identified all gas sub - halos in place at @xmath91 outside of the main cluster in the volume , and we followed their evolution in time .",
    "the location of their centers ( based on a spherical over - density halo finder ) is in agreement in both simulations within a @xmath92 accuracy .",
    "we selected all particles belonging to the 3 sub - halos in gadget3 runs , while ( mass - less ) tracer particles were placed inside the corresponding cells in enzo run .",
    "the distribution of tracers was generated using an number density profile corresponding to a king profile , using a sampling of @xmath93 of the cell size .",
    "we checked that the final tracers distributions are statistical independent of the particular profile adopted for the initial generation ( see also vazza , gheller & brunetti 2010 ) .",
    "the gas tracers in enzo were then evolved by updating their positions according to the underlying eulerian velocity field , with the same procedure of vazza , gheller & brunetti ( 2010 ) . in summary ,",
    "the three - dimensional velocity field was interpolated at the location of tracers using a cloud in cell kernel , and the positions were updated every 2 time steps of the simulation with a first - order integration .",
    "the entropy assigned to the tracers at each time step corresponds to the entropy of the cells where each tracer sits at the time of observation .",
    "the visual inspection of projected tracers / sph particles positions as a function of redshifts ( fig .",
    "[ fig : trac_maps ] ) clearly shows that the accretion of gas clumps is a different process in the two runs .",
    "even if the initial positions of the clumps centres are equal down to the cell resolution , soon after their accretion through @xmath39 their trajectories differ considerably : the particles from sub - halos in gadget3 soon mix with the main cluster atmosphere after accretion , and most of the particles from sub - halos end up in the dense and low - entropy cluster core . in enzo the tracers mix more slowly at the beginning , and most of accreted gas component is bound to the infalling clumps even after the crossing @xmath39 . in particular , most of tracers initially located in two clumps ( colored in blue and in gray ) never penetrate inside the core of the main cluster , but find their selves settling at larger cluster radii , @xmath94 .",
    "the analysis of the entropy profiles of the main cluster and of sph particles / tracers is presented in fig .",
    "[ fig : trac_entr ] , and confirm the difference in the accretion history of the two methods . in this case , since we are interested in the evolution of gas clumps , the weighting by gas density of the entropic function is adopted here .    in gadget3",
    ", only a fraction of the matter from clumps is shock heated to higher entropy , and the un - shocked low entropy material can be delivered to the low entropy center of the main cluster , where it remains until the end of the simulation . already at @xmath95 ( @xmath96 gyr after their accretion inside @xmath39 ) the entropy of sph particles from sub - halos is nearly identical to the entropy of the main cluster . on the other hand in enzo",
    "run the gas from clumps is soon shock heated to higher entropy values ( compared to particles in sub - halos in gadget3 ) , and it retains its entropy for a larger time , placing on average on radii external to the cluster core . in the enzo run",
    ", there is still a relevant scatter in the entropy of tracers at @xmath97 , compared to the main profile of the cluster , which is very different from gadget3 results .",
    "our results suggest that the following different mechanisms are at work in the two methods : a ) in sph , accreted clumps soon loose their gas because of the interaction with the icm of the main cluster , the entropy of their gas gets quickly in an equilibrium with the atmosphere of the host cluster and many particle from the sub - halos can end up within the low entropy core of the main cluster ; b ) in ppm , accreted clumps are efficiently shock heated while entering the atmosphere of the main cluster , they reach more slowly an equilibrium with the average entropy of the main cluster atmosphere and most of the accreted material sets to an higher adiabat in the cluster profile ( compared to the sph run ) , avoid to concentrate within the cluster core .    in both cases ,",
    "we observe that the shock heating and mixing motions following the matter accretions from small satellites ( i.e. minor mergers ) are not efficient processes in changing the overall shape of the entropy profile within the main cluster , which is already in place at @xmath98 .",
    "on the other hand , we can speculate that the different trajectories and thermodynamical evolution of the gas matter accreted by sub - clumps in the two methods highlights the sizable differences of transport phenomena in the two schemes , which are relevant to many astrophysical topics in galaxy clusters ( e.g. metal enrichment , cosmic ray transport , non - thermal emissions ) .",
    "since we do not make use of adaptive mesh refinement in enzo simulations here , the spatial resolution is too poor to study fluid instabilities and cluster turbulence ( for studies of tracers in high resolution enzo runs with adaptive mesh refinement , see vazza , gheller & brunetti 2010 and vazza 2011 ) .",
    "however we notice that at this point it is clear that the flatness of inner cluster entropy profile generally found in ppm codes is not a product of employing amr itself , but it is a more fundamental feature linked to shocks and mixing inside clusters",
    ".    in their seminal work mitchell et al .",
    "( 2009 ) investigated the production of cluster entropy in a binary clusters merger with gadget and the ppm code flash ( fryxell et al .",
    "1998 ) , and found that the most important factor which produces the differences seen in the two numerical methods is the early mixing of entropy during the collision of cluster cores , driven by fluid instabilities , which is much more pronounced in ppm than in sph .",
    "our test here shows that the way in which fluid instabilities and shocks follow the accretion of smaller subunits of cluster also differ in the two approaches , and lead to dissimilar entropy tracks for the accreted gas .                .",
    "[ fig : histo_shocks ]",
    "many of the differences previously found between the codes , such as the temperature structures in low density environments and entropy distributions in the innermost and in the outer regions of clusters , are likely connected to the dynamics of matter accretion processes in the accretion regions of large scale structures . in these regions ,",
    "the activity of strong shock waves is the leading driver of thermalization , entropy generation and possibly of cosmic ray acceleration in large scale structures , ( e.g. ryu et al . 2003 ) , via the diffusive shock acceleration mechanism ( e.g. blandford & ostriker 1978 ) .",
    "the numerical modeling of shock waves is among the most important tasks that cosmological codes must correctly perform in run - time ; several different numerical techniques , involving the use of ad - hoc numerical viscosity ( as in sph ) or the solution of the riemann problem through explicit methods ( as in ppm or tvd ) , have been adopted for this task ( e.g. dolag et al .",
    "2008 for a review ) .",
    "all these methods generally perform well in the case of rather simple shock problem ( e.g. tasker et al .",
    "2008 ) , while their performances in the very complex environment of large scale structure simulations are more uncertain . to date , no detailed comparison of the statistics of shocks developed in the various numerical method have ever been published ; our sample of runs thus offers the optimal framework to test the outcomes of the different methods in the cosmic volume .    in order to readily compare the statistics of shocks in each simulations",
    ", a shock finding method is needed to detect and measure the strength of shocks in the simulations . to this end",
    "we start by presenting the shock detecting method explicitly developed to work on each specific code in our project .      the rankine ",
    "hugoniot jump conditions allows one to evaluate the shock mach number , @xmath6 , from the thermodynamical state of the pre - shock and post - shock regions ( under the assumption of a pre - shock medium at rest and in thermal and pressure equilibrium ) .",
    "if the adiabatic index is set to @xmath99 one has the well known relations ( e.g. landau & lifshitz 1966 ) :    @xmath100    @xmath101    and    @xmath102    with indices @xmath103 referring to pre and post  shock quantities , respectively , and where the entropy @xmath104 is @xmath78 .    in practice measuring @xmath6 of shocks in cosmological simulations",
    "is more problematic than in this ideal case : matter falling in the potential wells drives chaotic motions and the temperature distribution around shocks is usually patchy due to the continuous accretion of cold clumps and filaments into hot halos .",
    "these complex behaviors establish complex pattern of pre - shocks velocity , temperature and density fluctuations which makes problematic to measure ranking - hugoniot jumps in a clean way . to overcome this problem ,",
    "detailed analysis strategies have been conceived over the last years , with the goal of recovering the measure of @xmath6 in fully cosmological simulations in the most accurate way .",
    "the analysis of jumps in temperature is a powerful way of measuring the strength of shocks in eulerian cosmological simulations , and its application was first discussed in miniati et al .",
    "( 2001 ) , with a more sophisticated formulation in ryu et al .",
    "the cells hosting a possible shock pattern are preliminarily tagged by two conditions :    * @xmath105 ; * @xmath106 .",
    "the additional condition on the strength of the temperature gradient across cells is also customary requested :    * @xmath107 ;    ( specifically @xmath107 filters out shocks with a mach number @xmath108 , ryu et al .",
    "2003 ) .",
    "it is customary to simplify the process of identification of shocked cells by using a one  dimensional procedure applied successively in three orthogonal directions . in the case of multiple shocked cells in close contact , the center of shocks , which can be spread across 23 zones ,",
    "is placed where @xmath109 is minimum .",
    "then the mach number is calculated based on eq  .[eq : temp ] , where @xmath110 and @xmath111 are the post and pre  shock temperature across the shock region . in the following sections",
    ", we will refer to this method as to the _ tj _ method .    in this work",
    ", we applied the tj method following the original formulation of ryu et al .",
    "( 2003 ) , with the exception that we do not employ the temperature floor of @xmath112 customarily used to mimic the effect of re - ionization , in order to readily compare with the outcomes of the other simulations of the project .",
    "a similar approach , based on the post - processing analysis of velocity jumps across cells in grid simulations was proposed in vazza , brunetti & gheller ( 2009 ) for the analysis of enzo simulations .",
    "conservation of momentum in the reference frame of the shock yields :    @xmath113    with the same notation used in eqs.[eq : dens][eq : entropy ] . in the ideal case",
    "in which the pre - shocked medium is at rest and in thermal and pressure equilibrium , the passage of a shock with velocity @xmath114 leaves a @xmath115 in - print as a velocity difference between the shocked and pre  shocked cells . in the lab frame a relation holds between @xmath115 and @xmath6 , which can be obtained by combining eqn .",
    "[ eq : momentum ] with eqn .",
    "[ eq : dens ] :    @xmath116    where @xmath117 and @xmath118 is the sound velocity computed in the pre  shocked cell .",
    "the procedure to identify shocks in 3d with the vj method follows these steps :    * candidate shocked cells are selected as @xmath106 ( calculated as 3dimensional velocity divergence ) ; * if more candidate shocked cells are found together , the one with the minimum @xmath109 is considered as the shock center ; * the three cartesian axes are scanned with 1d sweeps and @xmath119 jumps along the axis of scan are measured , between cells located at a @xmath120 distance on opposite side of the shock center . in enzo ppm we can safely use @xmath121 , therefore @xmath6 is measured across 3 cells ( e.g. vazza , brunetti & gheller 2009 for a detailed discussion ) . * the sound speed is taken from the cell in the tagged patch which shows the lower temperature , and based on this the mach number along each direction is computed from eqn .",
    "[ eq : mach_v ] ; * we finally reconstruct the 3-d mach number in the shocked cell with @xmath122 .    in the following we refer to this procedure as the velocity jump ( vj ) method .",
    "vazza , brunetti & gheller ( 2009 ) reported overall consistency between vj and tj method in enzo simulations with fixed grid resolution , with minor differences in the most rarefied environments .",
    "in vazza et al .",
    "( 2009 ) and vazza et al .",
    "( 2010 ) the application of the vj method is extended to enzo runs with adaptive mesh refinement .",
    "the application of a qualitatively similar method , working on the velocity field of sph particles in gadget3 simulations , has also been presented by hoeft et al .",
    "a method to measure the mach number of gas flows in gadget runs was presented in pfrommer et al .",
    "( 2006 ) . in this method ,",
    "a run - time algorithm monitors in run - time the evolution of entropy for each particles , and from the entropy jump ( in time ) the mach number of the shock can be inferred .",
    "the instantaneous injection rate of the entropic function due to shocks for each sph particle is @xmath123 , where @xmath124 is the entropic function , defined by @xmath125 ( where @xmath126 is the gas pressure ) .",
    "if the shock is broadened over a scale of order the sph smoothing length @xmath127 ( @xmath128 is a factor which has to be calibrated with shock - tube tests ) , one can roughly estimate the time it takes the particle to pass through the broadened shock front as @xmath129 , where @xmath130 can be approximated with the pre - shock velocity @xmath131 .",
    "assuming that the present particle temperature is a good approximation for the pre - shock temperature , it is possible to replace @xmath131 with @xmath132 .",
    "based on these assumptions and using @xmath133 , the jump of the entropic function of the particle crossing a shock will be :    @xmath134    where , using equation [ eq : dens ] and [ eq : temp ] one has :    @xmath135^\\gamma,\\ ] ]    that combined with equations  [ eq : a2/a1_1 ] and [ eq : a2/a1_2 ] : @xmath136 m_1 =   \\frac{f_h h}{c_1 a_1 } \\frac{d a_1}{d t}. \\label{eq : f4}\\ ] ]    the right - hand side of eqn .",
    "[ eq : f4 ] can be estimated individually for each particle , and eqn .",
    "[ eq : f4 ] allows to estimate their mach number ( see pfrommer et al .",
    "2006 for details ) . in the following",
    "we will refer to this method as ej method .",
    "the ej method has been applied in a series of papers to characterize shocks on the fly , inject crs with a mach number - dependent acceleration efficiency , account for the non - linear back reaction of the cr pressure on the hydrodynamics and following the transport of crs during gadget3 simulations of cosmological structure formation , galaxy and galaxy cluster formation ( pfrommer et al .",
    "2006 , 2007 , 2008 ; pfrommer ( 2008 ) ; jubelgas et al .",
    "( 2008 ) ; pinzke & pfrommer 2010 ; pinzke et al .",
    "2011 ) . in our work here",
    ", the original ej scheme has been applied in run - time to gadget3 runs , and the measured distributions of mach numbers for the gas particles have been analyzed in post - processing .",
    "we measured the strength of shocks in our simulations , by applying the tj method in post - processing to tvd runs , the vj method in post - processing to enzo run and the ej method in run time for gadget3 runs .",
    "the panels in figure   [ fig : maps_shocks ] show the large scale pattern of shock waves for a thin slice ( of 550 kpc ) in the simulated box at z=0 , for the best available resolutions in all codes . only for display purposes",
    ", the mach numbers measured in gadget3 have been interpolated onto regular grids with resolution corresponding to a @xmath25 mesh .    even at the best available resolution ,",
    "the morphological distributions of shocks in the various run looks less similar than what is generally found for the density - weighted maps of temperature ( fig .  [",
    "fig : maps]-[fig : maps_zoom ] ) . in all runs innermost region of clusters and filaments hosts only weak shocks , @xmath137 , while the strongest shocks are located outside cosmic structures .",
    "however , the strong external shocks are very sharp and regular in grid codes , while they seem to be grouped in clumps in gadget3 . while in gadget3 runs the shocked structures are rather volume filling ( due to the smoothing kernel in less dense regions ) , in both grid methods the shocks outside clusters are regular surfaces with radius of curvature @xmath138 , with a very small volume filling factor .",
    "we notice that this difference between sph and grid methods depends on the different resolutions outside @xmath39 , however the general trend is that when the spatial and mass resolution of dm particles is _ increased _ , the differences between grid codes and sph are even more sizable .",
    "this is shown in the panels of fig .",
    "[ fig : maps_shocks_zoom ] , which zoom into the cluster region at the center of the cosmological box .",
    "looking at the strong external shocks in the upper left sector of the cluster , one can see that these features become increasingly sharper and more regular in grid methods , while they become stronger and more clumpy in gadget3 runs . on the other hand ,",
    "the trend with resolution inside of the cluster is quite similar in all codes , with increasingly thinner and weaker shocks as the resolution is increased .",
    "the volume distribution of mach numbers in the cosmological volume is a simple statistical proxy that allows us to readily compare the different shock finder and underlying simulations .",
    "however , they can not be directly translated into observational quantities , and therefore their study is just intended to be a useful to cross - check of numerical implementations , rather than a physical test .",
    "figure   [ fig : histo_shocks ] shows the volume - weighted distribution of shocks mach number from all runs using our projects .    at the best available resolution ,",
    "the distributions from the different methods are quite similar , showing a peak of shocks at @xmath139 and a steep decrease at stronger shocks .",
    "compared to the peak , the average frequency of @xmath140 shocks is @xmath141 in gadget , and @xmath142 in enzo and tvd .",
    "gadget runs present the best degree of self - convergence , with very little evolution between runs @xmath27 and @xmath25 .",
    "the vj methods applied to enzo runs on the other hand shows the slowest degree of evolution , with a particularly poor performance at the @xmath27 run ; this is due to the difficulty of removing baryon bulk flows from velocity jumps associate with shocks at very low grid resolutions .",
    "the tj method present a noticeable self - convergence at all resolutions , although a the @xmath27-@xmath26 run present a different convexity in the range @xmath143 ( where the contribution from internal and external shocks takes place ) , similar to the converged findings of the ej method applied to gadget3 .    in both grid codes ,",
    "the increase of resolution always cause a progressive weakening of the strongest shocks in the most rarefied environments ; also the bump of external shocks is progressively shifted towards lower @xmath6 .",
    "we notice that at the best available resolution here , the convergence all simulations ( and most significantly in grid codes ) is not yet reached , even if it looks approaching ; the same is true also for the distribution of thermal energy flux across shocks ( sect.[subsec : en_comp ] ) . based on the tests in the literature ,",
    "run with these same codes ( e.g. ryu et al .",
    "2003 ; skillman et al .",
    "2008 ; vazza , brunetti & gheller 2009 ; vazza et al .",
    "2009 ) one can see that a very good convergence ( i.e. better than a @xmath55 per cent level ) in the most important shock statistics is expected to for a spatial resolutions of @xmath144 , which are below our best resolution here .",
    "however the trend with resolution is usually very regular , and the differences reported here are significant , despite the fact that a small evolution with resolution may still be present .",
    "we also remark that an additional and unavoidable source of difference with resolution is due to the ways in which the shock - finder methods work , because that the dependence on resolution of the different thermodynamical jumps used for the computation can be different , especially for very coarse resolution .",
    "we also notice here that the modeling of a re - heating uv radiation from from massive stars and agns is crucial for a realistic estimate of the baryon gas temperature outside of cosmic structures ( e.g. haardt & madau 1999 ) . in order to measure realistic mach number in the rarefied universe outside clusters , groups and filaments a re - ionization temperature background",
    "is usually accounted in simulations , either in post - processing ( ryu et al . 2003 ; skillman et al . 2008 ; vazza , brunetti & gheller 2009 ) or in run - time ( pfrommer et al .",
    "2006 ; vazza et al .",
    "2010 ) . in this case",
    "the minimum temperature in all simulations is set by the low temperature floor ( see sect .",
    "[ subsec : pdf ] ) ; however the differences in the values adopted in the different codes ( from 1 k in the case of enzo , to 24 k in the case of gadget3 ) can not account for the sizable differences in the distribution of mach numbers .",
    "the differences between the methods are highlighted when we plot the volume weighted average mach number of shocks , @xmath145 , as a function of gas density ( fig .",
    "[ fig : rhog_mach ] ) .",
    "the results of the different codes are consistent only for @xmath146 regions ( typical of the outskirts of galaxy clusters and filaments ) , with @xmath147 . at lower densities",
    "we report the following trend : in sph @xmath145 is smoothly increasing moving towards lower density regions , while in grid codes the transition of @xmath145 moving to lower densities is very sharp , and causes a net increase of @xmath145 by 2 orders of magnitude in both grid methods .",
    "these large differences in the range @xmath148 mirror the different thermal structures of baryons in the outermost regions of lss in grid codes and in sph ( sec.[sec : thermal ] ) . in these environments , the self convergence in grid codes is not yet reached even at the best available resolution @xmath149 .",
    "the thermal energy flux across each shock in the simulations is measured as :    @xmath150    where @xmath151 is the pre - shock gas density and @xmath152 is a monotonically increasing function of @xmath6 which follows from rankine - hugoniot jump conditions , whose formula can be found for instance in kang et al .",
    "( 2007 ) .    in the tj and in the vj methods",
    "this quantity is computed in post - processing based on the shock direction , while in the ej method @xmath153 it is measured in run - time .",
    "we remark that in all 3 methods , the numerical recipes to compute the effective thermalization at the post - shock are tuned to remove the effect of adiabatic compression of the gas in the post - shock region , which can provide sizable additional thermalization in the regime of weak shocks ( see ryu et al .",
    "2003 ; pfrommer et al .",
    ".    we report in fig .",
    "[ fig : fth_shocks_map ] the projected map of @xmath153 across the simulated volume in the best resolved runs ( top panels ) , and for a zoomed region of @xmath154 ( bottom panels ) .",
    "we also report for comparison with the sph run the corresponding enzo @xmath25 run .",
    "the flux coming from the innermost cluster region looks morphologically similar in all cases , with a compact and spherical  envelope ",
    "of energetic shocks concentrated inside the virial volume of halos .",
    "the differences are more sizable at the scale of filaments and in the outer region of clusters , where we notice very sharp shock surfaces even in projection in grid methods , while much smoother pattern are found in gadget3 , with external accretion shock extending at larger distances from the center of clusters .",
    "this effect mirrors the corresponding distribution of gas entropy at larger scales , which we reported in the analysis of the radial profile of the entropic function , in sect[subsec : clusters_cp ] .",
    "the zoomed images of fig .",
    "[ fig : fth_shocks_map ] additionally shows that complex intersections of merger shocks are modeled inside the over - dense regions in grid codes , while very smooth distribution appears in the projected gadget maps . taking as a reference the enzo run with @xmath25",
    ", we see that the above differences are not trivially due to resolution effects , since the large scale shock patterns in the grid code do not significantly get smoother or shift in position even if the resolution of the simulation is made coarser .",
    "the differential distributions of @xmath153 for all runs is reported in fig .",
    "[ fig : fth_shocks ] . in this case",
    "the contribution coming from the low density regions is fairly negligible and results are found to be in an overall good agreement . as in the case of number distributions , the ej method presents the largest degree of self - convergence , and the vj presents the slowest degree of self - convergence .",
    "the grid codes present the clear trend of processing less thermal flux at @xmath155 shocks when resolution is increased , while in sph slightly more energy flux is processed at strong shocks when resolution is increased ( although this amount is negligible compared to the peak of thermalization in the box ) . in the bottom panels of the same figure",
    ", we also show the cumulative distribution for the same run , normalized to the total flux inside the cosmic volume for each run .    at their best resolution",
    ", all codes agree in several important findings : a ) the peak of thermalization is found at @xmath156 , consistent with most of previous works in the literature ( e.g. ryu et al . 2003 ; pfrommer et al .",
    "2006,2007 ; vazza et al .",
    "2009,2010 ; skillman et al .",
    "2008 ) ; b ) the general shape of the distributions is quite similar , with a steep power - law behaviour , @xmath157 .",
    "the slope is @xmath158 in grid codes and @xmath159 in gadget3 runs ; this is steeper compared to the findings in the literature , because we are not modelling here the re - ionization background .",
    "c ) the cumulative distributions for @xmath160 shocks are very similar in all codes , and only @xmath161 per cent of the total thermal flux inside the cosmic volume belongs to shocks with @xmath162 .",
    "these findings suggest that , despite sizable differences in the shapes and statistics of strong external shocks in the accretion regions of large scale structures , the bulk of the energetic properties of shocks within the cosmic volume is a rather well converged answer from cosmological simulations .                                  to pinpoint the differences between the codes ,",
    "we find it useful to extract the phase diagram of shocked cells for the various runs within the total cosmic volume .",
    "panels in fig .",
    "[ fig : phase_shocks ] and [ fig : phase_shocks_flux ] show the flux - weighted mean mach number , @xmath145 , and thermal flux ( normalized to the total thermal flux in the cosmic volume ) for the shocked cells of runs @xmath27 , @xmath26 and @xmath25 .    in grid codes ,",
    "as soon as the spatial resolution is large enough to model the innermost region of collapsed halos , a compact `` group '' of cells at @xmath163 is formed in the upper right corner of the phase diagram , while a much broader region of strong shocks is found at lower densities at across a wide range of temperatures . in gadget3 , a similar `` group '' of points corresponding to halos",
    "is formed , but it has less sharp contours and it smoothly extends to lower densities , where strong outer shocks from a concentration which is much narrower compared to grid codes .    if the dissipated energy flux is concerned ( fig .",
    "[ fig : phase_shocks_flux ] ) , again less disagreement is found among codes . at all resolutions , about",
    "the @xmath164 per cent of total dissipated energy in the box is found at cells with @xmath165 and @xmath166k .",
    "one should expect a high degree of convergence in the statistics and morphologies of energy dissipating structures in the three codes : indeed the main sources of heating in these adiabatic runs are shocks , and the cross comparisons in the previous sections ( sec.[subsec : map_cp]-sec.[subsec : clusters_cp ] ) have shown that most of the thermal properties of halos are in good agreement .    on the other hand , shocks are also the main source of entropy generation in these simulations , and we showed that the halos in the different codes present noticeable differences both in the inner and outer entropy distributions ( sec.[subsec : clusters_cp][subsec : tracers ] ) , are likely related to details of shocks dynamics away from the most dissipative structures in simulations .",
    "[ fig : entro_phases ] shows the illustrative case of the scatter plot for the post shock entropy versus @xmath145 diagram .",
    "we restrict to @xmath167 k regions in order to avoid any artifacts due to different low temperature floors adopted in the various codes ( see sect.[subsec : pdf ] .",
    "a concentration of high entropy and weak shocks ( in red color , in the figure ) is common to all simulated data , and marks the shock energy dissipation in innermost region of galaxy clusters .",
    "however , in grid codes a concentration of points is also present for @xmath168 , as diagonal stripe in the plane ( @xmath145,@xmath104 ) .",
    "the points in this region ( in blue color ) trace _ external _ shocks , for which the post shock entropy is tightly correlated with @xmath145 ( eqn .",
    "[ eq : entropy ] ) for strong @xmath162 shocks , leading to a @xmath169 .",
    "this `` phase '' of shocked gas is almost completely missing in sph runs .",
    "we verified that in the grid codes , the strong shocks following the @xmath169 correlation are systematically located at the outskirts of galaxy clusters and filaments , while the concentration at @xmath170 shocks comes from cells within collapsed halos . in this second case ,",
    "energetic and weak shocks are unable to change the post - shock entropy in a relevant way , and no strong relation is found between @xmath104 and @xmath145 .",
    "therefore , in gadget entropy is released in the simulation at the same location of the most dissipative structures in the universe , whereas in both grid codes a sizable amount of entropy is also released at outer accretion shocks , which are not responsible for sizable energy dissipation .",
    "this suggests the important point that , although thermalized energy is processed in the various codes in a rather consistent way , the gas entropy in grid codes and in sph is increased in shock structures with rather different morphologies and thermodynamical properties .",
    "considering that the production of entropy at outer shocks is also responsible for the innermost entropy profile in clusters ( sec.[subsec : tracers ] ) , we suggest that this findings is also relevant to understand the detailed properties of advection of matter ( and possibly cr ) inside galaxy clusters , over cosmic time .",
    "one possibility is that the absence of strong entropy generation at outer shocks in gadget3 is due to pre - shock entropy generation by to artificial viscosity ( e.g. oshea et al .",
    "2005 ) , which would also be consistent with the trend reported in the temperature distributions of sec.[subsec : pdf ] .",
    "an additional effect here is likely the smearing of shocks at low densities in sph , which makes difficult to the shock solver in gadget3 to update the particles entropy in a fully consistent way , if several smeared shocks merge together in the accretion regions .",
    "galaxy clusters are expected to be the most important accelerators of cr in the universe ( e.g. miniati et al .",
    "2001 ; ryu et al .",
    "2003 ; pfrommer et al .",
    "2007 ) ; it is therefore important to analyse in detail also the estimated properties of cr acceleration at shocks , in the most massive galaxy clusters of our simulated volume .    in fig .",
    "[ fig : prof_mach_cp ] we report the average radial profile of mean mach number , @xmath145 , for clusters a and b , showing both the results of the weighting by gas density ( dashed lines ) , and by the dissipated energy flux ( solid lines ) . despite the different dynamical state of the two systems ,",
    "we measure @xmath147 for @xmath171 in all runs . approaching the cluster virial radius ,",
    "the grid codes show a sharp increase in the mean mach number ( weighted by dissipated flux ) , which reaches strong shocks , @xmath172 at @xmath80 . in gadget3",
    "the increase in the mean shocks strength is smooth , and @xmath173 is always found inside @xmath39 .",
    "the above trends are similar but less evident , if the weighting by gas density is adopted .",
    "these two trends mirror the trends in the outer entropy profiles ( sec.[subsec : clusters_cp][subsec : tracers ] ) , and can be explained by noting that the medium is more clumpy in gadget3 runs , and that the shocks are always thinner and stronger at this location in grid codes , marking a very sharp the transition between large scale structures and the rarefied universe .    in order to explore the possible effect played by the above differences in the global efficiency of clusters to produce the cr energy flux at shocks",
    ", we applied to all simulations a recipe to estimate the cr acceleration efficiency at shocks , with a standard application of the diffusive shock acceleration theory ( e.g. kang & jones 2002 ) . according to this model ,",
    "the cr acceleration at each shocks is parametrized as a function of the mach number :    @xmath174    where @xmath175 is a monotonically increasing function of @xmath6 , whose numerical approximation can be found instance in kang et al .",
    "this prescription for the acceleration of cr particles is quite idealized , and that more recent work by the same authors take also into account alfvn waves drift and dissipation at the shock precursor ( kang et al .",
    "2007 ) , causing a lower acceleration efficiency for shocks with @xmath160 . also , this recipe neglects the role of the re - acceleration of pre - existing cr , which can as well affect in a significant way the efficiency of acceleration at weak shocks ( e.g. kang & ryu 2010 ) .",
    "the bottom panels in fig .",
    "[ fig : prof_mach_cp ] shows the radial profiles for the mean acceleration efficiency at shocks @xmath176 , for cluster a and cluster b at the best available resolutions in all codes . in the relaxed cluster",
    "a , the agreement is reasonably good and all codes show a minimum efficiency @xmath177 , at the cluster core , with a similar increasing profile up to a maximum of @xmath178 at @xmath39",
    ". outside of this radius , the trends of grid codes and sph largely diverge as in all cases reported before , and the acceleration efficiency in gadget3 run decreases .",
    "the comparison of the results for cluster b suffers of the timing issue reported in sec.[subsec : clusters_cp ] , which are further amplified by the non linearity of eqn .",
    "[ eq : fcr ] .",
    "this produces a large scatter from code to code in @xmath176 inside the cluster , but approaches the same values and trend of cluster a for @xmath179 .",
    "we stress that the reported differences for cluster b are representative of the level of _ intrinsic _ scatter that simulations with different numerical codes are subject to , which in turn adds a level of unavoidable uncertainty when estimates of cr injections from clusters are estimated using too small number of objects .",
    "it is worth stressing that the above estimate of cr acceleration efficiency are already at the edge , if not outside , of the range of permissible energy ratio between cr and thermal gas from gamma rays ( e.g. reimer 2004 ; pfrommer & enlin 2004 ; aharonian et al .",
    "2008 ; ackermann et al . 2010 ; aleksic et al . 2010 ; donnert et al . 2010 ; pinzke et al .",
    "2011 ) , radio ( brunetti et al . 2007 ; brunetti et al . 2008 ) and x - ray / optical observations ( churazov et al . 2008 ) . given the fairly simple setups of the simulations considered in this work ( e.g. no radiative processes , no re - ionization , idealized recipe for cr acceleration at shocks , no self - consistent cr feedback , coarse spatial and mass resolutions , no magnetic fields ) , this is not surprising and it suggests that a completely self - consistent treatment of cr , in presence of other important non - thermal component ( such like magnetic fields ) is needed to model observations .    on the other hand , these findings may also imply that the numerical implementation of the complex non - linear physics of non - thermal phenomena in large scale structures can be subject to additional uncertainties , because the basic thermo - dynamical evolution of accreted cosmic baryons in large scale structures is not yet unambiguously constrained even by rather simple cosmological simulations .",
    "in this work we presented the results of a numerical study which compares cosmological simulations at various resolutions , obtained with with gadget3 ( springel 2005 ) , enzo ( norman et al . 2007 ) and tvd ( ryu et al . 1993 ) .",
    "the chosen simulation setup is very simple ( only gravity forces and non - radiative hydrodynamics are modeled ) and it is therefore particularly suitable to study the convergence among widely used , complementary numerical approaches .",
    "this kind of comparison my also be helpful to explore the reasons for differences in the thermal and non thermal properties of galaxy clusters runs .",
    "we have analyzed in detail the properties of the dm distribution , thermal gas matter distribution , shock waves and cr acceleration efficiencies within the simulated volume in all codes , and we highlighted all most convergent and least convergent findings of all codes , as a function of the numerical resolution and of cosmic environment .",
    "an overall satisfactory agreement between the 3 codes is found for runs with dm mass resolution better than @xmath180 , in line with previous comparison works . in particular , we report a good cross convergence of the following measures :    * the mass distribution function and baryon fraction for halos in the simulations are found in agreement within a @xmath33 per cent , across a range of masses .",
    "the rate of convergence with resolution in grid codes is much slower than in gadget3 .",
    "these results are in line with the works by oshea et al .",
    "( 2005 ) and by heitmann et al .",
    "( 2008 ) ; * the profiles of dm matter of halos are well converged in all codes , for all the virial volume except for the scales close to the gravitational softening of all codes , consistently with the literature ( e.g. frenk et al . 1999 ) ; * the gas density distribution are agreement within @xmath181 per cent , for densities in the range @xmath182 .",
    "high density peaks are found to be located at equal positions within the spatial resolution of the simulations ; * the gas temperature distributions are in agreement with a @xmath183 per cent accuracy only for @xmath184 regions , which correspond to the typical virial temperature of the smallest halos produced in the simulations , in agreement with the findings reported by kang et al .",
    "( 1994 ) and oshea et al .",
    "( 2005 ) ; * the gas temperature and the gas density profiles of the most massive clusters in the sample are similar within a @xmath181 cent accuracy , consistently with frenk et al .",
    "time integration of a chaotic system results in slightly different spatial realizations of substructure , in particular during mergers .",
    "this introduces an episodic source of additional uncertainty .    on the other hand ,",
    "noticeable differences are found in the following measures :    * the gas density and gas temperature distributions for @xmath2 and for @xmath185 regions are in disagreement up to @xmath186 orders of magnitude among simulations , even at the best available resolutions in the project ; * the entropy profiles for clusters simulated with grid codes show a sharp peak located at @xmath187 , while the profiles in gadget3 present a similar shape , but spread across a sizable lager volume ; * the inner entropy profile of clusters simulated with enzo is flat inside @xmath188 , while it is steep in gadget3 ( consistently with early results from frenk et al .",
    "1999 and more recent ones by mitchell et al . 2009 ) ; * the gas clumping within the most massive halos , and expecially in the outermost cluster regions , is rather different if grid codes and gadget3 are compared ; * the time evolution of the accretion of matter clumps is also found to be radically different when enzo and gadget3 are compared : in grid codes their initial entropy is substantially increased by shock heating , while in sph shock heating mechanisms are more gentle .",
    "the accreted material is distributed at larger cluster radii in enzo than in gadget3 .",
    "shocks were identified in all runs according to the shock detecting schemes specifically conceived for each simulation : and entropy based method for gadget3 ( pfrommer et al .",
    "2006 ) , a temperature based method for tvd ( ryu et al . 2003 ) and a velocity based method for enzo ( vazza , brunetti & gheller 2009 ) .",
    "the most interesting convergent findings are :    * the peak of thermal flux in the universe is at @xmath156 , and originates in shocks internal to clusters ; * the volume distribution and thermal energy flux distribution are very steep , and are dominated by strong @xmath189 shocks in the external regions of large scale structures ; * @xmath190 percent of the total thermal energy flux in the universe is processed by shocks with @xmath160 ; * inside the virial radius of the most massive clusters , the density weighted profile of shocks are very flat , with @xmath147 ; * the estimated acceleration efficiency of cr ( assuming kang & jones 2002 ) is small in the innermost cluster region , @xmath177 , and increases towards the virial radius , with @xmath191 ( however , the absolute numbers are likely to change as this recipe does not account for alfven wave drift and dissipation at the shock precursor ) .",
    "+ .    on the other hand , the findings where we do not find agreement at the investigated resolutions are :    * shocks in grid codes are morphologically similar at all resolutions ,",
    "while shocks in gadget3 show substantial difference at external shocks ; * the volume - weighted mean mach number for @xmath192 presents different trends in each code ; * in the vast majority of the simulated volume ( outside halos ) , shocks in grid codes show rather different properties in the phase diagrams ( @xmath193 versus @xmath194 and @xmath104 versus @xmath6 ) compared to shocks in gadget3 .",
    "in particular , strong accretion shocks in grid codes are associated with large entropy jumps , while accretion shocks in gadget3 are not characterized by large values of entropy ; * in massive clusters , grid codes produce a sharp increase of the shock strength outside @xmath39 , while a continuous transition to weaker shocks is is found in gadget3 runs ; * the cr injection efficiencies outside the virial radius show different radial trends when grid runs and gadget3 runs are compared .",
    "overall , when cosmological numerical simulations with gadget3 , enzo and cosmological tvd are compared within similar range of dm mass resolution , we report agreement better than @xmath55 per cent level in many statistics concerning hot , over - dense regions of the universe ( i.e. halos , filaments ) .",
    "this is reassuring and it is in line with a number of previous works dealing with similar topics ( kang et al .",
    "1994 ; frenk et al .",
    "1999 ; heitmann et al .",
    "the statistical distributions of halos masses , halos baryon fraction , density distributions , thermal profiles and internal shocks are characterized by a high rate of convergence with resolution in gadget . in the most over - dense regions , enzo and tvd converge at a rather small rate , but produce very similar estimates at the end for most of investigated cases , despite the radically different hydro method they use to solve baryon gas dynamics .",
    "the application of adaptive mesh refinement techniques is expected to further reduce the discrepancy between grid methods and sph , at least in some cases ( e.g. oshea et al .",
    "2005 ; tasker et al .",
    "2008 ; robertson et al .",
    "2010 ) . in the case of lower density regions ( i.e. outer accretion regions of clusters , voids )",
    "the temperature distributions , entropy distributions , shock morphologies and mach number distributions converge to rather different estimates when sph and grid codes are compared .",
    "the role played by the effective viscosity and diffusivity of each method away from shocks may be partially responsible for the above differences .",
    "one interesting finding is the substantially different characterization of external shocks and entropy profiles in the grid and sph methods , a feature that has a number of important consequences in both thermal and non thermal issues .",
    "the different dynamics felt by accreted clumps ( sec.[subsec : tracers ] ) show that the prediction of mixing and gas matter deposition rates in cluster cosmological simulations is still an open problem .",
    "given the rather simple setup employed in these simulations ( no radiative processes , no heating mechanism other than shocks , no cr feedback , small turbulent motions due to lack of resolution and artificial viscosity in sph ) shocks dynamics has to be regarded as the leading player in setting the entropy profiles in clusters .",
    "these results conclusively suggest that the differences in shocks morphologies and shock dynamics across the clusters evolution leave major imprints also in substructures distributions and entropy distributions in the icm , which is a rather new evidence provided by this work .",
    "tightly connected to this , is the high degree of non - linearity which is present in all cr acceleration recipes .",
    "however , to date it is not clear whether these non - linearities would amplify any of the above differences at shocks and potentially lead to a different cr pressure distribution in galaxy clusters , or whether the average cr pressure support results from a combination of an average shock acceleration efficiency at the strongest shocks and successive cr transport .",
    "based on the results of this project , we notice that performing of `` high - precision '' cosmology ( e.g. relating cosmological observables and theoretical models , based on scaling relations affected by less than @xmath161 percent scatter in simulations ) may still be a challenge for many applications , since some very important measurements related to the volume filling properties of galaxy clusters simulated with some of the best available numerical codes appear to be still affected by uncertainties of @xmath55 percent ( or more ) .",
    "this is found even in the case of the very similar physical setup analyzed here ( only gravity and hydrodynamical forces ) and the reason for this appear to be mostly of numerical nature , meaning that some important details concerning the production and transport of entropy in these simulations can be very different from code to code .",
    "this results are based on rather low or moderate resolution simulations presented in this paper , and it is likely that going to much higher resolution levels off most of the above differences ; however in this paper we have shown that not all significant differences are related to resolution only ( e.g. differences in accretion shocks in sph or grid methods ) .",
    "it is unclear if the application of more physical ingredients which are not accounted in this work ( e.g. magnetic fields , thermal conductions , feedback of relativistic particles ) may be able to soften any of the reported above reported differences .",
    "the suggestion of this work is that , together with the design of more sophisticated physical recipes to model the thermal and non thermal components of the real universe , our theoretical understanding of cosmic structures would also greatly benefit from other detailed comparative studies of different numerical recipes , since the convergence of simulated estimates of a sizable fraction of the cosmic volume is presently yet to be reached .",
    "f.v . acknowledges support from the grant for1254 from deutschen forschungsgemeinschaft . k.d .",
    "acknowledges the support by the dfg priority programme 1177 and additional support by the dfg cluster of excellence `` origin and structure of the universe '' .",
    "the work of d. r. and h. k. was supported by the national research foundation of korea through grant 2007 - 0093860 .",
    "f.v . and g.b .",
    "acknowledge partial support through grant prin inaf 20082009/2010 .",
    "we acknowledge the usage of computational resources under the cineca - inaf 2008 - 2010 agreement and the 2009 key project `` turbulence , shocks and cosmic rays electrons in massive galaxy clusters at high resolution '' .",
    "we acknowledge r.brunino , m. hoeft , t. jones , b. oshea and v. springel of fruitful scientific discussions .",
    "the computation of cosmological distances in this paper are done thanks to the cosmology calculator by e. wright ( wright 2006 ) ."
  ],
  "abstract_text": [
    "<S> cosmological hydrodynamical simulations are a valuable tool for understanding the growth of large scale structure and the observables connected with this . yet </S>",
    "<S> , comparably little attention has been given to validation studies of the properties of shocks and of the resulting thermal gas between different numerical methods  something of immediate importance as gravitational shocks are responsible for generating most of the entropy of the large scale structure in the universe . </S>",
    "<S> here , we present results for the statistics of thermal gas and the shock wave properties for a large volume simulated with three different cosmological numerical codes : the eulerian total variations diminishing code tvd , the eulerian piecewise parabolic method - based code enzo , and the lagrangian smoothed - particle hydrodynamics code gadget . starting from a shared set of initial conditions , we present convergence tests for a cosmological volume of side - length @xmath0 , studying in detail the morphological and statistical properties of the thermal gas as a function of mass and spatial resolution in all codes . by applying shock finding methods to each code , we measure the statistics of shock waves and the related cosmic ray acceleration efficiencies , within the sample of simulations and for the results of the different approaches . </S>",
    "<S> we discuss the regimes of uncertainties and disagreement among codes , with a particular focus on the results at the scale of galaxy clusters . </S>",
    "<S> even if the bulk of thermal and shock properties are reasonably in agreement among the three codes , yet some significant differences exist ( especially between eulerian methods and smoothed particle hydrodynamics ) . </S>",
    "<S> in particular , we report : a ) differences of huge factors ( @xmath1 ) in the values of average gas density , temperature , entropy , mach number and shock thermal energy flux in the most rarefied regions of the simulations ( @xmath2 ) between grid and sph methods ; b ) the hint of an entropy core inside clusters simulated in grid codes ; c ) significantly different phase diagrams of shocked cells in grid codes compared to sph ; d ) sizable differences in the morphologies of accretion shocks between grid and sph methods .    </S>",
    "<S> [ firstpage ]    galaxy : clusters , general  methods : numerical  intergalactic medium  large - scale structure of universe    0.4 cm </S>"
  ]
}