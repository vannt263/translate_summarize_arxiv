{
  "article_text": [
    "bond et al . ( 1991 ) described an approach which allowed them to use the statistical properties of the initial density fluctuation field to derive an estimate of the number density of collapsed dark matter haloes at later times : the so - called universal , unconditional mass function ( press & schechter 1974 ) .",
    "lacey & cole ( 1993 ) showed how this model could be extended to estimate the rate at which small objects merge with each other to produce larger objects .",
    "this allowed them to estimate the conditional mass function of subhaloes within parent haloes .",
    "lacey & cole also provided formulae for the distribution of halo formation times ; nusser & sheth ( 1999 ) provided formulae for the distribution of the halo mass at formation .",
    "sheth ( 1996 ) and sheth & pitman ( 1997 ) showed how various higher order statistical properties of the forest of merger history trees associated with the formation of these objects could also be estimated within this approach .",
    "mo & white ( 1996 ) and sheth & lemson ( 1999a ) showed how information about the forest of merger history trees could be used to quantify the extent to which dark haloes are biased tracers of the matter distribution .",
    "mo , jing & white ( 1997 ) provided predictions for the higher order moments of the spatial distribution of the haloes , and sheth ( 1998 ) showed how to use the approach to estimate the probability that a randomly placed cell contains a certain amount of mass .",
    "clearly , the approach has been very useful .",
    "the approach combines the simple physics of the spherical collapse model with the assumption that the initial fluctuations were gaussian and small .",
    "the problem of estimating any one of the quantities listed above is reduced to solving a problem associated with the crossing of an appropriately chosen barrier by particles undergoing brownian motion ; the brownian nature of the motion comes from the assumption of gaussian initial conditions , and the barrier shape is specified by the spherical collapse model ( e.g. sheth 1998 ) .",
    "hence , this is often called the excursion set approach .    tormen ( 1998 ) reported that the spherical collapse based excursion set predictions did not describe the conditional mass function of subclumps in his simulations well",
    ". motivated by this , sheth , mo & tormen ( 2001 ) discussed a simple way of modifying the excursion set approach to incorporate the effects of ellipsoidal , rather than spherical collapse . on average , initially denser regions collapse before less dense ones .",
    "this means that , at any given epoch , there is a critical density which must be exceeded if collapse is to occur . in the spherical collapse model ,",
    "this critical density does not depend on the mass of the collapsed object .",
    "however , in their parametrization of ellipsoidal collapse , sheth , mo & tormen showed that , of the set of objects which collapse at the same time , the less massive ones must initially have been denser than the more massive ones , since the less massive ones would have had to hold themselves together against stronger tidal forces .",
    "they argued that this could be incorporated into the excursion set approach , simply and effectively , if not rigorously , by changing the barrier shape .",
    "in essence , whereas the barrier associated with spherical collapse is one whose height does not depend on distance from the origin of the walk , the one associated with ellipsoidal dynamics increases with distance .",
    "they showed that the excursion set approach with a moving barrier was able to provide a good fit to the universal halo mass function .",
    "this paper is devoted to a more detailed discussion of moving barrier models . in general , moving barrier models have a richer structure than the constant barrier model .",
    "for example , the approach with spherical dynamics predicts that , at any given time , all the mass in the universe is bound up in collapsed objects , whereas a small fraction of the mass remains unbound in the case of ellipsoidal dynamics .",
    "in addition , whereas clustering is strictly hierarchical in the case of spherical dynamics , incorporating ellipsoidal collapse into the excursion set approach results in a model in which fragmentation as well as mergers may occur  the approach predicts that some small haloes fragment before they are subsumed into larger ones .",
    "appendix  a describes some of these features , which may ( or may not ! ) provide better approximations to the physics of graviational instability than does the constant barrier model , in more detail .",
    "the appendix also describes how the results of this paper can be used to model the halo mass function in warm dark matter scenarios such as that revisited by bode , ostriker & turok ( 2001 ) .",
    "section  [ barriers ] shows how moving barrier models can be used to make simple analytic estimates of a number of statistical quantities which are routinely measured in numerical cosmological simulations .",
    "the primary results of section  [ barriers ] are equations  ( [ taylors ] ) and  ( [ fss ] ) , which are accurate for a large class of moving barrier shapes . to illustrate how these formulae work , we show the result of inserting the ellipsoidal collapse moving barrier of sheth , mo & tormen ( 2001 ) into these formulae .",
    "section  [ umf ] presents the number density of bound objects as a function of mass ( the unconditional mass function ) , and section  [ generate ] describes a simple efficient algorithm for generating it .",
    "section  [ cmf ] presents the average number of progenitor subhaloes as a function of subhalo mass , for a wide range of specified parent halo masses ( the conditional mass function ) , and section  [ dmf ] shows how the halo mass function depends on the surrounding density field ( the local - density mass function ) .",
    "comparison with simulations shows that the approach , with the ellipsoidal collapse based moving barrier shape , is quite accurate .",
    "section  [ rescale ] shows that , at small lookback times , neither the constant nor the moving barrier predictions describe the conditional mass functions in the simulations particularly well , although the agreement at large lookback times is quite good if the spherical collapse constant barrier is used , and even better if the ellipsoidal collapse moving barrier is used .",
    "section  [ sixd ] shows the result of considering more complicated moving barrier excursion set models . in particular",
    ", it shows the result of considering the full six - dimensional random walk associated with gaussian random fields , rather than the one - dimensional simplification proposed by sheth , mo & tormen ( 2001 ) .",
    "it shows that their simplification is actually quite accurate .",
    "details associated with the calculations in this section are presented in appendix  [ grfs ] .",
    "section  [ discuss ] discusses some simple implications of our findings .",
    "although , in this paper , we concentrate on the moving barrier derived by sheth , mo & tormen ( 2001 ) , we think it worth stressing that our analytic formulae are more general : they are accurate for a wide variety of moving barrier shapes .",
    "as discussed in the introduction , we will mainly be interested in the first crossing distributions of uncorrelated brownian motion random walks .",
    "following bond et al .",
    "( 1991 ) and lacey & cole ( 1993 ) , these first crossing distributions can be used to provide useful approximations to what have come to be called the conditional and unconditional mass functions of the dark halo distribution .",
    "the results of this section should be thought of as generalizations of the results in lacey & cole ( 1993 ) . whereas they restricted their attention to a barrier of fixed height",
    ", this section presents analytic formulae which approximate the barrier crossing distribution for a wide class of moving barriers .",
    "before we begin , we think a word on notation is helpful . we have chosen to present our formulae for the first crossing distributions using the same notation as lacey and cole ( 1993 ) .",
    "this means that we use the symbol @xmath0 to represent the variance in the density fluctuation field when smoothed on some scale , which is usually denoted @xmath1 .",
    "however , some of our formulae can be written in terms of the scaled variable @xmath2 , for some suitably defined @xmath3 . when this is possible",
    ", we also write our formulae in terms of @xmath4 .      to illustrate how our formulae work , rather than use the spherical collapse barrier of constant height",
    ", we will use the moving barrier shape derived by sheth , mo & tormen ( 2001)the one associated with ellipsoidal collapse : @xmath5 , \\label{bec}\\ ] ] where @xmath6 ^ 2 $ ] . in the expression above",
    ", @xmath7 is the critical overdensity required for spherical collapse at @xmath8 , extrapolated using linear theory to the present time ( it is approximately 1.686@xmath9 if @xmath10 ) , and @xmath11 is the rms of the initial density fluctuation field when it is smoothed on a scale which contains mass @xmath12 , extrapolated using linear theory to the present time .",
    "the parameters @xmath13 and @xmath14 come from ellipsoidal dynamics ( the spherical collapse model has @xmath15 and @xmath16 ) , and the value @xmath17 comes from normalizing the model to simulations ( as we discuss later , it may be more accurate to set @xmath18 or so ) .",
    "the spherical collapse model sets @xmath19 ; because @xmath20 is then independent of @xmath21 , spherical collapse is said to be associated with a barrier of constant height .    as sheth , mo & tormen noted , @xmath22 scales similarly to the natural scaling associated with random walks : multiplying the barrier height by @xmath23 and rescaling @xmath21 by the same factor results in a barrier of the same shape .",
    "they exploited this property as follows : first , they studied what happens when @xmath24 . whereas an analytic expression for the first crossing distribution of a barrier of constant height has been known for some one hundred years or so , there is as yet no analogous solution for the ellipsoidal collapse moving barrier .",
    "( one of the main results of this section is to provide a good analytic approximation to this solution . )",
    "so , sheth , mo & tormen simulated a large number of random walks and computed the distribution of first crossings , @xmath25 , of the barrier @xmath26 numerically .",
    "the scaling of the barrier shape meant that their numerical solution could be scaled to represent the first crossing distribution at any other time also .",
    "therefore , when providing an analytic fit to their simulated first crossing distribution , they expressed it in scaled variables : @xmath27\\   \\left({a\\,\\nu\\over 2}\\right)^{1/2}\\,{{\\rm e}^{-a\\nu/2}\\over\\sqrt{\\pi } } , \\label{giffit}\\ ] ] where @xmath28 is the distribution of first crossings , @xmath29 and @xmath30 are the variables defined above , @xmath31 and @xmath32 is determined by requiring that the integral of @xmath33 over all @xmath29 give unity .",
    "the distribution associated with the spherical collapse constant barrier is got by setting @xmath34 , @xmath35 and @xmath36 .    in the excursion set approach ,",
    "the average comoving number density of halos of mass @xmath12 , often called the universal or unconditional halo mass function @xmath37 , is related to the first crossing distribution ( this is why the shape of the barrier influences the shape of the mass function ) by @xmath38 where @xmath39 denotes the average comoving density of the background . because the first crossing distribution evolves self - similarly , so does the halo mass function .",
    "2 in sheth & tormen ( 2001 ) shows that , in the gif simulations of clustering in scdm , ocdm and @xmath40cdm cosmologies , @xmath37 is well fit by this expression ( at least over the range @xmath24 to @xmath41 ) .",
    "that is to say , the excursion set prediction that the universal unconditional mass function evolves self - similarly , is actually a very good approximation .",
    "although this fitting function ( equation  [ giffit ] ) for the first crossing distribution is extremely useful , when we consider conditional mass functions in the next section , it will turn out that we need to compute a new fitting function for each parent mass range of interest .",
    "this is , in principle , a computational bottleneck .",
    "for this reason , we think it more useful to provide a formula for the first crossing distribution which is more amenable for use in what is to follow .",
    "we have analytic formulae for the first crossing distribution only in the case of constant ( e.g. bond et al .",
    "1991 ) and linear ( sheth 1998 and appendix  a of this paper ) barriers .",
    "these solutions suggest the following approximation which we have found to work rather well . for a wide range of moving barrier shapes @xmath42 , the first crossing distribution is well approximated by @xmath43 where @xmath44 denotes the sum of the first few terms in the taylor series expansion of @xmath42 : @xmath45",
    "notice that this expression gives the correct answer in the case of constant and linear barriers ( in which only the first , or the first two terms of the series are non - zero ) . for the ellipsoidal barrier shape , we find we get reasonable accuracy to the numerical result if we truncate this expansion at @xmath46 .",
    "the accuracy of this formula increases as the distance between the start of the walk and the barrier height at that initial position , increases ( this distance is @xmath47 for the ellipsoidal collapse barrier of equation  [ bec ] ) .    =    to illustrate , fig .",
    "[ umfcomp ] shows the result of setting the barrier @xmath42 to equal that given by equation  ( [ bec ] ) at @xmath24 , then generating a large ensemble of random walks , and so constructing the first crossing distribution .",
    "the histogram shows this monte - carlo distribution , and the solid curve shows the approximation presented in equation  ( [ taylors ] ) : @xmath48 ^ 2/2 }                 \\big(1 + \\nonumber \\\\                & & \\ \\ { \\beta\\over ( a\\nu)^\\alpha } \\bigl[1 - \\alpha + { \\alpha(\\alpha-1)\\over 2}+\\cdots\\bigr]\\big)\\nonumber \\\\               & \\approx & \\big(1 + { 0.094\\over ( a\\nu)^{0.6}}\\big )                  \\sqrt{{a\\nu\\over2\\pi } }                 { \\rm e}^{-a\\nu [ 1 + 0.5 ( a\\nu)^{-0.6}]^2/2}.\\end{aligned}\\ ] ] these should be compared with the distribution of first crossings of a barrier of constant height set equal to @xmath49 ( dotted curve ) , and equation  ( [ giffit ] ) which fits the gif simulations ( dashed curve ) . with the exception of the dotted curve ( the one associated with the constant barrier spherical collapse model ) the other three curves are in reasonably good agreement .",
    "we will exploit this fact in the next subsection , when we derive a simple expression for the conditional mass function associated with ellipsoidal collapse .    before we do so , however , we think it useful to point out that there are some generic properties of moving barrier models which arise from the scaling of the barrier shape .",
    "the fact that the barrier shape scales in the way it does means that moving barrier models in which the barrier height increases with @xmath0 are somewhat more complicated than the constant barrier model , so they may be used to model a wider variety of physical processes .",
    "for example , our final expression for the moving barrier crossing distribution is not normalized to unity ( notice that the solid curve is always below the dashed one ) .",
    "this is because , if the barrier height increases more steeply than linearly with @xmath21 then not all walks cross the barrier .",
    "appendix  a uses a simple analytic moving barrier model to illustrate some of these features .",
    "before we move on to study the conditional mass function , we thought it useful to describe a fast and simple algorithm for generating random numbers which can be used to provide the correct distribution of halo masses . to generate numbers drawn from the spherical collapse mass function ( equation  [ giffit ] with @xmath36 and @xmath35 )",
    "is easy because , in this case , @xmath33 can be got by generating a chi - squared random variate .",
    "this means that , in the case of spherical collapse , the unconditional mass function can be generated quickly and easily because generating gaussian random variates is easy . in particular ,",
    "one simply generates a gaussian random variate @xmath50 , and then sets @xmath51 .",
    "the ellipsoidal collapse mass function ( equation  [ giffit ] with @xmath52 and @xmath31 ) can not be transformed to a gaussian , so constructing an algorithm for generating it is not so straightforward .",
    "we have found that first generating a gaussian variate @xmath50 , and then setting @xmath53 is accurate to within a percent or so over the range @xmath54 .",
    "the speed of this algorithm compensates for the fact that it does not exactly produce variates drawn from the ellipsoidal collapse mass function .      as stated above , we do not know of an analytic expression for the first crossing distribution associated with barriers which have the form given in equation  ( [ bec ] ) . however , we do have two reasonably accurate fitting formulae  equations  ( [ giffit ] ) and  ( [ taylors])to this distribution .",
    "one might have thought that we could use them to make an estimate of the conditional mass function as follows .",
    "bond et al .",
    "( 1991 ) and lacey & cole ( 1993 ) argued that conditional mass functions could be estimated by considering the successive crossings of boundaries associated with different redshifts .",
    "the first crossing of two constant barriers of different heights has an analytic solution , so they were able to provide analytic estimates for the conditional mass function associated with the spherical collapse model .",
    "such a formula is very useful , because , once the conditional mass function is known , the forest of merger history trees can be constructed using the algorithm described by sheth & lemson ( 1999b ) , from which the nonlinear stochastic biasing associated with this mass function can be derived using the logic of mo & white ( 1996 ) and sheth & lemson ( 1999a ) .    in the constant barrier case ,",
    "the conditional mass function is computed by considering walks which start from @xmath55 $ ] rather than from the origin , and then intersect the constant barrier @xmath56 at , say , @xmath57 .",
    "this is easily computed , because , despite the shift in the origin , the second barrier is still one of constant height . since the first crossing distribution of a barrier of constant height is known , ( recall it was just such a distribution which was associated with the universal , unconditional mass function ) , the conditional mass function can also be written analytically . essentially , @xmath58 has the same form as the unconditional mass function @xmath25 , but with the change of variables : @xmath59 and @xmath60 .",
    "one might have wondered if the same change of variables in equation  ( [ giffit ] ) provides a good description of the conditional mass function associated with the ellipsoidal collapse moving barrier .",
    "unfortunately , because the barrier shape is not linear in @xmath0 , changing the origin of the coordinate system does not yield a barrier of exactly the same functional form .",
    "specifically , the shape of @xmath61   \\nonumber\\\\ & &   - \\sqrt{a}\\,\\delta_0\\bigl[1 + \\beta\\,s^\\alpha/(a\\,\\delta_0 ^ 2)^\\alpha \\bigr ] , \\end{aligned}\\ ] ] where @xmath62 etc .",
    ", can be written as a constant plus a term which scales as @xmath63 only when @xmath64 equals zero or one .",
    "this means that , formally , the solution to the two barrier problem associated with ellipsoidal dynamics is not given by a simple rescaling of the unconditional ellipsoidal collapse mass function .",
    "therefore , we can not simply rescale the fitting function of equation  ( [ giffit ] ) to get a reliable estimate of the conditional mass function : the two barrier problem associated with moving barriers must , in general , be solved numerically .",
    "this is discouraging because it means that , in principle , we must find a different fitting function for each choice of condition , because each condition corresponds to a different origin , say , @xmath65 , and so to a slightly different barrier shape .",
    "of course , the result can be generated relatively quickly in at least two ways .",
    "the first is to solve the integral equation associated with this barrier numerically ( monaco 1997b ; sheth 1998 ) .",
    "the second is to simply simulate the random walk trajectories and so construct the first crossing distribution directly .",
    "[ gif2bar ] shows an example of what is involved in solving the two barrier problem numerically in this way .",
    "the smooth dotted and solid curves show the ellipsoidal collapse barrier @xmath66 of equation  ( [ bec ] ) scaled to @xmath24 and @xmath67 , respectively .",
    "jagged curves show a few representative random walk trajectories : they start at the barrier position @xmath68 , where @xmath69 is given by the gif scdm power spectrum , and @xmath70 .",
    "these random walks are followed until they first cross the barrier @xmath71 .",
    "the value of @xmath0 at which this happens is stored and used to make plots like those shown below .",
    "the random walks were generated by the same monte ",
    "carlo code that was used to generate fig .",
    "[ lin2bar ] , except that there the barrier shape was given by equation  ( [ linbar ] ) .",
    "[ lin2bar ] shows that this monte ",
    "carlo code works correctly .",
    "one possible approach to the excursion set conditional mass function , then , is to simply generate it numerically , as the need arises .",
    "=    before providing a detailed comparison of the conditional mass functions generated using this monte  carlo model and those in numerical simulations , it is useful to study a simple limiting case . fig .",
    "[ gif2bar ] shows that for @xmath72 , the height of the barrier is approximately constant . at small @xmath0 ,",
    "the only difference between the barrier at two redshifts , and the spherical collapse constant barriers , arises from the factor of @xmath73 .",
    "this has the following consequence . at small lookback times ( small redshift differences )",
    ", most random walk trajectories will intersect the barrier before they have travelled very far along the @xmath0 axis .",
    "for these trajectories , the barrier is , effectively one of constant height .",
    "this means that the conditional mass function for massive haloes at small lookback times will have the same shape as that predicted by the constant barrier , with one small difference .",
    "the factor of @xmath73 has the effect of slightly reducing ( by a factor of @xmath47 ) the effective redshift difference relative to the original constant barrier model . as a result",
    ", the gif barrier suggests that massive haloes at small lookback times will be slightly more massive than the original constant barrier model predicts .",
    "since @xmath74 is close to unity , this effect will be small . in practice",
    ", we only expect the barrier predictions to differ significantly from those of the constant barrier for small haloes , or at large lookback times ( high redshift ) .",
    "this is encouraging , because these are precisely the regimes in which simulations suggest that the constant barrier model is inaccurate ( tormen 1998 ) .",
    "=    in addition to monte - carloing the conditional mass functions , we can use the results of the previous subsection to derive a simple analytic expression for their shape .",
    "we can do this because our barrier crossing formula is reasonably accurate for a rather wide range of barrier shapes .",
    "a glance at fig .  [ gif2bar ] shows that the barrier shapes associated with the conditional mass functions are not likely to be too different from those associated with the unconditional function , so we should be able to use equation  ( [ taylors ] ) to approximate most of the conditional mass functions we will be interested in . in practice , this can be done by simply making the appropriate replacements @xmath75 and @xmath60 in equation  ( [ taylors ] ) . at the risk of being repetitive ,",
    "our approximation for the conditional mass function is : @xmath76 where @xmath77 with @xmath78 ^ 2\\over 2(s - s)}\\right)\\,{{\\rm d}s\\over s - s } , \\label{fss}\\ ] ] and @xmath79\\over\\partial s^n}.\\ ] ]    fig .",
    "[ clcdm ] compares this approximation with the actual numerical monte - carlo distribution , and compares both with the actual distribution measured in the cosmological simulations .",
    "( we will show a comparison with what one gets by rescaling equation  [ giffit ] shortly . ) the histograms ( without error bars ) show the conditional mass functions generated using our monte ",
    "carlo code , for parent haloes in the mass range @xmath80 ( upper curves ) and @xmath81 ( lower curves ) ; the upper curves have been shifted upwards by a factor of ten for clarity .",
    "the smooth curves show the associated analytic approximation ; they describe the results of our numerical walks reasonably well .",
    "therefore , in the comparisons to follow , we will sometimes only show the analytic curves .",
    "recall that the analytic formula should be most accurate for the high - redshift progenitors of massive parents , and least accurate when the parents are not very massive .",
    "the figure shows some evidence that this is true .",
    "both these curves should be compared with the symbols which have error bars  they show the conditional mass functions measured in the @xmath40cdm simulations .",
    "the figure is quite encouraging : our excursion set predictions are in reasonably good agreement with the cosmological simulations .",
    "in addition , the figure shows that the analytic approximation ( equation  [ fss ] ) is reasonably accurate .",
    "[ cscdm ] shows a similar comparison in the case of scdm . in this case , we have chosen to not show the random walk histogram , since it is quite well fit by our formula .",
    "instead , the figure shows the conditional mass functions measured in the scdm simulations ( symbols with error bars ) and the various analytic approximations discussed earlier ( smooth curves ) . in order of accuracy , these are equation  ( [ fss ] ) ( solid ) , the distribution associated with rescaling the unconditional mass function of equation  ( [ giffit ] ) ( dashed ) , and the conditional distribution associated with the constant barrier , spherical collapse model of lacey & cole ( 1993 ) ( dotted ) .",
    "( the finite mass resolution of the simulations means that the distributions are artificially truncated at low masses . )",
    "notice that the spherical collapse based dotted curves are often quite different from the n - body simulation symbols .",
    "this discrepancy is similar to that first noticed by tormen ( 1998 ) ; haloes in the simulations seem to hold themselves together at higher redshift than the spherical collapse model predicts .",
    "notice also that , whereas the dashed curves we get by rescaling the unconditional halo mass function are certainly better fits to the cosmological simulations , the solid curves , in which the relation between the excursion set model and the conditional mass function are accounted for more carefully , are almost always even more accurate .",
    "=    following mo & white ( 1996 ) , knowledge of the conditional mass function allows one to estimate how the distribution of dark matter haloes today depends on the average density in which the haloes are .",
    "in essence , they argued that a dense region should be thought of as an object which will collapse and form a virialized halo in the near future .",
    "this means that the haloes in it today can be thought of as ` progenitor subhaloes ' viewed at ` low redshift ' .",
    "in contrast , it will be a much longer time before an underdense region collapses ( if it collapses at all ) , so the haloes within it today are like the progenitor haloes viewed at high redshift .",
    "in hierarchical models , massive haloes form later , and less massive haloes form earlier .",
    "the discussion above means that one expects haloes in dense regions to be more massive , on average , than in underdense regions .",
    "the precise dependence of halo mass on local density depends on the precise relation between the local density today and the effective ` redshift ' .",
    "mo & white used the spherical collapse model to provide this relation .",
    "they provided a simple fitting formula to this relation in an einstein - desitter universe .",
    "lemson & kauffmann ( 1999 ) and sheth & lemson ( 1999a ) showed that this provided a reasonably good description of how , in their simulations , the density of haloes depended on local density .",
    "we have checked that the following simple modification to their formula is reasonably accurate for all cosmologies of interest : @xmath82 , \\label{d0mow}\\end{aligned}\\ ] ] where @xmath83 is the nonlinear density of a region containing mass @xmath84 within the volume @xmath85 at @xmath86 , and @xmath87 denotes the critical density for spherical collapse at @xmath86 .",
    "the number density of @xmath12-haloes in regions of nonlinear density @xmath88 is got from the conditional mass function @xmath89 $ ] of equation  ( [ nmm ] ) .",
    "=    the previous section showed that , in fact , the conditional mass functions are better fit by ellipsoidal collapse based curves .",
    "therefore , one might reasonably expect that the same will be true for @xmath90 . to emphasize how similar @xmath90 is to the conditional mass function , we have chosen to do the following .",
    "we have divided the simulation volume up into into cubes , each @xmath91mpc/@xmath92 on a side .",
    "we then divided the cubes into three classes : the densest , and least dense ten percent of the cells , and the ten percent around the median density .",
    "[ fdscdm ] and  [ fdlcdm ] show @xmath93 for the haloes in the cells , plotted as a fraction of the mass of a cell .",
    "symbols with error bars show the measurements in the cosmological simulations , histograms show the associated random walk distributions , solid curves show our analytic approximation to the random walks , dashed curves show the result one gets by rescaling the unconditional mass function , and dotted curves are for the spherical collapse , constant barrier model .",
    "the curves for the three types of cells have been offset from each other for clarity ; the lowest density cells are the lowest curves , and they have not been shifted , average density cells have been shifted upwards by a factor of ten , and the densest cells have been shifted upwards by a factor of a hundred . in all cases , the random walk model provides the best fit to the simulation data .    notice how similar these curves appear to the conditional mass functions presented earlier . because most of haloes in the densest cells are a significant fraction of the total mass in the cell , the mass function in dense cells looks very like the low redshift conditional mass functions .",
    "in contrast , the mass function in underdense cells looks much more like the high redshift conditional mass functions .",
    "this is precisely what the model predicts",
    ".    figs .",
    "[ ndscdm ] and  [ ndlcdm ] show what this trend means for the actual number density of haloes in dense and less dense regions .",
    "the various symbols and curves are the same as in the previous two figures ; the only difference is that now the x - axes have been multiplied by the total mass in the cell to show physical , rather than relative masses .",
    "clearly , less dense cells have essentially no massive haloes .",
    "in addition , the ratio of massive to less massive haloes is higher in denser cells . in particular , note that the density of less massive haloes in dense regions is actually smaller than the density of less massive haloes in underdense regions .",
    "one might have thought that dense regions simply have more haloes on average .",
    "for example , one might have thought that @xmath94 .",
    "our figures show that this is wrong , but that a good estimate of @xmath90 can , nevertheless , be computed analytically .",
    "we conclude this section with the observation that our moving barrier based formulae provide a more accurate fit to the simulations than does the spherical collapse based constant barrier model .",
    "=    in the excursion set model with a constant barrier height , the unconditional mass function , when expressed as a function of @xmath95 , is expected to be a universal function which is independent of redshift , cosmology or initial power spectrum .",
    "in addition , if the conditional mass function is expressed in units of @xmath96 , then it is expected to have the same shape as the unconditional mass function .    the previous section we noted that , although the unconditional mass function is a universal function of @xmath29 , this function is not the one predicted by the constant barrier model .",
    "we argued that if we interpret the unconditional mass function as coming from a moving barrier , then we no longer expect the conditional mass function to be a universal function of @xmath29 .",
    "[ vfvscdm ] and  [ vfvlcdm ] show this explicitly : they show the result of applying this rescaling to the conditional mass functions in the scdm and the @xmath40cdm simulations we presented earlier .",
    "=    the four panels in each figure show the conditional mass function at each of the four redshifts we have been studying so far .",
    "the symbols show the result of rescaling the conditional mass functions in the simulations for parent haloes with mass in the range 1 - 2 ( filled circles ) and 8 - 32 @xmath97 ( open triangles ) at @xmath24 .",
    "notice that the symbols in each panel do not overlap exactly  at fixed @xmath8 , the conditional mass functions for different parent haloes do not rescale exactly .",
    "in addition , the band traced out by the symbols at @xmath41 is quite different from the band traced out at @xmath98 ; the mass functions at different output times do not rescale either .",
    "both these findings illustrate our main point : the conditional mass function is not a universal function of the scaling variable @xmath29 .",
    "=    the dotted curves which are the same in all the panels show the predictions of the constant barrier model ; they do not provide a good fit at any time for any mass range .",
    "the dashed curves which are also the same in all the panels show the result of assuming that , upon rescaling , the conditional mass function will have the same shape as the unconditional mass function ; although they provide a good fit at large @xmath8 , they are increasingly in error at small @xmath8 .",
    "this is true both for the scdm and the @xmath40cdm models .",
    "the solid lines in the various panels show the predictions of our moving barrier model . in this case , the predictions depend both on the parent mass range , and on the redshift at which the progenitors are identified : we have chosen to show the predictions for the 1 - 2@xmath97 haloes only . whereas the model is in reasonable agreement with the simulations at large @xmath8 , it has the wrong shape an small @xmath8 .",
    "this is not terribly surprising , because our formula for the first crossing distribution of the moving barrier model was only supposed to work at large @xmath8 , but it is unfortunate that the disagreement at low @xmath8 is so bad !",
    "one might have thought that the actual first crossing distribution may be in good agreement with the gif simulations , and that it is only the analytic approximation which is in error at small @xmath8 .",
    "unfortunately , this is not so .",
    "the histograms in fig .",
    "[ vfvlcdm ] show the result of simulating an ensemble of random walks to construct the conditional mass functions ; although they are in slightly better agreement with the simulations , they are still quite different .",
    "=    the discrepancy between the simulations and our moving barrier model predictions are most pronounced when the subclump mass is @xmath99 .",
    "this suggests that our model is unable to describe the histories of clumps at small lookback times . at small lookback times",
    ", one might worry that the spherical overdensity groupfinder we use to identify the subclumps in the simulations might find a different set of objects than a friends - of - friends algorithm .",
    "plots of the rescaled conditional mass function constructed using a friends - of - friends algorithm look very similar to the spherical overdensity results presented above ",
    "the discrepancy between model and simulations is independent of the choice of groupfinder .",
    "in addition , because the theory assumes that mass is conserved  all the mass of a subclump becomes part of the final halo ",
    "whereas this is not true in the simulations : some of the particles which make up the final object may have come from a subclump which merged along with most of its particles into a different object .",
    "this means that there is some freedom associated with how we decide if a clump at an early time should be counted as a subclump of a halo at the final time .",
    "we have tried two schemes for idenfifying subclumps : a progenitor is a clump which donates at least half its mass to the final object , or which donates at least one particle to the final object . once we have made this decision , we must also decide what we wish to count as the mass of the parent object : two natural choices are the mass at the final time ( which , by definition is fixed for all earlier redshifts ) , or the mass which is got by summing up the masses of all the progenitor subclumps ( which may depend on redshift ) .",
    "the figures above are for the case in which a subclump is any clump which donates at least one particle to the final object , and the parent mass is defined as the mass at the final time ( so it is independent of redshift ) .",
    "although the actual conditional mass functions depend slightly on which combination of the above choices we make , the generic results shown above are independent of this choice .    before moving on , we think it worth noting that the discrepancies between the scdm simulations and the dotted or dashed curves are qualitatively similar to the discrepancies in the @xmath40cdm case .",
    "this suggests that one should be able to find a model which can account for these discrepancies in a way which is independent of power - spectrum , redshift or cosmology .",
    "our moving barrier model is just not up to the task .",
    "the next section studies why .",
    "in the ellipsoidal collapse model envisaged by bond & myers ( 1996 ) and implemented by sheth , mo & tormen ( 2001 ) , the collapse of a patch is determined by the surrounding shear field . in a gaussian random field ,",
    "the field around a patch may differ from patch to patch .",
    "appendix  [ grfs ] provides a simple prescription for choosing a set of patches which have the correct ensemble averaged properties  in essence , this requires studying the first crossing distribution of six - dimensional random walks .    because a six - dimensional walk is computationally expensive , rather than choosing the distribution of initial patches from this exact statistical distribution , sheth , mo & tormen suggested it should be a good approximation to use an appropriately chosen mean value , and neglect the scatter around this value .",
    "this allowed them to reduce what is a six - dimensional random walk to a one - dimensional walk .",
    "it is this one - dimensional walk which we have considered so far .",
    "one might worry , however , that the discrepancy between model predictions and simulation results we found in the previous section may actually be due to our neglect of the scatter around the average value .",
    "the main purpose of this section is to study this possibility .",
    "=    =    fig .",
    "[ scattersmt ] shows the result of generating an ensemble of four thousand six - dimensional random walks associated with gaussian random fields as described in the appendix .",
    "the walks are stopped when they cross the barrier associated with the ellipsoidal collapse model of bond & myers ( 1996 ) .",
    "the crosses show the values of @xmath88 and @xmath21 at which the six - dimensional walks crossed the ellipsoidal collapse barrier @xmath100 : we actually used the simple fit , equation  3 in sheth , mo & tormen ( 2001 ) , to the critical density required for collapse @xmath100 .",
    "the solid curve shows the approximation used by sheth , mo & tormen ; it provides a rather good description of how @xmath101 increases with increasing @xmath21 .",
    "the appendix describes the reason for this in more detail . for",
    "now , we simply note that because the solid curve provides a reasonably good description of the crosses , the first crossing distributions of the six - dimensional walks considered here are unlikely to be very different from the first crossing distributions associated with the ( considerably simpler ) one - dimensional walks studied in the previous sections of this paper .    the two jagged curves in fig .  [ walk6d ]",
    "show this explicitly .",
    "they show the first crossing distributions associated with the six - dimensional walks which cross the @xmath24 and @xmath98 six - dimensional ellipsoidal collapse barriers .",
    "they have been rescaled similarly to how the unconditional mass functions in simulations rescale : @xmath102 .",
    "after rescaling , the two curves appear similar , as they should ; note that they are reasonably like the dashed curve , which shows equation  ( [ giffit ] ) , and they are rather different from the dotted curve which shows the spherical collapse prediction .",
    "recall that the dashed curve is very similar to the mass function one gets by simulating one - dimensional random walks . because the jagged curves are in quite good agreement with the dashed curve , the first crossing distributions associated with the six - dimensional walks are actually rather similar to those associated with the ( considerably simpler ) one - dimensional walks studied in the previous sections .",
    "this agrees with what our conclusions from fig .",
    "[ scattersmt ] .",
    "the appendix describes the reason for this in more detail .    having shown that the unconditional mass functions associated with the six - dimensional random walks are in reasonable with numerical simulations",
    ", we now turn to the conditional mass functions  the test which our one - dimensional random walks failed . the solid symbols with error bars show the conditional mass functions associated with the six - dimensional walks , expressed in the scaled units of the previous section : @xmath103 , where @xmath57 denotes the value of @xmath1 at which the @xmath98 six - dimensional boundary was crossed , and @xmath0 is the scale on which the lower @xmath24 six - dimensional boundary was crossed . note the excess of points at large values of @xmath29 ; these conditional mass functions are quite different from the conditional mass functions in simulations . indeed , the discrepancy between the excursion set predictions and the simulations of hierarchical clustering has got worse !    there are at least two reasons why the excursion set approach with one - dimensional random walks may fail at small lookback times .",
    "the first is the excursion set neglect of correlations between scales ( peacock & heavens 1990 ; bond et al .",
    "1991 ) . at large lookback times",
    "most subclumps are a small fraction of the mass of the parent halo , so the smoothing scale associated with the subclumps is sufficiently different from that of the parent that the neglect of correlations between the two scales is probably justified . at smaller lookback times the parent and subclump scales are not so well separated ,",
    "so the neglect of correlations is a more likely to be a bad approximation .",
    "this is one possible reason for the agreement at large lookback times despite the discrepancy at low redshift .",
    "the second possibility is that the one - dimensional parametrization of ellipsoidal collapse outlined by sheth , mo & tormen ( 2001 ) is too simple .",
    "the results of this section suggest that , in fact , it is the first possibility which is the cause of the discrepancy .",
    "sheth , mo & tormen ( 2001 ) argued that a simple modification to the original excursion set approach was enough to improve agreement between the predictions of the approach and numerical simulations .",
    "the modification they suggested was to the value of the linearly extrapolated critical overdensity @xmath104 associated with the collapse of an object .",
    "the spherical collapse model assumes that this value is independent of the mass of the collapsed object , whereas ellipsoidal collapse makes @xmath104 depend on @xmath12 . in the context of the excursion set approach",
    ", this corresponds to studying the first crossing statistics of a set of moving , rather than constant barriers .",
    "we also argued that a moving barrier also provides a simple way in which the excursion set appraoch can be extended to apply to models in which the initial dark matter distribution is not completely cold .",
    "because moving barrier models are so useful , we provided analytic approximations for the required first crossing distributions ( equations  [ taylors ] and  [ fss ] ) , and showed that they were reasonably accurate .",
    "although our formulae for the conditional mass functions ( solid curves in figs .  [ clcdm][ndlcdm ] ) are slightly different from , and usually more accurate than , those one obtains by a simple rescaling of the unconditional mass function ( dashed curves in the same figures ) , this simple rescaling of the unconditional mass function is still more accurate than what one gets if one rescales the constant barrier formulae ( dotted curves ) .",
    "we showed that the predicted unconditional and conditional mass functions were in reasonably good agreement with results from numerical cosmological simulations ( figs .",
    "[ clcdm][ndlcdm ] ) , and we also provided a simple efficient algorithm which allows one to generating masses which have the correct universal mass function ( section  [ generate ] ) .",
    "however , we showed that neither the constant nor the moving barrier models were able to describe the simulation results at small lookback times ( figs .  [ vfvscdm ] and  [ vfvlcdm ] ) .",
    "this means that our results for the conditional mass functions can not be used to generate realizations of the forest of merger history trees .",
    "we argued that this discrepancy was most likely due to the excursion set approach s neglect of correlations between scales ( e.g. peacock & heavens 1990 ; bond et al .",
    "1991 ; monaco 1997b ) .",
    "while this neglect is a bad approximation at small lookback times , it is reasonably accurate at large lookback times .",
    "this is why the excursion set approach is able to provide a reasonably good description of clustering at high redshift , even though it is inaccurate at small redshifts .    before concluding",
    ", we will consider how some of our results are related to other work in the literature .",
    "recently , jenkins et al .",
    "( 2001 ) showed that , although the mass functions in their simulations scaled in accordance with the excursion set prediction , our equation  ( [ giffit ] ) slightly overestimated the unconditional mass functions in their simulations .",
    "we thought it would be interesting to show the various approximations to the mass function which we presented in this paper on one plot .",
    "the dot - dashed curve in fig .",
    "[ hblvol ] , with cutoffs at low and high masses shows the fitting function jenkins et al .",
    "proposed , which fits their simulations well , the dashed curve shows the fitting formula of equation  ( [ giffit ] ) with @xmath73 ( following sheth & tormen 1999 ) , the histogram shows the distribution one gets by simulating random walks with the ellipsoidal collapse moving barrier ( equation  [ bec ] , following sheth , mo & tormen 2001 ) , the solid curve shows our approximate formula for this first crossing distribution ( equation  [ taylors ] ) , and the dotted curve shows the spherical collapse , constant barrier prediction ( press & schechter 1974 ; bond et al .",
    "simulations currently available do not probe the regime where @xmath105 or so ( the jeans mass is at about @xmath106 ) .",
    "=    =    the upper set of curves show the residuals between our formulae and the one provided by jenkins et al .",
    ", in the regime to the right of the low - mass cut - off ( marked by an arrowhead ) .",
    "in addition to the previously mentioned formulae , we have included a new dashed curve which shows the result of changing @xmath30 in equation  ( [ giffit ] ) from 0.707 to 0.75 .",
    "this simple change appears to be all that is necessary to reduce the discrepancy between it and the simulations substantially .",
    "our formula differs dramatically from the one jenkins et al .",
    "propose at small masses .",
    "we hope that simulations in the near future will be able to address which low mass behaviour is correct .    to illustrate that our formulae really do work for a large class of barrier shapes , fig .",
    "[ monaco ] shows the first crossing distribution associated with the barrier discussed by monaco ( 1997a , b ) : @xmath107,\\ ] ] where , as throughout this paper , @xmath108 .",
    "the height of this barrier decreases with @xmath0 , so it really is quite different from ours ( sheth , mo & tormen 2001 discuss the physical reason why ) .",
    "( we chose not to present results for the barrier shape studied by del popolo & gambera ( 1998 ) because their shape is not so different from ours , whereas monaco s really is quite different .",
    "the fact that this barrier decreases with @xmath0 means that all walks are guaranteed to cross it , and that there is no fragmentation associated with this barrier shape .",
    "( this is in contrast to barriers whose height increases sufficiently strongly with @xmath0 ; for the sheth , mo & tormen 2001 barrier shape studied in the main text , unbound mass and fragmentation are features which are formally possible but rare in practice . )",
    "the histogram shows the numerical monte - carlo first crossing distribution , and the two solid curves shows our analytic approximation , computed by inserting this barrier shape into our equation  ( [ taylors ] ) .",
    "the curve which provides a slightly worse fit to the histogram shows the result of using the first five terms in the series ( as we did for the other figures in this paper ) ; the other curve shows what happens if we use the first ten terms instead .",
    "just for comparison , the dotted and dashed curves show the spherical collapse prediction , and the one which actually fits the cosmological simulations ( equation  [ giffit ] ) .",
    "the figure shows that we are able to describe the first crossing distribution of this barrier shape well .",
    "this means that one could , in principle , use our formula , with monaco s barrier , to study the conditional mass functions associated with his parametrization of nonlinear collapse  we have not pursued this further , although comparison of this first crossing distribution with the @xmath98 panels in figs .",
    "[ vfvscdm ] and  [ vfvlcdm ] suggest that this might be a useful exercise .    in summary ,",
    "we have provided a formula which describes the first crossing distribution of independent uncorrelated brownian motion random walks , for a wide class of moving barriers .",
    "this formula can be used to provide simple accurate predictions for a number of statistical quantities associated with the formation and clustering of dark matter haloes , all within the same formalism .",
    "many thanks to lauro moscardini for his realistic skepticism that this project would ever be completed !",
    "we thank the tmr european network `` the formation and evolution of galaxies '' under contract erbfmrx - ct96 - 086 for financial support .",
    "rks is supported by the doe and nasa grant nag 5 - 7092 at fermilab .",
    "he thanks the astronomy department at the university of padova for hospitality in may 2000 .",
    "the n - body simulations used in this paper are publically available at http://www.mpa-garching.mpg.de/numcos .",
    "the simulations were carried out at the computer center of the max - planck society in garching and at the epcc in edinburgh , as part of the virgo consortium project , the members of which we would also like to thank .",
    "99 bode p. , ostriker j. p. , turok n. , 2001 , apj , to appear bond j. r. , cole s. , efstathiou g. , kaiser n. , 1991 , apj , 379 , 440 bond j. r. , myers s. , 1996 , apjs , 103 , 1 chiueh t. , lee j. , 2001 , apj , accepted del popolo a. , gambera m. , 1998 , aa , 337 , 96 heavens a. f. , peacock j. a. , 1988 , mnras , 232 , 339 jenkins a. , frenk c. s. , white s. d. m. , colberg j. m. , cole s. , evrard a. e. , couchman h. m. p. , yoshida n. , 2001 , mnras , 321 , 372 lacey c. , cole s. , 1993 , mnras , 262 , 627 lacey c. , cole s. , 1994 , mnras , 271 , 676 lemson g. , kauffmann g. , 1999 , mnras , 302 , 111 mo h. j. , white s. d. m. , 1996 , mnras , 282 , 347 mo h. j. , jing y. , white s. d. m. , 1997 , mnras , 284 , 189 monaco p. , 1997a ,",
    "mnras , 287 , 753 monaco p. , 1997b ,",
    "mnras , 290 , 439 nusser a. , sheth r. k. , 1999 , mnras , 303 , 685 peacock j. a. , heavens a. f. , 1990 , mnras , 243 , 133 press w. , schechter p. , 1974 ,",
    "apj , 187 , 425 sheth r. k. , 1996 , mnras , 281 , 1277 sheth r. k. , pitman j. , mnras , 289 , 66 sheth r. k. , 1998 , mnras , 300 , 1057 sheth r. k. , lemson g. , 1999a , mnras , 304 , 767 sheth r. k. , lemson g. , 1999b , mnras , 305 , 946 sheth r. k. , tormen g. , 1999 , mnras , 308 , 119 sheth r. k. , mo h. j. , tormen g. , 2001 , mnras , 323 , 1 tormen g. , 1997 , mnras , 290 , 411 tormen g. , 1998 , mnras , 297 , 648",
    "suppose that the barrier shape increases linearly with increasing variance @xmath109 : @xmath110 where @xmath111 and @xmath112 if @xmath113 .",
    "these scalings with @xmath8 are what is required by the self - similarity of brownian motion . in the bond et",
    "1991 ) formulation of the constant barrier problem , it is customary to express the @xmath0 axis in the units it had at some fiducial time , say @xmath24 , and to study the successive crossings of barriers having different values of @xmath8 . in effect , the constant height press  schechter barrier has @xmath114 , so in that case only the scaling of the @xmath115-axis was apparent .",
    "this linear barrier shape is motivated by the observation that the gif simulations have fewer low mass haloes relative to high mass ones , as compared to what is predicted by the constant barrier model .",
    "this means that , at least for some range of @xmath0 , the moving barrier must have a positive slope , since this would make it relatively easier to cross at small @xmath0 ( large mass ) than at large @xmath0 ( small mass ) , as compared to a barrier of constant height .",
    "an additional reason for considering this linear barrier is the following .",
    "recent work ( bode , ostriker & turok 2001 ) suggests that the halo mass function in which the dark matter is warm initially has even fewer low mass halos than cold dark matter based ellipsoidal collapse models predict . in the context of the approach outlined by sheth , mo & tormen ( 2001 ) ,",
    "the physical reason for this is relatively simple : low mass haloes do not form because they are hotter initially , so a larger overdensity is required to hold them together against the thermal pressure which prevents collapse , or against the stronger shearing from the velocity field .",
    "this suggests that the critical density required for collapse by the present time , @xmath116 , should increase even more strongly with decreasing @xmath12 than it does when the dark matter is cold .",
    "the warm dark matter model is not particularly well motivated , and its free parameters have not yet been fixed , it seems premature to provide a detailed @xmath117 relation at the present time . for this reason ,",
    "the linear barrier considered in this appendix should be thought of as an example of what happes when the barrier height increases even more steeply with decreasing mass than it does in the sheth , mo & tormen cold dark matter models .    in the constant barrier model ,",
    "all random walks were guaranteed to cross the barrier .",
    "this is because the rms height of random walks at @xmath0 is proportional to @xmath118 , so at sufficiently large @xmath0 , all walks will have crossed the constant barrier . as a result ,",
    "the associated first crossing distribution is normalized to unity : since each random walk is associated with a volume element in the initial lagrangian space , this is usually interpretted as meaning that , in the constant barrier model , all the mass in the universe is bound up in collapsed objects of some mass , however small .",
    "in contrast , the linear barrier  ( [ linbar ] ) increases to arbitrarily high values at high @xmath0 . because the rms height of the random walk grows more slowly than the rate",
    "at which the barrier height increases , there is no guarantee that all random walk trajectories will intercept this barrier .",
    "indeed , only a fraction @xmath119 of them will .",
    "so , in the linear barrier model , not all initial volume elements are associated with bound haloes . since not all particles in numerical cosmological simulations",
    "are associated with bound haloes anyway ( the fraction of unbound mass is typically on the order of @xmath12010% , though how much of this is a consequence of limited resolution in the simulations is uncertain ) , this feature of the moving barrier model may or may not be a good thing . in any case",
    ", this is one qualitative difference between the moving boundary model and a model with constant barrier height .",
    "( readers who dislike this feature of the linear model are invited to patch a constant barrier of height @xmath121 at small @xmath0 to a linearly increasing one at intermediate @xmath0 to another constant one ( but now at at a greater height , of course ) at a large @xmath0 of their choice , and to compute the associated mass function ! this can be done relatively easily using the results presented below . )",
    "in addition to the question of normalization , barriers whose heights increase with @xmath0 more rapidly than @xmath122 will have mass functions in which the low mass end is depleted relative to the constant barrier case . in the linear barrier model studied below",
    ", the mass function has an exponential cutoff at both low and high masses .",
    "because the barrier shape associated with ellipsoidal collapse grows only as @xmath123 both these effects are extremely weak .",
    "nevertheless , it is worth bearing these features in mind as bigger and better simulations become available .",
    "the second important qualitative difference between a moving barrier model and the original constant barrier model is the following : whereas the @xmath115-intercept @xmath124 increases as @xmath8 increases , the slope decreases as @xmath125 .",
    "this means that it is possible for barriers to intersect at finite values of @xmath0 .",
    "for example , two linear barriers @xmath126 and @xmath127 , with @xmath128 , will intersect at that critical value of @xmath0 at which @xmath129 : @xmath130 .",
    "this means that all trajectories which first cross @xmath131 at @xmath132 must have crossed @xmath133 at a smaller value of @xmath0 .",
    "the logic of lacey & cole ( 1993 ) then says that all haloes at @xmath86 that are less massive than the associated critical mass @xmath134 were formed by fragmentation of a halo which , at @xmath128 , was more massive .",
    "again , this may or may not be a good thing .",
    "simulations show that @xmath12020% of the total mass ever associated with progenitors of a halo does not find its way to the parent halo ( tormen 1998 ) .",
    "presumably this reflects the fact that while small haloes may fragment , the fragmented mass is not a very large fraction of the total mass .",
    "simulations also show that some subclumps pass through the virial radius of a given parent halo a number of times , each time depositing some fraction of their mass , before they finally become part of the parent halo",
    ". it may be that a moving barrier model is able to incorporate and perhaps even quantify these effects .",
    "the first crossing distribution of trajectories that do cross the linear barrier is inverse gaussian : @xmath135 ( whitmore 1978 ; also see sheth 1998 ) .",
    "the associated unconditional mass function is got by inserting this in equation  ( [ fnunm ] ) . whereas the mass function in the constant barrier case has an exponential cutoff at the high mass end , the mass function in this linear barrier model has exponential cutoffs at both low and high masses .",
    "recall this arises from the fact that barrier height increases so rapidly at large @xmath0 .",
    "therefore , the mass function associated with this linear barrier has fewer small mass objects than the constant barrier predicts , in qualitative agreement with the gif simulations .",
    "( the agreement is certainly not quantitative , but the linear barrier is only used here for illustrative purposes . )    since a linear barrier is linear whatever the origin of the coordinate system , the solution to the two barrier problem is also inverse gaussian .",
    "that is , given @xmath128 and given that the first crossing of @xmath131 occured at @xmath136 , the probability that the first crossing of @xmath133 occurs in the range @xmath137 about @xmath138 is given by equation  ( [ invg ] ) , with the substitutions @xmath139 , and @xmath140 , where @xmath141 as was the case for the unconditional mass function , the height of this barrier diverges as @xmath142 , so not all trajectories intersect it .",
    "again , it seems reasonable to associate the fraction that do not with the fraction of the parent halo mass that is not associated with bound subclumps .",
    "( those readers who computed the mass functions associated with the patched constant  linear  constant barriers may disregard the previous two sentences , provided they first compute the associated two - patched - barrier problem ! )    the smooth solid curves in fig .",
    "[ lin2bar ] show this conditional distribution for a few representative choices of the parent halo mass @xmath84 .",
    "the parents were assumed to have formed at @xmath143 , and the progenitor distributions are shown at an earlier redshift @xmath144 .",
    "the underlying power spectrum was chosen to be the same as the gif scdm power spectrum .",
    "it is also straightforward to solve this problem numerically : for the values of @xmath84 shown in the figures , the histograms show the distribution generated by simulating the crossings of the higher linear barrier by @xmath145 random brownian motion trajectories that started at the initial positions @xmath68 , where @xmath69 is given by the gif power spectrum .",
    "this figure has been included mainly to show that our monte ",
    "carlo code works , because we will use the code in the next section .",
    "we have also verified that the numerical code gives the correct conditional and unconditional mass functions when the barrier heights are constant .    for completeness",
    ", we also show the bias relations associated with this model . following mo & white ( 1996 ) (",
    "also see sheth & tormen 1999 ) , the mean lagrangian bias between haloes and mass is @xmath146 the limit @xmath147 and @xmath148 is sometimes called the peak - background split . in this limit @xmath149 for the linear barrier model .",
    "massive haloes have small values of @xmath0 , so they have large values of @xmath29 .",
    "small haloes have @xmath150 .",
    "thus , in this limit , less massive haloes are unbiased relative to the mass , whereas massive haloes are positively biased . for comparison ,",
    "the corresponding limit for the constant barrier is @xmath151 thus , the predictions of the linear and constant barriers are similar for massive haloes , but they differ for less massive ones",
    ". in particular , less massive haloes in lagrangian space are anti - biased in the constant barrier model , whereas they are unbiased in the linear barrier model .",
    "the halo - to - mass bias in the evolved eulerian space for the constant barrier can be computed by expanding @xmath152 - 1 \\label{biase}\\ ] ] to lowest order in @xmath88 ( mo & white 1996 ) . in this limit , @xmath153 , so @xmath154/\\delta_1)\\,\\delta$ ] for the constant barrier .",
    "the same logic gives @xmath155 for the linear barrier .",
    "again , the predictions of the constant and linear barriers agree for massive haloes , but are different for less massive ones ; the haloes in the linear barrier model are more positively biased .",
    "this is encouraging , because , as mentioned in the introduction , this is in qualitative agreement with the trend seen in numerical simulations .    the rate of increase of the ellipsoidal collapse barrier is shallower than for the linear barrier discussed here .",
    "since it is intermediate between the linear barrier and the constant spherical collapse barrier , we might reasonably expect the large scale bias factor of less massive haloes in the ellipsoidal collapse model to be greater than that associated with the spherical collapse model .",
    "since the ellipsoidal collapse barrier rises less steeply than linear , the modified large scale bias will be somewhat less than the linear barrier prediction .",
    "4 of sheth , mo & tormen ( 2001 ) shows that this is , indeed , the case .",
    "we argued at the start of this section that warm dark matter models can be parametrized by making the critical density for collapse depend more strongly on mass than when the dark matter is cold . in this respect ,",
    "a comparison of the linear barrier formulae given here with the results for the barrier written down by sheth , mo & tormen ( 2001 ) shows why , generically , warm dark matter models are expected to have fewer low mass haloes and , consequently , different bias relations , particularly at the low mass end , than cold dark matter models .",
    "this is in qualitative agreement with the numerical simulations of bode , ostriker & turok ( 2000 ) .",
    "let @xmath156 , where @xmath157 is the initial potential , denote the various components of the deformation tensor @xmath158 ( here @xmath159 and similarly for @xmath160 ) .",
    "following , e.g. bardeen et al .",
    "( 1986 ) , these components are @xmath161 where the @xmath162s are independent gaussian variates with zero mean and variance @xmath1 .",
    "poisson s equation says that the trace of this matrix , tr@xmath163 equals the overdensity @xmath88 .",
    "thus , @xmath164 the final expression shows explicitly that @xmath88 is a gaussian random variate .",
    "the eigenvalues of this matrix are the roots of the characteristic equation @xmath165              = -a_0 - a_1 \\lambda - a_2 \\lambda^2 - \\lambda^3,\\ ] ] where @xmath166 is the identity matrix , and the @xmath167s are various combinations of the @xmath168s got by expanding the expression above and ordering by powers of @xmath169 . since @xmath158 is a @xmath170 real symmetric matrix , @xmath171 is a cubic with three real roots which satisfy @xmath172 because rotations leave the trace unchanged , the overdensity @xmath88 is the sum of the three eigenvalues , so @xmath173 .",
    "in addition , the square of the angular momentum is proportional to @xmath174 ( e.g. heavens & peacock 1988 ; catelan & theuns 1998 ) .",
    "this shows that to get @xmath175 we do nt need to solve the cubic  we just need to read off the appropriate coefficients of the characteristic equation .",
    "thus , we find that @xmath176 although the first line suggests that @xmath175 is coupled to @xmath88 , the final expression shows that it is not . in particular , the expressions above show that @xmath88 is distributed as a gaussian , and @xmath175 is an independent variate drawn from a chi - square distribution with five degrees of freedom , @xmath177 .",
    "the fact that the overdensity and the square of the angular momentum are independent does not seem to have been noticed before .",
    "a @xmath177 distribution is rather similar in shape to a lognormal , so this provides a simple way to see why spins of peaks in gaussian random fields are also approximately lognormal ( heavens & peacock 1988 ) .",
    "the results above can be used to generalize the excursion set algorithm studied in the main text . set @xmath178 and @xmath179 for @xmath180 .",
    "thereafter , at each step labeled by @xmath181 , choose six , rather than one , independent gaussian random variates @xmath182 , each with variance @xmath57 .",
    "for each @xmath183 set @xmath184 , and use these to compute @xmath88 and @xmath175 .",
    "these can be used to give the values of the overdensity and the angular momentum for the scale on which the variance is @xmath185 ( recall that @xmath181 is the number of steps taken ) .",
    "now check to see if @xmath186 exceeds a critical value , say @xmath187 .",
    "if it does , the six - dimensional walk stops at this scale . if not",
    ", the walk continues to smaller scales .",
    "because each of the @xmath182s is chosen independently of the values of the @xmath162s or of @xmath21 , the walk takes independent steps in the six - dimensional space ; it is in this sense that this algorithm generalizes the one - dimensional excursion set random walk studied in the main body of this paper .",
    "the analysis above shows clearly that the one - dimensional random walk approach of sheth , mo & tormen ( 2001 ) corresponds to the following approximation .",
    "replace the dependence of @xmath187 on the random variate @xmath175 by a dependence on its average value @xmath188 .",
    "this means that the critical density for collapse is a function of @xmath21 alone , @xmath189 . as a result ,",
    "the random walk in six - dimensions can be reduced to a walk in one - dimension only , thereby greatly reducing the complexity of the problem .",
    "recently just such a six - dimensional random walk algorithm has been used by chiueh & lee ( 2001 ) , although they did not notice the considerable simplifications which follow from the algebra presented above .",
    "they simulated an ensemble of six - dimensional random walks , and set the parameters of the barrier to be crossed by requiring that the resulting first crossing distribution give the unconditional mass function .",
    "in particular , they showed that @xmath190^{0.15}$ ] provided a good fit to the required critical value of the overdensity .",
    "the algebra above allows one to see what such an approach implies . to do this , suppose the barrier is @xmath191 .",
    "the dependence on @xmath175 means that if the particle has walked to @xmath192 , it will still not have crossed , because @xmath175 is always certainly greater than zero .",
    "so , to cross , the particle needs to have some @xmath193 .",
    "how much greater ?",
    "this depends on the typical value of @xmath175 . because @xmath175 is drawn from a @xmath194 distribution , @xmath195 .",
    "now suppose that the @xmath194 distribution is very sharply peaked at its mean value ( it quite well peaked , but taking the extreme case helps to see the argument ) .",
    "this means that the barrier shape is something like @xmath196 .",
    "the fact that a @xmath194 distribution is not very sharply peaked at its most probable value simply means that sometimes when @xmath197 the particle will still be less than @xmath101 , so the walk must go on .",
    "of course , sometimes @xmath198 , and in this case the walk will stop even if @xmath199 .",
    "so , this means that we can think of the dependence on @xmath175 as making the critical value of the boundary height , when expressed as a function of @xmath1 ( the way sheth , mo & tormen 2001 did ) a little fuzzy .",
    "so , provided the @xmath194 distribution is not too broad , the considerably simpler one - dimensional random walk approach of sheth , mo & tormen ( 2001 ) should be a reasonable approximation .",
    "[ ecscatter ] shows the result of doing this for two choices of the barrier shape , both of which produce first crossing distributions which , when inserted into equation  ( [ fnunm ] ) , give mass functions of bound objects which are similar to the one in simulations of hierarchical clustering .",
    "the upper panel was constructed using a barrier whose height increased linearly with @xmath175 , and the lower panel shows results for the barrier shape used by chiueh & lee ( 2001 ) , which increases as @xmath200 .",
    "the crosses show the values of @xmath88 and @xmath21 at which each six - dimensional random walk crossed the barrier .",
    "the solid curve shows the approximation used by sheth , mo & tormen ( 2001 ) ; it provides a reasonable description of the increase of @xmath101 with @xmath21 .    determining the barrier shape by requiring agreement with the clustering simulations is unsatisfying , especially in view of the fact that the two different boundaries given above provide equally adequate approximations to the mass function . for this reason ,",
    "the main text shows the result of combining the six - dimensional walk described above with the ellipsoidal collapse model of bond & myers ( 1996 ) .",
    "this was relatively easy to do , because a simple fitting function for how the critical collapse boundary associated with this ellipsoidal collapse depends on the initial shear field has been given by sheth , mo & tormen ( their equation  3 and their fig .  1 ) ."
  ],
  "abstract_text": [
    "<S> the excursion set approach allows one to estimate the abundance and spatial distribution of virialized dark matter haloes efficiently and accurately . </S>",
    "<S> the predictions of this approach depend on how the nonlinear processes of collapse and virialization are modelled . </S>",
    "<S> we present simple analytic approximations which allow us to compare the excursion set predictions associated with spherical and ellipsoidal collapse . </S>",
    "<S> in particular , we present formulae for the universal unconditional mass function of bound objects and the conditional mass function which describes the mass function of the progenitors of haloes in a given mass range today . </S>",
    "<S> we show that the ellipsoidal collapse based moving barrier model provides a better description of what we measure in the numerical simulations than the spherical collapse based constant barrier model , although the agreement between model and simulations is better at large lookback times . </S>",
    "<S> our results for the conditional mass function can be used to compute accurate approximations to the local - density mass function which quantifies the tendency for massive haloes to populate denser regions than less massive haloes . </S>",
    "<S> this happens because low - density regions can be thought of as being collapsed haloes viewed at large lookback times , whereas high - density regions are collapsed haloes viewed at small lookback times . </S>",
    "<S> although we have only applied our analytic formulae to two simple barrier shapes , we show that they are , in fact , accurate for a wide variety of moving barriers . </S>",
    "<S> we suggest how they can be used to study the case in which the initial dark matter distribution is not completely cold .    </S>",
    "<S> galaxies : clustering  cosmology : theory  dark matter . </S>"
  ]
}