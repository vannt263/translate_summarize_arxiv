{
  "article_text": [
    "measurement of the effects of weak gravitational lensing has become a key technique in the arsenal of methods used to measure the distribution of matter , both associated with individual objects such as galaxy clusters or individual galaxies , and on large - scales through the measurement of ` cosmic shear ' .",
    "a key advantage of such measurement is that it directly measures the total matter distribution , generally dominated by the dark matter component , which may then be related directly to theory without needing to understand the uncertain effects of the physics of baryons in galaxies , provided one avoids the highly nonlinear regime ( @xcite , @xcite , @xcite ) . through the use of photometric redshifts ,",
    "three - dimensional analyses @xcite can be used to further measure both the cosmological growth of structure and the values of cosmological parameters @xcite . until recently such surveys have been of limited size , but even so the results obtained provided useful constraints on cosmological parameters and an important test of the values deduced from other methods .",
    "one long - standing puzzle has been that the range of values for the power - spectrum normalisation parameter @xmath0 found by weak lensing analyses has tended to be higher than found by some other methods ( see the discussion in @xcite ) , an effect that persists at some level in the latest studies . for the best fit 3-year wmap value of the matter density parameter @xmath1",
    ", the 3d analysis of @xcite finds the value @xmath2 , and the 2d analysis of @xcite finds @xmath3 .",
    "these results can be compared with the 3-year wmap value @xmath4 @xcite .",
    "measurement of the effect of weak gravitational lensing requires the statistical analysis of large samples and is sensitive to any systematic errors in measured quantities .",
    "possible systematic errors in lensing signals introduced by uncertainty in photometric redshifts has been discussed by @xcite .",
    "another fundamental concern with the method is whether the shapes of galaxies , that are used to deduce the signal , may be measured in an unbiased manner .",
    "the problem of shape measurement in optical imaging data is that galaxy images are convolved with a possibly - varying point - spread function ( psf ) which must be accurately corrected for when deducing galaxy shape .",
    "convolution with the psf tends to make galaxy images appear rounder ( for reasonably circularly symmetric psfs ) whereas addition of photon shot noise has the systematic effect of tending to make round galaxies appear less round .",
    "these two observational effects thus tend to work in opposite senses , and are independent of each other , so that both accurate psf correction and calibration to remove the effects of noise on shape are required .",
    "following the seminal paper by @xcite there have been many suggestions for possible measurement processes , that are discussed by @xcite and @xcite as part of the ` shear testing program ' ( step ) .",
    "those papers discuss 18 published methods for shear measurement .",
    "the existence of so many suggested methods implies that no consensus has yet emerged on the best way to measure weak lensing signals , and therefore naturally leads us to ask whether there might in fact be one method that may be regarded as being optimal . in this paper",
    "we investigate whether a model - fitting approach to galaxy shape measurement can both achieve this aim of optimal measurement and also be constructed such that it is computationally feasible for large surveys .",
    "in the following we shall suppose that galaxies may be characterised by a measurement of their ellipticity * e * and that a weak lensing signal , such as cosmic shear , may be inferred either from the mean ellipticity or from some form of cross - correlation of the ellipticities of different galaxies .",
    "we can stipulate a number of requirements that a weak lensing measurement technique should satisfy .",
    "1 .   optimal measurement of lensing signal , in the sense of maximum signal - to - noise .",
    "2 .   unbiased measurement of lensing signal .",
    "3 .   ability to calculate the statistical uncertainties of the measurement",
    ".    a standard approach that in principle allows us to meet these criteria is that of model - fitting , which is the method discussed in this paper .",
    "we first discuss some general principles , including whether we should use a frequentist or bayesian approach and how shear may be measured in an unbiased way from a bayesian posterior probability distribution . however , the principal disadvantage of a model - fitting approach is that it might be computationally prohibitive for very large surveys . in section[lensfitsection ] we discuss a novel galaxy shape model fitting algorithm that allows good estimation of the likelihood surface in a usefully short computational time .",
    "we also discuss the evaluation of shear sensitivity within the bayesian framework , that allows individual galaxy contributions to be assessed and unbiased estimation of shear to be made , fulfilling the second criterion above . some initial results and further considerations",
    "are then discussed .",
    "more detailed results from applying the algorithm to the step simulations are given in a companion paper ( kitching et al .",
    ", in preparation ) .",
    "the basic rationale for fitting a model of a galaxy s surface brightness distribution is that , if the family of models is a good representation of the true surface brightness profile , the highest possible signal - to - noise of the resulting parameters should be obtained .",
    "when model and data agree the model encapsulates the full information content of the data .",
    "although this has been recognised previously in weak lensing shape measurement @xcite , no implementation of weak lensing shape measurement methods published to date has this property , because the methods usually adopt some simplification of the surface brightness profile , such as assuming that second moments entirely characterise the profile ( e.g. @xcite,@xcite ) or equivalently assuming gaussian profiles or weights ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "model - fitting has been used for some time for detailed determination of galaxy surface brightness profiles and shapes ( e.g. * ? ? ?",
    "@xcite proposed model - fitting to averaged galaxy images specifically for weak lensing measurement , and @xcite proposed a method of measuring shear by fitting galaxies and psfs with multiple gaussian components .",
    "the latter method has been applied to surveys of weak lensing around galaxy clusters by @xcite , @xcite and @xcite , among others .",
    "a monte - carlo method is used to find best - fitting galaxy model parameters for each individual galaxy , where gaussian surface brightness profiles , or combinations of two gaussian profiles , are assumed for both galaxy and psf .",
    "shear measurement and the computational time required for that model - fitting method has been evaluated by @xcite .",
    "recently , sets of basis functions known as ` shapelets ' have been used to describe surface brightness profiles ( @xcite and the related work of @xcite ) but there is no requirement for the individual shapelet functions to match real galaxy profiles .",
    "moving to a pure model - fitting approach allows us to choose whichever brightness profiles we like , and for galaxies it clearly makes most sense to choose either exponential or de vaucouleurs surface brightness profiles .",
    "naturally , the above statements are qualitative , we do nt know _ how much _ improvement one obtains by fitting a profile that is closer to the actual profile , but the principle at least is a sound one , that we expect to satisfy the first of our criteria from the introduction .",
    "either frequentist model - fitting , based on determining the likelihood function , or bayesian model - fitting that determines the posterior probability distribution of model parameters , allow error estimates to be made , satisfying the third of our criteria .",
    "this is not the case for early versions of weak lensing shear estimators , although error estimates have been made in some recent methods @xcite .",
    "finally , we should address the question of whether a method can be determined to be unbiased .",
    "this is a serious issue for weak lensing studies , where the signal is so small that even a small systematic bias can have a devastating effect .",
    "evaluation of existing methods by step demonstrate that they are indeed biased , with significant magnitude - dependent biases that need to be corrected empirically from comparison with simulations @xcite .",
    "we discuss in the next section why in principle a bayesian method should be unbiased provided a correct choice of prior is made , but note that realistic implementations result in a quantifiable bias that may be corrected for .",
    "we have previously mentioned the problem of shape measurement , that not only is the shape changed by convolution with the psf , but also noise biases the measured shape , and in general tends to make nearly - circular objects systematically appear more elliptical .",
    "we discuss in this section how a bayesian method may be formulated that precisely corrects for this phenomenon , provided we make a correct choice of prior .",
    "consider a set of observations of @xmath5 galaxies that yields the surface brightness distribution for each galaxy denoted by a vector of pixel values @xmath6 .",
    "the shape of each galaxy may be characterised by its two - component ellipticity @xmath7 : the particular definition we choose for @xmath7 in this paper is given in section[shearestimation ] but what follows below applies to any shape estimator that we may choose . if the sample of galaxies has a probability distribution of intrinsic ellipticities ( i.e. the value of ellipticity that would be measured by the observer in the absence of degradation by the psf or by noise ) @xmath8 , then the probability distribution of @xmath6 is @xmath9 where @xmath10 is the probability distribution for @xmath6 given @xmath7 .    for each of these galaxies we can generate a bayesian posterior probability distribution for its ellipticity @xmath11 where @xmath12 is",
    "the ellipticity prior probability distribution and @xmath13 is the likelihood of obtaining the @xmath14 set of data values @xmath15 given an intrinsic ellipticity @xmath7 .",
    "we would hope that the true distribution of intrinsic ellipticities can be obtained from the data by considering the summation over the data : @xmath16 where on the rhs we are integrating over the probability distributions to obtain the expectation value of the summed posterior probability distribution for the sample .",
    "we can see that this will be achieved if both @xmath17 and @xmath18 , assuming the likelihood is normalised , @xmath19 , from which we obtain @xmath20    the strength of this result is that we can in principle recover statistically knowledge of the intrinsic distribution of shapes independently of assumptions about the shapes of the likelihood surfaces : in particular the likelihood surfaces for ellipticity measurement must be non - gaussian , being bounded at @xmath21 , but this has no effect on the results we expect .",
    "this result parallels the analogous result discussed by @xcite for the case of bayesian photometric redshift estimation .",
    "it says that we must know the mechanism by which data values are generated in order to construct the likelihood function , and that we must know the expected distribution of intrinsic ellipticities , in which case the summed posterior probability distribution will recover that intrinsic distribution .",
    "it might be thought that a bayesian approach then has a non - useful requirement , that we need to know the answer before we start , but the point of course is that with the correct choice of prior we then expect the posterior probability distribution for each _ individual _ galaxy to yield an unbiased estimate of ellipticity , and those sets of individual posterior probability distributions may then be used to infer the spatially varying shear arising from gravitational lensing .",
    "we discuss in section[sec : prior ] one possible method for creating the correct prior .",
    "so far the framework has been described in a purely bayesian context , but we can also ask whether there is a frequentist equivalent of the above formalism : can weak lensing shear be measured using likelihood functions alone ?",
    "conversely , are there any disadvantages to using a bayesian method ?",
    "it is important to recognise that likelihood and bayesian estimators measure different things .",
    "we can illustrate this by considering a sample of galaxies ( say ) with some intrinsic property @xmath22 that we wish to determine from fitting to some measurements @xmath23 .",
    "we shall look at the results obtained with either a bayesian estimator , @xmath24 , or a likelihood estimator , @xmath25 ( the general considerations discussed here apply also to maximum likelihood estimators ) .",
    "suppose the intrinsic distribution of @xmath22 has a normal distribution of variance @xmath26 , and that for each @xmath22 drawn from this distribution the measurement process causes a normally distributed uncertainty of variance @xmath27 .",
    "fig.[example ] shows the results obtained in a monte - carlo realisation for the illustrative case @xmath28 , @xmath29 .",
    "the likelihood estimator is based on the function @xmath30 and in fig.[example ] is unbiased in the regression of input on estimated values .",
    "the bayesian estimator is based on the function @xmath31 and is unbiased in the regression of estimated on input values : that is , for a given set of measurements the bayesian estimator yields the best estimate of the input values .",
    "the likelihood estimator yields a distribution of measured values that is broader than the intrinsic distribution .",
    "notice however that the bayesian estimator yields a distribution that is _ narrower _ , despite the result of section[sampledistribution ] that the summed posterior probability distribution yields the intrinsic distribution if the correct prior is chosen .",
    "this apparent paradox is resolved by realising that each of the individual estimated values is associated with its own posterior probability distribution , so that the sum of the distributions is broader than the distribution of expectation values .",
    "while this might seem undesirable , this is inevitable in any noisy measurement process .    in the case of ellipticity shape measurement",
    ", we expect there to be other reasons why a likelihood estimator might be biased , in particular at large @xmath7 values or for low signal - to - noise , where the boundary @xmath32 renders the likelihood function asymmetric and highly non - gaussian . with no prior",
    ", the strong degeneracy between size and ellipticity in the likelihood fitting can create regions of high likelihood at extreme values of ellipticity , and given the hard bound @xmath32 such an estimator can not be unbiased .    in the frequentist approach",
    ", it is also possible to estimate errors for the individual galaxies , and this is important to establish the contribution to the signal from each galaxy . as in the bayesian approach , we expect the information on shear to decrease as the signal - to - noise ( s / n ) decreases : even with an unbiased estimator @xmath33 it would be important to quantify this effect and allow for it in the shear estimation .",
    "a final consideration is that in weak lensing surveys we are not simply interested in measuring the shapes of individual galaxies , but rather in measuring the systematic lensing shear in a sample .",
    "usually this is measured from the mean ellipticity : thus it may be possible to have an ellipticity estimator that is biased but where the shear estimate from a sample is unbiased , or _",
    "vice versa_. if any bias were isotropic , corresponding to a bias in the value of @xmath34 but not in orientation , then we might hope that the bias would average out .",
    "however , even in this case we should not _ assume _ that the shear estimator @xmath35 is unbiased , since the likelihood functions for @xmath7 measurement must be non - gaussian and @xmath7-dependent , any shift @xmath36 in the distribution of @xmath7 caused by lensing would lead to bias in the estimated shear .",
    "however , even the bayesian method is not immune to the problem of bias , particularly in a realistic implementation of the bayesian method where we are forced to assume a zero - shear prior , as discussed below .",
    "but the bias can be quantified and the method provides a self - contained framework within which we can work out all the required quantities .",
    "this is the framework that we return to in the remainder of this paper .",
    "following @xcite we assume observed galaxy ellipticity @xmath7 is related to the intrinsic galaxy ellipticity @xmath37 in the weak lensing regime via : @xmath38 from @xcite , where @xmath7 is represented as a complex variable and @xmath36 , @xmath39 are the reduced shear and its complex conjugate respectively .",
    "@xmath7 is defined in terms of the major and minor axes and orientation @xmath40 respectively , as @xmath41 . in this formalism",
    ", we expect @xmath42 for an unbiased sample where @xmath43 , and so @xmath44 for a sample of galaxies is adopted as our estimator of @xmath36",
    ". note that this result differs from the other commonly used formalism where ellipticity is instead defined as @xmath45 .    for a population of galaxies , @xmath46 where @xmath8 is the ellipticity probability distribution for the sample .",
    "but in the bayesian formalism we can write a similar expression for an individual galaxy if we know its bayesian posterior probability distribution , @xmath47 hence for a sample of @xmath5 galaxies we can evaluate the sample mean as @xmath48 in practice we shall use the first of these expressions , as estimation of ellipticities for individual galaxies allows error estimates to be made for each galaxy , and its contribution to the signal to be evaluated .    however , in measuring shear we can not know in advance the correct prior to apply , even if we know the intrinsic unsheared ellipticity prior distribution , because the amount of shear varies over the sky in a way that we are attempting to measure .",
    "we must therefore use a prior that contains zero shear .",
    "the effect of this is that as signal - to - noise decreases , the measured ellipticity distribution tends to the prior , and in the limit of zero signal - to - noise no shear signal is recoverable .",
    "this is precisely what we should expect of course : no measurement method can extract a measured shear value from data with zero signal - to - noise , and a bayesian method is no different in that respect .",
    "a bayesian method does however allow us to estimate the magnitude of this effect for each individual galaxy .",
    "consider the bayesian estimate of ellipticity @xmath49 , defined above , that is measured for the @xmath50 galaxy , and express its dependence on each component of shear @xmath36 as a taylor series . for component @xmath51 , @xmath52 and similarly for component @xmath53 , where numeric subscripts indicate the components of @xmath7 and @xmath36 . in the weak lensing limit",
    "the cross - terms vanish .",
    "if we sum over @xmath5 galaxies in an unbiased sample we find @xmath54 we may optionally multiply both sides in equation[eqn : taylorseries ] by a statistical weight for each galaxy , @xmath55 .",
    "provided @xmath55 is uncorrelated with @xmath56 we may then define a weighted estimate of shear for the sample : @xmath57 for @xmath58 .",
    "we shall call @xmath59 the _ shear sensitivity_. it is a measure of how much each bayesian estimate is biased by the use of the zero - shear prior , and it takes values in the range @xmath60 , where the lower bound is expected in the limit of zero signal - to - noise .",
    "the upper bound would be attained in the case of ideal measurement at high signal - to - noise , where we expect no bias : in this case the bayesian measure is a good measure of the true ellipticity , regardless of which prior is assumed , and differentiating equation[eqn : weakshear ] yields unity for the shear sensitivity .",
    "the weights @xmath55 could in principle be tuned for optimal signal - to - noise in the measurement(s ) being made , such as the values of cosmological parameters .",
    "care should be taken that any weights that are a function of ellipticity do not introduce bias into shear measurement .",
    "since the shear sensitivity is effectively a measure of how much information about the effect of lensing is carried by each galaxy , the weights should themselves also include a dependence on @xmath59 , as well as on the measurement error and on the redshift - dependent cosmological effect of lensing on each galaxy .",
    "the shear sensitivity may be estimated for each galaxy and for the survey as a whole without recourse to external calibration from simulations , as described below .",
    "@xcite and @xcite have emphasised the utility of knowing the shear ` polarizability ' or ` responsivity ' for individual galaxies , as this not only allows accurate optimised shear measurement but also allows future surveys to be planned and optimised .",
    "the estimator @xmath61 is appropriate for a survey where the shear is uniform over some region ( and this is assumed in the step simulations discussed below ) , but in the more general case we instead infer the shear correlation function or some related quantity such as shear variance from a measurement such as @xmath62 . in this case we can compute the analogous estimator @xmath63    we now discuss possible approaches to calculating the shear sensitivity , first for normal prior and likelihood distributions , then for the more general case where the shear sensitivity may be evaluated numerically from the measured likelihood surfaces of individual galaxies .      as an illustration of the calculation of shear sensitivity ,",
    "suppose the prior is described by a normal distribution @xmath64 of variance @xmath26 and @xmath65 , and that the likelihood @xmath66 for a particular galaxy also has a normal distribution of variance @xmath27 centred on some value @xmath67 .",
    "it is straightforward then to show that the bayesian posterior probability @xmath68 also has a normal distribution of variance @xmath69 and expectation value @xmath70 . for perfect measurement of ellipticity ( @xmath71 )",
    "we expect equation[eqn : weakshear ] to hold , so for this galaxy @xmath72 . for more noisy measurement , we expect @xmath73 the shear sensitivity decreases as the measurement error increases . the value of the shear sensitivity is also given by the inverse of the slope of the regression of the intrinsic ellipticity on estimated ellipticity illustrated in fig.[example ] .",
    "the above illustration indicates that it is straightforward to calculate the shear sensitivity , however in general it would not be safe to assume normal distributions : not least because @xmath7 is defined such that @xmath32 , so when the measurement error becomes large @xmath66 can not be normally distributed .",
    "we discuss here one method of calculating the shear sensitivity numerically .",
    "we should emphasise that this can be done entirely internally to the fitting process , with no need to calibrate shear sensitivity externally from simulations .",
    "consider first the response of the posterior probability distribution to a small amount of shear .",
    "the prior probability does not depend on the shear in our implementation .",
    "let us assume that applying a weak lensing shear shifts the likelihood function by some small amount , @xmath74 and expand as a taylor series : @xmath75 then , substituting into @xmath76 and differentiating with respect to @xmath36 we find , @xmath77 as an estimate of weak lensing shear sensitivity .",
    "this expression is cast in terms of the derivatives of the likelihood surface multiplied by the prior : it may also be expressed in terms of derivatives of the prior multiplied by the likelihood : @xmath78.\\ ] ] this may be evaluated numerically from the posterior probability surface for each galaxy , and is preferred over the preceding expression in the case where the derivative of the prior is known analytically . for the case of normal distributions of @xmath64 and @xmath66 the expression yields the analytic result above .",
    "the technique we adopt for measuring @xmath44 and its uncertainty is to fit model galaxy surface brightness profiles to the data for individual galaxy images .",
    "the simplest galaxy model has six free parameters if the form of the surface brightness profile is fixed : central surface brightness , size , ellipticity and celestial position .",
    "the problem of fitting six parameters to large samples of galaxies is that this could be a time - consuming task , probably prohibitively so .",
    "however , we can greatly speed up the process if we can marginalise over any parameters that are not of interest to the weak lensing measurement .",
    "it turns out that _ for isolated galaxies _ it is straightforward to marginalise over three of the parameters , central surface brightness and position , if the model fitting is treated in fourier space , as described below . and because there exist fast fourier transform algorithms this approach can be done in a short amount of computational time .",
    "we can start by writing the statistic @xmath79 ^ 2\\\\ \\nonumber   & = & \\sum_i \\frac{y_i^2}{\\sigma_i^2 } + a\\left(c - b\\right)^2 -ab^2,\\end{aligned}\\ ] ] where @xmath80 is the data value in pixel @xmath81 , @xmath82 is the statistical uncertainty of that data value , @xmath83 is a model value for that pixel , @xmath84 is the model amplitude and where @xmath85 we assume the pixel noise is stationary and uncorrelated , which is appropriate for shot noise in ccd detectors in the sky - noise limit . bright galaxies may make a significant contribution to photon shot noise , but in this case the non - stationarity of the noise makes it not possible to work in fourier space .",
    "hence this algorithm is appropriate for model fitting to faint galaxies in the sky - limited regime .",
    "the method can be generalised to the case where the noise is stationary but correlated between pixels , and the example of radio interferometer observations is discussed qualitatively in section[radio ] .",
    "then if we adopt a prior @xmath86 for the model amplitude we can marginalise the likelihood @xmath87 over @xmath84 : @xmath88 we shall adopt a uniform prior for @xmath86 in the range @xmath89 .",
    "we expect @xmath90 , but if the galaxy is significantly detected the gaussian form of the likelihood causes the value of the prior to become unimportant at both large and small @xmath84 , and we can simplify the calculation by allowing @xmath91 and @xmath92 , so that @xmath93 however , although we have eliminated the amplitude @xmath84 , @xmath94 still depends on the model second moment , @xmath95 .",
    "thus we need to introduce the model constraint @xmath96constant , achieved by renormalising each model appropriately .",
    "since for a given dataset @xmath97 is also fixed , we can write @xmath98 when maximising .    we can also rapidly calculate the marginalisation over galaxy celestial position if we work in fourier space , writing @xmath99 we can simplify the various summations by assuming that we are dealing with faint galaxies in weak lensing measurement , such that @xmath82 is dominated by the background photon shot noise and is constant for all pixels . and since the model @xmath83 is real , @xmath100 and @xmath101 .",
    "if we introduce a shift @xmath102 into the model position , the new model becomes @xmath103 and @xmath104 where @xmath105 is the cross - correlation of the data @xmath80 with the model @xmath83 .",
    "so the likelihood becomes @xmath106.\\ ] ] to marginalise over @xmath102 we need to adopt a prior @xmath107 , but in this case it can not be uniform as @xmath108constant as @xmath109 and the marginalised likelihood would not be finite .",
    "this problem arises because , no matter how large a pixel value , it always has a finite chance of being due to random noise , with the true galaxy being positioned elsewhere .",
    "we shall adopt a prior which is centred on some assumed galaxy position that has been previously estimated and which falls off to zero at large distances : this is equivalent to assuming that a galaxy does indeed exist somewhere near the location we have chosen .",
    "we shall assume a prior which is symmetric and centred on the nominal galaxy position , which for convenience is at the coordinate origin , such as : @xmath110 the process of model fitting is seen from the above to be one of cross - correlating the data with a model .",
    "galaxies generally have smooth centrally - concentrated surface brightness distributions which are convolved with near - gaussian psfs in an observed image .",
    "the model is also smooth , centrally concentrated and convolved with the same psf . from the central limit theorem such a cross - correlation",
    "should be well represented by a two - dimensional gaussian distribution , @xmath111\\ ] ] where @xmath112 is the inverse covariance matrix and some shift @xmath113 of the maximum from the origin is allowed . in what follows",
    "we assume circular symmetry for simplicity , although this assumption may be removed without affecting the final result ( a two - dimensional gaussian distribution may always be transformed to a circularly - symmetric distribution by a coordinate transformation ) .",
    "if the cross - correlation function has the form @xmath114 $ ] then @xmath115 e^{-\\left |\\bmath{x}\\right |^2/2b^2 } \\mathrm{d}^2\\bmath{x},\\ ] ] where @xmath116 we could evaluate this by , for example , expanding the first exponential as a taylor series and hence obtaining a series solution for the marginalised likelihood .",
    "we could also evaluate it purely numerically , but this would require evaluation of the cross - correlation function on an extremely fine grid in order to achieve adequate accuracy .",
    "either of these approaches would be computationally expensive , and an alternative is to find an approximate value of the integral by writing @xmath117 - 1 + 1\\right\\ } e^{-\\left |\\bmath{x } \\right |^2/2b^2 } \\mathrm{d}^2 \\bmath{x}.\\ ] ] if @xmath118 , @xmath119 - 1\\right\\ } \\mathrm{d}^2 \\bmath{x}\\ ] ] and changing variables to a polar system centred on @xmath113 , @xmath120 - 1\\right\\ } r \\mathrm{d}r\\\\ & \\propto & \\frac{s^2 e^{\\beta } } { 2\\beta b^2 }   e^{-\\left | \\bmath{x}_0",
    "\\right |^2/2b^2 }    \\qquad \\beta\\gg 1 .",
    "\\label{eq : likelihood}\\end{aligned}\\ ] ] approximately , where the constant of proportionality has no model dependency provided @xmath121 is held invariant ( we could obtain a similar result more exactly if we were to adopt a top - hat prior for the galaxy position ) . if the width @xmath122 , amplitude @xmath123 and centroid @xmath113 of the cross - correlation function can be measured , the marginalised likelihood may be estimated from equation[eq : likelihood ] .",
    "it may seem that the requirement for a prior on position may be removed by allowing @xmath124 .",
    "however , this is an artefact of the approximation .",
    "there is no clear way of identifying a value for @xmath125 , but it should be set sufficiently small that confusion from other nearby galaxies is eliminated .    in the more general case , where the cross - correlation function is approximated by a bivariate gaussian with widths @xmath126 and @xmath127 in the two principal directions ,",
    "then equation[eq : likelihood ] is modified by @xmath128 .      using the above",
    ", the likelihood may be estimated for a given set of model parameters , marginalised over the ` uninteresting ' position and brightness of the galaxy .",
    "if we choose either an exponential disc or a de vaucouleurs model for the surface brightness , the free parameters are the scale - length and two ellipticity values @xmath7 , or equivalently the scale - length , the axial ratio and the orientation .",
    "the values of @xmath7 are restricted to lie in the range @xmath129 , and for faint galaxies the probability @xmath130 is broad , making a grid search in @xmath7 an easy and not - too - expensive approach .",
    "the resulting likelihood may be numerically marginalised over the galaxy scale - length , which is also ` uninteresting ' for weak lensing measurement , to obtain a likelihood surface that is a function of ellipticity alone .    to evaluate the cross - correlation function @xmath105 ( returning now to the general case where we do not assume circular symmetry ) we can use the fast fourier transform method , which proceeds as follows :    1 .",
    "generate a series of 2d galaxy surface brightness models on a three - dimensional grid in parameter space of scale - length and ellipticity .",
    "these models can be discrete fourier transformed and those transforms stored for use with all the galaxies .",
    "the choice of a grid of models allows a considerable multiplex gain to be realised : the models can be pre - generated on that grid and the same set used for fitting to every galaxy .",
    "2 .   estimate the surface brightness profile of the psf on the same pixel scale as the models .",
    "usually this would be done by stacking images of stars from the region of an image as the galaxies being measured .",
    "the psf can also be fourier transformed and stored .",
    "if the psf varies over an image or between images , the image may be divided into zones over which the psf is approximately invariant , and the fourier transform of the psf for each zone stored separately .",
    "if a mathematical model for the varying psf is known this may also be used to generate a smoothly varying psf ( e.g. * ? ? ?",
    "3 .   estimate the rms noise in each pixel from the entire image .",
    "4 .   identify a set of nominal galaxy positions to be measured , most likely from a separate image analysis tool such as sextractor @xcite .",
    "5 .   in turn for each galaxy , extract a sub - image centred on that galaxy , fourier transform it , and temporarily store the result .",
    "6 .   for this galaxy , take each possible model in turn , multiply by the transposed psf and model transforms to carry out the cross - correlation , measure the amplitude , width and position of the maximum of the resulting cross - correlation , and hence evaluate the likelihood for this model and galaxy .",
    "repeat for all models on the grid ( or for a subset of models if a more intelligent maximum - likelihood or mcmc search algorithm is being employed )",
    "numerically marginalise over the scale - length parameter . in the implementation described here",
    "we adopt a uniform prior for the distribution of galaxy scale - length .",
    "this could be replaced by a prior close to the actual distribution of galaxy sizes , although such a prior would need to be magnitude - dependent .",
    "discard the extracted data when all models have been explored , and repeat for the next galaxy .",
    "the result is a grid of likelihood values in ellipticity parameter space which thus defines the probability surface @xmath130 .",
    "the reduced shear may then be directly estimated from @xmath44 , and the uncertainty in individual @xmath7 values may be estimated from the width of the likelihood surface .    there is a significant multiplex gain obtained by fourier - transforming the models , the psfs and the data and storing the results .",
    "the time - consuming step then is the cross - correlation , which comprises some multiplications and a single inverse fourier transform to obtain the cross - correlation function .",
    "it is this multiplex gain , combined with the elimination of three parameters by marginalisation , that yields a fast fitting algorithm .",
    "the algorithm is approximate , in the sense that we require the cross - correlation amplitude to be high enough that @xmath131 , and also in that we assume the core of the cross - correlation function can be adequately modelled as a gaussian , and we have assumed that the pixel noise is invariant . this latter constraint may impose a maximum brightness limit on galaxies that may be fitted , as the pixel noise is not invariant in the case where the galaxy itself makes a significant contribution to the noise . for a fixed size of extracted region around each galaxy",
    ", there is also a maximum galaxy size that can be adequately measured .",
    "larger sizes are possible at the expense of greater computation time .    we note that , in this method , the final psf that is used is itself a convolution of psf components arising from the atmosphere , telescope and the pixel response of the detector .",
    "we do not need to distinguish the origin of the final psf that is used , the method takes a galaxy model and convolves that with an estimate of the final psf in order to cross - correlate with the data .",
    "ultimately however this , and all shape measurement methods , are limited by the extent to which the sampled data fully encapsulate the information in the sky : the effect of sampling is to alias spatial frequencies higher than the nyquist sampling frequency .",
    "this affects both the creation of the stacked psf and the model - fitting itself .",
    "if astronomical observations were band - limited this would not be a problem , but in reality some aliasing is inevitable . poorly sampled observations should ideally be `` dithered '' in order to reduce such aliasing effects .",
    "the algorithm has been implemented and tested on simulations provided for the ` shear testing program ' , step @xcite .",
    "images of galaxies were simulated for the canada - france - hawaii telescope with pixel scale @xmath132 .",
    "the simulations used here to demonstrate basic shape measurement are those with an isotropic psf of fwhm @xmath133 and zero lensing shear ( tests of shear measurement in the companion paper will cover all the simulated psf shapes and shear values ) .",
    "simulated galaxies with a mixture of bulge / disc components were used but all were fitted with a single exponential surface brightness profile .",
    "as here we are testing the bayesian method , and not our ability to locate galaxies , we use as input galaxy positions those that were used when making the simulations .",
    "we also adopt as the prior @xmath64 the input ellipticity distribution used in the simulations .    for these tests",
    "the size of each subimage was 32 pixels square .",
    "the choice of subimage size is a compromise between ( i ) having the subimage large enough that the galaxy surface brightness distribution is not unduly truncated and ( ii ) not allowing the computation time to become excessively long . in our initial implementation",
    "we have also required that only a single galaxy should occupy each subimage , thereby eliminating close pairs .",
    "the choice of 32 pixels for the step galaxies ensured that the subimage was larger than the half - light diameter in every case . in principle , the subimage size could be a function of galaxy size or brightness , but this sophistication would introduce some complexity into the code and has not been tested here .",
    "the likelihood was evaluated on a cartesian grid in @xmath7 , sampling at intervals of 0.1 out to a maximum axial ratio @xmath134 .",
    "the resulting galaxy shapes were found to be consistent for ellipticity grid intervals less than 0.1 for these step galaxies .",
    "the choice of grid interval may need to be adjusted for different surveys .",
    "the psf was created by stacking stars from the simulation , allowing sub - pixel registration using sinc - function interpolation .",
    "ultimately any shear measurement survey will be limited by the accuracy to which the psf is known .",
    "systematic psf errors will of course cause a systematic error in estimated shear , and if the psf varies on some angular scale within a survey this will imprint a signal on that scale on the shear power spectrum .",
    "this concern is common to all methods of shape and shear measurement , and we do not specifically address this problem here .",
    "an assumption of the fast fitting algorithm is that we are fitting to individual galaxies , and hence close pairs of galaxies can not be fitted with this algorithm . in practice one could identify such close pairs in the data at the galaxy - detection stage , and on those galaxies we could use a fitting algorithm that fits multiple components . in this case the full six parameters per galaxy would need to be fitted , with marginalisation over uninteresting parameters being carried out post - fitting .",
    "there would still be a significant speed advantage to be gained by using the fast fitting algorithm on the more isolated galaxies however . in this paper",
    "we focus on testing the bayesian method and the fast fitting algorithm , and hence in the results presented here we exclude cases where multiple objects are identified within a single galaxy sub - image .",
    "this procedure excludes 13percent of galaxies in the step simulations .",
    "some rejection of close pairs is required in most other methods of shape estimation also : in future , development of a fast multiple - component fitting algorithm might allow this constraint to be relaxed .",
    "we also test the fit returned by the fast fitting algorithm to determine whether the fitted centroid of a galaxy is within a reasonable range of the nominal position , given the prior on the galaxy position : this would identify some of the cases of multiple galaxies .",
    "the criterion adopted is that the fitted galaxy position should lie within @xmath135 of the nominal position , where @xmath136 is the prior position variance , and this excludes 9percent of the initial simulated galaxy sample but no others that are excluded by the ` close pairs ' criterion .",
    "fig.[fig : likelihood_surfaces ] shows the posterior probability surfaces that result from fitting to two of the simulated galaxies . for completeness",
    "we also show the likelihood surfaces , which are broader and more biased away from the nominal value of ellipticity .",
    "fig.[fig : e_plots ] shows the results for each galaxy in the simulations ( only the first component of ellipticity , @xmath51 , is shown , similar results are obtained for @xmath53 ) . at bright magnitudes",
    "there is good correspondence between input and measured ellipticity values .",
    "the slope appears slightly steeper than unity , but with a value for the slope of @xmath137 the departure from unity is not very significant .    at fainter magnitudes , as the signal - to - noise decreases , an increasing fraction of galaxies with a given value of the bayesian measure are drawn from a wider range of input ellipticities , as expected from the earlier discussion .",
    "the slope of the relation between input and measured values is again close to unity , with value @xmath138 . at all magnitudes",
    "the summed posterior probability distribution is a faithful reproduction of the distribution of the input prior distribution ( fig.[fig : e_hist ] ) as expected from section[sampledistribution ] .",
    "there is also no detectable correlation between estimated values of @xmath51 and @xmath53 in this simulated galaxy sample .",
    "we can also investigate the effect of measurement uncertainty in the prior positions of the galaxies . a random position uncertainty drawn from a normal distribution",
    "was introduced to each galaxy and the shapes remeasured .",
    "the prior assumed in the fitting was a normal distribution of rms 3 pixels throughout .",
    "in the results , no change was found in the slope of fig.[fig : e_plots ] for rms position uncertainties as large as 10 pixels .",
    "the scatter about the mean relation did not change for rms uncertainties less than 3 pixels and increased by 4 percent for rms uncertainties as large as 10 pixels .",
    "this test indicates that the results are not sensitive to uncertainties in galaxy position measurement .",
    "we would recommend that the position prior that is chosen should match the actual position uncertainty for the faintest galaxies that are reliably fitted .",
    "tests of the algorithm , again using the full suite of step simulations specifically to measure the shear values recovered , are made in the companion paper ( kitching et al . in preparation ) .      the algorithm has been implemented in the c programming language for use on desktop computing systems , with discrete fast fourier transforms being supplied by the fftw library @xcite .",
    "the computational speed per galaxy obviously depends on the computing system being used as well as on issues such as the extent to which the multiplex advantage of having many galaxies per psf function can be exploited . in the simulations described above , using readily available 2ghz desktop pcs in 2007 and evaluating the likelihood surfaces on a grid of sampling interval 0.1 in @xmath7 , we found computation times around 1.0s per galaxy , implying that a survey of @xmath139 galaxies could be analysed in a few months on a single standard desktop pc .",
    "the computation time scales inversely with the square of the sampling in ellipticity and increases approximately as @xmath140 for subimages of size @xmath141 .",
    "a number of studies have been made of the distribution of galaxy ellipticities ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "these studies find a wide variation in distribution of axial ratios , which appears strongly dependent on apparent magnitude , presumably largely as a result of the changing mix of galaxies with brightness and redshift .",
    "the distribution of ellipticities at the faint magnitudes probed by ongoing and future weak lensing surveys is even less well - known , and the best estimate would come from the lensing data itself . for a sufficiently large survey the prior estimate",
    "could also be allowed to be a function of galaxy brightness , redshift or colour , if that information were available .",
    "one way to estimate the ellipticity prior may be to adopt an iterative approach : evaluate the summed posterior probability distribution starting from an initial guess of the prior distribution ; then iteratively adjust the assumed prior until the summed posterior and prior distributions agree .",
    "we would expect this to be a stable iteration in the absence of sampling noise , because if the prior is initially assumed distributed to values that are smaller than are required to explain the data , the next iteration will adjust the prior to be distributed to large values , and _",
    "vice versa_. such an approach might however be unstable with small surveys where sampling noise might be important .    in the case of lensing shear estimation",
    ", the ellipticity prior should also include the shear effect , and should not just be the intrinsic pre - sheared distribution . as the shear varies on relatively small scales , and we are unlikely to have sufficient number of galaxies to measure accurately the ellipticity distribution in small regions , we suggest that correct generation of the prior should be to force the prior to be circularly symmetric , centred on @xmath142 , and to be obtained from the large numbers of galaxies that comprise the full survey . in this way",
    "` false ' shear variation arising from noise on the prior would be avoided , but the resulting shear values would be slightly biased to low values , in a magnitude - dependent way .",
    "this bias has already been discussed in section[shearestimation ] and a method of correcting for the bias using the shear sensitivity has been described .",
    "a key advantage of the model - fitting approach over other methods is that a surface brightness profile may be chosen that accurately represents the actual profiles of galaxies .",
    "two obvious choices of profile are exponential or de vaucouleurs . in fact",
    ", it is notoriously difficult to choose between these profiles when fitting to faint galaxies , so we do not expect the accuracy of the weak lensing measurement to depend strongly on which of these profiles is chosen .",
    "some greater freedom in profile could be allowed by adding the srsic index as a free parameter , allowing exponential and de vaucouleurs models to be treated as special cases of this generalised profile ( e.g. * ? ? ?",
    "* ) , however it is unlikely that the addition of an extra parameter can be justified on evidence grounds .",
    "a similar consideration is that galaxies generally are composed of bulge and disc components , which when viewed at an inclined angle may present differing ellipticities : accurate modelling of galaxies requires both components to be fitted , but again , for generic shape measurement of faint galaxies where information at this level of sophistication is not present in the data , this seems unwarranted .",
    "it may be that a weak lensing survey comprises multiple images of the same region of sky , but taken at different times and hence with differing psfs , and possibly in different wavebands .",
    "the latter is likely if broad - band optical photometric redshifts are also being estimated from the same data that is being used for shape measurement .",
    "clearly one would like to optimally estimate galaxy shape from the combination of all this data , but it would not be optimal simply to co - add the data , because of the differing psfs in each image .",
    "the model - fitting algorithm described above allows a natural way to optimally include all the data , since all we need do is add the likelihoods for the models fitted to each galaxy . in doing this , we should take care that the nominal galaxy positions are the same in each image , so the optimal way to proceed would be to co - add images for the purpose of detecting and measuring nominal galaxy positions only , and then fitting each individual image with models convolved with the appropriate psf and adding the resulting likelihoods .",
    "images with a mixture of seeing qualities are thus optimally combined for the shape measurement .",
    "it is clear that in large future optical surveys systematic uncertainties in psf correction will be a dominating concern , indeed this is a significant factor in the case for space - based weak lensing missions .",
    "ground - based optical psfs vary temporally and very often on spatial scales comparable to those on which the cosmic shear signal is detectable .",
    "even hst lensing studies suffer significantly from psf variation @xcite . in principle radio interferometers",
    "have precisely known psfs , being determined by the antenna positions ( note that full 3d knowledge of antenna positions is required , to allow for curvature of the earth and natural height variations ) .",
    "the psf varies with hour angle and declination , but in a completely deterministic way .",
    "other effects such as bandwidth and sampling - time smearing can also be precisely computed and incorporated into the shape measurement process @xcite .",
    "because interferometer measurement are made in the fourier domain , and because the noise also originates in that domain ( being associated with individual antennas ) it makes sense to measure galaxy shapes in fourier space ( in the image plane the noise is correlated between pixels , effectively being also convolved with the psf ) . @xcite and @xcite have already shown how a shapelets @xcite based approach can be extended to the fourier domain .",
    "the bayesian algorithm presented in this paper already operates in the fourier domain , so it should be easily adapted for radio interferometer data , which will be particularly relevant for future deep radio surveys such as those proposed for the square kilometer array .",
    "we have argued that a model - fitting approach to galaxy shape measurement should provide an optimum approach to shape measurement for large weak - lensing surveys , with the advantages that the signal - to - noise of the shape measurement should be optimised and random measurement errors can be estimated .",
    "we have further argued that a bayesian estimation process allows unbiased shape estimation to be made , although even in a realistic implementation of a bayesian method there is a bias in recovered shear values introduced by the presence of the prior probability distribution .",
    "this bias may be calculated from the measured likelihood surfaces , however , and in this paper we have spent some time discussing the calculation of the ` shear sensitivity ' .",
    "overall this approach to shape measurement should provide a framework for shear measurement that does not need external calibration by comparison with simulations .",
    "a traditional disadvantage of model - fitting is that it may be computationally time - consuming , and in this paper we present a fast algorithm for measuring the shapes of individual galaxies .",
    "the algorithm makes use of analytic marginalisation over surface brightness amplitude , and by working in fourier space enables rapid marginalisation over galaxy position . the algorithm has been tested and has an adequate speed on current generations of computers for use with large ongoing and planned weak - lensing surveys .",
    "close pairs of galaxies are not treated by the algorithm , but provided such close pairs can be identified in the data a separate fitting process may be applied to those .",
    "the bayesian method and fast fitting algorithm have been tested on simulated galaxies created for the shear testing program ( step : @xcite ) and promising results on the measurement of individual galaxy ellipticities have been obtained . a companion paper ( kitching et al . in preparation ) will test the measurement of weak lensing shear in the step simulations .",
    "* acknowledgements * + ch acknowledges the support of a european commission programme @xmath143 framework marie curie outgoing international fellowship under contract m01f - ct-2006 - 21891 , and a cita national fellowship .",
    "lvw is supported by nserc , cifar and cfi .",
    "tdk is supported by the science and technology facilities council , research grant number e001114 .",
    "99 bacon d.j . ,",
    "taylor a.n . ,",
    "mnras 344 ( 2003 ) 1307 bardeau s. , kneib j .-",
    ", czoske o. , soucail g. , smail i. , ebeling h. , smith g.p . , 2005 , a&a , 434 , 433 bardeau s. , soucail g. , kneib j .-",
    ", czoske o. , ebeling h. , hudelot p. , smail i. , smith g.p .",
    ", 2007 , a&a , 470 , 449 benjamin j. et al . , 2007 , mnras submitted , astro - ph/0703570 bernstein g.m . , jarvis m. , 2002 , aj , 123 , 583 bertin e. , arnouts s. , 1996 , a&as , 117 , 393 brainerd t.g .",
    ", blandford r.d .",
    ", smail i. , 1996 , apj , 466 , 623 bridle s. , kneib j .-",
    ", bardeau s. , gull s. , 2002 , _ in _ the shapes of galaxies and their dark halos , proceedings of the yale cosmology workshop `` the shapes of galaxies and their dark matter halos '' , new haven , connecticut , usa , 28 - 30 may 2001 . edited by priyamvada natarajan .",
    "singapore : world scientific , chang t .- c .",
    ", refregier a. , 2002 , apj , 570 , 447 chang t .- c . ,",
    "refregier a. , helfand d.j . , 2004 ,",
    "apj , 617 , 794 dunlop j.s . ,",
    "mclure r.j . ,",
    "kukula m.j . ,",
    "baum s.a . ,",
    "odea c.p .",
    ", hughes d.h . , 2003 , mnras , 340 , 1095 ebbels t. , kneib j .-",
    "p . , ellis r.s . , 1999 , _ in _ cosmological parameters and the evolution of the universe . edited by katsuhiko sato .",
    "publisher : dordrecht , boston : kluwer academic , 1999 .",
    "( `` proceedings of the 183rd symposium of the international astronomical union held in kyoto , japan , august 18 - 22 , 1997 '' , p. 247 edmondson , e.m . ,",
    "miller , l. , wolf , c. , 2006 , mnras , 371 , 1639 frigo m. , johnson s.g .",
    "2005 , proceedings of the ieee , 93 , 216 heavens a. , 2003 , mnras , 343 , 1327 heavens a.f .",
    ", kitching t.d . ,",
    "taylor a.n . , 2006 , mnras , 373 , 105 heymans c. et al . 2006 , mnras , 368 , 1323 hu w. , 1999 , apj , 522 , 21 jing y.p .",
    ", zhang p. , lin w.p .",
    ", gao l. , springer v. , 2006 , apj , 640 , l119 kaiser n. , squires g. , broadhurst t. , 1995 , apj , 449 , 460 kaiser n. , 2000 , apj , 537 , 555 kitching t.d . , heavens a.f .",
    ", taylor a.n . ,",
    "brown m.l . , meisenheimer k. , wolf c. , gray m.e . , bacon d.j . ,",
    "2007 , mnras , in press kneib j .- p .",
    ", hudelot p. , ellis r.s .",
    ", treu t. , smith g.p . , marshall p. , czoske o. , smail i. , natarajan p. , 2003 ,",
    "apj , 598 , 804 kuijken k. , 1999 , a&a , 352 , 355 kuijken k. , 2006 , a&a , 456 , 827 lambas d.g . , maddox s.j . , loveday j. , mnras , 258 , 404 luppino , g.a . ,",
    "kaiser , n. , 1997 , apj , 475 , 20 massey r. et al .",
    ", 2007a , apj in press , arxiv : astro - ph/0701480 massey r. et al . , 2007b , mnras , 376 , 13 peng c.y . ,",
    "ho l.c . , impey c.d . , rix h .- w .",
    ", 2003 , aj , 124 , 266 refregier a. , 2003 , mnras , 338 , 35 refregier a. , bacon , d. , 2003 , mnras , 338 , 48 rhodes j.d . , massey r. , albert j. , collins n. , ellis r.s .",
    ", heymans c. , gardner j.p . , kneib j",
    ", koekemoer a. , leauthaud a. , mellier y. , refregier a. , taylor j.e . , van waerbeke , l. , 2007 , apj in press schrabback t. , erben t. , simon p. , miralles j .-",
    ", schneider p. , heymans c. , eifler t. , fosbury r.a.e .",
    ", freudling w. , hetterscheidt m. , hildebrandt h. , pirzkal n. , 2007 , a&a , 468 , 823 seitz c. , schneider p. , 1997",
    ", a&a , 318 , 687 schramm t. , kayser r. , 1995 , a&a , 299 , 1 spergel , d. et al .",
    "2007 , astro - ph/0603449 taylor a.n . , kitching t.d .",
    ", bacon d.j .",
    ", heavens a.f .",
    ", 2007 , mnras , 374 , 1377 tyson j.a . , wenk r.a",
    ", valdes f. , 1990 , apj , 349 , l1 white m. , 2004 , astropart .",
    "phys . , 22 , 211 zhan h. , knox l. , 2004 , apj , 616 , l75"
  ],
  "abstract_text": [
    "<S> the principles of measuring the shapes of galaxies by a model - fitting approach are discussed in the context of shape - measurement for surveys of weak gravitational lensing . </S>",
    "<S> it is argued that such an approach should be optimal , allowing measurement with maximal signal - to - noise , coupled with estimation of measurement errors . </S>",
    "<S> the distinction between likelihood - based and bayesian methods is discussed . </S>",
    "<S> systematic biases in the bayesian method may be evaluated as part of the fitting process , and overall such an approach should yield unbiased shear estimation without requiring external calibration from simulations . </S>",
    "<S> the principal disadvantage of model - fitting for large surveys is the computational time required , but here an algorithm is presented that enables large surveys to be analysed in feasible computation times . </S>",
    "<S> the method and algorithm is tested on simulated galaxies from the shear testing program ( step ) .    </S>",
    "<S> [ firstpage ]    gravitational lensing - methods : data analysis - methods : statistical - techniques : miscellaneous </S>"
  ]
}