{
  "article_text": [
    "the proper and accurate treatment of radiative transfer ( rt ) in cosmological numerical simulations is a long standing problem , which has received great and ever increasing attention in the last decades . despite this ,",
    "the progress done in numerical rt has been somewhat slower with respect to other fields of numerical cosmology and astrophysics , like large scale structure simulations or magneto hydrodynamics schemes , which in the last years underwent an impressive series of successes and refinements .",
    "the reason for the lag above is mainly due to the extreme complexity underlying the process of radiative transfer , which in a cosmological setting couples also with gas dynamics , cosmic expansion , structure formation and chemistry .",
    "the seven dimension cosmological rt equation does not allow an exact solution , neither analytic nor numerical , and the need to deal with arbitrary geometries and a huge dynamical range in the optical depth distribution prevents the adoption of simplifying assumptions to reduce the dimensionality of the equation and the complexity of the problem .",
    "several methods have been proposed in the literature , relying on a variety of assumptions and approximations , and often optimizing the treatment of rt for different problems , namely different astrophysical configurations . for a detailed review of the various methods developed in the literature we refer the reader to iliev ( 2006 ; i06 ) , where a systematic comparison of 11 cosmological radiative transfer codes through a set of tests is described . since the publication of the paper , more rt codes designed for cosmological applications have appeared in the literature ( altay , croft & pelupessy 2008 ; pawlik & schaye 2008 ; finlator , zel & dav 2008 ) .",
    "the strategy adopted by our group to face the problem of cosmological radiative transfer is based on a ray - tracing monte carlo ( mc ) scheme which applies to 3d cartesian grids and which is based on the particle nature of the radiation field .",
    "this approach offers several advantages .",
    "the radiation is described in terms of photons which , grouped for computational convenience into monochromatic photon packets , travel through the simulation volume along rays .",
    "this allows to solve the transfer in one dimension : _",
    "( i ) _ by following monochromatic packets of photons along rays one gets rid of the explicit dependence on direction and frequency , and _",
    "( ii ) _ by casting rays into the assigned grid , one can furthermore remove the dependency on the position . instead of solving directly for the intensity of the radiation field , @xmath0 , one just needs then to model the interaction of the photons with the gas inside a cell .",
    "this approach allows to enormously simplify the treatment of radiative transfer , and to leave the geometry of the problem completely arbitrary . on the other hand , as drawback , ray tracing techniques are usually computationally expensive and tend to suffer from low angular resolution .",
    "these problems are partially overcome by adopting a statistical description of the radiation field , by monte carlo sampling directions and spectral energy distributions .",
    "differently from short and long characteristic methods , in which the rays are cast along fixed directions , in mc ray tracing the rays are shot in random directions , allowing for a more efficient implementation of multiple sources and a diffuse component of the ionizing radiation , recombination radiation or the ultraviolet background ( uvb ) , as well as anisotropic angular emissivities .",
    "these advantages come with the introduction of numerical noise , intrinsic to all mc schemes , which can be nevertheless kept arbitrarily low by increasing the number of rays shot . in practice ,",
    "one always needs to look for the best compromise with computational efficiency .",
    "all the above ingredients have been successfully implemented in our code   which is to date one of the main references among rt numerical schemes used in cosmology . the first version of the code ( ciardi 2001 , c01",
    "; in the following we will refer to this version as 0 ) integrated the principles of ray - tracing and mc to follow the evolution of hydrogen ionization for multiple sources under the assumption of a fixed temperature for the ionized gas . in its actual reference version ( maselli , ferrara & ciardi 2003 , mfc03 ;",
    "maselli & ferrara 2005 ; in the following we will refer to this version as ) , the code has been further developed by including a variety of additional physical ingredients ( like helium chemistry , temperature evolution , background radiation ) , and a more sophisticated algorithm for processes like photon absorption , reemission , as well as for the chemistry solver .",
    "all these new ingredients make the code extremely versatile in term of problems that can be studied .",
    "one of the main advantages of the   implementation consists in the straightforward way in which the matter / radiation interactions are modeled and calculated .",
    "this allows to easily implement new physics in the code without the need for major changes in its structure .",
    "illustrative examples are given by mcly@xmath1 ( verhamme , schraerer & maselli 2006 ) and crash@xmath1 ( pierleoni , maselli & ciardi , 2007 ) .",
    "adopting the   algorithms for ray tracing , spectra sampling , photon propagation and optical depth sampling ( as described in ciardi 2001 ) , we have implemented the physics of line resonant scattering in mcly@xmath1 , a tool mainly dedicated to the study and modeling of ly@xmath1 emitters ( laes ) . moving forward in this direction ,",
    "we extended   and implemented crash@xmath1 , the single rt code to date which can self - consistently account for the simultaneous and coupled transfer of line and ionizing continuum radiation .",
    "this makes of crash@xmath1 a unique tool for studying the implications of high redshift lae surveys on cosmic reionization and 21  cm line from neutral hydrogen in the primordial universe .",
    "more recently , we have started including molecular hydrogen in   to study the inhomogeneous h@xmath2 photo - dissociation occurring at the dawn of the universe or in star forming regions . once again , this requires very little manipulation on the main core of the code and can be done by complementing the existing numerical scheme with algorithms which model the new physics to be implemented .",
    "as the code is continuously being updated and optimized , in this paper we describe some major changes that have been introduced in the implementation described in mfc03 , together with some test results clearly showing the improvements achieved in performance and accuracy .",
    "the rest of the paper is organized as follows .",
    "we first give a brief review on the basics of the   implementation in sec .",
    "2 . in sec .",
    "3 we describe the updates done in the implementation and the new algorithms introduced , presenting the results from test runs designed to show the improvements obtained . finally we summarize our work in sec .",
    "in this section we give a very brief and general description of the   code .",
    "a more detailed and complete report is given in mfc03 and also in maselli & ferrara ( 2005 ) , where a refined and improved version of the implementation of the background radiation is described .",
    "we refer the interested reader to these works for more details on the implementation .    as discussed in the introduction ,",
    "is a radiative transfer numerical scheme which applies to 3d cartesian grids and which is based on mc ray tracing techniques that are used to sample the probability distribution functions ( pdfs ) of several quantities involved in the calculation , _",
    "e.g. _ spectrum of the sources , emission direction , optical depth .",
    "the algorithm follows the propagation of the ionizing radiation through an arbitrary h / he static density field and , at the same time , computes _",
    "( i ) _ the evolution of the thermal and ionization state of the gas and _ ( ii ) _ the distortion of the ionizing radiation field due to matter - radiation interactions , which produce the typical rt effects of filtering , shadowing and self - shielding .",
    "the radiation field is described in terms of photons which , for computational convenience , are grouped into photon packets and shot through the box .",
    "both multiple point sources , located arbitrarily in the box , and diffuse radiation fields ( _ e.g. _ the ultraviolet background or the radiation produced by h / he recombinations ) are treated .    the energy emitted by each ionizing source is discretized into photon packets emitted at regularly spaced time intervals .",
    "more specifically , the total energy radiated by a single source of luminosity @xmath3 , during the total simulation time , @xmath4 , is @xmath5 . for each source , @xmath6 is distributed in @xmath7 photon packets , emitted at the source location . in this way , the total number of photon packets emitted by each source , @xmath7 , is the main control parameter which sets both the time and the spatial resolution of a given run .",
    "the emission direction of each photon packet is assigned by mc sampling the angular pdf characteristic of the source .",
    "the propagation of the packet through the given density field is then followed and the impact of radiation - matter interaction on the gas properties is computed on the fly . each time a photon packet pierces a cell @xmath8 , the cell optical depth to ionizing continuum radiation , @xmath9 ,",
    "is estimated summing up the contribution of the different absorbers ( , , ) .",
    "as the probability for a single photon to be absorbed in such a cell is : @xmath10 the number of photons absorbed in the cell @xmath8 is the fraction @xmath11 of packet content when it enters the cell . the total number of photons deposited in the cell is then distributed among the various absorbers according to the corresponding contributions given to the total cell optical depth . from these quantities the discrete increments of the ionization fractions and temperature",
    "are calculated : @xmath12 , @xmath13 , @xmath14 , @xmath15 and @xmath16 , where @xmath15 is the positive increment in temperature due to photo - heating and @xmath16 the negative one associated to the increased number of free particles .",
    "the trajectory of the photon packet is followed until its photon content is extinguished or , if periodic boundary conditions are not assumed , until it exits the simulation volume .",
    "the time evolution of the gas physical properties ( ionization fractions and temperature ) is computed solving in each cell the appropriate set of discretized differential equations each time the cell is crossed by a packet .",
    "in addition to the impact of photo - ionization and photo - heating , that , as discussed above , are included in the form of discrete contributions , the implemented chemistry network explicitly includes the other relevant radiative processes : recombination and collisional ionization for the ionization fractions and various cooling processes for the temperature ( bremsstrahlung , compton cooling / heating , collisional ionization cooling , collisional excitation cooling and recombination cooling ) .",
    "all these radiative processes are instead implemented in the code as _ continuous _ , namely by integrating their associated rate coefficients .",
    "we again refer the reader to the documentation mentioned above for further details on the integration technique and on the technical implementation devised to treat multiple sources .",
    "in this section we describe the new implementation ( in the following we will refer to it as ) developed to deal with ionizing sources with arbitrary spectra . in crash1 , each point and diffuse ionizing source is assigned with an arbitrary spectrum which is reproduced by mc sampling the given spectral energy distribution ( sed ) and by emitting a large number of monochromatic photon - packets .",
    "this implementation is highly versatile , allowing to reproduce arbitrary spectral shapes in a continuum range of frequency , but has two main drawbacks that could affect the precision and efficiency of the code .",
    "first , the nature of the mc sampling procedure induces a poor sampling of the spectral region with lower intensity , which in most applications of interest is the hard energy tail of the spectrum .",
    "this limitation could be crucial in studies involving helium ( ) photo - ionization , hard radiation photo - heating ( x - rays ) , ionization front ( if ) profiles of hard sources like quasars , just to give some examples among many .",
    "second , the monochromatic packet approach aggravates the well known shortcoming of ray - tracing techniques , which oversample the regions close the sources at the expense of undersampling the farthest ones .",
    "this introduces unphysical features in the rt results , such as spikes and uneven ionization fronts ( see fig .  12 in i06 ) .",
    "to overcome these problems , we have introduced a new algorithm in   which treats the polychromatic nature of the ionizing radiation field by shooting `` colored '' packets .",
    "each packet is now represented by a vector of @xmath17 bins , whose total energy @xmath18 ( determined as in ) is distributed among a number of photons which populates the @xmath17 frequency bins to reproduce the sed characteristic of the ionizing source .",
    "the number and spacing of bins can be arbitrarily chosen together with the frequency range covered .",
    "typically , the spacing is chosen to be logarithmic and more refined at the photo - ionization thresholds , @xmath19 , @xmath20 and @xmath21 .",
    "although we now have polychromatic photon packets traveling through the box , their interaction with the gas has not been modified significantly with respect to .    while propagating through the gas the colored packet sees different optical depths , one for each frequency bin :    [ tau ] _",
    "c(_j ) = _ i = hi , hei , heii _",
    "i(_j ) = _ i = hi , hei , heii",
    "i(_j ) n_i ,    where the indexes @xmath22 and @xmath23 span over the species included and the frequencies sampled , respectively . the other symbols in eq .",
    "[ tau ] have the conventional meaning , @xmath24 and @xmath25 being the photo - ionization cross section and the number density of the @xmath22 specie , and @xmath26 the actual path that the packet travels inside the cell .",
    "differently from the   implementation , here we have introduced a new algorithm which computes the length @xmath26 of the ray segment within each cell ( see next section ) .",
    "once the opacity of the cell is determined , the number of photons deposited is calculated according to the probability for a photon to be absorbed , @xmath27 , which depends on the atomic species and the frequency .    summarizing",
    ", a packet is emitted from a source with @xmath28 photons per frequency bin at the time @xmath29 . while traveling through the gas , photons",
    "are progressively removed from the packet as they ionize atoms along the path .",
    "the number of photons deposited in a cell is evaluated from the total optical depth , which gives the probability for an absorption event : [ nphot ] n_a,^(c ) ( _ j)= n_t,^(c-1)(_j ) ( 1 - e^-_c(_j ) ) , where @xmath30 counts the number of cells crossed by the packet from its emission location , @xmath31 the number of photons absorbed and @xmath32 the number of photons which is transmitted to the next cell .",
    "the absorption probability in the various frequency bins induces a modification in the spectral shape of the packet . typically , the frequencies closer to the resonant photo - ionization thresholds are depleted first and more strongly . in figure  [ spectrum_distorsion ]",
    "we show an example of how the population of the frequency bins changes while the packet travels through a h / he gas .",
    "the differently colored curves represent the spectral shape of the packet in the different cells pierced , with the sequence from top to bottom corresponding to the order in which they are crossed .",
    "note that for both panels each color represents the cell after a given number of crossings , the transitions dark blue - to - magenta and purple - to - green roughly correspond to the 20th and 30th cell crossed .",
    "the two panels show the evolution of the spectral shape of a packet emitted _",
    "( i ) _ in a completely neutral gas ( left ) and _ ( ii ) _ when the / ionization fronts are roughly thirty cells away from the source ( right ) yr ( left ) and @xmath33 yr ( right ) . ] . it can be seen how the photons close to the photo - ionization thresholds are absorbed first , due to the higher cross sections , and how the sed of the packet becomes progressively harder as it moves far away from the source .",
    "it is interesting to notice that the spectrum evolution shown in the left panel does not exhibit the drop at 54.4 ev , as here the packet is emitted in a completely neutral gas , still devoid of absorbers .",
    "a proper modeling of this filtering mechanism is very important , particularly to correctly estimate the gas temperature or the inner structure of the ionization fronts .",
    "once the total number of photons deposited in a cell from each frequency bin @xmath34 has been determined , @xmath35 , they are distributed among the absorber species included in the calculation .",
    "this is done by assigning to each absorber species a fraction of @xmath35 proportional to the corresponding absorption probability [ prob_s ] p_i(_j ) ( 1-e^-_i(_j ) ) , normalized to the total probability : [ prob_tot ] p_c(_j ) = _ i = hi , hei , heii p_i(_j ) . as the packet passes through the cell , it photo - ionizes a number of atoms of the @xmath22-th species given by : n_a_i,(_j)=n_a,(_j ) , with a corresponding increment in the ionization fractions given by : [ fracs ] x_i^+ = , where @xmath36 is the singly ionized ion of the @xmath22 specie ( @xmath37 \\ { , , } for @xmath38\\ { , , } ) , and @xmath39 the total number of nuclei of a given element contained in the actual cell .",
    "the cell temperature before the current packet crossing , @xmath40 , is updated accounting for photo - heating and for the variation in the number of free particle which is given by the variation in the number density of free electrons @xmath41 .",
    "the two effects contribute respectively with the following temperature increments : t_i^+ & = & , + t_n & = & - t_c , [ delta_temp ] where @xmath42 is the ionization threshold for photoionization of the @xmath22-th specie , @xmath43 is the number density of free particles and @xmath44 is the variation of this quantity corresponding to the change in the electron number density due to photo - ionization : [ delta_n ] = x_e=.    each time a colored packet crosses a new cell the set of vectorial operations described in equation [ tau ] through [ delta_n ] is performed to get the key quantities : the number of photons which escape the @xmath30-th cell crossed from the emission location , @xmath45 , which accounts for radiative transfer , and @xmath46 , @xmath47 and @xmath48 necessary to account for the evolution of the gas physical state .",
    "the radiative processes which are not associated with the ionizing radiation are reproduced , as done in , by integrating the corresponding temperature dependent rates over the elapsed time interval between the previous packet crossings and the current one .      to limit the computational time , in the previous versions of   ray casting is not implemented .",
    "rather , the opacity of a single cell is evaluated using as the length traveled by the packet within the cell the fix value 0.56 ( in units of the linear dimension of a cell ) .",
    "this number corresponds to the median value of the pdf for the length of randomly oriented paths within a cubic box of unit size ( see ciardi 2001 ) .",
    "although this approximation is acceptable for several applications , it does not always result in enough accuracy , occasionally showing spurious geometrical patterns in the ionization and temperature maps ( see the rings evident in the bottom right panel of figure  [ t2_maps ] ) .",
    "for this reason , a new algorithm for ray casting has been implemented , which is similar to the _ fax voxel trasversal algorithm for ray tracing _ by amanatides & woo ( 1987 ) .",
    "ray casting is performed by computing the distances that need to be traveled in order to intersect the boundaries ( along the @xmath49 , @xmath50 and @xmath51 axis ) of the grid cell pierced by the ray .",
    "the minimum of these distances gives the length of the path traveled within the cell and the boundary intersected first determines which index has to be incremented to get the coordinate of the next cell through which the ray passes . for more technical details about the algorithm",
    "we refer the reader to the amanatides & woo ( 1987 ) paper . + the test cases described in sec .",
    "4 show the improvement resulting from the introduction in  of the ray casting calculation described above .",
    "this improvement in performance comes at the expense of computational efficiency , which nevertheless is not dramatically affected .",
    "the fraction of total computational time spent in computing ray casting strongly depends on the specifics of a given run , particularly on the physics included .",
    "in all the cases analyzed here we find it to be almost negligible , being at most five percent of the total computational time .",
    "in the new version of the code we have updated the expressions adopted for the coefficient rates .",
    "the references for each specific coefficient can be found in table  1 of i06 .",
    "we have furthermore introduced the use of pre - compiled tables for the rate coefficients with the aim of improving efficiency .",
    "the temperature dependence of the various coefficient rates are now computed once at the beginning of a given run , stored in dedicated tables and read during the run .",
    "this allows to speed up the calculation significantly with respect to the previous implementation where the coefficients rates are functions evaluated at each cell crossing .",
    "although a quantitative estimate of the improvement in the efficiency could be given , this is highly dependent on the problem at hand and would be significant only in specific cases . typically though , we find that the efficiency is increased up to @xmath52  20 percent .",
    "the implementation is worked out to allow for adaptive tables , by assigning as initial conditions the range of temperatures and the refinement of sampling according to the physical configuration associated to a given run .",
    "this is done once , at the beginning of each run , with the aim of adapting the range and refinement of the tables to the physical configuration of the simulation at hand : if the gas in the simulation has been shock heated we assign an upper limit on the temperature range of the order of @xmath53k , which is not the case if we know that the run will process only photoionized gas , for which we adopt @xmath54k .",
    "in the following we will discuss some test cases run to study the performance of the new implementation described above .",
    "as a first test we have repeated test 2 of the rt comparison project ( i06 ) .",
    "this test is the classical problem of an region expansion in a uniform gas around a single ionizing source .",
    "a steady source with a @xmath55  k black - body spectrum , emitting @xmath56 ionizing photons per unit time ( @xmath57 ) , is turned on in an initially - neutral , uniform - density , static environment with hydrogen number density @xmath58  @xmath59 .",
    "the computational box dimension is l = 6.6 kpc and the source is positioned at its corner .",
    "we follow the evolution of the neutral hydrogen fraction and of the gas temperature ( initially set to 100  k ) , running the   version with @xmath60 photon packets and the   one with @xmath61 photon packets .",
    "the fraction and temperature maps , 10  myr after the source has turned on , are shown in figure  [ t2_maps ] for crash1 ( right ) and crash2 ( left ) ( same cuts in figs .  11 and 12 of i06 ) .",
    "from a comparison between the left and right panels , differences are evident .",
    "more specifically , the spikes present in the   maps , particularly in the temperature , are almost completely vanished .",
    "this is due to the colored packets implementation that allows for a much better sampling of the high energy tail of the spectrum , for the same number of packets emitted ( and thus for the same resolution ) .",
    "the weak spikes - like features which are still visible in the   temperature map , are due to the noise intrinsic to monte carlo algorithms .",
    "also , the artificial ring - like patterns clearly visible in the   maps , have completely disappeared thanks to the new ray casting algorithm implemented .",
    "finally a visual inspection of the maps in figure  [ t2_maps ] reveals that the volume inside the i - fronts is both hotter and more highly ionized in crash2 than in .",
    "this can be better seen in the more quantitative comparison shown in figure  [ t2_prof ] , which plots the spherically - averaged temperature ( left panel ) and ionized and neutral fractions ( right panel ) as a function of the distance from the source 100  myr after the source has been turned on .",
    "crash2 ( solid red lines ) produces a higher temperature and a lower neutral fraction compared to crash1 ( dashed blue lines ) .",
    "this result , which brings a better agreement between   and other codes ( , whose results are shown for comparison by the dashed - dotted green curves ) , is due once again the improved modeling of the filtering which is achieved thanks to a better sampling of the high energy tail of the spectrum : photons in this region of the sed can heat more and ionize less the gas with respect to lower energy photons which are oversampled in . despite this , as a result of the increased temperature which inhibits recombinations , the ionization fraction within the ionized sphere results higher in .",
    "one can also see that the ionization front lies slightly closer to the ionizing source in the new implementation : this happens because , once the luminosity is assigned as energy emitted in the unit time , the oversampling of lower energy part of the sed ( which affects the   implementation ) results in an higher number of ionizing photons .",
    "also , we still obtain a wider ionization front with respect to other codes ( see fig .  17 in i06 ) , which results from the better sampling of the spectrum in the frequency space .      in this section we describe the results from the test  4 of the rt comparison project . in this case",
    ", the propagation of ionization fronts from multiple sources in a static cosmological density field is followed .",
    "the initial conditions are provided by a time - slice ( at redshift @xmath62 ) from a cosmological n - body and gas - dynamic simulation .",
    "the simulation box size is 0.5@xmath63 comoving mpc .",
    "the gas is assumed to be initially neutral and the temperature is initialized at 100  k everywhere in the box .",
    "the ionizing sources are chosen so as to correspond to the 16 most massive halos in the box , which are identified with a friends - of - friends algorithm .",
    "we assume that the sources have a black - body spectrum with effective temperature @xmath64  k. the ionizing photon production rate for each source is constant and is assigned assuming that each source lives for 3  myr and emits 250 ionizing photons per atom during its lifetime .",
    "for simplicity , all sources are assumed to switch on at the same time .",
    "the boundary conditions are transmissive ( photons leaving the computational box are lost , rather than coming back in as for periodic boundary conditions ) . the maps in figure  [ t4_maps ] show the fraction ( upper panels ) and temperature ( lower panels ) cuts through the simulation volume at @xmath65 and at time 0.05 myr ( same cuts in fig .  31 and fig .  32 of i06 ) . both crash1 ( right panels ) and crash2 ( left panels ) outputs are shown in the figure .",
    "the differences between the two implementations are strikingly evident : as already found in the test 2 above , the ionization fronts are much larger in the   implementation which accounts properly for the higher energy photons associated with larger mean free paths . the better sampling of the harder tail part of the spectrum results also in higher temperature and lower neutral hydrogen fractions as already discussed above .",
    "the new ray casting implementation corrects furthermore for the artificial patterns visible close - by the ionization fronts in the . the difference in the internal structure of the ionized region",
    "can be better appreciated in figure  [ t4_hist ] where the histograms of the temperature at time @xmath66  myr obtained with the two implementations of the code are compared : solid ( dotted ) line is for crash2 ( crash1 ) . with the colored packets implementation",
    "we find on average higher temperatures .",
    "the fact that regions at temperature above @xmath67  k are more densely populated reflects the higher temperature of ionized regions produced by the contribution of harder photon packets which are undersampled in .",
    "at the same time the lack of the peak found at low temperatures in   is due to the wider ionization fronts obtained with , which extend much further from the sources and affect almost the whole computational volume . as in the previous test , with   we found a better agreement with c@xmath68-ray results shown in the figure by the dashed - dotted curve .",
    "+      finally , similarly to what was done in mfc03 , we compare our code , with the publicly available 1d rt code cloudy94 . with this test",
    "we seek to check for the performance of the new algorithm in dealing with helium physics , which has not been included in the comparison project tests .",
    "we consider the case of a point source with a black body spectrum at @xmath69  k and luminosity @xmath70  erg s@xmath71 , ionizing a uniform medium with density @xmath72  @xmath59 in a gas composed by hydrogen ( 90 percent in number density ) and helium .",
    "1truecm    figure  [ c_c ] shows the profiles at equilibrium for temperature , neutral and ionization fractions .",
    "compared to the earlier results of crash1 ( see fig .  4 in mfc03 ) , the new version of the code provides an overall much better agreement with cloudy94 .",
    "in particular the neutral hydrogen fraction inner profile fits extremely well and with reduced dispersion the cloudy94 predictions .",
    "the same is true for the neutral helium fraction profile which is however slightly higher in   than in cloudy94",
    ". nevertheless , both the temperature and the profiles are slightly lower than the ones derived with cloudy94 and the ionization front extends somewhat further in cloudy94 .",
    "the two behaviors are likely to be correlated and might be due to differences in the expressions adopted for the coefficient rates associated to helium together with the fact that   neglects the effects of heat conduction .",
    "in this paper we introduce the new version of the radiative transfer code .",
    "the details of the code implementation have been previously described in mfc03 . here",
    "we present the new elements introduced to improve performance and efficiency .",
    "the main new ingredients implemented in   are :    * the introduction of colored photon packets , which brings a significant improvement in the sampling of source spectra both in space and frequency ; * a new model for propagating the photon packets through the cartesian grid , which includes a proper ray casting algorithm ; * the use of pre - compiled adaptive tables for the coefficient rates which result in more efficient computing .    the   implementation has been tested and compared with the earlier versions of the code by performing a set of reference tests taken from the rt codes comparison project ( i06 ) and from mfc03 .",
    "is more accurate both in the calculation of the temperature and the ionization fractions , thanks to the improved sampling of the hard tail part of ionizing sources spectra , which is undersampled in the monochromatic packet implementations .",
    "furthermore , the better sampling of hard radiation together with the new ray casting algorithm corrects for spurious geometrical features like spikes in strmgren sphere boundaries or artificial geometrical pattern that are found in the   results .",
    "we thank the anonimous referee for her / his helpful comments on the draft .",
    "we are grateful to patrik jonsson and adrian partl for useful discussions .",
    "we thank marco pierleoni for his sharp comments on the technical details of the implementation .",
    "am is supported by the dfg priority program 1177 .",
    "99 altay , g. , croft , r.  a.  c. , pelupessy , i. , 2008 , mnras , 386 , 1931 amanatides & woo 1987 , _ in eurographics 87 _ , 3 - 10 ciardi , b. , ferrara , a. , marri , s. , raimondo , g . , 2001 , mnras , 324 , 381 iliev , i.  t. , et al . , 2006 , mnras , 371 , 1057 finlator , k. , zel , f. , dav/e , r. , 2008 , astro - ph/0808.3578 maselli , a. , ferrara , a. , ciardi , b. 2003 , mnras , 345 , 379 maselli , a. , ferrara , a. , 2005 , mnras , 364 , 1429 pawlik , a.  h. , schaye , j. , 2008 , mnras , accepted , astro - ph/0802.1715 pierleoni , m. , maselli , a. , ciardi , b. 2008 , mnras , in press , astro - ph/07121159 verhamme , a. , schaerer , d. , maselli a. , 2006 , , 460 , 397"
  ],
  "abstract_text": [
    "<S> in this paper we report on the improvements implemented in the cosmological radiative transfer code . in particular we present a new multifrequency algorithm for spectra sampling which makes use of _ colored _ photon packets : we discuss the need for the multi - frequency approach , describe its implementation and present the improved   performance in reproducing the effects of ionizing radiation with an arbitrary spectrum . </S>",
    "<S> we further discuss minor changes in the code implementation which allow for more efficient performance and an increased precision .    </S>",
    "<S> [ firstpage ]    cosmology : theory - radiative transfer - methods : numerical - intergalactic medium </S>"
  ]
}