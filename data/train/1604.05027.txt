{
  "article_text": [
    "when analyzing collections of imaging data , a general goal is to quantify similarities and differences across images . in medical image analysis and computational anatomy , a common goal is to find patterns that can distinguish morphologies of healthy and diseased subjects aiding the understanding of the population epidemiology .",
    "such distinguishing patterns are typically investigated by comparing single observations to a representative member of the underlying population , and statistical analyses are performed relative to this representation . in the context of medical imaging , it has been customary to choose the template from the observed data as a common image of the population .",
    "however , such an approach has been shown to be highly dependent on the choice of the image .",
    "in more recent approaches , the templates are estimated using statistical methods that make use of the additional information provided by the observed data  @xcite .    in order to quantify the differences between images , the dominant modes of variation in the data",
    "must be identified .",
    "two major types of variability in a collection of comparable images are _ intensity variation _ and variation in _ point - correspondences_. point - correspondence or _ warp _ variation can be viewed as shape variability of an individual observation with respect to the template .",
    "intensity variation is the variation that is left when the observations are compensated for the true warp variation .",
    "this typically includes noise artifacts like systematic error and sensor noise or anatomical variation such as tissue density or tissue texture .",
    "typically one would assume that the intensity variation consists of both independent noise and spatially correlated effects .    in this work",
    ", we introduce a flexible class of mixed - effects models that explicitly model the template as a fixed effect and intensity and warping variation as random effects , see figure  [ fig : layer ] .",
    "this simultaneous approach enables separation of the random variation effects in a data - driven fashion using alternating maximum - likelihood estimation and prediction .",
    "the resulting model will therefore choose the separation of intensity and warping effects that is most likely given the patterns of variation found in the data . from the model specification and estimates ,",
    "we are able to denoise observations through linear prediction in the model under the maximum likelihood estimates .",
    "estimation in the model is performed with successive linearization around the warp parameters enabling the use of linear mixed - effects predictors and avoiding the use of sampling techniques to account for nonlinear terms .",
    "we apply our method on datasets of face images and 2d brain mris to illustrate its ability to estimate templates for populations and predict warp and intensity effects .",
    "the paper is structured as follows . in section  [ sec : background ] , we give an overview of previously introduced methods for analyzing image data with warp variation .",
    "section  [ sec : mod ] covers the mixed - effects model including a description of the estimation procedure ( section  [ sec : est ] ) and how to predict from the model ( section  [ sec : pred ] ) . in section  [ sec : invb ] , we give an example of how to model spatially correlated variations with a tied - down brownian sheet .",
    "we consider two applications of the mixed - effects model to real - life datasets in section  [ sec : app ] and section  [ simstud ] contains a simulation study that is used for comparing the precision of the model to more conventional approaches .",
    "the model introduced in this paper focuses on separately modelling the intensity and warp variation .",
    "image registration conventionally only focuses on identifying warp differences between pairs of images .",
    "the intensity variation is not included in the model and possible removal of this effect is considered as a pre - or postprocessing step .",
    "the warp differences are often found by solving a variational problem of the form @xmath0 see for example @xcite .",
    "here @xmath1 measures the dissimilarity between the fixed image @xmath2 and the warped image @xmath3 , @xmath4 is a regularization on the warp @xmath5 , and @xmath6 is a weight that is often chosen by ad - hoc methods .",
    "after registration , either the warp , captured in @xmath5 , or the intensity differences between @xmath2 and @xmath3 can be analyzed  @xcite .",
    "several works have defined methods that incorporate registration as part of the defined models .",
    "the approach described in this paper will also regard registration as a part of the proposed model and adress the following three problems that arise in image analysis : ( a ) being able to estimate model parameters such as @xmath7 in a data - driven fashion ; ( b ) assuming a generative statistical model that gives explicit interpretation of the terms that corresponds to the dissimilarity @xmath1 and penalization @xmath4 ; and ( c ) being simultaneous in the estimation of population - wide effects such as the mean or template image and individual per - image effects , such as the warp and intensity effects .",
    "these features are of fundamental importance in image registration and many works have addressed combinations of them .",
    "the main difference of our approach to state - of - the - art statistical registration frameworks is that we propose a simultaneous random model for warp and intensity variation .",
    "as we will see , the combination of maximum likelihood estimation and the simultaneous random model for warp and intensity variation manifests itself in a trade - off where the uncertainty of both effects are taken into account simultaneously . as a result , when estimating fixed effects and predicting random effects in the model the most likely separation of the effects given the observed patterns of variation in the entire data material is used .",
    "methods for analyzing collections of image data , for example template estimation in medical imaging @xcite , with both intensity and warping effects can be divided into two categories , _ two - step methods _ and _ simultaneous methods_. two - step methods perform alignment as a preprocessing step before analyzing the aligned data .",
    "such methods can be problematic because the data is modified and the uncertainty related to the modification is ignored in the subsequent analysis .",
    "this means that the effect of intensity variation is generally underestimated , which can introduce bias in the analysis , see @xcite for the corresponding situation in 1d functional data analysis .",
    "simultaneous methods , on the other hand , seek to analyze the images in a single step that includes the alignment procedure .",
    "conventional simultaneous methods typically use @xmath8 data terms to measure dissimilarity .",
    "such dissimilarity measures are equivalent to the model assumption that the intensity variation in the image data consists solely of uncorrelated gaussian noise .",
    "this approach is commonly used in image registration with the sum of squared differences ( ssd ) dissimilarity measure , and in atlas estimation @xcite .",
    "since the @xmath8 data term is very fragile to systematic deviations from the model assumption , for example contrast differences , the method can perform poorly .",
    "one solution to make the @xmath8 data term more robust against systematic intensity variation and in general to insufficient information in the data term is to add a strong penalty on the variation of the warping functions .",
    "this approach is however an implicit solution to the problem , since the gained robustness is a side effect of regularizing another model component . as a consequence ,",
    "the effect on the estimates is very hard to quantify , and it is very hard to specify a suitable regularization for a specific type of intensity variation .",
    "this approach is , for example , taken in the variational formulations of the template estimation problem in @xcite .",
    "an elegant instance of this strategy is the bayesian model presented in @xcite where the warping functions are modeled as latent gaussian effects with an unknown covariance that is estimated in a data - driven fashion .",
    "conversely , systematic intensity variation can be sought to be removed prior to the analysis , in a reversed two - step method , for example by using bias - correction techniques for mri data @xcite .",
    "the presence of warp variation can however influence the estimation of the intensity effects .",
    "analysis of images with systematic intensity differences can be improved using data dissimilarity measures that are robust or invariant to such systematic differences .",
    "however , robustness and invariance come at a cost in accuracy . by choosing a specific kind of invariance in the dissimilarity measure",
    ", the model is given a pre - specified recipe for separating intensity and warping effects ; the warps should maximize the invariant part of the residual under the given model parameters .",
    "examples of classical robust data terms include @xmath9-norm data terms @xcite , charbonnier data terms @xcite , and lorentzian data terms @xcite .",
    "robust data terms are often challenging to use , since they may not be differentiable ( @xmath9-norms ) or may not be convex ( lorentzian data term ) .",
    "a wide variety of invariant data terms have been proposed , and are useful when the invariances represent a dominant mode of variation in the data .",
    "examples of classical data terms that are invariant to various linear and nonlinear photometric relationships are normalized cross - correlation , correlation - ratio and mutual information @xcite .",
    "another approach for achieving robust or invariant data terms is to transform the data that is used in the data term .",
    "a classical idea is to match discretely computed gradients or other discretized derivative quantities @xcite .",
    "a related idea is to construct invariant data terms based on discrete transformations .",
    "this type of approach has become increasingly popular in image matching in recent years .",
    "examples include the rank transform and the census transform @xcite , and more recently the complete rank transform @xcite . while both robust and invariant data terms have been shown to give very good results in a wide array of applications , they induce a fixed measure of variation that does not directly model variation in the data .",
    "thus , the general applicability of the method can come at the price of limited accuracy .",
    "several alternative approaches for analyzing warp and intensity simultaneously have been proposed @xcite . in @xcite warps between images",
    "are considered as combination of two transformation fields , one representing the image motion ( warp effect ) and one describing the change of image brightness ( intensity effect ) . based on this definition warp and intensity variation can be modeled simultaneously .",
    "an alternative approach is considered in @xcite , where an invariant metric is used , which enables analysis of the dissimilarity in point correspondences between images disregarding the intensity variation .",
    "these methods are not statistical in the sense that they do not seek to model the random structures of the variation of the image data .",
    "a statistical model is presented in @xcite , where parameters for texture , shape variation ( warp ) and rendering are estimated using maximizing - a - posteriori estimation .    to overcome the mentioned limitations of conventional approaches",
    ", we propose to do statistical modeling of the sources of variation in data . by using a statistical model where we assume parametric covariance structures for the different types of observed variation",
    ", the variance parameters can be estimated from the data .",
    "the contribution of different types of variation is thus weighted differently in the data term . by using , for example , maximum - likelihood estimation ,",
    "the most likely form of the variation given the data is penalized the least .",
    "we emphasize that in contrast to previous mixed - effects models incorporating warp effects @xcite , the goal here is to simultaneously model warp and intensity effects .",
    "these effects impose randomness relative to a template , the fixed - effect , that is estimated during the inference process .",
    "the nonlinear mixed - effects models are a commonly used tool in statistics .",
    "these types of models can be computationally intensive to fit , and are rarely used for analyzing large data sizes such as image data .",
    "we formulate the proposed model as a nonlinear mixed - effects model and demonstrate how certain model choices can be used to make estimation in the model computationally feasible for large data sizes .",
    "the model incorporates random intensity and warping effects in a small - deformation setting : we do not require warping functions to produce diffeomorphisms .",
    "the geometric structure is therefore more straightforward than in for example the lddmm model @xcite . from a statistical perspective",
    ", the small - deformation setting is much easier to handle than the large - deformation setting where warping functions are restricted to produce diffeomorphisms .    instead of requiring diffeomorphisms",
    ", we propose a class of models that will produce warping functions that in most cases do not fold .",
    "another advantage of the small - deformation setting is that we can model the warping effects as latent gaussian disparity vectors in the domain .",
    "such direct modeling allows one to compute a high - quality approximation of the likelihood function by linearizing the model around the modes of the nonlinear latent random variables .",
    "the linearized model can be handled using conventional methods for linear mixed - effects models @xcite which are very efficient compared to sampling - based estimation procedures .    in the large - deformation setting",
    ", the metamorphosis model @xcite extends the lddmm framework for image registration @xcite to include intensity change in images .",
    "warp and intensity differences are modeled separately in metamorphosis with a riemannian structure measuring infinitesimal variation in both warp and intensity .",
    "while this separation has similarities to the statistical model presented here , we are not aware of any work which have considered likelihood - based estimation of variables in metamorphosis models .",
    "we consider spatial functional data defined on @xmath10 taking values in @xmath11 .",
    "let @xmath12 be @xmath13 functional observations on a regular lattice with @xmath14 points @xmath15 , that is , @xmath16 for @xmath17 , @xmath18 .",
    "consider the model in the image space @xmath19 for @xmath20 , @xmath17 and @xmath18 . here",
    "@xmath21 denotes the template and @xmath22 is a warping function matching a point in @xmath23 to a point in the template @xmath24 .",
    "moreover @xmath25 is the random spatially correlated intensity variation for which we assume that @xmath26 where the spatial correlation is determined by the covariance matrix @xmath1 .",
    "the term @xmath27 models independent noise .",
    "the template @xmath24 is a fixed - effect while @xmath28 , @xmath25 , and @xmath29 are random .",
    "we will consider warping functions of the form @xmath30 where @xmath31 is coordinate - wise bilinear spline interpolation of @xmath32 on a lattice spanned by @xmath33 .",
    "in other words , @xmath34 models discrete spatial displacements at the lattice anchor points .",
    "figure  [ warpex ] shows an example of disparity vectors on a grid of anchor points and the corresponding warping function .",
    "the displacements are modeled as random effects , @xmath35 where @xmath36 is a @xmath37 covariance matrix , and , as a result , the warping functions can be considered nonlinear functional random effects .",
    "as @xmath34 is assumed to be normally distributed with mean zero , small displacements are favorited and hence the warp effect will be less prone to fold .",
    "the model is a spatial extension of the phase and amplitude varying population pattern ( pavpop ) model for curves @xcite .",
    "first , we will consider estimation of the template @xmath24 from the functional observations , and we will estimate the contributions of the different sources of variation . in the proposed model ,",
    "this is equivalent to estimating the covariance structure @xmath36 for the warping parameters , the covariance structure @xmath1 for the spatially correlated intensity variation , and the noise variance @xmath38 .",
    "the estimate of the template is found by considering model in the back - warped template space @xmath39 because every back - warped image represents @xmath24 on the observation lattice , a computationally attractive parametrization is to model @xmath24 using one parameter per observation point , and evaluate non - observation points using bilinear interpolation .",
    "this parametrization is attractive , because henderson s mixed - model equations @xcite suggests that the conditional estimate for @xmath40 given @xmath41 is the pointwise average @xmath42 if we ignore the slight change in covariance resulting from the back - warping of the random intensity effects . as this estimator depends on the warping parameters , the estimation of @xmath24 and the variance parameters has to be performed simultaneously with the prediction of the warping parameters .",
    "we note that , as in any linear model , the estimate of the template is generally quite robust against slight misspecifications of the covariance structure . and the idea of estimating the template conditional on the posterior warp is similar to the idea of using a hard em algorithm for computing the maximum likelihood estimator for @xmath24  @xcite .",
    "we use maximum - likelihood estimation to estimate variance parameters , that is , we need to minimize the negative log - likelihood function of model  .",
    "note that contains nonlinear random effects due to the term @xmath43 where @xmath44 is a nonlinear transformation of @xmath34 .",
    "we handle the nonlinearity and approximate the likelihood by linearizing the model   around the current predictions @xmath45 of the warping parameters @xmath34 : @xmath46 where @xmath47 denotes the jacobian matrix of @xmath48 with respect to @xmath34 and @xmath49 letting @xmath50 , the linearized model can be rewritten @xmath51 we notice that in this manner , @xmath52 can be approximated as a linear combination of normally distributed variables , hence the negative log - likelihood for the linearized model is given by @xmath53 where @xmath54 .",
    "the idea of linearizing nonlinear mixed - effects models in the nonlinear random effects is a solution that has been shown to be effective and which is implemented in standard software packages @xcite .",
    "the proposed model is , however , both more general and computationally demanding than what can be handled by conventional software packages .",
    "furthermore , we note that the linearization in a random effect as done in model   is fundamentally different than the conventional linearization of a nonlinear dissimilarity measure such as in the variational problem  . as we see from the linearized model  , the density of @xmath55 is approximated by the density of a linear combination , @xmath56 , of multivariate gaussian variables .",
    "the likelihood function for the first - order taylor expansion in @xmath34 of the model   is thus a laplace approximation of the true likelihood , and the quality of this approximation is approximately second order @xcite .      as mentioned above",
    "the proposed model is computationally demanding .",
    "even the approximated likelihood function given in equation   is not directly computable because of the large data sizes . in particular ,",
    "the computations related to determinants and inverses of the covariance matrix @xmath57 are infeasible unless we impose certain structures on these . in the following",
    ", we will assume that the covariance matrix for the spatially correlated intensity variation @xmath1 has full rank and sparse inverse .",
    "we stress that this assumption is merely made for computational convenience and that the proposed methodology is also valid for non - sparse precision matrices .",
    "the zeros in the precision matrix @xmath58 are equivalent to assuming conditional independences between the intensity variation in corresponding pixels given all other pixels @xcite .",
    "a variety of classical models have this structure , in particular ( higher - order ) gaussian markov random fields models have sparse precision matrices because of their markov property .    to efficiently do computations with the covariances @xmath59 , we exploit the structure of the matrix . the first term @xmath60 is an update to the intensity covariance @xmath61 with a maximal rank of @xmath62",
    "furthermore , the first term of the intensity covariance @xmath1 has a sparse inverse and the second term @xmath63 is of course sparse with a sparse inverse . using the woodbury matrix identity , we obtain @xmath64 which can be computed if we can efficiently compute the inverse of the potentially huge @xmath65 intensity covariance matrix @xmath66 .",
    "we can rewrite the inverse intensity covariance as @xmath67 thus we can write @xmath68 in a way that only involves operations on sparse matrices . to compute the inner product @xmath69 , we first form the matrix @xmath70 and",
    "compute its cholesky decomposition using the ng - peyton method @xcite implemented in the ` spam ` r - package @xcite . by solving a low - rank linear system using the cholesky decomposition",
    ", we can thus compute @xmath71 .",
    "the inner product is then efficiently computed as @xmath72 where @xmath73 to compute the log determinant in the likelihood , one can use the matrix determinant lemma similarly to what was done above to split the computations into low - rank computations and computing the determinant of @xmath74 , @xmath75 for the models that we will consider , the latter computation is done by using the operator approximation proposed in @xcite which , for image data with sufficiently high resolution ( e.g. @xmath76 ) , gives a high - quality approximation of the determinant of the intensity covariance that can be computed in constant time .    by taking the described strategy",
    ", we never need to form a dense @xmath65 matrix , and we can take advantage of the sparse and low - rank structures to reduce the computation time drastically . furthermore , the fact that we assume equal - size images allows us to only do a single cholesky factorization per likelihood computation , which is further accelerated by using the updating scheme described in @xcite .",
    "after the maximum - likelihood estimation of the template @xmath24 and the variance parameters , we have an estimate for the distribution of the warping parameters .",
    "we are therefore able to predict the warping functions that are most likely to have occurred given the observed data .",
    "this prediction parallels the conventional estimation of deformation functions in image registration .",
    "let @xmath77 be the density for the distribution of the warping functions given the data and define @xmath78 , @xmath79 in a similar manner .",
    "then , by applying @xmath80 , we see that the warping functions that are most likely to occur are the minimizers of the posterior @xmath81 given the updated predictions @xmath82 of the warping parameters , we update the estimate of the template and then minimize the likelihood @xmath83 to obtain updated estimates of the variances .",
    "this procedure is then repeated until convergence is obtained .",
    "the estimation algorithm is given in algorithm  [ alg ] .",
    "the run time for the algorithm will be very different depending on the data in question .",
    "as an example we ran the model for 10 mri midsaggital slices ( for more details see section  [ mri ] ) of size @xmath84 , with @xmath85 .",
    "we ran the algorithm on an intel xeon e5 - 2680 2.5ghz processor .",
    "the run time needed for full maximum likelihood estimation in this setup was 1 hour and 15 minutes using a single core .",
    "this run time is without parallization , but it is possible to apply parallization to make the algorithm go faster .    the spatially correlated intensity variation can also be predicted .",
    "either as the best linear unbiased prediction @xmath86 $ ] from the linearized model   ( see e.g. equation  5 in @xcite ) . alternatively ,",
    "to avoid a linear correction step when predicting @xmath34 , one can compute the best linear unbiased prediction given the maximum - a - posteori warp variables @xmath87= s ( s + i_m)^{-1}(\\boldsymbol{y}_i - \\boldsymbol{\\hat{\\theta}}^{\\hat{\\boldsymbol{w}}_i}).\\label{eq : xpred}\\end{aligned}\\ ] ] the prediction of the spatially correlated intensity variation can , for example , be used for bias field correction of the images .    initialize @xmath88",
    "compute @xmath89 following @xmath90",
    "the main challenge of the presented methods is the computability of the likelihood function , in particular computations related to the @xmath91 covariance matrix of the spatially correlated intensity variation @xmath1 .",
    "the same issues are not associated with the covariance matrix @xmath36 , for the warping parameters , as the dimensions of this matrix are considerably smaller than the dimensions of @xmath1 . in the end of this section",
    ", we will give a short description of how the displacement vectors can be modeled , but first we consider the covariance matrix @xmath1 .    as mentioned in the previous section ,",
    "the path we will pursue to make likelihood computations efficient is to assume that the systematic random effect @xmath92 has a covariance matrix @xmath1 with sparse inverse . in particular , modeling @xmath92 as a gaussian markov random field will give sparse precision matrices @xmath58 .",
    "the markov random field structure gives a versatile class of models that has been demonstrated to be able to approximate the properties of general gaussian fields surprisingly well  @xcite .",
    "estimation of a sparse precision matrix is a fundamental problem and a vast literature exists on the subject .",
    "we mention in passing the fundamental works ,  @xcite , which could be adapted to the present setup to estimate unstructured sparse precision matrices .",
    "we will however not pursue that extension in the present paper .",
    "we here model @xmath92 as a tied - down brownian sheet , which is the generalization of the brownian bridge ( which is markov ) to the unit square @xmath93 ^ 2 $ ] . the covariance function , @xmath94 ^ 2\\times [ 0,1]^2\\to\\mathbb{r}$ ] , for the tied - down brownian sheet is @xmath95 the covariance is @xmath96 along the boundary of the unit square and reaches its maximal variance at the center of the image .",
    "these properties seem reasonable for many image analysis tasks , where one would expect the subject matter to be centered in the image with little or no variation along the image boundary .",
    "let @xmath1 be the covariance matrix for a brownian sheet observed at the lattice spanned by @xmath97 and @xmath98 , @xmath99 , @xmath100 with row - major ordering .",
    "the precision matrix @xmath58 is sparse with the following structure for points corresponding to non - boundary elements : @xmath101 = \\begin{cases } \\phantom{-}4   & \\textrm{if } j = i\\\\ -2 & \\textrm{if } j\\in \\{i-1 , i+1 , i + m_2 , i - m_2 \\}\\\\ \\phantom{-}1   & \\textrm{if } j\\in \\{i-1 - m_2 , i+1 - m_2 , i -1 + m_2 ,",
    "i + 1 + m_2 \\ } \\end{cases}.\\ ] ] for boundary elements , the @xmath102 elements outside the observation boundary vanish .    as explained in section  [ sec : computations ] , the computational difficulties related to the computation of the log determinant in the negative log likelihood function   comes down to computing the log determinant of the intensity covariance @xmath74 . for the tied - down brownian sheet ,",
    "the log determinant can be approximated by means of the operator approximation given in ( * ? ? ?",
    "* example  3.4 ) .",
    "the approximation is given by @xmath103 to compute the approximation we cut the sum off after 10,000 terms .",
    "as a final remark , we note that the covariance function @xmath104 is the green s function for the differential operator @xmath105 on @xmath93 ^ 2 $ ] under homogeneous dirichlet boundary conditions .",
    "thus the conditional linear prediction of @xmath92 given by is equivalent to estimating the systematic part of the residual as a generalized smoothing spline with roughness penalty @xmath106    the tied - down brownian sheet can also be used to model the covariance between the displacement vectors . here",
    "the displacement vectors given by the warping variables @xmath34 are modeled as discretely observed tied - down brownian sheets in each displacement coordinate . as was the case for the intensity covariance",
    ", this model is a good match to image data since it allows the largest deformations around the middle of the image .",
    "furthermore , the fact that the model is tied down along the boundary means that we will predict the warping functions to be the identity along the boundary of the domain @xmath107 ^ 2 $ ] , and for the found variance parameters , the predicted warping functions will be homeomorphic maps of @xmath93 ^ 2 $ ] onto @xmath93 ^ 2 $ ] with high probability .    in the applications in the next section",
    ", we will use the tied - down brownian sheet to model the spatially correlated variations .",
    "in this section , we will apply the developed methodology on two different real - life datasets . in the first example",
    ", we apply the model to a collection of face images that are difficult to compare due to varying expressions and lighting sources .",
    "we compare the results of the proposed model to conventional registration methods and demonstrate the effects of the simultaneous modeling of intensity and warp effects . in the second example , we apply the methodology to the problem of estimating a template from affinely aligned 2d mr images of brains .",
    "+    consider the ten @xmath108 face images from the at&t laboratories cambridge face database  @xcite in figure  [ fig : faces1 ] .",
    "the images are all of the same person , but vary in head position , expression and lighting .",
    "the dataset contains two challenges from a registration perspective , namely the differences in expression that cause dis - occlusions or occlusions ( e.g. showing teeth , closing eyes ) resulting in large local deviations ; and the difference in placement of the lighting source that causes strong systematic deviations throughout the face .    to estimate a template face from these images , the characteristic features of the face should be aligned , and the systematic local and global deviations should be accounted for . in the proposed model  , these deviations are explicitly modeled through the random effect @xmath25 .    using the maximum - likelihood estimation procedure , we fitted the model to the data using displacement vectors @xmath34 on an equidistant @xmath109 interior grid in @xmath93 ^ 2 $ ] .",
    "we used 5 outer and 3 inner iterations in algorithm  [ alg ] .",
    "the image value range was scaled to @xmath93 $ ] .",
    "the estimated variance scale for the random effect @xmath25 was @xmath110 ; for the warp variables , the variance scale was estimated to @xmath111 ; and for the residual variance , the estimated scale was @xmath112 .",
    "to illustrate the effect of the simultaneous modeling of random intensity and warp effects , we estimated a face template using three more conventional variants of the proposed framework : a pointwise estimation that corresponds to model   with no warping effect ; a _ procrustes _ model that corresponds to model   with no intensity component and where the warp variables @xmath34 were modeled as unknown parameters and estimated using maximum - likelihood estimation ; and a _ warp - regularized procrustes _",
    "method where the warp variables @xmath34 were penalized using a term @xmath113 where @xmath114 is the precision matrix for the 2d tied - down brownian sheet with smoothing parameter @xmath115 ( chosen to give good visual results ) .",
    "the estimated templates for the proposed model and the alternative models described above can be found in figure  [ fig : faces2 ] .",
    "going from left to right , it is clear that the sharpness and representativeness of the estimates increase .    to validate the models",
    ", we can consider how well they predict the observed faces under the maximum - likelihood estimates and posterior warp predictions .",
    "these predictions are displayed in figure  [ fig : faces3 ] .",
    "the rightmost column displays the five most deviating observed faces . from the left ,",
    "the first three columns show the corresponding predictions from the procrustes model , the warp - regularized procrustes model and , for comparison , the predicted warped templates from the proposed model .",
    "it is clear that both the sharpness and the representativeness increase from left to right .",
    "the predictions in the third column show the warped template of model   which does not include the predicted intensity effect @xmath25 .",
    "the fourth column displays the full prediction from the proposed model given as the best linear unbiased prediction conditional on the maximum - a - posteori warp variables @xmath116 $ ] .",
    "the full predictions are very faithful to the observations , with only minor visible deviations around the eyes in the second and fifth row .",
    "this suggests that the chosen model for the spatially correlated intensity variation , the tied - down brownian sheet , is sufficiently versatile to model the systematic part of the residuals .",
    "p0.22p0.22p0.22p0.22 no alignment & procrustes free warp & & proposed & & &    p0.15|p0.15|p0.15|p0.15|p0.15 procrustes & & proposed warped template prediction & proposed full prediction & observation & & & & & & & & & & & & & & & & & & & &      the data considered in this section are based on 3d mr images from the adni database  @xcite .",
    "we have based the example on @xmath117 images with 18 normal controls ( nc ) , 13 with alzheimer s disease ( ad ) and 19 who are mild cognitively impaired ( mci ) .",
    "the 3d images were initially affinely aligned with 12 degrees of freedom and normalized mutual information ( nmi ) as a similarity measure . after the registration , the mid - sagittal slices were chosen as observations .",
    "moreover the images were intensity normalized to @xmath93 $ ] and afterwards the mid - sagittal plane was chosen as the final observations .",
    "the @xmath117 mid - sagittal planes are given as @xmath84 observations on an equidistant grid on @xmath93 ^ 2 $ ] .",
    "six samples are displayed in figure  [ fig : eksbrains ] where differences in both contrast , placement and shape of the brains are apparent .",
    "+    for the given data , we used 25 displacement vectors @xmath118 on an equidistant @xmath119 interior grid in @xmath93 ^ 2 $ ] .",
    "the number of inner iterations in the algorithm was set to @xmath120 , while the number of outer iterations was set to @xmath121 as the variance parameters and likelihood value already stabilized after a couple of iterations .",
    "the estimated variance scales are given by @xmath122 for the spatially correlated intensity variation , @xmath123 for the warp variation and @xmath124 for the residual variance .",
    "the estimated template can be found in the rightmost column in figure  [ fig : temp ] .    for comparison , we have estimated a template without any additional warping ( i.e. only using the rigidly aligned slices ) , and a template estimated using a procrustes model with fixed warping effects and no systematic intensity variation , but otherwise comparable to the proposed model .",
    "these templates can be found in the leftmost and middle columns of figure  [ fig : temp ] . comparing the three ,",
    "we see a clear increase in details and sharpness from left to right .",
    "the reason for the superiority of the proposed method is both that the regularization of warps is based on maximum - likelihood estimation of variance parameters , but also that the prediction of warps takes the systematic deviations into account .",
    "indeed , we can rewrite the data term in the posterior   as @xmath125)^\\top({\\boldsymbol{y}}_i - \\boldsymbol{\\theta}^{{\\boldsymbol{w}}_i } - \\mathrm{e}[{{\\boldsymbol{x}}}_i\\,|\\ , { \\boldsymbol{y}}_i , { \\boldsymbol{w}}_i])+\\mathrm{e}[{{\\boldsymbol{x}}}_i\\,|\\ , { \\boldsymbol{y}}_i , { \\boldsymbol{w}}_i]^\\top s^{-1 } \\mathrm{e}[{{\\boldsymbol{x}}}_i\\,|\\ , { \\boldsymbol{y}}_i , { \\boldsymbol{w}}_i].\\ ] ] thus , in the prediction of warps , there is a trade - off between the regularity of the displacement vectors ( the term @xmath126 in eq .",
    "[ eq : wlike ] ) and the regularity of the predicted spatially correlated intensity variation given the displacement vectors ( the term @xmath127^\\top s^{-1 } \\mathrm{e}[{{\\boldsymbol{x}}}_i\\,|\\ , { \\boldsymbol{y}}_i , { \\boldsymbol{w}}_i]$ ] ) .",
    "the difference in regularization of the warps is shown in figure  [ fig : dis ] , where the estimated warps using the procrustes model are compared to the predicted warps from the proposed model .",
    "we see that the proposed model predicts much smaller warps than the procrustes model .",
    "p0.31p0.31p0.31 rigid registration with scaling & procrustes",
    "free warp & & &     +    one of the advantages of the mixed - effects model is that we are able to predict the systematic part of the intensity variation of each image , which in turn also gives a prediction of the residual intensity variation  the variation that can not be explained by systematic effects . in figure  [ fig : brain_pred ] , we have predicted the individual observed slices using the procrustes model and the proposed model . as we also saw in figure",
    "[ fig : dis ] , the proposed model predicts less deformation of the template compared to the procrustes model , and we see that the brownian sheet model is able to account for the majority of the personal structure in the sulci of the brain .",
    "moreover , the predicted intensity variation seems to model intensity differences introduced by the different mri scanners well .",
    "p0.19|p0.19|p0.19|p0.19|p0.19 procrustes warped template prediction & & predicted spatially correlated intensity variation & full prediction & observation & & & & & & & & & & & &",
    "in this section , we present a simulation study for investigating the precision of the proposed model .",
    "the results are compared to the previously introduced models : procrustes free warp and a regularized procrustes .",
    "data are generated from model ( [ eq : model ] ) in which @xmath24 is taken as one of the mri slices considered in section  [ mri ] .",
    "the warp , intensity and the random noise effects are all drawn from the previously described multivariate normal distributions with variance parameters respectively @xmath128 and applied to the chosen template image @xmath24 . to consider more realistic brain simulations , the systematic part of the intensity effect",
    "was only added to the brain area of @xmath24 and not the background .",
    "as this choice makes the proposed model slightly misspecified , it will be hard to obtain precise estimates of the variance parameters . in practice",
    ", one would expect any model with a limited number of parameters to be somewhat misspecified in the presented setting .",
    "the simulations thus present a realistic setup and our main interest will be in estimating the template and predicting warp and intensity effects .",
    "figure  [ fig : simeksbrains ] displays 5 examples of the simulated observations as well as the chosen @xmath24 .",
    "+    the study is based on 100 data sets of 100 simulated brains .",
    "for each simulated dataset we applied the proposed , procrustes free warp and procrustes regularized model . the regularization parameter , @xmath7 , in the regularized procrustes model , was set to the true parameter used for generating the data @xmath129 .",
    "the variance estimates based on the simulations are shown in figure  [ fig : vardens ] .",
    "the true variance parameters are plotted for comparison .",
    "we see some bias in the variance parameters .",
    "while bias is to be expected , the observed bias for the noise variance @xmath38 and the warp variance scale @xmath130 are bigger than what one would expect .",
    "the reason for the underestimation of the noise variance seems to be the misspecification of the model . since the model assumes spatially correlated noise outside of the brain area , where there is none , the likelihood assigns the majority of the variation in this area to the systematic intensity effect .",
    "the positive bias of the warp variance scale seems to be a compensating effect for the underestimated noise variance .",
    "the left panel of figure  [ fig : wtdens ] shows the mean squared difference for the estimated templates @xmath24 with the three types of models .",
    "we see that the proposed model produces conisderably more accurate estimates than the alternative frameworks .    to give an example of the difference between template estimates for the three different models , one set of template estimates for each of the models",
    "is shown in figure  [ fig : tempex ] . from this example",
    "we see that the template for the proposed model is slightly more sharp than the procrustes models and are more similar to the true @xmath24 which was also the conclusion obtained from the density of the mean squared difference for the template estimates ( figure  [ fig : wtdens ] ) .",
    "p0.24p0.24p0.24p0.24 true template & & procrustes @xmath131 & procrustes @xmath129 & & &    the right panel of figure  [ fig : wtdens ] shows the mean squared prediction / estimation error of the warp effects .",
    "the error is calculated using only the warp effects in the brain area since the background is completely untextured , and any warp effect in this area will be completely determined by the prediction / estimation in the brain area .",
    "we find that the proposed model estimates warp effects that are closest to the true warps .",
    "it is worth noticing that the proposed model is considerably better at predicting the warp effects than the regularized procrustes model .",
    "this happens despite the fact that the value for the warp regularization parameter in the model was chosen to be equal to the true parameter ( @xmath129 ) .",
    "examples of the true warping functions in the simulated data and the predicted / estimated effects in the different models are shown in figure  [ fig : simpred ] .",
    "none of the considered models are able to make sensible predictions on the background of the brain , which is to be expected . in the brain region ,",
    "the predicted warps for the proposed model seem to be very similar to the true warp effect , which we also saw in figure  [ fig : wtdens ] was a general tendency .",
    "p0.03p0.3p0.3p0.3[0pt][0pt ] & & & [ 0pt][0pt ] & & & [ 0pt][0pt ] & & & [ 0pt][0pt ] & & &",
    "we generalized the likelihood based mixed - effects model for template estimation and separation of phase and intensity variation to 2d images .",
    "this type of model was originally proposed for curve data @xcite .",
    "as the model is computationally demanding for high dimensional data , we presented an approach for efficient likelihood calculations .",
    "we proposed an algorithm for doing maximum - likelihood based inference in the model and applied it to two real - life datasets .",
    "based on the data examples , we showed how the estimated template had desirable properties and how the model was able to simultaneously separate sources of variation in a meaningful way .",
    "this feature eliminates the bias from conventional sequential methods that process data in several independent steps , and we demonstrated how this separation resulted in well - balanced trade - offs between the regularization of warping functions and intensity variation .",
    "we made a simulation study to investigate the precision of the template and warp effects of the proposed model and for comparison with two other models .",
    "the proposed model was compared with a procrustes free warp model , as well as a procrustes regularized model .",
    "since the noise model was misspecified , the proposed methodology could not recover precise maximum likelihood estimates of the variance parameters .",
    "however , the maximum likelihood estimate for the template was seen to be a lot sharper and closer to the true template compared to alternative procrustes models .",
    "furthermore , we demonstrated that the proposed model was better at predicting the warping effect than the alternative models .",
    "the main restriction of the proposed model is the computability of the likelihood function .",
    "we resolved this by modeling intensity variation as a gaussian markov random field .",
    "an alternative approach would be to use the computationally efficient operator approximations of the likelihood function for image data suggested in @xcite .",
    "this approach would , however , still require a specific choice of parametric family of covariance functions , or equivalently , a family of positive definite differential operators .",
    "an interesting and useful extension would be to allow a free low - rank spatial covariance structure and estimate it from the data .",
    "this could , for example , be done by extending the proposed model   to a factor analysis model where both the mean function and intensity variation is modeled in a common functional basis , and requiring a specific rank of the covariance of the intensity effect .",
    "such a model could be fitted by means of an em algorithm similar to the one for the reduced - rank model for computing functional principal component analysis proposed in @xcite , and it would allow simulation of realistic observations by sampling from the model .",
    "for the computation of the likelihood function of the nonlinear model , we relied on local linearization which is a simple well - proven and effective approach . in recent years ,",
    "alternative frameworks for doing maximum likelihood estimation in nonlinear mixed - effects models have emerged , see @xcite and references therein .",
    "an interesting path for future work would be to formulate the proposed model in such a framework that promises better accuracy than the local linear approximation .",
    "this would allow one to investigate how much the linear approximation of the likelihood affects the estimated parameters . in this respect",
    ", it would also be interesting to compare the computing time across different methods to identify a suitable tradeoff between accuracy and computing time .",
    "the proposed model introduced in this paper is a tool for analyzing 2d images . the model , as it is , could be used for higher dimensional images as well , but the analysis would be computationally infeasible with the current implementation . to extend the proposed model to 3d images there is a need to devise new computational methods for improving the calculation of the likelihood function ."
  ],
  "abstract_text": [
    "<S> this paper introduces a class of mixed - effects models for joint modeling of spatially correlated intensity variation and warping variation in 2d images . spatially correlated intensity variation and warp variation </S>",
    "<S> are modeled as random effects , resulting in a nonlinear mixed - effects model that enables simultaneous estimation of template and model parameters by optimization of the likelihood function . </S>",
    "<S> we propose an algorithm for fitting the model which alternates estimation of variance parameters and image registration . </S>",
    "<S> this approach avoids the potential estimation bias in the template estimate that arises when treating registration as a preprocessing step . </S>",
    "<S> we apply the model to datasets of facial images and 2d brain magnetic resonance images to illustrate the simultaneous estimation and prediction of intensity and warp effects .    </S>",
    "<S> * keywords * template estimation , image registration , separation of phase and intensity variation , nonlinear mixed - effects model </S>"
  ]
}